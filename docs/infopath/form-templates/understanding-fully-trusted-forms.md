---
title: Основные сведения о полностью доверенных формах
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
ms.assetid: 64d62990-6275-edef-c639-b6ba8d10c38c
description: InfoPath предоставляет возможность создавать полностью доверенные формы, которые имеют более высокие разрешения безопасности и могут получать доступ к системным ресурсам и другим компонентам на компьютере пользователя. В этой статье описывается, что такое полностью доверенная форма и зачем она используется, а также создание полностью доверенной формы с помощью ручного преобразования и регистрации стандартной формы или цифровой подписи стандартной формы.
ms.openlocfilehash: 04560e0c844d6a6ff681fd366ca7da2e4db36ba1
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33430394"
---
# <a name="understanding-fully-trusted-forms"></a>Основные сведения о полностью доверенных формах

InfoPath предоставляет возможность создавать полностью доверенные формы, которые имеют более высокие разрешения безопасности и могут получать доступ к системным ресурсам и другим компонентам на компьютере пользователя. В этой статье описывается, что такое полностью доверенная форма и зачем она используется, а также создание полностью доверенной формы с помощью ручного преобразования и регистрации стандартной формы или цифровой подписи стандартной формы.

Шаблоны форм InfoPath можно развертывать с различными уровнями безопасности. Используемый уровень выбирается с учетом уровня доступа ко внешним ресурсам, который должен быть у формы. По умолчанию шаблоны формы InfoPath не могут обращаться к системным ресурсам и использовать программные компоненты, не отмеченные как безопасные для скриптов. Однако можно сделать так, что форма может получить доступ к системным и другим внешним ресурсам, включая программные компоненты, не отмеченные как безопасные для скриптов.
  
Для использования формы приложение InfoPath должно иметь доступ к шаблону формы, на котором основана форма. При создании шаблона формы InfoPath создает запись в файле определений формы (XSF), который содержит URL-адрес шаблона формы. Форма на основе URL-адреса называется *песочницей*. Когда пользователь ее заполняет, форма добавляется в локальный кэш, при этом она не имеет доступа к системным ресурсам. Такой тип форм наследует разрешения домена, в котором она открывается. 
  
Однако форму можно изменить таким образом, чтобы она была основана на универсальном имени ресурса (URN), что дает доступ к системным ресурсам. Такие формы называются *полностью доверенными*. 
  
## <a name="why-use-a-fully-trusted-form"></a>Причины использования полностью доверенных форм

Полностью доверенные формы обладают улучшенным набором разрешений, чем формы-"песочницы". Например, они могут содержать программный код, использующий внешние объекты для доступа к системным ресурсам, они могут использовать системные компоненты и элементы управления Microsoft ActiveX, не отмеченные как безопасные для скриптов, а также они могут применять пользовательскую бизнес-логику из сборок .NET.
  
Кроме того, некоторые элементы объектной модели InfoPath имеют уровень безопасности 3, то есть их можно использовать только в полностью доверенных формах. Например, для доступа к объекту Microsoft Office **CommandBars** используется свойство [CommandBars](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.Window.CommandBars.aspx) класса InfoPath [Window](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.Window.aspx) , чтобы задать ссылку на него. Так как это свойство имеет уровень безопасности 3, его нельзя использовать не в полностью доверенной форме. 
  
> [!NOTE]
> [!Примечание] Использование свойства [CommandBars](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.Window.CommandBars.aspx) класса [Window](https://msdn.microsoft.com/library/Microsoft.Office.InfoPath.Window.aspx) или другого элемента объектной модели с уровнем безопасности 3 не в полностью доверенной форме приведет к ошибке "в разрешении отказано". 
  
## <a name="what-makes-a-form-fully-trusted"></a>Что делает форму полностью доверенной?

Для создания и использования полностью доверенной формы необходимо выполнить следующие действия с применением интерфейса пользователя InfoPath и обработкой файлов формы.
  
- Нужно включить параметр InfoPath, разрешающий использование полностью доверенных форм категории **Доверенные издатели** диалогового окна **Центр управления безопасностью**. Этот параметр должен быть включен, чтобы пользователи могли открывать полностью доверенные формы. 
    
- Зарегистрировать полностью доверенную форму на целевом компьютере с помощью метода **RegisterSolution** объекта **Application** InfoPath. 
    
## <a name="creating-a-fully-trusted-form"></a>Создание полностью доверенной формы

- Форму можно создать вручную, для чего необходимо напрямую изменить некоторые файлы формы.
    
- Также можно использовать цифровую подпись шаблона формы.
    
### <a name="manually-creating-a-fully-trusted-form"></a>Ручное создание полностью доверенной формы

#### <a name="to-manually-create-a-fully-trusted-form"></a>Чтобы создать полностью доверенную форму вручную, выполните следующие действия

1. Создайте архивную копию шаблона формы, которую необходимо сделать полностью доверенной.
    
2. Откройте шаблон формы в InfoPath.
    
3. Сохраните исходные файлы формы на жестком диске, щелкнув вкладку **Файл**, выбрав **Опубликовать**, а затем — **Экспортировать исходные файлы**.
    
4. Укажите папку, в которой нужно сохранить исходные файлы формы, нажмите кнопку **ОК** и выйдите из конструктора InfoPath.
    
5. В папке, содержащей файлы формы, откройте файл определений формы (XSF), который по умолчанию называется  `manifest.xsf`, в текстовом редакторе наподобие Блокнота. 
    
6. Добавьте следующие атрибуты в элемент **xDocumentClass** XSF-файла: 
   
   `requireFullTrust="yes"`<br/>
   `name="urn:MyForm:MyCompany`

   > [!NOTE]
   > [!Примечание] Значения, используемые для идентификатора URN могут быть любой строкой, если эта строка уникальна. После `urn:` префикса должно быть по крайней мере два значения, и эти значения должны быть разделены двоеточием. Кроме того, длина идентификатора URN не должна превышать 255 символов. 
  
7. Сохраните и закройте XSF-файл, затем откройте XML-файл шаблона, который по умолчанию имеет имя  `Template.xml`, в текстовом редакторе наподобие Блокнота. 
    
8. Удалите атрибут **href** из инструкции обработки  `mso-infoPathSolution` и замените ее на тот же атрибут **name**, используемый в шаге 6 для XSF-файла. 
    
   > [!NOTE]
   > [!Примечание] Значения URN, используемые для атрибута **name**, должны быть одинаковыми для XSF-файла и XML-файла шаблона. 
  
9. Сохраните и закройте XML-файл шаблона.
    
10. Запакуйте эти файлы в XSN-файл формата CAB с помощью средства наподобие makecab.exe.
    
    > [!NOTE]
    > [!Примечание] Хотя конструктор форм InfoPath поддерживает упаковку файлов формы в XSN-файл, при этом форма преобразуется в форму на основе идентификатора URL. Поэтому следует упаковать файлы вручную, чтобы предотвратить изменение файлов формы. 
  
11. Создайте пользовательскую программу установки с помощью метода **RegisterSolution** объекта **Application** InfoPath, чтобы установить полностью доверенную форму. Простой способ создания такой программы заключается в том, чтобы создать файл скрипта, использующий следующие строки кода (с применением синтаксиса Microsoft JScript или VBScript): 
    
    ```js
        objIPApp = new ActiveXObject("InfoPath.Application"); 
        objIPApp.RegisterSolution("C:\\MyForms\\MyTrustedForm.xsn"); 
        objIPApp.Quit(); 
        objIPApp = null;
    ```
   
    ```vb
        Public Sub InstallForm()
            Dim objIPApp As Object
            ' Create a reference to the Application object.
            Set objIPApp = CreateObject("InfoPath.Application")
            ' Register the InfoPath form template.
            objIPApp.RegisterSolution ("C:\\My Forms\\MyFormTemplate.xsn")
            MsgBox "The InfoPath form template has been registered."
            Set objIPApp = Nothing
        End Sub
        
    ```

> [!NOTE] 
> [!Примечание] Хотя в этом примере используется простой файл скрипта, можно применять более надежный механизм установки, такой как файлы установщика Microsoft Windows (MSI). Убедитесь, что метод **RegisterSolution** правильно устанавливает полностью доверенную форму на целевом компьютере. Для доступа к методу **RegisterSolution** объекта **Application** InfoPath из Visual Basic или Visual Studio задайте ссылку на библиотеку типов Microsoft InfoPath 3.0, содержащуюся в файле IPEDITOR.dll, который установлен в папке C:\Program Files\Microsoft Office\Office14. 
  
Если нужно удалить полностью доверенную форму, можно воспользоваться методом **UnregisterSolution** объекта **Application**, как показано в следующих примерах JScript и VBScript. 
    
```js
    objIPApp = new ActiveXObject("InfoPath.Application"); 
    objIPApp.UnregisterSolution("C:\\MyForms\\MyTrustedForm.xsn"); 
    objIPApp.Quit(); 
    objIPApp = null;
```

```vb
    Public Sub UninstallForm()
        Dim objIPApp As Object
        ' Create a reference to the Application object.
        Set objIPApp = CreateObject("InfoPath.Application")
        ' Unregister the InfoPath form template.
        objIPApp.UnregisterSolution ("C:\My Forms\MyFormTemplate.xsn")
        MsgBox ("The InfoPath form template has been unregistered.")
        Set objIPApp = Nothing
    End Sub
    
```

### <a name="digitally-signing-a-form-template-to-create-a-fully-trusted-form"></a>Цифровое подписывание шаблона формы для создания полностью доверенной формы

Цифровая подпись шаблона формы позволяет развернуть полностью доверенный шаблон формы по электронной почте или на веб-сервере, например на сервере с Microsoft SharePoint Foundation. Выполните действия следующих трех процедур, чтобы сделать форму полностью доверенной, указав полное доверие для формы, используя цифровую подпись и опубликовав форму.
  
#### <a name="to-digitally-sign-a-form-template"></a>Цифровое подписывание формы

1. Откройте конструктор InfoPath, щелкните вкладку **File**, а затем выберите **Параметры формы** на вкладке **Сведения**. 
    
2. В диалоговом окне **Параметры формы** выберите категорию **Безопасность и доверие**. 
    
3. Снимите флажок **Автоматически определять уровень безопасности (рекомендуется)**.
    
4. Выберите **Полное доверие (у формы есть доступ к файлам и параметрам компьютера пользователя)**.
    
5. В разделе **Подписывание шаблона формы** выберите **Подписать этот шаблон формы**.
    
6. Щелкните **Выбор сертификата**, чтобы выбрать сертификат, загруженный и установленный ранее с поставщика доверенных сертификатов. 
    
7. Нажмите кнопку "ОК" два раза, чтобы завершить работу.
    
#### <a name="to-publish-the-form-template-to-a-sharepoint-document-library"></a>Публикация шаблона формы в библиотеке документов SharePoint

1. Щелкните вкладку **Файл**, выберите **Опубликовать**, а затем щелкните **SharePoint Server**.
    
2. Следуйте инструкциям **мастера публикации**, чтобы опубликовать шаблон формы в новой или существующей библиотеке документов SharePoint. 
    
#### <a name="to-a-create-a-form-that-is-based-on-your-fully-trusted-digitally-signed-form-template"></a>Создание формы на основе полностью доверенного шаблона формы с цифровой подписью

1. В библиотеке документов SharePoint щелкните **Заполнить форму**.
    
   > [!NOTE]
   > [!Примечание] После публикации шаблона формы в библиотеке документов SharePoint с помощью **мастера публикации** шаблон не отображается как элемент в библиотеке форм. При создании формы в этой библиотеке документов шаблон используется для новой формы по умолчанию. 
  
2. Если шаблон формы по умолчанию имеет цифровую подпись, InfoPath отображает предупреждение системы безопасности о шаблоне с цифровой подписью. Выберите **Всегда доверять файлам от этого поставщика и открывать их автоматически** и щелкните **Открыть**.
    
## <a name="using-a-fully-trusted-form"></a>Использование полностью доверенной формы

Использование полностью доверенной формы очень похоже на использование стандартной формы. Единственные значительные различия состоят в том, что полностью доверенная форма имеет доступ к ограниченным ресурсам, а предупреждения о безопасности не отображаются.
  
> [!NOTE]
> [!Примечание] Чтобы приложение InfoPath использовало полностью доверенную форму, пользователи должны убедиться, что флажок **Разрешить запуск полностью доверенных форм на моем компьютере** в категории **Доверенные издатели** диалогового окна **Центр управления безопасностью** установлен. Чтобы открыть диалоговое окно **Центр управления безопасностью**, выберите вкладку **Файл**, щелкните **Параметры** (под вкладкой **InfoPath**), щелкните **Центр управления безопасностью**, а затем выберите **Параметры центра управления безопасностью**. 
  
Полностью доверенную форму можно открыть в InfoPath в диалоговом окне **Заполнить форму**. 
  
Диалоговое окно **Заполнить форму** открывается, если щелкнуть **Дополнительные формы** на панели задач окна **Заполнить форму** или выбрать **Заполнить форму** в меню **Файл**. 
  
### <a name="making-changes-to-a-fully-trusted-form"></a>Изменение полностью доверенной формы

Если нужно внести изменения только в XSN-файл, пользователи могут заменить существующие XSN-файлы на новый после внесения изменений. Им не придется повторно устанавливать его с помощью пользовательской программы установки.
  
Однако при внесении изменений в файлы формы, которые содержит XSN-файл следует их упаковать, как это описано ранее, а пользователи должны повторно установить полностью доверенную форму.
  
> [!NOTE]
> Лучше всего сохранить шаблон формы в формате XSN в конструкторе InfoPath, а затем следовать инструкциям, описанным в этой статье, чтобы создать полностью доверенную форму. 
  
## <a name="conclusion"></a>Заключение

В зависимости от деловых требований и потребностей пользователей возможно потребуется создать форму с более широким набором разрешений, чем у стандартной формы InfoPath. InfoPath позволяет изменить форму таким образом, чтобы она имела доступ к системным и другим внешним ресурсам, не отмеченным как безопасные для скриптов. Это можно сделать вручную, внеся изменения в файлы формы, которые содержит шаблон формы, и запустив скрипт установки или используя цифровую подпись шаблона формы.
  

