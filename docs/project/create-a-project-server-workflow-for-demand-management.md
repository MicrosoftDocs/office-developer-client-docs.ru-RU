---
title: Создание рабочего процесса Project Server для управления запросами
manager: soliver
ms.date: 08/10/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: b0e4a3b3-d1df-454d-b74c-b980b0b456f6
description: В этой статье описано, как создать простой рабочий процесс с помощью SharePoint Designer 2013.
ms.openlocfilehash: bbefc5d30ccb508a24c32fe41e733e6e8187ecd9
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32355585"
---
# <a name="create-a-project-server-workflow-for-demand-management"></a>Создание рабочего процесса Project Server для управления запросами

В этой статье описано, как создать простой рабочий процесс с помощью SharePoint Designer 2013. Вы можете экспортировать рабочий процесс в Visio 2013 для визуализации и редактирования или использовать Visio 2013 для разработки рабочих процессов Project Server 2013 и импорта структуры в SharePoint Designer 2013 для публикации в Project Web App. Для получения дополнительных сведений о платформе рабочих процессов SharePoint и создании рабочих процессов с Visio 2013 и SharePoint Designer 2013, ознакомьтесь с [разработкой рабочих процессов в статьях sharepoint 2013](https://msdn.microsoft.com/library/jj163986%28office.15%29.aspx) в документации для разработчиков SharePoint 2013. 
  
Сведения о подготовке Project Server для рабочих процессов можно найти в статье [Start: Установка и настройка SharePoint 2013 Workflow Manager](https://msdn.microsoft.com/library/jj163276%28office.15%29.aspx).

<a name="pj15_CreateWorkflowSPD_General"> </a>

## <a name="creating-a-general-workflow"></a>Создание общего рабочего процесса

Выполните указанные ниже действия, чтобы создать рабочий процесс Project Server 2013 с помощью SharePoint Designer 2013. Рабочий процесс разрабатывается для управления запросами проектных инициатив.
  
Подробное описание действий приведено в разделе [Создание рабочего процесса ветвления](#pj15_CreateWorkflowSPD_Detailed) . 
  
### <a name="to-create-a-project-server-workflow-general-procedure"></a>Создание рабочего процесса Project Server (общая процедура)

1. Определите требования, а затем разработайте рабочий процесс. Организуйте его этапы и стадии, а также определите настраиваемые поля, которые будет использовать этот рабочий процесс.
    
2. В Project Web App создайте сущности, необходимые рабочему процессу:
    
    1. Просмотрите существующие этапы рабочего процесса; создайте этапы по мере необходимости.
        
    2. Создайте корпоративные настраиваемые поля, которые будет использовать рабочий процесс. Чтобы настраиваемое поле было доступно в стадии рабочего процесса, оно должно управляться рабочим процессом.
        
    3. Отредактируйте или создайте страницы сведений о проекте (PDP), которые будут использоваться стадиями рабочего процесса для сбора сведений для проекта. В данном примере стадии используют страницы сведений о проекте по умолчанию, которые редактируются, чтобы включить в них новое настраиваемое поле.
        
    4. Создайте необходимые стадии рабочего процесса, а затем сопоставьте каждую стадию рабочего процесса с правильным этапом.
    
3. В SharePoint Designer 2013 создайте рабочий процесс с помощью декларативных операторов в **текстовом конструкторе**:
    
    > [!NOTE]
    > Вы также можете переключиться на **визуальный конструктор** в SharePoint Designer 2013 или импортировать существующий рабочий процесс из Visio 2013. Чтобы воспользоваться **текстовым конструктором**, выполните следующие действия. 
    > 
    > 1. Откройте сайт Project Web App и создайте рабочий процесс, использующий платформу рабочих процессов **SharePoint 2013 Workflow-Project Server** . 
    > 2. Добавьте стадии, которые будет использовать рабочий процесс.
    > 3. Вставьте шаги, условия, действия и циклы рабочего процесса, которые требуются в каждой стадии.
    > 4. Проверьте наличие каких-либо ошибок рабочего процесса и исправьте все найденные ошибки.
    > 5. Необязательно Переключите представление на **визуальный конструктор**или экспортируйте рабочий процесс в файл Visio 2013. Вы можете изменить представление Visio и сохранить изменения в текущем рабочем процессе. Вы можете изменить файл Visio и импортировать его в SharePoint Designer 2013 для создания других рабочих процессов.
    > 6. Опубликуйте рабочий процесс. После публикации рабочий процесс показывается в списке рабочих процессов для сайта Project Web App.
    
4. В Project Web App используйте рабочий процесс для управления запросами предложений по проекту:
    
    1. Создайте шаблон корпоративного проекта (EPT), использующий рабочий процесс.
        
    2. На странице центра проектов создайте проект, который использует шаблон EPT для рабочего процесса, а затем пройдите по стадиям рабочего процесса.
        
    3. Тщательно протестируйте рабочий процесс.
        
    4. Разверните рабочий процесс на рабочем сервере.

<a name="pj15_CreateWorkflowSPD_Detailed"> </a>

## <a name="creating-a-branching-workflow"></a>Создание ветвящегося рабочего процесса

Прежде чем использовать SharePoint Designer 2013 для создания рабочего процесса Project Server, необходимо настроить службу Workflow Manager Client 1,0 для использования действий рабочего процесса Project Server 2013. Сведения о том, как настроить клиент диспетчера рабочих процессов 1,0, можно найти в статьях, посвященных рабочим процессам [в sharepoint 2013](https://msdn.microsoft.com/library/jj163986%28office.15%29.aspx) , в документации для разработчиков sharepoint Server 2013. 
  
Следующая детальная процедура включает те же действия, что и в разделе [Создание общего рабочего процесса](#pj15_CreateWorkflowSPD_General) . 
  
### <a name="to-create-a-project-server-branching-workflow-detailed-procedure"></a>Создание ветвящегося рабочего процесса Project Server (подробная процедура)

#### <a name="1-plan-and-design-the-workflow"></a>1. Запланируйте и разработайте рабочий процесс.

Рабочий процесс Project Server может интегрироваться с несколькими стадиями и этапами в процессе управления запросами. Поскольку рабочие процессы могут быть сложными, необходимо понимать бизнес-требования и тщательно планировать рабочий процесс. В качестве простого примера сконструируйте рабочий процесс, который использует оценочную стоимость проектной инициативы, чтобы определить, принимается ли эта инициатива. Если оценочная стоимость больше 25 000 долларов США, инициатива отклоняется; в противном случае инициатива принимается, и проект создается.
    
Так как вы можете использовать Visio 2013 и SharePoint Designer 2013 для разработки и создания рабочих процессов для Project Server 2013, вы можете легко поэкспериментировать с рабочими процессами, чем это возможно в Project Server 2010. Пример оформления рабочего процесса в этой статье такой же, как и в статье [Создание рабочего процесса ветвления](https://msdn.microsoft.com/library/a02cafdc-d881-4271-b446-d8b2cd456a52%28Office.15%29.aspx) в пакете SDK для Project 2010. Вы можете разработать и создать тестовый рабочий процесс на удаленном компьютере с помощью тестового экземпляра Project Web App, но вам не нужно создавать рабочие процессы непосредственно на компьютере Project Server 2013. 
    
#### <a name="2-create-the-entities-that-your-workflow-requires"></a>2. Создайте сущности, необходимые вашему рабочему процессу.

В Project Web App просмотрите доступные этапы и этапы рабочего процесса, а также доступные корпоративные настраиваемые поля. При необходимости создайте сущности, которые требуются вашему рабочему процессу, как показано в следующих действиях.
    
1. **Этапы рабочего процесса** Установка Project Web App по умолчанию включает этапы "создать", "выбрать", "планирование", "Управление" и "завершено". В примере с ветвящимся рабочим процессом другие этапы создавать не требуется. 
        
2. **Корпоративные настраиваемые поля** Для рабочего процесса ветвления требуется настраиваемое поле затрат проекта, управляемое рабочим процессом. Значение управляемого рабочим процессом настраиваемого поля устанавливается на странице сведений о проекте, которая используется рабочим процессом. Например, нажмите значок " **Параметры** " в верхней правой части страницы Project Web App, выберите **Параметры PWA**, а затем выберите **Корпоративные настраиваемые поля и таблицы подстановки**.
        
   Создайте настраиваемое поле с именем Стоимость инициативы для сущности **Проект** и выберите тип **Cost** (Стоимость). В качестве описания введите Оценочная стоимость проектной инициативы. В разделе **Поведение** выберите **Поведение управляется рабочим процессом**.
        
3. **Страницы сведений о проекте** Редактирование или создание PDP, которые будут использоваться стадиями рабочего процесса. Например, выполните следующие действия. 
        
    1. На странице параметров сервера выберите **Страницы сведений о проекте**, а затем выберите PDP **ProjectInformation**. 
            
    2. На вкладке **СТРАНИЦА** ленты в группе **Правка** выберите команду **Изменить страницу**.
            
    3. Нажмите стрелку вниз в правом верхнем углу веб-части **основных сведений** , а затем выберите команду **Изменить веб-часть**. Или на вкладке **веб-часть** ленты в группе **свойства** выберите **Свойства веб-части** , чтобы отобразить часть редактора. 
            
    4. В разделе **Отображаемые поля проекта** веб-части "Редактор" (см. рисунок 1) выберите **Изменить**.
            
    5. Добавьте настраиваемое поле **затрат предложений** , переместите его над полем **владелец** в списке **Выбранные поля проекта** и нажмите кнопку **ОК** (см. рисунок 1).
      
    6. В веб-части "Редактор" нажмите кнопку **ОК**, а затем на вкладке **СТРАНИЦА** ленты в группе **Правка** нажмите **Stop Editing** (Завершить редактирование). На рисунке 2 показано настраиваемое поле **Proposal Cost**, добавленное на страницу сведений о проекте информации по проекту. 

    **Рис. 1. Изменение веб-части "поля проекта" в PDP**

    ![Изменение веб-части "поля проекта" в PDP](media/pj15_CreateWorkflowSPD_EditPDP.gif "изменение веб-части \"поля проекта\" в PDP")

    **Рис. 2. Измененная страница сведений о проекте с настраиваемым полем "Стоимость инициативы"**

    ![Измененный PDP включает в себя поле затрат предложений](media/pj15_CreateWorkflowSPD_EditedPDP.gif "измененный PDP включает в себя поле затрат предложений")
  
4. **Стадии рабочего процесса** Создайте этапы, необходимые для каждого этапа рабочего процесса. На странице параметров сервера нажмите **Стадии рабочего процесса**, а затем выберите **СОЗДАТЬ СТАДИЮ РАБОЧЕГО ПРОЦЕССА**. На рисунке 3 показана часть страницы добавления стадии рабочего процесса.
    
    **Рис. 3. Добавление стадии рабочего процесса в Project Web App**

    ![Добавление стадии рабочего процесса в Project Web App](media/pj15_CreateWorkflowSPD_AddWorkflowStage.gif "Добавление стадии рабочего процесса в Project Web App")
  
    В примере ветвящегося рабочего процесса используются четыре стадии, показанные в таблице 1. Значения в разделе **Дополнительные параметры отображаемой страницы сведений о проекте** страницы добавления стадии рабочего процесса (не показанном на рисунке 3) не являются обязательными; они предоставляют дополнительные сведения на странице состояния рабочего процесса. Например, так как начальные сведения о предложении PDP требуют ввода данных пользователем, можно установить флажок **Страница сведений о проекте требует внимания** , а затем добавить определенное описание, например задать имя проекта и затраты для этого PDP.
    
    На рисунке 4 показаны четыре стадии, завершенные на странице стадий рабочего процесса.
    
    **Таблица 1. Стадии для ветвящегося рабочего процесса**

    |Имя|Описание|Описание для отправки|Этап|Отображаемые PDP|Настраиваемые поля|
    |:-----|:-----|:-----|:-----|:-----|:-----|
    |Начальные сведения об инициативе  <br/> |Установите имя проекта и стоимость.  <br/> |Отправьте проект как инициативу.  <br/> |Create  <br/> |Информация по проекту  <br/> Сведения о проекте  <br/> |Стоимость инициативы (обязательно)  <br/> |
    |Сведения о проекте  <br/> |Предоставьте сведения о предложенном проекте.  <br/> |Отправьте сведения, чтобы продолжить работу с проектом.  <br/> |Create  <br/> |Информация по проекту  <br/> Сведения о проекте  <br/> |Стоимость инициативы (только для чтения)  <br/> |
    |Автоматическое отклонение  <br/> |Проект отклоняется на основе предоставленной информации.  <br/> | <br/> |Create  <br/> |Информация по проекту  <br/> |Стоимость инициативы (только для чтения)  <br/> |
    |Исполнения  <br/> |Инициатива принимается и готова для управления проектами.  <br/> | <br/> |Управление  <br/> |Информация по проекту  <br/> Сведения о проекте  <br/> |Стоимость инициативы (только для чтения)  <br/> |
   
    **Рис. 4. Список стадий рабочего процесса в Project Web App**

    ![Список стадий рабочего процесса в Project Web App](media/pj15_CreateWorkflowSPD_WorkflowStages.gif "для стадий рабочего процесса в Project Web App")
  
#### <a name="3-construct-the-workflow-in-the-text-based-designer"></a>3. Создайте рабочий процесс в текстовом конструкторе.

В SharePoint Designer 2013 создайте рабочий процесс с помощью декларативных операторов в текстовом конструкторе. Вы можете начать ввод в оранжевой строке вставки, чтобы получить операторы автоматического завершения для логики и шагов рабочего процесса, а также вставить логику и шаги с помощью элементов управления в группе " **Вставка** " на вкладке " **Рабочий процесс** " ленты. 
    
1. В представлении Backstage SharePoint Designer 2013 выберите пункт **Открыть сайт**. Например, Open ( `https://ServerName/pwa`открыть). В области **навигации** выберите пункт **рабочие процессы**. Затем на вкладке " **рабочие процессы** " ленты в **новой** группе выберите **Рабочий процесс сайта**. В этом примере назовите рабочий процесс ветвления рабочих процессов. Убедитесь, что в раскрывающемся списке **тип платформы** выбрано значение **SharePoint 2013 Workflow-Project Server** (см. рис. 5). 
    
    **Рис. 5. Создание рабочего процесса сайта Project Server**

    ![Создание рабочего процесса сайта Project Server](media/pj15_CreateWorkflowSPD_CreateSiteWorkflow.gif "Создание рабочего процесса сайта Project Server")
  
2. Перейдите на вкладку **Ветвящийся рабочий процесс**. Затем на вкладке **РАБОЧИЙ ПРОЦЕСС** ленты в группе **Manage** (Управление) в раскрывающемся списке **Представления** выберите **Текстовый конструктор**. Чтобы отобразить представление с мигающей оранжевой строкой вставки (см. рисунок 6), щелкните мышью где-нибудь внутри представления.
    
    **Рис. 6. Использование представления текстового конструктора для рабочего процесса**

    ![Использование текстового представления конструктора](media/pj15_CreateWorkflowSPD_TextBasedDesigner.gif "с") текстовым интерфейсом
  
3. В представлении **Текстовый конструктор** добавьте стадии, используемые рабочим процессом. На вкладке **РАБОЧИЙ ПРОЦЕСС** ленты в группе **Вставка** в раскрывающемся списке **Стадия** в разделе **Create** (Создание) выберите **Начальные сведения об инициативе**.
    
    Аналогично, поместите оранжевую строку вставки под полем **Stage: Initial Proposal Details** (Стадия: начальные сведения об инициативе) и добавьте другие стадии, используемые рабочим процессом: **Сведения о проекте**, **Автоматическое отклонение** и **Выполнение** (см. рисунок 7). 
    
    **Рис. 7. Добавление стадии в рабочий процесс в SharePoint Designer**

    ![Добавление стадии рабочего процесса в SPD](media/pj15_CreateWorkflowSPD_AddStageInSPD.gif "Добавление стадии рабочего процесса в SPD")
  
4. В каждой стадии добавьте шаги и логику рабочего процесса. 
    
    1. В стадии **Начальные сведения об инициативе** поместите оранжевую строку вставки вверху области стадии. В группе **Вставка** нажмите **Действие**, прокрутите вниз до раздела **Действия Project Web App** и выберите **Дождаться события проекта**. Нажмите **это событие проекта**, а затем выберите в раскрывающемся списке пункт **Событие: при отправке проекта**. 
    
    2. В разделе **Переход к стадии** для стадии **Начальные сведения об инициативе** вставьте **Если любое значение равно указанному значению**. Можно начать вводить эту инструкцию или воспользоваться элементом управления **Условие** в группе **Вставка** на ленте. 
    
    3. Выберите первый элемент управления **value**, а затем выберите **fx**, чтобы отобразить диалоговое окно **Определение подстановки в рабочем процессе** (см. рисунок 8). В раскрывающемся списке **Источник данных** выберите **Данные проекта**. В раскрывающемся списке **Поле из источника** выберите **Стоимость инициативы**.
    
       **Рис. 8. Определение значения подстановки в рабочем процессе**

       ![Определение значения подстановки в рабочем процессе],(media/pj15_CreateWorkflowSPD_DefineWorkflowLookup.gif "определяющем значение подстановки в рабочем процессе")
  
    4. Заполните `If` инструкцию следующим образом: **Если данные проекта: стоимость предложения превышает 25000**
    
       > [!NOTE]
       > Вместо этого можно было бы создать переменную рабочего процесса, установить для этой переменной значение настраиваемого поля, а затем сравнивать переменную со значением. Например, в раскрывающемся списке **Локальные переменные** на ленте создайте переменную с именем **TotalCost** (без пробелов) и типом **Number**. В диалоговом окне **Определение подстановки в рабочем процессе** выберите **Переменные и параметры рабочего процесса** для источника данных, а затем выберите **Переменная: TotalCost** в качестве поля. Инструкция **Если** может быть такой: **Если Переменная: TotalCost больше 25000**
  
    5. Поместите `If` оранжевый вставляемую строку в ветвь, а затем вставьте **Перейти в рабочую область** с помощью элемента управления **действием** в группе **Вставка** на ленте. Нажмите элемент управления с раскрывающимся списком **стадия** и выберите стадию **Автоматическое отклонение**. 
    
       Аналогичным образом в `Else` ветви вставьте инструкцию **"перейти к сведениям о проекте** ". На рисунке 9 показана заполненная стадия **Начальные сведения об инициативе**. 
    
       **Рис. 9. Заполненная логика для стадии "Начальные сведения об инициативе"**

       ![Завершенная логика для начальных сведений о предложении](media/pj15_CreateWorkflowSPD_InitialStageLogic.gif "завершена логика для исходных сведений о предложении")
  
    6. Если вы не хотите приостановить рабочий процесс и отобразить некоторые данные на странице сведений о проекте, оставьте первый раздел на стадии **Автоматическое отклонение** пустым. Раздел **Переход к стадии** должен содержать переход; поскольку нет других стадий после отклонения, введите для инструкции Перейти к завершению рабочего процесса. 
    
    7. На стадии **Сведения о проекте** в разделе Переход к стадии введите **Перейти к выполнению**. Если не требуется добавить дополнительные данные, и вы не хотите приостановить рабочий процесс, то не нужно дожидаться отправленного события. 
    
    8. Если вы не хотите приостановить рабочий процесс, на стадии **Выполнение** оставьте раздел действия стадии пустым. В разделе **Переход к стадии** добавьте **Перейти к завершению рабочего процесса**.
    
5. В группе **Сохранить** на ленте нажмите **Check for Errors** (Проверка), чтобы выполнить проверку на наличие ошибок рабочего процесса (см. рисунок 10). Исправьте все ошибки и нажмите **Сохранить**.
    
    **Рис. 10. Проверка на наличие ошибок рабочего процесса в SharePoint Designer**

    ![Проверка ошибок]в(media/pj15_CreateWorkflowSPD_SPDCheckForErrors.gif "рабочем") процессе при проверке рабочих процессов
  
6. (Дополнительно.) В группе **Управление** на ленте в раскрывающемся списке **Представления** выберите **Визуальный конструктор**. На рисунке 11 это представление показано в масштабе 50 %.
    
    Элементы в рабочем процессе можно изменять с помощью визуального конструктора. Например, выберите условие **Если любое значение равно указанному значению**, нажмите значок инструмента в нижнем левом углу условия, а затем выберите **Значение**, чтобы отобразить условия сравнения в диалоговом окне **Свойства**. 
    
    **Рис. 11. Использование визуального конструктора для рабочего процесса**

    ![Использование режима конструктора Visio для рабочего]процесса(media/pj15_CreateWorkflowSPD_SwitchView.gif "с помощью представления конструктора Visio для рабочего процесса")
  
    Когда рабочий процесс находится в представлении визуального конструктора, чтобы сохранить рабочий процесс в файле Visio 2013 (vsdx) в качестве резервной копии или для последующего использования, можно выбрать команду **Экспорт в Visio**.
    
7. Опубликуйте рабочий процесс. При использовании SharePoint Designer 2013 для публикации рабочего процесса на сайте Active Project Web App рабочий процесс регистрируется на сайте SharePoint или в Azure и становится доступным в Project Web App для новых EPT.

#### <a name="4-create-an-ept-for-the-workflow-and-then-test-the-workflow"></a>4. создайте EPT для рабочего процесса, а затем протестируйте рабочий процесс.

В Project Web App создайте EPT для рабочего процесса, а затем протестируйте рабочий процесс, создав предложение по проекту:
    
1. На странице параметров PWA выберите **типы корпоративных проектов**, а затем создайте EPT с именем Test Branch Workflow. Снимите флажок **Создание новых проектов в виде проектов списка задач SharePoint**, чтобы Project Server поддерживал полное управление проектами, созданными этим EPT. В раскрывающемся списке **Сопоставление рабочего процесса сайта** выберите **Ветвящийся рабочий процесс**, а затем в раскрывающемся списке **Страница нового проекта** выберите PDP **Информация по проекту** в качестве первой страницы, которую будет показывать этот рабочий процесс. 
    
    **Рис. 12. Добавление EPT для рабочего процесса**

    ![Добавление EPT для рабочего процесса](media/pj15_CreateWorkflowSPD_EPTs.gif "Добавление EPT для рабочего процесса")
  
    > [!NOTE]
    > Значение **Да** в столбце **Проект списка задач SharePoint** таблицы типов корпоративных проектов относится к EPT, который создает список задач SharePoint, причем этот список задач отображается в Project Web App, но SharePoint поддерживает управление этим проектом. Дополнительные сведения об управлении проектами как списками задач SharePoint см. в статье [Project Server 2013 architecture](project-server-2013-architecture.md). 
  
2. Откройте страницу проекты в Project Web App и создайте проект с помощью новой EPT (см. рисунок 13). Так как **Тестовая ветвь рабочего процесса** связана с **рабочим процессом ветвления**, создание проекта начинается с управления рабочим процессом.
    
    **Рис. 13. Создание проекта с помощью EPT "Тестовый ветвящийся рабочий процесс"**

    ![Создание проекта с помощью EPT]для(media/pj15_CreateWorkflowSPD_NewProject.gif "создания проекта с помощью EPT")
  
3. Когда рабочий процесс выводит **сведения проекта** PDP, добавьте данные в поля проекта. Например, введите **стоимость предложения** 30000. В английской версии Project Server в поле отображается $30 000 (см. рис. 14).
    
    **Рис. 14. Использование измененной PDP "Информация по проекту"**

    ![Использование измененной информации проекта PDP](media/pj15_CreateWorkflowSPD_NewProjectStage1.gif "с использованием измененной информации проекта PDP")
  
4. На вкладке **ПРОЕКТ** ленты в группе **Проект** нажмите **Сохранить**. Project Server добавляет данные со страницы PDP в проект, а затем отображает страницу состояния рабочего процесса (см. рисунок 15). Чтобы увидеть полное описание стадии "Начальные сведения об инициативе" в схеме состояния рабочего процесса, наведите указатель на стадию в схеме визуализации рабочего процесса.
    
    Таблица **Все стадии рабочего процесса** с помощью зеленой стрелки показывает, что стадия начальных сведений об инициативе ожидает ввод. Это объясняется тем, что рабочий процесс ожидает отправку события на стадии начальных сведений об инициативе. Если бы рабочий процесс не ожидал отправку события, можно было бы нажать **Далее** в группе **Страница**, чтобы перейти к следующей PDP. 
    
    **Рис. 15. использование страницы состояния рабочего процесса на стадии начальных сведений об инициативе**

    ![Страница состояния рабочего процесса после](media/pj15_CreateWorkflowSPD_NewProjectStage1Status.gif "первого этапа страницы состояния рабочего процесса") первого этапа
  
    Схема визуализации рабочего процесса показывает актуальную стадию зеленым цветом. На этапе **создания** актуальной является стадия начальных сведений об инициативе. 
    
5. В группе **Рабочий процесс** на ленте нажмите **Отправить**.
    
    > [!TIP]
    > Если элемент управления **Отправить** отключен, обновите страницу. 
  
    Если значение **Стоимость инициативы** превышает 25000 долларов США, то рабочий процесс переходит в стадию автоматического отклонения. На рисунке 16 показано состояние стадии автоматического отклонения, когда снова нажимается кнопка **Отправить**. Если **Стоимость инициативы** не превышает 25000 долларов США, то рабочий процесс переходит в стадию сведений о проекте (см. рисунок 17). 
    
    **Рис. 16. Рабочий процесс завершается на стадии автоматического отклонения**

    ![Рабочий процесс завершается в автоматическом отклонении](media/pj15_CreateWorkflowSPD_AutomatedRejectionCompleted.gif "Рабочий процесс выполняется в автоматическом отклонении")
  
    На рисунке 17 показан еще один тест с предложением по проекту под названием **Test 2 — ветвление**, где этап "сведения о проекте" является текущим на этапе создания. Этап управления показан светло-голубым цветом, что указывает, что этот этап пока не активен.
    
    **Рис. 17. Рабочий процесс переходит в стадию сведений о проекте, если стоимость ниже $25000**

    ![Состояние рабочего процесса на стадии "]сведения о проекте"(media/pj15_CreateWorkflowSPD_ProjectDetailsStage.gif "на стадии сведений о проекте")
  
6. Если вы переходите в стадию сведений о проекте, то на странице по умолчанию не нужно вводить дополнительные данные. Снова нажмите **Отправить**, чтобы перейти в стадию выполнения (см. рисунок 18). 
    
    **Рис. 18. Рабочий процесс готов к управлению на стадии выполнения**

    ![Состояние рабочего процесса на](media/pj15_CreateWorkflowSPD_ExecutionStage.gif "стадии выполнения рабочего процесса на") стадии выполнения
  
На стадии сведений о проекте рабочий процесс не ожидает отправки события. Если на странице PDP сведений о проекте имеются дополнительные обязательные поля, то Project Server ожидает, пока в эти поля не будут введены данные, прежде чем перейти в стадию выполнения. Как задано в ветвящемся рабочем процессе, в стадии выполнения тоже не ожидается отправка события. В стадии выполнения можно изменить проект в качестве менеджера проектов или нажать **Закрыть** на вкладке **ПРОЕКТ** ленты. Если вы нажимаете **Закрыть**, то позднее можно вернуть проект и изменить его или оставить этот проект извлеченным.

Проект **Ветвящийся рабочий процесс** представляет простой пример только с одной проверкой сравнением. В рабочем процессе имеется три стадии на этапе создания и одна стадия на этапе управления процесса управления запросами. Чтобы полностью протестировать рабочий процесс, следует проверить все ветви рабочего процесса, используя экстремальные и типичные значения, чтобы убедиться в правильном поведении. 

<a name="pj15_CreateWorkflowSPD_ImportingVromVisio"> </a>

## <a name="importing-a-workflow-from-visio"></a>Импорт рабочего процесса из Visio

Чтобы изменить рабочий процесс, можно создать или изменить управляемые рабочим процессом настраиваемые поля и создать или изменить этапы и стадии рабочего процесса. С помощью SharePoint Designer 2013 можно добавлять условия, действия, циклы и стадии, а затем сохранять и повторно публиковать рабочий процесс. Чтобы повторно использовать или хранить резервную копию рабочего процесса, его можно экспортировать в файл Visio 2013. 
  
Вы также можете создать или изменить рабочий процесс в Visio 2013 и импортировать файл в SharePoint Designer 2013 для использования приложением Project Web App. Чтобы использовать неизмененный рабочий процесс, экземпляр Project Web App должен включать свойства стадии рабочего процесса, которые совпадают с теми, которые находятся в исходном экземпляре Project Web App. Дополнительные сведения об использовании Visio для создания рабочих процессов можно найти [в статье Разработка рабочих процессов в SharePoint Designer 2013 и Visio 2013](https://msdn.microsoft.com/library/jj163272%28office.15%29.aspx).
  
> [!NOTE]
> При импорте файла Visio 2013 в другой экземпляр Project Web App стадии имеют разные идентификаторы GUID этапа, даже если имена стадий совпадают. После импорта рабочего процесса необходимо настроить свойства Stage и Action для использования значений, характерных для экземпляра Project Web App. 
> 
> Если вы создаете рабочий процесс в Visio 2013, то этапы и действия не имеют свойств, характерных для экземпляра Project Web App, так как Visio не подключается к Project Web App. При подключении SharePoint Designer 2013 с Project Web App создайте рабочий процесс, а затем импортируйте VSDX-файл, чтобы перезаписать активный рабочий процесс. После этого необходимо настроить свойства Stage и Action для согласования со значениями, которые SharePoint Designer 2013 получает из Project Web App. 
  
### <a name="to-import-a-workflow-from-visio-to-sharepoint-designer"></a>Импорт рабочего процесса из Visio в SharePoint Designer

1. В Visio 2013 создайте простой рабочий процесс. Например, выполните следующие действия.
    
   1. Откройте Visio и создайте рабочий процесс. Выберите область **КАТЕГОРИИ** для нового рабочего процесса, нажмите **Блок-схема**, выберите в области **Создать** шаблон **Рабочий процесс Microsoft SharePoint 2013** и нажмите **Создать**. Рабочий процесс откроется с фигурой Stage с именем **Stage 1**. Рабочий процесс содержит компонент Start и фигуры Enter и Exit как часть фигуры Stage.
    
      Если навести указатель на фигуру Stage, то можно увидеть, что выбор значка **Свойства** отключен. Вы можете задать свойства Stage и Action после импорта схемы рабочего процесса в SharePoint Designer 2013. 
    
      > [!NOTE]
      >  Вы должны использовать только наборы элементов фигуры, которые имеются в списке фигур блок-схемы: 
      > - **Действия — рабочий процесс SharePoint 2013**
      > - **Компоненты — рабочий процесс SharePoint 2013**
      > - **Условия — рабочий процесс SharePoint 2013**
  
   2. В области **фигур** нажмите **Экспресс-фигуры**, а затем перетащите фигуру Condition с именем **Если любое значение равно указанному значению** справа от фигуры Stage. 
    
   3. На вкладке **ГЛАВНАЯ** ленты выберите инструмент **Соединитель**, а затем соедините фигуру Exit в стадии с фигурой Condition (см. рисунок 19). 
    
      **Рис. 19. Соединение фигур Stage и Condition в схеме рабочего процесса Visio**

      ![Создание схемы рабочего процесса в Visio](media/pj15_CreateWorkflowSPD_NewVisioWorkflow.gif "Создание схемы рабочего процесса в Visio")
  
   4. Перетащите еще две фигуры Stage справа от фигуры условия. Эти фигуры называются **Stage 2** и **Stage 3**.
    
   5. С помощью инструмента **Соединитель** соедините правую сторону фигуры Condition с фигурой Enter в **Stage 2**. Выберите инструмент " **указатель** ", дважды щелкните подключение, чтобы отобразить текстовое поле с именем, и назовите его "Да".
    
   6. Соедините нижнюю часть фигуры Condition с фигурой Enter в фигуре **Stage 3**. Используя инструмент **Указатель**, щелкните правой кнопкой это соединение и выберите **Нет**. Чтобы дать соединителям имя **Да** или **Нет**, сработает любой из этих способов.
    
   7. В области **фигуры** выберите **действия — рабочий процесс SharePoint 2013**, а затем перетащите действие **дождаться события проекта** в середину фигуры для **этапа 1** (см. рисунок 20). 
    
      **Рис. 20. Оформление рабочего процесса в Visio**

      ![Завершение рабочего процесса в]Visio(media/pj15_CreateWorkflowSPD_CompletedVisioWorkflow.gif "Завершение рабочего процесса в Visio")
  
   8. На вкладке **ПРОЦЕСС** ленты в группе **Проверка схемы** нажмите **Проверить схему**. Исправьте все ошибки и сохраните рисунок. Например, дайте файлу имя Тестовый рабочий процесс из Visio.vsdx.
    
      Сведения об устранении ошибок рабочего процесса приведены [в статье Устранение неполадок проверки рабочих процессов SharePoint Server 2013 в Visio 2013](https://msdn.microsoft.com/library/jj163971%28v=office.15%29.aspx).
    
2. Откройте SharePoint Designer 2013, а затем откройте тот же сайт Project Web App, который использовался для примера **рабочего процесса ветвления** . 
    
3. В области **навигации** выберите **Рабочие процессы**, а затем создайте рабочий процесс сайта (выберите **Рабочий процесс сайта** на вкладке **РАБОЧИЕ ПРОЦЕССЫ** ленты). Например, дайте рабочему процессу имя Простой рабочий процесс из Visio.
    
   В диалоговом окне **Создание рабочего процесса сайта** убедитесь, что тип платформы — **SharePoint 2013 Workflow-Project Server**. Нажмите кнопку **создать**, и SharePoint Designer открывает область **конструктора с текстовым текстом** для нового рабочего процесса. 
    
4. В группе **Управление** на вкладке **РАБОЧИЙ ПРОЦЕСС** ленты нажмите **Параметры рабочего процесса**.
    
5. В группе **Управление** на вкладке **ПАРАМЕТРЫ РАБОЧЕГО ПРОЦЕССА** ленты нажмите **Импорт в Visio**, а затем импортируйте файл **Тестовый рабочий процесс из Visio.vsdx**, созданный ранее. Диалоговое окно **Microsoft SharePoint Designer** предупреждает, что импортируемая схема не содержит свойств рабочих процессов, и спрашивает, следует ли перезаписать существующий рабочий процесс. Нажмите кнопку **Да**; SharePoint Designer импортирует схему рабочего процесса, создает наборы элементов для фигур и отображает область **визуального конструктора** , которая содержит импортированный рабочий процесс. 
    
6. Задайте свойства каждой фигуры этапа в рабочем процессе. Например, фигура первого этапа называется **Stage 1 (недопустимо)**, так как она не представляет допустимую стадию в подключенном экземпляре Project Web App. При выборе или наведении курсора на рабочую область можно выбрать значок **Свойства** в нижней левой части фигуры Stage, чтобы отобразить диалоговое окно **Свойства стадии** (см. рисунок 21). Выберите **начальную стадию сведений о предложении** в раскрывающемся списке **стадий проекта** и нажмите кнопку **ОК**. SharePoint Designer переименовывает стадию.
    
   **Рис. 21. Установка свойства стадии в SharePoint Designer**

   ![Установка свойств в импортированном](media/pj15_CreateWorkflowSPD_ImportFromVisio1.gif "рабочем процессе свойством параметров") рабочего процесса
  
   Для второй стадии установите свойство **Стадия проекта** в значение **Автоматическое отклонение**. Для третьей стадии установите свойство **Стадия проекта** в значение **Выполнение**.
    
7. Аналогично, для действия **Дождаться события проекта** установите свойство **Имя события** в значение **Событие: при отправке проекта**.
    
8. Аналогичным образом задайте для свойств условие **Если значение равно значению равно значению** . Например, задайте для свойства первое **значение** **данные проекта: стоимость предложения**. Присвойте свойству **оператора** значение **меньше**. Установите второе свойство **value** равным 5000.
    
9. Проверьте рабочий процесс на наличие ошибок, а затем сохраните его. Если ошибки отсутствуют, можно изменить представление на **Текстовый конструктор** (см. рисунок 22). 
    
   **Рис. 22. Просмотр импортированного рабочего процесса в текстовом конструкторе**

   ![Просмотр импортированного рабочего процесса]с(media/pj15_CreateWorkflowSPD_WorkflowFromVisio.gif "просмотром импортированного рабочего процесса")
  
10. Опубликуйте рабочий процесс. Если сохранить рабочий процесс, но не опубликовать его, то он не будет доступен при создании типа корпоративного проекта.
    
11. Чтобы протестировать импортированный **простой рабочий процесс из Visio** в Project Web App, создайте объект EPT, использующий рабочий процесс, а затем создайте проекты, ИСПОЛЬЗУЮЩИЕ новый EPT, как в примере для **рабочего процесса ветвления** . Однако в данном случае отклоняются проекты со стоимостью меньше $5000. 
    
Работая с этой статьей, вы создали и протестировали простой рабочий процесс ветвления с помощью SharePoint Designer 2013, чтобы напрямую задать этапы, условия и действия, используемые рабочим процессом. Вы также создали схему для еще более простого рабочего процесса ветвления с помощью Visio 2013. Вы импортировали схему рабочего процесса Visio в SharePoint Designer 2013, где вы задаете свойства каждого этапа, условия и действия из подключения к Project Web App.
  
Visio 2013 и SharePoint Designer совместно предоставляют удобные методы для разработчиков, руководителей проектов, разработчиков рабочих процессов и инженеров-испытателей для создания, совместного использования и настройки рабочих процессов для различных установок Project Server 2013 и Project Online. Для рабочих процессов, которым требуется программный доступ к Project Server, не предоставляемым SharePoint Designer, вы можете использовать Visual Studio 2012 с клиентской объектной моделью (CSOM).
  
## <a name="see-also"></a>Дополнительные ресурсы

- [Архитектура Project Server 2013](project-server-2013-architecture.md)
- [Начало: Установка и Настройка диспетчера рабочих процессов SharePoint 2013](https://msdn.microsoft.com/library/jj163276%28office.15%29.aspx)
- [Сведения о том, как упаковывать и развертывать рабочие процессы в SharePoint 2013](https://msdn.microsoft.com/library/jj819316%28office.15%29.aspx)
- [Рабочие процессы в SharePoint 2013](https://msdn.microsoft.com/library/jj163986%28office.15%29.aspx)
- [Разработка рабочих процессов в SharePoint Designer 2013 и Visio 2013](https://msdn.microsoft.com/library/jj163272%28office.15%29.aspx)
- [Устранение ошибок проверки рабочих процессов SharePoint Server 2013 в Visio 2013](https://msdn.microsoft.com/library/jj163971%28v=office.15%29.aspx)
- [Управление рабочими процессами и запросами](https://msdn.microsoft.com/library/cf7433a3-a531-4467-ac0c-df0c5d6881ae%28Office.15%29.aspx)

