---
title: Доступ к корпоративным настраиваемым полям Project Online
manager: soliver
ms.date: 11/08/2016
ms.audience: Developer
ms.assetid: 25509631-fa14-49d8-b594-cfacf5355c38
description: Project Online — это служба Office 365, возможности которой компании могут расширить, чтобы удовлетворить свои бизнес-потребности. Одна из областей расширения — корпоративные настраиваемые поля (ECF). Они представляют собой поля со значениями типов, которые можно добавлять к проектам, ресурсам и задачам. В приведенной ниже таблице перечислены корпоративные настраиваемые поля, которые можно связать с проектами, ресурсами и задачами, а также примеры значений для соответствующих экземпляров этих полей.
localization_priority: Priority
ms.openlocfilehash: 9f754f1446890ae021bf6f7000ffba11e2a2df33
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32355085"
---
# <a name="accessing-project-online-enterprise-custom-fields"></a>Доступ к корпоративным настраиваемым полям Project Online

Project Online — это служба Office 365, возможности которой компании могут расширить, чтобы удовлетворить свои бизнес-потребности. Одна из областей расширения — корпоративные настраиваемые поля (ECF). Они представляют собой поля со значениями типов, которые можно добавлять к проектам, ресурсам и задачам. В приведенной ниже таблице перечислены корпоративные настраиваемые поля, которые можно связать с проектами, ресурсами и задачами, а также примеры значений для соответствующих экземпляров этих полей.
  
|Имя поля ECF|Тип поля ECF|Связь|Пример значения|
|:-----|:-----|:-----|:-----|
|Обоснование  <br/> |TEXT  <br/> |Проект  <br/> |Пользователь может записать ключевые данные о статистике и работоспособности с результатами, которые включают оценку работоспособности и персонализированный план действий, направленный на улучшение работоспособности.  <br/> |
|Оценка рисков  <br/> |TEXT  <br/> |Проект  <br/> |Низкая  <br/> |
|Рентабельность инвестиций  <br/> |NUMBER  <br/> |Проект  <br/> |2,10  <br/> |
|Общие затраты  <br/> |COST  <br/> |Проект  <br/> |1 031 514 долл. США  <br/> |
|Ответственные за выпуск  <br/> |TEXT  <br/> |Ресурсы  <br/> |Да  <br/> |
|Роль должности  <br/> |TEXT  <br/> |Ресурсы  <br/> |Тест-инженер  <br/> |
|Состояние флага  <br/> |FLAG  <br/> |Задача  <br/> |Нет  <br/> |
|Работоспособность  <br/> |TEXT  <br/> |Задача  <br/> |Не указано  <br/> |
   
Корпоративные настраиваемые поля определяются в экземпляре веб-приложения Project (PWA), который является внешним по отношению к любому проекту, ресурсу или задаче. Их все же можно связать с проектом, ресурсом или задачей. В этой статье представлено вводное описание настраиваемых полей на примере приложения, а также подробно рассматривается, как извлечь значения корпоративных настраиваемых полей. 
  
Готовый пример можно скачать здесь: https://github.com/OfficeDev/Project-CSOM-Read-Enterprise-CustomFields.
  
Кроме того, Project Online поддерживает локальные настраиваемые поля в качестве доступных только для чтения сущностей, характерных для конкретного проекта, ресурса или задачи. Дополнительные сведения о локальных настраиваемых полях см. в примере по адресу https://github.com/OfficeDev/Project-CSOM-Read-Local-CustomFields\.
  
## <a name="background-materials"></a>Материалы с общими сведениями

В предыдущей статье [Разработка приложений для Project Online с помощью клиентской объектной модели](developing-a-project-online-application-using-the-client-side-object-model.md) представлены общие сведения о начале разработки приложений с помощью модели CSOM. Обратитесь к этой статье, чтобы получить следующую информацию:
  
- общие сведения о Project, а также автономных и облачных выпусках; 
    
- сведения о среде разработки (выпуски Visual Studio и библиотеки программного обеспечения);
    
- сведения о настройке проекта Visual Studio для приложения .NET с помощью библиотеки CSOM;
    
- сведения о подключении к службе Project Online.
    
## <a name="preliminaries-class-level-declarations"></a>Предварительные компоненты (объявления на уровне классов)

Класс для этого приложения определяет два элемента данных: контекст проекта и словарь pwaECF.
  
Объект контекста проекта входит в модель CSOM Project и подключает приложение к экземпляру PWA. Контекст проекта используется во всех запросах к службе.
  
```cs
private static ProjectContext projContext = 
     new ProjectContext("https://Contoso216.sharepoint.com/sites/pwa");

```

Для создания экземпляра в приложении контексту требуется конечная точка подключения. Конечная точка подключения представляет собой URL-адрес экземпляра PWA. 
  
Словарь pwaECF сохраняет корпоративные настраиваемые поля проекта, определенные на уровне PWA. Словарь использует ECF.InternalName в качестве ключа, а объект CustomField — в качестве значения. Словарь заполняется в методе ListPWACustomFields, а затем используется в качестве ссылки в методе Main. 
  
```cs
    //Dictionary of ECFs
        static Dictionary<String, CustomField> pwaECF = new Dictionary<string, CustomField>();

```

## <a name="main-method"></a>Метод Main

Метод Main управляет блок-схемой приложения. Как и другие приложения, в которых используется модель CSOM Project Online, метод Main инициализирует контекст проекта. 
  
1. Извлечение и перечисление корпоративных настраиваемых полей в PWA Project Online.
    
   Эта функция реализована в методе ListPWACustomFields.
    
2. Извлечение проектов с настраиваемыми и ненастраиваемыми полями.
    
   Для извлечения проектов с корпоративными настраиваемыми полями запрос в службу Project Online должен включать следующие элементы: 
    
   - **IncludeCustomFields.** Этот элемент отправляет в службу запрос на возврат коллекции PublishedProjects, в которой каждый опубликованный проект включает расширение, поддерживающее настраиваемые поля. Если этот элемент не указан, Project Online возвращает объекты PublishedProject, которые не содержат данных настраиваемых полей.
    
   - **IncludeCustomFields.CustomFields.** Этот элемент отправляет в службу запрос на заполнение объектов PublishedProject данными CustomFields.
    
   Приведенный ниже запрос задает идентификатор и имя проекта, а также расширение объекта для настраиваемых полей и их значений.
    
   ```cs
        var projBlk = projContext.LoadQuery(
        projContext.Projects.Include(
            p => p.Id, 
            p => p.Name,
            p => p.IncludeCustomFields,
            p => p.IncludeCustomFields.CustomFields
        ));
    
   ```

3. Проверка каждого проекта.
    
   Объекты проектов, используемые в этом приложении, имеют тип PublishedProject, так как значения извлекаются и отображаются. 
    
   Если вам нужно обновить значения данных в одном или нескольких проектах, обновляемый проект необходимо извлечь. Затем приложение с помощью объекта DraftProject извлечет значения и обновит проект.
    
4. Получение доступа к записям корпоративных настраиваемых полей для проекта.
    
   Каждый экземпляр корпоративного настраиваемого поля отделяет значение поля от других сведений корпоративного настраиваемого поля. Значение поля сохраняется как часть пары "ключ-значение". Остальные сведения сохраняются в объекте CustomField.
    
   Получение доступа к значениям корпоративных настраиваемых полей выполняется в два этапа:
    
   - циклический просмотр коллекции CustomFields;
    
   - получение доступа к нужной записи с использованием двух конструкций.
    
   Каждый проект сохраняет связанные записи корпоративных настраиваемых полей в двух расположениях: в перечисляемой коллекции CustomFields и в значениях полей в составе пар "ключ-значение". В парах "ключ-значение" ключом является internalName, а значением — значение поля. Для сохранения значений полей и доступа к ним используйте словарь. 
    
   Свойства корпоративных настраиваемых полей, отличные от значений полей, хранятся в объектах CustomField (по одному объекту на проект). Используйте коллекцию CustomFields, чтобы получить доступ к корпоративным настраиваемым полям, связанным с отдельным проектом. 
    
5. В каждом проекте связанные корпоративные настраиваемые поля хранятся в коллекции, в которой каждая запись корпоративного настраиваемого поля состоит из ключа (внутреннего имени этого поля) и объекта, в котором хранится значение корпоративного настраиваемого поля. Перенесите коллекцию в словарь, чтобы получить доступ к отдельным записям. Ниже представлено соответствующее объявление.
    
   ```cs
    Dictionary<string, object> projDict = pubProj.IncludeCustomFields.FieldValues;
    
   ```

   Значение в записи словаря соответствует типу данных корпоративного настраиваемого поля. Объект для каждого корпоративного настраиваемого поля сопоставляется с одним из множества типов. В большинстве корпоративных настраиваемых полей используются простые типы, поддерживающие стандартные переменные. В следующем фрагменте показано, что использование нескольких типов подразумевает обработку в минимальном объеме:
    
   ```cs
    switch (cf.FieldType)
    {
        case CustomFieldType.COST:
            decimal costValue = (decimal)oVal;
            Console.WriteLine("\tFieldType:\t{0}\n\tValue:\t{1}", cf.FieldType, 
                costValue.ToString("C"));
            break;
        case CustomFieldType.DATE:
            Console.WriteLine("\tFieldType:\t{0}\n\tValue:\t{1}", cf.FieldType, 
                oVal.ToString());
            break;
        case CustomFieldType.FINISHDATE:
            Console.WriteLine("\tFieldType:\t{0}\n\tValue:\t{1}", cf.FieldType, 
                oVal.ToString());
            break;
        case CustomFieldType.DURATION:
            Console.WriteLine("\tFieldType:\t{0}\n\tValue:\t{1}", cf.FieldType, 
                oVal.ToString());
            break;
        case CustomFieldType.FLAG:
            Console.WriteLine("\tFieldType:\t{0}\n\tValue:\t{1}", cf.FieldType, 
                oVal.ToString());
            break;
        case CustomFieldType.NUMBER:
            Console.WriteLine("\tFieldType:\t{0}\n\tValue:\t{1}", cf.FieldType, 
                oVal.ToString());
            break;
    
   ```

   Однако для таблицы подстановки значений TEXT требуется дополнительная обработка. Приложение извлекает соответствующую таблицу подстановки из службы и выводит экземпляр корпоративного настраиваемого поля (с одним или несколькими значениями) путем обхода таблицы подстановки. В приведенном ниже фрагменте кода показано, как обрабатываются корпоративные настраиваемые поля типа TEXT, в том числе поля с простыми значениями и поля, в которых используются таблицы подстановки. 
    
   ```cs
    case CustomFieldType.TEXT:
        if (!cf.LookupTable.ServerObjectIsNull.HasValue ||
            (cf.LookupTable.ServerObjectIsNull.HasValue && 
            cf.LookupTable.ServerObjectIsNull.Value))
        { //No lookup table
            Console.WriteLine("\tFieldType:\t{0}\n\tText:\t{1}", cf.FieldType, 
                oVal.ToString());
        }
        else
        { //Lookup table
            Console.WriteLine("\tFieldType:\t{0} - using Lookup Table", cf.FieldType);
            String[] entries = (String[])oVal;
            foreach (String entry in entries)
            {
                var luEntry = projContext.LoadQuery(cf.LookupTable.Entries
                    .Where(e => e.InternalName == entry));
                projContext.ExecuteQuery();
                Console.WriteLine("\tLookup Value:\t{0}", luEntry.First().FullValue);  
            }
        }
        break;
    
   ```

   Это приложение просто выводит значения. Однако с помощью значений данных можно получить и другие данные.
    
## <a name="listpwacustomfields"></a>ListPWACustomFields

Метод ListPWACustomFields извлекает и перечисляет корпоративные настраиваемые поля, связанные с проектами. Этот метод перечисляет корпоративные настраиваемые поля, зарегистрированные в экземпляре PWA, которые можно связать с отдельными проектами. В точке входа для доступа к корпоративным настраиваемым полям используется элемент CustomFields контекста проекта, как показано на примере следующего запроса:
  
```cs
// Project ECFs
    var allECFields = 
            projContext.LoadQuery(projContext.CustomFields.Include(
            qp => qp.InternalName,
            qp => qp.Name
        ));
    projContext.ExecuteQuery();

```

Этот метод не позволяет проверить, используется ли в проекте определенное корпоративное настраиваемое поле.
  
## <a name="see-also"></a>См. также

- [Портал разработки для Project](https://developer.microsoft.com/ru-RU/project)
- 
  [Обзор: корпоративные настраиваемые поля и таблицы подстановки](https://support.office.com/en-us/article/overview-enterprise-custom-fields-and-lookup-tables-f99db553-0b33-4648-93c0-f6a74637d790?ui=en-us&rs=en-us&ad=us)
- [Локальные и корпоративные настраиваемые поля](https://msdn.microsoft.com/library/office/ms447495(v=office.14).aspx)
- [Добавление и редактирование корпоративных настраиваемых полей в Project Server 2013](https://docs.microsoft.com/project/add-or-edit-enterprise-custom-fields-in-project-server)
    

