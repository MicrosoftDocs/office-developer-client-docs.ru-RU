---
title: Массовое обновление настраиваемой поля и создание сайтов проектов в Project Online
manager: soliver
ms.date: 08/10/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: 815131c6-190c-4f29-83bf-c853eee72821
description: Чтобы помочь клиентам использовать Project Online и улучшить возможности и гибкость служб, мы добавили два метода в клиентскую объектную модель, которые можно использовать в приложениях и бизнес-процессах Project Online.
ms.openlocfilehash: 4de42471cd8c2f12a982447ccffc27ec8104fa31
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32355422"
---
# <a name="bulk-update-custom-fields-and-create-project-sites-from-a-workflow-in-project-online"></a>Пакетное обновление настраиваемых полей и создание сайтов проектов из рабочего процесса в Project Online

Чтобы помочь клиентам использовать Project Online и улучшить возможности и гибкость службы, мы добавили два метода в клиентскую объектную модель, которые можно использовать в приложениях и бизнес-процессах Project Online.
  
|||
|:-----|:-----|
|**UpdateCustomFields** <br/> |Массовое обновление настраиваемой области проекта. Только для Project Online. Доступно только в REST API.  <br/> |
|**CreateProjectSite** <br/> | Создает сайт проекта. Только для Project Online. Доступно в REST API, управляемой клиентской объектной модели и клиентской объектной модели JavaScript.  <br/> |
   
Помимо повышения гибкости эти методы также обеспечивают значительное повышение производительности при сохранении и публикации проектов в рабочий процесс. В этой статье описано, как использовать методы в API REST, а также инструкции по созданию рабочего процесса, который массово обновляет настраиваемые поля, и рабочего процесса, который создает сайт Проекта.
  
> [!NOTE]
> Чтобы узнать больше о вызове REST API из sharePoint 2013 рабочего процесса, см. использование [служб REST SharePoint](https://mysharepointinsight.blogspot.com/2013/05/using-sharepoint-rest-services-from.mdl) из рабочего процесса с методом POST и вызов [Rest API SharePoint 2013](https://sergeluca.wordpress.com/2013/04/09/calling-the-sharepoint-2013-rest-api-from-a-sharepoint-designer-workflow/)из рабочего процесса SharePoint Designer . 
  
## <a name="bulk-update-project-custom-fields-from-a-workflow"></a>Массовое обновление настраиваемой поля проекта из рабочего процесса
<a name="BulkUpdateCustomFields"> </a>

Ранее рабочий процесс мог обновлять только одно настраиваемые поля за раз. Обновление настраиваемого поля проекта по одному может привести к плохому пользовательскому интерфейсу при переходе пользователей между страницами подробных данных проекта. Для каждого обновления требовался отдельный запрос сервера с помощью действия "Настройка поля проекта", а обновление нескольких настраиваемых полей в сети с высокой задержкой с низкой пропускной способностью привело к нестандартным затратам.  Чтобы устранить эту проблему, мы добавили метод **UpdateCustomFields** в REST API, который позволяет массово обновлять настраиваемые поля. Чтобы использовать **UpdateCustomFields,** необходимо передать словарь, содержащий имена и значения всех настраиваемые поля, которые необходимо обновить.
  
Метод REST можно найти в следующей конечной точке:
  
`https://<site-url>/_api/ProjectServer/Projects('<guid>')/Draft/UpdateCustomFields()`
  
> [!NOTE]
> Замените замещатель в примерах URL-адресом сайта Project Web App (PWA) и замещать на  `<site-url>`  `<guid>` UID проекта. 
  
В этом разделе описывается создание рабочего процесса, который массово обновляет настраиваемые поля для проекта. Рабочий процесс следует следующим высокоуровневым шагам:
  
- Подождите, пока проект, который вы хотите обновить, не будет вернуться
    
- Создание набора данных, который определяет все обновления настраиваемой области для проекта
    
- Ознакомьтесь с проектом
    
- Вызов **UpdateCustomFields** для применения обновлений настраиваемой области к проекту 
    
- Занося соответствующие сведения в список журнала рабочего процесса (при необходимости)
    
- Публикация проекта
    
- Регистрация проекта
    
Конечный, конечный рабочий процесс выглядит так:
  
![Рабочий процесс]"от конца до(media/8c0741f9-7f76-409d-8c00-e7a8c3ddb89f.png "конца\"")
  
### <a name="to-create-a-workflow-that-bulk-updates-custom-fields"></a>Создание рабочего процесса, который массово обновляет настраиваемые поля

1. Необязательный параметр. Храните полный URL-адрес проекта в переменной, которую можно использовать в рамках рабочего процесса.
    
    ![Сохранить URL-адрес проекта в переменной,](media/a880c5c6-8e7a-44dd-87e9-7e532169d489.png "храня URL-адрес проекта в переменной")
  
2. Добавьте действие **"Ожидание** события проекта" в рабочий процесс и выберите **"Когда проект зарегистрирован в** событии". 
    
    ![Дождись, пока проект не будет зарегистрирован,]дождись его(media/699aa9c7-b3c9-426e-a775-96993a13559c.png "регистрации.")
  
3. Создайте **словарь requestHeader** с помощью действия **"Создание словаря".** Для всех вызовов веб-служб в этом рабочий процесс будет применяться один и тот же заголовщик запросов. 
    
    ![Создание словаря requestHeader.](media/83b0aa10-9ab7-43dd-800d-a738bb815876.png "Создание словаря requestHeader")
  
4. Добавьте в словарь следующие два пункта.
    
    |Имя|Тип|Значение|
    |:-----|:-----|:-----|
    |Accept  <br/> |String  <br/> |application/json; odata=verbose  <br/> |
    |Content-Type  <br/> |String  <br/> |application/json; odata=verbose  <br/> |
   
    ![Добавление заголала accept](media/2f2e2016-3c49-4cac-b1e7-f2b8118b840c.png "Adding an Accept header")
  
5. Создайте **словарь requestBody** с помощью действия **"Создать словарь".** В этом словаре хранится все обновления полей, которые необходимо применить. 
    
    Для каждого обновления настраиваемого поля требуется четыре строки: тип метаданных поля (1), ключ (2), (3) значение и (4) тип значения.
    
    - **__metadata/type** Тип метаданных поля. Эта запись всегда является одинаковой и использует следующие значения: 
    
       - Имя: customFieldDictionary(i)/__metadata/type (где **i** — индекс каждого настраиваемого поля в словаре, начиная с 0) 
            
       - Тип: строка
            
       - Значение: SP. KeyValue
    
       ![Определение обновления настраиваемой поля](media/a4423493-6603-42ee-ae50-1ef74c5c59bd.png "Определение обновления настраиваемой поля")
  
    - **Ключ** Внутреннее имя настраиваемого поля в формате: *Custom_ce23fbf43fa0e411941000155d3c8201* 
    
       Чтобы найти внутреннее имя настраиваемого поля, перейдите к его конечной точке **InternalName:**`https://<site-url>/_api/ProjectServer/CustomFields('<guid>')/InternalName`
    
       Если вы создали настраиваемые поля вручную, значения будут отличаться от сайта к сайту. Если вы планируете повторно использовать рабочий процесс на нескольких сайтах, убедитесь в правильности пользовательских полей.
    
    - **Значение** Значение, назначаемые настраиваемом полю. Для настраиваемого поля, связанного с таблицами подсмотра, необходимо использовать внутренние имена записей таблицы подсмотра, а не фактические значения таблицы подсмотра. 
    
       Внутреннее имя записи таблицы подкачек можно найти в следующей конечной точке: `https://<site-url>/_api/ProjectServer/CustomFields('<guid>')/LookupEntries('<guid>')/InternalName`
    
       Если для настраиваемого поля таблицы подстроки настроено принятие нескольких значений, используйте их для конкатета (как показано в примере  `;#` словаря ниже). 
    
    - **ValueType** Тип обновляемого настраиваемого поля. 
    
       - Для полей Text, Duration, Flag и LookupTable используйте Edm.String
    
       - Для полей Number используйте Edm.Int32, Edm.Double или любой другой тип номера, принятый OData
    
       - Для полей Date используйте Edm.DateTime
    
       В приведенном ниже примере словаря определены обновления для трех настраиваемого поля. Первый — для настраиваемого поля таблицы подкатки с несколькими значениями, второй — для численного поля, а третий — для поля даты. Обратите внимание на то, как приращение индекса **customFieldDictionary.** 
    
       > [!NOTE]
       > Эти значения являются исключительно иллюстрациями. Пары "ключ-значение", которые вы будете использовать, зависят от данных PWA. 
  
       |Имя|Тип|Значение|
       |:-----|:-----|:-----|
       |customFieldDictionary(0)/__metadata/type  <br/> |String  <br/> |SP. KeyValue  <br/> |
       |customFieldDictionary(0)/Key  <br/> |String  <br/> |Custom \_ ce23fbf43fa0e411941000155d3c8201  <br/> |
       |customFieldDictionary(0)/Value  <br/> |String  <br/> |Запись \_ b9a2fd69279de411940f00155d3c8201;#Entry \_ baa2fd69279de411940f00155d3c8201  <br/> |
       |customFieldDictionary(0)/ValueType  <br/> |String  <br/> |Edm.String  <br/> |
       |customFieldDictionary(1)/__metadata/type  <br/> |String  <br/> |SP. KeyValue  <br/> |
       |customFieldDictionary(1)/Key  <br/> |String  <br/> |Custom_c7f114c97098e411940f00155d3c8201  <br/> |
       |customFieldDictionary(1)/Value  <br/> |String  <br/> |90.5  <br/> |
       |customFieldDictionary(1)/ValueType  <br/> |String  <br/> |Edm.Double  <br/> |
       |customFieldDictionary(2)/__metadata/type  <br/> |String  <br/> |SP. KeyValue  <br/> |
       |customFieldDictionary(2)/Key  <br/> |String  <br/> |Custom_c6fb67e0b9a1e411941000155d3c8201  <br/> |
       |customFieldDictionary(2)/Value  <br/> |String  <br/> |2015-04-01T00:00:00.0000000  <br/> |
       |customFieldDictionary(2)/ValueType  <br/> |String  <br/> |Edm.DateTime  <br/> |
   
       ![Словарь, определяемый словарем обновлений настраиваемого]поля, который(media/41a1f18f-a6b2-40ff-904b-437baf962621.png "определяет обновления настраиваемого поля")
  
6. Добавьте действие **"Вызов веб-службы HTTP",** чтобы проверить проект. 
    
    ![Вызов метода Checkout](media/8ce56014-0317-419b-afa7-229d05c86885.png "Call the Checkout")
  
7. Изменение свойств вызова веб-службы для указания загона запроса. Чтобы открыть **диалоговое окно** "Свойства", щелкните правой кнопкой мыши действие и выберите **"Свойства".**
    
    ![Указание заголала запроса в]свойствах вызова веб-службы. Укажите заглавную страницу запроса в свойствах(media/d81e92b1-43df-42ad-9cd0-a693f93b164e.png "вызова веб-службы")
  
8. Добавьте действие **"Вызов веб-службы HTTP"** для вызова метода **UpdateCustomFields.** 
    
    ![Создание действия "Вызов веб-службы HTTP"](media/9a73a201-c035-41b4-8798-506ac48b90f8.png "Создание действия \"Вызов веб-службы HTTP\"")
  
    Обратите внимание  `/Draft/` на сегмент в URL-адресе веб-службы. Полный URL-адрес должен выглядеть так: `https://<site-url>/_api/ProjectServer/Projects('<guid>')/Draft/UpdateCustomFields()`
    
    ![Вызов метода UpdateCustomFields](media/03b323f1-8e99-4b18-be18-be505d7cec7e.png "Вызов метода UpdateCustomFields")
  
9. Изменение свойств вызова веб-службы для привязки параметров **RequestHeader** и **RequestContent** к созданным словарям. Вы также можете создать новую переменную для хранения **ResponseContent.**
    
    ![Привязка словарей к загоду]запроса и контенту Привязывать словари(media/f96bec92-138e-4eab-b1e7-1ab83d0428a5.png "к загоду запроса и содержимому")
  
10. Необязательный параметр. Прочитайте словарь ответов, чтобы проверить состояние задания в очереди и зайти в журнал рабочего процесса.
    
    ![Настройка ведения журнала](media/7d2f4936-61d7-4906-83e8-7478a5935af5.png "Настройка ведения журнала")
  
11. Добавьте вызов веб-службы в конечную **точку публикации** для публикации проекта. Всегда используйте один и тот же заголок запроса. 
    
    ![Вызов метода Publish](media/3b661091-ffae-4d7e-a0bb-5b96a6292731.png "Call the Publish")
  
    ![Свойства вызова веб-службы публикации](media/6a80a5d3-7e29-4398-993c-f78b3faca8b1.png "для вызова веб-службы публикации")
  
12. Добавьте окончательный вызов веб-службы в конечную точку **checkin,** чтобы проверить проект. 
    
    ![Вызов метода Checkin](media/430510cb-0774-4911-af7f-b565b83eba0e.png "Call the Checkin method")
  
    ![Свойства вызова веб-службы checkin](media/485f48d6-bbb8-4568-9dc3-aae3218f6bd1.png "Properties для вызова веб-службы checkin")

<a name="CreateProjectSite"> </a>

## <a name="create-a-project-site-from-a-workflow"></a>Создание сайта проекта из рабочего процесса

Каждый проект может иметь собственные выделенные сайты SharePoint, где участники группы могут совместно работать, обмениваться документами, выдавать проблемы и так далее. Ранее сайты могли создаваться автоматически только при первой публикации или вручную руководителем проекта в Project профессиональный или администратором в параметрах PWA, или их можно было отключить.
  
Мы добавили метод **CreateProjectSite,** чтобы вы могли выбрать, когда создавать сайты проектов. Это особенно полезно для организаций, которые хотят автоматически создавать свои сайты, когда предложение проекта достигает определенной стадии предварительно определенного рабочего процесса, а не при первой публикации. Откладывание создания сайта проекта значительно повышает производительность при создании проекта. 
  
**Необходимые условия:** Перед использованием **CreateProjectSite**  параметр "Разрешить пользователям выбирать параметры" должен быть установлен для создания сайта проекта в параметрах **PWA** > ** Подключенные сайты SharePoint ** > **Параметры**.
  
![Параметр "Разрешить пользователям выбирать" в]параметрах PWA позволяет пользователям выбирать параметры(media/6c6c8175-eb10-431d-8056-cea55718fdb4.png "PWA")
  
### <a name="to-create-a-workflow-that-creates-a-project-site"></a>Создание рабочего процесса, который создает сайт Проекта

1. Создайте или отредактируете существующий рабочий процесс и выберите этап создания сайтов Project.
    
2. Создайте **словарь requestHeader** с помощью действия **"Создание словаря".** 
    
    ![Создание словаря requestHeader.](media/83b0aa10-9ab7-43dd-800d-a738bb815876.png "Создание словаря requestHeader")
  
3. Добавьте в словарь следующие два пункта.
    
    |Имя|Тип|Значение|
    |:-----|:-----|:-----|
    |Accept  <br/> |String  <br/> |application/json; odata=verbose  <br/> |
    |Content-Type  <br/> |String  <br/> |application/json; odata=verbose  <br/> |
   
    ![Добавление заголала accept](media/2f2e2016-3c49-4cac-b1e7-f2b8118b840c.png "Adding an Accept header")
  
4. Добавьте действие **"Вызов веб-службы HTTP".** Измените тип запроса на использование **POST** и заведите URL-адрес в следующем формате:
    
    `https://<site-url>/_api/ProjectServer/Projects('<guid>')/CreateProjectSite('New web name')`
    
    ![Создание URI конечной точки CreateProjectSite,]создав URI конечной(media/42a90a5e-8d1b-4667-a933-785175212847.png "точки CreateProjectSite")
  
    Передайте имя сайта Проекта методу **CreateProjectSite** в качестве строки. Чтобы использовать имя проекта в качестве имени сайта, передав пустую строку. Используйте уникальные имена, чтобы следующий сайт проекта работал. 
    
5. Изменение свойств вызова веб-службы для привязки **параметра RequestHeader** к созданному словарю. 
    
    ![Привязка словаря к запросу](media/61a5a0a8-405f-44eb-b5e7-80b11f7caec3.png "Привязка словаря к запросу")
  
## <a name="see-also"></a>См. также

- [Задачи программирования Project](project-programming-tasks.md)
- [Клиентская объектная модель (CSOM) для Project 2013](client-side-object-model-csom-for-project-2013.md)
- [Рабочие процессы в SharePoint 2013](https://msdn.microsoft.com/library/e0602371-ae22-44be-8a7e-9e47e9f046d6%28Office.15%29.aspx)
    

