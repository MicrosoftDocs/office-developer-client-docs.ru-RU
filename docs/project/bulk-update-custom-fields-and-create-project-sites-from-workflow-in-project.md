---
title: Массовое обновление настраиваемых полей и создание сайтов проектов в Project Online
manager: soliver
ms.date: 08/10/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: 815131c6-190c-4f29-83bf-c853eee72821
description: Чтобы помочь клиентам максимально эффективно использовать Project Online и повысить расширяемость и гибкость службы, мы добавили два метода в клиентскую объектную модель, которую можно использовать в приложениях Project Online и рабочих процессах.
ms.openlocfilehash: 4de42471cd8c2f12a982447ccffc27ec8104fa31
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32355422"
---
# <a name="bulk-update-custom-fields-and-create-project-sites-from-a-workflow-in-project-online"></a>Пакетное обновление настраиваемых полей и создание сайтов проектов из рабочего процесса в Project Online

Чтобы помочь клиентам максимально эффективно использовать Project Online и повысить расширяемость и гибкость службы, мы добавили два метода в клиентскую объектную модель, которую можно использовать в приложениях Project Online и рабочих процессах.
  
|||
|:-----|:-----|
|**Упдатекустомфиелдс** <br/> |Массовое обновление настраиваемых полей проекта. Только для Project Online. Доступно только в REST API.  <br/> |
|**CreateProjectSite** <br/> | Создает сайт проекта. Только для Project Online. Доступно в REST API, управляемой клиентской объектной модели и клиентской объектной модели JavaScript.  <br/> |
   
В дополнение к обеспечению большей гибкости эти методы также обеспечивают значительное улучшение производительности при сохранении и публикации проектов в рабочем процессе. В этой статье описывается, как использовать методы в REST API и приведены инструкции по созданию рабочего процесса, который обновляет настраиваемые поля и рабочий процесс, который создает сайт проекта.
  
> [!NOTE]
> Чтобы узнать больше о вызовах REST API из рабочих процессов SharePoint 2013, ознакомьтесь со статьей [Использование служб REST SharePoint из рабочего процесса с методом POST](https://mysharepointinsight.blogspot.com/2013/05/using-sharepoint-rest-services-from.mdl) и [вызов REST API SharePoint 2013 из рабочего процесса SharePoint Designer](https://sergeluca.wordpress.com/2013/04/09/calling-the-sharepoint-2013-rest-api-from-a-sharepoint-designer-workflow/). 
  
## <a name="bulk-update-project-custom-fields-from-a-workflow"></a>Массовое обновление настраиваемых полей проекта из рабочего процесса
<a name="BulkUpdateCustomFields"> </a>

Ранее рабочие процессы могли обновлять только одно настраиваемое поле за раз. Одновременное обновление настраиваемых полей проекта может привести к плохому взаимодействию с конечным пользователем при переходе пользователей между страницами сведений о проекте. Каждое обновление требует отдельного запроса к серверу с помощью действия " **задать поле проекта** " и обновления нескольких настраиваемых полей в сети с низкой задержкой, которая привела к нетривиальной накладной. Чтобы устранить эту проблему, мы добавили метод **упдатекустомфиелдс** в REST API, который позволяет массово обновлять настраиваемые поля. Чтобы использовать **упдатекустомфиелдс**, передается словарь, содержащий имена и значения всех настраиваемых полей, которые необходимо обновить.
  
Метод REST можно найти в следующей конечной точке:
  
`https://<site-url>/_api/ProjectServer/Projects('<guid>')/Draft/UpdateCustomFields()`
  
> [!NOTE]
> Замените `<site-url>` заполнитель в ПРИМЕРах URL-адресом сайта Project Web App (PWA) и `<guid>` местозаполнителем проекта UID. 
  
В этом разделе описывается создание рабочего процесса, который выполняет массовое обновление настраиваемых полей для проекта. Рабочий процесс соответствует следующим высокоуровневый процедуре:
  
- Подождите, пока проект, который требуется обновить, будет возвращен
    
- Создание набора данных, определяющего все обновления настраиваемых полей для проекта
    
- Извлечение проекта
    
- Вызов **упдатекустомфиелдс** для применения обновлений настраиваемых полей к проекту 
    
- Запись релевантных сведений в список журнала рабочего процесса (если требуется)
    
- Публикация проекта
    
- Возврат проекта
    
Конечный рабочий процесс выглядит следующим образом:
  
![Сквозной рабочий процесс] (media/8c0741f9-7f76-409d-8c00-e7a8c3ddb89f.png "Сквозной рабочий процесс")
  
### <a name="to-create-a-workflow-that-bulk-updates-custom-fields"></a>Создание рабочего процесса, который выполняет массовое обновление настраиваемых полей

1. Необязательный атрибут. Сохраните полный URL-адрес проекта в переменной, которую можно использовать в рабочем процессе.
    
    ![Сохранение URL-адреса проекта в переменной] (media/a880c5c6-8e7a-44dd-87e9-7e532169d489.png "Сохранение URL-адреса проекта в переменной")
  
2. Добавьте действие **ДождатьСя события проекта** в рабочий процесс и выберите **при возврате проекта** событие. 
    
    ДоЖдитесь, ![пока проект будет возвращен] ДоЖдитесь, (media/699aa9c7-b3c9-426e-a775-96993a13559c.png "пока проект будет возвращен")
  
3. Создайте словарь **рекуессеадер** с помощью действия " **Построение словаря** ". Вы будете использовать один и тот же заголовок запроса для всех вызовов веб-служб в этом рабочем процессе. 
    
    ![Создание словаря рекуессеадер] (media/83b0aa10-9ab7-43dd-800d-a738bb815876.png "Создание словаря рекуессеадер")
  
4. Добавьте в словарь следующие два элемента:
    
    |Имя|Тип|Значение|
    |:-----|:-----|:-----|
    |Accept  <br/> |Строка  <br/> |приложение/JSON; OData = verbose  <br/> |
    |Content-Type  <br/> |Строка  <br/> |приложение/JSON; OData = verbose  <br/> |
   
    ![Добавление заголовка Accept] (media/2f2e2016-3c49-4cac-b1e7-f2b8118b840c.png "Добавление заголовка Accept")
  
5. Создайте словарь **рекуестбоди** с помощью действия " **Построение словаря** ". В этом словаре хранятся все обновления полей, которые требуется применить. 
    
    Каждое обновление настраиваемого поля требует четыре строки: тип метаданных поля (1), (2), (3), а также (4) тип значения.
    
    - **__метадата/тип** Тип метаданных поля. Эта запись всегда одинакова и использует следующие значения: 
    
       - Name: Кустомфиелддиктионари (i)/__метадата/типе (где **i** это индекс каждого настраиваемого поля в словаре, начиная с 0) 
            
       - Тип: String
            
       - Значение: SP. Ключзначение
    
       ![Определение обновления настраиваемого поля] (media/a4423493-6603-42ee-ae50-1ef74c5c59bd.png "Определение обновления настраиваемого поля")
  
    - **Key (ключ** ) Внутреннее имя настраиваемого поля в формате: *Custom_ce23fbf43fa0e411941000155d3c8201* . 
    
       Внутреннее имя настраиваемого поля можно найти, перейдя к конечной точке **internalname —** .`https://<site-url>/_api/ProjectServer/CustomFields('<guid>')/InternalName`
    
       Если настраиваемые поля созданы вручную, значения будут отличаться от "сайт" до "сайт". Если вы планируете повторно использовать рабочий процесс на нескольких сайтах, убедитесь, что идентификаторы настраиваемых полей указаны правильно.
    
    - **Value (значение** ) Значение, присваиваемое настраиваемому полю. Для настраиваемых полей, связанных с таблицами подстановки, необходимо использовать внутренние имена записей таблицы подстановки вместо фактических значений таблицы подстановки. 
    
       Внутреннее имя записи таблицы подстановки можно найти на следующей конечной точке:`https://<site-url>/_api/ProjectServer/CustomFields('<guid>')/LookupEntries('<guid>')/InternalName`
    
       Если вы настроили настраиваемое поле таблицы подстановки, чтобы принимать несколько `;#` значений, используйте для сцепления значений (как показано в примере ниже). 
    
    - **ValueType** Тип обновляемого настраиваемого поля. 
    
       - Для полей Text, Duration, Flag и LookupTable используйте модель EDM. String.
    
       - Для числовых полей используйте модель EDM. Int32, EDM. Double или любой другой тип кода, поддерживаемый OData
    
       - Для полей даты используйте модель EDM. DateTime
    
       Приведенный ниже пример словаря определяет обновления трех настраиваемых полей. Первый — для настраиваемого поля таблицы подстановки с несколькими значениями, второй — для числового поля, а третья — для поля даты. Обратите внимание на то, как индекс **кустомфиелддиктионари** увеличивается. 
    
       > [!NOTE]
       > Эти значения предназначены только для наглядности. Используемые пары "ключ — значение" зависят от данных PWA. 
  
       |Имя|Тип|Значение|
       |:-----|:-----|:-----|
       |Кустомфиелддиктионари (0)/__метадата/типе  <br/> |Строка  <br/> |Состав. Ключзначение  <br/> |
       |Кустомфиелддиктионари (0)/Кэй  <br/> |Строка  <br/> |Настраиваемые\_ce23fbf43fa0e411941000155d3c8201  <br/> |
       |Кустомфиелддиктионари (0)/Валуе  <br/> |Строка  <br/> |Запись\_b9a2fd69279de411940f00155d3c8201; #Entry\_baa2fd69279de411940f00155d3c8201  <br/> |
       |Кустомфиелддиктионари (0)/Валуетипе  <br/> |Строка  <br/> |Edm.String  <br/> |
       |Кустомфиелддиктионари (1)/__метадата/типе  <br/> |Строка  <br/> |Состав. Ключзначение  <br/> |
       |Кустомфиелддиктионари (1)/Кэй  <br/> |Строка  <br/> |Custom_c7f114c97098e411940f00155d3c8201  <br/> |
       |Кустомфиелддиктионари (1)/Валуе  <br/> |Строка  <br/> |90,5  <br/> |
       |Кустомфиелддиктионари (1)/Валуетипе  <br/> |Строка  <br/> |Edm.Double  <br/> |
       |Кустомфиелддиктионари (2)/__метадата/типе  <br/> |Строка  <br/> |Состав. Ключзначение  <br/> |
       |Кустомфиелддиктионари (2)/Кэй  <br/> |Строка  <br/> |Custom_c6fb67e0b9a1e411941000155d3c8201  <br/> |
       |Кустомфиелддиктионари (2)/Валуе  <br/> |Строка  <br/> |2015 – 04 – 01T00:00:00.0000000  <br/> |
       |Кустомфиелддиктионари (2)/Валуетипе  <br/> |Строка  <br/> |Edm.DateTime  <br/> |
   
       ![Словарь, определяющий обновление настраиваемых полей] (media/41a1f18f-a6b2-40ff-904b-437baf962621.png "Словарь, определяющий обновление настраиваемых полей")
  
6. Добавьте действие **Call HTTP Web Service** , чтобы вернуть проект. 
    
    ![Вызов метода Checkout] (media/8ce56014-0317-419b-afa7-229d05c86885.png "Вызов метода Checkout")
  
7. Измените свойства вызова веб-службы, чтобы указать заголовок запроса. Чтобы открыть диалоговое окно **Свойства** , щелкните действие правой кнопкой мыши и выберите пункт **свойства**.
    
    ![Указание заголовка запроса в свойствах вызова веб-службы] (media/d81e92b1-43df-42ad-9cd0-a693f93b164e.png "Указание заголовка запроса в свойствах вызова веб-службы")
  
8. Добавьте действие **Call HTTP Web Service** , чтобы вызвать метод **упдатекустомфиелдс** . 
    
    ![Создание действия "вызов веб-службы HTTP] " (media/9a73a201-c035-41b4-8798-506ac48b90f8.png "Создание действия \"вызов веб-службы HTTP") "
  
    Обратите `/Draft/` внимание на сегмент в URL-адресе веб-службы. Полный URL-адрес должен выглядеть следующим образом:`https://<site-url>/_api/ProjectServer/Projects('<guid>')/Draft/UpdateCustomFields()`
    
    ![Вызов метода упдатекустомфиелдс] (media/03b323f1-8e99-4b18-be18-be505d7cec7e.png "Вызов метода упдатекустомфиелдс")
  
9. Измените свойства вызова веб-службы, чтобы присоединить параметры **рекуессеадер** и **рекуестконтент** к созданным словарям. Кроме того, можно создать новую переменную для хранения **респонсеконтент**.
    
    ![Привязка словарей к заголовку и содержимому запроса] (media/f96bec92-138e-4eab-b1e7-1ab83d0428a5.png "Привязка словарей к заголовку и содержимому запроса")
  
10. Необязательный атрибут. ПроЧтите словарь ответа, чтобы проверить состояние задания в очереди и записать сведения в список журнала рабочего процесса.
    
    ![Настройка ведения журнала] (media/7d2f4936-61d7-4906-83e8-7478a5935af5.png "Настройка ведения журнала")
  
11. Добавьте вызов веб-службы в конечную точку **публикации** , чтобы опубликовать проект. Всегда используйте один и тот же заголовок запроса. 
    
    ![Вызов метода Publish] (media/3b661091-ffae-4d7e-a0bb-5b96a6292731.png "Вызов метода Publish")
  
    ![Свойства для вызова веб-службы публикации] (media/6a80a5d3-7e29-4398-993c-f78b3faca8b1.png "Свойства для вызова веб-службы публикации")
  
12. Добавьте конечный вызов веб-службы в конечную точку **возврата** , чтобы проверить проект в. 
    
    ![Вызов метода checkin] (media/430510cb-0774-4911-af7f-b565b83eba0e.png "Вызов метода checkin")
  
    ![Свойства для вызова веб-службы возврата] (media/485f48d6-bbb8-4568-9dc3-aae3218f6bd1.png "Свойства для вызова веб-службы возврата")

<a name="CreateProjectSite"> </a>

## <a name="create-a-project-site-from-a-workflow"></a>Создание сайта проекта из рабочего процесса

Каждый проект может иметь собственные выделенные сайты SharePoint, на которых участники группы могут совместно работать, совместно использовать документы, создавать проблемы и т. д. Ранее сайты могли быть созданы автоматически только при первой публикации или вручную руководителем проекта в Project Professional или администратором в параметрах PWA, или они могут быть отключены.
  
Мы добавили метод **CreateProjectSite** , чтобы вы могли выбрать, когда следует создавать сайты проектов. Это особенно полезно для организаций, которые хотят автоматически создавать свои сайты при достижении предложения проекта определенной стадией предварительно определенного рабочего процесса, а не при первой публикации. ОтКладывание создания сайта проекта значительно повышает производительность создания проекта. 
  
**Необходимые компоненты:** Прежде чем можно будет использовать **CreateProjectSite**, необходимо задать параметр **Разрешить пользователям выбирать** для создания сайта проекта в параметрах **PWA** _Гт_ * * подключенные сайты SharePoint * * _гт_ **Параметры**.
  
![Настройка параметра "разрешить пользователям выбрать" в параметрАХ PWA] (media/6c6c8175-eb10-431d-8056-cea55718fdb4.png "Параметр, позволяющий пользователям выбирать в параметрАХ PWA")
  
### <a name="to-create-a-workflow-that-creates-a-project-site"></a>Создание рабочего процесса, который создает сайт проекта

1. Создайте или измените существующий рабочий процесс и выберите шаг, на котором необходимо создать сайты проекта.
    
2. Создайте словарь **рекуессеадер** с помощью действия " **Построение словаря** ". 
    
    ![Создание словаря рекуессеадер] (media/83b0aa10-9ab7-43dd-800d-a738bb815876.png "Создание словаря рекуессеадер")
  
3. Добавьте в словарь следующие два элемента:
    
    |Имя|Тип|Значение|
    |:-----|:-----|:-----|
    |Accept  <br/> |Строка  <br/> |приложение/JSON; OData = verbose  <br/> |
    |Content-Type  <br/> |Строка  <br/> |приложение/JSON; OData = verbose  <br/> |
   
    ![Добавление заголовка Accept] (media/2f2e2016-3c49-4cac-b1e7-f2b8118b840c.png "Добавление заголовка Accept")
  
4. Добавьте действие **Call HTTP Web Service** . Измените тип запроса, чтобы он использовал **POST**, и задайте URL-адрес в следующем формате:
    
    `https://<site-url>/_api/ProjectServer/Projects('<guid>')/CreateProjectSite('New web name')`
    
    ![Построение универсальнОГО кода ресурса (URI) конечной точки CreateProjectSite] (media/42a90a5e-8d1b-4667-a933-785175212847.png "Построение универсальнОГО кода ресурса (URI) конечной точки CreateProjectSite")
  
    Передайте имя сайта проекта методу **CreateProjectSite** в виде строки. Чтобы использовать имя проекта в качестве имени сайта, передайте пустую строку. Не забудьте использовать уникальные имена, чтобы созданный вами сайт проекта был работать. 
    
5. Измените свойства вызова веб-службы, чтобы присоединить параметр **рекуессеадер** к созданному вами словарю. 
    
    ![Привязка словаря к запросу] (media/61a5a0a8-405f-44eb-b5e7-80b11f7caec3.png "Привязка словаря к запросу")
  
## <a name="see-also"></a>См. также

- [Задачи программирования Project](project-programming-tasks.md)
- [Клиентская объектная модель (CSOM) для Project 2013](client-side-object-model-csom-for-project-2013.md)
- [Рабочие процессы в SharePoint 2013](https://msdn.microsoft.com/library/e0602371-ae22-44be-8a7e-9e47e9f046d6%28Office.15%29.aspx)
    

