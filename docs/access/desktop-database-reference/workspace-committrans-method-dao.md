---
title: Метод Workspace. CommitTrans (DAO)
TOCTitle: CommitTrans Method
ms:assetid: e6d129fb-a578-5c79-9c16-6444519f0daf
ms:mtpsurl: https://msdn.microsoft.com/library/Ff835985(v=office.15)
ms:contentKeyID: 48548391
ms.date: 09/18/2015
mtps_version: v=office.15
localization_priority: Normal
ms.openlocfilehash: 52af229f03b7ea10510f3e580ba2c4e12784e461
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32306036"
---
# <a name="workspacecommittrans-method-dao"></a>Метод Workspace. CommitTrans (DAO)

**Область применения**: Access 2013, Office 2013

Завершает текущую транзакцию и сохраняет изменения.

## <a name="syntax"></a>Синтаксис

*Expression* . CommitTrans (***Options***)

*expression*: переменная, представляющая объект **Workspace**.

## <a name="parameters"></a>Параметры

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Имя</p></th>
<th><p>Обязательно/необязательно</p></th>
<th><p>Тип данных</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>Вариант</em></p></td>
<td><p>Необязательный</p></td>
<td><p><strong>Long</strong></p></td>
<td><p>В рабочей области Microsoft Access можно включить константу <strong>дбфорцеосфлуш</strong> с <strong>CommitTrans</strong>. Это заставляет ядро СУБД немедленно очистить все обновления на диске вместо того, чтобы временно кэшировать их. Если не использовать этот параметр, пользователь может вернуть управление сразу же после того, как приложение вызовет <strong>CommitTrans</strong>, выключите компьютер и не записывает данные на диск. Использование этого параметра может повлиять на производительность приложения, но это полезно в тех случаях, когда компьютер может быть выключен до сохранения кэшированных обновлений на диск.</p></td>
</tr>
</tbody>
</table>


## <a name="remarks"></a>Замечания

Методы транзакции **BeginTrans**, **CommitTrans**и **ROLLBACK** управляют обработкой транзакций во время сеанса, определенного объектом **Workspace** . Эти методы используются вместе с объектом **Workspace** , когда необходимо обрабатывать серию изменений, внесенных в базы данных в сеансе, как единое целое.

Как правило, транзакции используются для поддержания целостности данных, когда необходимо обновить записи в двух или более таблицах и убедиться в том, что изменения выполнены (зафиксированы) во всех таблицах или нет (выполняется откат). Например, если вы переносите деньги из одной учетной записи в другую, вы можете вычесть сумму из единицы и добавить сумму в другую. Если обновление завершается сбоем, учетные записи больше не сбалансированы. Используйте метод **BeginTrans** перед обновлением первой записи, а затем, если при последующих обновлениях происходит сбой, можно использовать метод **ROLLBACK** для отмены всех обновлений. Используйте метод **CommitTrans** после успешного обновления последней записи.

> [!NOTE]
> В пределах одного объекта **Workspace** транзакции всегда являются глобальными для **рабочей области** и не ограничиваются одним **подключением** или объектом **Database** . Если вы выполняете операции над несколькими подключениями или базами данных в транзакции **рабочей области** , разрешение транзакции (то есть с помощью метода **CommitTrans** или **ROLLBACK** ) влияет на все операции со всеми подключениями и базами данных в этой рабочей области.

Если вы используете **CommitTrans**, вы не сможете отменить изменения, внесенные во время этой транзакции, пока транзакция не будет вложена в другую транзакцию, которая откатывается обратно. При вложении транзакций необходимо разрешить текущую транзакцию, прежде чем можно будет разрешить транзакцию на более высоком уровне вложения.

Если требуется одновременные транзакции с перекрывающимися невложенными областями, можно создать дополнительные объекты **рабочей области** , которые будут содержать параллельные транзакции.

Если закрыть объект **Workspace** , не разрешающий все ожидающие транзакции, выполняется автоматический откат транзакций.

Если вы используете метод **CommitTrans** или **ROLLBACK** без предварительного использования метода **BeginTrans** , возникнет ошибка.

Некоторые базы данных ISAM, используемые в рабочей области Microsoft Access, могут не поддерживать транзакции, в **** этом случае свойство Transactions объекта **базы данных** или объекта **Recordset** имеет **значение false**. Чтобы убедиться, что база данных поддерживает транзакции, проверьте значение свойства **Transactions** объекта **Database** , прежде чем использовать метод **BeginTrans** . Если вы используете объект **Recordset** на основе нескольких баз данных, проверьте свойство Transactions объекта **** **Recordset** . 

Если **набор записей** полностью основан на таблицах ядра СУБД Microsoft Access, всегда можно использовать транзакции. Однако объекты **Recordset** , основанные на таблицах, созданных другими продуктами баз данных, могут не поддерживать транзакции. Например, нельзя использовать транзакции в **наборе записей** , основанном на таблице Paradox. В этом случае свойство **Transactions** имеет **значение false**. Если **база данных** или **набор записей** не поддерживают транзакции, методы игнорируются, и ошибка не возникает.

Нельзя вкладывать транзакции, если доступ к источникам данных ODBC осуществляется с помощью ядра СУБД Microsoft Access.

В рабочих областях ODBC при использовании **CommitTrans** курсор может стать недействительным. Используйте метод **Requery** для просмотра изменений в наборе **записей**, а также для закрытия и повторного открытия объекта **Recordset**.

> [!NOTE]
> - Вы часто можете увеличить производительность приложения, разбив операции, требующие доступа к диску, в блоки транзакций. Это приводит к буферизации операций и значительно сокращает количество обращений к диску.
> - В рабочей области Microsoft Access транзакции записываются в файл, сохраненный в каталоге, указанном в переменной среды TEMP на рабочей станции. Если файл журнала транзакций исчерпал Доступное хранилище на диске TEMP, ядро СУБД запускает ошибку во время выполнения. На этом шаге при использовании **CommitTrans**зафиксировано неопределенное количество операций, но оставшиеся незавершенные операции теряются и операция должна быть перезапущена. Использование метода **отката** освобождает журнал транзакций и выполняет откат всех операций в транзакции.
> - Закрытие **набора записей** клонирования в ожидающей транзакции приводит к неявной операции **отката** .

## <a name="example"></a>Пример

В приведенном ниже примере показано, как использовать транзакцию в рабочей области объектов доступа к данным (DAO).

**Пример кода из** [справочника программиста Microsoft Access 2010](https://www.amazon.com/Microsoft-Access-2010-Programmers-Reference/dp/8126528125).


```vb
    Public Sub TransferFunds()
        Dim wrk As DAO.Workspace
        Dim dbC As DAO.Database
        Dim dbX As DAO.Database
        
        Set wrk = DBEngine(0)
        Set dbC = CurrentDb
        Set dbX = wrk.OpenDatabase("e:\books\acc2007vba\myDB.accdb")
        
        On Error GoTo trans_Err
        
        'Begin the transaction
        
        wrk.BeginTrans
        
        'Withdraw funds from one account table
        dbC.Execute "INSERT INTO tblAccounts ( Amount, Txn, TxnDate ) SELECT -20, 'DEBIT', Date()", dbFailOnError
    
        'Deposit funds into another account table
        dbX.Execute "INSERT INTO tblAccounts ( Amount, Txn, TxnDate ) SELECT 20, 'CREDIT', Date()", dbFailOnError
        
        'Commit the transaction
        wrk.CommitTrans dbForceOSFlush
        
    trans_Exit:
        'Clean up
        wrk.Close
        Set dbC = Nothing
        Set dbX = Nothing
        Set wrk = Nothing
        Exit Sub
        
    trans_Err:
        'Roll back the transaction
        wrk.Rollback
        Resume trans_Exit
        
    End Sub
```
