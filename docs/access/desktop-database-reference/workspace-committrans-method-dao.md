---
title: Метод Workspace.CommitTrans (DAO)
TOCTitle: CommitTrans Method
ms:assetid: e6d129fb-a578-5c79-9c16-6444519f0daf
ms:mtpsurl: https://msdn.microsoft.com/library/Ff835985(v=office.15)
ms:contentKeyID: 48548391
ms.date: 09/18/2015
mtps_version: v=office.15
localization_priority: Normal
ms.openlocfilehash: 52af229f03b7ea10510f3e580ba2c4e12784e461
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32306036"
---
# <a name="workspacecommittrans-method-dao"></a>Метод Workspace.CommitTrans (DAO)

**Область применения**: Access 2013, Office 2013

Завершает текущую транзакцию и сохраняет изменения.

## <a name="syntax"></a>Синтаксис

*выражение .* CommitTrans(***Options***)

*expression*: переменная, представляющая объект **Workspace**.

## <a name="parameters"></a>Параметры

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Имя</p></th>
<th><p>Обязательный/необязательный</p></th>
<th><p>Тип данных</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>Option</em></p></td>
<td><p>Необязательный</p></td>
<td><p><strong>Long</strong></p></td>
<td><p>В рабочей области Microsoft Access можно включить константу <strong>dbForceOSFlush</strong> с <strong>CommitTrans.</strong> Это заставляет яд баз данных немедленно очистить все обновления на диск, а не кэшвать их временно. Без использования этого параметра пользователь может получить контроль непосредственно после того, как программа приложения вызывает <strong>CommitTrans,</strong>отключит компьютер и данные не будут записаны на диск. Хотя использование этого параметра может повлиять на производительность приложения, оно полезно в ситуациях, когда компьютер может быть отключен до снесения кэшных обновлений на диск.</p></td>
</tr>
</tbody>
</table>


## <a name="remarks"></a>Заметки

Методы транзакций **BeginTrans,** **CommitTrans** и **Rollback** управляют обработкой транзакций во время сеанса, определенного **объектом Рабочей** области. Эти методы используются с объектом **Workspace,** если необходимо рассматривать ряд изменений, внесенных в базы данных в сеансе, как одно целое.

Как правило, транзакции используются для поддержания целостности данных, когда необходимо обновить записи в двух или более таблицах и убедиться, что изменения завершены (зафиксированы) во всех таблицах или вообще нет (откат). Например, если вы переводите деньги с одной учетной записи на другую, вы можете вычитать сумму из одной учетной записи и добавить ее в другую. Если обновление не удастся, учетные записи перестают балансировать. Используйте метод **BeginTrans** перед обновлением первой записи, а затем, если последующее обновление не удастся, вы можете отменить все обновления с помощью метода **Rollback.** Используйте метод **CommitTrans** после успешного обновления последней записи.

> [!NOTE]
> В одном **объекте Workspace** транзакции всегда являются глобальными для **рабочей** области и не ограничиваются только одним объектом **Connection** или **Database.** Если вы выполняете операции с более чем одним подключением или базой данных в транзакции **Рабочей** области, разрешение транзакции (то есть с помощью метода **CommitTrans** или **Rollback)** влияет на все операции со всеми подключениями и базами данных в этой рабочей области.

После использования **CommitTrans** вы не сможете отменить изменения, внесенные во время этой транзакции, если транзакция не вложена в другую транзакцию, которая была отката. Если вы вложены транзакции, необходимо разрешить текущую транзакцию, прежде чем разрешать транзакцию на более высоком уровне вложенности.

Если вы хотите иметь одновременные транзакции с перекрывающимися, не вложенными областью, можно создать дополнительные объекты **Рабочей** области, содержащие параллельные транзакции.

При закрытии **объекта Workspace** без разрешения ожидающих транзакций транзакции автоматически откатываются.

Если вы используете метод **CommitTrans** или **Rollback** без использования метода **BeginTrans,** возникает ошибка.

Некоторые базы данных ISAM, используемые в рабочей области Microsoft Access, могут не поддерживать транзакции, в этом случае свойство **Transactions** объекта **Database** или **Объекта Recordset** имеет свойство **False.** Чтобы убедиться, что база данных поддерживает транзакции, проверьте значение свойства **Transactions** объекта **Database** перед использованием метода **BeginTrans.** Если вы используете объект **Recordset на** основе более чем одной базы данных, проверьте свойство **Transactions** объекта **Recordset.** 

Если набор **recordset** полностью основан на таблицах ядров баз данных Microsoft Access, всегда можно использовать транзакции. **Однако объекты наборов** записей, основанные на таблицах, созданных другими продуктами базы данных, могут не поддерживать транзакции. Например, вы не можете использовать транзакции в наборе **записей** на основе таблицы Paradox. В этом случае свойство **Transactions** имеет свойство **False.** Если база **данных** или **набор записей** не поддерживают транзакции, методы игнорируются и ошибки не возникают.

При доступе к источникам данных ODBC с помощью яда базы данных Microsoft Access нельзя вложенные транзакции.

В ODBC workspaces, when you use **CommitTrans** your cursor may no longer be valid. Используйте метод **Requery** для просмотра изменений в наборе **записей** или закрытия и повторного **открытия recordset.**

> [!NOTE]
> - Часто производительность приложения можно повысить, разорвав операции, которые требуют доступа к диску, в блоки транзакций. Это буферит ваши операции и может значительно сократить количество операций доступа к диску.
> - В рабочей области Microsoft Access транзакции регистрируются в файле, который хранится в каталоге, указанном переменной среды TEMP на рабочей станции. Если файл журнала транзакций исчерпает доступное хранилище на диске TEMP, обдвижка базы данных инициирует ошибку времени запуска. На этом этапе, если вы используете **CommitTrans,** будет фиксироваться неопределяемого количества операций, но остальные невыполненные операции будут потеряны, и операцию необходимо перезапустить. Использование метода **отката** освобождает журнал транзакций и откатит все операции в транзакции.
> - Закрытие клона **recordset в** ожидающих транзакциях приведет к неявной операции **отката.**

## <a name="example"></a>Пример

В следующем примере показано, как использовать транзакцию в рабочей области объектов доступа к данным (DAO).

**Пример кода из** [справочника программиста Microsoft Access 2010](https://www.amazon.com/Microsoft-Access-2010-Programmers-Reference/dp/8126528125).


```vb
    Public Sub TransferFunds()
        Dim wrk As DAO.Workspace
        Dim dbC As DAO.Database
        Dim dbX As DAO.Database
        
        Set wrk = DBEngine(0)
        Set dbC = CurrentDb
        Set dbX = wrk.OpenDatabase("e:\books\acc2007vba\myDB.accdb")
        
        On Error GoTo trans_Err
        
        'Begin the transaction
        
        wrk.BeginTrans
        
        'Withdraw funds from one account table
        dbC.Execute "INSERT INTO tblAccounts ( Amount, Txn, TxnDate ) SELECT -20, 'DEBIT', Date()", dbFailOnError
    
        'Deposit funds into another account table
        dbX.Execute "INSERT INTO tblAccounts ( Amount, Txn, TxnDate ) SELECT 20, 'CREDIT', Date()", dbFailOnError
        
        'Commit the transaction
        wrk.CommitTrans dbForceOSFlush
        
    trans_Exit:
        'Clean up
        wrk.Close
        Set dbC = Nothing
        Set dbX = Nothing
        Set wrk = Nothing
        Exit Sub
        
    trans_Err:
        'Roll back the transaction
        wrk.Rollback
        Resume trans_Exit
        
    End Sub
```
