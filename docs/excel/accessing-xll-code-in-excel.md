---
title: Доступ к коду XLL в Excel
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
keywords:
- доступ к коду xll [excel 2007], XLL [Excel 2007], доступ к коду, команды [Excel 2007], регистрация, функции [Excel 2007], регистрация, вызов XLL из Excel, регистрация команд [Excel 2007], регистрация функций [Excel 2007]
ms.assetid: 6e4bf1f3-8eca-4be5-9632-75355ac31d61
description: 'Относится к: Excel 2013 | Office 2013 | Visual Studio'
localization_priority: Priority
ms.openlocfilehash: d1332b0dffc052404c75c4ec51d94879457c3da0
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32304188"
---
# <a name="accessing-xll-code-in-excel"></a>Доступ к коду XLL в Excel

**Относится к**: Excel 2013 | Office 2013 | Visual Studio 
  
Чтобы функции и команды, которые содержит код XLL, были доступны в Microsoft Excel, они:
  
- должны быть экспортированы XLL;
    
- должны быть зарегистрированы в Excel.
    
## <a name="registering-functions-and-commands-with-excel"></a>Регистрация функций и команд в Excel

Регистрация указывает Excel о точке входа DLL следующее:
  
- является ли она скрытой или, если речь идет о функции, будет ли она отображаться в мастере функций;
    
- можно ли будет ее вызвать только с листа макроса XLM или также с обычного листа;
    
- если это команда, является ли она функцией листа или эквивалентной функцией листа макроса;
    
- каким будет ее имя в операции экспорта XLL/DLL и какое имя следует использовать в Excel.
    
- Если это функция:
    
  - какие типы данных она возвращает и принимает в качестве аргументов;
    
  - будет ли она возвращать свой результат, изменяя аргумент на месте;
    
  - является ли она постоянной;
    
  - является ли она потокобезопасной (поддерживается начиная с Excel 2007);
    
  - какой текст мастер вставки функций и редактор автозаполнения должны отображать для поддержки при вызове функции;
    
  - к какой категории функций она должна относиться.
    
Все это реализуется с помощью функции C API [xlfRegister](xlfregister-form-1.md), эквивалентной функции XLM **REGISTER**.
  
## <a name="calling-xll-functions-directly-from-excel"></a>Вызов функций XLL непосредственно из Excel

После регистрации функции листа макроса и листа XLL можно вызывать из любого расположения, откуда можно вызвать встроенную функцию:
  
- из формулы массива или одной ячейки на листе;
    
- из формулы массива или одной ячейки на листе макроса;
    
- из определения имени;
    
- из полей условий и ограничений в диалоговом окне условного форматирования;
    
- из других надстроек через функцию C API [xlUDF](xludf.md);
    
- из Visual Basic для приложений (VBA) через метод **Application.Run**. 
    
Можно получить ссылку на ячейку или диапазон ячеек вызова в нужной функции с помощью функции C API **xlfCaller**. Если функция вызывалась из выражения условного форматирования ячейки, все равно возвращается ссылка на связанную ячейку или несколько ячеек, поэтому нельзя предположить, что формула с ячейкой содержит функцию XLL. Если функция вызывалась из пользовательской функции VBA (UDF), **xlfCaller** также возвращает адрес ячеек, которые вызывали функцию VBA. Дополнительные сведения см. в статье [xlfCaller](xlfcaller.md).
  
> [!NOTE]
> Excel также вызывает код функции XLL из диалоговых окон **Мастер вставки функции** и **Замена**. Может потребоваться ограничить обычное выполнение вашего кода в случае диалогового окна **Вставка аргументов функции**, особенно в тех случаях, когда выполнение функции может занять много времени. Чтобы обнаружить, вызывается ли функция из одного из таких диалоговых окон, необходимо реализовать в проекте код, который будет просматривать все открытые окна, чтобы определить, является ли окно переднего плана одним из таких диалоговых окон, и, если да, какое именно. 
  
## <a name="calling-xll-commands-directly-from-excel"></a>Вызов команд XLL непосредственно из Excel

После регистрации команды XLL можно вызывать всеми способами, которыми можно вызвать другие пользовательские макросы:
  
- посредством связывания с объектом элемента управления, встроенным в лист;
    
- из диалогового окна "Выполнить макрос";
    
- из пользовательского макроса VBA с использованием метода **Application.Run**; 
    
- из настраиваемого элемента меню или панели инструментов;
    
- с помощью сочетаний клавиш, заданных при регистрации команды;
    
- в качестве команды, которую следует выполнять при обработке указанного события.
    
> [!NOTE]
> Команды XLL являются скрытыми таким образом, что они не отображаются в списке доступных макросов в диалоговых окнах Excel. Но они могут быть введены вручную в поле имени макроса. В таких диалоговых окнах необходимо вводить заданное при регистрации имя, а не имя экспорта DLL. 
  
Приложение Excel обрабатывает все команды XLL, зарегистрированные в нем, как имеющие такой вид:
  
```cs
short WINAPI xll_cmd_name(void)
{
// Function code...
    return 1;
}

```

Excel игнорирует возвращаемое значение, если оно не вызывается с листа макросов XLM. В этом случае возвращаемое значение преобразуется в значение **TRUE** или **FALSE**. Таким образом, следует возвращать значение 1, если команда выполнена успешно, и 0, если она завершилась с ошибкой или была отменена пользователем.
  
Можно получить сведения о том, как команда была вызвана, с помощью функции C API **xlfCaller**. Дополнительные сведения см. в статье [xlfCaller](xlfcaller.md).
  
Начиная с Excel 2007 пользовательский интерфейс существенно отличается от более ранних версий. В большинстве случаев по-прежнему поддерживаются функции C API, позволяющие выполнять операции добавления и удаления настраиваемых строк меню, меню, вложенных меню, элементов меню, настраиваемых панелей инструментов и кнопок панели инструментов. Тем не менее они не всегда могут обеспечить доступность добавляемого элемента способом, который знаком вашим пользователям. Следует тщательно проверить, является ли добавленная функция по-прежнему доступной, или реализовать пользовательскую настройку под определенную версию. Начиная с Excel 2007 пользовательский интерфейс лучше всего настраивать с использованием модуля управляемого кода, который затем можно тесно связать с вашими командами XLL.
  
## <a name="see-also"></a>См. также

- [Создание XLL-файлов](creating-xlls.md)
- [Вызов функций XLL из диалоговых окон "Мастер функций" и "Замена"](how-to-call-xll-functions-from-the-function-wizard-or-replace-dialog-boxes.md)
- [Функции диспетчера надстроек и интерфейса XLL](add-in-manager-and-xll-interface-functions.md)
- [Разработка XLL-файлов для Excel](developing-excel-xlls.md)



