---
title: Программирование с использованием C API в Excel
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
keywords:
- c api [excel 2007],programming interfaces [Excel 2007],C API [Excel 2007], when to use,C API [Excel 2007], relation to XLM,Excel programming interfaces
localization_priority: Normal
ms.assetid: 142bc0ce-7d16-4b69-9799-ce6558da2def
description: 'Относится к: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: 53167241ebfaf8524fb58d14b4e1299809cdee50
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25401624"
---
# <a name="programming-with-the-c-api-in-excel"></a>Программирование с использованием API C в Excel

 **Относится к**: Excel 2013 | Office 2013 | Visual Studio 
  
Вы можете использовать пакет средств разработки XLL для Microsoft Excel 2013 и API C, чтобы создавать высокопроизводительные функции обработки листов в Excel 2013. Обновления API C для Excel 2013 отражают постоянную поддержку пользователей, для которых производительность сторонних или внутренних функций играет важную роль.
  
## <a name="excel-programming-interfaces"></a>Программные интерфейсы Excel

В программе Excel доступны несколько вариантов разработки приложений, которые с ней взаимодействуют. Программные интерфейсы Excel добавлялись в предыдущие версии в следующем порядке:
  
- **Макроязык XLM:** первый доступный пользователям язык для расширения возможностей Excel и основа API C. Хотя язык XLM по-прежнему поддерживается в Excel 2010, ему на замену пришел язык Visual Basic для приложений (VBA). 
    
- **API C и XLL:** библиотеки DLL, интегрируемые с Excel. Они предоставляют интерфейс для непосредственного и самого быстрого добавления высокопроизводительных функций обработки листов, но использовать их сложнее, чем последующие технологии. 
    
- **VBA:** объекты кода Visual Basic, связанные с объектами книги Excel. VBA позволяет перехватывать события, настраивать и добавлять определяемые пользователем функции и команды. VBA — это наиболее распространенный и самый простой вариант расширения возможностей Excel. 
    
- **Модель COM:** стандарт взаимодействия для приложений Windows, с помощью которого Excel предоставляет свои события и объекты. VBA использует модель COM для взаимодействия с Excel. Excel экспортирует библиотеки типов COM, которые помогают создавать ресурсы кода COM и приложения на C++, управляющие Excel. 
    
- **Платформа Microsoft .NET Framework:** многоязыковая среда с управляемым кодом, позволяющая быстро разрабатывать приложения для распределенных сред. Основной язык программирования для кода на базе .NET Framework — это C#, хотя и многие другие языки могут компилироваться в язык MSIL. Excel 2013 может получать доступ к ресурсам кода в сборках .NET Framework. 
    
## <a name="when-to-use-the-c-api"></a>Причины для использования C API

Основная причина написания XLL и использования API C — создание высокопроизводительных функций для обработки листов. Хотя функции XLL часто называют определяемыми пользователем функциями, время для изучения и обретения необходимых навыков делает эту технологию непрактичной для большинства пользователей. Но возможность применять высокопроизводительные функции, а также создавать в Excel 2013 многопоточные интерфейсы для мощных серверных ресурсов делает ее очень важной частью вариантов расширения Excel. 
  
Версия C API, представленная в Excel 2007, относится, в основном, к высокопроизводительным расчетам, а не пользовательскому интерфейсу.
  
### <a name="writing-high-performance-user-defined-worksheet-functions"></a>Написание высокопроизводительных определяемых пользователем функций для работы с листами

API C для Excel — это идеальный выбор для создания высокопроизводительных функций обработки листов с помощью надстроек XLL. API C предоставляет прямой доступ к данным листов. XLL предоставляют Excel прямой доступ к ресурсам DLL. Производительность XLL повышена в Excel 2013 за счет добавления новых типов данных и, что еще важнее, за счет поддержки выполнения определяемых пользователем функций на кластерных серверах.
  
Работа с XLL связана с определенными неудобствами: C API не предоставляет возможностей быстрой высокоуровневой разработки, доступной при использовании языка VBA, модели COM или .NET Framework. Управление памятью низкоуровневое, что повышает ответственность разработчика. Многие функции Excel, доступные благодаря модели COM, а значит, доступные через VBA и .NET Framework, недоступны в C API.
  
### <a name="accessing-multithreaded-servers-by-using-xll-worksheet-functions"></a>Доступ к многопоточным серверам с помощью функций XLL

Многопоточный пересчет (MTR), впервые появившийся в Excel 2007, позволяет создавать потокобезопасные функции листа XLL. Их можно использовать для доступа к многопоточным серверам. В следующих разделах более подробно описывается, как это может значительно увеличить наблюдаемую производительность. Для пользователей Excel, которым иногда требуется доступ к мощным вычислительным ресурсам, сочетание библиотеки XLL, использующей MTR, и мощного сервера обеспечивает высокую производительность решения.
  
### <a name="customizing-the-excel-user-interface"></a>Настройка пользовательского интерфейса Excel

Для многих версий Excel интерфейс C API не был лучшим выбором для настройки пользовательского интерфейса. VBA предоставляет эффективный доступ к объектам и событиям Excel. Пользовательский интерфейс, впервые представленный в Excel 2007, существенно отличается от предыдущих версий как внешним видом, так и базовой технологией. Этот интерфейс лучше всего можно настроить с помощью ресурсов управляемого кода.
  
### <a name="creating-applications-that-can-be-accessed-on-the-internet"></a>Создание приложений, доступных в Интернете

Службы Excel в Microsoft Office 2007 — это лучший способ предоставления пользователям доступа к книгам и функциям Excel с помощью стандартных средств браузера. Вместе с языками разработки и ресурсами .NET Framework эти технологии очень важны в случае развертывания Excel для пользователей в будущем.
  
### <a name="controlling-excel-from-external-applications"></a>Управление Excel из внешних приложений

Excel предоставляет доступ к объектам, методам и событиям с помощью COM-интерфейса. Таким образом вы можете использовать модель COM для создания автономных приложений, которые могут запускать сеансы Excel и управлять ими, а также управлять существующим сеансом Excel. Доступ к COM-интерфейсу Excel можно получить с использованием различных языков разработки, включая C++ и VBA. C# и .NET Framework аналогичным образом предоставляют интерфейс взаимодействия с Excel, обеспечивающий удаленный доступ к Excel.
  
## <a name="asynchronous-calling-of-excel"></a>Асинхронный вызов Excel

Excel позволяет библиотеке XLL вызывать C API, только если приложение Excel передало управление XLL. Функция листа, которую вызывает Excel, может осуществлять обратный вызов Excel с помощью C API. Команда XLL, которую вызывает приложение Excel, может вызывать C API. Функции и команды DLL и XLL, которые вызываются VBA после вызова VBA приложением Excel, могут вызывать C API. Невозможно, например, задать обратный вызов Windows с указанием времени в библиотеке XLL и вызвать из нее C API. Кроме того, невозможно вызвать C API из фонового потока, созданного библиотекой XLL. Не рекомендуется вызывать Excel асинхронно с помощью модели COM из DLL или XLL.
  
Это очень ограничивают ваши возможности, так как некоторые приложения должны реагировать на события асинхронно. Например, вам может потребоваться получить часть данных в Excel из Интернета и повторно проводить вычисления при каждом изменении данных. Или вам может понадобиться фоновый поток для вычислений и пересчитать данные в Excel после его завершения.
  
Для этого с помощью Excel можно активно запрашивать изменения, но это неэффективно и непрактично, так как Excel часто будет прерывать регулярные операции. Вы можете настроить повторяющиеся запланированные команды, используя C API или VBA, хотя это не идеальное решение.
  
В идеальном случае требуется более эффективный внешний процесс для проверки изменений данных, который активирует Excel для извлечения обновлений и пересчета. Это можно сделать с помощью приложения, которое взаимодействует с Excel с помощью модели COM. В отличие от интерфейса C API, с помощью которого вызовы можно осуществлять, только если приложение Excel явно передало управление, модель COM не так ограничена. Приложения COM могут вызывать методы Excel всякий раз, когда Excel находится в состоянии готовности, несмотря на то, что эти вызовы могут игнорироваться, если отображаются диалоговые окна, открываются меню или выполняется макрос.
  
## <a name="c-api-and-its-relation-to-xlm"></a>Интерфейс C API и его связь с XLM

Макроязык Excel (XLM) был первой доступной пользователям средой программирования в Excel. Она позволяет создавать специальные команды и функции на специальных листах макросов, которые похожи на обычные листы. Листы макросов XLM по-прежнему поддерживаются в Excel 2013. На листе макросов можно использовать все обычные функции листов, такие как **СУММ** и **LOG**, а также следующие элементы, которые невозможно ввести на листе: 
  
- функции, предоставляющие сведения о рабочей области, такие как **GET.CELL** и **GET.WORKBOOK**;
    
- эквивалентные командам функции, позволяющие автоматизировать обычные пользовательские операции, такие как **DEFINE.NAME** и **PASTE**;
    
- функции, связанные с надстройками, такие как **REGISTER**;
    
- эквивалентное командам перехватывание событий (например, с помощью **ON.ENRTY** и **ON.TIME**);
    
- операции макросов, связанные с функциями, такие как **ARGUMENT** и **VOLATILE**;
    
- операции управления потоком выполнения, такие как **GOTO** и **RETURN**.
    
Ограниченная версия API C существовала в Excel версии 3. Однако в Excel версии 4 язык XLM был сопоставлен с интерфейсом API C. С тех пор библиотеки DLL могут вызывать все функции листа, информационные функции листа макросов, команды, даже перехватывать события. DLL не могут вызывать функции управления потоком XLM из API C. Эти команды и функции листа макроса описаны в файле справки XLMacr8.hlp (прежнее название — Macrofun.hlp). Для получения этого файла справки перейдите в [Центр загрузки Майкрософт](https://download.microsoft.com) и выполните поиск "XLMacr8.hlp". 
  
> [!NOTE]
> Windows Vista и Windows 7 не поддерживают HLP-файлы напрямую, но вы можете скачать [программу справки Windows (WinHlp32.exe) для Windows Vista](https://go.microsoft.com/fwlink/?LinkID=82148) или [программу справки Windows (WinHlp32.exe) для Windows 7](https://www.microsoft.com/download/en/details.aspx?id=91) от корпорации Майкрософт, позволяющие открыть эти файлы. 
  
Библиотеки DLL вызывают эквиваленты этих функций и команд интерфейса API C, используя функции обратного вызова **Excel4**, **Excel4v**, **Excel12** и **Excel12v** (последние две были представлены в Excel 2007). Перечисленные константы, соответствующие каждой функции и команде, определены в файле заголовка и передаются как один из аргументов функциям обратного вызова. Например, функция **GET.CELL** представлена **xlfGetCell**, **REGISTER** — **xlfRegister**, а **DEFINE.NAME** — **xlcDefineName**.
  
Помимо функций листа, а также команд и функций листа макросов, API C предоставляет перечисления функций и команд, которые можно вызывать только с помощью этих функций обратного вызова из DLL. Например, **xlGetName** позволяет DLL найти собственный полный путь и имя файла, что необходимо при регистрации функций и команд в Excel. 
  
После представления листов Visual Basic для приложений (VBA) в Excel версии 5 и редактора Visual Basic (VBE) в версии 8 (Excel 97) самым простым способом настройки Excel стал язык VBA, а не XLM. Множество новых возможностей, представленных в последующих версиях Excel, доступны через VBA, но не через XLM или C API. Например, несколько команд, прерывания событий и расширенные возможности диалогового окна функции доступны в VBA, но не в XLM или C API.
  
Дополнительные сведения см. в статье [Новые возможности API C для Excel](what-s-new-in-the-c-api-for-excel.md).
  
## <a name="see-also"></a>См. также



[Новые возможности API C для Excel](what-s-new-in-the-c-api-for-excel.md)
  
[Функции обратного вызова API C: Excel4, Excel12](c-api-callback-functions-excel4-excel12.md)


[Начало работы с пакетом SDK XLL для Excel](getting-started-with-the-excel-xll-sdk.md)

