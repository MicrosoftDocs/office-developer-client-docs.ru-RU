---
title: Асинхронные пользовательские функции
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 142eb27e-fb6f-4da3-bfb7-a88115bbb5d5
description: '������� ����������: Excel 2013�| Office 2013�| Visual Studio'
ms.openlocfilehash: 5b64dfd4308da4efb5e94010fe1dc9d758a1199c
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19807132"
---
# <a name="asynchronous-user-defined-functions"></a>Асинхронные пользовательские функции

**Применимо к**: Excel 2013 | Office 2013 | Visual Studio 
  
Microsoft Excel 2013 можно асинхронный вызов пользовательских функций. Асинхронный вызов функции могут улучшить производительность, позволяя несколько вычислений для запуска в то же время. При выполнении этих функций на вычислительном кластере асинхронный вызов функции включает несколько компьютеров, которые будут использоваться для выполнения вычислений.
  
## <a name="when-to-use-asynchronous-user-defined-functions"></a>Когда следует использовать асинхронных пользовательских функций

Некоторые выбранные пользователем функции еще не готова для внешних ресурсов. Пока осуществляется их, блокировки потока вычислений Excel. В Excel 2013 можно асинхронное выполнение пользовательских функций. Это позволяет экономить потока вычислений для запуска других вычислений во время ожидания пользовательских функций.
  
В Excel 2007 с любым опытом может выполнить несколько пользовательских функций в то же время, увеличьте число потоков, используемых в нескольких потоков пересчетов. Этот метод имеет недостатки в первую очередь, так как число потоков, устанавливается ограниченные приложения и не может управляться на уровне одной функции или надстроек.
  
Функции должны ждать освобождения внешних ресурсов следует использовать вызовов асинхронных пользовательских функций с любым опытом. К примеру функция, которая отправляет запрос SOAP через Интернет необходимо дождаться сети, чтобы отправить запрос, удаленного сервера, чтобы завершить запрос и сети для возвращения результата. В этом случае нет не значительные сетей повторяться и Excel можно продолжить выполнение других вычислений.
  
Программисты также можно использовать асинхронных пользовательских функций, когда функция отправляет запросы к вычислительному кластеру. В этом случае не только задержек в сети ожидания, но кластера может выполнять отдельные вызовов на отдельных серверах. Не ожидая для каждого звонка закончить, вызовы можно перекрытием для повышения производительности. В некоторых случаях это улучшение имеет значение.
  
> [!NOTE]
> Пользовательские функции не может быть зарегистрирована как обе асинхронного и кластера безопасных. 
  
## <a name="writing-an-asynchronous-user-defined-function"></a>Написание асинхронных пользовательских функций

Асинхронные пользовательские функции должны отслеживать дескриптор и использовать этот дескриптор при Excel о том, что вызов функции завершения. Асинхронных пользовательских функций разбивается на две части. Первая часть — это стандартные UDF точка входа, запустит второй отдельной асинхронной операции. Во время точка входа UDF делаться обратных вызовов в Microsoft Excel. Запуск первой части функции будет возвращать управления потока вычислений в Excel, которая по-прежнему вычислений. После завершения второй асинхронной операции необходимо обратного вызова Excel и предоставляют Excel с помощью его результат. 
  
> [!NOTE]
> Все аргументы, был передан в пользовательской функции, необходимая для асинхронного часть она должна быть глубокой скопировать, так как Excel освобождает следующие аргументы при возврате точка входа пользовательских Функций. 
  
Excel предоставляет набор событий, которые надстройки XLL можно использовать для управления жизненным циклом асинхронные вызовы пользовательских Функций. Эти события указывают, что завершения с помощью вычисления или отмены вычисления.
  
### <a name="declaring-an-asynchronous-function"></a>Объявление асинхронные функции

Асинхронные пользовательские функции как асинхронная необходимо объявить при их регистрации. Это осуществляется путем добавления параметра, которая представлена точек на структуру XLOPER12 «X» в строке тип регистрации в любом месте в списке параметров UDF. Excel использует этот параметр для передачи дескриптор асинхронного вызова. Надстройки XLL передает маркер асинхронного вызова и результат функции в Excel при готовности результат. Кроме того, возвращаемый тип UDF должен быть **void**, обозначенного «>» первым символом в тип string. Тип возвращаемого значения void, так как синхронные частью UDF не возвращает значение в Excel. Вместо этого надстройка XLL возвращает значение асинхронно посредством обратного вызова. 
  
Асинхронные функции можно объявить как потоками и затем используется синхронный частью пользовательскую Функцию на многопоточные вычисления. 
  
В следующем примере кода показана асинхронных пользовательских функций зарегистрирована с помощью "\>QX» как строка типа регистрации:
  
```cpp
void MyAsyncUDF(LPXLOPER12 arg1, LPXLOPER12 pxAsyncHandle)
{
…
}
```

### <a name="returning-values"></a>Возвращаемые значения

Когда результат асинхронного вызова будет готов, надстройки XLL возвращает результат в Excel путем выполнения обратного вызова типа [xlAsyncReturn](xlasyncreturn.md).
  
**xlAsyncReturn** является единственным обратного вызова, которые можно использовать в потоках не вычислений во время пересчета. Таким образом асинхронная часть асинхронных пользовательских Функций не следует выполнять любые другие обратных вызовов. 
  
### <a name="handling-events"></a>Обработка событий

Начиная с версии Excel 2010, XLL-модулей может получать события, предназначенное для управления жизненным циклом асинхронные функции. Дополнительные сведения см в [Обработке событий](handling-events.md).
  
## <a name="see-also"></a>См. также

- [���������� XLL-������� ��� Excel 2013](developing-excel-xlls.md)

