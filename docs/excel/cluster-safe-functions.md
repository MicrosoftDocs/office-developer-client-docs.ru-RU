---
title: Безопасные для кластера функции
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
localization_priority: Normal
ms.assetid: 787badaf-8782-454d-a016-7eae83bbd8a9
description: 'Относится к: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: f73f49e4d76a8545399eede283b70551ee6569f9
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19807137"
---
# <a name="cluster-safe-functions"></a><span data-ttu-id="ac0d6-103">Безопасные для кластера функции</span><span class="sxs-lookup"><span data-stu-id="ac0d6-103">Cluster safe functions</span></span>

<span data-ttu-id="ac0d6-104">**Относится к**: Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="ac0d6-104">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="ac0d6-105">В Excel 2013 Excel может снизить нагрузку звонки пользовательские функции (UDF) в кластере высокопроизводительных сетей через интерфейс соединителя выделенного кластера.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-105">In Excel 2013, Excel can offload User-Defined Function (UDF) calls to a high-performance computing cluster through a dedicated cluster connector interface.</span></span> <span data-ttu-id="ac0d6-106">Поставщики COMPUTE cluster предоставляют соединителей кластеров.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-106">Compute cluster vendors provide Cluster Connectors.</span></span> <span data-ttu-id="ac0d6-107">Авторы UDF можно объявить их пользовательских функций как кластера надежных и, при наличии соединитель кластера Excel отправляет звонков на этих пользовательских функций в соединитель кластера для разгрузки.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-107">UDF authors can declare their UDFs as cluster safe and then, when a cluster connector is present, Excel sends calls to these UDFs to the cluster connector for offloading.</span></span>
  
<span data-ttu-id="ac0d6-108">Когда Excel обнаруживает UDF кластера safe во время пересчета, передает имя XLL, на котором в настоящее время работает, имя кластера safe UDF и каких-либо параметров в соединитель кластера.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-108">When Excel discovers a cluster-safe UDF during recalculation, it passes the name of the XLL that is currently running, the name of the cluster-safe UDF, and any parameters to the cluster connector.</span></span> <span data-ttu-id="ac0d6-109">Соединитель удаленно выполняется вызов пользовательских Функций и возвращает результаты в Excel.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-109">The connector runs the UDF call remotely and returns the results to Excel.</span></span> <span data-ttu-id="ac0d6-110">Независимые Расчет продолжается и после завершения выполнения пользовательской функции соединителя кластера передает результаты в Excel, и зависимые вычисления продолжить.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-110">Non-dependent calculation continues and when the cluster connector has finished running the UDF, it passes the results to Excel and dependent calculations continue.</span></span> <span data-ttu-id="ac0d6-111">Механизм это асинхронных напоминающего механизм, используемый асинхронных пользовательских функций, за исключением того, что соединитель кластера управляет асинхронные аспекты вместо автора пользовательских Функций.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-111">The mechanism for this asynchronous behavior mimics the mechanism used by asynchronous UDFs, except that the cluster connector manages the asynchronous aspects instead of the UDF author.</span></span> <span data-ttu-id="ac0d6-112">Как правило соединитель кластера реализует XLL оболочки совместимости для загрузки XLL-модулей и запуск пользовательских функций на вычислительном узлах кластера.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-112">Typically, a cluster connector implements an XLL shim to load XLLs and run UDFs on compute cluster nodes.</span></span>
  
<span data-ttu-id="ac0d6-113">Механизм объявление пользовательских функций как безопасный кластера похожи объявления пользовательских функций как безопасные для многопотоковых пересчета.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-113">The mechanics of declaring UDFs as cluster-safe resemble those of declaring UDFs as safe for multi-threaded recalculation.</span></span> <span data-ttu-id="ac0d6-114">Тем не менее поскольку UDF не работает на том же компьютере, что и других пользовательских функций из одного сеанса Excel обязательно, существуют разные аспекты при записи безопасного кластера пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-114">However, because the UDF is not necessarily running on the same computer as other UDFs from the same Excel session, there are different considerations when writing cluster-safe UDFs.</span></span>
  
<span data-ttu-id="ac0d6-115">Для регистрации пользовательской функции в качестве безопасных кластера, необходимо вызвать функцию обратного вызова [xlfRegister (формы 1)](xlfregister-form-1.md) через интерфейс **Excel12** или **Excel12v** .</span><span class="sxs-lookup"><span data-stu-id="ac0d6-115">To register a UDF as cluster-safe, you must call the [xlfRegister (Form 1)](xlfregister-form-1.md) callback function through the **Excel12** or **Excel12v** interface.</span></span> <span data-ttu-id="ac0d6-116">Дополнительные сведения об этих интерфейсах можно [Excel4/Excel12](excel4-excel12.md) и [Excel4v/Excel12v](excel4v-excel12v.md).</span><span class="sxs-lookup"><span data-stu-id="ac0d6-116">For more information about these interfaces, see the [Excel4/Excel12](excel4-excel12.md) and [Excel4v/Excel12v](excel4v-excel12v.md).</span></span> <span data-ttu-id="ac0d6-117">Регистрация UDF как безопасный кластера с использованием **Excel4** или **Excel4v** интерфейса не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-117">Registering a UDF as cluster-safe through the **Excel4** or **Excel4v** interface is not supported.</span></span> 
  
<span data-ttu-id="ac0d6-118">Если зарегистрировать функцию в качестве безопасных кластера следует убедиться, что функция ведет себя в кластере безопасным способом.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-118">If you register a function as cluster-safe, you must ensure that the function behaves in a cluster-safe way.</span></span> <span data-ttu-id="ac0d6-119">Несмотря на то, что точное поведение соединитель кластера зависит от реализации, следует разработать вашей UDF для запуска в распределенной компьютерной системе и обладают следующими характеристиками:</span><span class="sxs-lookup"><span data-stu-id="ac0d6-119">Although the exact behavior of the cluster connector is implementation-specific, you should design your UDF to run on a distributed computer system and to have the following characteristics:</span></span>
  
- <span data-ttu-id="ac0d6-120">Пользовательской функции не следует полагаться на любой оперативной памяти.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-120">A UDF should not rely on any memory state.</span></span> <span data-ttu-id="ac0d6-121">Например, для пользовательской функции не следует полагаться на существующий кэш памяти.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-121">For example, a UDF should not rely on an existing in-memory cache.</span></span>
    
- <span data-ttu-id="ac0d6-122">Пользовательской функции не следует выполнять обратные вызовы Excel, которые не поддерживают поставщика соединитель кластера.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-122">A UDF should not perform Excel callbacks that the cluster connector provider does not support.</span></span>
    
<span data-ttu-id="ac0d6-123">В дополнение к поведение кластера safe существует следующие технические ограничения на кластер safe пользовательских функций.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-123">In addition to cluster-safe behavior, there are the following technical restrictions on cluster-safe UDFs:</span></span>
  
1. <span data-ttu-id="ac0d6-124">Аргументы XLOPER (типов «P», «R»).</span><span class="sxs-lookup"><span data-stu-id="ac0d6-124">No XLOPER arguments (types 'P', 'R').</span></span>
    
2. <span data-ttu-id="ac0d6-125">Аргументы XLOPER12, которые поддерживают диапазон ссылки (тип «U»).</span><span class="sxs-lookup"><span data-stu-id="ac0d6-125">No XLOPER12 arguments that support range references (type 'U').</span></span>
    
3. <span data-ttu-id="ac0d6-126">Не может быть эквивалентную функцию листа макросов («#» и "&amp;" нельзя сочетать).</span><span class="sxs-lookup"><span data-stu-id="ac0d6-126">Cannot be a macro sheet equivalent function ('#' and '&amp;' cannot be combined).</span></span>
    
<span data-ttu-id="ac0d6-127">Для пользовательских функций с меньшие времени выполнения затрат на разгрузки может быть больше, чем время, затраченное UDF для выполнения, операция над значением преимущества использования этой инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-127">For UDFs with shorter execution times, the overhead of offloading may be larger than the time it takes the UDF to execute, negating many of the benefits of using this infrastructure.</span></span>
  
> [!NOTE]
> <span data-ttu-id="ac0d6-128">Невозможно объявить UDF safe кластер как асинхронных пользовательских Функций.</span><span class="sxs-lookup"><span data-stu-id="ac0d6-128">You cannot declare a cluster-safe UDF as an asynchronous UDF.</span></span> 
  
<span data-ttu-id="ac0d6-129">Пользовательской функции можно определить, является ли он выполняется с помощью соединитель кластера с помощью вызова функции обратного вызова [xlRunningOnCluster](xlrunningoncluster.md) .</span><span class="sxs-lookup"><span data-stu-id="ac0d6-129">A UDF can determine whether it is being run using a cluster connector by calling the [xlRunningOnCluster](xlrunningoncluster.md) callback function.</span></span> 
  

