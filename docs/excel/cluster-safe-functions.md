---
title: Безопасные функции кластера
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
localization_priority: Normal
ms.assetid: 787badaf-8782-454d-a016-7eae83bbd8a9
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: d32925fcd5c3be7fe3e615ee2290f25c7595911c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33409302"
---
# <a name="cluster-safe-functions"></a>Безопасные функции кластера

**Область применения:** Excel 2013 | Office 2013 | Visual Studio 
  
В Excel 2013 Excel позволяет разгрузить вызовы функции пользовательской функции (UDF) в кластер высокопроизводительных вычислительных систем через выделенный интерфейс соединителя кластера. Compute Clusters поставщики предоставляют соединители кластера. Авторы UDF могут объявлять свои пользовательские функции как безопасные кластеры, а затем, когда присутствует соединитель кластера, Excel отправляет вызовы этих пользовательских функций в соединитель кластера для разгрузки.
  
Когда Excel обнаруживает в ходе пересчета ФАЙЛовую группу UDF, которая выполняется в данный момент, она передает имя модуля UDF, надежного для кластера, и все параметры соединителя кластера. Соединитель выполняет удаленный вызов UDF и возвращает результаты в Excel. Независимое вычисление продолжается, и когда соединитель кластера закончил выполнение UDF, он передает результаты в Excel и зависимые вычисления продолжаются. Механизм этого асинхронного поведения имитирует механизм, используемый асинхронными функциями UDF, за исключением того, что соединитель кластера управляет асинхронными аспектами, а не автором UDF. Как правило, в кластерном соединителе реализована оболочка XLL для загрузки XLL и запуска пользовательских функций на узлах вычислительного кластера.
  
Механизм объявления пользовательских функций в качестве надежного кластера похож на объявления пользовательских функций, которые являются безопасными для пересчета с несколькими потоками. Тем не менее, поскольку UDF не обязательно выполняется на том же компьютере, что и другие функции UDF из того же сеанса Excel, существуют различные рекомендации по написанию пользовательских функций, не защищенных с помощью кластера.
  
Чтобы зарегистрировать UDF в качестве надежной кластеризации, необходимо вызвать функцию обратного вызова [xlfRegister (Form 1)](xlfregister-form-1.md) с помощью интерфейса **Excel12** или **Excel12v** . Дополнительные сведения об этих интерфейсах приведены в статье [Excel4/Excel12](excel4-excel12.md) and [Excel4v/Excel12v](excel4v-excel12v.md). Регистрация UDF в качестве безопасной для кластеризации через интерфейс **Excel4** или **Excel4v** не поддерживается. 
  
Если вы регистрируете функцию как надежная Кластеризация, необходимо убедиться в том, что функция работает в кластерной безопасном способе. Несмотря на то, что точное поведение соединителя кластера зависит от реализации, необходимо разрабатывать UDF для работы на распределенном компьютере и иметь следующие характеристики:
  
- UDF не должно зависеть от состояния памяти. Например, UDF не должно опираться на существующий кэш в памяти.
    
- ФАЙЛовая система UDF не должна выполнять обратные вызовы Excel, которые не поддерживаются поставщиком соединителей кластера.
    
В дополнение к принципу работы в кластере существуют следующие технические ограничения для функций, безопасных в кластерах:
  
1. Не указаны аргументы XLOPER (Types ' P ', ' R ').
    
2. Нет аргументов XLOPER12, которые поддерживают ссылки на диапазоны (тип ' U ').
    
3. Не может быть эквивалентной функции листа макросов (' # '&amp;и ' ' не может быть объединено).
    
Если вы используете UDF с более коротким временем выполнения, затраты на разгрузку могут быть больше, чем время, требуемое для выполнения UDF, что позволяет инвертировать многие преимущества использования этой инфраструктуры.
  
> [!NOTE]
> Вы не можете объявить UDF, защищенную с помощью кластера, в качестве асинхронной UDF. 
  
С помощью UDF можно определить, выполняется ли он с помощью соединителя кластера, вызвав функцию обратного вызова [кслруннингонклустер](xlrunningoncluster.md) . 
  

