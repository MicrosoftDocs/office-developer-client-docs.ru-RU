---
title: Безопасные функции кластера
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
localization_priority: Normal
ms.assetid: 787badaf-8782-454d-a016-7eae83bbd8a9
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: d32925fcd5c3be7fe3e615ee2290f25c7595911c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33409302"
---
# <a name="cluster-safe-functions"></a>Безопасные функции кластера

**Область применения:** Excel 2013 | Office 2013 | Visual Studio 
  
В Excel 2013 Excel может разгрузить вызовы User-Defined Function (UDF) в высокоскоростной вычислительный кластер через выделенный интерфейс соединителю кластера. Поставщики кластеров вычислений предоставляют соединители кластера. Авторы UDF могут объявить свои UDF как кластерные безопасные, а затем, когда соединители кластера присутствуют, Excel отправляет вызовы этим UDFs в соединители кластера для разгрузки.
  
Когда Excel обнаруживает кластерную UDF во время пересчета, она передает имя запущенного XLL, имя безопасного кластера UDF и любые параметры соединителю кластера. Соединителю выполняется вызов UDF удаленно и возвращает результаты Excel. Не зависящие вычисления продолжаются, и когда соединителю кластера завершится запуск UDF, результаты будут Excel и зависящие вычисления будут продолжаться. Механизм этого асинхронного поведения имитирует механизм, используемый асинхронными UDF, за исключением того, что соединителю кластера управляют асинхронные аспекты вместо автора UDF. Как правило, соединитель кластера реализует shim XLL для загрузки XLLs и запуска UDF на вычислительных узлах кластера.
  
Механика объявления UDF как кластерной безопасности похожа на механизмы объявления UDF безопасными для многопоточной пересчета. Однако, поскольку UDF не обязательно работает на том же компьютере, что и другие UDF из того же сеанса Excel, при написании UDF с безопасностью кластера существуют различные соображения.
  
Чтобы зарегистрировать UDF как кластерную безопасность, необходимо вызвать функцию [вызова xlfRegister (Form 1)](xlfregister-form-1.md) с помощью интерфейса **Excel12** или **Excel12v.** Дополнительные сведения об этих интерфейсах см. в [таблицах Excel4/Excel12](excel4-excel12.md) и [Excel4v/Excel12v.](excel4v-excel12v.md) Регистрация UDF в качестве кластерного безопасного интерфейса **Excel4** или **Excel4v** не поддерживается. 
  
Если вы регистрируете функцию в качестве кластерной, необходимо убедиться, что она будет вести себя безопасно кластерно. Хотя точное поведение соединиттеля кластера зависит от реализации, необходимо разработать UDF для работы с распределенной компьютерной системой и иметь следующие характеристики:
  
- UDF не должен полагаться на состояние памяти. Например, UDF не должен полагаться на существующий кэш в памяти.
    
- UDF не должен выполнять Excel вызовов, которые поставщик соединителю кластера не поддерживает.
    
В дополнение к безопасному для кластера поведению существуют следующие технические ограничения для UDF с безопасностью кластера:
  
1. Нет аргументов XLOPER (типы "P", "R").
    
2. Нет аргументов XLOPER12, которые поддерживают ссылки на диапазон (тип "U").
    
3. Не может быть эквивалентной функции макроса ('#' и &amp; ' не может быть совмещена).
    
Для UDF с более коротким временем выполнения накладная часть разгрузки может быть больше времени, необходимого для выполнения UDF, что отрицает многие преимущества использования этой инфраструктуры.
  
> [!NOTE]
> Нельзя объявить групповую UDF асинхронной UDF. 
  
UDF может определить, запускается ли он с помощью соединителя кластера, позвонив в [функцию вызова xlRunningOnCluster.](xlrunningoncluster.md) 
  

