---
title: Безопасные функции кластера
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
localization_priority: Normal
ms.assetid: 787badaf-8782-454d-a016-7eae83bbd8a9
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: d32925fcd5c3be7fe3e615ee2290f25c7595911c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33409302"
---
# <a name="cluster-safe-functions"></a>Безопасные функции кластера

**Область применения:** Excel 2013 | Office 2013 | Visual Studio 
  
В Excel 2013 Excel может разгружать вызовы функции User-Defined (UDF) в высокоскоростной вычислительный кластер с помощью выделенного интерфейса соединителю кластера. Поставщики вычислительных кластеров предоставляют соединители кластера. Авторы UDF могут объявлять свои UDF как безопасные кластеры, а затем, когда соединитель кластера присутствует, Excel отправляет вызовы этим UDF соединителю кластера для разгрузки.
  
Когда Excel обнаруживает кластерную безопасную UDF во время пересчета, он передает имя запущенной ВТБ XLL, имя безопасной для кластера UDF и любые параметры соединителю кластера. Соединитель выполняет вызов UDF удаленно и возвращает результаты в Excel. Независимые вычисления продолжаются, и когда соединитель кластера завершит работу UDF, он передает результаты в Excel, и зависимые вычисления продолжаются. Механизм для этого асинхронного поведения имитирует механизм, используемый асинхронными UDF, за исключением того, что соединителю кластера управляют асинхронные аспекты, а не автор UDF. Как правило, соединитель кластера реализует shim XLL для загрузки XLL и запуска UDF на узлах вычислительного кластера.
  
Механизмы объявления UDF как кластеробезопасные похожи на механизмы объявления UDF как безопасных для многопотокового пересчета. Однако поскольку UDF не обязательно работает на том же компьютере, что и другие UDF из того же сеанса Excel, при написании безопасных для кластера UDF есть другие факторы.
  
Чтобы зарегистрировать UDF как кластеробезопасную, необходимо вызвать функцию вызова [xlfRegister (форма 1)](xlfregister-form-1.md) через интерфейс **Excel12** или **Excel12v.** Дополнительные сведения об этих интерфейсах см. в [excel4/Excel12](excel4-excel12.md) и [Excel4v/Excel12v.](excel4v-excel12v.md) Регистрация UDF в качестве кластерной с помощью интерфейса **Excel4** или **Excel4v** не поддерживается. 
  
Если вы регистрируете функцию как кластеробезопасную, необходимо убедиться, что она работает безопасным образом кластера. Хотя точное поведение соединителю кластера зависит от реализации, необходимо разработать UDF для работы в распределенной компьютерной системе и иметь следующие характеристики:
  
- UDF не должен зависеть от состояния памяти. Например, UDF не должен полагаться на существующий кэш в памяти.
    
- UDF не должна выполнять вызовы Excel, которые поставщик соединителю кластера не поддерживает.
    
В дополнение к безопасному для кластера поведению существуют следующие технические ограничения для безопасных кластерных УДО:
  
1. Нет аргументов XLOPER (типы P, R).
    
2. Нет аргументов XLOPER12, которые поддерживают ссылки на диапазоны (тип U).
    
3. Не может быть эквивалентной функцией листа макроса ('#' и &amp; ' не может быть объединено).
    
Для UDF с более коротким временем выполнения нагрузка на разгрузку может быть больше времени, необходимого для выполнения UDF, что не дает большого количества преимуществ использования этой инфраструктуры.
  
> [!NOTE]
> Невозможно объявить Асинхронную UDF, безопасную для кластера. 
  
Функция UDF может определить, будет ли она запускаться с помощью соединителя кластера, вызывая функцию вызова [xlRunningOnCluster.](xlrunningoncluster.md) 
  

