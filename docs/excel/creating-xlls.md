---
title: Создание XLL-модулей
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
keywords:
- библиотеки DLL [excel 2007], вызов в excel, функция xlAutoFree [Excel 2007], функция xlAutoFree12 [Excel 2007],xlcall32.lib [Excel 2007], функция xlAutoRegister [Excel 2007],xlcall.cpp [Excel 2007], функция xlAutoRemove [Excel 2007], xlAddInManagerInfo функция [Excel 2007], функция xlAutoAdd [Excel 2007], функция xlAutoOpen [Excel 2007], xlAutoClose функции [Excel 2007], DLL-библиотеки [Excel 2007], превращение в XLL-модулей, XLL-модулей [Excel 2007], вызов в Excel, функция xlAutoRegister12 [Excel 2007],xlcall.h [Excel 2007], xlAddInManagerInfo12 функции [Excel 2007]
localization_priority: Normal
ms.assetid: 7754998f-4e13-4a37-9724-43b6ee6c919b
description: '������� ����������: Excel 2013�| Office 2013�| Visual Studio'
ms.openlocfilehash: de347d34768c25adf0d96642b4fade781ae26a9c
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19807158"
---
# <a name="creating-xlls"></a>Создание XLL-модулей

**Применимо к**: Excel 2013 | Office 2013 | Visual Studio 
  
Если библиотеки DLL изолированная или только зависит от других библиотек, необходимо знать, как для включения Microsoft Excel для доступа к его функции и команды. Для получения дополнительных сведений см [Доступа к библиотекам DLL в Excel](how-to-access-dlls-in-excel.md). 
  
Тем не менее если для библиотеки DLL необходим доступ к функциям Excel (например, для получения содержимого ячейки, вызовите функцию листа или опроса Excel для получения информации из рабочей области), кода необходимо иметь возможность обратного вызова в Excel.
  
API-Интерфейс C Excel предоставляет несколько функций, которые позволяют DLL-библиотеки для обратного вызова в Excel. Для доступа к этим библиотеки DLL, должны быть связаны статической во время компиляции с библиотекой Excel 32-разрядная версия xlcall32.lib. Статические библиотеки загрузки от корпорации Майкрософт в составе Microsoft Excel 2013 XLL SDK, который включает в себя 32- и 64-разрядной версии этой библиотеки.
  
## <a name="enabling-dlls-to-call-back-into-excel"></a>Включение DLL-библиотеки для обратного вызова в Excel

Для библиотеки DLL иметь доступ к функциональности в Excel и получить или задать сведения о рабочей области, его необходимо получить адреса функции обратного вызова Excel **Excel4**, **Excel4v**, **Excel12**и **Excel12v**. Последние два были представлены в Excel 2007 и доступны в последующих версиях. Чтобы получить доступ ко всем из них, в проект библиотеки DLL необходимо включить ссылки на следующие файлы из пакета SDK XLL Excel 2013. Если вы хотите получить доступ к только первые два обратных вызовов (в любой версии Excel), проекта необходимо включить только первые два файла.
  
### <a name="xlcallh"></a>Xlcall.h

Файл Xlcall.h содержит следующие элементы:
  
- Функция прототипов все функции обратного вызова.
    
- Определения структур данных, которые используют процедуры обратного вызова для обмена данными между DLL или XLL и Excel и определения констант тип данных.
    
- Определения эквивалентами функции и команды интерфейса API для C рабочего листа, функции листа макросов и поддерживаемые команды Excel.
    
- Значения, возвращаемые определения функции обратного вызова.
    
Следует использовать **#include** директив для этого файла, прямо или косвенно через другой файл заголовка, все файлы, доступ к C API или, обработка типов данных, используемых C API. 
  
### <a name="xlcall32lib"></a>Xlcall32.lib

Библиотека Xlcall32.lib экспортирует первые два обратных вызовов, **Excel4** и **Excel4v**, а также функции **XlCallVer** . Без ссылки на эту библиотеку в проекте компоновщика не удается создать XLL при использовании любого из этих обратных вызовов в вашем коде. (Адреса этих функций можно получить путем связывания динамически эквивалентный Xlcall32.dll, которые копируются в систему как часть обычной установки Excel.) 
  
### <a name="xlcallcpp"></a>Xlcall.cpp

Обратные вызовы Excel **Excel12** и **Excel12v** не экспортируются в Xlcall32.lib. Это гарантирует, что XLL проектов, с которыми вы создаете, начиная с версии Excel 2007 также будет работать с более ранними версиями Excel. Модуль Xlcall.cpp содержит код для **Excel12** и **Excel12v** функций, которые позвонить в запись Excel выберите пункт начиная с версии Excel 2007 или возвращает значение безопасных ошибки при использовании более ранней версии Excel. В этом модуле следует включить в вашем проекте, если вы хотите создать XLL-модуль, который запускает, начиная с версии Excel 2007, и может использовать новые типы данных, которые обрабатывают сетки большего и более строк в кодировке Юникод. 
  
> [!NOTE]
> Начиная с пакет SDK Excel 2010, этот файл можно скомпилированные для 32- и 64-разрядная версия XLL-модулей. 
  
## <a name="turning-dlls-into-xlls-add-in-manager-interface-functions"></a>Включение библиотеки DLL в XLL-модулей: функции интерфейса диспетчера надстроек

XLL-модуль — это библиотека DLL, которая экспортирует некоторые процедуры, которые вызываются Excel или Диспетчер надстроек Excel. Эти процедуры кратко описаны здесь и рассмотрены в [Диспетчер надстроек и функции XLL интерфейса](add-in-manager-and-xll-interface-functions.md). Все эти обратные вызовы DLL начинаются с префикса **xlAuto**. Только один из этих команд **xlAutoOpen**является обязательным. Вызывается при активации надстройки, и он обычно используется для регистрации функции XLL и команды с помощью Excel и других задач инициализации. Функция подписи и примеры реализации всех функций **xlAuto** приведены в разделах более поздней версии. 
  
Несмотря на то, что **xlAutoOpen** является единственным обязательным эти обратные вызовы, добавьте в может также потребоваться для экспорта другим пользователям в зависимости от его поведение. 
  
Excel 2007 представлен новый тип данных, **XLOPER12**, для размещения больших таблиц и для поддержки длинных строк Юникод. **XLOPER12** описано далее в этом разделе. В то время как функции **xlAuto** занять или возвращаемых старый тип данных **XLOPER**, были представлены новые версии этих функций в Excel 2007, используйте типы данных **XLOPER12** . За исключением **xlAutoFree12**, которого необходимо реализовать в некоторых случаях во избежание памяти **XLOPER12** утечки, можно безопасно опустить все версии 12 **xlAuto** функции, в противном случае начиная с версии Excel 2007, Excel звонки **XLOPER** версии. 
  
### <a name="xlautoopen"></a>xlAutoOpen

Excel вызывает функцию [xlAutoOpen](xlautoopen.md) при активации XLL. Надстройка активируется в начале сеанса обмена Excel в случае active последнего сеанса Excel, нормально. Надстройка активируется при загрузке во время сеанса обмена Excel. Надстройки можно отключить и повторно во время сеанса обмена Excel, а функция, вызываемая при повторной активации. 
  
**XlAutoOpen** следует использовать для регистрации функций и команд XLL, инициализации структур данных, настройки пользовательского интерфейса и т.д. 
  
Если надстройка реализует и экспортирует функцию [xlAutoRegister](xlautoregister-xlautoregister12.md) или функцию [xlAutoRegister12](xlautoregister-xlautoregister12.md) , Excel может попытаться активировать и регистрация функции или команду без первого вызова функции **xlAutoOpen** . В этом случае необходимо убедиться, что надстройка достаточно инициализируется для функции или команду, чтобы работать должным образом. Если он не установлен, следует либо не попытки для регистрации функции или команды или выполнить необходимую инициализацию. 
  
### <a name="xlautoclose"></a>xlAutoClose

Excel вызывает функцию [xlAutoClose](xlautoclose.md) при XLL деактивирован. Надстройки будут отключены при завершении сеанса Excel обычно. Если пользователь отключает надстройку во время сеанса обмена Excel, вызывает функцию. 
  
**XlAutoClose** следует использовать для отмены регистрации функций и команд, освобождения ресурсов, отменить настроек и т.д. 
  
> [!NOTE]
> Существует известная проблема с отмены регистрации функций и команд. Для получения дополнительных сведений см [Известные проблемы при разработке XLL для Excel](known-issues-in-excel-xll-development.md). 
  
### <a name="xlautoadd"></a>xlAutoAdd

Excel вызывает [функцию xlAutoAdd](xlautoadd.md) каждый раз, когда пользователь активирует XLL во время сеанса обмена Excel с помощью диспетчера надстроек. Эта функция не вызывается при запуске и загрузка предустановленной надстройки Excel. 
  
Эта функция используется для отображения настраиваемого диалогового окна, о том, что надстройка активирована, чтение или запись в реестр или чтобы проверить сведения о лицензировании.
  
### <a name="xlautoremove"></a>xlAutoRemove

Excel вызывает функцию [xlAutoRemove](xlautoremove.md) каждый раз, когда пользователь деактивирует XLL во время сеанса обмена Excel с помощью диспетчера надстроек. Эта функция не вызывается при сеанс Excel закрывается, обычно или аварийно, с установленной надстройкой. 
  
Эта функция используется для отображения настраиваемого диалогового окна, о том, что надстройка отключен, чтение или запись в реестр.
  
### <a name="xladdinmanagerinfoxladdinmanagerinfo12"></a>xlAddInManagerInfo/xlAddInManagerInfo12

Excel вызывает функцию [xlAddInManagerInfo](xladdinmanagerinfo-xladdinmanagerinfo12.md) , когда диспетчер надстроек вызывается в первый раз в сеансе Excel. Если Excel передает аргумент, равное 1, эта функция возвращает строку (как правило, имя надстройки); в противном случае возвращается **#VALUE!**.
  
Начиная с версии Excel 2007, Excel вызывает функцию **xlAddInManagerInfo12** вместо функции **xlAddInManagerInfo** при экспорте с XLL. Функция **xlAddInManagerInfo12** должны работать так же, как в качестве функции **xlAddInManagerInfo** во избежание разных версий различия в поведении XLL. Функция **xlAddInManagerInfo12** должна вернуть тип данных **XLOPER12** , а функция **xlAddInManagerInfo** должна вернуть тип данных **XLOPER** . 
  
### <a name="xlautoregisterxlautoregister12"></a>xlAutoRegister/xlAutoRegister12

Excel вызывает функцию [xlAutoRegister](xlautoregister-xlautoregister12.md) каждый раз, когда вызов функции XLM, **Регистрация**или эквивалентный [xlfRegister](xlfregister-form-1.md) функции интерфейса API для C, с возврата аргумент типов и отсутствующие функции регистрации. Функция **xlAutoRegister** позволяет XLL-Модулей для поиска его внутренней списки экспортированных функций и команды, чтобы зарегистрировать функцию в аргументе и возврата указанного типа. 
  
Начиная с версии Excel 2007, Excel вызывает функцию **xlAddInRegister12** вместо функции **xlAddInRegister** при экспорте с XLL. 
  
> [!NOTE]
> Если **xlAddInRegister**/ **xlAddInRegister12** пытается зарегистрировать функцию без указания аргументов и возвращаемых типов, рекурсивного вызова цикл возникает, со временем переполнение стека вызовов и вызывает Excel закрыть или остановить отвечать на запросы. 
  
### <a name="xlautofreexlautofree12"></a>xlAutoFree/xlAutoFree12

Excel вызывает функцию [xlAutoFree/xlAutoFree12](xlautofree-xlautofree12.md) сразу после функция листа XLL возвращает **XLOPER**/ тип данных**XLOPER12** с установлен флаг, обозначающий памяти, XLL, по которой нужно освободить. Это позволяет XLL-Модулей для возврата динамически назначаемых массивов строк и внешние ссылки на лист без утечки памяти. Начиная с версии Excel 2007, тип данных **XLOPER12** поддерживается. Дополнительные сведения содержатся в разделе [Управление памятью в Excel](memory-management-in-excel.md).
  
> [!NOTE]
> Начиная с версии Excel 2007, когда Excel настроен на использование пересчета многопоточные листа, **xlAutoFree**/ на тот же поток, который использовался для вызова функции, он возвращается только что вызывается функция**xlAutoFree12** . Вызов **xlAutoFree**/ **xlAutoFree12** всегда выполняется до любого последующие ячейки оценки для данного потока. Это упрощает разработки потоками в вашей XLL. Для получения дополнительных сведений см [Многопоточные вычисления в Excel](multithreaded-recalculation-in-excel.md). 
  
### <a name="creating-64-bit-xlls"></a>Создание XLL-модулей 64-разрядная версия

Excel и пользовательские функции можно запустить на 64-разрядных операционных систем преимущество выигрыш в производительности по сравнению с 32-разрядных операционных системах. Excel передает значения в **XLOPER12** структуры, включая сведения о типах данных. Будьте внимательны, при преобразовании значения в структуре **XLOPER12** и собственным типам как **int** или указатели, чтобы сохранить значения в больший тип. 
  
## <a name="see-also"></a>См. также



[Вызов функции XLL из Мастер функций или заменить диалоговых окон](how-to-call-xll-functions-from-the-function-wizard-or-replace-dialog-boxes.md)
  
[Диспетчер надстроек и функции XLL интерфейса](add-in-manager-and-xll-interface-functions.md)
  
[���������� XLL-������� ��� Excel 2013](developing-excel-xlls.md)

