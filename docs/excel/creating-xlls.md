---
title: Создание библиотек XLL
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
keywords:
- DLL-файлы [Excel 2007], вызов в Excel, функция xlAutoFree [Excel 2007], функция xlAutoFree12 [Excel 2007], xlcall32.lib [Excel 2007], функция xlAutoRegister [Excel 2007], xlcall.cpp [Excel 2007], функция xlAutoRemove [Excel 2007], функция xlAddInManagerInfo [Excel 2007], функция xlAutoAdd [Excel 2007], функция xlAutoOpen [Excel 2007], функция xlAutoClose [Excel 2007], DLL-файлы [Excel 2007], преобразование в XLL-файлы, XLL-файлы [Excel 2007], вызов в Excel, функция xlAutoRegister12 [Excel 2007], xlcall.h [Excel 2007], функция xlAddInManagerInfo12 [Excel 2007]
ms.assetid: 7754998f-4e13-4a37-9724-43b6ee6c919b
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
localization_priority: Priority
ms.openlocfilehash: 886b8e74f00f2e724785d43475ee0ffa3c922710
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32304146"
---
# <a name="creating-xlls"></a><span data-ttu-id="3e7c1-104">Создание библиотек XLL</span><span class="sxs-lookup"><span data-stu-id="3e7c1-104">Creating XLLs</span></span>

<span data-ttu-id="3e7c1-105">**Область применения**: Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="3e7c1-105">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="3e7c1-106">Если ваша библиотека DLL автономная или зависит от других библиотек, необходимо знать, как обеспечить для Microsoft Excel доступ к ее функциям и командам.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-106">If your DLL is self-contained or relies only on other libraries, you must know how to enable Microsoft Excel to access its functions and commands.</span></span> <span data-ttu-id="3e7c1-107">Дополнительные сведения см. в статье [Доступ к библиотекам DLL в Excel](how-to-access-dlls-in-excel.md).</span><span class="sxs-lookup"><span data-stu-id="3e7c1-107">For more information, see [Access DLLs in Excel](how-to-access-dlls-in-excel.md).</span></span> 
  
<span data-ttu-id="3e7c1-108">Но если вашей библиотеке DLL требуется доступ к функциям Excel (например, для получения содержимого ячейки, вызова функции листа или запрашивания у Excel сведений о рабочей области), в коде необходимо предусмотреть возможность обратного вызова Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-108">However, if your DLL needs to access Excel functionality (for example, to get the contents of a cell, to call a worksheet function, or to interrogate Excel to obtain workspace information), your code must be able to call back into Excel.</span></span>
  
<span data-ttu-id="3e7c1-109">В API C Excel доступны несколько функций, которые обеспечивают для библиотек DLL возможность обратного вызова Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-109">The Excel C API provides several functions that enable DLLs to call back into Excel.</span></span> <span data-ttu-id="3e7c1-110">Для доступа к этим функциям библиотеку DLL во время компиляции необходимо статически связать с xlcall32.lib, 32-разрядной библиотекой Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-110">To access these, the DLL must be linked statically at compile time with the Excel 32-bit library, xlcall32.lib.</span></span> <span data-ttu-id="3e7c1-111">Статическую библиотеку можно скачать на сайте Майкрософт в составе пакета SDK XLL для Microsoft Excel 2013, в который входят 32- и 64-разрядная версии этой библиотеки.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-111">The static library is downloadable from Microsoft as part of the Microsoft Excel 2013 XLL SDK, which includes both 32-bit and 64-bit versions of this library.</span></span>
  
## <a name="enabling-dlls-to-call-back-into-excel"></a><span data-ttu-id="3e7c1-112">Обеспечение обратного вызова Excel для библиотек DLL</span><span class="sxs-lookup"><span data-stu-id="3e7c1-112">Enabling DLLs to Call Back into Excel</span></span>

<span data-ttu-id="3e7c1-113">Чтобы библиотека DLL могла получить доступ к функциям Excel и получить или задать сведения о рабочей области, она сначала должна получить адреса функций обратного вызова Excel (**Excel4**, **Excel4v**, **Excel12** и **Excel12v**).</span><span class="sxs-lookup"><span data-stu-id="3e7c1-113">For a DLL to be able to access the functionality in Excel and get or set workspace information, it must first obtain the addresses of the Excel callback functions **Excel4**, **Excel4v**, **Excel12**, and **Excel12v**.</span></span> <span data-ttu-id="3e7c1-114">Последние две функции, которые появились в Excel 2007, доступны в последующих версиях.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-114">The last two were introduced in Excel 2007 and are available in subsequent versions.</span></span> <span data-ttu-id="3e7c1-115">Чтобы получить доступ ко всем этим функциям, проект DLL должен включать ссылки на перечисленные ниже файлы, представленные в пакете SDK XLL для Excel 2013.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-115">To access all of these, the DLL project must include references to the following files from the Excel 2013 XLL SDK.</span></span> <span data-ttu-id="3e7c1-116">Если вы хотите получить доступ только к первым двум функциям обратного вызова (в любой версии Excel), проект должен включать только первые два файла.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-116">If you want to access only the first two callbacks (in any version of Excel), your project needs to include only the first two files.</span></span>
  
### <a name="xlcallh"></a><span data-ttu-id="3e7c1-117">Xlcall.h</span><span class="sxs-lookup"><span data-stu-id="3e7c1-117">Xlcall.h</span></span>

<span data-ttu-id="3e7c1-118">Файл Xlcall.h содержит следующие элементы:</span><span class="sxs-lookup"><span data-stu-id="3e7c1-118">The Xlcall.h file contains the following items:</span></span>
  
- <span data-ttu-id="3e7c1-119">прототипы функций для всех функций обратного вызова;</span><span class="sxs-lookup"><span data-stu-id="3e7c1-119">Function prototypes for all callback functions.</span></span>
    
- <span data-ttu-id="3e7c1-120">определения структур данных, которые используются в функциях обратного вызова для обмена данными между DLL или XLL и Excel, а также определения констант типов данных;</span><span class="sxs-lookup"><span data-stu-id="3e7c1-120">Definitions of the data structures that the callbacks use to exchange data between the DLL/XLL and Excel, and data-type constant definitions.</span></span>
    
- <span data-ttu-id="3e7c1-121">определения функции API C и эквивалентные команды для листа, функций листа макросов и поддерживаемых команд Excel;</span><span class="sxs-lookup"><span data-stu-id="3e7c1-121">Definitions of the C API function and command equivalents of the worksheet, macro sheet functions, and supported Excel commands.</span></span>
    
- <span data-ttu-id="3e7c1-122">определения возвращаемых значений функций обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-122">Definitions of callback function return values.</span></span>
    
<span data-ttu-id="3e7c1-123">Следует использовать директиву **#include** для этого файла (непосредственно или косвенно с помощью другого файла заголовка) во всех файлах, которые получают доступ к API C или обрабатывают типы данных, используемые в этом API.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-123">You should use the **#include** directive for this file, directly or indirectly via another header file, in all files that access the C API or that handle data types that the C API uses.</span></span> 
  
### <a name="xlcall32lib"></a><span data-ttu-id="3e7c1-124">Xlcall32.lib</span><span class="sxs-lookup"><span data-stu-id="3e7c1-124">Xlcall32.lib</span></span>

<span data-ttu-id="3e7c1-125">Библиотека Xlcall32.lib экспортирует первые две функции обратного вызова (**Excel4** и **Excel4v**), а также функцию **XlCallVer**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-125">The Xlcall32.lib library exports the first two callbacks, **Excel4** and **Excel4v**, and also the **XlCallVer** function.</span></span> <span data-ttu-id="3e7c1-126">Если в вашем проекте нет ссылки на эту библиотеку, компоновщик не сможет создать XLL-файл, если вы использовали любые из этих функций обратного вызова в своем коде.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-126">Without a reference to this library in your project, the linker cannot create the XLL if you have used any of these callbacks in your code.</span></span> <span data-ttu-id="3e7c1-127">(Адреса этих функций можно получить путем динамического связывания с эквивалентным файлом Xlcall32.dll, который копируется в систему во время обычной установки Excel.)</span><span class="sxs-lookup"><span data-stu-id="3e7c1-127">(You can obtain the addresses of these functions by linking dynamically to the equivalent Xlcall32.dll that is copied to your system as part of a normal Excel installation.)</span></span> 
  
### <a name="xlcallcpp"></a><span data-ttu-id="3e7c1-128">Xlcall.cpp</span><span class="sxs-lookup"><span data-stu-id="3e7c1-128">Xlcall.cpp</span></span>

<span data-ttu-id="3e7c1-129">Функции обратного вызова Excel **Excel12** и **Excel12v** не экспортируются в Xlcall32.lib.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-129">The Excel callbacks **Excel12** and **Excel12v** are not exported in Xlcall32.lib.</span></span> <span data-ttu-id="3e7c1-130">Благодаря этому проекты XLL, созданные в Excel 2007, также будут работать с более ранними версиями Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-130">This ensures that XLL projects that you create starting in Excel 2007 will also work with earlier versions of Excel.</span></span> <span data-ttu-id="3e7c1-131">Модуль Xlcall.cpp содержит код для функций **Excel12** и **Excel12v**, которые обеспечивают вызов точки входа в Excel, начиная с Excel 2007, или возвращают безопасное значение ошибки, если запущена более ранняя версия Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-131">The Xlcall.cpp module contains code for the **Excel12** and **Excel12v** functions, which call into an Excel entry point starting in Excel 2007, or return a safe error value if you are running an earlier version of Excel.</span></span> <span data-ttu-id="3e7c1-132">Этот модуль следует включить в проект, если вы хотите создать библиотеку XLL, которая запускается в Excel 2007 и в которой можно использовать новые типы данных, которые поддерживают обработку сеток большего размера и более длинных строк в Юникоде.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-132">You should include this module in your project if you want to create an XLL that runs starting in Excel 2007 and that is able to use the new data types that handle larger grids and longer Unicode strings.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="3e7c1-133">Начиная с пакета SDK для Excel 2010, этот файл можно компилировать для 32- и 64-разрядных библиотек XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-133">Starting with the Excel 2010 SDK, this file can be compiled for both 32-bit and 64-bit XLLs.</span></span> 
  
## <a name="turning-dlls-into-xlls-add-in-manager-interface-functions"></a><span data-ttu-id="3e7c1-134">Преобразование библиотек DLL в XLL: функции интерфейса диспетчера надстроек</span><span class="sxs-lookup"><span data-stu-id="3e7c1-134">Turning DLLs into XLLs: Add-in Manager Interface Functions</span></span>

<span data-ttu-id="3e7c1-135">XLL представляет собой библиотеку DLL, которая экспортирует несколько процедур, которые вызывает Excel или диспетчер надстроек Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-135">An XLL is a DLL that exports several procedures that are called by Excel or the Excel Add-in Manager.</span></span> <span data-ttu-id="3e7c1-136">Эти процедуры вкратце описываются в этой статье и подробно рассматриваются в статье [Функции диспетчера надстроек и интерфейса XLL](add-in-manager-and-xll-interface-functions.md).</span><span class="sxs-lookup"><span data-stu-id="3e7c1-136">These procedures are described briefly here and discussed in detail in [Add-in Manager and XLL Interface Functions](add-in-manager-and-xll-interface-functions.md).</span></span> <span data-ttu-id="3e7c1-137">Все эти функции обратного вызова DLL начинаются с префикса **xlAuto**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-137">All of these DLL callbacks start with the prefix **xlAuto**.</span></span> <span data-ttu-id="3e7c1-138">Обязательной является только одна из них, а именно команда **xlAutoOpen**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-138">Only one of these, the command **xlAutoOpen**, is required.</span></span> <span data-ttu-id="3e7c1-139">Она вызывается при активации надстройки и обычно используется для регистрации функций и команд XLL в Excel, а также для выполнения других задач инициализации.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-139">It is called when the add-in is activated, and it is typically used to register XLL functions and commands with Excel and to do other initialization tasks.</span></span> <span data-ttu-id="3e7c1-140">Сигнатуры функций и примеры реализации всех функций **xlAuto** приведены далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-140">The function signatures and example implementations of all of the **xlAuto** functions are provided in later sections.</span></span> 
  
<span data-ttu-id="3e7c1-141">Хотя среди всех этих функций обратного вызова обязательной является только функция **xlAutoOpen**, вашей надстройке также может понадобиться экспортировать другие функции в зависимости от ее поведения.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-141">Even though **xlAutoOpen** is the only required one of these callbacks, your add-in may also need to export others depending on its behavior.</span></span> 
  
<span data-ttu-id="3e7c1-142">В Excel 2007 представлен новый тип данных **XLOPER12**, который обеспечивает поддержку сеток большего размера и длинных строк в Юникоде.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-142">Excel 2007 introduced a new data type, **XLOPER12**, to accommodate larger grids and to support long Unicode strings.</span></span> <span data-ttu-id="3e7c1-143">Тип данных **XLOPER12** описан далее в этой статье.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-143">**XLOPER12** is described later in this topic.</span></span> <span data-ttu-id="3e7c1-144">В то время как функции **xlAuto** извлекают или возвращают старый тип данных **XLOPER**, в Excel 2007 представлены новые версии этих функций, в которых используются типы данных **XLOPER12**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-144">Whereas **xlAuto** functions take or return the old data type **XLOPER**, new versions of these functions were introduced in Excel 2007 that use **XLOPER12** data types.</span></span> <span data-ttu-id="3e7c1-145">За исключением функции **xlAutoFree12**, которую иногда необходимо внедрить во избежание утечек памяти **XLOPER12**, вы можете безопасно пропустить установку всех функций **xlAuto** версии 12. В этом случае Excel 2007 и более поздних версий будет вызывать версии **XLOPER**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-145">With the exception of **xlAutoFree12**, which you must sometimes implement to avoid **XLOPER12** memory leaks, you can safely omit all the version 12 **xlAuto** functions, in which case, starting in Excel 2007, Excel calls the **XLOPER** versions.</span></span> 
  
### <a name="xlautoopen"></a><span data-ttu-id="3e7c1-146">xlAutoOpen</span><span class="sxs-lookup"><span data-stu-id="3e7c1-146">xlAutoOpen</span></span>

<span data-ttu-id="3e7c1-147">Excel вызывает функцию [xlAutoOpen](xlautoopen.md) при активации библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-147">Excel calls the [xlAutoOpen](xlautoopen.md) function whenever the XLL is activated.</span></span> <span data-ttu-id="3e7c1-148">Надстройка будет активирована при запуске сеанса Excel, если она была активна во время последнего сеанса Excel, который нормально завершил работу.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-148">The add-in will be activated at the start of an Excel session if it was active in the last Excel session that ended normally.</span></span> <span data-ttu-id="3e7c1-149">Надстройка активируется при загрузке во время сеанса Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-149">The add-in is activated if it is loaded during an Excel session.</span></span> <span data-ttu-id="3e7c1-150">Надстройку можно выключить и повторно активировать во время сеанса Excel. Вызов функции выполняется после повторной активации.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-150">The add-in can be deactivated and reactivated during an Excel session, and the function is called on reactivation.</span></span> 
  
<span data-ttu-id="3e7c1-151">Функцию **xlAutoOpen** следует использовать для регистрации функций и команд XLL, инициализации структур данных, настройки пользовательского интерфейса и других задач.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-151">You should use **xlAutoOpen** to register XLL functions and commands, initialize data structures, customize the user interface, and so on.</span></span> 
  
<span data-ttu-id="3e7c1-152">Если ваша надстройка реализует и экспортирует функцию [xlAutoRegister](xlautoregister-xlautoregister12.md) или [xlAutoRegister12](xlautoregister-xlautoregister12.md), Excel может попытаться активировать и зарегистрировать функцию или команду, не вызывая функцию **xlAutoOpen**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-152">If your add-in implements and exports the [xlAutoRegister](xlautoregister-xlautoregister12.md) function or the [xlAutoRegister12](xlautoregister-xlautoregister12.md) function, Excel might attempt to activate and register a function or command without first calling the **xlAutoOpen** function.</span></span> <span data-ttu-id="3e7c1-153">В этом случае следует убедиться, что ваша надстройка инициализирована в достаточной мере для правильной работы функции или команды.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-153">In this case, you should ensure that your add-in is sufficiently initialized for your function or command to work properly.</span></span> <span data-ttu-id="3e7c1-154">В противном случае вам может не удаться зарегистрировать функцию или команду либо выполнить необходимые действия по инициализации.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-154">If it is not, you should either fail the attempt to register the function or command, or carry out the necessary initialization.</span></span> 
  
### <a name="xlautoclose"></a><span data-ttu-id="3e7c1-155">xlAutoClose</span><span class="sxs-lookup"><span data-stu-id="3e7c1-155">xlAutoClose</span></span>

<span data-ttu-id="3e7c1-156">Excel вызывает функцию [xlAutoClose](xlautoclose.md) при выключении библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-156">Excel calls the [xlAutoClose](xlautoclose.md) function whenever the XLL is deactivated.</span></span> <span data-ttu-id="3e7c1-157">Надстройка будет отключена после нормального завершения сеанса Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-157">The add-in will be deactivated when an Excel session ends normally.</span></span> <span data-ttu-id="3e7c1-158">Если пользователь отключает надстройку во время сеанса Excel, выполняется вызов функции.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-158">If the user deactivates the add-in during an Excel session, the function is called.</span></span> 
  
<span data-ttu-id="3e7c1-159">Функцию **xlAutoClose** следует использовать для отмены регистрации функций и команд, освобождения ресурсов, отмены настроек и других задач.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-159">You should use **xlAutoClose** to unregister functions and commands, release resources, undo customizations, and so on.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="3e7c1-160">При отмене регистрации функций и команд возникает известная проблема.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-160">There is a known issue with the unregistration of functions and commands.</span></span> <span data-ttu-id="3e7c1-161">Дополнительные сведения см. в статье [Известные проблемы, возникающие при разработке XLL для Excel](known-issues-in-excel-xll-development.md).</span><span class="sxs-lookup"><span data-stu-id="3e7c1-161">For more information, see [Known Issues in Excel XLL Development](known-issues-in-excel-xll-development.md).</span></span> 
  
### <a name="xlautoadd"></a><span data-ttu-id="3e7c1-162">xlAutoAdd</span><span class="sxs-lookup"><span data-stu-id="3e7c1-162">xlAutoAdd</span></span>

<span data-ttu-id="3e7c1-163">Excel вызывает функцию [xlAutoAdd](xlautoadd.md), когда пользователь с помощью диспетчера надстроек активирует библиотеку XLL во время сеанса Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-163">Excel calls the [xlAutoAdd function](xlautoadd.md) whenever the user activates the XLL during an Excel session by using the Add-In Manager.</span></span> <span data-ttu-id="3e7c1-164">Вызов этой функции не выполняется, когда Excel при запуске загружает предустановленную надстройку.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-164">This function is not called when Excel starts and loads a preinstalled add-in.</span></span> 
  
<span data-ttu-id="3e7c1-165">С помощью этой функции можно отобразить настраиваемое диалоговое окно с уведомлением об активации надстройки, считать данные из реестра или записать их в реестр, а также проверить сведения о лицензировании.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-165">You can use this function to display a custom dialog box that tells the user that the add-in has been activated, to read from or write to the registry, or to check licensing information.</span></span>
  
### <a name="xlautoremove"></a><span data-ttu-id="3e7c1-166">xlAutoRemove</span><span class="sxs-lookup"><span data-stu-id="3e7c1-166">xlAutoRemove</span></span>

<span data-ttu-id="3e7c1-167">Excel вызывает функцию [xlAutoRemove](xlautoremove.md), когда пользователь с помощью диспетчера надстроек отключает библиотеку XLL во время сеанса Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-167">Excel calls the [xlAutoRemove](xlautoremove.md) function whenever the user deactivates the XLL during an Excel session by using the Add-In Manager.</span></span> <span data-ttu-id="3e7c1-168">Вызов этой функции не выполняется, если сеанс Excel закрывается (правильно или ненормально) при установленной надстройке.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-168">This function is not called when an Excel session closes, normally or abnormally, with the add-in installed.</span></span> 
  
<span data-ttu-id="3e7c1-169">С помощью этой функции можно отобразить настраиваемое диалоговое окно с уведомлением об отключении надстройки, а также считать данные из реестра или записать их в реестр.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-169">You can use this function to display a custom dialog box that tells the user that the add-in has been deactivated, or to read from or write to the registry.</span></span>
  
### <a name="xladdinmanagerinfoxladdinmanagerinfo12"></a><span data-ttu-id="3e7c1-170">xlAddInManagerInfo и xlAddInManagerInfo12</span><span class="sxs-lookup"><span data-stu-id="3e7c1-170">xlAddInManagerInfo/xlAddInManagerInfo12</span></span>

<span data-ttu-id="3e7c1-171">Excel вызывает функцию [xlAddInManagerInfo](xladdinmanagerinfo-xladdinmanagerinfo12.md) при первом вызове диспетчера надстроек во время сеанса Excel.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-171">Excel calls the [xlAddInManagerInfo](xladdinmanagerinfo-xladdinmanagerinfo12.md) function when the Add-in Manager is invoked for the first time in an Excel session.</span></span> <span data-ttu-id="3e7c1-172">Если в Excel передается аргумент, равный 1, эта функция должна возвратить строку (как правило, имя надстройки). В противном случае она возвращает значение **#VALUE!**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-172">If Excel passes an argument equal to 1, this function should return a string (typically, the name of the add-in); otherwise, it should return **#VALUE!**.</span></span>
  
<span data-ttu-id="3e7c1-173">Начиная с Excel 2007, Excel в первую очередь вызывает функцию **xlAddInManagerInfo12**, а не **xlAddInManagerInfo**, если она экспортирована с помощью библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-173">Starting in Excel 2007, Excel calls the **xlAddInManagerInfo12** function in preference to the **xlAddInManagerInfo** function if it is exported by the XLL.</span></span> <span data-ttu-id="3e7c1-174">Функция **xlAddInManagerInfo12** должна работать так же, как функция **xlAddInManagerInfo**, во избежание характерных для версий различий в поведении библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-174">The **xlAddInManagerInfo12** function should work in the same way as the **xlAddInManagerInfo** function to avoid version-specific differences in the behavior of the XLL.</span></span> <span data-ttu-id="3e7c1-175">Функция **xlAddInManagerInfo12** должна возвращать тип данных **XLOPER12**, а функция **xlAddInManagerInfo** — тип данных **XLOPER**.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-175">The **xlAddInManagerInfo12** function should return an **XLOPER12** data type, whereas the **xlAddInManagerInfo** function should return an **XLOPER** data type.</span></span> 
  
### <a name="xlautoregisterxlautoregister12"></a><span data-ttu-id="3e7c1-176">xlAutoRegister и xlAutoRegister12</span><span class="sxs-lookup"><span data-stu-id="3e7c1-176">xlAutoRegister/xlAutoRegister12</span></span>

<span data-ttu-id="3e7c1-177">Excel вызывает функцию [xlAutoRegister](xlautoregister-xlautoregister12.md) при вызове функции XLM **REGISTER** или аналогичной функции [xlfRegister](xlfregister-form-1.md), предусмотренной в API C, если для регистрируемой функции отсутствуют типы возвращаемого значения и аргумента.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-177">Excel calls the [xlAutoRegister](xlautoregister-xlautoregister12.md) function whenever a call has been made to the XLM function **REGISTER**, or the C API equivalent [xlfRegister](xlfregister-form-1.md) function, with the return and argument types missing for the function being registered.</span></span> <span data-ttu-id="3e7c1-178">С помощью функции **xlAutoRegister** библиотека XLL может выполнить поиск в своих внутренних списках экспортированных функций и команд, чтобы зарегистрировать функцию с аргументом и вернуть указанные типы.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-178">The **xlAutoRegister** function allows the XLL to search its internal lists of exported functions and commands to register the function with the argument and return the specified types.</span></span> 
  
<span data-ttu-id="3e7c1-179">Начиная с Excel 2007, Excel в первую очередь вызывает функцию **xlAddInRegister12**, а не **xlAddInRegister**, если она экспортирована с помощью библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-179">Starting in Excel 2007, Excel calls the **xlAddInRegister12** function in preference to the **xlAddInRegister** function if it is exported by the XLL.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="3e7c1-180">Если функция **xlAddInRegister**/ **xlAddInRegister12** пытается зарегистрировать функцию, не предоставив типы аргумента и возвращаемого значения, наблюдается рекурсивный цикл вызовов, вследствие чего стек вызовов постепенно переполняется, а Excel закрывается или перестает отвечать на запросы.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-180">If **xlAddInRegister**/ **xlAddInRegister12** tries to register the function without supplying the argument and return types, a recursive calling loop occurs that eventually overflows the call stack and causes Excel to close or stop responding.</span></span> 
  
### <a name="xlautofreexlautofree12"></a><span data-ttu-id="3e7c1-181">xlAutoFree и xlAutoFree12</span><span class="sxs-lookup"><span data-stu-id="3e7c1-181">xlAutoFree/xlAutoFree12</span></span>

<span data-ttu-id="3e7c1-182">Excel вызывает функцию [xlAutoFree или xlAutoFree12](xlautofree-xlautofree12.md) только после того, как функция листа XLL возвращает тип данных **XLOPER**/ **XLOPER12** с установленным флагом о наличии памяти, которую все еще необходимо освободить с помощью библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-182">Excel calls the [xlAutoFree/xlAutoFree12](xlautofree-xlautofree12.md) function just after an XLL worksheet function returns an **XLOPER**/ **XLOPER12** data type with a flag set that tells Excel there is memory that the XLL still needs to release.</span></span> <span data-ttu-id="3e7c1-183">Благодаря этому библиотека XLL может вернуть динамически выделяемые массивы, строки и внешние ссылки на лист без утечек памяти.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-183">This enables the XLL to return dynamically allocated arrays, strings, and external references to the worksheet without memory leaks.</span></span> <span data-ttu-id="3e7c1-184">Тип данных **XLOPER12** поддерживается, начиная с Excel 2007.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-184">Starting in Excel 2007, the **XLOPER12** data type is supported.</span></span> <span data-ttu-id="3e7c1-185">Дополнительные сведения см. в статье [Управление памятью в Excel](memory-management-in-excel.md).</span><span class="sxs-lookup"><span data-stu-id="3e7c1-185">For more information, see [Memory Management in Excel](memory-management-in-excel.md).</span></span>
  
> [!NOTE]
> <span data-ttu-id="3e7c1-186">Начиная с Excel 2007, при настройке Excel на многопоточный пересчет листа функция **xlAutoFree**/ **xlAutoFree12** вызывается для потока, который только что использовался для вызова функции, возвратившей его.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-186">Starting in Excel 2007, when Excel is configured to use multithreaded worksheet recalculation, the **xlAutoFree**/ **xlAutoFree12** function is called on the same thread that was just used to call the function that returned it.</span></span> <span data-ttu-id="3e7c1-187">Вызов функции **xlAutoFree**/ **xlAutoFree12** всегда выполняется перед оценкой последующих ячеек листа для этого потока.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-187">The call to **xlAutoFree**/ **xlAutoFree12** is always made before any subsequent worksheet cells are evaluated on that thread.</span></span> <span data-ttu-id="3e7c1-188">Это упрощает потокобезопасную разработку библиотеки XLL.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-188">This simplifies thread-safe design in your XLL.</span></span> <span data-ttu-id="3e7c1-189">Дополнительные сведения см. в статье [Многопотоковый пересчет в Excel](multithreaded-recalculation-in-excel.md).</span><span class="sxs-lookup"><span data-stu-id="3e7c1-189">For more information, see [Multithreaded Recalculation in Excel](multithreaded-recalculation-in-excel.md).</span></span> 
  
### <a name="creating-64-bit-xlls"></a><span data-ttu-id="3e7c1-190">Создание 64-разрядных библиотек XLL</span><span class="sxs-lookup"><span data-stu-id="3e7c1-190">Creating 64-bit XLLs</span></span>

<span data-ttu-id="3e7c1-191">Excel и определяемые пользователем функции можно выполнять в 64-разрядных операционных системах, ведь они более производительны, если сравнивать их с 32-разрядными операционными системами.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-191">Excel and user-defined functions can run on 64-bit operating systems to take advantage of performance benefits over 32-bit operating systems.</span></span> <span data-ttu-id="3e7c1-192">Excel передает значения в структуры **XLOPER12**, которые включают сведения о типах данных.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-192">Excel passes values in **XLOPER12** structures that include information about the types for the data.</span></span> <span data-ttu-id="3e7c1-193">При преобразовании значений в структуре **XLOPER12** и собственных типах, таких как **int** или указатели, должны сохраниться значения в большем типе.</span><span class="sxs-lookup"><span data-stu-id="3e7c1-193">Be careful when you convert between values in the **XLOPER12** structure and native types like **int** or pointers to preserve the values in the larger type.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="3e7c1-194">См. также</span><span class="sxs-lookup"><span data-stu-id="3e7c1-194">See also</span></span>



[<span data-ttu-id="3e7c1-195">Вызов функций XLL из диалоговых окон "Мастер функций" и "Замена"</span><span class="sxs-lookup"><span data-stu-id="3e7c1-195">Call XLL Functions from the Function Wizard or Replace Dialog Boxes</span></span>](how-to-call-xll-functions-from-the-function-wizard-or-replace-dialog-boxes.md)
  
[<span data-ttu-id="3e7c1-196">Функции диспетчера надстроек и интерфейса XLL</span><span class="sxs-lookup"><span data-stu-id="3e7c1-196">Add-in Manager and XLL Interface Functions</span></span>](add-in-manager-and-xll-interface-functions.md)
  
[<span data-ttu-id="3e7c1-197">Разработка XLL-файлов для Excel</span><span class="sxs-lookup"><span data-stu-id="3e7c1-197">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

