---
title: Excel4/Excel12
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
f1_keywords:
- Excel12
- Excel4
keywords:
- функция Excel4 [excel 2007], функция Excel12 [Excel 2007]
localization_priority: Normal
ms.assetid: 2404f10d-8641-4ee6-a909-1c5a26610f80
description: 'Относится к: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: c7caf4923e336020928006f6838de5eaeba814a4
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22586811"
---
# <a name="excel4excel12"></a>Excel4/Excel12

**Относится к**: Excel 2013 | Office 2013 | Visual Studio 
  
Вызывает внутренней функции Microsoft Excel, функцию листа макросов или команды, или только для XLL специальные функции или команды, из DLL или XLL или кода ресурса.
  
Все последние версии Excel поддерживают **Excel4**. Начиная с версии Excel 2007, **Excel12** поддерживается. 
  
Эти функции могут вызываться только в том случае, когда Excel истекло управления DLL или XLL. Они также могут вызываться, когда Excel истекло управления косвенно через вызов Visual Basic для приложений (VBA). Они не могут вызывать в любое время. К примеру, они не может вызываться во время вызова функции [DllMain](https://docs.microsoft.com/windows/desktop/dlls/dllmain) или в других случаях при операционная система называется библиотеки DLL или из потока, созданного библиотеки DLL. 
  
Функции [Excel4v и Excel12v](excel4v-excel12v.md) примите их аргументах как массив, тогда как функции **Excel4** и **Excel12** примите их аргументах как список переменной длины в стеке. Во всех других отношениях **Excel4** происходит так же, как **Excel4v**и **Excel12** происходит так же, как **Excel12v**.
  
```cs
int Excel4(int iFunction, LPXLOPER pxRes, int iCount, LPXLOPER argument1, ...);
int Excel12(int iFunction, LPXLOPER12 pxRes, int iCount, LPXLOPER12 argument1, ...);
```

## <a name="parameters"></a>Параметры

 _iFunction_ (**int**)
  
Число, указывающее команды, функции или специальные функции, которому нужно позвонить. Список значений допустимый _iFunction_ в следующем разделе Примечания. 
  
 _pxRes_ (**LPXLOPER** или **LPXLOPER12**)
  
Указатель на **XLOPER** (с **Excel4**) или **XLOPER12** (с **Excel12**), который будет содержать результат вычисления функции.
  
 _iCount_ (**int**)
  
Число последующих аргументов, передаваемых в функцию. В версиях Excel до 2003 это может быть любое число от 0 до 30. Начиная с версии Excel 2007, это может быть любое число от 0 до 255.
  
 _аргумент1..._ (**LPXLOPER** или **LPXLOPER12**)
  
Необязательные аргументы для функции. Все аргументы должны быть указатели на **XLOPER** или **XLOPER12** значения. 
  
## <a name="return-value"></a>������������ ��������

Возвращает одно из следующих значений integer (**целое**).
  
|**Значение**|**Код возврата**|**Описание**|
|:-----|:-----|:-----|
|0  <br/> |**xlretSuccess** <br/> |Функция успешного вызова. Это означает, что функция не вернула значение ошибки Excel; Чтобы выяснить это, необходимо посмотреть на тип и значение параметра итоговый _pxRes_ .  <br/> |
|1  <br/> |**xlretAbort** <br/> |Команда или функция было прервано (Внутреннее прекращение). Это может произойти, если на лист макросов XLM закрывает самого путем вызова **ЗАКРЫТЬ**или недостаточно памяти для Excel. Если Excel возвращает эту ошибку, вызывающей функции должны выйти немедленно. Библиотеки DLL разрешено вызывать **xlFree** только перед выходом из. Все вызовы для интерфейса API для C не разрешены. Пользователь может сохранить каких-либо действий интерактивно с помощью команды **Сохранить** в меню **файл** .  <br/> |
|2  <br/> |**xlretInvXlfn** <br/> |Указано недопустимое функция номер. При использовании констант из файла заголовка Xlcall.h это не должно происходить только то, что не поддерживается в версии Excel выполняется при подключении.  <br/> |
|4  <br/> |**xlretInvCount** <br/> |Недопустимое число аргументов был введен. В версиях до Excel 2003 максимальное количество аргументы, которые может принимать любую функцию: 30. Начиная с версии Excel 2007, не более 255. Некоторые требуют фиксированной или минимальное количество аргументов.  <br/> |
|8  <br/> |**xlretInvXloper** <br/> |Недопустимые **XLOPER** или **XLOPER12** был передан в функцию или используется аргумент недопустимого типа.  <br/> |
|16  <br/> |**xlretStackOvfl** <br/> |Произошло переполнение стека. Используйте **xlStack** для отслеживания объем места слева в стеке. Избегайте распределения очень большой локальных массивов (автоматическое) и структуры в стеке, где это возможно; сделать их статического. (Обратите внимание на то, что этого не может произойти переполнение стека).  <br/> |
|32  <br/> |**xlretFailed** <br/> |Эквивалент команды функции произошел сбой. Это эквивалентно команда макрос, отображает диалоговое окно оповещения об ошибках макрос.  <br/> |
|64  <br/> |**xlretUncalced** <br/> |Предпринята попытка разыменовывать ячейка, которая имеет еще не рассчитан, поскольку оно запланировано пересчет после текущей ячейки. В этом случае библиотеки DLL необходимо вернуть управление Excel сразу же. Библиотеки DLL разрешено вызывать **xlFree** только перед выходом из. Все вызовы для интерфейса API для C не разрешены. Дополнительные сведения о том, какие функции могут и не может получить доступ к значений ячеек, которые не были перерасчете можно [Excel команды, функции и состояния](excel-commands-functions-and-states.md).  <br/> |
|128  <br/> |**xlretNotThreadSafe** <br/> |Предпринята попытка вызова функции, который не является или может быть потокобезопасными во время многопоточные пересчета книги.  <br/> Начиная с версии Excel 2007, возвращается это значение, и только в пределах функции XLL объявлен как потокобезопасными.  <br/> |
|256  <br/> |**xlRetInvAsynchronousContext** <br/> |Недопустимый дескриптор асинхронные функции.  <br/> Это значение используется только в Excel 2010.  <br/> |
|512  <br/> |**xlRetNotClusterSafe** <br/> |Вызов не поддерживается для кластеров.  <br/> Это значение используется только в Excel 2010.  <br/> |
   
## <a name="remarks"></a>Замечания

### <a name="valid-ifunction-values"></a>Допустимый iFunction значения

Значения допустимого **iFunction** действительно ли **xlf...** или **xlc...** константами, определенными в файле Xlcall.h заголовка или любой из следующих специальных функций. 
  
|||||
|:-----|:-----|:-----|:-----|
|**xlAbort** <br/> |**xlEnableXLMsgs** <br/> |**xlGetInst** <br/> |**xlSheetNm** <br/> |
|**xlCoerce** <br/> |**xlFree** <br/> |**xlGetName** <br/> |**xlStack** <br/> |
|**xlDefineBinaryName** <br/> |**xlGetBinaryName** <br/> |**xlSet** <br/> |**xlUDF** <br/> |
|**xlDisableXLMsgs** <br/> |**xlGetHwnd** <br/> |**xlSheetId** <br/> ||
   
### <a name="different-types-of-functions"></a>Различные типы функций

 **Excel4** и **Excel12** различения три класса функций. Функции классифицируются в соответствии с трех состояний, в которых Excel могут вызывать библиотеку DLL. 
  
- Класс 1 применяется при вызове DLL из листа из-за пересчета. 
    
- Класс 2 применен библиотеки DLL вызывается из макроса функции или из листа которых было зарегистрировано с решетки (#) в типа text.
    
- Класс 3 применяется при вызове DLL из объекта, макросов, меню, панели инструментов, сочетания клавиш, метод **ExecuteExcel4Macro** или **Средства/макрос и выполнить** команду. Для получения дополнительных сведений см [Excel команды, функции и состояния](excel-commands-functions-and-states.md).
    
В следующей таблице показаны какие функции являются допустимыми в каждый класс.
  
|**Класс 1**|**Класс 2**|**Класс 3**|
|:-----|:-----|:-----|
|Любая другая функция  <br/> Любой функции XLL-только **xl...** , за исключением **функция xlSet**.  <br/> **xlfCaller** <br/> |Любая другая функция  <br/> Любой функции **xl...** , за исключением **функция xlSet**.  <br/> Макрос функции листа, включая **xlfCaller**, которые возвращают значение, но выполнять никаких действий, который влияет на рабочей области или любой открытой книге.  <br/> |Все функции, включая функции эквивалент команды и **функция xlSet** .  <br/> |
   
### <a name="displaying-the-dialog-box-for-a-command-equivalent-function"></a>Отображает диалоговое окно для функции эквивалент команды

Если функция эквивалент команды диалоговое окно с связанного, бита **xlPrompt** в **iFunction**. Это означает, что Excel отображает диалоговое окно соответствующие перед выполнением команды.
  
### <a name="writing-international-dlls"></a>Написание международные библиотеки DLL

Если установить **библиотеки xlIntl** бит в **iFunction**, функции или команда выполняется как если бы были вызываемой из таблицы International макрос. Это означает, что команда происходит так, как если бы в США версии Excel, даже в том случае, если он работает на международных (локализованный) версии.
  
### <a name="xlretuncalced-or-xlretabort"></a>xlretUncalced или xlretAbort

После получения одно из этих значений, библиотеки DLL необходимо очистить и возврата в Excel немедленно. Обратных вызовов в Excel с помощью интерфейса API для C, за исключением **xlFree**отключены после получения одно из следующих значений.
  
## <a name="example"></a>Пример

Следующий пример использует функцию **Excel12** выберите пункт ячейка, из которой был вызван. 
  
Этот пример кода является частью большего примера, приведенного в Excel 2010 XLL SDK, в следующем расположении, где установлен пакет SDK:
  
\Samples\Example\Example.c.
  
> [!NOTE]
> Эта функция вызывает команду макросов (xlcSelect) и, таким образом, работает только в том случае, если он вызывается из таблицы макросов XLM. 
  
```cs
short WINAPI Excel12Example(void)
{
    XLOPER12 xRes;
    Excel12(xlfCaller, &xRes, 0);
    Excel12(xlcSelect, 0, 1, (LPXLOPER12)&xRes);
    Excel12(xlFree, 0, 1, (LPXLOPER12)&xRes);
    return 1;
}
```

## <a name="see-also"></a>См. также



[Excel4v/Excel12v](excel4v-excel12v.md)

