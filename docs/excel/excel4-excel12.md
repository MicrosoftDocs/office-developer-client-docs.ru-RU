---
title: Excel4/Excel12
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
f1_keywords:
- Excel12
- Excel4
keywords:
- функция excel4 [Excel 2007], функция Excel12 [Excel 2007]
localization_priority: Normal
ms.assetid: 2404f10d-8641-4ee6-a909-1c5a26610f80
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: 7c3af5f380ae4144890b1f7b486a61a05c19de74
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33429448"
---
# <a name="excel4excel12"></a>Excel4/Excel12

**Область применения:** Excel 2013 | Office 2013 | Visual Studio 
  
Вызывает внутреннюю Microsoft Excel, функцию или команду листа макроса или специальную функцию или команду только для XLL из ресурса DLL/XLL или кода.
  
Все последние версии Excel **поддерживают Excel4.** Начиная с Excel 2007 **года, Excel12** поддерживается. 
  
Эти функции могут быть вызваны только Excel, когда управление передано DLL или XLL. Их также можно вызвать, Excel, которые косвенно передали управление с помощью вызова Visual Basic для приложений (VBA). Они не могут быть вызваны в любое другое время. Например, они не могут быть вызваны во время вызовов на функцию [DllMain](https://docs.microsoft.com/windows/desktop/dlls/dllmain) или в другое время, когда операционная система вызывает DLL, или из потока, созданного DLL. 
  
Функции [Excel4v и Excel12v](excel4v-excel12v.md) принимают их аргументы в качестве массива, в то время как функции **Excel4** и **Excel12** принимают их аргументы в качестве списка переменной длины в стеке. Во всех остальных отношениях **Excel4** ведет себя так же, как **и Excel4v,** **а Excel12** ведет себя так же, как **и Excel12v.**
  
```cs
int Excel4(int iFunction, LPXLOPER pxRes, int iCount, LPXLOPER argument1, ...);
int Excel12(int iFunction, LPXLOPER12 pxRes, int iCount, LPXLOPER12 argument1, ...);
```

## <a name="parameters"></a>Parameters

 _iFunction_ **(int)**
  
Номер, который указывает команду, функцию или специальную функцию, которую необходимо вызвать. Список допустимого  _значения iFunction_ см. в следующем разделе Примечание. 
  
 _pxRes_ **(LPXLOPER** или **LPXLOPER12)**
  
Указатель на **XLOPER** (с **Excel4)** или **XLOPER12** (с **Excel12),** которые будут удерживать результат оцениваемой функции.
  
 _iCount_ **(int)**
  
Количество последующих аргументов, которые будут переданы функции. В версиях Excel до 2003 года это может быть любое число от 0 до 30. Начиная с Excel 2007 г. это может быть любое число от 0 до 255.
  
 _argument1, ..._ (**LPXLOPER** или **LPXLOPER12**)
  
Необязательные аргументы для функции. Все аргументы должны быть указателями на **значения XLOPER** или **XLOPER12.** 
  
## <a name="return-value"></a>Возвращаемое значение

Возвращает одно из следующих значений **int (int).**
  
|**Значение**|**Код возврата**|**Описание**|
|:-----|:-----|:-----|
|0  <br/> |**xlretSuccess** <br/> |Функция была вызвана успешно. Это не означает, что функция не возвращает значение Excel ошибки; Чтобы узнать это, необходимо взглянуть на тип и значение параметра _pxRes._  <br/> |
|1  <br/> |**xlretAbort** <br/> |Команда или функция была прекращена ненормально (внутреннее прерывание). Это может произойти, если макрос XLM закрывается путем вызова **CLOSE** или Excel из памяти. Если Excel возвращает эту ошибку, функция вызова должна немедленно выйти. DLL разрешается вызывать **xlFree** только перед выходом. Все остальные вызовы API C не допускаются. Пользователь может сохранить любую работу в интерактивном режиме с помощью команды **Сохранить** в **меню File.**  <br/> |
|2  <br/> |**xlretInvXlfn** <br/> |Был предоставлен недействительный номер функции. Если вы используете константы из файла загона Xlcall.h, это не должно происходить, если вы не вызываете то, что не поддерживается в версии Excel запущена.  <br/> |
|4   <br/> |**xlretInvCount** <br/> |Было вписано недействительное число аргументов. В версиях до Excel 2003 г. максимальное количество аргументов, которые может принять любая функция, — 30. Начиная с Excel 2007 г. максимальное число — 255. Некоторые требуют фиксированного или минимального количества аргументов.  <br/> |
|8   <br/> |**xlretInvXloper** <br/> |**Недействительный XLOPER** или **XLOPER12** был передан функции, или был использован аргумент неправильного типа.  <br/> |
|16   <br/> |**xlretStackOvfl** <br/> |Произошел переполнение стека. Используйте **xlStack,** чтобы отслеживать количество места, оставленного в стеке. Избегайте, когда это возможно, очень больших локальных (автоматических) массивов и структур в стеке; сделать их статичными. (Обратите внимание, что переполнение стека может произойти без обнаружения.)  <br/> |
|32  <br/> |**xlretFailed** <br/> |Сбой функции, эквивалентной команде. Это эквивалентно команде макроса, отображаемой диалоговом окне оповещений об ошибке макроса.  <br/> |
|64  <br/> |**xlretUncalced** <br/> |Была предпринята попытка вычислить ячейку, которая еще не была рассчитана, так как ее планируется пересчитать после текущей ячейки. В этом случае DLL должен немедленно вернуть управление Excel. DLL разрешается вызывать **xlFree** только перед выходом. Все остальные вызовы API C не допускаются. Дополнительные сведения о том, какие функции могут и не могут получить доступ к значениям ячеек, которые не были пересчитаны, см. в Excel команд, функций и [государств.](excel-commands-functions-and-states.md)  <br/> |
|128  <br/> |**xlretNotThreadSafe** <br/> |Была предпринята попытка вызвать функцию, которая не является или не может быть безопасной для потока во время многопотоковой пересчета книги.  <br/> Начиная с Excel 2007 года это значение возвращается, и только в функциях таблицы XLL объявляются безопасными потоками.  <br/> |
|256  <br/> |**xlRetInvAsynchronousContext** <br/> |Асинхронная ручка функции недействительна.  <br/> Это значение используется только Excel 2010 г.  <br/> |
|512  <br/> |**xlRetNotClusterSafe** <br/> |Вызов не поддерживается в кластерах.  <br/> Это значение используется только Excel 2010 г.  <br/> |
   
## <a name="remarks"></a>Примечания

### <a name="valid-ifunction-values"></a>Допустимые значения iFunction

Допустимые значения **iFunction** — это любые **xlf...** или **xlc...** константы, определенные в файле загона Xlcall.h или любой из следующих специальных функций. 
  
|||||
|:-----|:-----|:-----|:-----|
|**xlAbort** <br/> |**xlEnableXLMsgs** <br/> |**xlGetInst** <br/> |**xlSheetNm** <br/> |
|**xlCoerce** <br/> |**xlFree** <br/> |**xlGetName** <br/> |**xlStack** <br/> |
|**xlDefineBinaryName** <br/> |**xlGetBinaryName** <br/> |**xlSet** <br/> |**xlUDF** <br/> |
|**xlDisableXLMsgs** <br/> |**xlGetHwnd** <br/> |**xlSheetId** <br/> ||
   
### <a name="different-types-of-functions"></a>Различные типы функций

 **Excel4** и **Excel12 различаются** между тремя классами функций. Функции классифицируются в соответствии с тремя состояниями, в которых Excel может вызывать DLL. 
  
- Класс 1 применяется, когда DLL вызван из таблицы в результате пересчета. 
    
- Класс 2 применяется, когда DLL вызван из макроса функции или из таблицы, где она была зарегистрирована со знаком номеров (#) в тексте типа.
    
- Класс 3 применяется, когда DLL вызван из объекта, макроса, меню, панели инструментов, клавиши ярлыка, метода **ExecuteExcel4Macro** или команды **Tools/Macro/Run.** Дополнительные сведения см. [в Excel команд, функций и штатов.](excel-commands-functions-and-states.md)
    
В следующей таблице показано, какие функции допустимы в каждом классе.
  
|**Класс 1**|**Класс 2**|**Класс 3**|
|:-----|:-----|:-----|
|Любая функция таблицы  <br/> Любые функции **XLL только xl...** за исключением **xlSet.**  <br/> **xlfCaller** <br/> |Любая функция таблицы  <br/> Любая **функция xl...** за исключением **xlSet.**  <br/> Функции макроса, в том числе **xlfCaller,** возвращают значение, но не выполняют никаких действий, влияющих на рабочее пространство или открытую книгу.  <br/> |Любые функции, в том числе **xlSet** и командно-эквивалентные функции.  <br/> |
   
### <a name="displaying-the-dialog-box-for-a-command-equivalent-function"></a>Отображение диалоговое окно для функции Command-Equivalent

Если в функции, эквивалентной команде, имеется связанное диалоговое окно, вы можете установить **бит xlPrompt** **в iFunction.** Это означает, Excel отображает соответствующее диалоговое окно перед проведением команды.
  
### <a name="writing-international-dlls"></a>Написание международных DLLs

Если в **iFunction** задан бит **xlIntl,** функция или команда выполнена так, как если бы она была вызвана из Международного листа макроса. Это означает, что команда ведет себя так же, как и в американской версии Excel, даже если она работает в международной (локализованной) версии.
  
### <a name="xlretuncalced-or-xlretabort"></a>xlretUncalced или xlretAbort

После получения одного из этих возвращаемого значения DLL должен немедленно очистить и вернуть управление Excel. Обратное вызовы Excel через API C, за исключением **xlFree,** отключены после получения одного из этих значений возврата.
  
## <a name="example"></a>Пример

В следующем примере используется **функция Excel12** для выбора ячейки, из которой она была вызвана. 
  
Этот пример кода является частью более крупного примера, представленного в Excel XLL SDK 2010 г., в следующем расположении, где установлен SDK:
  
\Samples\Example\Example.c.
  
> [!NOTE]
> Эта функция вызывает макрос команды (xlcSelect) и, следовательно, работает только в том случае, если она вызывается с макроса XLM. 
  
```cs
short WINAPI Excel12Example(void)
{
    XLOPER12 xRes;
    Excel12(xlfCaller, &xRes, 0);
    Excel12(xlcSelect, 0, 1, (LPXLOPER12)&xRes);
    Excel12(xlFree, 0, 1, (LPXLOPER12)&xRes);
    return 1;
}
```

## <a name="see-also"></a>См. также



[Excel4v/Excel12v](excel4v-excel12v.md)

