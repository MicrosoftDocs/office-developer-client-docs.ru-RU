---
title: Excel4/Excel12
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
f1_keywords:
- Excel12
- Excel4
keywords:
- Функция Excel4 [Excel 2007], функция Excel12 [Excel 2007]
localization_priority: Normal
ms.assetid: 2404f10d-8641-4ee6-a909-1c5a26610f80
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: 7c3af5f380ae4144890b1f7b486a61a05c19de74
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33429448"
---
# <a name="excel4excel12"></a>Excel4/Excel12

**Область применения:** Excel 2013 | Office 2013 | Visual Studio 
  
Вызывает внутреннюю функцию листа Microsoft Excel, функцию или команду листа макроса или специальную функцию или команду, предназначенную только для XLL, из библиотеки DLL/XLL или кода.
  
Все последние версии Excel поддерживают **Excel4**. Начиная с Excel 2007, поддерживается **Excel12** . 
  
Эти функции можно вызывать, только когда Excel передает управление в БИБЛИОТЕКУ DLL или XLL. Они также могут вызываться, когда Excel передает управление неявным образом с помощью вызова Visual Basic для приложений (VBA). Они не могут быть вызваны в любое другое время. Например, они не могут вызываться во время вызовов функции [DllMain](https://docs.microsoft.com/windows/desktop/dlls/dllmain) или другие случаи, когда операционная система вызвала DLL или из потока, СОЗДАНного библиотекой DLL. 
  
Функции [Excel4v и Excel12v](excel4v-excel12v.md) принимают свои аргументы в виде массива, а функции **Excel4** и **Excel12** принимают свои аргументы как список переменных длины в стеке. Во всех остальных отношениях **Excel4** имеет то же значение, что и **Excel4v**, а **Excel12** — то же самое, что и **Excel12v**.
  
```cs
int Excel4(int iFunction, LPXLOPER pxRes, int iCount, LPXLOPER argument1, ...);
int Excel12(int iFunction, LPXLOPER12 pxRes, int iCount, LPXLOPER12 argument1, ...);
```

## <a name="parameters"></a>Параметры

 _ифунктион_ (**int**)
  
Число, обозначающее команду, функцию или специальную функцию, которую требуется вызвать. Список допустимых значений _ифунктион_ можно найти в приведенном ниже разделе "Примечания". 
  
 _пксрес_ (**Лпкслопер** или **LPXLOPER12**)
  
Указатель на **XLOPER** (с **Excel4**) или **XLOPER12** (с **Excel12**), который будет содержать результат вычисления функции.
  
 _икаунт_ (**int**)
  
Количество последующих аргументов, которые будут переданы в функцию. В версиях Excel, вплоть до 2003, это может быть любое число от 0 до 30. Начиная с 2007 Excel, это может быть любое число от 0 до 255.
  
 _argument1,..._ (**Лпкслопер** или **LPXLOPER12**)
  
Необязательные аргументы функции. Все аргументы должны быть указателями на значения **XLOPER** или **XLOPER12** . 
  
## <a name="return-value"></a>Возвращаемое значение

Возвращает одно из следующих целых значений (**int**).
  
|**Значение**|**Код возврата**|**Описание**|
|:-----|:-----|:-----|
|нуль  <br/> |**xlretSuccess** <br/> |Функция была вызвана успешно. Это не означает, что функция не возвращает значение ошибки Excel; чтобы найти это, необходимо просмотреть тип и значение полученного параметра _пксрес_ .  <br/> |
|1,1  <br/> |**xlretAbort** <br/> |Команда или функция завершена аварийно (внутреннее прерывание). Это может произойти, если лист макросов XLM закрывается с помощью вызова **Close**или в приложении Excel недостаточно памяти. Если Excel возвращает эту ошибку, вызываемая функция должна выйти сразу же. БИБЛИОТЕКЕ DLL разрешено вызывать **кслфри** только перед выходом. Все остальные вызовы API C не разрешены. Пользователь может сохранить любую работу в интерактивном режиме с помощью команды " **сохранить** " в меню " **файл** ".  <br/> |
|2  <br/> |**xlretInvXlfn** <br/> |Указан недопустимый номер функции. Если вы используете константы из файла заголовка Xlcall. h, это не должно происходить, если вы не вызываете объект, который не поддерживается в используемой версии Excel.  <br/> |
|SP4  <br/> |**xlretInvCount** <br/> |Введено недопустимое число аргументов. В версиях до Excel 2003 максимальное число аргументов, которое может принимать любая функция, равно 30. Начиная с Excel 2007, максимальное число равно 255. Для некоторых требуется фиксированное или минимальное количество аргументов.  <br/> |
|8,5  <br/> |**xlretInvXloper** <br/> |В функцию было передано недопустимое значение **XLOPER** или **XLOPER12** , либо был использован аргумент неправильного типа.  <br/> |
|16   <br/> |**xlretStackOvfl** <br/> |Произошло переполнение стека. Используйте **кслстакк** для отслеживания объема помещения, расположенного в стеке. Избегайте выделения в стеке очень больших локальных (автоматически) массивов и структур, где это возможно; Сделайте их статическими. (Обратите внимание, что переполнение стека может произойти без обнаружения.)  <br/> |
|32  <br/> |**xlretFailed** <br/> |Сбой функции, эквивалентной команде. Это эквивалентно команде макроса, в котором отображается диалоговое окно Оповещение об ошибке в макросе.  <br/> |
|64  <br/> |**xlretUncalced** <br/> |Предпринята попытка разыменования ячейки, которая еще не вычислена, так как она запланирована для пересчета после текущей ячейки. В этом случае DLL должен немедленно вернуть управление в Excel. БИБЛИОТЕКЕ DLL разрешено вызывать **кслфри** только перед выходом. Все остальные вызовы API C не разрешены. Для получения дополнительных сведений о том, какие функции могут и не могут получить доступ к значениям ячеек, которые не были пересчитаны, ознакомьтесь с [командами, функциями и состоянияМи Excel](excel-commands-functions-and-states.md).  <br/> |
|128  <br/> |**xlretNotThreadSafe** <br/> |Предпринята попытка вызвать функцию, которая не является потокобезопасным при многопотоковом пересчете книги.  <br/> Начиная с Excel 2007, возвращается это значение и только в функциях листа XLL, объявленных как потокобезопасные.  <br/> |
|256  <br/> |**xlRetInvAsynchronousContext** <br/> |Недопустимый Асинхронный дескриптор функции.  <br/> Это значение используется только в Excel 2010.  <br/> |
|512  <br/> |**Кслретнотклустерсафе** <br/> |Этот вызов не поддерживается в кластерах.  <br/> Это значение используется только в Excel 2010.  <br/> |
   
## <a name="remarks"></a>Примечания

### <a name="valid-ifunction-values"></a>Допустимые значения Ифунктион

Допустимые значения **ифунктион** — это любые константы **XLF...** или **XLC...** , определенные в файле заголовка Xlcall. h, или любые из следующих специальных функций. 
  
|||||
|:-----|:-----|:-----|:-----|
|**xlAbort** <br/> |**xlEnableXLMsgs** <br/> |**xlGetInst** <br/> |**xlSheetNm** <br/> |
|**xlCoerce** <br/> |**xlFree** <br/> |**xlGetName** <br/> |**xlStack** <br/> |
|**xlDefineBinaryName** <br/> |**xlGetBinaryName** <br/> |**xlSet** <br/> |**xlUDF** <br/> |
|**xlDisableXLMsgs** <br/> |**xlGetHwnd** <br/> |**xlSheetId** <br/> ||
   
### <a name="different-types-of-functions"></a>Различные типы функций

 **Excel4** и **Excel12** отличают три класса функций. Функции классифицируются в соответствии с тремя состояниями, в которых Excel может вызвать БИБЛИОТЕКУ DLL. 
  
- Класс 1 применяется при вызове библиотеки DLL из листа в результате пересчета. 
    
- Класс 2 применяется при вызове библиотеки DLL из макроса функции или из листа, где он был зарегистрирован с помощью знака решетки (#) в тексте типа.
    
- Класс 3 применяется при вызове библиотеки DLL из объекта, макроса, меню, панели инструментов, сочетания клавиш, метода **ExecuteExcel4Macro** или команды **Tools/макрос/Run** . Дополнительные сведения см. в статье [команды, функции и состояния Excel](excel-commands-functions-and-states.md).
    
В следующей таблице показано, какие функции являются допустимыми в каждом классе.
  
|**Класс 1**|**Класс 2**|**Класс 3**|
|:-----|:-----|:-----|
|Любая функция листа  <br/> Любая функция **XL...,** кроме **кслсет**.  <br/> **xlfCaller** <br/> |Любая функция листа  <br/> Любая функция **XL...,** кроме **кслсет**.  <br/> Функции листа макросов, в том числе **xlfCaller**, которые возвращают значение, но не выполняют никаких действий, влияющих на рабочую область или любую открытую книгу.  <br/> |Любая функция, в том числе **кслсет** и функции, эквивалентные командам.  <br/> |
   
### <a name="displaying-the-dialog-box-for-a-command-equivalent-function"></a>Отображение диалогового окна для функции, эквивалентной команде

Если с помощью функции, эквивалентной команде, имеется связанное диалоговое окно, можно установить бит **кслпромпт** в **ифунктион**. Это означает, что Excel отображает соответствующее диалоговое окно перед выполнением команды.
  
### <a name="writing-international-dlls"></a>Написание международных библиотек DLL

Если установить бит **кслинтл** в **ифунктион**, функция или команда выполняется так, как если бы она вызывалась с международного листа макросов. Это означает, что команда работает так же, как и в английской версии Excel, даже если она работает в международной (локализованной) версии.
  
### <a name="xlretuncalced-or-xlretabort"></a>Кслретункалцед или Кслретаборт

После получения одного из этих возвращаемых значений библиотека DLL должна немедленно очистить и вернуть элемент управления в Excel. Обратные вызовы в Excel с помощью API C, за исключением **кслфри**, отключаются после получения одного из этих возвращаемых значений.
  
## <a name="example"></a>Пример

В приведенном ниже примере используется функция **Excel12** для выбора ячейки, из которой она была вызвана. 
  
Этот пример кода является частью большого примера, приведенного в пакете SDK для XLL 2010 для Excel, в следующем расположении, где вы установили пакет SDK:
  
\Самплес\ексампле\ексампле.к.
  
> [!NOTE]
> Эта функция вызывает макрос Command (Кслкселект) и, следовательно, работает, только если он вызывается на листе макросов XLM. 
  
```cs
short WINAPI Excel12Example(void)
{
    XLOPER12 xRes;
    Excel12(xlfCaller, &xRes, 0);
    Excel12(xlcSelect, 0, 1, (LPXLOPER12)&xRes);
    Excel12(xlFree, 0, 1, (LPXLOPER12)&xRes);
    return 1;
}
```

## <a name="see-also"></a>См. также



[Excel4v/Excel12v](excel4v-excel12v.md)

