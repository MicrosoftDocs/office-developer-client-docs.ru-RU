---
title: Excel4/Excel12
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
f1_keywords:
- Excel12
- Excel4
keywords:
- Функция excel4 [excel 2007],Excel12 function [Excel 2007]
localization_priority: Normal
ms.assetid: 2404f10d-8641-4ee6-a909-1c5a26610f80
description: 'Область применения: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: 7c3af5f380ae4144890b1f7b486a61a05c19de74
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33429448"
---
# <a name="excel4excel12"></a>Excel4/Excel12

**Область применения:** Excel 2013 | Office 2013 | Visual Studio 
  
Вызывает внутреннюю функцию листа Microsoft Excel, функцию или команду листа макроса или специальную функцию или команду только для XLL из DLL/XLL или ресурса кода.
  
Все последние версии Excel поддерживают **Excel4.** Начиная с Excel 2007, **excel12** поддерживается. 
  
Эти функции могут быть вызваны только в том случае, если Excel передает управление DLL или XLL. Их также можно вызывать, когда Excel неявно передает управление через вызов Visual Basic для приложений (VBA). Они не могут быть вызваны в любое другое время. Например, они не могут быть вызваны во время вызовов функции [DllMain](https://docs.microsoft.com/windows/desktop/dlls/dllmain) или в других случаях, когда операционная система вызывает DLL, или из потока, созданного DLL. 
  
Функции [Excel4v и Excel12v](excel4v-excel12v.md) принимают свои аргументы в качестве массива, тогда как функции **Excel4** и **Excel12** принимают их аргументы в качестве списка переменной длины в стеке. Во всех остальных отношениях **Excel4** ведет себя так же, как **Excel4v,** и **Excel12** ведет себя так же, как **Excel12v**.
  
```cs
int Excel4(int iFunction, LPXLOPER pxRes, int iCount, LPXLOPER argument1, ...);
int Excel12(int iFunction, LPXLOPER12 pxRes, int iCount, LPXLOPER12 argument1, ...);
```

## <a name="parameters"></a>Параметры

 _iFunction_ (**int**)
  
Номер, который указывает вызываемую команду, функцию или специальную функцию. Список допустимого значения  _iFunction_ см. в следующем разделе "Примечаний". 
  
 _pxRes_ (**LPXLOPER** или **LPXLOPER12)**
  
Указатель на **XLOPER** (с **Excel4)** или **XLOPER12** (с **Excel12),** который будет удерживать результат оцениваемой функции.
  
 _iCount_ (**int)**
  
Число последующих аргументов, которые будут переданы функции. В версиях Excel до 2003 это может быть любое число от 0 до 30. Начиная с Excel 2007, это может быть любое число от 0 до 255.
  
 _argument1, ..._ (**LPXLOPER** или **LPXLOPER12**)
  
Необязательные аргументы функции. Все аргументы должны быть указателями на **значения XLOPER** или **XLOPER12.** 
  
## <a name="return-value"></a>Возвращаемое значение

Возвращает одно из следующих значений(**int).**
  
|**Значение**|**Код возврата**|**Описание**|
|:-----|:-----|:-----|
|0  <br/> |**xlretSuccess** <br/> |Функция была успешно вызвана. Это не означает, что функция не вернула значение ошибки Excel; чтобы узнать это, необходимо и посмотреть тип и значение итога _параметра pxRes._  <br/> |
|1   <br/> |**xlretAbort** <br/> |Команда или функция была прервана ненормально (внутреннее прерывание). Это может произойти, если лист макроса XLM закрывается с помощью вызова **CLOSE** или если Excel не имеет памяти. Если Excel возвращает эту ошибку, вызываемая функция должна немедленно выйти из системы. DLL может вызывать **xlFree** только перед выходом. Все остальные вызовы API C не разрешены. Пользователь может сохранить любую работу в интерактивном режиме с помощью команды **"Сохранить"** в **меню "Файл".**  <br/> |
|2   <br/> |**xlretInvXlfn** <br/> |Предоставлен недопустимый номер функции. Если вы используете константы из файла загона Xlcall.h, это не должно происходить, если только не вызывается неподдержка в используемой версии Excel.  <br/> |
|4   <br/> |**xlretInvCount** <br/> |Введено недопустимое число аргументов. В версиях до Excel 2003 максимальное число аргументов, которые может принимать функция, — 30. Начиная с Excel 2007, максимальное число составляет 255. Для некоторых требуется фиксированное или минимальное число аргументов.  <br/> |
|8   <br/> |**xlretInvXloper** <br/> |В **функцию передан недопустимый XLOPER** или **XLOPER12** или использован аргумент неправильного типа.  <br/> |
|16   <br/> |**xlretStackOvfl** <br/> |Произошел переполнение стека. Используйте **xlStack** для отслеживания количества места в стеке. Старайтесь по возможности не наложить на стек очень большие локальные (автоматические) массивы и структуры; сделать их статическими. (Обратите внимание, что переполнение стека может произойти без обнаружения.)  <br/> |
|32  <br/> |**xlretFailed** <br/> |Сбой функции, эквивалентной команде. Это эквивалентно команде макроса, отображает диалоговое окно оповещения об ошибке макроса.  <br/> |
|64  <br/> |**xlretUncalced** <br/> |Предпринята попытка выдвихировать ячейку, которая еще не была вычислена, так как после текущей ячейки запланирован пересчет. В этом случае DLL должна немедленно вернуть управление Excel. DLL может вызывать **xlFree** только перед выходом. Все остальные вызовы API C не разрешены. Дополнительные сведения о том, какие функции могут и не могут получить доступ к значениям ячеек, которые не были пересчитаны, см. в командах, функциях и состояниях [Excel.](excel-commands-functions-and-states.md)  <br/> |
|128  <br/> |**xlretNotThreadSafe** <br/> |Была предпринята попытка вызвать функцию, которая не является потокобезопасной во время многопотоковых пересчетов книги.  <br/> Начиная с Excel 2007, это значение возвращается и только в функциях листа XLL, объявленных как потокобезопасные.  <br/> |
|256  <br/> |**xlRetInvAsynchronousContext** <br/> |Недопустимый окне асинхронной функции.  <br/> Это значение используется только в Excel 2010.  <br/> |
|512  <br/> |**xlRetNotClusterSafe** <br/> |Вызов не поддерживается в кластерах.  <br/> Это значение используется только в Excel 2010.  <br/> |
   
## <a name="remarks"></a>Примечания

### <a name="valid-ifunction-values"></a>Допустимые значения iFunction

Допустимые значения **iFunction** — это константы **xlf...** или **xlc...,** определенные в файле загона Xlcall.h или любой из следующих специальных функций. 
  
|||||
|:-----|:-----|:-----|:-----|
|**xlAbort** <br/> |**xlEnableXLMsgs** <br/> |**xlGetInst** <br/> |**xlSheetNm** <br/> |
|**xlCoerce** <br/> |**xlFree** <br/> |**xlGetName** <br/> |**xlStack** <br/> |
|**xlDefineBinaryName** <br/> |**xlGetBinaryName** <br/> |**xlSet** <br/> |**xlUDF** <br/> |
|**xlDisableXLMsgs** <br/> |**xlGetHwnd** <br/> |**xlSheetId** <br/> ||
   
### <a name="different-types-of-functions"></a>Различные типы функций

 **Excel4** и **Excel12 различаются** между тремя классами функций. Функции классифицируются в соответствии с тремя состояниями, в которых Excel может вызывать DLL. 
  
- Класс 1 применяется, когда В результате пересчета из таблицы будет вызвана DLL- 
    
- Класс 2 применяется, когда DLL-функция вызвана из макроса функции или с рабочего таблицы, где она была зарегистрирована с помощью знака номера (#) в тексте типа.
    
- Класс 3 применяется, когда DLL-объект вызван из объекта, макроса, меню, панели инструментов, сочетания клавиш, метода **ExecuteExcel4Macro** или команды **Tools/Macro/Run.** Дополнительные сведения см. в [командах, функциях и состояниях Excel.](excel-commands-functions-and-states.md)
    
В следующей таблице показаны допустимые функции в каждом классе.
  
|**Класс 1**|**Класс 2**|**Класс 3**|
|:-----|:-----|:-----|
|Любая функция таблицы  <br/> Любая XLL-функция **xl...** за исключением **xlSet.**  <br/> **xlfCaller** <br/> |Любая функция таблицы  <br/> Любая **функция xl...** за исключением **xlSet.**  <br/> Функции листа макроса, включая **xlfCaller,** которые возвращают значение, но не выполняют никаких действий, влияющих на рабочее пространство или открытую книгу.  <br/> |Любая функция, включая **xlSet** и функции, эквивалентные командам.  <br/> |
   
### <a name="displaying-the-dialog-box-for-a-command-equivalent-function"></a>Отображение диалоговых окна для функции Command-Equivalent

Если с функцией, эквивалентной команде, связано диалоговое окно, можно установить бит **xlPrompt** в **iFunction**. Это означает, что Excel отображает соответствующее диалоговое окно перед выполнением команды.
  
### <a name="writing-international-dlls"></a>Написание международных DLL

Если задан **бит xlIntl** в **iFunction,** функция или команда будет выполнена так, как если бы она была вызвана из international Macro Sheet. Это означает, что команда работает так же, как в версии Excel в США, даже если она запущена в международной (локализованной) версии.
  
### <a name="xlretuncalced-or-xlretabort"></a>xlretUncalced или xlretAbort

После получения одного из этих возвращаемого значения DLL должна немедленно очистить и вернуть управление Excel. Обратное вызовы в Excel через API C, за исключением **xlFree,** отключаются после получения одного из этих возвращаемого значения.
  
## <a name="example"></a>Пример

В следующем примере функция **Excel12** используется для выбора ячейки, из которой она была вызвана. 
  
Этот пример кода является частью более крупного примера, представленного в SDK XLL для Excel 2010 в следующем расположении, где установлен SDK:
  
\Samples\Example\Example.c.
  
> [!NOTE]
> Эта функция вызывает макрос команды (xlcSelect) и, следовательно, работает, только если он вызывается из листа макроса XLM. 
  
```cs
short WINAPI Excel12Example(void)
{
    XLOPER12 xRes;
    Excel12(xlfCaller, &xRes, 0);
    Excel12(xlcSelect, 0, 1, (LPXLOPER12)&xRes);
    Excel12(xlFree, 0, 1, (LPXLOPER12)&xRes);
    return 1;
}
```

## <a name="see-also"></a>См. также



[Excel4v/Excel12v](excel4v-excel12v.md)

