---
title: Систематическое освобождение объектов
TOCTitle: Systematically releasing objects
ms:assetid: d4cd1d8e-aae6-483b-a4d8-1656171e838d
ms:mtpsurl: https://msdn.microsoft.com/library/Bb623945(v=office.15)
ms:contentKeyID: 55119785
ms.date: 07/24/2014
mtps_version: v=office.15
localization_priority: Normal
ms.openlocfilehash: 5d71ffbdbd10657832a319e1e669f38f311ad99f
ms.sourcegitcommit: d6695c94415fa47952ee7961a69660abc0904434
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2019
ms.locfileid: "28708118"
---
# <a name="systematically-releasing-objects"></a>Систематическое освобождение объектов

В этом разделе приведены рекомендации по завершению работы надстроек для разработчиков надстроек и ИТ-администраторов, использующих Outlook. Дополнительные сведения см. в статье [Изменения завершения работы Outlook 2010](https://msdn.microsoft.com/library/ee720183\(v=office.15\)).

## <a name="add-in-shutdown-changes-in-outlook"></a>Изменения завершения работы надстроек в Outlook

Начиная с Outlook 2010, Outlook по умолчанию не сообщает надстройкам о завершении работы. В частности, в приложении Outlook в процессе быстрого завершения работы больше не вызываются методы **OnBeginShutdown(Array)** и **OnDisconnection(ext\_DisconnectMode, Array)** интерфейса **IDTExtensibility2**. Также в надстройках Outlook, написанных с помощью инструментов разработчика Office в Visual Studio 2010 или более поздней версии, при завершении работы приложения Outlook больше не вызывается метод ThisAddin\_Shutdown. 

Вызовы этих методов были исключены, поскольку, несмотря на то что большинство надстроек выполняют простые задачи (например, высвобождение ссылок), некоторые из них могут синхронно с соответствующими событиями выполнять вызовы веб-служб или другие длительные операции, что приводит к значительным задержкам при завершении работы Outlook. В результате этого изменения Outlook стал лучше работать при завершении работы.

## <a name="recommendations-for-add-in-shutdown-for-developers"></a>Рекомендации по завершению работы надстроек для разработчиков

Разработчикам настоятельно рекомендуется соблюдать следующие рекомендации по завершению работы надстроек. Это позволит значительно сократить длительность завершения работы приложения Outlook.

- В надстройках по-прежнему следует использовать методы OnBeginShutdown, OnDisconnection или ThisAddin\_Shutdown для освобождения ссылок и выделенной памяти, поскольку в некоторых сценариях администраторам может потребоваться возможность медленного завершения работы с использованием групповых политик, а пользователи могут вручную отключать надстройки в диалоговом окне **Надстройки COM**.

- Разработчикам надстроек следует выполнять только те задачи, которые абсолютно необходимы при завершении работы.

- Следует оценить быстродействие надстроек в различных сценариях с различными параметрами реестра Windows, определяющими порядок завершения работы Outlook. При необходимости следует своевременно изменять надстройки для более эффективной работы приложения Outlook.

## <a name="recommendations-for-add-in-shutdown-for-it-administrators"></a>Рекомендации по завершению работы надстроек для ИТ-администраторов

Если в организации уже развернуты надстройки, которые не поддерживают обновление до версии, совместимой с новым механизмом завершения работы Outlook, ИТ-администраторы могут использовать параметры реестра Windows, позволяющие восстановить реализованный в предыдущих версиях механизм медленного завершения работы.

### <a name="individual-add-in-setting"></a>Настройка отдельных надстроек

ИТ-администраторы могут включать уведомления о завершении работы для отдельных надстроек Outlook в рамках развертывания надстроек. Это действие нельзя выполнить с помощью групповой политики, однако оно позволяет обеспечить обратную совместимость для отдельных надстроек.

Для настройки таких параметров следует зарегистрировать надстройку в кустах реестра HKCU или HKLM, указав дополнительное значение. Введите следующий текст в одну строку:

`HKCU\Software\Microsoft\Office\Outlook\Add-ins\<ProgID>[RequireShutdownNotification]=dword:0x1`

Присвоение для него значения 0x1 позволяет надстройке получать заблокированные обратные вызовы при завершении работы Outlook. Это влияет на быстродействие завершения работы Outlook и должно оцениваться в рамках развертывания. Этот параметр следует применять только в том случае, если у надстройки есть существенные проблемы совместимости с новым механизмом завершения работы. При установке значения 0x0 реализуется поведение Outlook по умолчанию.

### <a name="global-setting"></a>Глобальные параметры

ИТ-администраторы могут глобально включать уведомления о завершении работы для всех надстроек с помощью групповой политики. Такой подход рекомендуется для организаций с большим числом внутренних решений и компьютеров, на которых требуется развернуть этот параметр для обеспечения совместимости в процессе развертывания Outlook.

С помощью этого параметра можно изменить механизм завершения работы в соответствии с используемым в приложении Outlook 2007. Параметр можно развернуть с помощью групповой политики для каждого пользователя или компьютера. Введите следующий текст в одну строку:

`HKCU\Policies\Microsoft\Office\Outlook\15.0\Options\Shutdown[AddinFastShutdownBehavior]=dword:0x1`

Если параметру AddinFastShutdownBehavior присвоено значение 0x1, включаются уведомления о завершении работы для всех надстроек. При установке значения 0x0 реализуется поведение Outlook по умолчанию.

