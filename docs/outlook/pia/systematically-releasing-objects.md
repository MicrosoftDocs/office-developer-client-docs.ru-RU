---
title: Систематическое освобождение объектов
TOCTitle: Systematically releasing objects
ms:assetid: d4cd1d8e-aae6-483b-a4d8-1656171e838d
ms:mtpsurl: https://msdn.microsoft.com/library/Bb623945(v=office.15)
ms:contentKeyID: 55119785
ms.date: 07/24/2014
mtps_version: v=office.15
localization_priority: Normal
ms.openlocfilehash: 5d71ffbdbd10657832a319e1e669f38f311ad99f
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32319245"
---
# <a name="systematically-releasing-objects"></a><span data-ttu-id="063a8-102">Систематическое освобождение объектов</span><span class="sxs-lookup"><span data-stu-id="063a8-102">Systematically releasing objects</span></span>

<span data-ttu-id="063a8-103">В этом разделе приведены рекомендации по завершению работы надстроек для разработчиков надстроек и ИТ-администраторов, использующих Outlook.</span><span class="sxs-lookup"><span data-stu-id="063a8-103">This topic summarizes add-in shutdown recommendations for add-in developers and IT administrators that use Outlook.</span></span> <span data-ttu-id="063a8-104">Дополнительные сведения см. в статье [Изменения завершения работы Outlook 2010](https://msdn.microsoft.com/library/ee720183\(v=office.15\)).</span><span class="sxs-lookup"><span data-stu-id="063a8-104">For more information, see [Shutdown Changes for Outlook 2010](https://msdn.microsoft.com/library/ee720183\(v=office.15\)).</span></span>

## <a name="add-in-shutdown-changes-in-outlook"></a><span data-ttu-id="063a8-105">Изменения завершения работы надстроек в Outlook</span><span class="sxs-lookup"><span data-stu-id="063a8-105">Add-in shutdown changes in Outlook</span></span>

<span data-ttu-id="063a8-106">Начиная с Outlook 2010, Outlook по умолчанию не сообщает надстройкам о завершении работы.</span><span class="sxs-lookup"><span data-stu-id="063a8-106">Starting in Outlook 2010, Outlook, by default, does not signal add-ins that it is shutting down.</span></span> <span data-ttu-id="063a8-107">В частности, в приложении Outlook в процессе быстрого завершения работы больше не вызываются методы **OnBeginShutdown(Array)** и **OnDisconnection(ext\_DisconnectMode, Array)** интерфейса **IDTExtensibility2**.</span><span class="sxs-lookup"><span data-stu-id="063a8-107">Specifically, Outlook no longer calls the **OnBeginShutdown(Array)** and **OnDisconnection(ext\_DisconnectMode, Array)** methods of the **IDTExtensibility2** interface during fast shutdown.</span></span> <span data-ttu-id="063a8-108">Также в надстройках Outlook, написанных с помощью инструментов разработчика Office в Visual Studio 2010 или более поздней версии, при завершении работы приложения Outlook больше не вызывается метод ThisAddin\_Shutdown.</span><span class="sxs-lookup"><span data-stu-id="063a8-108">Similarly, an Outlook add-in, written with Office development tools in Visual Studio 2010 or a later version, no longer calls the ThisAddin\_Shutdown method when Outlook is shutting down.</span></span> 

<span data-ttu-id="063a8-109">Вызовы этих методов были исключены, поскольку, несмотря на то что большинство надстроек выполняют простые задачи (например, высвобождение ссылок), некоторые из них могут синхронно с соответствующими событиями выполнять вызовы веб-служб или другие длительные операции, что приводит к значительным задержкам при завершении работы Outlook.</span><span class="sxs-lookup"><span data-stu-id="063a8-109">The reason to stop calling these methods is that while a majority of add-ins perform simple tasks like releasing references, some add-ins make Web service calls or other long-running operations synchronously during these events, significantly delaying Outlook from shutting down.</span></span> <span data-ttu-id="063a8-110">В результате этого изменения Outlook стал лучше работать при завершении работы.</span><span class="sxs-lookup"><span data-stu-id="063a8-110">As a result of this change, Outlook works better than it has in the past when shutting down.</span></span>

## <a name="recommendations-for-add-in-shutdown-for-developers"></a><span data-ttu-id="063a8-111">Рекомендации по завершению работы надстроек для разработчиков</span><span class="sxs-lookup"><span data-stu-id="063a8-111">Recommendations for add-in shutdown for developers</span></span>

<span data-ttu-id="063a8-112">Разработчикам настоятельно рекомендуется соблюдать следующие рекомендации по завершению работы надстроек. Это позволит значительно сократить длительность завершения работы приложения Outlook.</span><span class="sxs-lookup"><span data-stu-id="063a8-112">It is important that developers observe the following recommendations for add-in shutdown to ensure that end users continue to benefit from a fast and responsive Outlook shutdown experience.</span></span>

- <span data-ttu-id="063a8-113">В надстройках по-прежнему следует использовать методы OnBeginShutdown, OnDisconnection или ThisAddin\_Shutdown для освобождения ссылок и выделенной памяти, поскольку в некоторых сценариях администраторам может потребоваться возможность медленного завершения работы с использованием групповых политик, а пользователи могут вручную отключать надстройки в диалоговом окне **Надстройки COM**.</span><span class="sxs-lookup"><span data-stu-id="063a8-113">Add-ins should continue to implement the OnBeginShutdown and OnDisconnection methods or ThisAddin\_Shutdown to release references and allocated memory, because there are scenarios in which administrators might revert to slow shutdown through group policy, or the user might manually disconnect your add-in through the **COM Add-ins** dialog box.</span></span>

- <span data-ttu-id="063a8-114">Разработчикам надстроек следует выполнять только те задачи, которые абсолютно необходимы при завершении работы.</span><span class="sxs-lookup"><span data-stu-id="063a8-114">Add-in developers should only perform tasks that absolutely must take place during shutdown.</span></span>

- <span data-ttu-id="063a8-115">Следует оценить быстродействие надстроек в различных сценариях с различными параметрами реестра Windows, определяющими порядок завершения работы Outlook. При необходимости следует своевременно изменять надстройки для более эффективной работы приложения Outlook.</span><span class="sxs-lookup"><span data-stu-id="063a8-115">Add-in developers should evaluate the performance of their add-ins in various scenarios and under different Windows registry settings that control Outlook shutdown, and proactively modify their add-ins to work with Outlook.</span></span>

## <a name="recommendations-for-add-in-shutdown-for-it-administrators"></a><span data-ttu-id="063a8-116">Рекомендации по завершению работы надстроек для ИТ-администраторов</span><span class="sxs-lookup"><span data-stu-id="063a8-116">Recommendations for add-in shutdown for IT administrators</span></span>

<span data-ttu-id="063a8-117">Если в организации уже развернуты надстройки, которые не поддерживают обновление до версии, совместимой с новым механизмом завершения работы Outlook, ИТ-администраторы могут использовать параметры реестра Windows, позволяющие восстановить реализованный в предыдущих версиях механизм медленного завершения работы.</span><span class="sxs-lookup"><span data-stu-id="063a8-117">For IT administrators, if there are add-ins that are already deployed in an enterprise and cannot be upgraded to become compatible with the new shutdown Outlook mechanism, IT administrators can resort to a couple of Windows registry settings to revert to the slow shutdown behavior.</span></span>

### <a name="individual-add-in-setting"></a><span data-ttu-id="063a8-118">Настройка отдельных надстроек</span><span class="sxs-lookup"><span data-stu-id="063a8-118">Individual add-in setting</span></span>

<span data-ttu-id="063a8-p104">ИТ-администраторы могут включать уведомления о завершении работы для отдельных надстроек Outlook в рамках развертывания надстроек. Это действие нельзя выполнить с помощью групповой политики, однако оно позволяет обеспечить обратную совместимость для отдельных надстроек.</span><span class="sxs-lookup"><span data-stu-id="063a8-p104">IT administrators can enable shutdown notifications to individual Outlook add-ins as part of the add-in deployment. Although you cannot do this through group policy, it is useful if you have backward-compatibility requirements for specific add-ins.</span></span>

<span data-ttu-id="063a8-p105">Для настройки таких параметров следует зарегистрировать надстройку в кустах реестра HKCU или HKLM, указав дополнительное значение. Введите следующий текст в одну строку:</span><span class="sxs-lookup"><span data-stu-id="063a8-p105">Configure this setting for each add-in through the add-in registration in the HKCU or the HKLM registry hives, by adding an additional value to the add-in registration. Type the following text as a single line:</span></span>

`HKCU\Software\Microsoft\Office\Outlook\Add-ins\<ProgID>[RequireShutdownNotification]=dword:0x1`

<span data-ttu-id="063a8-123">Присвоение для него значения 0x1 позволяет надстройке получать заблокированные обратные вызовы при завершении работы Outlook.</span><span class="sxs-lookup"><span data-stu-id="063a8-123">Setting this value to 0x1 enables the add-in to receive blocked callbacks during Outlook shutdown.</span></span> <span data-ttu-id="063a8-124">Это влияет на быстродействие завершения работы Outlook и должно оцениваться в рамках развертывания.</span><span class="sxs-lookup"><span data-stu-id="063a8-124">This has an impact on the performance of Outlook shutdown and should be evaluated as part of a deployment.</span></span> <span data-ttu-id="063a8-125">Этот параметр следует применять только в том случае, если у надстройки есть существенные проблемы совместимости с новым механизмом завершения работы.</span><span class="sxs-lookup"><span data-stu-id="063a8-125">This setting should be used only if an add-in has significant compatibility issues with the new shutdown mechanism.</span></span> <span data-ttu-id="063a8-126">При установке значения 0x0 реализуется поведение Outlook по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="063a8-126">Setting the value to 0x0 uses the default behavior of Outlook.</span></span>

### <a name="global-setting"></a><span data-ttu-id="063a8-127">Глобальные параметры</span><span class="sxs-lookup"><span data-stu-id="063a8-127">Global setting</span></span>

<span data-ttu-id="063a8-128">ИТ-администраторы могут глобально включать уведомления о завершении работы для всех надстроек с помощью групповой политики.</span><span class="sxs-lookup"><span data-stu-id="063a8-128">IT administrators can enable shutdown notifications globally for all add-ins through group policy.</span></span> <span data-ttu-id="063a8-129">Такой подход рекомендуется для организаций с большим числом внутренних решений и компьютеров, на которых требуется развернуть этот параметр для обеспечения совместимости в процессе развертывания Outlook.</span><span class="sxs-lookup"><span data-stu-id="063a8-129">This is recommended for organizations that have a large number of internal solutions or desktops that need to deploy this setting to ensure compatibility during a rollout of Outlook.</span></span>

<span data-ttu-id="063a8-130">С помощью этого параметра можно изменить механизм завершения работы в соответствии с используемым в приложении Outlook 2007.</span><span class="sxs-lookup"><span data-stu-id="063a8-130">Use this setting to change the shutdown mechanism to match that used by Outlook 2007.</span></span> <span data-ttu-id="063a8-131">Параметр можно развернуть с помощью групповой политики для каждого пользователя или компьютера.</span><span class="sxs-lookup"><span data-stu-id="063a8-131">You can deploy the setting through group policy, either per user or per computer.</span></span> <span data-ttu-id="063a8-132">Введите следующий текст в одну строку:</span><span class="sxs-lookup"><span data-stu-id="063a8-132">Type the following text as a single line:</span></span>

`HKCU\Policies\Microsoft\Office\Outlook\15.0\Options\Shutdown[AddinFastShutdownBehavior]=dword:0x1`

<span data-ttu-id="063a8-133">Если параметру AddinFastShutdownBehavior присвоено значение 0x1, включаются уведомления о завершении работы для всех надстроек. При установке значения 0x0 реализуется поведение Outlook по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="063a8-133">Setting AddinFastShutdownBehavior to 0x1 enables shutdown notifications for all add-ins. Setting the value to 0x0 uses the default behavior of Outlook.</span></span>

