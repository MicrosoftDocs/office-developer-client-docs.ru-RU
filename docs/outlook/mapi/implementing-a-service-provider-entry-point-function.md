---
title: Реализация функции точки входа поставщика услуг
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 83ff54c4-86ce-4529-ae45-260dfb763b30
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 14dd11f873493e32b83dbd1960cac8ff8ef8e436
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32332993"
---
# <a name="implementing-a-service-provider-entry-point-function"></a>Реализация функции точки входа поставщика услуг

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Каждая библиотека DLL поставщика услуг имеет функцию точки входа, которая вызывается MAPI для ее загрузки. Обратите внимание, что эта функция точки входа отличается от функции [DllMain](https://msdn.microsoft.com/library/ms682583.aspx), функции точки входа Win32 DLL.
  
В зависимости от типа поставщика функция точки входа поставщика соответствует другому прототипу. MAPI определяет разные прототипы функций для точек входа для поставщиков услуг.
  
|**Поставщик**|**Прототип функции точки входа**|
|:-----|:-----|
|Поставщики хранилища сообщений  <br/> |[MSProviderInit](msproviderinit.md) <br/> |
|Поставщики транспорта  <br/> |[XPProviderInit](xpproviderinit.md) <br/> |
|Поставщики адресных книг  <br/> |[ABProviderInit](abproviderinit.md) <br/> |
   
Большинство функций в этих прототипах одинаковы для всех типов поставщиков услуг. 
  
В функциях точки входа адресная книга, хранилище сообщений и поставщики транспорта выполняют следующие два основных задачи:
  
1. Проверьте версию интерфейса поставщика услуг (SPI), чтобы убедиться, что протокол MAPI использует версию, совместимую с версией, используемой поставщиком услуг. Используйте параметр _лпулмапивер_ , который содержит версию SPI MAPI, и параметр _лпулпровидервер_ , который содержит версию SPI, чтобы выполнить проверку. Эти параметры 32 — это целые числа без знака, состоящие из трех частей: 
    
  - Биты с 24 по 31 представляют основной номер версии.
    
  - Биты с 16 по 23 представляют дополнительный номер версии.
    
  - Биты от 0 до 15 представляют идентификатор обновления. Несмотря на то, что основной номер версии редко меняется, дополнительный номер версии изменяется всякий раз, когда отпускания MAPI и изменился индекс SPI. Идентификатор обновления является версией внутренней сборки Майкрософт; Он используется для отслеживания изменений в процессе разработки. MAPI определяет константу КУРРЕНТ_СПИ_ВЕРСИОН, задокументированную в файле заголовка Маписпи. h, чтобы указать текущую версию SPI. Если используется версия SPI, более поздняя, чем версия, используемая службой MAPI, проверяйте сообщение об ошибке МАПИ_Е_ВЕРСИОН.
    
2. Создайте экземпляр объекта provider. Так как поставщик можно запустить и инициализировать несколько раз, необходимо создать новый экземпляр каждый раз, когда это происходит. Поставщики запускаются несколько раз, когда они появляются в нескольких профилях, которые используются одновременно одним или несколькими клиентами, или если они встречаются несколько раз в одном профиле. Так как прототип функции точки входа различается в зависимости от типа поставщика, то есть тип объекта поставщика. 
    
    При написании поставщика адресных книг реализуйте [иабпровидер: IUnknown](iabprovideriunknown.md). Если вы пишете поставщик хранилища сообщений, реализуйте [функцииimsprovider: IUnknown](imsprovideriunknown.md). Дополнительные сведения см в статье [Загрузка поставщиков хранилищ сообщений](loading-message-store-providers.md).
    
    При создании поставщика транспорта реализуйте [иксппровидер: IUnknown](ixpprovideriunknown.md). Для получения дополнительных сведений обратитесь [к разделу инициализация поставщика транспорта](initializing-the-transport-provider.md).
    
## <a name="see-also"></a>См. также



[Запуск поставщика услуг](starting-a-service-provider.md)

