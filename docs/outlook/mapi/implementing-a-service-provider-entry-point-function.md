---
title: Реализация функции точки входа поставщика услуг
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 83ff54c4-86ce-4529-ae45-260dfb763b30
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 14dd11f873493e32b83dbd1960cac8ff8ef8e436
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32332993"
---
# <a name="implementing-a-service-provider-entry-point-function"></a>Реализация функции точки входа поставщика услуг

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Каждый поставщик услуг DLL имеет функцию точки входа, которую MAPI вызывает для ее загрузки. Следует помнить, что эта функция точки входа не такая, как [DllMain](https://msdn.microsoft.com/library/ms682583.aspx), функция точки входа в Win32 DLL.
  
В зависимости от типа поставщика функция точки входа поставщика соответствует другому прототипу. MAPI определяет различные прототипы функций точки входа для поставщиков услуг.
  
|**Поставщик**|**Прототип функции точки входа**|
|:-----|:-----|
|Поставщики магазинов сообщений  <br/> |[MSProviderInit](msproviderinit.md) <br/> |
|Поставщики транспорта  <br/> |[XPProviderInit](xpproviderinit.md) <br/> |
|Поставщики адресных книг  <br/> |[ABProviderInit](abproviderinit.md) <br/> |
   
Большая часть функций в этих прототипах одинаково для всех типов поставщиков услуг. 
  
Адресная книга, хранилище сообщений и поставщики транспорта выполняют следующие две основные задачи в своих функциях точки входа:
  
1. Проверьте версию интерфейса поставщика услуг (SPI), чтобы убедиться, что MAPI использует версию, совместимую с версией, которую использует поставщик услуг. Для выполнения проверки используйте параметр  _lpulMAPIVer,_ содержащий версию MAPI SPI, и  _параметр lpulProviderVer,_ содержащий версию SPI. Эти параметры — это 32-битные неподписаные integers, состоящие из трех частей: 
    
  - Биты от 24 до 31 представляют главную версию.
    
  - Биты от 16 до 23 представляют незначительную версию.
    
  - Биты от 0 до 15 представляют идентификатор обновления. Несмотря на то, что основной номер версии редко изменяется, незначительный номер версии изменяется при выпусках MAPI и изменения SPI. Идентификатор обновления — это внутренняя версия сборки Майкрософт; он используется для отслеживания изменений в процессе разработки. MAPI определяет постоянную CURRENT_SPI_VERSION, задокументированную в файле заголовки Mapispi.h, чтобы указать конечную версию SPI. Сбой проверки с ошибкой MAPI_E_VERSION, если вы используете версию SPI, которая является более новой, чем версия, которую использует MAPI.
    
2. Создание экземпляра объекта-поставщика. Так как поставщик может быть запущен и инициализирован несколько раз, необходимо создавать новый экземпляр каждый раз, когда это происходит. Поставщики запущены несколько раз, когда они отображаются в нескольких профилях, которые используются одновременно одним или несколькими клиентами, или когда они отображаются несколько раз в одном профиле. Точно так же, как прототип функции точки входа отличается в зависимости от типа поставщика, так и тип объекта-поставщика. 
    
    Если вы пишете поставщика адресных книг, реализуем [IABProvider : IUnknown](iabprovideriunknown.md). Если вы пишете поставщика магазина сообщений, реализуют [IMSProvider: IUnknown](imsprovideriunknown.md). Дополнительные сведения см. в [перенагрузке поставщиков магазинов сообщений.](loading-message-store-providers.md)
    
    Если вы пишете поставщика транспорта, реализуют [IXPProvider : IUnknown](ixpprovideriunknown.md). Дополнительные сведения см. в [инициализации поставщика транспорта.](initializing-the-transport-provider.md)
    
## <a name="see-also"></a>См. также



[Запуск поставщика услуг](starting-a-service-provider.md)

