---
title: Отслеживание бесед
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
api_type:
- COM
ms.assetid: 0500dee8-a39d-45ce-87b1-c515e92e083d
description: 'Дата последнего изменения: 23 июля 2011 г.'
localization_priority: Priority
ms.openlocfilehash: 3a59a7a15b4647832634adc4757544876b8841b1
ms.sourcegitcommit: d6695c94415fa47952ee7961a69660abc0904434
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2019
ms.locfileid: "28706224"
---
# <a name="tracking-conversations"></a>Отслеживание бесед

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Отслеживание беседы — это сбор ответов на сообщение. Клиенты должны настроить два свойства, помогающие облегчающие отслеживание бесед:
  
- **PR_CONVERSATION_TOPIC** ([PidTagConversationTopic](pidtagconversationtopic-canonical-property.md))
    
    **PR_CONVERSATION_TOPIC** — нормализованная тема сообщения, тема без строк префикса Установите для этого свойства значение свойства **PR_NORMALIZED_SUBJECT** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md)) сообщения. 
    
- **PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md))
    
    **PR_CONVERSATION_INDEX** указывает расположение сообщения в определенной беседе. За установку свойства **PR_CONVERSATION_INDEX** для каждого исходящего сообщения отвечает клиент, вне зависимости, новое ли это сообщение, пересылаемое или ответ. Клиенты могут настроить это свойство вручную или вызвать служебную функцию [ScCreateConversationIndex](sccreateconversationindex.md), предусмотренную в MAPI. 
    
 **ScCreateConversationIndex** создает значение индекса беседы для любого исходящего сообщения. **ScCreateConversationIndex** реализует индекс как блок заголовка длиной 22 байта, за которым следует нуль или дополнительные дочерние блоки длиной 5 байт каждый. 
  
Блок заголовка состоит из 22 байт, разделенных на три части:
  
- Один резервный байт. Его значение — 1.
    
- Пять байт для текущего системного времени, преобразованного в структурный формат [FILETIME](filetime.md). 
    
- Шестнадцать байт, содержащих глобальный уникальный идентификатор [GUID](guid.md).
    
Каждый дочерний блок состоит из 5 байт, разделенных указанным ниже образом:
  
- Один бит, содержащий код, который представляет разницу между текущим временем и временем, сохраненным в блоке заголовка. Этот бит равен 0, если разница составляет меньше 0,02 секунды или больше двух лет, и равен 1, если разница составляет меньше одной секунды или больше 56 лет.
    
- Тридцать один бит, содержащий разницу между текущим временем и временем в блоке заголовка, выраженным в единицах **FILETIME**. Эта часть дочернего блока создается с помощью одного из двух методов в зависимости от значения первого бита. Если этот бит равен нулю, функция **ScCreateConversationIndex** удаляет старшие 15 бит и младшие 18 бит. Если этот бит равен единице, функция удаляет старшие 10 бит и младшие 23 бита. 
    
- Четыре бита, содержащие случайное число, созданное с помощью вызова функции Win32 [GetTickCount](https://msdn.microsoft.com/library/ms724408%28VS.85%29.aspx).
    
- Четыре бита, содержащие значение порядкового номера, взятого из части случайного числа.
    
Если вы решили установить индексы сообщений для беседы вручную, рекомендуется учитывать указанные ниже предложения.
  
1. Сохраняйте разницу в часовых поясах респондентов понятной. Используйте время UTC, а не местное время.
    
2. Используйте одинаковые отступы для каждой группы сообщений.
    
3. Сортируйте ответы по одинаковой дате сообщения.
    
4. Разделяйте относящиеся к одной теме цепочки бесед, начатые в разное время. 
    
5. Для реализации сортировки по категориям, чтобы сообщения группировались по темам, сначала выполните сортировку по **PR_CONVERSATION_TOPIC**, а затем по **PR_CONVERSATION_INDEX**. Чтобы представить результаты сортировки, присвойте свойству **PR_DEPTH** ([PidTagDepth](pidtagdepth-canonical-property.md)) значение 0 для сообщений с длиной индекса беседы 22 байта. Затем для каждого увеличения длины на 5 байтов увеличивайте значение свойства **PR_DEPTH** на единицу. 
    
Группу свойств PR_ORIGINAL также можно использовать для отслеживания бесед. Настройте эти свойства, чтобы связать ответные или пересылаемые сообщения с исходным сообщением. Все свойства PR_ORIGINAL являются необязательными. Если явным образом не присвоено значение, например **PR_ORIGINAL_AUTHOR_ENTRYID** ([PidTagOriginalAuthorEntryId](pidtagoriginalauthorentryid-canonical-property.md)), поставщик хранилища сообщений может использовать значение по умолчанию или значение свойства **PR_SENDER_ENTRYID** ([PidTagSenderEntryId](pidtagsenderentryid-canonical-property.md)). Аналогичным образом, если не установлено значение **PR_ORIGINAL_AUTHOR_NAME** или **PR_ORIGINAL_SUBMIT_TIME** ([PidTagOriginalSubmitTime](pidtagoriginalsubmittime-canonical-property.md)), этим свойствам могут быть по умолчанию присвоены значения свойств **PR_SENDER_NAME** ([PidTagSenderName](pidtagsendername-canonical-property.md)) и **PR_CLIENT_SUBMIT_TIME** ([PidTagClientSubmitTime](pidtagclientsubmittime-canonical-property.md)) соответственно. 
  

