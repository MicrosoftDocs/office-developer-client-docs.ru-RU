---
title: Профили и службы сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 78a13bacf13b019bbf9436830ad66db7fdfaf425
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32356966"
---
# <a name="message-services-and-profiles"></a>Профили и службы сообщений
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Некоторым пользователям требуются службы нескольких систем обмена сообщениями, каждая из которых имеет одного или нескольких поставщиков услуг. Так как каждый из этих поставщиков услуг можно установить и настроить отдельно, а сервер обмена сообщениями обычно требует группы связанных поставщиков, чтобы обеспечить доступ ко всем их функциональным возможностям, MAPI включает концепцию службы сообщений. Службы сообщений помогают пользователям устанавливать и настраивать свои поставщики услуг.
  
Чтобы создать службу сообщений, разработчик пишет программу точки входа службы сообщений для обработки конфигурации каждого поставщика в службе и программы установки для выполнения следующих действий:
  
- Установите каждого поставщика в службе.
    
- Создайте записи файлов реестра и инициализации.
    
- Создайте записи в файле конфигурации MAPI Mapisvc. INF.
    
Файл Mapisvc. inf содержит сведения, относящиеся к конфигурации всех служб сообщений и поставщиков услуг, установленных на компьютере. Он организован в иерархические разделы с каждым уровнем, связанным со следующим. В верхней части представлены три раздела, содержащие следующие элементы: 
  
- Список файлов справки службы сообщений.
    
- Список наиболее важных или используемых по умолчанию служб сообщений.
    
- Список всех служб на компьютере.
    
Следующий уровень содержит разделы для каждой службы сообщений, а последний уровень содержит разделы для каждого поставщика услуг в службе. Для MAPI требуется, чтобы разработчики поставщиков услуг и служб сообщений добавляют определенные записи в Mapisvc. INF; Разработчики могут добавлять другие записи по собственному усмотрению. Большая часть информации из Mapisvc. INF завершается в одном или нескольких профилях, а также в коллекции сведений о конфигурации для предпочитаемого пользователем набора служб сообщений. Так как компьютер может иметь несколько пользователей, и один пользователь может иметь несколько наборов предпочтений, на компьютере может существовать множество профилей. Каждый профиль описывает отдельный набор служб сообщений. Наличие нескольких профилей позволяет пользователю работать, например, дома, с одним набором служб сообщений и в офисе с другим набором.
  
Профили создаются в ходе установки службы сообщений или времени входа клиентским приложением, которое обеспечивает поддержку конфигурации. MAPI предоставляет два таких клиентских приложения: элемент панели управления и мастер профилей. Элемент панели управления — это приложение с полными настройками, с помощью которого пользователи могут создавать, удалять, редактировать и копировать профили, а также вносить изменения в записи в профиле. Мастер профилей — это простое приложение, разработанное для упрощения добавления службы сообщений в профиль. Мастер профилей состоит из ряда диалоговых окон, называемых страницами свойств, которые запрашивают у пользователя процесс установки и настройки службы. Пользователю предлагается только ввести значения для наиболее важных параметров; все остальные параметры наследуют значения по умолчанию. После создания профиля пользователи не могут вносить изменения. 
  
Несмотря на то, что элемент панели управления всегда вызывается через панель управления, существует множество сценариев, которые могут вызывать работу мастера профилей. Клиентские приложения могут вызвать мастер профилей, чтобы создать профиль по умолчанию во время входа, если он еще не создан. Вместо повторной реализации кода для добавления профиля элемент панели управления или другое клиентское приложение может использовать функции, уже имеющиеся в мастере профилей. Служба сообщений в функции точки входа может вызывать мастер профилей при необходимости добавить службу в профиль по умолчанию. Службы сообщений, использующие мастер профилей, должны записывать дополнительную функцию точки входа и стандартную процедуру диалогового окна Windows. Мастер профилей вызывает функцию точки входа для получения диалогового окна настройки службы, в то время как процедура диалогового окна обрабатывает сообщения, созданные при использовании этого диалогового окна. 
  
Профили организованы аналогичным образом для файла Mapisvc. INF. Профили имеют связанные иерархические разделы; поставщики услуг владеют разделами на самом низком уровне, собственными разделами служб сообщений на среднем уровне, а MAPI — разделами на самом высоком уровне. Каждый раздел идентифицируется уникальным идентификатором, который называется [мапиуид](mapiuid.md). Разделы MAPI содержат внутреннюю информацию для MAPI, например идентификаторы всех разделов профиля службы сообщений и ссылки на каждый из остальных разделов. В каждом разделе службы сообщений хранятся ссылки на разделы поставщика, а в каждом разделе поставщика хранится ссылка на раздел службы. 
  
На следующем рисунке показано содержимое двух типовых профилей. SAM содержит два профиля на своем компьютере: один для домашнего использования и один для использования в Office. В домашнем профиле есть три службы сообщений. Служба сообщений X — это единственная служба поставщика для управления адресной книгой. В службах сообщений Y и Z есть три поставщика: поставщик адресных книг, поставщик хранилища сообщений и поставщик транспорта. Профиль работы диспетчера учетных записей содержит две различные службы сообщений, у каждой из которых есть поставщик адресных книг, поставщик хранилища сообщений и поставщик транспорта. 
  
**Пример профиля**
  
![Пример профиля] (media/amapi_56.gif "Пример профиля")
  
На следующем рисунке показан профиль, включающий две службы сообщений. Код для установки и настройки поставщиков услуг, относящихся к службе сообщений, находится в той же библиотеке DLL, что и код для поставщиков. Этот код считывает сведения из профиля во время входа, чтобы настроить поставщиков услуг, и при необходимости предложит пользователю (если это возможно), чтобы получить недостающие сведения. Запросы от клиента на просмотр или изменение параметров конфигурации для любого поставщика также обрабатываются с помощью этого общего кода.
  
**Установка и настройка поставщиков услуг**
  
![Установка и настройка поставщиков услуг] (media/amapi_55.gif "Установка и настройка поставщиков услуг")
  
## <a name="see-also"></a>См. также

- [MAPIUID](mapiuid.md)
- [Общие сведения о программировании MAPI](mapi-programming-overview.md)

