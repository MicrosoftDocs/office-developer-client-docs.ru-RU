---
title: Профили и службы сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 78a13bacf13b019bbf9436830ad66db7fdfaf425
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33415469"
---
# <a name="message-services-and-profiles"></a><span data-ttu-id="9d6a7-103">Профили и службы сообщений</span><span class="sxs-lookup"><span data-stu-id="9d6a7-103">Message services and profiles</span></span>
  
<span data-ttu-id="9d6a7-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="9d6a7-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="9d6a7-105">Некоторым пользователям требуются службы нескольких систем обмена сообщениями, каждая из которых имеет одного или нескольких поставщиков услуг.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-105">Some users require the services of several messaging systems, each with one or more service providers.</span></span> <span data-ttu-id="9d6a7-106">Так как каждый из этих поставщиков услуг можно установить и настроить отдельно, а сервер обмена сообщениями обычно требует группы связанных поставщиков, чтобы обеспечить доступ ко всем их функциональным возможностям, MAPI включает концепцию службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-106">Because it is cumbersome to install and configure each of these service providers individually, and because a messaging server usually requires a group of related providers to expose all its functionality, MAPI includes the concept of a message service.</span></span> <span data-ttu-id="9d6a7-107">Службы сообщений помогают пользователям устанавливать и настраивать свои поставщики услуг.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-107">Message services help users install and configure their service providers.</span></span>
  
<span data-ttu-id="9d6a7-108">Чтобы создать службу сообщений, разработчик пишет программу точки входа службы сообщений для обработки конфигурации каждого поставщика в службе и программы установки для выполнения следующих действий:</span><span class="sxs-lookup"><span data-stu-id="9d6a7-108">To create a message service, a developer writes a message-service entry point program to handle the configuration of each provider in the service and a setup program to do the following:</span></span>
  
- <span data-ttu-id="9d6a7-109">Установите каждого поставщика в службе.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-109">Install each provider in the service.</span></span>
    
- <span data-ttu-id="9d6a7-110">Создайте записи файлов реестра и инициализации.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-110">Create registry and initialization file entries.</span></span>
    
- <span data-ttu-id="9d6a7-111">Создайте записи в файле конфигурации MAPI Mapisvc. INF.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-111">Create entries in the MAPI configuration file, Mapisvc.inf.</span></span>
    
<span data-ttu-id="9d6a7-112">Файл Mapisvc. inf содержит сведения, относящиеся к конфигурации всех служб сообщений и поставщиков услуг, установленных на компьютере.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-112">The Mapisvc.inf file contains information that relates to the configuration of all message services and service providers installed on the computer.</span></span> <span data-ttu-id="9d6a7-113">Он организован в иерархические разделы с каждым уровнем, связанным со следующим.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-113">It is organized in hierarchical sections, with each level linked to the next.</span></span> <span data-ttu-id="9d6a7-114">В верхней части представлены три раздела, содержащие следующие элементы:</span><span class="sxs-lookup"><span data-stu-id="9d6a7-114">At the top are three sections that contain the following:</span></span> 
  
- <span data-ttu-id="9d6a7-115">Список файлов справки службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-115">A list of message service Help files.</span></span>
    
- <span data-ttu-id="9d6a7-116">Список наиболее важных или используемых по умолчанию служб сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-116">A list of the most important, or default, message services.</span></span>
    
- <span data-ttu-id="9d6a7-117">Список всех служб на компьютере.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-117">A list of all the services on the computer.</span></span>
    
<span data-ttu-id="9d6a7-118">Следующий уровень содержит разделы для каждой службы сообщений, а последний уровень содержит разделы для каждого поставщика услуг в службе.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-118">The next level contains sections for each message service, and the last level contains sections for each service provider in a service.</span></span> <span data-ttu-id="9d6a7-119">Для MAPI требуется, чтобы разработчики поставщиков услуг и служб сообщений добавляют определенные записи в Mapisvc. INF; Разработчики могут добавлять другие записи по собственному усмотрению.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-119">MAPI requires that developers of service providers and message services add certain entries to Mapisvc.inf; developers can add other entries at their own discretion.</span></span> <span data-ttu-id="9d6a7-120">Большая часть информации из Mapisvc. INF завершается в одном или нескольких профилях, а также в коллекции сведений о конфигурации для предпочитаемого пользователем набора служб сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-120">Most of the information in Mapisvc.inf ends up in one or more profiles, a collection of configuration information for a user's preferred set of message services.</span></span> <span data-ttu-id="9d6a7-121">Так как компьютер может иметь несколько пользователей, и один пользователь может иметь несколько наборов предпочтений, на компьютере может существовать множество профилей.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-121">Because a computer can have multiple users and a single user can have multiple sets of preferences, many profiles can exist on a computer.</span></span> <span data-ttu-id="9d6a7-122">Каждый профиль описывает отдельный набор служб сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-122">Each profile describes a different set of message services.</span></span> <span data-ttu-id="9d6a7-123">Наличие нескольких профилей позволяет пользователю работать, например, дома, с одним набором служб сообщений и в офисе с другим набором.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-123">Having multiple profiles enables a user to work, for example, at home with one set of message services and at the office with a different set.</span></span>
  
<span data-ttu-id="9d6a7-124">Профили создаются в ходе установки службы сообщений или времени входа клиентским приложением, которое обеспечивает поддержку конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-124">Profiles are created at message service installation or logon time by a client application that provides configuration support.</span></span> <span data-ttu-id="9d6a7-125">MAPI предоставляет два таких клиентских приложения: элемент панели управления и мастер профилей.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-125">MAPI provides two such client applications: a Control Panel item and the Profile Wizard.</span></span> <span data-ttu-id="9d6a7-126">Элемент панели управления — это приложение с полными настройками, с помощью которого пользователи могут создавать, удалять, редактировать и копировать профили, а также вносить изменения в записи в профиле.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-126">The Control Panel item is a full-service configuration application with which users can create, delete, edit, and copy profiles, as well as make modifications to the entries in a profile.</span></span> <span data-ttu-id="9d6a7-127">Мастер профилей — это простое приложение, разработанное для упрощения добавления службы сообщений в профиль.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-127">The Profile Wizard is a simple application designed to make adding a message service to a profile as easy as possible.</span></span> <span data-ttu-id="9d6a7-128">Мастер профилей состоит из ряда диалоговых окон, называемых страницами свойств, которые запрашивают у пользователя процесс установки и настройки службы.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-128">The Profile Wizard consists of a series of dialog boxes, called property pages, that prompt the user through the process of installing and configuring a service.</span></span> <span data-ttu-id="9d6a7-129">Пользователю предлагается только ввести значения для наиболее важных параметров; все остальные параметры наследуют значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-129">The user is prompted only for values for the most critical settings; all other settings inherit default values.</span></span> <span data-ttu-id="9d6a7-130">После создания профиля пользователи не могут вносить изменения.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-130">Once the profile has been created, users are not allowed to make changes.</span></span> 
  
<span data-ttu-id="9d6a7-131">Несмотря на то, что элемент панели управления всегда вызывается через панель управления, существует множество сценариев, которые могут вызывать работу мастера профилей.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-131">Whereas the Control Panel item is always invoked through the Control Panel, there are a variety of scenarios that can cause the Profile Wizard to be called.</span></span> <span data-ttu-id="9d6a7-132">Клиентские приложения могут вызвать мастер профилей, чтобы создать профиль по умолчанию во время входа, если он еще не создан.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-132">Client applications can call the Profile Wizard to create a default profile at logon time when one has not yet been created.</span></span> <span data-ttu-id="9d6a7-133">Вместо повторной реализации кода для добавления профиля элемент панели управления или другое клиентское приложение может использовать функции, уже имеющиеся в мастере профилей.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-133">Rather than reimplementing code to add a profile, the Control Panel item or another client application can rely on the functionality already in the Profile Wizard.</span></span> <span data-ttu-id="9d6a7-134">Служба сообщений в функции точки входа может вызывать мастер профилей при необходимости добавить службу в профиль по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-134">A message service, in its entry point function, can call the Profile Wizard when the service needs to be added to the default profile.</span></span> <span data-ttu-id="9d6a7-135">Службы сообщений, использующие мастер профилей, должны записывать дополнительную функцию точки входа и стандартную процедуру диалогового окна Windows.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-135">Message services that use the Profile Wizard must write an extra entry point function and a standard Windows dialog box procedure.</span></span> <span data-ttu-id="9d6a7-136">Мастер профилей вызывает функцию точки входа для получения диалогового окна настройки службы, в то время как процедура диалогового окна обрабатывает сообщения, созданные при использовании этого диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-136">The Profile Wizard calls the entry point function to retrieve the service's configuration dialog box while the dialog box procedure handles the messages that are generated when this dialog box is in use.</span></span> 
  
<span data-ttu-id="9d6a7-137">Профили организованы аналогичным образом для файла Mapisvc. INF.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-137">Profiles are organized in a similar way to the Mapisvc.inf file.</span></span> <span data-ttu-id="9d6a7-138">Профили имеют связанные иерархические разделы; поставщики услуг владеют разделами на самом низком уровне, собственными разделами служб сообщений на среднем уровне, а MAPI — разделами на самом высоком уровне.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-138">Profiles have linked hierarchical sections; service providers own sections in the lowest level, message services own sections in the middle level, and MAPI owns sections in the highest level.</span></span> <span data-ttu-id="9d6a7-139">Каждый раздел идентифицируется уникальным идентификатором, который называется [мапиуид](mapiuid.md).</span><span class="sxs-lookup"><span data-stu-id="9d6a7-139">Each section is identified with a unique identifier known as a [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="9d6a7-140">Разделы MAPI содержат внутреннюю информацию для MAPI, например идентификаторы всех разделов профиля службы сообщений и ссылки на каждый из остальных разделов.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-140">The MAPI sections contain information internal to MAPI, such as the identifiers of all of the message service profile sections and links to each of the other sections.</span></span> <span data-ttu-id="9d6a7-141">В каждом разделе службы сообщений хранятся ссылки на разделы поставщика, а в каждом разделе поставщика хранится ссылка на раздел службы.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-141">Each message service section stores links to its provider sections, and each provider section stores a link to its service section.</span></span> 
  
<span data-ttu-id="9d6a7-142">На следующем рисунке показано содержимое двух типовых профилей.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-142">The following illustration shows the contents of two typical profiles.</span></span> <span data-ttu-id="9d6a7-143">SAM содержит два профиля на своем компьютере: один для домашнего использования и один для использования в Office.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-143">Sam has two profiles on his computer, one for home use and one for office use.</span></span> <span data-ttu-id="9d6a7-144">В домашнем профиле есть три службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-144">The home profile contains three message services.</span></span> <span data-ttu-id="9d6a7-145">Служба сообщений X — это единственная служба поставщика для управления адресной книгой.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-145">Message Service X is a single provider service for address book management.</span></span> <span data-ttu-id="9d6a7-146">В службах сообщений Y и Z есть три поставщика: поставщик адресных книг, поставщик хранилища сообщений и поставщик транспорта.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-146">Message Services Y and Z have three providers — an address book provider, a message store provider, and a transport provider.</span></span> <span data-ttu-id="9d6a7-147">Профиль работы диспетчера учетных записей содержит две различные службы сообщений, у каждой из которых есть поставщик адресных книг, поставщик хранилища сообщений и поставщик транспорта.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-147">Sam's Work Profile contains two different message services, each of which has an address book provider, a message store provider, and a transport provider.</span></span> 
  
<span data-ttu-id="9d6a7-148">**Пример профиля**</span><span class="sxs-lookup"><span data-stu-id="9d6a7-148">**Profile example**</span></span>
  
<span data-ttu-id="9d6a7-149">![Пример профиля] (media/amapi_56.gif "Пример профиля")</span><span class="sxs-lookup"><span data-stu-id="9d6a7-149">![Profile example](media/amapi_56.gif "Profile example")</span></span>
  
<span data-ttu-id="9d6a7-150">На следующем рисунке показан профиль, включающий две службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-150">The following illustration shows a profile that includes two message services.</span></span> <span data-ttu-id="9d6a7-151">Код для установки и настройки поставщиков услуг, относящихся к службе сообщений, находится в той же библиотеке DLL, что и код для поставщиков.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-151">The code for installing and configuring the service providers that belong to the message service resides in the same DLL as the code for the providers.</span></span> <span data-ttu-id="9d6a7-152">Этот код считывает сведения из профиля во время входа, чтобы настроить поставщиков услуг, и при необходимости предложит пользователю (если это возможно), чтобы получить недостающие сведения.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-152">This code reads information from the profile at logon time to configure the service providers, and it prompts the user, if possible and necessary, for missing information.</span></span> <span data-ttu-id="9d6a7-153">Запросы от клиента на просмотр или изменение параметров конфигурации для любого поставщика также обрабатываются с помощью этого общего кода.</span><span class="sxs-lookup"><span data-stu-id="9d6a7-153">Requests from a client to view or change configuration settings for any of the providers are also handled by this common code.</span></span>
  
<span data-ttu-id="9d6a7-154">**Установка и настройка поставщиков услуг**</span><span class="sxs-lookup"><span data-stu-id="9d6a7-154">**Installing and configuring service providers**</span></span>
  
<span data-ttu-id="9d6a7-155">![Установка и настройка поставщиков услуг] (media/amapi_55.gif "Установка и настройка поставщиков услуг")</span><span class="sxs-lookup"><span data-stu-id="9d6a7-155">![Installing and configuring service providers](media/amapi_55.gif "Installing and configuring service providers")</span></span>
  
## <a name="see-also"></a><span data-ttu-id="9d6a7-156">См. также</span><span class="sxs-lookup"><span data-stu-id="9d6a7-156">See also</span></span>

- [<span data-ttu-id="9d6a7-157">MAPIUID</span><span class="sxs-lookup"><span data-stu-id="9d6a7-157">MAPIUID</span></span>](mapiuid.md)
- [<span data-ttu-id="9d6a7-158">Общие сведения о программировании MAPI</span><span class="sxs-lookup"><span data-stu-id="9d6a7-158">MAPI Programming Overview</span></span>](mapi-programming-overview.md)

