---
title: Профили и службы сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 78a13bacf13b019bbf9436830ad66db7fdfaf425
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33415469"
---
# <a name="message-services-and-profiles"></a>Профили и службы сообщений
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Некоторым пользователям требуются службы нескольких систем обмена сообщениями, каждая из которых имеет одного или нескольких поставщиков услуг. Поскольку установка и настройка каждого из этих поставщиков услуг по отдельности является громоздкой задачей, а поскольку серверу обмена сообщениями обычно требуется группа связанных поставщиков, чтобы раскрыть все его функции, MAPI включает концепцию службы сообщений. Службы сообщений помогают пользователям устанавливать и настраивать поставщиков услуг.
  
Чтобы создать службу сообщений, разработчик пишет программу точки входа в службу сообщений для обработки конфигурации каждого поставщика в службе и программы установки для следующих этапов:
  
- Установка каждого поставщика в службе.
    
- Создание записей файлов реестра и инициализации.
    
- Создание записей в файле конфигурации MAPI Mapisvc.inf.
    
Файл Mapisvc.inf содержит сведения, которые относятся к конфигурации всех служб и поставщиков сообщений, установленных на компьютере. Она организована в иерархических разделах, каждый уровень которых связан со следующим. В верхней части находятся три раздела, содержащие следующие разделы: 
  
- Список файлов справки службы сообщений.
    
- Список наиболее важных или по умолчанию служб сообщений.
    
- Список всех служб на компьютере.
    
Следующий уровень содержит разделы для каждой службы сообщений, а последний уровень содержит разделы для каждого поставщика услуг в службе. MAPI требует, чтобы разработчики поставщиков услуг и служб сообщений добавляли определенные записи в Mapisvc.inf; разработчики могут добавлять другие записи по своему усмотрению. Большая часть сведений в Mapisvc.inf попадает в один или несколько профилей, коллекция сведений о конфигурации для предпочтительного набора служб сообщений пользователя. Поскольку на компьютере может быть несколько пользователей, а у одного пользователя может быть несколько наборов предпочтений, на компьютере может существовать множество профилей. Каждый профиль описывает различные службы сообщений. Наличие нескольких профилей позволяет пользователю работать, например, дома с одним набором служб сообщений и в офисе с другим набором.
  
Профили создаются при установке службы сообщений или во время логоса клиентского приложения, которое обеспечивает поддержку конфигурации. MAPI предоставляет два таких клиентских приложения: элемент панели управления и мастер профилей. Элемент Панели управления — это полное приложение конфигурации службы, с помощью которого пользователи могут создавать, удалять, редактировать и копировать профили, а также вносить изменения в записи в профиле. Мастер профилей — это простое приложение, предназначенное для максимально простого добавления службы сообщений в профиль. Мастер профилей состоит из ряда диалогов, называемых страницами свойств, которые подсказывали пользователю процесс установки и настройки службы. Пользователь получает запрос только для значений для наиболее важных параметров; все остальные параметры наследуют значения по умолчанию. После создания профиля пользователям не разрешается вносить изменения. 
  
В то время как элемент Панели управления всегда вызывается через панель управления, существует множество сценариев, которые могут вызвать мастер профилей. Клиентские приложения могут вызвать мастера профилей для создания профиля по умолчанию в момент, когда он еще не создан. Вместо повторного добавления кода для добавления профиля элемент Панели управления или другое клиентное приложение могут полагаться на функции, которые уже есть в мастере профилей. Служба сообщений в своей функции точки входа может вызывать мастера профилей, когда службу необходимо добавить в профиль по умолчанию. Службы сообщений, которые используют мастер профилей, должны написать дополнительную функцию точки входа и стандартную процедуру Windows диалоговом окне. Мастер профиля вызывает функцию точки входа, чтобы получить диалоговое окно конфигурации службы, в то время как процедура диалогового окна обрабатывает сообщения, созданные при использовании этого диалоговое окно. 
  
Профили организованы аналогично файлу Mapisvc.inf. Профили имеют связанные иерархические разделы; Поставщики услуг владеют разделами на самом низком уровне, службы сообщений владеют разделами на среднем уровне, а MAPI владеет разделами на самом высоком уровне. Каждый раздел идентифицируется с уникальным идентификатором, известным как [MAPIUID.](mapiuid.md) Разделы MAPI содержат информацию, внутреннюю для MAPI, например идентификаторы всех разделов профилей службы сообщений и ссылки на каждый из других разделов. Каждый раздел службы сообщений хранит ссылки на разделы поставщика, а каждый раздел поставщика сохраняет ссылку на раздел службы. 
  
На следующей иллюстрации показано содержимое двух типичных профилей. На компьютере у Сэма два профиля: один для домашнего использования и один для использования в офисе. Домашний профиль содержит три службы сообщений. Служба сообщений X — это единая служба поставщиков для управления адресной книгой. Службы сообщений Y и Z имеют три поставщика — поставщик адресных книг, поставщик магазинов сообщений и поставщик транспорта. Рабочий профиль Sam содержит две различные службы сообщений, каждая из которых имеет поставщика адресной книги, поставщика магазина сообщений и поставщика транспорта. 
  
**Пример профиля**
  
![Пример профиля](media/amapi_56.gif "пример профиля")
  
На следующем рисунке показан профиль, который включает две службы сообщений. Код для установки и настройки поставщиков услуг, принадлежащих службе сообщений, находится в том же DLL, что и код для поставщиков. Этот код считыет сведения из профиля во время настройки поставщиков услуг, и он подсказывет пользователю, если это возможно и необходимо, для получения недостающих сведений. Запросы клиента на просмотр или изменение параметров конфигурации для любого из поставщиков также обрабатываются этим общим кодом.
  
**Установка и настройка поставщиков услуг**
  
![Установка и настройка поставщиков услуг]по установке и(media/amapi_55.gif "настройке поставщиков услуг")
  
## <a name="see-also"></a>См. также

- [MAPIUID](mapiuid.md)
- [Общие сведения о программировании MAPI](mapi-programming-overview.md)

