---
title: Профили и службы сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: df0db1e4-69c8-44ec-bb2a-d31fc8a564b9
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 78a13bacf13b019bbf9436830ad66db7fdfaf425
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33415469"
---
# <a name="message-services-and-profiles"></a>Профили и службы сообщений
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Некоторым пользователям требуются службы нескольких систем обмена сообщениями, каждая из которых имеет одного или нескольких поставщиков услуг. Поскольку устанавливать и настраивать каждого из этих поставщиков услуг по отдельности, а также потому, что серверу обмена сообщениями обычно требуется группа связанных поставщиков для представления всех его функций, MAPI включает концепцию службы сообщений. Службы сообщений помогают пользователям устанавливать и настраивать поставщиков услуг.
  
Чтобы создать службу сообщений, разработчик записывает программу точки входа службы сообщений для обработки конфигурации каждого поставщика в службе и программу установки, чтобы сделать следующее:
  
- Установите каждого поставщика в службе.
    
- Создайте записи файлов реестра и инициализации.
    
- Создайте записи в файле конфигурации MAPI Mapisvc.inf.
    
Файл Mapisvc.inf содержит сведения, которые связаны с конфигурацией всех служб сообщений и поставщиков служб, установленных на компьютере. Она организована в иерархические разделы, каждый уровень которых связан со следующим. В верхней части три раздела содержат следующие разделы: 
  
- Список файлов справки службы сообщений.
    
- Список наиболее важных (или стандартных) служб сообщений.
    
- Список всех служб на компьютере.
    
Следующий уровень содержит разделы для каждой службы сообщений, а последний уровень содержит разделы для каждого поставщика службы в службе. MAPI требует, чтобы разработчики поставщиков услуг и служб сообщений добавляли определенные записи в mapisvc.inf; разработчики могут добавлять другие записи по собственному усмотрению. Большая часть сведений в mapisvc.inf попадает в один или несколько профилей, коллекция сведений о конфигурации для предпочитаемого пользователем набора служб сообщений. Так как на компьютере может быть несколько пользователей и один пользователь может иметь несколько наборов настроек, на компьютере может существовать множество профилей. Каждый профиль описывает свой набор служб сообщений. Наличие нескольких профилей позволяет пользователю работать, например, дома с одним набором служб сообщений, а в офисе — с другим набором.
  
Профили создаются во время установки службы сообщений или во время их логотипа клиентского приложения, которое обеспечивает поддержку конфигурации. MAPI предоставляет два таких клиентских приложения: элемент панели управления и мастер профилей. Элемент панели управления — это приложение конфигурации полной службы, с помощью которого пользователи могут создавать, удалять, редактировать и копировать профили, а также изменять записи в профиле. Мастер профилей — это простое приложение, предназначенное для максимально простого добавления службы сообщений в профиль. Мастер профилей состоит из ряда диалогов, называемых страницами свойств, которые подсказали пользователю об установке и настройке службы. Пользователю будут предложены только значения для наиболее важных параметров; все остальные параметры наследуют значения по умолчанию. После создания профиля пользователи не смогут вносить изменения. 
  
В то время как элемент панели управления всегда вызывается с помощью панели управления, существует множество сценариев, которые могут привести к вызову мастера профилей. Клиентские приложения могут вызвать мастер профилей, чтобы создать профиль по умолчанию при его создании. Вместо повторного применения кода для добавления профиля элемент панели управления или другое клиентского приложения может использовать функции, уже в мастере профилей. Служба сообщений в своей функции точки входа может вызвать мастер профилей, когда службу необходимо добавить в профиль по умолчанию. Службы сообщений, которые используют мастер профилей, должны написать дополнительную функцию точки входа и стандартную процедуру в диалоговом окне Windows. Мастер профилей вызывает функцию точки входа, чтобы получить диалоговое окно конфигурации службы, в то время как процедура в этом диалоговом окне обрабатывает сообщения, созданные при использовании этого диалогового окна. 
  
Профили организованы аналогично файлу Mapisvc.inf. Профили имеют связанные иерархические разделы; Поставщики услуг владеют разделами на самом низком уровне, службы сообщений собственные разделы на среднем уровне, а MAPI владеет разделами на самом высоком уровне. Каждый раздел идентифицируется с помощью уникального идентификатора, известного как [MAPIUID.](mapiuid.md) Разделы MAPI содержат внутренние сведения о MAPI, такие как идентификаторы всех разделов профиля службы сообщений и ссылки на каждый из других разделов. В каждом разделе службы сообщений хранится ссылка на разделы поставщика, а в каждом разделе поставщика хранится ссылка на раздел службы. 
  
На следующем рисунке показано содержимое двух типичных профилей. Sam has two profiles on his computer: one for home use and one for office use. Домашний профиль содержит три службы сообщений. Служба сообщений X — это служба единого поставщика для управления адресной книгой. Службы сообщений Y и Z имеют три поставщика — поставщик адресной книги, поставщик хранения сообщений и поставщик транспорта. Рабочий профиль Sam содержит две разные службы сообщений, каждая из которых имеет поставщика адресной книги, поставщика хранилище сообщений и поставщика транспорта. 
  
**Пример профиля**
  
![Пример профиля](media/amapi_56.gif "")
  
На следующем рисунке показан профиль, который включает две службы сообщений. Код для установки и настройки поставщиков услуг, принадлежащих службе сообщений, находится в той же DLL- и в коде для поставщиков. Этот код считыет сведения из профиля во время логотипа, чтобы настроить поставщиков услуг, и при необходимости запросит у пользователя отсутствующие сведения. Этот общий код также обрабатывает запросы от клиента на просмотр или изменение параметров конфигурации для любого из поставщиков.
  
**Установка и настройка поставщиков услуг**
  
![Установка и настройка поставщиков служб,](media/amapi_55.gif "устанавливающих и настраивающих поставщиков услуг")
  
## <a name="see-also"></a>См. также

- [MAPIUID](mapiuid.md)
- [Общие сведения о программировании MAPI](mapi-programming-overview.md)

