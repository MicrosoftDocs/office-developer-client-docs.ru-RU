---
title: Модуль бездействия MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 755d096a-2a61-44d2-a765-5d464a857756
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: c535da245be09f930a70c5fae2a892f33087ebf9
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19809761"
---
# <a name="mapi-idle-engine"></a><span data-ttu-id="4e3ca-103">Модуль бездействия MAPI</span><span class="sxs-lookup"><span data-stu-id="4e3ca-103">MAPI Idle Engine</span></span>

  
  
<span data-ttu-id="4e3ca-104">**Относится к**: Outlook</span><span class="sxs-lookup"><span data-stu-id="4e3ca-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="4e3ca-105">MAPI предоставляет несколько функций, которые называются idle модуля.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-105">MAPI provides several functions that are collectively known as the idle engine.</span></span> <span data-ttu-id="4e3ca-106">Эти функции позволяют клиентов, поставщиками адресной книги и поставщиков хранилища сообщений для выполнения различных задач медленных периоды в сеансе или в ответ на медленных времени.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-106">These functions allow clients, address book providers, and message store providers to perform various tasks during slow times in the session or in response to a slow time.</span></span> <span data-ttu-id="4e3ca-107">К примеру клиентов и поставщиков услуг можно отложить медленных операций или закрыть файлы, которые остаются неиспользуемых в течение длительных.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-107">For example, clients and service providers can defer slow operations or close files that have remained unused for a lengthy period.</span></span> <span data-ttu-id="4e3ca-108">Поставщиками транспорта обычно не используется простоя модуль так как метод **IXPLogon::Idle** принимает его место.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-108">Transport providers typically do not use the idle engine because the **IXPLogon::Idle** method takes its place.</span></span> <span data-ttu-id="4e3ca-109">Для получения дополнительных сведений см [IXPLogon::Idle](ixplogon-idle.md).</span><span class="sxs-lookup"><span data-stu-id="4e3ca-109">For more information, see [IXPLogon::Idle](ixplogon-idle.md).</span></span>
  
<span data-ttu-id="4e3ca-110">Чтобы использовать простоя модуля, клиентов и поставщиков услуг создать функции обратного вызова, которая содержит задачи, которые должны происходить во время простоя в подсистеме MAPI.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-110">To use the idle engine, clients and service providers create a callback function that contains the tasks that should occur when the MAPI subsystem is idle.</span></span> <span data-ttu-id="4e3ca-111">Когда MAPI обнаруживает время простоя, он вызывает эту функцию обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-111">When MAPI detects idle time, it invokes this callback function.</span></span> <span data-ttu-id="4e3ca-112">Если функция обратного вызова выглядит следующим образом прототип **FNIDLE** , определены следующим образом:</span><span class="sxs-lookup"><span data-stu-id="4e3ca-112">The callback function follows the **FNIDLE** prototype, defined as follows:</span></span> 
  
 `BOOL (STDAPICALLTYPE FNIDLE) (LPVOID lpvContext)`
  
<span data-ttu-id="4e3ca-113">Для получения дополнительных сведений см [FNIDLE](fnidle.md).</span><span class="sxs-lookup"><span data-stu-id="4e3ca-113">For more information, see [FNIDLE](fnidle.md).</span></span>
  
<span data-ttu-id="4e3ca-114">Функции, которые составляют простоя модуля являются:</span><span class="sxs-lookup"><span data-stu-id="4e3ca-114">The functions that make up the idle engine are:</span></span>
  
[<span data-ttu-id="4e3ca-115">ChangeIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="4e3ca-115">ChangeIdleRoutine</span></span>](changeidleroutine.md)
  
[<span data-ttu-id="4e3ca-116">DeregisterIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="4e3ca-116">DeregisterIdleRoutine</span></span>](deregisteridleroutine.md)
  
[<span data-ttu-id="4e3ca-117">EnableIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="4e3ca-117">EnableIdleRoutine</span></span>](enableidleroutine.md)
  
[<span data-ttu-id="4e3ca-118">FtgRegisterIdleRoutine</span><span class="sxs-lookup"><span data-stu-id="4e3ca-118">FtgRegisterIdleRoutine</span></span>](ftgregisteridleroutine.md)
  
[<span data-ttu-id="4e3ca-119">MAPIDeInitIdle</span><span class="sxs-lookup"><span data-stu-id="4e3ca-119">MAPIDeInitIdle</span></span>](mapideinitidle.md)
  
[<span data-ttu-id="4e3ca-120">MAPIInitIdle</span><span class="sxs-lookup"><span data-stu-id="4e3ca-120">MAPIInitIdle</span></span>](mapiinitidle.md)
  
<span data-ttu-id="4e3ca-121">Чтобы зарегистрировать функцию обратного вызова, клиентов и поставщиков услуг вызовите функцию **FtgRegisterIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="4e3ca-121">To register a callback function, clients and service providers call the **FtgRegisterIdleRoutine** function.</span></span> <span data-ttu-id="4e3ca-122">Входные параметры включают необязательный приоритет, блок памяти, передаваемое в функции обратного вызова в качестве входных данных за период времени для использования в соответствующие, никаких уведомлений и набор параметр флагов.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-122">The input parameters include an optional priority, a block of memory that is passed to your callback function as input, an amount of time to be used in any way appropriate, and a set of option flags.</span></span> 
  
<span data-ttu-id="4e3ca-123">Клиенты и поставщиков услуг можно указать приоритет в параметре _priIdle_ , который определяет способ выполнения простоя функции или укажите ноль, если приоритет проблема не возникает.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-123">Clients and service providers can specify a priority in the  _priIdle_ parameter that controls how the idle function runs or specify zero if priority is not an issue.</span></span> <span data-ttu-id="4e3ca-124">Так как отрицательные числа представляют более высокие приоритеты, чем положительными числами или ноль, сжатие и операций поиска должна быть назначена отрицательными числами.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-124">Because negative numbers represent higher priorities than positive numbers or zero, compression and search operations should be assigned negative numbers.</span></span> <span data-ttu-id="4e3ca-125">Задачи, выполняемые после должна быть назначена положительными числами.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-125">Tasks that occur once should be assigned positive numbers.</span></span> 
  
<span data-ttu-id="4e3ca-126">Отмена регистрации функцию active обратного вызова, клиентов и поставщиков услуг вызовите функцию **DeregisterIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="4e3ca-126">To deregister an active callback function, clients and service providers call the **DeregisterIdleRoutine** function.</span></span> <span data-ttu-id="4e3ca-127">Так как **DeregisterIdleRoutine** выполняется в асинхронном режиме, возможно, для функции обратного вызова для вызова в любое время во время вызова deregister и возможно даже после возвращения **DeregisterIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="4e3ca-127">Because **DeregisterIdleRoutine** operates asynchronously, it is possible for the callback function to be invoked at any time during the deregister call and possibly even after **DeregisterIdleRoutine** has returned.</span></span> 
  
<span data-ttu-id="4e3ca-128">Чтобы изменить некоторые или все характеристики функции обратного вызова, клиентов и поставщиков услуг вызовите функцию **ChangeIdleRoutine** .</span><span class="sxs-lookup"><span data-stu-id="4e3ca-128">To modify some or all of the characteristics of a callback function, clients and service providers call the **ChangeIdleRoutine** function.</span></span> <span data-ttu-id="4e3ca-129">**ChangeIdleRoutine** вносятся изменения в соответствии с как задать параметр флаги _ircIdle_ ; **ChangeIdleRoutine** можно изменить самой функции, его приоритета, установленного и входного параметра.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-129">**ChangeIdleRoutine** makes changes according to how the flags parameter  _ircIdle_ is set; **ChangeIdleRoutine** can change the function itself, its priority, time setting, and input parameter.</span></span> 
  
<span data-ttu-id="4e3ca-130">MAPI определяет простоя же, как операционная система, при определении имеет операционная система.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-130">MAPI defines idle the same as the operating system, when the operating system has a definition.</span></span> <span data-ttu-id="4e3ca-131">На Win32 MAPI создает поток с приоритетом простоя класс простоя заданий по расписанию.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-131">On Win32, MAPI creates a thread with idle-class priority to schedule idle tasks.</span></span> <span data-ttu-id="4e3ca-132">Данный поток отслеживает время и отправляет сообщение в поток, который является на выполнение задачи периода бездействия при поступлении время для выполнения.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-132">This thread keeps track of the time and posts a message to the thread that is to execute the idle task when the time for its execution arrives.</span></span> <span data-ttu-id="4e3ca-133">Win32 планирует потоки, не обрабатывает.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-133">Win32 schedules threads, not processes.</span></span> <span data-ttu-id="4e3ca-134">Если задачи, которые имеют приоритет выше, чем приоритет простоя выполняются на рабочей станции, задачи периода бездействия следует не получите запланировать выполнение до завершения задачи.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-134">If tasks that have a priority higher than the idle priority are occurring on the workstation, the idle task should not get scheduled for execution until the tasks have completed.</span></span> 
  
<span data-ttu-id="4e3ca-135">Выполните все задачи простоя в потоке, который называется **MAPIInitIdle**.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-135">All idle tasks run on the thread that called **MAPIInitIdle**.</span></span> <span data-ttu-id="4e3ca-136">MAPI имеет отдельный поток для планирования, но при простоя задач становится доступным, публикует сообщение обратно в поток инициализации, а также задачи периода бездействия существует.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-136">MAPI has a separate thread for scheduling, but when an idle task becomes eligible, it posts a message back over to the initialization thread and the idle task is executed there.</span></span> <span data-ttu-id="4e3ca-137">Последствия для различных типов клиентов, как показано ниже.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-137">The implications for different types of clients are as follows.</span></span>
  
|<span data-ttu-id="4e3ca-138">**Потоковой модели**</span><span class="sxs-lookup"><span data-stu-id="4e3ca-138">**Threading model**</span></span>|<span data-ttu-id="4e3ca-139">**Импликации**</span><span class="sxs-lookup"><span data-stu-id="4e3ca-139">**Implication**</span></span>|
|:-----|:-----|
|<span data-ttu-id="4e3ca-140">В одном потоке</span><span class="sxs-lookup"><span data-stu-id="4e3ca-140">Single-threaded</span></span>  <br/> |<span data-ttu-id="4e3ca-141">Ничего.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-141">No problem.</span></span> <span data-ttu-id="4e3ca-142">Простоя функции выполняются на основной поток вашего клиента и сериализованным через цикл обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-142">Idle functions execute on your client's main thread and are serialized through the message loop.</span></span>  <br/> |
|<span data-ttu-id="4e3ca-143">Свободных потоков</span><span class="sxs-lookup"><span data-stu-id="4e3ca-143">Free-threaded</span></span>  <br/> |<span data-ttu-id="4e3ca-144">Простоя функции должны быть потокобезопасными, но клиент уже имеет необходимую инфраструктуру.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-144">Idle functions must be thread-safe, but your client already has the necessary infrastructure.</span></span> <span data-ttu-id="4e3ca-145">Клиент вообще не требуются простоя подсистемы MAPI.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-145">Your client might not need the MAPI idle engine at all.</span></span>  <br/> |
|<span data-ttu-id="4e3ca-146">COM объектов</span><span class="sxs-lookup"><span data-stu-id="4e3ca-146">Apartment-threaded</span></span>  <br/> |<span data-ttu-id="4e3ca-147">Функция простоя имеет для выполнения в том же потоке, зарегистрировали его, если необходимо использовать MAPI, OLE или COM-интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-147">Idle function has to execute on the same thread that registered it if it wants to use MAPI, OLE, or any other COM interfaces.</span></span> <span data-ttu-id="4e3ca-148">— Это самый простой способ для регистрации простоя функции MAPI, который публикует сообщение в правом поток и отправки функцию «настоящий» idle непосредственно из цикла обработки сообщений этого потока.</span><span class="sxs-lookup"><span data-stu-id="4e3ca-148">The most straightforward way is to register an idle function with MAPI that posts a message to the right thread and dispatch the "real" idle function directly from that thread's message loop.</span></span>  <br/> |
   

