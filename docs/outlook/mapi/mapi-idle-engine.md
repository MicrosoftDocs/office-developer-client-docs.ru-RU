---
title: Модуль безДействия MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 755d096a-2a61-44d2-a765-5d464a857756
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d8d591c02bb621c16a1d1b46272b19573ea79785
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428454"
---
# <a name="mapi-idle-engine"></a>Модуль безДействия MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
MAPI предоставляет несколько функций, которые в совокупности называются ядром простоя. Эти функции позволяют клиентам, поставщикам адресных книг и поставщикам хранилищ сообщений выполнять различные задачи в течение немедленного времени в сеансе или в течение медленного времени. Например, клиенты и поставщики услуг могут откладывать медленные операции или закрывать файлы, которые оставались неиспользованными в течение длительного периода. Как правило, поставщики транспорта не используют антивирусную подсистему, так как используется метод **иксплогон:: Idle** . Дополнительные сведения см. в статье [иксплогон:: Idle](ixplogon-idle.md).
  
Чтобы использовать антивирусную подсистему, клиенты и поставщики услуг создают функцию обратного вызова, которая содержит задачи, выполняемые при неактивной подсистеме MAPI. Когда MAPI обнаруживает время простоя, он вызывает эту функцию обратного вызова. Функция обратного вызова соответствует прототипу **фнидле** , определенному следующим образом: 
  
 `BOOL (STDAPICALLTYPE FNIDLE) (LPVOID lpvContext)`
  
Дополнительные сведения см. в разделе [фнидле](fnidle.md).
  
Функции, составляющие антивирусную подсистему:
  
[ChangeIdleRoutine](changeidleroutine.md)
  
[DeregisterIdleRoutine](deregisteridleroutine.md)
  
[EnableIdleRoutine](enableidleroutine.md)
  
[FtgRegisterIdleRoutine](ftgregisteridleroutine.md)
  
[MAPIDeInitIdle](mapideinitidle.md)
  
[MAPIInitIdle](mapiinitidle.md)
  
Чтобы зарегистрировать функцию обратного вызова, клиенты и поставщики услуг вызывают функцию **фтгрегистеридлераутине** . Входные параметры включают необязательный приоритет, блок памяти, который передается в функцию обратного вызова в качестве входных данных, количество времени, которое необходимо использовать, а также набор флагов. 
  
Клиенты и поставщики услуг могут указать приоритет в параметре _приидле_ , который управляет тем, как запускается функция idle, или указывает ноль, если приоритет не является ошибкой. Так как отрицательные числа представляют более высокие приоритеты, чем положительные числа или ноль, операции сжатия и поиска должны быть назначены отрицательные числа. Для задач, которые выполняются один раз, необходимо назначить положительные числа. 
  
Чтобы отменить регистрацию активной функции обратного вызова, клиенты и поставщики услуг вызывают функцию **дерегистеридлераутине** . Так как **дерегистеридлераутине** работает асинхронно, функцию обратного вызова можно вызвать в любой момент во время вызова метода Unregister и, возможно, даже после возвращения **дерегистеридлераутине** . 
  
Чтобы изменить некоторые или все характеристики функции обратного вызова, клиенты и поставщики услуг вызывают функцию **чанжеидлераутине** . **Чанжеидлераутине** вносит изменения в зависимости от того, как задан параметр flags _ирЦидле_ ; **Чанжеидлераутине** может изменять саму функцию, ее приоритет, параметры времени и входные параметры. 
  
MAPI определяет бездействие так же, как и операционная система, когда операционная система имеет определение. В Win32 MAPI создает поток с приоритетом неактивного класса для планирования задач бездействия. Этот поток отслеживает время и отправляет сообщение в поток, который выполняет задачу Idle при наступлении времени выполнения. Win32 планирует потоки, а не процессы. Если на рабочей станции возникают задачи с приоритетом выше приоритета простоя, задача периода бездействия не должна запланировать выполнение до завершения задач. 
  
Все задачи периода бездействия выполняются в потоке, который вызвал **мапиинитидле**. В MAPI есть отдельный поток для планирования, но если задача "бездействие" становится доступной, она отправляет сообщение обратно в поток инициализации, и в нем выполняется задача Idle. Ниже приведены возможные последствия для различных типов клиентов.
  
|**Потоковая модель**|**Косвенно**|
|:-----|:-----|
|С одним потоком  <br/> |Никаких проблем! Функции Idle выполняются в основном потоке клиента и сериализуются через цикл обработки сообщений.  <br/> |
|Свободно — потоки  <br/> |Функции Idle должны быть потокобезопасными, но у клиента уже есть необходимая инфраструктура. Клиенту может не потребоваться антивирусное ядро MAPI.  <br/> |
|Апартамент — потоковый  <br/> |Функция idle должна выполняться в том же потоке, который регистрировал его, если он желает использовать MAPI, OLE или любые другие интерфейсы COM. Самым простым способом является регистрация функции Idle с MAPI, которая отправляет сообщение в нужный поток и отправляет функцию "Real" Idle непосредственно из цикла обработки сообщений этого потока.  <br/> |
   

