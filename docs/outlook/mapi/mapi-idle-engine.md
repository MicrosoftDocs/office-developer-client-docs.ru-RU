---
title: Простой двигатель MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 755d096a-2a61-44d2-a765-5d464a857756
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d8d591c02bb621c16a1d1b46272b19573ea79785
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428454"
---
# <a name="mapi-idle-engine"></a>Простой двигатель MAPI

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
MAPI предоставляет несколько функций, которые в совокупности называются простаивающим двигателем. Эти функции позволяют клиентам, поставщикам адресных книг и поставщикам хранения сообщений выполнять различные задачи во время медленного сеанса или в ответ на медленное время. Например, клиенты и поставщики услуг могут откладывать медленные операции или закрывать файлы, которые длительное время оставались неиспользоваными. Поставщики транспорта обычно не используют простой двигатель, так как на его месте используется метод **IXPLogon::Idle.** Дополнительные сведения см. в [ссылке IXPLogon::Idle.](ixplogon-idle.md)
  
Чтобы использовать простой двигатель, клиенты и поставщики услуг создают функцию вызова, которая содержит задачи, которые должны возникать при простое подсистемы MAPI. Когда MAPI обнаруживает время простоя, он вызывает эту функцию вызова. Функция вызова следует **прототипу FNIDLE,** который определяется следующим образом: 
  
 `BOOL (STDAPICALLTYPE FNIDLE) (LPVOID lpvContext)`
  
Дополнительные сведения см. в [fNIDLE.](fnidle.md)
  
Функции, которые составляют простой двигатель:
  
[ChangeIdleRoutine](changeidleroutine.md)
  
[DeregisterIdleRoutine](deregisteridleroutine.md)
  
[EnableIdleRoutine](enableidleroutine.md)
  
[FtgRegisterIdleRoutine](ftgregisteridleroutine.md)
  
[MAPIDeInitIdle](mapideinitidle.md)
  
[MAPIInitIdle](mapiinitidle.md)
  
Чтобы зарегистрировать функцию вызова, клиенты и поставщики услуг звонят в **функцию FtgRegisterIdleRoutine.** Параметры ввода включают необязательный приоритет, блок памяти, который передается в функцию вызова в качестве ввода, количество времени, которое необходимо использовать в любом случае, и набор флагов опций. 
  
Клиенты и поставщики услуг могут указать приоритет в параметре  _priIdle,_ который контролирует, как выполняется простая функция, или указать ноль, если приоритет не является проблемой. Так как отрицательные числа представляют более высокие приоритеты, чем положительные цифры или ноль, операции сжатия и поиска должны быть назначены отрицательные номера. Задачи, которые возникают один раз, должны быть назначены положительные номера. 
  
Чтобы отозвать активную функцию вызова, клиенты и поставщики услуг вызывали **функцию DeregisterIdleRoutine.** Так как **deregisterIdleRoutine** работает асинхронно, функция обратного вызова может вызываться в любое время во время вызова дерегистрации и, возможно, даже после возврата **DeregisterIdleRoutine.** 
  
Чтобы изменить некоторые или все характеристики функции вызова, клиенты и поставщики услуг называют **функцию ChangeIdleRoutine.** **ChangeIdleRoutine** вносит изменения в зависимости от того, как задан параметр  _ircIdle_ флагов; **ChangeIdleRoutine может** изменить функцию, ее приоритет, параметр времени и параметр ввода. 
  
MAPI определяет простое так же, как операционная система, когда у операционной системы есть определение. В Win32 MAPI создает поток с приоритетом праздного класса для расписания недействуя задач. Этот поток отслеживает время и публикует сообщение в поток, который должен выполнять простаиваю задачу, когда придет время для ее выполнения. Win32 запланирует потоки, а не процессы. Если задачи с приоритетом выше, чем праздный, происходят на рабочей станции, простаивающие задачи не должны выполняться до завершения задач. 
  
Все простаивающим задачам выполняться в потоке, который называется **MAPIInitIdle**. MAPI имеет отдельный поток для планирования, но когда простая задача становится доступной, она возвращает сообщение обратно в поток инициализации, и простая задача выполняется там. Последствия для разных типов клиентов являются следующими.
  
|**Модель threading**|**Implication**|
|:-----|:-----|
|Однопотокая  <br/> |Это не проблема. Функции idle выполняются в основном потоке клиента и сериализируются в цикле сообщений.  <br/> |
|Free-threaded  <br/> |Функции idle должны быть безопасными для потока, но у клиента уже есть необходимая инфраструктура. Возможно, вашему клиенту вообще не понадобится простой двигатель MAPI.  <br/> |
|Квартира с резьбой  <br/> |Функция Idle должна выполняться на том же потоке, который зарегистрировал ее, если она хочет использовать MAPI, OLE или любые другие интерфейсы COM. Самый простой способ — зарегистрировать праздную функцию MAPI, которая отправляет сообщение в нужный поток и отправляет "реальную" функцию простоя непосредственно из цикла сообщений этого потока.  <br/> |
   

