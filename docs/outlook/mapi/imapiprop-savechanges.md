---
title: IMAPIPropSaveChanges
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIProp.SaveChanges
api_type:
- COM
ms.assetid: 864dbc3e-2039-435a-a279-385d79d1d13f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 2c8244180a5cafedc887fa72f36f233fb5084f79
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32316634"
---
# <a name="imapipropsavechanges"></a>IMAPIProp::SaveChanges

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Вносит постоянные изменения, внесенные в объект с момента последней операции сохранения. 
  
```cpp
HRESULT SaveChanges(
  ULONG ulFlags
);
```

## <a name="parameters"></a>Параметры

 _ulFlags_
  
> [in] Битоваяmas флагов, которая управляет тем, что происходит с объектом при методе **IMAPIProp::SaveChanges.** Можно установить следующие флаги: 
    
NON_EMS_XP_SAVE
  
> Указывает, что сообщение не было доставлено из Microsoft Exchange Server. Этот флаг следует использовать в сочетании с методом [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) и флагом ITEMPROC_FORCE, чтобы указать PST- хранилище, что сообщение имеет право на обработку правил, прежде чем хранилище файлов личных папок (PST) извещение любого клиента прослушивания о том, что сообщение поступило. Эти правила применяются только к новым сообщениям, созданным с помощью [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) на сервере, который не является Exchange Server, в этом случае Exchange Server уже обработал бы правила для сообщения. 
    
FORCE_SAVE 
  
> Изменения следует вносить в объект, переопределяя предыдущие изменения, внесенные в объект, и объект должен быть закрыт. Чтобы операция была успешной, необходимо установить разрешение на чтение и записи. Флаг FORCE_SAVE используется после предыдущего вызова **SaveChanges,** возвращенного MAPI_E_OBJECT_CHANGED. 
    
KEEP_OPEN_READONLY 
  
> Изменения должны быть зафиксированы, а объект должен быть открыт для чтения. Дополнительные изменения не вносяся. 
    
KEEP_OPEN_READWRITE 
  
> Изменения должны быть зафиксированы, а объект должен быть открыт для разрешения на чтение и записи. Этот флаг обычно устанавливается, когда объект был впервые открыт для разрешения на чтение и записи. Последующие изменения объекта разрешены. 
    
MAPI_DEFERRED_ERRORS 
  
> Позволяет **saveChanges** успешно возвращаться, возможно, до полного охранения изменений. 
    
SPAMFILTER_ONSAVE
  
> Включает фильтрацию нежелательной почты для сохраненного сообщения. Поддержка фильтрации нежелательной почты доступна только в том случае, если тип адреса электронной почты отправителя соответствует протоколу SMTP, а сообщение сохранено в хранилище для файлов личных папок (PST).
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Успешное выполнение изменений.
    
MAPI_E_NO_ACCESS 
  
> **SaveChanges** не может оставить объект открытым для разрешения только для чтения, если KEEP_OPEN_READONLY или разрешение на чтение и записи, если KEEP_OPEN_READWRITE установлен. Изменения не вносяся. 
    
MAPI_E_OBJECT_CHANGED 
  
> Объект изменился с момента открытия.
    
MAPI_E_OBJECT_DELETED 
  
> Объект был удален с момента его открытия.
    
## <a name="remarks"></a>Примечания

Метод **IMAPIProp::SaveChanges** делает изменения свойств постоянными для объектов, которые поддерживают модель транзакций обработки, таких как сообщения, вложения, контейнеры адресной книги и объекты пользователей обмена сообщениями. Объекты, которые не поддерживают транзакции, такие как папки, хранилища сообщений и разделы профилей, немедленно внося изменения. Вызов **SaveChanges** не требуется. 
  
Так как поставщики служб не должны создавать идентификатор записи для своих объектов, пока не будут сохранены все свойства, свойство **PR_ENTRYID** объекта [(PidTagEntryId)](pidtagentryid-canonical-property.md)может быть доступно только после того, как будет вызван метод **SaveChanges.** Некоторые поставщики ждут, пока KEEP_OPEN_READONLY флага для вызова **SaveChanges.** KEEP_OPEN_READONLY указывает, что изменения, которые будут сохранены в текущем вызове, будут последними изменениями, которые будут внесены в объект. 
  
В некоторых реализациях реализации в хранилище сообщений новые сообщения не будут отображены в папке, пока клиент не сохранит изменения сообщений с помощью **SaveChanges** и не освободит объекты сообщений с помощью метода [IUnknown::Release.](https://msdn.microsoft.com/library/ms682317%28v=VS.85%29.aspx) Кроме того, некоторые реализации объектов не могут создавать свойство **PR_ENTRYID** для созданного объекта до тех пор, пока не будет вызван **метод SaveChanges,** а другие могут сделать это только после того, как метод **SaveChanges** будет вызван с помощью KEEP_OPEN_READONLY, задав его в _ulFlags._
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Если вы получили KEEP_OPEN_READONLY, вы можете оставить доступ к объекту как для чтения и записи. Однако поставщик никогда не может оставлять объект в состоянии "только чтение" при KEEP_OPEN_READWRITE флага.
  
Когда клиент сохраняет несколько вложений в нескольких сообщениях, он вызывает метод **SaveChanges** для каждого вложения и каждого сообщения. Часто клиенты MAPI_DEFERRED_ERRORS для каждого из этих вызовов, кроме последнего. Вы можете возвращать ошибки при последнем или более ранних вызовах. Вы даже можете игнорировать флаг. 
  
Если KEEP_OPEN_READWRITE или KEEP_OPEN_READONLY вместе с MAPI_DEFERRED_ERRORS, запрос на отсрочку ошибки можно игнорировать. Если MAPI_DEFERRED_ERRORS в  _ulFlags_ не установлен, для вызова **SaveChanges** может быть возвращена одна из ранее отложенных ошибок. 
  
Является ли удаленный поставщик транспорта функциональной реализацией этого метода, является необязательным и зависит от других вариантов проектирования в реализации. Если вы реализуете этот метод, сделайте это в соответствии с документацией здесь. Поскольку объекты папок и объекты состояния не работают, реализация **SaveChanges** удаленным поставщиком транспорта должна возвращать как минимум S_OK без выполнения каких-либо работ. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Если клиент передает KEEP_OPEN_READONLY, вызывает метод [IMAPIProp::SetProps,](imapiprop-setprops.md) а затем снова вызывает **SaveChanges,** такая же реализация может привести к сбойу. 
  
После получения MAPI_E_NO_ACCESS вызова, в котором вы KEEP_OPEN_READWRITE, у вас по-прежнему будет разрешение на чтение и записи объекта. Можно вызвать **SaveChanges** еще раз, передав флаг KEEP_OPEN_READONLY или без флагов с KEEP_OPEN_SUFFIX. 
  
То, поддерживает ли поставщик флаг KEEP_OPEN_READWRITE, зависит от реализации поставщика. 
  
Чтобы указать, что единственный вызов, который будет выполнен для объекта после **SaveChanges—** **IUnknown::Release,** установите флаги для параметра _ulFlags._ Ошибка **saveChanges** указывает, что не удалось сделать ожидающих изменений постоянными. Разные поставщики по-разному обрабатывают отсутствие флагов в вызове **SaveChanges.** Некоторые поставщики обрабатывают это состояние так же, как KEEP_OPEN_READONLY; другие поставщики интерпретируют его так же, как KEEP_OPEN_READWRITE. По-прежнему другие поставщики отключают объект, если не получают флаги при вызове **SaveChanges.** 
  
Некоторые свойства, как правило, вычисляемых свойств, не могут быть обработаны до вызова **SaveChanges** и, в некоторых случаях, **Release**.
  
При внесении массовых изменений, таких как сохранение вложений в несколько сообщений, откладывает обработку ошибок, устанавливая флаг MAPI_DEFERRED_ERRORS в _ulFlags._ Если вы сохраняете несколько вложений в нескольких сообщениях, сделайте один вызов **SaveChanges** для каждого вложения и один вызов **SaveChanges** для каждого сообщения. Установите флаг MAPI_DEFERRED_ERRORS для каждого вызова вложения и для всех сообщений, кроме последнего. 
  
Если **SaveChanges** возвращает MAPI_E_OBJECT_CHANGED, проверьте, был ли изменен исходный объект. В этом случае предупредите пользователя, который может запросить переоценку предыдущих изменений или сохранить объект в другом месте. Если исходный объект был удален, предупредить пользователя, чтобы он получил возможность сохранить объект в другом расположении. 
  
Нельзя вызвать **SaveChanges** с флагом FORCE_SAVE открытого объекта, который был удален. 
  
Если **SaveChanges** возвращает ошибку, объект, изменения которого нужно сохранить, остается открытым независимо от флагов, установленных в параметре _ulFlags._ 
  
> [!IMPORTANT]
> Файлы  _ulFlags_ NON_EMS_XP_SAVE и SPAMFILTER_ONSAVE могут не быть определены в загружаемом файле заголовок, который у вас есть в настоящее время. В этом случае вы можете добавить его в код, используя следующие значения: >  `#define SPAMFILTER_ONSAVE ((ULONG) 0x00000080)`>  `#define NON_EMS_XP_SAVE ((ULONG) 0x00001000)`
  
Дополнительные сведения [см. в поддоме "Сохранение свойств MAPI".](saving-mapi-properties.md)
  
## <a name="see-also"></a>См. также



[IMAPIProp::SetProps](imapiprop-setprops.md)
  
[Каноническое свойство PidTagEntryId](pidtagentryid-canonical-property.md)
  
[IMAPIProp : IUnknown](imapipropiunknown.md)


[Сохранение свойств MAPI](saving-mapi-properties.md)

