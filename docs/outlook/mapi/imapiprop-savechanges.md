---
title: IMAPIPropSaveChanges
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIProp.SaveChanges
api_type:
- COM
ms.assetid: 864dbc3e-2039-435a-a279-385d79d1d13f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 2c8244180a5cafedc887fa72f36f233fb5084f79
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32316634"
---
# <a name="imapipropsavechanges"></a>IMAPIProp::SaveChanges

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Вносит постоянные изменения, внесенные в объект с момента последней операции сохранения. 
  
```cpp
HRESULT SaveChanges(
  ULONG ulFlags
);
```

## <a name="parameters"></a>Parameters

 _ulFlags_
  
> [in] Битмаски флагов, которые контролируют, что происходит с объектом, когда **называется метод IMAPIProp::SaveChanges.** Можно установить следующие флаги: 
    
NON_EMS_XP_SAVE
  
> Указывает, что сообщение не было доставлено из Microsoft Exchange Server. Этот флаг следует использовать в сочетании с методом [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) и флагом ITEMPROC_FORCE, чтобы указать в магазине PST, что сообщение имеет право на обработку правил до того, как хранилище личных папок (PST) сообщает любому прослушиваемому клиенту о том, что сообщение пришло. Обработка этих правил применяется только к новым сообщениям, созданным с [помощью IMAPIFolder::CreateMessage](imapifolder-createmessage.md) на сервере, который не является Exchange Server, в этом случае Exchange Server уже обработаны правила сообщения. 
    
FORCE_SAVE 
  
> Изменения должны быть записаны в объект, переопределив все предыдущие изменения, внесенные в объект, и объект должен быть закрыт. Для успешной операции необходимо задать разрешение на чтение и записи. Флаг FORCE_SAVE используется после предыдущего вызова **в SaveChanges,** возвращенного MAPI_E_OBJECT_CHANGED. 
    
KEEP_OPEN_READONLY 
  
> Необходимо внести изменения, а объект должен быть открыт для чтения. Дополнительные изменения не будут внесены. 
    
KEEP_OPEN_READWRITE 
  
> Необходимо внести изменения, а объект должен быть открыт для разрешения на чтение и написание. Этот флаг обычно устанавливается, когда объект был впервые открыт для разрешения на чтение и написание. Допускаются последующие изменения объекта. 
    
MAPI_DEFERRED_ERRORS 
  
> Позволяет **saveChanges** успешно возвращаться, возможно, до полного совершения изменений. 
    
SPAMFILTER_ONSAVE
  
> Включает фильтрацию нежелательной почты на сохраненное сообщение. Поддержка фильтрации нежелательной почты доступна только в том случае, если тип адреса электронной почты отправителя соответствует протоколу SMTP, а сообщение сохранено в хранилище для файлов личных папок (PST).
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Выполнение изменений было успешным.
    
MAPI_E_NO_ACCESS 
  
> **SaveChanges** не может сохранить объект открытым для разрешения только для чтения, если KEEP_OPEN_READONLY установлено, или разрешения на чтение и записи, если KEEP_OPEN_READWRITE задарен. Изменения не внося. 
    
MAPI_E_OBJECT_CHANGED 
  
> Объект изменился с момента его открытия.
    
MAPI_E_OBJECT_DELETED 
  
> Объект был удален с момента его открытия.
    
## <a name="remarks"></a>Примечания

Метод **IMAPIProp::SaveChanges** делает изменения свойств постоянными для объектов, поддерживаюющих модель обработки транзакций, таких как сообщения, вложения, контейнеры адресных книг и объекты пользователей обмена сообщениями. Объекты, которые не поддерживают транзакции, такие как папки, хранилища сообщений и разделы профилей, немедленно внося изменения. Вызов в **SaveChanges** не требуется. 
  
Так как поставщики служб не должны создавать идентификатор входа для своих объектов до тех пор, пока не будут сохранены все свойства, свойство **PR_ENTRYID** [(PidTagEntryId)](pidtagentryid-canonical-property.md)может быть доступно только после того, как будет вызван метод **SaveChanges.** Некоторые поставщики ждут, пока флаг KEEP_OPEN_READONLY на **вызове SaveChanges.** KEEP_OPEN_READONLY указывает, что изменения, которые будут сохранены в текущем вызове, будут последними изменениями, которые будут внесены на объекте. 
  
Некоторые реализации магазина сообщений не показывают вновь созданные сообщения в папке, пока клиент не сохранит изменения сообщений с помощью **SaveChanges** и не выпустит объекты сообщений с помощью метода [IUnknown::Release.](https://msdn.microsoft.com/library/ms682317%28v=VS.85%29.aspx) Кроме того, некоторые объектные **реализации** не могут создавать свойство PR_ENTRYID для вновь созданного объекта до тех пор, пока не будут вызваны **SaveChanges,** а некоторые могут сделать это только после того, как **saveChanges** был вызван с помощью KEEP_OPEN_READONLY, задатого в  _ulFlags_.
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Если вы получаете флаг KEEP_OPEN_READONLY, у вас есть возможность оставить доступ объекта в качестве чтения или записи. Однако поставщик никогда не может оставить объект в состоянии только для чтения при KEEP_OPEN_READWRITE флага.
  
Когда клиент сохраняет несколько вложений для нескольких сообщений, он вызывает метод **SaveChanges** для каждого вложения и каждого сообщения. Часто клиенты MAPI_DEFERRED_ERRORS для каждого из этих вызовов, за исключением последнего. Ошибки можно возвращать с помощью последнего звонка или более ранних вызовов. Вы даже можете игнорировать флаг. 
  
Если KEEP_OPEN_READWRITE или KEEP_OPEN_READONLY установлен вместе с MAPI_DEFERRED_ERRORS, можно игнорировать запрос на отсрочку ошибки. Если MAPI_DEFERRED_ERRORS в _ulFlags_ не установлено, одна из ранее отложенных ошибок может быть возвращена для вызова **SaveChanges.** 
  
Предоставляет ли удаленный поставщик транспорта функциональную реализацию этого метода необязательным и зависит от других вариантов проектирования в реализации. Если вы реализуете этот метод, сделайте это в соответствии с документацией здесь. Так как объекты папок и объекты состояния не трансактироваться, как минимум, реализация **saveChanges** удаленного поставщика транспорта должна возвращаться S_OK без выполнения каких-либо работ. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Если клиент проходит KEEP_OPEN_READONLY, вызывает [метод IMAPIProp::SetProps](imapiprop-setprops.md) и снова вызывает **SaveChanges,** такая же реализация может привести к сбой. 
  
После получения MAPI_E_NO_ACCESS звонка, в котором KEEP_OPEN_READWRITE, вы будете продолжать получать разрешение на чтение и записи объекта. Вы можете вызвать **SaveChanges** снова, передав флаг KEEP_OPEN_READONLY или без флагов с KEEP_OPEN_SUFFIX. 
  
Поддерживает ли поставщик флаг KEEP_OPEN_READWRITE зависит от реализации поставщика. 
  
Чтобы указать, что единственный вызов, который будет выполнен на объекте после **SaveChanges,** это **IUnknown::Release,** не установите флаги для _параметра ulFlags._ Ошибка, **допущенная в SaveChanges,** указывает на то, что она не может сделать ожидающих изменений постоянными. Различные поставщики по-разному обрабатывают отсутствие флагов в **вызове SaveChanges.** Некоторые поставщики обрабатывают это состояние так же, как KEEP_OPEN_READONLY; другие поставщики интерпретируют его так же, как KEEP_OPEN_READWRITE. Однако другие поставщики закрывают объект, если они не получают флаги при вызове **SaveChanges.** 
  
Некоторые свойства, как правило, вычисляемых свойств, не могут быть обработаны до вызова **SaveChanges** и, в некоторых случаях, **выпуска**.
  
При внесении массовых изменений, например сохранения вложений в несколько сообщений, откладывать обработку ошибок, установив флаг MAPI_DEFERRED_ERRORS  _в ulFlags_. Если вы сохраните несколько вложений для нескольких сообщений, сделайте один вызов **SaveChanges** для каждого вложения и один **вызов SaveChanges** для каждого сообщения. Установите флаг MAPI_DEFERRED_ERRORS для каждого вызова вложения и для всех сообщений, за исключением последнего. 
  
Если **SaveChanges** возвращает MAPI_E_OBJECT_CHANGED, проверьте, был ли изменен исходный объект. Если да, предупредите пользователя, который может запросить переоценку предыдущих изменений или сохранить объект в другом месте. Если исходный объект удален, предупредить пользователя предоставить ему возможность сохранить объект в другом расположении. 
  
Нельзя вызывать **SaveChanges** с FORCE_SAVE флагом на открытом объекте, который был удален. 
  
Если **SaveChanges** возвращает ошибку, объект, изменения которого должны были быть сохранены, остается открытым независимо от флагов, заданных в параметре _ulFlags._ 
  
> [!IMPORTANT]
> _UlFlags_ NON_EMS_XP_SAVE и SPAMFILTER_ONSAVE не могут быть определены в загружаемом файле заголовки, который у вас есть в настоящее время, и в этом случае вы можете добавить его в код с помощью следующих значений: >`#define SPAMFILTER_ONSAVE ((ULONG) 0x00000080)`>  `#define NON_EMS_XP_SAVE ((ULONG) 0x00001000)`
  
Дополнительные сведения см. в [дополнительных сведениях о сохранении свойств MAPI.](saving-mapi-properties.md)
  
## <a name="see-also"></a>См. также



[IMAPIProp::SetProps](imapiprop-setprops.md)
  
[Каноническое свойство PidTagEntryId](pidtagentryid-canonical-property.md)
  
[IMAPIProp : IUnknown](imapipropiunknown.md)


[Сохранение свойств MAPI](saving-mapi-properties.md)

