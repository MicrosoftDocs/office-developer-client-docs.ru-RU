---
title: IMAPIPropSaveChanges
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIProp.SaveChanges
api_type:
- COM
ms.assetid: 864dbc3e-2039-435a-a279-385d79d1d13f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 2c8244180a5cafedc887fa72f36f233fb5084f79
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25398845"
---
# <a name="imapipropsavechanges"></a>IMAPIProp::SaveChanges

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Выполняет постоянное все изменения, внесенные в объект с момента последней операции сохранения. 
  
```cpp
HRESULT SaveChanges(
  ULONG ulFlags
);
```

## <a name="parameters"></a>���������

 _ulFlags_
  
> [in] Битовая маска флаги, который определяет, что происходит при вызове метода **IMAPIProp::SaveChanges** объекта. Можно задать следующие флажки: 
    
NON_EMS_XP_SAVE
  
> Указывает, что сообщение не было доставлено из Microsoft Exchange Server. Этот флаг следует использовать в сочетании с методом [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) и ITEMPROC_FORCE флаг, указывающий хранилище PST-файлов, который сообщение подходит для правила обработки перед любой уведомляет хранилище файлов (PST) личных папок прослушивающий клиент поступления сообщения. Правила на сообщение будет уже обработаны этот правила обработки применяется только к новые сообщения, созданные с помощью [IMAPIFolder::CreateMessage](imapifolder-createmessage.md) на сервере, который не является сервером Exchange Server, в этом случае на сервере Exchange. 
    
FORCE_SAVE 
  
> Изменения будут записаны в объект, переопределение любые предыдущие изменения, внесенные в объект, и объект должен быть закрыт. Разрешение на чтение/запись необходимо установить для успешного выполнения операции. Флаг FORCE_SAVE используется после предыдущего вызова **SaveChanges** возвращается MAPI_E_OBJECT_CHANGED. 
    
KEEP_OPEN_READONLY 
  
> Изменения должны быть зафиксированы и объекта должно быть открытым для чтения. Не дополнительные будут изменены. 
    
KEEP_OPEN_READWRITE 
  
> Изменения должны быть зафиксированы и объекта должно быть открытым для разрешения на чтение и запись. Этот флаг обычно задается после первого открытия объекта для разрешения на чтение и запись. Последующие изменения объекта разрешены. 
    
MAPI_DEFERRED_ERRORS 
  
> Разрешает **SaveChanges** для возврата успешно, возможно до полностью применить изменения. 
    
SPAMFILTER_ONSAVE
  
> Включение защиты от нежелательной почты фильтрации на сообщение, которое сохраняется. Поддержка фильтрации нежелательной почты доступна только в том случае, если тип адреса электронной почты отправителя соответствует протоколу SMTP, а сообщение сохранено в хранилище для файлов личных папок (PST).
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Стремление изменения успешно завершена.
    
MAPI_E_NO_ACCESS 
  
> **SaveChanges** невозможно сохранить объект open для разрешения доступа только для чтения если KEEP_OPEN_READONLY set или разрешение на чтение/запись, если значение KEEP_OPEN_READWRITE. Изменения не фиксируются. 
    
MAPI_E_OBJECT_CHANGED 
  
> Объект изменился с момента его открытия.
    
MAPI_E_OBJECT_DELETED 
  
> Объект был удален, поскольку он был открыт.
    
## <a name="remarks"></a>Примечания

Метод **IMAPIProp::SaveChanges** вносятся изменения свойства было постоянным для объектов, которые поддерживают модели транзакций обработки, такие как сообщения, вложения, контейнеров адресной книги, и системы обмена сообщениями объектов-пользователей. Объекты, которые не поддерживают транзакции, как папки, хранилищ сообщений и разделах профилей, внесите изменения постоянное немедленно. Вызов **SaveChanges** не требуется. 
  
Так как поставщиков услуг не нужно создать запись идентификатора для объектов, пока не были сохранены все свойства, свойство **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) могут быть недоступны до после его метод **SaveChanges** был вызван. Некоторые поставщики Подождите, пока флаг KEEP_OPEN_READONLY установлен на вызов **SaveChanges** . KEEP_OPEN_READONLY означает, что изменения будут сохраняться в текущий звонок будет последних изменений, внесенных в объекте. 
  
Некоторые реализации хранилища сообщений выполнение не показывать вновь созданный сообщений в папке до клиента сохранения сообщение изменяется с помощью **SaveChanges** и освобождает объекты сообщений с помощью метода [функции IUnknown::Release](https://msdn.microsoft.com/library/ms682317%28v=VS.85%29.aspx) . Кроме того некоторые реализации объекта не удается создать свойство **PR_ENTRYID** для только что созданный объект до того времени, после того как был вызван метод **SaveChanges** , и некоторые делать это только после **SaveChanges** вызова с помощью KEEP_OPEN_READONLY Задайте в _ulFlags_.
  
## <a name="notes-to-implementers"></a>Примечания для реализующих

Если вы получите флаг KEEP_OPEN_READONLY, вы можете отправляемых из объекта доступ для чтения и записи. Тем не менее поставщик может не оставляйте объекта в состояние только для чтения при передаче флага KEEP_OPEN_READWRITE.
  
Когда клиент сохраняет несколько вложений для нескольких сообщений, он вызывает метод **SaveChanges** для каждого вложения и каждого сообщения. Клиенты часто устанавливающей MAPI_DEFERRED_ERRORS для каждого из них, за исключением последним. Ошибки с последнего вызова или более ранних звонки можно вернуть. Можно даже игнорировать флаг. 
  
Если вместе с MAPI_DEFERRED_ERRORS KEEP_OPEN_READWRITE или KEEP_OPEN_READONLY, можно пропустить ошибка отсрочке запроса. Если MAPI_DEFERRED_ERRORS не установлен в _ulFlags_, один из ранее отложенная ошибки могут быть возвращены для этого вызова **SaveChanges** . 
  
Обеспечивает ли поставщик удаленного транспорта функциональным реализация этого метода является необязательной и зависит от других варианты проектирования в реализации. Если этот метод реализации, сделайте согласно документации по. Так как папки и объекты состояния не выполняются, по крайней мере реализации поставщика транспорта удаленного **SaveChanges** должен возвращать значение S_OK без фактического выполнения действий. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Если клиент проходит KEEP_OPEN_READONLY, вызывает метод [IMAPIProp::SetProps](imapiprop-setprops.md) и затем вызывает метод **SaveChanges** , ту же реализацию может завершиться ошибкой. 
  
После получения MAPI_E_NO_ACCESS от звонка в которых KEEP_OPEN_READWRITE, будут иметь разрешение на чтение и запись к объекту. Можно вызвать **SaveChanges** еще раз, передав флаг KEEP_OPEN_READONLY или флаги не со KEEP_OPEN_SUFFIX. 
  
Поддерживает ли поставщик флаг KEEP_OPEN_READWRITE зависит от реализации поставщика. 
  
Чтобы указать только вызова следует обратить внимание на объекте после **SaveChanges** **функции IUnknown::Release**, задайте флаги для параметра _ulFlags_ не. Ошибка из **SaveChanges** указывает на то, что его нельзя было ожидающие изменения постоянной. Различных поставщиков обработки отсутствия флаги на вызов **SaveChanges** по-разному. Некоторые поставщики обрабатывать это состояние так же, как KEEP_OPEN_READONLY; Прочие интерпретировать то же, что KEEP_OPEN_READWRITE. По-прежнему других поставщиков завершение работы объекта, когда они не получают флаги на вызов **SaveChanges** . 
  
Некоторые свойства, обычно вычисленные свойства не может обрабатываться до вызова метода **SaveChanges** и, в некоторых случаях **выпуска**.
  
При внесении массового изменения, такие как сохранение вложений на несколько сообщений отложите Ошибка обработки, установив флаг MAPI_DEFERRED_ERRORS в _ulFlags_. При сохранении нескольких вложения на несколько сообщений, внесите один **SaveChanges** звонков для каждого вложения и один **SaveChanges** звонков для каждого сообщения. Установите флаг MAPI_DEFERRED_ERRORS для каждого вызова вложения, а также для всех сообщений за исключением последним. 
  
Если **SaveChanges** возвращает MAPI_E_OBJECT_CHANGED, проверьте, были ли изменены исходного объекта. Если это так, Предупреждайте пользователя, который можно либо запросить, что изменения перезаписи предыдущей изменения или сохранить объект в другом месте. Если исходный объект был удален, Предупреждайте пользователя, который будет их возможности, чтобы сохранить объект в другом месте. 
  
Не может вызывать **SaveChanges** с флагом FORCE_SAVE open объекта, который был удален. 
  
Если **SaveChanges** возвращает ошибку, откройте объект, чьи изменения были сохранения остается с текущими настройками вне зависимости от набора с помощью параметра _ulFlags_ флагов. 
  
> [!IMPORTANT]
> _UlFlags_ NON_EMS_XP_SAVE и SPAMFILTER_ONSAVE не может быть определен в файле загружаемых заголовка в настоящий момент, в этом случае можно добавить его в код, используя следующие значения: >`#define SPAMFILTER_ONSAVE ((ULONG) 0x00000080)`>  `#define NON_EMS_XP_SAVE ((ULONG) 0x00001000)`
  
Для получения дополнительных сведений см [Сохранения свойств MAPI](saving-mapi-properties.md).
  
## <a name="see-also"></a>См. также



[IMAPIProp::SetProps](imapiprop-setprops.md)
  
[Каноническое свойство PidTagEntryId](pidtagentryid-canonical-property.md)
  
[IMAPIProp : IUnknown](imapipropiunknown.md)


[Сохранение свойств MAPI](saving-mapi-properties.md)

