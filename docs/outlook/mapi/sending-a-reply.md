---
title: Отправка ответа
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 90dafeae-6b61-40e3-8341-d6a11799d0f2
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: f47741369b1091c0dd24358e063de8f4675000fa
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33437450"
---
# <a name="sending-a-reply"></a>Отправка ответа

**Относится к**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения обычно поддерживают два типа ответов: один, который отправляется только отправителю исходного сообщения и отправляется всем остальным получателям, включенным в список получателей исходного сообщения в дополнение к отправителю. Этот второй тип ответа часто называют сообщением "ответить всем".
  
Чтобы отправить ответ любого типа, необходимо реализовать некоторые из тех же задач, что и при отправке исходного сообщения. Например, вы открываете хранилище сообщений по умолчанию и папку исходящих сообщений, как правило, в папке "Исходящие", и вызываете метод [IMAPIFolder:: CreateMessage](imapifolder-createmessage.md) для создания ответа. Кроме того, вы открываете папку, в которой находится исходное сообщение, обычно это папка "Входящие". Сведения о том, как открывать другие папки, можно найти [в разделе Открытие папки хранилища сообщений](opening-a-message-store-folder.md).
  
Основное различие между созданием ответа и созданием исходного сообщения заключается в том, что при ответе большинство свойств либо копируются, либо копируются непосредственно из свойств исходного сообщения. Вложения — свойство **PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) сообщения, в частности, исключены. Список получателей для ответного сообщения создается из списка исходного сообщения с получателем, представленным свойством **PR_RECEIVED_BY_SEARCH_KEY** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)), и все получатели скрытой копии удалены. Свойство **PR_RECEIVED_BY_SEARCH_KEY** представляет текущего пользователя. 
  
### <a name="to-send-a-reply"></a>Отправка ответа
  
1. Откройте хранилище сообщений по умолчанию. Дополнительные сведения см. [в разделе Открытие хранилища сообщений по умолчанию](opening-the-default-message-store.md).
    
2. Откройте папку "Исходящие". Дополнительную информацию можно узнать в статье [Открытие папки хранилища сообщений](opening-a-message-store-folder.md).
    
3. Вызовите метод [IMAPIFolder:: CreateMessage](imapifolder-createmessage.md) , чтобы создать ответ. 
    
4. Вызовите метод [IMAPIProp:: CopyTo](imapiprop-copyto.md) исходного сообщения, чтобы скопировать следующие свойства в ответное сообщение: 
    
   - **Основной\_текст** ([PidTagBody](pidtagbody-canonical-property.md)) или **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) в зависимости от того, поддерживается ли формат RTF.
    
   - **MESSAGE_RECIPIENTS\_PR** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)), если ответ будет отправлен всем списку получателей.
    
   - **NORMALIZED_SUBJECT\_PR** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md)).
    
5. Не включайте в вызов IMAPIProp следующие свойства: **: CopyTo**:
    
    |||
    |:-----|:-----|
    |**время\_\_отсылки\_для клиента (пр)** <br/> |**время\_доставки\_\_сообщения PR** <br/> |
    |**время\_загрузки\_\_сообщения PR** <br/> |**Флаги\_сообщений PR\_** <br/> |
    |**Репорт\рекуестед\_для\_доставки\_ инициатора (пр)** <br/> |**Свойство\_PR\_, представляющее** свойства  <br/> |
    |**Идентификатор\_EntryID\_уведомления\_о прочтении (пр)** <br/> |**запрошено\_уведомление\_о прочтении (пр)\_** <br/> |
    |**Свойства\_,\_получаемые по** свойствам  <br/> |**Свойства\_получателя\_ответа PR**  <br/> |
    |**Идентификатор\_EntryID\_отчета PR** <br/> |**Свойства\_отправителя (пр)**  <br/> |
    |Посылаемые данные, представляющие свойства **\_\_**  <br/> |**Идентификатор\_EntryID\_сентмаил (пр)** <br/> |
    |**префикс\_темы\_для PR** <br/> | <br/> |
   
6. Добавьте текст разделителя в любое поддерживаемое свойство текста сообщения: **PR_BODY**, **PR_HTM**L или **PR_RTF_COMPRESSED**.
    
7. Вызовите [сккреатеконверсатиониндекс](sccreateconversationindex.md), передав значение свойства **PR_CONVERSATION_INDEX** ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)) исходного сообщения.
    
8. Задайте префикс для ответа. Если используется стандартная "RE:", присоедините эти символы к началу **PR_NORMALIZED_SUBJECT** и присвойте **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) эту новую строку. Не задавайте **PR_SUBJECT_PREFIX** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md)). Если вы используете нестандартный префикс, например строку длиной более трех символов, сохраните ее в **PR_SUBJECT_PREFIX**. 
    
9. Задайте для свойств **PR_SENT_REPRESENTING** соответствующие значения в свойствах **PR_RCVD_REPRESENTING** . 
    
10. Задайте для каждой записи в **REPLY_RECIPIENT_ENTRIES PR\_** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) и **PR_REPLY\_RECIPIENT_NAMES** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) идентификатор записи и отображаемое имя основного получателя — получателя, чей тип является MAPI_TO. Синхронизация этих свойств. То есть, **PR_REPLY_RECIPIENT\_записи** и **PR_REPLY_RECIPIENT_NAMES** должны содержать одинаковое число записей, а запись в определенном положении в одном из свойств должна соответствовать записи в той же позиции, что и в другом свойстве. 
    
11. Если ответ отправляется только отправителю исходного сообщения, создайте список получателей одной записи с получателем, представленным свойством **PR_SENT_REPRESENTING** исходного сообщения. Дополнительные сведения о создании списка получателей приведены [в разделе Создание списка получателей](creating-a-recipient-list.md).
    
12. Если ответ является ответом все, создайте список получателей следующим образом:
    
    1. Вызовите метод [iMessage:: жетреЦипиенттабле](imessage-getrecipienttable.md) исходного сообщения, чтобы получить доступ к его таблице получателей. 
        
    2. Вызовите [хркуеряллровс](hrqueryallrows.md) , чтобы получить все строки в таблице. Определите, соответствует ли каждая строка основному получателю или получателю копии, и должен ли она отображаться в списке или в том случае, если она представляет получателя скрытой копии или пользователя и должна быть удалена из списка. 
        
    3. Различия между типами получателей засматриваются в столбце **PR_RECIPIENT_TYPE** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)). Для этого столбца будет задано значение MAPI_TO для получателей копии, MAPI_CC для получателей копии и MAPI_BCC для получателей скрытой копии. 
        
    4. Сравните столбец **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) с свойством **PR_RECEIVED_BY_SEARCH_KEY** исходного сообщения, чтобы определить, представляет ли строка пользователя. 
        
    5. Удалите ненужные строки из списка получателей, вызвав [мапифрибуффер](mapifreebuffer.md) , чтобы освободить память, связанную с соответствующими записями в структуре [SRowSet](srowset.md) таблицы получателя. Присвойте всем значениям массива значений свойства ноль, всем элементам **квалуес** — ноль и всем элементам **лппропс** в каждой структуре [СРОВ](srow.md) в **SRowSetе** значение null. 
        
    6. Добавьте отправителя в список получателей, представленный в свойствах **SENT_REPRESENTING_NAME "\_PR** " ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) и **PR_SENT_REPRESENTING_ENTRYID** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)) исходного сообщения. Убедитесь, что отправитель не дублируется в списке.
        
    7. Вызовите метод [iMessage:: модифиреЦипиентс](imessage-modifyrecipients.md) , установив для параметра _ulFlags_ нулевое значение, чтобы создать новый список получателей для ответа или переадресованного сообщения, основанного на списке из исходного сообщения. 
    
13. Вызовите метод [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) ответа для сохранения сообщения или [iMessage:: субмитмессаже](imessage-submitmessage.md) , чтобы сохранить и отправить его. 
    
> [!NOTE]
> Перед вызовом **iMessage:: модифиреЦипиентс** для хранения изменений в списке получателей можно разрешить пользователям вносить изменения с помощью формы сообщения. Пользователи могут добавлять в список или удалять определенные элементы. Предоставление пользователям разрешения на внесение изменений в список получателей является дополнительным компонентом клиента. 
  

