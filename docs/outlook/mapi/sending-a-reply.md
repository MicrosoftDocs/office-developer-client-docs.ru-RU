---
title: Отправка ответа
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 90dafeae-6b61-40e3-8341-d6a11799d0f2
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: f47741369b1091c0dd24358e063de8f4675000fa
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32339783"
---
# <a name="sending-a-reply"></a>Отправка ответа

**Область применения**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения обычно поддерживают два типа ответов: один, который отправляется только отправителю исходного сообщения и отправляется всем остальным получателям, включенным в список получателей исходного сообщения в дополнение к отправителю. Этот второй тип ответа часто называют сообщением "ответить всем".
  
Чтобы отправить ответ любого типа, необходимо реализовать некоторые из тех же задач, что и при отправке исходного сообщения. Например, вы открываете хранилище сообщений по умолчанию и папку исходящих сообщений, как правило, в папке "исХодящие", и вызываете метод [IMAPIFolder:: CreateMessage](imapifolder-createmessage.md) для создания ответа. Кроме того, вы открываете папку, в которой находится исходное сообщение, обычно это папка "Входящие". Сведения о том, как открывать другие папки, можно найти [в разделе Открытие папки хранилища сообщений](opening-a-message-store-folder.md).
  
Основное различие между созданием ответа и созданием исходного сообщения заключается в том, что при ответе большинство свойств либо копируются, либо копируются непосредственно из свойств исходного сообщения. Вложения — свойство **пр_мессаже_аттачментс** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) сообщения, в частности, исключены. Список получателей для ответного сообщения создается из списка исходного сообщения с получателем, представленным свойством **пр_рецеивед_би_сеарч_кэй** ([PidTagReceivedBySearchKey](pidtagreceivedbysearchkey-canonical-property.md)), и все получатели скрытой копии удалены. Свойство **пр_рецеивед_би_сеарч_кэй** представляет текущего пользователя. 
  
### <a name="to-send-a-reply"></a>Отправка ответа
  
1. Откройте хранилище сообщений по умолчанию. Дополнительные сведения см. [в разделе Открытие хранилища сообщений по умолчанию](opening-the-default-message-store.md).
    
2. Откройте папку "исХодящие". Дополнительную информацию можно узнать в статье [Открытие папки хранилища сообщений](opening-a-message-store-folder.md).
    
3. ВыЗовите метод [IMAPIFolder:: CreateMessage](imapifolder-createmessage.md) , чтобы создать ответ. 
    
4. ВыЗовите метод [IMAPIProp:: CopyTo](imapiprop-copyto.md) исходного сообщения, чтобы скопировать следующие свойства в ответное сообщение: 
    
   - **Основной\_текст** ([PidTagBody](pidtagbody-canonical-property.md)) или **пр_ртф_компрессед** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) в зависимости от того, поддерживает ли он формат RTF.
    
   - **PR\_мессаже_реЦипиентс** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)), если ответ будет отправлен всем списку получателей.
    
   - **PR\_нормализед_субжект** ([PidTagNormalizedSubject](pidtagnormalizedsubject-canonical-property.md)).
    
5. Не включайте в вызов IMAPIProp следующие свойства: **: CopyTo**:
    
    |||
    |:-----|:-----|
    |**Время\_\_отсылки\_для клиента (пр)** <br/> |**Время\_доставки\_\_сообщения PR** <br/> |
    |**Время\_загрузки\_\_сообщения PR** <br/> |**Флаги\_сообщений PR\_** <br/> |
    |**Репорт\рекуестед\_для\_доставки\_ инициатора (пр)** <br/> |**Свойство\_PR\_** , представляющее свойства  <br/> |
    |**Идентификатор\_EntryID\_уведомления\_о прочтении (пр)** <br/> |**Запрошено\_уведомление\_о ПРОЧТЕНии (пр)\_** <br/> |
    |**Свойства\_,\_получаемые по** свойствам  <br/> |**Свойства\_получателя\_ответа PR**  <br/> |
    |**Идентификатор\_EntryID\_отчета PR** <br/> |**Свойства\_отправителя (пр)**  <br/> |
    |Посылаемые данные, представляющие свойства **\_\_**  <br/> |**Идентификатор\_EntryID\_сентмаил (пр)** <br/> |
    |**Префикс\_темы\_для PR** <br/> | <br/> |
   
6. Добавьте разделительный текст в любое свойство текста сообщения, которое вы поддерживаете — **пр_боди**, **Пр_хтм**L или **пр_ртф_компрессед**.
    
7. ВыЗовите [сккреатеконверсатиониндекс](sccreateconversationindex.md), передав значение свойства **пр_конверсатион_индекс** исходного сообщения ([PidTagConversationIndex](pidtagconversationindex-canonical-property.md)).
    
8. Задайте префикс для ответа. Если используется стандартная "RE:", присоедините эти символы к началу **пр_нормализед_субжект** и установите **пр_субжект** ([PidTagSubject](pidtagsubject-canonical-property.md)) в эту новую строку. Не задавайте **пр_субжект_префикс** ([PidTagSubjectPrefix](pidtagsubjectprefix-canonical-property.md)). Если вы используете нестандартный префикс, например строку длиной более трех символов, сохраните ее в **пр_субжект_префикс**. 
    
9. Задайте для свойств **пр_сент_репресентинг** соответствующие значения в свойствах **пр_рквд_репресентинг** . 
    
10. Задайте для каждой записи в **PR\_репли_реЦипиент_ентриес** ([PidTagReplyRecipientEntries](pidtagreplyrecipiententries-canonical-property.md)) и **пр_репли\_реЦипиент_намес** ([PidTagReplyRecipientNames](pidtagreplyrecipientnames-canonical-property.md)) идентификатор записи и отображаемое имя основной получатель — получатель, чей тип — МАПИ_ТО. Синхронизация этих свойств. Таким образом, **записи\_пр_репли_реЦипиент** и **пр_репли_реЦипиент_намес** должны содержать одинаковое число записей, а запись в определенном положении в одном из свойств должна соответствовать записи в той же позиции другого свойств. 
    
11. Если ответ отправляется только отправителю исходного сообщения, создайте список получателей одного элемента с получателем, представленным свойством **пр_сент_репресентинг** исходного сообщения. Дополнительные сведения о создании списка получателей приведены [в разделе Создание списка получателей](creating-a-recipient-list.md).
    
12. Если ответ является ответом все, создайте список получателей следующим образом:
    
    1. ВыЗовите метод [iMessage:: жетреЦипиенттабле](imessage-getrecipienttable.md) исходного сообщения, чтобы получить доступ к его таблице получателей. 
        
    2. ВыЗовите [хркуеряллровс](hrqueryallrows.md) , чтобы получить все строки в таблице. Определите, соответствует ли каждая строка основному получателю или получателю копии, и должен ли она отображаться в списке или в том случае, если она представляет получателя скрытой копии или пользователя и должна быть удалена из списка. 
        
    3. Различать типы получателей, взглянув на столбец **пр_реЦипиент_типе** ([PidTagRecipientType](pidtagrecipienttype-canonical-property.md)). Для этого столбца будет задано значение МАПИ_ТО для получателей копии, МАПИ_КК для получателей копии и МАПИ_БКК для получателей скрытой копии. 
        
    4. Сравните столбец **пр_сеарч_кэй** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) со свойством **пр_рецеивед_би_сеарч_кэй** исходного сообщения, чтобы определить, представляет ли строка пользователя. 
        
    5. Удалите ненужные строки из списка получателей, вызвав [мапифрибуффер](mapifreebuffer.md) , чтобы освободить память, связанную с соответствующими записями в структуре [SRowSet](srowset.md) таблицы получателя. ПриСвойте всем значениям массива значений свойства ноль, всем элементам **квалуес** — ноль и всем элементам **лппропс** в каждой структуре [СРОВ](srow.md) в **SRowSetе** значение null. 
        
    6. Добавьте отправителя в список получателей, представленный исходным сообщением **\_сент_репресентинг_наме** ([PidTagSentRepresentingName](pidtagsentrepresentingname-canonical-property.md)) и **пр_сент_репресентинг_ентрид** ([PidTagSentRepresentingEntryId](pidtagsentrepresentingentryid-canonical-property.md)). параметры. Убедитесь, что отправитель не дублируется в списке.
        
    7. ВыЗовите метод [iMessage:: модифиреЦипиентс](imessage-modifyrecipients.md) , установив для параметра _ulFlags_ нулевое значение, чтобы создать новый список получателей для ответа или переадресованного сообщения, основанного на списке из исходного сообщения. 
    
13. ВыЗовите метод [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) ответа для сохранения сообщения или [iMessage:: субмитмессаже](imessage-submitmessage.md) , чтобы сохранить и отправить его. 
    
> [!NOTE]
> Перед вызовом **iMessage:: модифиреЦипиентс** для хранения изменений в списке получателей можно разрешить пользователям вносить изменения с помощью формы сообщения. Пользователи могут добавлять в список или удалять определенные элементы. Предоставление пользователям разрешения на внесение изменений в список получателей является дополнительным компонентом клиента. 
  

