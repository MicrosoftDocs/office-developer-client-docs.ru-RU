---
title: Кодирование сообщения с использованием формата TNEF
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6b86d9a9-6876-4885-ae1e-8571b25b85cc
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: cdaa03cfbc0bbd0fcf6a320ecf8fae9f372d5781
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32336703"
---
# <a name="encoding-a-message-with-tnef"></a>Кодирование сообщения с использованием формата TNEF

**Область применения**: Outlook 2013 | Outlook 2016 
  
При отправке сообщения поставщик транспорта может создать файл, который будет использоваться для хранения сообщения во время передачи. После этого интерфейс [IStream](https://msdn.microsoft.com/library/aa380034%28VS.85%29.aspx) упаковывается вокруг файла. Затем поставщик транспорта использует методы [итнеф](itnefiunknown.md) для записи свойств сообщения в поток в формате с тегом, что позволяет легко раскодировать их принимающими поставщиками транспорта. 
  
**Представление всего сообщения в отдельном файле**
  
1. Получите объект TNEF, передав объект [IStream](https://msdn.microsoft.com/library/aa380034%28VS.85%29.aspx) и сообщение в функцию [опентнефстреамекс](opentnefstreamex.md) . 
    
2. Получите список всех определенных свойств сообщения, вызвав метод [IMAPIProp:: жетпроплист](imapiprop-getproplist.md) . 
    
3. Используйте методы [IMAPIProp](imapipropiunknown.md) , чтобы исключить все свойства, поддерживаемые системой обмена сообщениями. В нужное время запишите эти свойства в систему обмена сообщениями в формате, требуемом системой обмена сообщениями. 
    
4. Call [итнеф:: аддпропс](itnef-addprops.md) для кодирования остальных свойств, включая все вложения. 
    
5. ВыЗовите метод [итнеф:: Finish](itnef-finish.md) для кодирования сообщения в поток TNEF после добавления всех запрошенных свойств. 
    
6. ВыЗовите метод [итнеф:: опентагжедбоди](itnef-opentaggedbody.md) , чтобы получить текст сообщения с тегами. Этот текст с тегами записывается в систему обмена сообщениями с помощью методов из интерфейса OLE [IStream](https://msdn.microsoft.com/library/aa380034%28VS.85%29.aspx) . 
    
7. ВыЗовите метод [IUnknown:: Release](https://msdn.microsoft.com/library/ms682317%28VS.85%29.aspx) , чтобы освободить объект **итнеф** . 
    
**Обработка входящего сообщения в формате TNEF**
  
1. Получение объекта сообщения MAPI из буфера обмена MAPI и запись свойств заголовка сообщения в новое сообщение MAPI.
    
2. Создайте и инициализируйте объект [IStream](https://msdn.microsoft.com/library/aa380034%28VS.85%29.aspx) , который будет содержать данные TNEF из входящего сообщения. 
    
3. Передайте сообщение MAPI и объект [IStream](https://msdn.microsoft.com/library/aa380034%28VS.85%29.aspx) в функцию [опентнефстреамекс](opentnefstreamex.md) . 
    
4. РасШифровать данные в формате TNEF, вызвав метод [итнеф:: екстрактпропс](itnef-extractprops.md) . 
    
   > [!NOTE]
   > Все, что раскодировано с помощью **екстрактпропс** , заменят свойства, декодированные из конверта входящего сообщения. То есть извлеченные свойства TNEF будут перезаписаны существующие свойства сообщения. 
  
5. ОбРаботайте текст сообщения с тегами с помощью вызова [итнеф:: опентагжедбоди](itnef-opentaggedbody.md) и синтаксического анализа текста для восстановления положений вложений. 
    
6. Сохраните сообщение, вызвав [IMAPIProp:: SaveChanges](imapiprop-savechanges.md).
    
7. Освободите объект TNEF, вызвав метод [IUnknown:: Release](https://msdn.microsoft.com/library/ms682317%28VS.85%29.aspx) . 
    

