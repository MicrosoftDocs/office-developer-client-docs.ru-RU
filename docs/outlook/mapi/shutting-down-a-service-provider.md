---
title: Завершение работы поставщика услуг
manager: soliver
ms.date: 12/07/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e518830b-0aaa-4ce4-a85a-07e4f00750a9
description: '���� ���������� ���������: 7 ������� 2015 �.'
ms.openlocfilehash: 4e25dad1e04927e10af38cdfbf8f30c9bd04234b
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32339209"
---
# <a name="shutting-down-a-service-provider"></a>Завершение работы поставщика услуг

 
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Когда клиент вызывает метод [IMAPISession:: logoff](imapisession-logoff.md) для завершения сеанса и завершения работы всех активных поставщиков услуг, MAPI в свою очередь вызывает следующие методы: 
  
- [Иаблогон:: выход из системы](iablogon-logoff.md) для поставщиков адресных книг. 
    
- [Имслогон:: выход из системы](imslogon-logoff.md) для поставщиков хранилищ сообщений. 
    
- [Иксплогон:: транспортлогофф](ixplogon-transportlogoff.md) для поставщиков транспорта. 
    
Эти методы имеют похожие реализации. Ниже перечислены основные задачи, выполняемые методом выхода.
  
- Освобождение всех открытых объектов, в том числе подобъектов и объектов состояния.
    
- Вызов метода [IUnknown:: Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) объекта support для уменьшения счетчика ссылок. 
    
- Удаление всех зарегистрированных структур [мапиуид](mapiuid.md) поставщика. 
    
- Удаление строки поставщика в таблице Status.
    
- Выполнение любых задач, связанных с удалением ресурсов, таких как следующие:
    
  - Завершение подключения к удаленному серверу.
    
  - Уменьшение числа ссылок на объект logon.
    
  - Удаление объекта logon из списка объектов входа, которые хранятся у поставщика.
    
  - В режиме отладки выдача трассировок для обнаружения объектов с утечкой памяти.
    
При возвращении метода выхода из системы MAPI вызывает следующие вызовы:
  
- Метод **IUnknown:: Release** объекта logon. 
    
- Метод **завершения работы** объекта Provider для выполнения окончательных задач очистки. В зависимости от типа поставщика вызывается один из следующих методов: 
    
  - [Иабпровидер:: завершение работы](iabprovider-shutdown.md) для поставщиков адресных книг 
    
  - [Функцииimsprovider:: Shutdown](imsprovider-shutdown.md) для поставщиков хранилищ сообщений 
    
  - [Иксппровидер:: Shutdown](ixpprovider-shutdown.md) для поставщиков транспорта 
    
- Метод **IUnknown:: Release** объекта provider. 
    
Если ваш поставщик является хранилищем сообщений, клиентский вызов [IMsgStore:: сторелогофф](imsgstore-storelogoff.md) также начнет процесс завершения работы. **Сторелогофф** закрывает один конкретный поставщик хранилища сообщений и не оказывает никакого действия для сеанса. С этим методом можно завершить работу только из поставщика хранилища сообщений; нет явного способа завершить работу определенной адресной книги или поставщика транспорта. Сведения о том, как реагировать на вызов **сторелогофф** , приведены в разделе [Завершение работы поставщика хранилища сообщений](shutting-down-a-message-store-provider.md).
  
Библиотека DLL поставщика будет выгружена, когда MAPI вызывает функцию API Win32 **FreeLibrary**, вызов, выполненный после последнего активного клиента, называется [мапиунинитиализе](mapiuninitialize.md). По истечение этого времени ваш поставщик услуг завершит работу. 
  
## <a name="see-also"></a>См. также



[Поставщики службы MAPI](mapi-service-providers.md)

