---
title: Обработка уведомления о хранилище сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428027"
---
# <a name="handling-message-store-notification"></a><span data-ttu-id="d2beb-103">Обработка уведомления о хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="d2beb-103">Handling message store notification</span></span>
  
<span data-ttu-id="d2beb-104">**Область применения**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="d2beb-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="d2beb-105">Чтобы зарегистрироваться для уведомлений магазина сообщений, позвоните по методу [IMAPISession:::Advise](imapisession-advise.md) или [IMsgStore::Advise](imsgstore-advise.md) и укажите в содержимом  _параметра lpEntryID_ хранилище сообщений, папку или идентификатор записи сообщений.</span><span class="sxs-lookup"><span data-stu-id="d2beb-105">To register for message store notifications, call either the [IMAPISession::Advise](imapisession-advise.md) or [IMsgStore::Advise](imsgstore-advise.md) method and specify a message store, folder, or message entry identifier in the contents of the  _lpEntryID_ parameter.</span></span> <span data-ttu-id="d2beb-106">Поставщики магазинов сообщений поддерживают уведомления об объектах и таблицах.</span><span class="sxs-lookup"><span data-stu-id="d2beb-106">Message store providers support both object and table notifications.</span></span> <span data-ttu-id="d2beb-107">Регистрация в определенных объектах магазина сообщений, в таблицах иерархии папок и содержимого, описывая эти объекты, или в обоих объектах и таблицах, зависит от уведомлений, которые вы ожидаете увидеть, от вызовов, которые вы делаете для выполнения операций, и от того, как поставщик магазина сообщений поддерживает уведомление.</span><span class="sxs-lookup"><span data-stu-id="d2beb-107">Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification.</span></span> 
  
<span data-ttu-id="d2beb-108">Поскольку MAPI обеспечивает гибкость в том, как поставщики поддерживают уведомления, следует помнить, что вы не всегда будете получать одно и то же уведомление в ответ на определенное событие от всех поставщиков магазина сообщений.</span><span class="sxs-lookup"><span data-stu-id="d2beb-108">Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers.</span></span> <span data-ttu-id="d2beb-109">Некоторые поставщики магазинов сообщений вообще не поддерживают уведомления.</span><span class="sxs-lookup"><span data-stu-id="d2beb-109">Some message store providers do not support notifications at all.</span></span> <span data-ttu-id="d2beb-110">Чтобы определить, используется ли в хранилище сообщений уведомление о поддержке,  STORE_NOTIFY_OK в свойстве[PR_STORE_SUPPORT_MASK (PidTagStoreSupportMask).](pidtagstoresupportmask-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="d2beb-110">To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span>
  
<span data-ttu-id="d2beb-111">На одном конце спектра поставщиков магазинов сообщений, которые поддерживают уведомление, являются поставщиками, которые создают "богатые" уведомления; эти поставщики отправляют описательные уведомления для всех зарегистрированных источников консультаций.</span><span class="sxs-lookup"><span data-stu-id="d2beb-111">At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources.</span></span> <span data-ttu-id="d2beb-112">На другом конце — поставщики магазинов сообщений, поддерживают ограниченные уведомления; эти поставщики отправляют общие уведомления ограниченному числу источников консультаций.</span><span class="sxs-lookup"><span data-stu-id="d2beb-112">At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources.</span></span> 
  
<span data-ttu-id="d2beb-113">Например, если вы скопируете сообщение в папку, с которой вы зарегистрировались для получения уведомлений о копировании объектов и перемещении объектов, вы можете получать или не получать уведомления, копированные объектом.</span><span class="sxs-lookup"><span data-stu-id="d2beb-113">For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification.</span></span> <span data-ttu-id="d2beb-114">Независимо от того, получаете ли вы его, зависит от:</span><span class="sxs-lookup"><span data-stu-id="d2beb-114">Whether or not you receive it depends on:</span></span>
  
- <span data-ttu-id="d2beb-115">Метод, который вы вызвали для выполнения копии.</span><span class="sxs-lookup"><span data-stu-id="d2beb-115">The method that you called to perform the copy.</span></span> <span data-ttu-id="d2beb-116">Это может быть [IMAPIFolder::CopyMessages,](imapifolder-copymessages.md) [IMAPIProp::CopyTo](imapiprop-copyto.md)или [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span><span class="sxs-lookup"><span data-stu-id="d2beb-116">This could be [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md), or [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span>
    
- <span data-ttu-id="d2beb-117">Как поставщик хранения сообщений реализует метод копирования.</span><span class="sxs-lookup"><span data-stu-id="d2beb-117">How the message store provider implements the copy method.</span></span>
    
- <span data-ttu-id="d2beb-118">Поддерживает ли поставщик магазина сообщений объектные скопированные уведомления в папках.</span><span class="sxs-lookup"><span data-stu-id="d2beb-118">Whether or not the message store provider supports object copied notifications on folders.</span></span>
    
<span data-ttu-id="d2beb-119">Так как нет строгих инструкций, описывать, как реализовать уведомление о событиях для поставщиков магазинов сообщений, клиенты не могут ожидать последовательного поведения.</span><span class="sxs-lookup"><span data-stu-id="d2beb-119">Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior.</span></span> <span data-ttu-id="d2beb-120">MAPI делает рекомендации относительно того, как поставщики магазинов сообщений реализуют уведомление о событиях, а в следующей таблице описаны эти рекомендации.</span><span class="sxs-lookup"><span data-stu-id="d2beb-120">MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations.</span></span> <span data-ttu-id="d2beb-121">Прочитайте таблицу следующим образом: после выполнения операции в первом столбце ожидайте получения уведомления о типе, перечисленных во втором столбце, если вы зарегистрировались для этого типа с объектом, указанным в третьем столбце.</span><span class="sxs-lookup"><span data-stu-id="d2beb-121">Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column.</span></span> <span data-ttu-id="d2beb-122">Например, после создания папки вы получите уведомление  _fnevObjectCreated_ только в том случае, если вы зарегистрировались для  _уведомлений fnevObjectCreated_ в хранилище сообщений.</span><span class="sxs-lookup"><span data-stu-id="d2beb-122">For example, after you have created a folder, you will receive an  _fnevObjectCreated_ notification only if you have registered for  _fnevObjectCreated_ notifications with the message store.</span></span> 
  
|<span data-ttu-id="d2beb-123">**Операция**</span><span class="sxs-lookup"><span data-stu-id="d2beb-123">**Operation**</span></span>|<span data-ttu-id="d2beb-124">**Тип события**</span><span class="sxs-lookup"><span data-stu-id="d2beb-124">**Event type**</span></span>|<span data-ttu-id="d2beb-125">**Советы источника**</span><span class="sxs-lookup"><span data-stu-id="d2beb-125">**Advise source**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="d2beb-126">Создание папки</span><span class="sxs-lookup"><span data-stu-id="d2beb-126">Create a folder</span></span>  <br/> | <span data-ttu-id="d2beb-127">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="d2beb-127">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="d2beb-128">Хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="d2beb-128">Message store</span></span>  <br/> |
|<span data-ttu-id="d2beb-129">Удаление папки</span><span class="sxs-lookup"><span data-stu-id="d2beb-129">Delete a folder</span></span>  <br/> | <span data-ttu-id="d2beb-130">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="d2beb-130">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="d2beb-131">Хранилище сообщений Удаленная папка</span><span class="sxs-lookup"><span data-stu-id="d2beb-131">Message store Deleted folder</span></span>  <br/> |
|<span data-ttu-id="d2beb-132">Перемещение папки из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="d2beb-132">Move a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="d2beb-133">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="d2beb-133">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="d2beb-134">Хранилище сообщений Перемещенная папка</span><span class="sxs-lookup"><span data-stu-id="d2beb-134">Message store Moved folder</span></span>  <br/> |
|<span data-ttu-id="d2beb-135">Скопируйте папку из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="d2beb-135">Copy a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="d2beb-136">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="d2beb-136">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="d2beb-137">Хранилище сообщений и скопированная папка (уведомление  _fnevObjectCreated,_ отправленное для новой копии папки)</span><span class="sxs-lookup"><span data-stu-id="d2beb-137">Message store and copied folder (no  _fnevObjectCreated_ notification sent for the new copy of the folder)</span></span>  <br/> |
|<span data-ttu-id="d2beb-138">Изменение свойства вычислительной папки **(PR_SUBFOLDERS** [(PidTagSubfolders),](pidtagsubfolders-canonical-property.md) **PR_CONTENT_UNREAD** [(PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** [(PidTagContentCount)](pidtagcontentcount-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="d2beb-138">Change in a computed folder property (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> | <span data-ttu-id="d2beb-139">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="d2beb-139">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="d2beb-140">Хранилище сообщений Измененная папка (нет уведомлений в родительской папке)</span><span class="sxs-lookup"><span data-stu-id="d2beb-140">Message store Changed folder (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="d2beb-141">Создание сообщения.</span><span class="sxs-lookup"><span data-stu-id="d2beb-141">Create a message</span></span>  <br/> | <span data-ttu-id="d2beb-142">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="d2beb-142">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="d2beb-143">Хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="d2beb-143">Message store</span></span>  <br/> |
|<span data-ttu-id="d2beb-144">Удаление сообщения, в результате чего в свойстве родительской **папки** PR_CONTENT_COUNT изменения</span><span class="sxs-lookup"><span data-stu-id="d2beb-144">Delete a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="d2beb-145">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="d2beb-145">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="d2beb-146">Хранилище сообщений Удаленные сообщения</span><span class="sxs-lookup"><span data-stu-id="d2beb-146">Message store Deleted message</span></span>  <br/> |
|<span data-ttu-id="d2beb-147">Перемещение сообщения из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="d2beb-147">Move a message from one folder to another</span></span>  <br/> | <span data-ttu-id="d2beb-148">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="d2beb-148">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="d2beb-149">Хранилище сообщений Перемещено сообщение</span><span class="sxs-lookup"><span data-stu-id="d2beb-149">Message store Moved message</span></span>  <br/> |
|<span data-ttu-id="d2beb-150">Копирование сообщения из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="d2beb-150">Copy a message from one folder to another</span></span>  <br/> | <span data-ttu-id="d2beb-151">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="d2beb-151">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="d2beb-152">Хранилище сообщений Скопированное сообщение (Нет  _уведомления fnevObjectCreated_ для новой копии сообщения)</span><span class="sxs-lookup"><span data-stu-id="d2beb-152">Message store Copied message (No  _fnevObjectCreated_ notification for new copy of the message)</span></span>  <br/> |
|<span data-ttu-id="d2beb-153">Сохранение сообщения, в результате чего в свойстве родительской **папки** PR_CONTENT_COUNT изменения</span><span class="sxs-lookup"><span data-stu-id="d2beb-153">Save a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="d2beb-154">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="d2beb-154">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="d2beb-155">Хранилище сообщений только при первом сохранения</span><span class="sxs-lookup"><span data-stu-id="d2beb-155">Message store on first save only</span></span>  <br/> |
|<span data-ttu-id="d2beb-156">Сохранение сообщения</span><span class="sxs-lookup"><span data-stu-id="d2beb-156">Save a message</span></span>  <br/> | <span data-ttu-id="d2beb-157">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="d2beb-157">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="d2beb-158">Хранение сообщений о сохранениях после первого сохранения измененного сообщения (нет уведомления в родительской папке)</span><span class="sxs-lookup"><span data-stu-id="d2beb-158">Message store on saves after the first save Changed message (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="d2beb-159">Завершение операции поиска</span><span class="sxs-lookup"><span data-stu-id="d2beb-159">Complete a search operation</span></span>  <br/> | <span data-ttu-id="d2beb-160">_fnevSearchComplete_</span><span class="sxs-lookup"><span data-stu-id="d2beb-160">_fnevSearchComplete_</span></span> <br/> |<span data-ttu-id="d2beb-161">Папка поиска в хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="d2beb-161">Message store Search folder</span></span>  <br/> |
|<span data-ttu-id="d2beb-162">Новое сообщение</span><span class="sxs-lookup"><span data-stu-id="d2beb-162">New message</span></span>  <br/> | <span data-ttu-id="d2beb-163">_fnevNewMail_</span><span class="sxs-lookup"><span data-stu-id="d2beb-163">_fnevNewMail_</span></span> <br/> |<span data-ttu-id="d2beb-164">Хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="d2beb-164">Message store</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="d2beb-165">При приеме уведомления об изменениях объекта помните, [](object_notification.md) что часть массива тегов свойств структуры OBJECT_NOTIFICATION, на которую указывает параметр _lpNotifications_ в **вызове OnNotify,** может быть NULL или нет.</span><span class="sxs-lookup"><span data-stu-id="d2beb-165">When you receive an object modified notification, remember that the property tag array portion of the [OBJECT_NOTIFICATION](object_notification.md) structure pointed to by the  _lpNotifications_ parameter in the **OnNotify** call may or may not be NULL.</span></span> <span data-ttu-id="d2beb-166">Поставщики магазинов сообщений не обязаны вставлять сведения о свойстве в этот массив, а большинство — нет.</span><span class="sxs-lookup"><span data-stu-id="d2beb-166">Message store providers are not required to insert property information in this array and most do not.</span></span> <span data-ttu-id="d2beb-167">Убедитесь, что метод **OnNotify** может обрабатывать случай, когда указатель  _lpPropTagArray_ является NULL.</span><span class="sxs-lookup"><span data-stu-id="d2beb-167">Make sure your **OnNotify** method can handle the case where the  _lpPropTagArray_ pointer is NULL.</span></span> 
  
<span data-ttu-id="d2beb-168">Для большинства, если не всех уведомлений об объектах, обновим представление затронутой папки или папок.</span><span class="sxs-lookup"><span data-stu-id="d2beb-168">For most, if not all object notifications, update the view of the affected folder or folders.</span></span>
  

