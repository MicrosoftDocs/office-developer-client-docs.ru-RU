---
title: Обработка уведомления о хранилище сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428027"
---
# <a name="handling-message-store-notification"></a>Обработка уведомления о хранилище сообщений
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Для регистрации уведомлений в хранилище сообщений вызовите метод [IMAPISession:: Advise](imapisession-advise.md) или [IMsgStore:: Advise](imsgstore-advise.md) и укажите хранилище сообщений, папку или идентификатор записи сообщения в содержимом параметра _лпентрид_ . Поставщики хранилищ сообщений поддерживают как уведомления объектов, так и уведомления таблиц. Независимо от того, зарегистрированы ли вы с определенными объектами хранилища сообщений, с помощью иерархий папок и таблиц содержимого, описывающих эти объекты, а также с объектами и таблицами зависит от ожидаемых уведомлений, вызовов, выполняемых для выполнения операций, а также того, как поставщик хранилища сообщений поддерживает уведомление. 
  
Так как MAPI обеспечивает гибкость при поддержке уведомлений поставщиками, имейте в виду, что в ответ на определенное событие от всех поставщиков хранилищ сообщений не всегда будет получен одинаковый тип уведомления. Некоторые поставщики хранилищ сообщений не поддерживают уведомления. Чтобы определить, поддерживает ли используемое хранилище сообщений уведомление, найдите бит STORE_NOTIFY_OK в его свойстве **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)).
  
В одном конце спектра поставщиков хранилища сообщений, поддерживающих уведомления, поставщики, создающие "Расширенные" уведомления; Эти поставщики отправляют описательные уведомления для всех зарегистрированных источников рекомендаций. На другом конце представлены поставщики хранилища сообщений, поддерживающие ограниченные уведомления; Эти поставщики отправляют общие уведомления для ограниченного числа источников рекомендаций. 
  
Например, если вы скопировали сообщение в папку, где вы зарегистрировались, чтобы получать уведомления о копировании объектов и объектных перемещений, вы можете или не получить уведомление о копировании объекта. Независимо от того, вы не получаете это, зависит от следующих условий:
  
- Метод, вызываемый для выполнения копирования. Это может быть [IMAPIFolder:: копимессажес](imapifolder-copymessages.md), [IMAPIProp:: CopyTo](imapiprop-copyto.md)или [IMAPIProp:: копипропс](imapiprop-copyprops.md).
    
- Как поставщик хранилища сообщений реализует метод Copy.
    
- Указывает, поддерживает ли поставщик хранилища сообщений уведомления об объектах, скопированных в папки.
    
Так как не существует никаких рекомендаций, описывающих, как реализовать уведомления о событиях для поставщиков хранилищ сообщений, клиенты не могут ожидать согласованное поведение. MAPI обеспечивает рекомендации по реализации уведомления о событиях поставщиками хранилищ сообщений и приведенной ниже таблице. Прочтите таблицу следующим образом: после выполнения операции в первом столбце ожидается получение уведомления о типе, указанном во втором столбце, если вы зарегистрировались для этого типа с объектом, указанным в третьем столбце. Например, после создания папки вы получите уведомление _фневобжекткреатед_ только в том случае, если вы зарегистрировали уведомления _фневобжекткреатед_ с помощью хранилища сообщений. 
  
|**Операция**|**Тип события**|**Источник уведомления**|
|:-----|:-----|:-----|
|Создание папки  <br/> | _фневобжекткреатед_ <br/> |Хранилище сообщений  <br/> |
|Удаление папки  <br/> | _фневобжектделетед_ <br/> |Удаленная папка хранилища сообщений  <br/> |
|Перемещение папки из одной папки в другую  <br/> | _фневобжектмовед_ <br/> |Хранилище сообщений перемещенная папка  <br/> |
|Копирование папки из одной папки в другую  <br/> | _фневобжекткопиед_ <br/> |Хранилище сообщений и скопированная папка (нет уведомления _фневобжекткреатед_ , отправленного для новой копии папки)  <br/> |
|Изменение в свойстве вычисляемой папки (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))  <br/> | _фневобжектмодифиед_ <br/> |Хранилище сообщений измененная папка (без уведомления в родительскую папку)  <br/> |
|Создание сообщения.  <br/> | _фневобжекткреатед_ <br/> |Хранилище сообщений  <br/> |
|Удаление сообщения, в результате чего изменяется свойство **PR_CONTENT_COUNT** родительской папки  <br/> | _фневобжектделетед_ <br/> |Сообщение с удаленным хранилищем сообщений  <br/> |
|Перемещение сообщения из одной папки в другую  <br/> | _фневобжектмовед_ <br/> |Сообщение о перемещении хранилища сообщений  <br/> |
|Копирование сообщения из одной папки в другую  <br/> | _фневобжекткопиед_ <br/> |Сообщение о копировании хранилища сообщений (без уведомлений _фневобжекткреатед_ для новой копии сообщения)  <br/> |
|Сохранение сообщения, в результате чего изменяется свойство **PR_CONTENT_COUNT** родительской папки  <br/> | _фневобжекткреатед_ <br/> |Хранение сообщений только при первом сохранении  <br/> |
|Сохранение сообщения  <br/> | _фневобжектмодифиед_ <br/> |Хранилище сообщений при сохранении после первого изменения сохранения (без уведомления для родительской папки)  <br/> |
|Выполнение операции поиска  <br/> | _фневсеарчкомплете_ <br/> |Папка поиска хранилища сообщений  <br/> |
|Новое сообщение  <br/> | _фневневмаил_ <br/> |Хранилище сообщений  <br/> |
   
> [!NOTE]
> При получении уведомления об изменении объекта Обратите внимание на то, что часть массива тегов свойств структуры [OBJECT_NOTIFICATION](object_notification.md) , на которую указывает параметр _лпнотификатионс_ в вызове **OnNotify** , может иметь или не иметь значение null. Поставщики хранилища сообщений не являются обязательными для вставки сведений о свойствах в этот массив, и большинство из них нет. Убедитесь, что метод **OnNotify** может обрабатывать ситуацию, в которой указатель _лппроптагаррай_ имеет значение null. 
  
Для большинства (если не все уведомления объектов) обновите представление затронутой папки или папок.
  

