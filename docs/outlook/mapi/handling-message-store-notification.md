---
title: Обработка уведомления о хранилище сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428027"
---
# <a name="handling-message-store-notification"></a>Обработка уведомления о хранилище сообщений
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Чтобы зарегистрировать уведомления о хранилище сообщений, вызовите метод [IMAPISession::Advise](imapisession-advise.md) или [IMsgStore::Advise](imsgstore-advise.md) и укажите в содержимом параметра  _lpEntryID_ идентификатор хранения сообщений, папки или записи сообщения. Поставщики store сообщений поддерживают уведомления как об объектах, так и о таблицах. Регистрируется ли вы с определенными объектами хранения сообщений, с таблицами иерархии папок и содержимым, которые описывают эти объекты, или с обоими объектами и таблицами, зависит от уведомлений, которые вы ожидаете увидеть, вызовов, выполняемых для выполнения операций, и того, как поставщик содержимого сообщений поддерживает уведомление. 
  
Так как MAPI обеспечивает гибкость в поддержке уведомлений поставщиками, следует помнить, что вы не всегда будете получать одно и то же уведомление одного типа в ответ на определенное событие от всех поставщиков store сообщений. Некоторые поставщики store сообщений вообще не поддерживают уведомления. Чтобы определить, поддерживает ли используемая вами хранилище сообщений уведомление, на STORE_NOTIFY_OK в свойстве **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask).](pidtagstoresupportmask-canonical-property.md)
  
На одном конце спектра поставщиков store сообщений, которые поддерживают уведомления, являются поставщиками, которые создают "богатые" уведомления; эти поставщики отправляют описательные уведомления для всех зарегистрированных источников консультаций. С другой стороны, поставщики store сообщений поддерживают ограниченные уведомления; эти поставщики отправляют общие уведомления для ограниченного количества источников консультаций. 
  
Например, если скопировать сообщение в папку, в которую вы зарегистрировались для получения уведомлений как скопированные объекты, так и перемещенные объекты, вы можете получать или не получать уведомления о скопированные объекты. Независимо от того, получаете ли вы его, зависит от:
  
- Метод, который вы вызвали для выполнения копирования. Это может [быть IMAPIFolder::CopyMessages,](imapifolder-copymessages.md) [IMAPIProp::CopyTo](imapiprop-copyto.md)или [IMAPIProp::CopyProps](imapiprop-copyprops.md).
    
- Способ реализации метода копирования поставщиком store сообщений.
    
- Поддерживает ли поставщик хранения сообщений объектные уведомления для папок.
    
Так как нет строгих рекомендаций по реализации уведомлений о событиях для поставщиков store сообщений, клиенты не могут ожидать согласованного поведения. MAPI не дает рекомендаций относительно того, как поставщики реализации уведомлений о событиях, и эти рекомендации описаны в следующей таблице. Прочитайте таблицу следующим образом: после выполнения операции в первом столбце вы получите уведомление о типе, перечисленного во втором столбце, если вы зарегистрировались для этого типа с объектом, указанным в третьем столбце. Например, после создания папки вы получите уведомление  _fnevObjectCreated,_ только если вы зарегистрировались для уведомлений  _fnevObjectCreated_ в хранилище сообщений. 
  
|**Операция**|**Тип события**|**Источник консультации**|
|:-----|:-----|:-----|
|Создание папки  <br/> | _fnevObjectCreated_ <br/> |Хранилище сообщений  <br/> |
|Удаление папки  <br/> | _fnevObjectDeleted_ <br/> |Папка "Удаленное хранилище сообщений"  <br/> |
|Перемещение папки из одной папки в другую  <br/> | _fnevObjectMoved_ <br/> |Папка "Перемещено" в хранилище сообщений  <br/> |
|Копирование папки из одной папки в другую  <br/> | _fnevObjectCopied_ <br/> |Хранилище сообщений и скопированная папка (уведомление  _fnevObjectCreated_ для новой копии папки не отправляется)  <br/> |
|Изменение свойства вычисляемой папки (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount)](pidtagcontentcount-canonical-property.md)  <br/> | _fnevObjectModified_ <br/> |Папка "Хранилище сообщений изменено" (родительской папке не было уведомлений)  <br/> |
|Создание сообщения.  <br/> | _fnevObjectCreated_ <br/> |Хранилище сообщений  <br/> |
|Удаление сообщения, что приводит к изменению свойства PR_CONTENT_COUNT родительской **папки**  <br/> | _fnevObjectDeleted_ <br/> |Message store Deleted message  <br/> |
|Перемещение сообщения из одной папки в другую  <br/> | _fnevObjectMoved_ <br/> |Сообщение перемещено в хранилище сообщений  <br/> |
|Копирование сообщения из одной папки в другую  <br/> | _fnevObjectCopied_ <br/> |Скопированное сообщение в хранилище сообщений (уведомление  _fnevObjectCreated_ для новой копии сообщения)  <br/> |
|Сохранение сообщения, что приводит к изменению свойства PR_CONTENT_COUNT родительской **папки**  <br/> | _fnevObjectCreated_ <br/> |Хранилище сообщений только при первом сохранения  <br/> |
|Сохранение сообщения  <br/> | _fnevObjectModified_ <br/> |Хранилище сообщений при сохранения после первого сохранения сообщения "Изменено" (для родительской папки нет уведомлений)  <br/> |
|Завершение операции поиска  <br/> | _fnevSearchComplete_ <br/> |Папка поиска в хранилище сообщений  <br/> |
|Новое сообщение  <br/> | _fnevNewMail_ <br/> |Хранилище сообщений  <br/> |
   
> [!NOTE]
> При уведомлении о измененном объекте помните, [](object_notification.md) что часть массива тегов свойств структуры OBJECT_NOTIFICATION, на которую указывает параметр _lpNotifications_ в вызове **OnNotify,** может иметь или не быть NULL. Поставщики store сообщений не обязаны вставлять сведения о свойствах в этот массив, а большинство — нет. Убедитесь, что метод **OnNotify** может обрабатывать тот случай, когда указатель  _lpPropTagArray_ имеет NULL. 
  
Для большинства (если не всех) уведомлений об объектах обновим представление затронутой папки или папок.
  

