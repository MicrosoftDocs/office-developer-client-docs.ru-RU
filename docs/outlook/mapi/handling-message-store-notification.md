---
title: Обработка уведомлений хранилища сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 33002f31c185262bf21b4e74095e0774f55e3bf5
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22564593"
---
# <a name="handling-message-store-notification"></a><span data-ttu-id="c3c13-103">Обработка уведомлений хранилища сообщений</span><span class="sxs-lookup"><span data-stu-id="c3c13-103">Handling message store notification</span></span>
  
<span data-ttu-id="c3c13-104">**Применимо к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="c3c13-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="c3c13-105">Для регистрации уведомлений хранилища сообщений, вызовите метод либо [IMAPISession::Advise](imapisession-advise.md) , либо [IMsgStore::Advise](imsgstore-advise.md) и укажите хранилище сообщений, папки или идентификатор записи сообщения в содержимое параметра _lpEntryID_ .</span><span class="sxs-lookup"><span data-stu-id="c3c13-105">To register for message store notifications, call either the [IMAPISession::Advise](imapisession-advise.md) or [IMsgStore::Advise](imsgstore-advise.md) method and specify a message store, folder, or message entry identifier in the contents of the  _lpEntryID_ parameter.</span></span> <span data-ttu-id="c3c13-106">Поставщики хранилища сообщений поддерживает объект и таблицы уведомлений.</span><span class="sxs-lookup"><span data-stu-id="c3c13-106">Message store providers support both object and table notifications.</span></span> <span data-ttu-id="c3c13-107">Регистрация объектов хранилища конкретное сообщение, которые описывают эти объекты таблиц иерархии и содержимое папок или оба объекта и таблиц, зависит от уведомлений, согласно прогнозу, будут видеть, звонки, сделать для выполнения операций, и способ поставщик хранения сообщений поддерживает уведомления.</span><span class="sxs-lookup"><span data-stu-id="c3c13-107">Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification.</span></span> 
  
<span data-ttu-id="c3c13-108">MAPI обеспечивает гибкость в поддержке уведомления поставщиков, обратите внимание, что вы не всегда получают одного типа уведомлений в ответ на определенном событии из всех поставщиков хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="c3c13-108">Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers.</span></span> <span data-ttu-id="c3c13-109">Некоторые поставщики хранилища сообщений не поддерживают уведомления вообще.</span><span class="sxs-lookup"><span data-stu-id="c3c13-109">Some message store providers do not support notifications at all.</span></span> <span data-ttu-id="c3c13-110">Чтобы определить, поддерживает ли хранилище сообщений, которые вы используете уведомлений внешнего вида для STORE_NOTIFY_OK бит в своем свойстве **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="c3c13-110">To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span>
  
<span data-ttu-id="c3c13-111">На одном конце спектра хранилища сообщений поставщики, которые поддерживают уведомлений, поставщики, которые создают «расширенный» уведомления; Эти поставщики отправлять описания уведомления для всех зарегистрированных уведомить источников.</span><span class="sxs-lookup"><span data-stu-id="c3c13-111">At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources.</span></span> <span data-ttu-id="c3c13-112">С другой стороны, сообщение поставщиков хранилища, которые поддерживают уведомления; Эти поставщики отправлять общие уведомления для ограниченного числа источников уведомлений.</span><span class="sxs-lookup"><span data-stu-id="c3c13-112">At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources.</span></span> 
  
<span data-ttu-id="c3c13-113">Например если скопировать сообщение в папку с помощью которой вы зарегистрированы в качестве получателей копируются как объект и объект перемещен уведомлений, может или не получают уведомления объекта, скопированного.</span><span class="sxs-lookup"><span data-stu-id="c3c13-113">For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification.</span></span> <span data-ttu-id="c3c13-114">Ли вы получаете зависит от:</span><span class="sxs-lookup"><span data-stu-id="c3c13-114">Whether or not you receive it depends on:</span></span>
  
- <span data-ttu-id="c3c13-115">Метод, который вызывается для выполнения копирования.</span><span class="sxs-lookup"><span data-stu-id="c3c13-115">The method that you called to perform the copy.</span></span> <span data-ttu-id="c3c13-116">Это может быть [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md)или [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span><span class="sxs-lookup"><span data-stu-id="c3c13-116">This could be [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md), or [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span>
    
- <span data-ttu-id="c3c13-117">Как сообщения хранилища реализует поставщик способа копирования.</span><span class="sxs-lookup"><span data-stu-id="c3c13-117">How the message store provider implements the copy method.</span></span>
    
- <span data-ttu-id="c3c13-118">Ли поставщик хранения сообщений поддерживает уведомления объекта, скопированного в папках.</span><span class="sxs-lookup"><span data-stu-id="c3c13-118">Whether or not the message store provider supports object copied notifications on folders.</span></span>
    
<span data-ttu-id="c3c13-119">Из-за что поставщиков хранилищ не строгие рекомендации, которые описывают способы реализации уведомления для сообщений, клиенты не могут привести согласованность работы.</span><span class="sxs-lookup"><span data-stu-id="c3c13-119">Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior.</span></span> <span data-ttu-id="c3c13-120">MAPI рекомендует для хранения как сообщение уведомления о событиях реализация поставщиков и в следующей таблице приведено ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="c3c13-120">MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations.</span></span> <span data-ttu-id="c3c13-121">Чтение таблицы следующим образом: после выполнения операции в первый столбец, согласно прогнозу, будут получать уведомления о списке во втором столбце, если вы зарегистрированы для этого типа с помощью объекта, указанный в столбце третий тип.</span><span class="sxs-lookup"><span data-stu-id="c3c13-121">Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column.</span></span> <span data-ttu-id="c3c13-122">Например после создания папки, вы получите уведомление о _fnevObjectCreated_ только в том случае, если вы зарегистрировали _fnevObjectCreated_ уведомлений с хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="c3c13-122">For example, after you have created a folder, you will receive an  _fnevObjectCreated_ notification only if you have registered for  _fnevObjectCreated_ notifications with the message store.</span></span> 
  
|<span data-ttu-id="c3c13-123">**Операция**</span><span class="sxs-lookup"><span data-stu-id="c3c13-123">**Operation**</span></span>|<span data-ttu-id="c3c13-124">**Тип события**</span><span class="sxs-lookup"><span data-stu-id="c3c13-124">**Event type**</span></span>|<span data-ttu-id="c3c13-125">**Уведомить источник**</span><span class="sxs-lookup"><span data-stu-id="c3c13-125">**Advise source**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="c3c13-126">Создайте папку</span><span class="sxs-lookup"><span data-stu-id="c3c13-126">Create a folder</span></span>  <br/> | <span data-ttu-id="c3c13-127">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="c3c13-127">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="c3c13-128">Хранение сообщений</span><span class="sxs-lookup"><span data-stu-id="c3c13-128">Message store</span></span>  <br/> |
|<span data-ttu-id="c3c13-129">Удаление папки</span><span class="sxs-lookup"><span data-stu-id="c3c13-129">Delete a folder</span></span>  <br/> | <span data-ttu-id="c3c13-130">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="c3c13-130">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="c3c13-131">Хранение сообщений удаленные папки</span><span class="sxs-lookup"><span data-stu-id="c3c13-131">Message store Deleted folder</span></span>  <br/> |
|<span data-ttu-id="c3c13-132">Перемещение папки из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="c3c13-132">Move a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="c3c13-133">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="c3c13-133">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="c3c13-134">Сообщение хранения папки перемещено</span><span class="sxs-lookup"><span data-stu-id="c3c13-134">Message store Moved folder</span></span>  <br/> |
|<span data-ttu-id="c3c13-135">Скопируйте папки из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="c3c13-135">Copy a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="c3c13-136">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="c3c13-136">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="c3c13-137">Сообщение хранения и копирования папки ( _fnevObjectCreated_ уведомление не отправлено для новой копии папки)</span><span class="sxs-lookup"><span data-stu-id="c3c13-137">Message store and copied folder (no  _fnevObjectCreated_ notification sent for the new copy of the folder)</span></span>  <br/> |
|<span data-ttu-id="c3c13-138">Изменения в свойстве вычисляемого папки (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)) **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="c3c13-138">Change in a computed folder property (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> | <span data-ttu-id="c3c13-139">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="c3c13-139">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="c3c13-140">Сообщение хранения Changed папки (без уведомления для родительской папки)</span><span class="sxs-lookup"><span data-stu-id="c3c13-140">Message store Changed folder (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="c3c13-141">Создание сообщения.</span><span class="sxs-lookup"><span data-stu-id="c3c13-141">Create a message</span></span>  <br/> | <span data-ttu-id="c3c13-142">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="c3c13-142">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="c3c13-143">Хранение сообщений</span><span class="sxs-lookup"><span data-stu-id="c3c13-143">Message store</span></span>  <br/> |
|<span data-ttu-id="c3c13-144">Удалить сообщение, вызывающие изменения в родительском свойство **PR_CONTENT_COUNT** папки</span><span class="sxs-lookup"><span data-stu-id="c3c13-144">Delete a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="c3c13-145">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="c3c13-145">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="c3c13-146">Хранение сообщений удаленные сообщения</span><span class="sxs-lookup"><span data-stu-id="c3c13-146">Message store Deleted message</span></span>  <br/> |
|<span data-ttu-id="c3c13-147">Переместить сообщение из одной папки</span><span class="sxs-lookup"><span data-stu-id="c3c13-147">Move a message from one folder to another</span></span>  <br/> | <span data-ttu-id="c3c13-148">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="c3c13-148">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="c3c13-149">Сообщение перемещено хранения сообщений</span><span class="sxs-lookup"><span data-stu-id="c3c13-149">Message store Moved message</span></span>  <br/> |
|<span data-ttu-id="c3c13-150">Копирование сообщения из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="c3c13-150">Copy a message from one folder to another</span></span>  <br/> | <span data-ttu-id="c3c13-151">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="c3c13-151">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="c3c13-152">Хранение сообщений сообщение скопировано (не _fnevObjectCreated_ уведомления о новой копии сообщения)</span><span class="sxs-lookup"><span data-stu-id="c3c13-152">Message store Copied message (No  _fnevObjectCreated_ notification for new copy of the message)</span></span>  <br/> |
|<span data-ttu-id="c3c13-153">Сохраните сообщение, вызывающие изменения в родительском свойство **PR_CONTENT_COUNT** папки</span><span class="sxs-lookup"><span data-stu-id="c3c13-153">Save a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="c3c13-154">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="c3c13-154">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="c3c13-155">Хранение сообщений при первой только сохранение</span><span class="sxs-lookup"><span data-stu-id="c3c13-155">Message store on first save only</span></span>  <br/> |
|<span data-ttu-id="c3c13-156">Сохраните сообщение</span><span class="sxs-lookup"><span data-stu-id="c3c13-156">Save a message</span></span>  <br/> | <span data-ttu-id="c3c13-157">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="c3c13-157">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="c3c13-158">Хранение сообщений на сохранение после первого сохранить Changed сообщения (без уведомления для родительской папки)</span><span class="sxs-lookup"><span data-stu-id="c3c13-158">Message store on saves after the first save Changed message (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="c3c13-159">Выполните операцию поиска</span><span class="sxs-lookup"><span data-stu-id="c3c13-159">Complete a search operation</span></span>  <br/> | <span data-ttu-id="c3c13-160">_fnevSearchComplete_</span><span class="sxs-lookup"><span data-stu-id="c3c13-160">_fnevSearchComplete_</span></span> <br/> |<span data-ttu-id="c3c13-161">Сообщение хранить папки поиска</span><span class="sxs-lookup"><span data-stu-id="c3c13-161">Message store Search folder</span></span>  <br/> |
|<span data-ttu-id="c3c13-162">Новое сообщение</span><span class="sxs-lookup"><span data-stu-id="c3c13-162">New message</span></span>  <br/> | <span data-ttu-id="c3c13-163">_fnevNewMail_</span><span class="sxs-lookup"><span data-stu-id="c3c13-163">_fnevNewMail_</span></span> <br/> |<span data-ttu-id="c3c13-164">Хранение сообщений</span><span class="sxs-lookup"><span data-stu-id="c3c13-164">Message store</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="c3c13-165">При получении уведомления изменения объекта не забывайте, что свойство tag массива часть структуры [OBJECT_NOTIFICATION](object_notification.md) , указывает параметр _lpNotifications_ в вызове **OnNotify** может или не может быть NULL.</span><span class="sxs-lookup"><span data-stu-id="c3c13-165">When you receive an object modified notification, remember that the property tag array portion of the [OBJECT_NOTIFICATION](object_notification.md) structure pointed to by the  _lpNotifications_ parameter in the **OnNotify** call may or may not be NULL.</span></span> <span data-ttu-id="c3c13-166">Поставщики хранения сообщения не требуется вставить сведения о свойствах этого массива и наиболее не.</span><span class="sxs-lookup"><span data-stu-id="c3c13-166">Message store providers are not required to insert property information in this array and most do not.</span></span> <span data-ttu-id="c3c13-167">Убедитесь в том, что метод **OnNotify** может обрабатывать случая, где указатель _lpPropTagArray_ имеет значение NULL.</span><span class="sxs-lookup"><span data-stu-id="c3c13-167">Make sure your **OnNotify** method can handle the case where the  _lpPropTagArray_ pointer is NULL.</span></span> 
  
<span data-ttu-id="c3c13-168">Для большинства Если не все объекта уведомления, обновите представление папки и папки.</span><span class="sxs-lookup"><span data-stu-id="c3c13-168">For most, if not all object notifications, update the view of the affected folder or folders.</span></span>
  

