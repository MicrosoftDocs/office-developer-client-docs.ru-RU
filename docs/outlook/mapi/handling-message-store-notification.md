---
title: Обработка уведомления о хранилище сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428027"
---
# <a name="handling-message-store-notification"></a><span data-ttu-id="4ed78-103">Обработка уведомления о хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-103">Handling message store notification</span></span>
  
<span data-ttu-id="4ed78-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="4ed78-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="4ed78-105">Для регистрации уведомлений в хранилище сообщений вызовите метод [IMAPISession:: Advise](imapisession-advise.md) или [IMsgStore:: Advise](imsgstore-advise.md) и укажите хранилище сообщений, папку или идентификатор записи сообщения в содержимом параметра _лпентрид_ .</span><span class="sxs-lookup"><span data-stu-id="4ed78-105">To register for message store notifications, call either the [IMAPISession::Advise](imapisession-advise.md) or [IMsgStore::Advise](imsgstore-advise.md) method and specify a message store, folder, or message entry identifier in the contents of the  _lpEntryID_ parameter.</span></span> <span data-ttu-id="4ed78-106">Поставщики хранилищ сообщений поддерживают как уведомления объектов, так и уведомления таблиц.</span><span class="sxs-lookup"><span data-stu-id="4ed78-106">Message store providers support both object and table notifications.</span></span> <span data-ttu-id="4ed78-107">Независимо от того, зарегистрированы ли вы с определенными объектами хранилища сообщений, с помощью иерархий папок и таблиц содержимого, описывающих эти объекты, а также с объектами и таблицами зависит от ожидаемых уведомлений, вызовов, выполняемых для выполнения операций, а также поставщик хранилища сообщений поддерживает уведомление.</span><span class="sxs-lookup"><span data-stu-id="4ed78-107">Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification.</span></span> 
  
<span data-ttu-id="4ed78-108">Так как MAPI обеспечивает гибкость при поддержке уведомлений поставщиками, имейте в виду, что в ответ на определенное событие от всех поставщиков хранилищ сообщений не всегда будет получен одинаковый тип уведомления.</span><span class="sxs-lookup"><span data-stu-id="4ed78-108">Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers.</span></span> <span data-ttu-id="4ed78-109">Некоторые поставщики хранилищ сообщений не поддерживают уведомления.</span><span class="sxs-lookup"><span data-stu-id="4ed78-109">Some message store providers do not support notifications at all.</span></span> <span data-ttu-id="4ed78-110">Чтобы определить, поддерживает ли используемое хранилище сообщений уведомление, найдите бит СТОРЕ_НОТИФИ_ОК в его свойстве **пр_сторе_суппорт_маск** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="4ed78-110">To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span>
  
<span data-ttu-id="4ed78-111">В одном конце спектра поставщиков хранилища сообщений, поддерживающих уведомления, поставщики, создающие "Расширенные" уведомления; Эти поставщики отправляют описательные уведомления для всех зарегистрированных источников рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="4ed78-111">At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources.</span></span> <span data-ttu-id="4ed78-112">На другом конце представлены поставщики хранилища сообщений, поддерживающие ограниченные уведомления; Эти поставщики отправляют общие уведомления для ограниченного числа источников рекомендаций.</span><span class="sxs-lookup"><span data-stu-id="4ed78-112">At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources.</span></span> 
  
<span data-ttu-id="4ed78-113">Например, если вы скопировали сообщение в папку, где вы зарегистрировались, чтобы получать уведомления о копировании объектов и объектных перемещений, вы можете или не получить уведомление о копировании объекта.</span><span class="sxs-lookup"><span data-stu-id="4ed78-113">For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification.</span></span> <span data-ttu-id="4ed78-114">Независимо от того, вы не получаете это, зависит от следующих условий:</span><span class="sxs-lookup"><span data-stu-id="4ed78-114">Whether or not you receive it depends on:</span></span>
  
- <span data-ttu-id="4ed78-115">Метод, вызываемый для выполнения копирования.</span><span class="sxs-lookup"><span data-stu-id="4ed78-115">The method that you called to perform the copy.</span></span> <span data-ttu-id="4ed78-116">Это может быть [IMAPIFolder:: копимессажес](imapifolder-copymessages.md), [IMAPIProp:: CopyTo](imapiprop-copyto.md)или [IMAPIProp:: копипропс](imapiprop-copyprops.md).</span><span class="sxs-lookup"><span data-stu-id="4ed78-116">This could be [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md), or [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span>
    
- <span data-ttu-id="4ed78-117">Как поставщик хранилища сообщений реализует метод Copy.</span><span class="sxs-lookup"><span data-stu-id="4ed78-117">How the message store provider implements the copy method.</span></span>
    
- <span data-ttu-id="4ed78-118">Указывает, поддерживает ли поставщик хранилища сообщений уведомления об объектах, скопированных в папки.</span><span class="sxs-lookup"><span data-stu-id="4ed78-118">Whether or not the message store provider supports object copied notifications on folders.</span></span>
    
<span data-ttu-id="4ed78-119">Так как не существует никаких рекомендаций, описывающих, как реализовать уведомления о событиях для поставщиков хранилищ сообщений, клиенты не могут ожидать согласованное поведение.</span><span class="sxs-lookup"><span data-stu-id="4ed78-119">Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior.</span></span> <span data-ttu-id="4ed78-120">MAPI обеспечивает рекомендации по реализации уведомления о событиях поставщиками хранилищ сообщений и приведенной ниже таблице.</span><span class="sxs-lookup"><span data-stu-id="4ed78-120">MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations.</span></span> <span data-ttu-id="4ed78-121">ПроЧтите таблицу следующим образом: после выполнения операции в первом столбце ожидается получение уведомления о типе, указанном во втором столбце, если вы зарегистрировались для этого типа с объектом, указанным в третьем столбце.</span><span class="sxs-lookup"><span data-stu-id="4ed78-121">Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column.</span></span> <span data-ttu-id="4ed78-122">Например, после создания папки вы получите уведомление _фневобжекткреатед_ только в том случае, если вы зарегистрировали уведомления _фневобжекткреатед_ с помощью хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="4ed78-122">For example, after you have created a folder, you will receive an  _fnevObjectCreated_ notification only if you have registered for  _fnevObjectCreated_ notifications with the message store.</span></span> 
  
|<span data-ttu-id="4ed78-123">**Операция**</span><span class="sxs-lookup"><span data-stu-id="4ed78-123">**Operation**</span></span>|<span data-ttu-id="4ed78-124">**Тип события**</span><span class="sxs-lookup"><span data-stu-id="4ed78-124">**Event type**</span></span>|<span data-ttu-id="4ed78-125">**Источник уведомления**</span><span class="sxs-lookup"><span data-stu-id="4ed78-125">**Advise source**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="4ed78-126">Создание папки</span><span class="sxs-lookup"><span data-stu-id="4ed78-126">Create a folder</span></span>  <br/> | <span data-ttu-id="4ed78-127">_Фневобжекткреатед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-127">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="4ed78-128">Хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-128">Message store</span></span>  <br/> |
|<span data-ttu-id="4ed78-129">Удаление папки</span><span class="sxs-lookup"><span data-stu-id="4ed78-129">Delete a folder</span></span>  <br/> | <span data-ttu-id="4ed78-130">_Фневобжектделетед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-130">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="4ed78-131">Удаленная папка хранилища сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-131">Message store Deleted folder</span></span>  <br/> |
|<span data-ttu-id="4ed78-132">Перемещение папки из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="4ed78-132">Move a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="4ed78-133">_Фневобжектмовед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-133">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="4ed78-134">Хранилище сообщений перемещенная папка</span><span class="sxs-lookup"><span data-stu-id="4ed78-134">Message store Moved folder</span></span>  <br/> |
|<span data-ttu-id="4ed78-135">Копирование папки из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="4ed78-135">Copy a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="4ed78-136">_Фневобжекткопиед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-136">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="4ed78-137">Хранилище сообщений и скопированная папка (нет уведомления _фневобжекткреатед_ , отправленного для новой копии папки)</span><span class="sxs-lookup"><span data-stu-id="4ed78-137">Message store and copied folder (no  _fnevObjectCreated_ notification sent for the new copy of the folder)</span></span>  <br/> |
|<span data-ttu-id="4ed78-138">Изменение в свойстве вычисляемой папки (**пр_субфолдерс** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **Пр_контент_унреад** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **пр_контент_каунт** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="4ed78-138">Change in a computed folder property (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> | <span data-ttu-id="4ed78-139">_Фневобжектмодифиед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-139">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="4ed78-140">Хранилище сообщений измененная папка (без уведомления в родительскую папку)</span><span class="sxs-lookup"><span data-stu-id="4ed78-140">Message store Changed folder (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="4ed78-141">Создание сообщения.</span><span class="sxs-lookup"><span data-stu-id="4ed78-141">Create a message</span></span>  <br/> | <span data-ttu-id="4ed78-142">_Фневобжекткреатед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-142">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="4ed78-143">Хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-143">Message store</span></span>  <br/> |
|<span data-ttu-id="4ed78-144">Удаление сообщения, в результате чего изменяется свойство **пр_контент_каунт** родительской папки</span><span class="sxs-lookup"><span data-stu-id="4ed78-144">Delete a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="4ed78-145">_Фневобжектделетед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-145">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="4ed78-146">Сообщение с удаленным хранилищем сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-146">Message store Deleted message</span></span>  <br/> |
|<span data-ttu-id="4ed78-147">Перемещение сообщения из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="4ed78-147">Move a message from one folder to another</span></span>  <br/> | <span data-ttu-id="4ed78-148">_Фневобжектмовед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-148">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="4ed78-149">Сообщение о перемещении хранилища сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-149">Message store Moved message</span></span>  <br/> |
|<span data-ttu-id="4ed78-150">Копирование сообщения из одной папки в другую</span><span class="sxs-lookup"><span data-stu-id="4ed78-150">Copy a message from one folder to another</span></span>  <br/> | <span data-ttu-id="4ed78-151">_Фневобжекткопиед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-151">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="4ed78-152">Сообщение о копировании хранилища сообщений (без уведомлений _фневобжекткреатед_ для новой копии сообщения)</span><span class="sxs-lookup"><span data-stu-id="4ed78-152">Message store Copied message (No  _fnevObjectCreated_ notification for new copy of the message)</span></span>  <br/> |
|<span data-ttu-id="4ed78-153">Сохранение сообщения, в результате чего изменяется свойство **пр_контент_каунт** родительской папки</span><span class="sxs-lookup"><span data-stu-id="4ed78-153">Save a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="4ed78-154">_Фневобжекткреатед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-154">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="4ed78-155">Хранение сообщений только при первом сохранении</span><span class="sxs-lookup"><span data-stu-id="4ed78-155">Message store on first save only</span></span>  <br/> |
|<span data-ttu-id="4ed78-156">Сохранение сообщения</span><span class="sxs-lookup"><span data-stu-id="4ed78-156">Save a message</span></span>  <br/> | <span data-ttu-id="4ed78-157">_Фневобжектмодифиед_</span><span class="sxs-lookup"><span data-stu-id="4ed78-157">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="4ed78-158">Хранилище сообщений при сохранении после первого изменения сохранения (без уведомления для родительской папки)</span><span class="sxs-lookup"><span data-stu-id="4ed78-158">Message store on saves after the first save Changed message (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="4ed78-159">Выполнение операции поиска</span><span class="sxs-lookup"><span data-stu-id="4ed78-159">Complete a search operation</span></span>  <br/> | <span data-ttu-id="4ed78-160">_Фневсеарчкомплете_</span><span class="sxs-lookup"><span data-stu-id="4ed78-160">_fnevSearchComplete_</span></span> <br/> |<span data-ttu-id="4ed78-161">Папка поиска хранилища сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-161">Message store Search folder</span></span>  <br/> |
|<span data-ttu-id="4ed78-162">Новое сообщение</span><span class="sxs-lookup"><span data-stu-id="4ed78-162">New message</span></span>  <br/> | <span data-ttu-id="4ed78-163">_Фневневмаил_</span><span class="sxs-lookup"><span data-stu-id="4ed78-163">_fnevNewMail_</span></span> <br/> |<span data-ttu-id="4ed78-164">Хранилище сообщений</span><span class="sxs-lookup"><span data-stu-id="4ed78-164">Message store</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="4ed78-165">При получении уведомления об изменении объекта Обратите внимание на то, что часть массива тегов свойств структуры [обжект_нотификатион](object_notification.md) , на которую указывает параметр _лпнотификатионс_ в вызове OnNotify, может иметь или не иметь значение null. \*\*\*\*</span><span class="sxs-lookup"><span data-stu-id="4ed78-165">When you receive an object modified notification, remember that the property tag array portion of the [OBJECT_NOTIFICATION](object_notification.md) structure pointed to by the  _lpNotifications_ parameter in the **OnNotify** call may or may not be NULL.</span></span> <span data-ttu-id="4ed78-166">Поставщики хранилища сообщений не являются обязательными для вставки сведений о свойствах в этот массив, и большинство из них нет.</span><span class="sxs-lookup"><span data-stu-id="4ed78-166">Message store providers are not required to insert property information in this array and most do not.</span></span> <span data-ttu-id="4ed78-167">Убедитесь, что \*\*\*\* метод OnNotify может обрабатывать ситуацию, в которой указатель _ЛППРОПТАГАРРАЙ_ имеет значение null.</span><span class="sxs-lookup"><span data-stu-id="4ed78-167">Make sure your **OnNotify** method can handle the case where the  _lpPropTagArray_ pointer is NULL.</span></span> 
  
<span data-ttu-id="4ed78-168">Для большинства (если не все уведомления объектов) обновите представление затронутой папки или папок.</span><span class="sxs-lookup"><span data-stu-id="4ed78-168">For most, if not all object notifications, update the view of the affected folder or folders.</span></span>
  

