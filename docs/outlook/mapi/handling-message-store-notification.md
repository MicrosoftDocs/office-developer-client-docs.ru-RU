---
title: Обработка уведомления о хранилище сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428027"
---
# <a name="handling-message-store-notification"></a>Обработка уведомления о хранилище сообщений
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Чтобы зарегистрироваться для уведомлений магазина сообщений, позвоните по методу [IMAPISession:::Advise](imapisession-advise.md) или [IMsgStore::Advise](imsgstore-advise.md) и укажите в содержимом  _параметра lpEntryID_ хранилище сообщений, папку или идентификатор записи сообщений. Поставщики магазинов сообщений поддерживают уведомления об объектах и таблицах. Регистрация в определенных объектах магазина сообщений, в таблицах иерархии папок и содержимого, описывая эти объекты, или в обоих объектах и таблицах, зависит от уведомлений, которые вы ожидаете увидеть, от вызовов, которые вы делаете для выполнения операций, и от того, как поставщик магазина сообщений поддерживает уведомление. 
  
Поскольку MAPI обеспечивает гибкость в том, как поставщики поддерживают уведомления, следует помнить, что вы не всегда будете получать одно и то же уведомление в ответ на определенное событие от всех поставщиков магазина сообщений. Некоторые поставщики магазинов сообщений вообще не поддерживают уведомления. Чтобы определить, используется ли в хранилище сообщений уведомление о поддержке,  STORE_NOTIFY_OK в свойстве[PR_STORE_SUPPORT_MASK (PidTagStoreSupportMask).](pidtagstoresupportmask-canonical-property.md)
  
На одном конце спектра поставщиков магазинов сообщений, которые поддерживают уведомление, являются поставщиками, которые создают "богатые" уведомления; эти поставщики отправляют описательные уведомления для всех зарегистрированных источников консультаций. На другом конце — поставщики магазинов сообщений, поддерживают ограниченные уведомления; эти поставщики отправляют общие уведомления ограниченному числу источников консультаций. 
  
Например, если вы скопируете сообщение в папку, с которой вы зарегистрировались для получения уведомлений о копировании объектов и перемещении объектов, вы можете получать или не получать уведомления, копированные объектом. Независимо от того, получаете ли вы его, зависит от:
  
- Метод, который вы вызвали для выполнения копии. Это может быть [IMAPIFolder::CopyMessages,](imapifolder-copymessages.md) [IMAPIProp::CopyTo](imapiprop-copyto.md)или [IMAPIProp::CopyProps](imapiprop-copyprops.md).
    
- Как поставщик хранения сообщений реализует метод копирования.
    
- Поддерживает ли поставщик магазина сообщений объектные скопированные уведомления в папках.
    
Так как нет строгих инструкций, описывать, как реализовать уведомление о событиях для поставщиков магазинов сообщений, клиенты не могут ожидать последовательного поведения. MAPI делает рекомендации относительно того, как поставщики магазинов сообщений реализуют уведомление о событиях, а в следующей таблице описаны эти рекомендации. Прочитайте таблицу следующим образом: после выполнения операции в первом столбце ожидайте получения уведомления о типе, перечисленных во втором столбце, если вы зарегистрировались для этого типа с объектом, указанным в третьем столбце. Например, после создания папки вы получите уведомление  _fnevObjectCreated_ только в том случае, если вы зарегистрировались для  _уведомлений fnevObjectCreated_ в хранилище сообщений. 
  
|**Операция**|**Тип события**|**Советы источника**|
|:-----|:-----|:-----|
|Создание папки  <br/> | _fnevObjectCreated_ <br/> |Хранилище сообщений  <br/> |
|Удаление папки  <br/> | _fnevObjectDeleted_ <br/> |Хранилище сообщений Удаленная папка  <br/> |
|Перемещение папки из одной папки в другую  <br/> | _fnevObjectMoved_ <br/> |Хранилище сообщений Перемещенная папка  <br/> |
|Скопируйте папку из одной папки в другую  <br/> | _fnevObjectCopied_ <br/> |Хранилище сообщений и скопированная папка (уведомление  _fnevObjectCreated,_ отправленное для новой копии папки)  <br/> |
|Изменение свойства вычислительной папки **(PR_SUBFOLDERS** [(PidTagSubfolders),](pidtagsubfolders-canonical-property.md) **PR_CONTENT_UNREAD** [(PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** [(PidTagContentCount)](pidtagcontentcount-canonical-property.md)  <br/> | _fnevObjectModified_ <br/> |Хранилище сообщений Измененная папка (нет уведомлений в родительской папке)  <br/> |
|Создание сообщения.  <br/> | _fnevObjectCreated_ <br/> |Хранилище сообщений  <br/> |
|Удаление сообщения, в результате чего в свойстве родительской **папки** PR_CONTENT_COUNT изменения  <br/> | _fnevObjectDeleted_ <br/> |Хранилище сообщений Удаленные сообщения  <br/> |
|Перемещение сообщения из одной папки в другую  <br/> | _fnevObjectMoved_ <br/> |Хранилище сообщений Перемещено сообщение  <br/> |
|Копирование сообщения из одной папки в другую  <br/> | _fnevObjectCopied_ <br/> |Хранилище сообщений Скопированное сообщение (Нет  _уведомления fnevObjectCreated_ для новой копии сообщения)  <br/> |
|Сохранение сообщения, в результате чего в свойстве родительской **папки** PR_CONTENT_COUNT изменения  <br/> | _fnevObjectCreated_ <br/> |Хранилище сообщений только при первом сохранения  <br/> |
|Сохранение сообщения  <br/> | _fnevObjectModified_ <br/> |Хранение сообщений о сохранениях после первого сохранения измененного сообщения (нет уведомления в родительской папке)  <br/> |
|Завершение операции поиска  <br/> | _fnevSearchComplete_ <br/> |Папка поиска в хранилище сообщений  <br/> |
|Новое сообщение  <br/> | _fnevNewMail_ <br/> |Хранилище сообщений  <br/> |
   
> [!NOTE]
> При приеме уведомления об изменениях объекта помните, [](object_notification.md) что часть массива тегов свойств структуры OBJECT_NOTIFICATION, на которую указывает параметр _lpNotifications_ в **вызове OnNotify,** может быть NULL или нет. Поставщики магазинов сообщений не обязаны вставлять сведения о свойстве в этот массив, а большинство — нет. Убедитесь, что метод **OnNotify** может обрабатывать случай, когда указатель  _lpPropTagArray_ является NULL. 
  
Для большинства, если не всех уведомлений об объектах, обновим представление затронутой папки или папок.
  

