---
title: Рекомендации по быстрому завершению работы
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: ae8a9214-e53f-4c57-8dbe-aa7cc6903aa8
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 8c7225427b80d89c6dd8adfa85f7d91885850365
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33426970"
---
# <a name="best-practices-for-fast-shutdown"></a>Рекомендации по быстрому завершению работы

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
В этом разделе приводятся рекомендации для администраторов, клиентов MAPI и поставщиков MAPI для использования параметров реестра Windows и интерфейсов быстрого завершения для минимизации потерь данных при завершении работы клиента.
  
- Чтобы клиент MAPI успешно выполнил быстрое завершение работы, чтобы процессы поставщика не приводили к потере данных, клиент MAPI сначала должен вызвать метод [метод imapiclientshutdown:: QueryFastShutdown](imapiclientshutdown-queryfastshutdown.md) . Затем клиент должен продолжить работу с методами [метод imapiclientshutdown:: нотифипроцессшутдовн](imapiclientshutdown-notifyprocessshutdown.md) и [метод imapiclientshutdown::D офастшутдовн](imapiclientshutdown-dofastshutdown.md) на основе поддержки подсистемы MAPI для быстрого завершения работы, как указано в возвращаемом значении **метод imapiclientshutdown:: QueryFastShutdown**. Как клиент MAPI, Microsoft Outlook не вызывает **метод imapiclientshutdown:: нотифипроцессшутдовн** или **метод imapiclientshutdown::D Офастшутдовн** , если **метод imapiclientshutdown:: QueryFastShutdown** возвращает ошибку. Если администратор отключил быстрое завершение работы в реестре Windows, подсистема MAPI возвратит MAPI_E_NO_SUPPORT в **метод imapiclientshutdown:: QueryFastShutdown**. В этом случае подсистема MAPI не сообщит поставщикам MAPI о завершении немедленного выполнения клиентского процесса. Таким образом, если клиент MAPI игнорирует этот код возврата, переходит к выполнению быстрого завершения работы и отключает все внешние ссылки, все загруженные поставщики MAPI будут иметь потерю данных. 
    
- Поставщики MAPI должны реализовать интерфейс [IMAPIProviderShutdown: IUnknown](imapiprovidershutdowniunknown.md) для выполнения своевременных и необходимых действий во избежание потери данных из-за того, что клиент отключает внешние ссылки перед выходом клиента. Поставщик должен отложить все остальные, несущественные для сохранения данных в основном хранилище данных. Например, поставщик транспорта должен отложить ненужные фоновые операции, которые проверяют наличие новых сообщений, поставщику адресных книг следует отложить загрузку последних изменений с сервера, а поставщик магазина откладывает задачи обслуживания, такие как сжатие или индексирование. 
    
- Пользователи, которые хотят выйти из клиентов MAPI сразу же после их закрытия, должны использовать параметр реестра по умолчанию, который включает быстрое завершение работы, если поставщик не выйдет.
    
- Когда клиент MAPI вызывает **метод imapiclientshutdown::D офастшутдовн**, он не должен выполнять дополнительные вызовы MAPI, в том числе функцию [мапиунинитиализе](mapiuninitialize.md) . Клиент не должен использовать MAPI для оставшейся части жизненного цикла клиентского процесса. 
    
- Клиент MAPI никогда не должен напрямую вызывать интерфейс **IMAPIProviderShutdown** поставщика. Клиенты MAPI всегда должны использовать интерфейс [метод imapiclientshutdown: IUnknown](imapiclientshutdowniunknown.md) . 
    
- Если поставщик MAPI должен гарантировать, что при загрузке функция быстрого завершения работы не используется, она должна реализовать интерфейс **IMAPIProviderShutdown** и возвратить MAPI_E_NO_SUPPORT для метода **IMAPIProviderShutdown:: QueryFastShutdown** . Тем не менее, для клиентов MAPI, таких как Outlook, это приведет к тому, что клиент отменяет быстрое завершение работы и задействует больше времени, чтобы завершить работу. 
    
## <a name="see-also"></a>См. также



[Завершение работы клиента в MAPI](client-shutdown-in-mapi.md)
  
[Обзор быстрого завершения работы](fast-shutdown-overview.md)
  
[Параметры быстрого завершения работы пользователя](fast-shutdown-user-options.md)

