---
title: Рекомендации по быстрому завершению работы
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: ae8a9214-e53f-4c57-8dbe-aa7cc6903aa8
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 8c7225427b80d89c6dd8adfa85f7d91885850365
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33426970"
---
# <a name="best-practices-for-fast-shutdown"></a><span data-ttu-id="8f373-103">Рекомендации по быстрому завершению работы</span><span class="sxs-lookup"><span data-stu-id="8f373-103">Best Practices for Fast Shutdown</span></span>

  
  
<span data-ttu-id="8f373-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="8f373-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="8f373-105">В этом разделе приводятся рекомендации для администраторов, клиентов MAPI и поставщиков MAPI для использования параметров реестра Windows и интерфейсов быстрого завершения для минимизации потерь данных при завершении работы клиента.</span><span class="sxs-lookup"><span data-stu-id="8f373-105">This topic recommends best practices for administrators, MAPI clients, and MAPI providers to use Windows registry settings and the fast shutdown interfaces to minimize data loss during client shutdown.</span></span>
  
- <span data-ttu-id="8f373-106">Чтобы клиент MAPI успешно выполнил быстрое завершение работы, чтобы процессы поставщика не приводили к потере данных, клиент MAPI сначала должен вызвать метод [метод imapiclientshutdown:: QueryFastShutdown](imapiclientshutdown-queryfastshutdown.md) .</span><span class="sxs-lookup"><span data-stu-id="8f373-106">For a MAPI client to carry out fast shutdown successfully so that provider processes do not incur data loss, the MAPI client should first call the [IMAPIClientShutdown::QueryFastShutdown](imapiclientshutdown-queryfastshutdown.md) method.</span></span> <span data-ttu-id="8f373-107">Затем клиент должен продолжить работу с методами [метод imapiclientshutdown:: нотифипроцессшутдовн](imapiclientshutdown-notifyprocessshutdown.md) и [метод imapiclientshutdown::D офастшутдовн](imapiclientshutdown-dofastshutdown.md) на основе поддержки подсистемы MAPI для быстрого завершения работы, как указано в возвращаемом значении **метод imapiclientshutdown:: QueryFastShutdown**.</span><span class="sxs-lookup"><span data-stu-id="8f373-107">The client should then proceed with the [IMAPIClientShutdown::NotifyProcessShutdown](imapiclientshutdown-notifyprocessshutdown.md) and [IMAPIClientShutdown::DoFastShutdown](imapiclientshutdown-dofastshutdown.md) methods based on the MAPI subsystem's support for fast shutdown, as indicated by the return value of **IMAPIClientShutdown::QueryFastShutdown**.</span></span> <span data-ttu-id="8f373-108">Как клиент MAPI, Microsoft Outlook не вызывает **метод imapiclientshutdown:: нотифипроцессшутдовн** или **метод imapiclientshutdown::D Офастшутдовн** , если **метод imapiclientshutdown:: QueryFastShutdown** возвращает ошибку.</span><span class="sxs-lookup"><span data-stu-id="8f373-108">As a MAPI client, Microsoft Outlook does not call **IMAPIClientShutdown::NotifyProcessShutdown** or **IMAPIClientShutdown::DoFastShutdown** if **IMAPIClientShutdown::QueryFastShutdown** returns an error.</span></span> <span data-ttu-id="8f373-109">Если администратор отключил быстрое завершение работы в реестре Windows, подсистема MAPI возвратит MAPI_E_NO_SUPPORT в **метод imapiclientshutdown:: QueryFastShutdown**.</span><span class="sxs-lookup"><span data-stu-id="8f373-109">If the administrator has disabled fast shutdown in the Windows registry, the MAPI subsystem would return MAPI_E_NO_SUPPORT to **IMAPIClientShutdown::QueryFastShutdown**.</span></span> <span data-ttu-id="8f373-110">В этом случае подсистема MAPI не сообщит поставщикам MAPI о завершении немедленного выполнения клиентского процесса.</span><span class="sxs-lookup"><span data-stu-id="8f373-110">In this case, the MAPI subsystem would not inform MAPI providers of an immediate client process exit.</span></span> <span data-ttu-id="8f373-111">Таким образом, если клиент MAPI игнорирует этот код возврата, переходит к выполнению быстрого завершения работы и отключает все внешние ссылки, все загруженные поставщики MAPI будут иметь потерю данных.</span><span class="sxs-lookup"><span data-stu-id="8f373-111">Therefore, if a MAPI client disregards this error return code, proceeds to do fast shutdown, and disconnects all external references, all loaded MAPI providers will have data loss.</span></span> 
    
- <span data-ttu-id="8f373-112">Поставщики MAPI должны реализовать интерфейс [IMAPIProviderShutdown: IUnknown](imapiprovidershutdowniunknown.md) для выполнения своевременных и необходимых действий во избежание потери данных из-за того, что клиент отключает внешние ссылки перед выходом клиента.</span><span class="sxs-lookup"><span data-stu-id="8f373-112">MAPI providers should implement the [IMAPIProviderShutdown : IUnknown](imapiprovidershutdowniunknown.md) interface to carry out timely and necessary steps to avoid data loss due to the client disconnecting external references before the client exits.</span></span> <span data-ttu-id="8f373-113">Поставщик должен отложить все остальные, несущественные для сохранения данных в основном хранилище данных.</span><span class="sxs-lookup"><span data-stu-id="8f373-113">A provider should postpone everything else that is nonessential to saving data to its primary data store.</span></span> <span data-ttu-id="8f373-114">Например, поставщик транспорта должен отложить ненужные фоновые операции, которые проверяют наличие новых сообщений, поставщику адресных книг следует отложить загрузку последних изменений с сервера, а поставщик магазина откладывает задачи обслуживания, такие как сжатие или индексирование.</span><span class="sxs-lookup"><span data-stu-id="8f373-114">For example, a transport provider should postpone unnecessary background operations that check for new mail, an address book provider should postpone downloading recent changes from its server, and a store provider should postpone maintenance tasks such as compacting or indexing.</span></span> 
    
- <span data-ttu-id="8f373-115">Пользователи, которые хотят выйти из клиентов MAPI сразу же после их закрытия, должны использовать параметр реестра по умолчанию, который включает быстрое завершение работы, если поставщик не выйдет.</span><span class="sxs-lookup"><span data-stu-id="8f373-115">Users who want MAPI clients to exit as soon as they close them should use the default registry setting that enables fast shutdown unless a provider opts out.</span></span>
    
- <span data-ttu-id="8f373-116">Когда клиент MAPI вызывает **метод imapiclientshutdown::D офастшутдовн**, он не должен выполнять дополнительные вызовы MAPI, в том числе функцию [мапиунинитиализе](mapiuninitialize.md) .</span><span class="sxs-lookup"><span data-stu-id="8f373-116">Once a MAPI client calls **IMAPIClientShutdown::DoFastShutdown**, it should not make any additional calls to MAPI, including the [MAPIUninitialize](mapiuninitialize.md) function.</span></span> <span data-ttu-id="8f373-117">Клиент не должен использовать MAPI для оставшейся части жизненного цикла клиентского процесса.</span><span class="sxs-lookup"><span data-stu-id="8f373-117">The client should not use MAPI for the rest of the client process's lifetime.</span></span> 
    
- <span data-ttu-id="8f373-118">Клиент MAPI никогда не должен напрямую вызывать интерфейс **IMAPIProviderShutdown** поставщика.</span><span class="sxs-lookup"><span data-stu-id="8f373-118">A MAPI client should never directly call a provider's **IMAPIProviderShutdown** interface.</span></span> <span data-ttu-id="8f373-119">Клиенты MAPI всегда должны использовать интерфейс [метод imapiclientshutdown: IUnknown](imapiclientshutdowniunknown.md) .</span><span class="sxs-lookup"><span data-stu-id="8f373-119">MAPI clients should always use the [IMAPIClientShutdown : IUnknown](imapiclientshutdowniunknown.md) interface.</span></span> 
    
- <span data-ttu-id="8f373-120">Если поставщик MAPI должен гарантировать, что при загрузке функция быстрого завершения работы не используется, она должна реализовать интерфейс **IMAPIProviderShutdown** и возвратить MAPI_E_NO_SUPPORT для метода **IMAPIProviderShutdown:: QueryFastShutdown** .</span><span class="sxs-lookup"><span data-stu-id="8f373-120">If a MAPI provider needs to ensure that fast shutdown is not used while it is loaded, it should implement the **IMAPIProviderShutdown** interface and return MAPI_E_NO_SUPPORT for the **IMAPIProviderShutdown::QueryFastShutdown** method.</span></span> <span data-ttu-id="8f373-121">Тем не менее, для клиентов MAPI, таких как Outlook, это приведет к тому, что клиент отменяет быстрое завершение работы и задействует больше времени, чтобы завершить работу.</span><span class="sxs-lookup"><span data-stu-id="8f373-121">However, for MAPI clients such as Outlook, this will cause the client to abandon fast shutdown and take a longer time to shut down.</span></span> 
    
## <a name="see-also"></a><span data-ttu-id="8f373-122">См. также</span><span class="sxs-lookup"><span data-stu-id="8f373-122">See also</span></span>



[<span data-ttu-id="8f373-123">Завершение работы клиента в MAPI</span><span class="sxs-lookup"><span data-stu-id="8f373-123">Client Shutdown in MAPI</span></span>](client-shutdown-in-mapi.md)
  
[<span data-ttu-id="8f373-124">Обзор быстрого завершения работы</span><span class="sxs-lookup"><span data-stu-id="8f373-124">Fast Shutdown Overview</span></span>](fast-shutdown-overview.md)
  
[<span data-ttu-id="8f373-125">Параметры быстрого завершения работы пользователя</span><span class="sxs-lookup"><span data-stu-id="8f373-125">Fast Shutdown User Options</span></span>](fast-shutdown-user-options.md)

