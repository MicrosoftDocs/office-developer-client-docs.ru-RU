---
title: Открытие хранилища сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 43b23fd7-999a-42c0-8f4d-47f5de266bdb
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 665c14b285db166e4f2a421d46e57f23e2f7ad52
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432375"
---
# <a name="opening-a-message-store"></a>Открытие хранилища сообщений

**Относится к**: Outlook 2013 | Outlook 2016 
  
В зависимости от профиля клиенту потребуется открыть одно или несколько хранилищ сообщений во время типичного сеанса. Открытие хранилища сообщений означает получение доступа к указателю на его реализацию [IMsgStore: IMAPIProp](imsgstoreimapiprop.md) . Интерфейс **IMsgStore** предоставляет методы уведомления, создания назначений папок и доступа к папкам и сообщениям. 
  
Клиенты открывают хранилища сообщений при входе в систему и при изменении профиля. Если клиент разрешает пользователям добавлять в профиль хранилища сообщений во время активного сеанса, вы можете либо открыть их сразу или проигнорировать до следующего сеанса. Регистрируя уведомления в таблице хранилища сообщений, вы получите оповещение о доступности нового хранилища сообщений.
  
Чтобы открыть хранилище сообщений, необходимо иметь доступ к его идентификатору записи. Большинство клиентов обращаются к идентификаторам записей для хранилищ сообщений, которые они хотят открыть через таблицу "хранилище сообщений". Однако в некоторых сообщениях хранятся форматы идентификаторов записей, что позволяет клиентам обходить таблицу хранилища сообщений и создавать необходимый идентификатор записи. Они могут передать этот идентификатор записи непосредственно в [IMAPISession:: опенмсгсторе](imapisession-openmsgstore.md) и MAPI автоматически создает раздел профиля для поставщика, не сопоставляя его со службой сообщений. 
  
## <a name="retrieve-an-entry-identifier-from-the-message-store-table"></a>Получение идентификатора записи из таблицы хранилища сообщений
  
1. Call [IMAPISession:: жетмсгсторестабле](imapisession-getmsgstorestable.md) для открытия таблицы хранилища сообщений. 
    
2. Call **IMAPITable:: метода SetColumns** для ограничения таблицы на небольшой набор столбцов, включающий следующие столбцы: 
    
   - **PR_PROVIDER_DISPLAY** или **PR_DISPLAY_NAME**
   - Свойства **PR_ENTRYID** 
   - **PR_MDB_PROVIDER**
   - **PR_RESOURCE_FLAGS**
    
3. Создайте ограничение, чтобы отфильтровать строку, представляющую хранилище сообщений, которое нужно открыть. Дополнительные сведения о поиске хранилища сообщений по умолчанию содержатся в разделе [Открытие хранилища сообщений по умолчанию](opening-the-default-message-store.md). Чтобы найти хранилище сообщений по имени, примените следующие ограничения свойств.
    
   - Сопоставьте **PR_PROVIDER_DISPLAY** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md)) с общим именем этого типа хранилища сообщений. Например, для PR_PROVIDER_DISPLAY может быть задано значение "личные папки".
    
   - Сопоставьте **PR_MDB_PROVIDER** ([PidTagStoreProvider](pidtagstoreprovider-canonical-property.md)) с конкретным **мапиуид** для этого типа хранилища сообщений. 
    
   - Сопоставьте **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) с именем конкретного хранилища сообщений. Например, для **PR_DISPLAY_NAME** может быть задано значение "Мои сообщения для финансового года 2010". 
    
4. Вызовите [хркуеряллровс](hrqueryallrows.md) , чтобы получить соответствующую строку из таблицы хранилища сообщений. Идентификатор записи для строки будет включен в массив значений свойства для элемента **аров** в наборе строк, на который указывает параметр _ппровс_ . 
    
5. Вызовите [фрипровс](freeprows.md) , чтобы освободить набор строк, на который указывает _ппровс_.
    
6. Освободите таблицу хранилища сообщений, вызвав метод **IUnknown:: Release** . 
    
Если для открытия хранилища сообщений создан настраиваемый идентификатор записи, вызовите функцию [врапсторинтрид](wrapstoreentryid.md) , чтобы преобразовать ее в стандартный идентификатор записи. 
  
После создания идентификатора записи хранилища сообщений вызовите один из следующих методов, чтобы открыть его:
  
- [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)
- [IMAPISession::OpenEntry](imapisession-openentry.md)
    
Вызовите **опенмсгсторе** , если вам нужно указать различные специальные параметры для хранилища сообщений. **Опенмсгсторе** позволяет запретить отображение диалоговых окон, определить хранилище сообщений как временное или необменный, задать уровни доступа и отложить ошибки. **OpenEntry** позволяет только задавать уровни доступа и откладывать ошибки. 
  
Установка флага MDB_NO_MAIL означает, что хранилище сообщений не будет использоваться для отправки и получения сообщений. MAPI не уведомляет Диспетчер очереди MAPI о существовании этого хранилища сообщений. Флаг MDB_TEMPORARY определяет хранилище сообщений как временное, предподразумевая, что он не может использоваться для хранения постоянной информации. Временные хранилища сообщений не отображаются в таблице хранилища сообщений. 
  
## <a name="see-also"></a>См. также

- [IMAPITable::SetColumns](imapitable-setcolumns.md)

