---
title: Открытие хранилища сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 43b23fd7-999a-42c0-8f4d-47f5de266bdb
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 665c14b285db166e4f2a421d46e57f23e2f7ad52
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432375"
---
# <a name="opening-a-message-store"></a>Открытие хранилища сообщений

**Область применения**: Outlook 2013 | Outlook 2016 
  
В зависимости от профиля клиенту необходимо открыть один или несколько магазинов сообщений во время обычного сеанса. Открытие магазина сообщений означает получение доступа к указателю для реализации [IMsgStore: IMAPIProp.](imsgstoreimapiprop.md) Интерфейс **IMsgStore** предоставляет методы уведомлений, выполнения назначений папок и доступа к папок и сообщений. 
  
Клиенты открывают хранилища сообщений в logon и при внесении изменений в профиль. Если клиент позволяет пользователям добавлять в профиль хранилища сообщений во время активного сеанса, их можно открыть немедленно или игнорировать до следующего сеанса. Зарегистрировавшись для уведомлений на таблице хранения сообщений, вы будете оповещены о доступности нового магазина сообщений.
  
Чтобы открыть хранилище сообщений, необходимо иметь его идентификатор записи. Большинство клиентов имеют доступ к идентификаторам записей для хранения сообщений, которые они хотят открыть в таблице хранилища сообщений. Однако некоторые хранилища сообщений документировать формат идентификаторов записи, что позволяет клиентам обойти таблицу хранения сообщений и создать необходимый идентификатор записи. Они могут передать этот идентификатор записи непосредственно [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) и MAPI автоматически создает раздел профилей для поставщика, не связывая его с какой-либо службой сообщений. 
  
## <a name="retrieve-an-entry-identifier-from-the-message-store-table"></a>Извлечение идентификатора записи из таблицы хранения сообщений
  
1. Вызов [IMAPISession::GetMsgStoresTable,](imapisession-getmsgstorestable.md) чтобы открыть таблицу хранения сообщений. 
    
2. Вызов **IMAPITable::SetColumns,** чтобы ограничить таблицу небольшим набором столбцов, который включает следующие столбцы: 
    
   - **PR_PROVIDER_DISPLAY** **или PR_DISPLAY_NAME**
   - **PR_ENTRYID** свойства 
   - **PR_MDB_PROVIDER**
   - **PR_RESOURCE_FLAGS**
    
3. Создайте ограничение, чтобы отфильтровать строку, представляюную открытый хранилище сообщений. Дополнительные сведения о поиске магазина сообщений по умолчанию см. в [тексте Открытие магазина](opening-the-default-message-store.md)сообщений по умолчанию. Чтобы найти хранилище сообщений по имени, применяем любое из следующих ограничений свойств:
    
   - Match **PR_PROVIDER_DISPLAY** [(PidTagProviderDisplay)](pidtagproviderdisplay-canonical-property.md)с общим именем для этого типа магазина сообщений. Например, PR_PROVIDER_DISPLAY можно настроить на "Личные папки".
    
   - Соответствие **PR_MDB_PROVIDER** [(PidTagStoreProvider)](pidtagstoreprovider-canonical-property.md)с определенным **MAPIUID** для этого типа магазина сообщений. 
    
   - Match **PR_DISPLAY_NAME** [(PidTagDisplayName)](pidtagdisplayname-canonical-property.md)с именем этого конкретного магазина сообщений. Например, **PR_DISPLAY_NAME** может быть установлено "Мои сообщения для 2010 финансового года". 
    
4. Позвоните [в HrQueryAllRows,](hrqueryallrows.md) чтобы получить соответствующую строку из таблицы хранения сообщений. Идентификатор записи для строки будет включен в массив значений свойств для **члена строки aRow,** на который указывает параметр _pprows._ 
    
5. Вызовите [FreeProws,](freeprows.md) чтобы освободить набор строк, на который указывают _pprows._
    
6. Освободите таблицу хранения сообщений, назвав метод **IUnknown::Release.** 
    
Если для открытия магазина сообщений создан настраиваемый идентификатор входа, позвоните в функцию [WrapStoreEntryID,](wrapstoreentryid.md) чтобы преобразовать ее в стандартный идентификатор входа. 
  
После того как у вас есть идентификатор входа в хранилище сообщений, позвоните одному из следующих методов, чтобы открыть его:
  
- [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)
- [IMAPISession::OpenEntry](imapisession-openentry.md)
    
Позвоните **в OpenMsgStore,** если необходимо указать различные специальные параметры для магазина сообщений. **OpenMsgStore** позволяет подавлять отображение диалогов, определять хранилище сообщений как временный или немессинговый магазин, устанавливать уровни доступа и откладывать ошибки. **OpenEntry** позволяет только устанавливать уровни доступа и откладывать ошибки. 
  
Установка флага MDB_NO_MAIL указывает MAPI на то, что хранилище сообщений не будет использоваться для отправки или получения сообщений. MAPI не информирует шпалер MAPI о существовании этого магазина сообщений. Флаг MDB_TEMPORARY обозначает хранилище сообщений как временный, подразумевая, что он не может использоваться для хранения постоянной информации. Временные хранилища сообщений не отображаются в таблице хранилища сообщений. 
  
## <a name="see-also"></a>См. также

- [IMAPITable::SetColumns](imapitable-setcolumns.md)

