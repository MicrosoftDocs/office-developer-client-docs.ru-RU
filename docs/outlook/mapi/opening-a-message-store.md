---
title: Открытие хранилища сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 43b23fd7-999a-42c0-8f4d-47f5de266bdb
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 39d6df6db329abf7509f816165341ea0eda8331b
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19810049"
---
# <a name="opening-a-message-store"></a>Открытие хранилища сообщений

**Относится к**: Outlook 
  
В зависимости от профиля клиент будет должны быть открыты один или несколько хранилищ сообщений во время обычной сеанса. Открытие хранилища сообщение означает, что доступ к указатель на его [IMsgStore: IMAPIProp](imsgstoreimapiprop.md) реализации. Интерфейс **IMsgStore** предоставляет методы для уведомления о назначении папки и доступа к папкам и сообщениям. 
  
Клиенты откройте хранилищ сообщений при входе в систему и при изменении профиля. Если клиент позволяет пользователям добавлять к профилю хранилищ сообщений во время активного сеанса, можно открыть их сразу же или игнорировать их до следующего сеанса. Путем регистрации уведомлений на таблице хранилища сообщений будут оповещены доступности нового хранилища сообщений.
  
Чтобы открыть хранилище сообщений, необходимо иметь его доступные идентификатор записи. Большинство клиентов доступ к идентификаторы записей для хранилищ сообщений, которые следует открыть через таблицы хранилища сообщений. Тем не менее некоторые сообщения сохранение документов формата их идентификаторы записей, благодаря чему клиенты для обхода в таблице хранилища сообщений и создать идентификатор необходимые записи. Их можно передать этот идентификатор записи непосредственно к [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) и MAPI автоматически создает профиля для поставщика без сопоставления его с любого службы сообщений. 
  
## <a name="retrieve-an-entry-identifier-from-the-message-store-table"></a>Получить идентификатор записи в таблице хранилища сообщений
  
1. Вызов [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) открыть таблицу хранилища сообщений. 
    
2. Вызовите **IMAPITable::SetColumns** для ограничения в таблице в набор небольшой столбец, который включает в себя следующие столбцы: 
    
   - **PR_PROVIDER_DISPLAY** или **PR_DISPLAY_NAME**
   - Свойства **PR_ENTRYID** 
   - **PR_MDB_PROVIDER**
   - **PR_RESOURCE_FLAGS**
    
3. Создание ограничения для фильтрации строку, которая представляет хранилище сообщений для открытия. Дополнительные сведения о поиске хранилище сообщений по умолчанию в разделе [Открытие хранилище сообщений по умолчанию](opening-the-default-message-store.md). Для поиска по имени хранилища сообщений, применяются любые из следующих ограничений:
    
   - Совпадение. **PR_PROVIDER_DISPLAY** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md)) общее имя для этого типа хранилища сообщений. Например PR_PROVIDER_DISPLAY может иметь значение «Личные папки».
    
   - Соответствие **PR_MDB_PROVIDER** ([PidTagStoreProvider](pidtagstoreprovider-canonical-property.md)) с определенным **MAPIUID** для этого типа хранилища сообщений. 
    
   - Соответствие **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) с именем для конкретного хранилища. Например **PR_DISPLAY_NAME** может иметь значение «Мои сообщения, 2010 финансовый год». 
    
4. Вызов [HrQueryAllRows](hrqueryallrows.md) для извлечения соответствующую строку из таблицы хранилища сообщений. Идентификатор записи строки будут включены в массиве значение свойства для элемента **aRow** набор строк, на который указывает параметр _pprows_ . 
    
5. Вызовите [FreeProws](freeprows.md) , чтобы освободить место на набор строк, на который указывает _pprows_.
    
6. В таблице хранилища сообщений путем вызова метода **функции IUnknown::Release** выпуска. 
    
Если были созданы идентификатор настраиваемого запись для хранилища сообщений для открытия, вызовите функцию [WrapStoreEntryID](wrapstoreentryid.md) для преобразования его в стандартной записи идентификатор. 
  
После того как идентификатор записи хранилища сообщений, вызовите один из следующих методов, чтобы открыть ее:
  
- [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)
- [IMAPISession::OpenEntry](imapisession-openentry.md)
    
Вызовите **OpenMsgStore** , если необходимо указать различные специальные параметры для хранилища сообщений. **OpenMsgStore** позволяет отключить отображение диалоговых окон, определите хранилище сообщений, как временный или nonmessaging хранения набора уровни доступа и отложите ошибки. **OpenEntry** позволяет только задать уровни доступа и отложите ошибки. 
  
Установка MDB_NO_MAIL флаг указывает MAPI, что хранилище сообщений не будет использоваться для отправки и получения сообщений. MAPI не информирует диспетчер очереди MAPI о существовании хранилища. Флаг MDB_TEMPORARY назначает хранилищем сообщений временно, подразумевает, что он не может использоваться для хранения постоянных данных. Сохранение временных сообщений не отображаются в таблице хранилища сообщений. 
  
## <a name="see-also"></a>См. также

- [IMAPITable::SetColumns](imapitable-setcolumns.md)

