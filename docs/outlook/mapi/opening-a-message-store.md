---
title: Открытие хранилища сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 43b23fd7-999a-42c0-8f4d-47f5de266bdb
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 665c14b285db166e4f2a421d46e57f23e2f7ad52
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432375"
---
# <a name="opening-a-message-store"></a>Открытие хранилища сообщений

**Относится к**: Outlook 2013 | Outlook 2016 
  
В зависимости от профиля клиенту потребуется открыть одно или несколько хранилищ сообщений во время обычного сеанса. Открытие хранилищ сообщений означает получение доступа к указателю на его [реализацию IMsgStore : IMAPIProp.](imsgstoreimapiprop.md) Интерфейс **IMsgStore** предоставляет методы для уведомлений, назначения папок и доступа к папок и сообщений. 
  
Клиенты открывают хранилища сообщений при их в логотипе и при внесении изменений в профиль. Если клиент позволяет пользователям добавлять хранилища сообщений в профиль во время активного сеанса, их можно открыть немедленно или игнорировать до следующего сеанса. Зарегистрировавшись для получения уведомлений в таблице хранения сообщений, вы будете предупреждены о доступности нового хранения сообщений.
  
Чтобы открыть хранилище сообщений, необходимо иметь его идентификатор записи. Большинство клиентов имеют доступ к идентификаторам записей для хранилищ сообщений, которые они хотят открыть в таблице хранилища сообщений. Однако в некоторых сообщениях хранится формат идентификаторов записей, что позволяет клиентам обходить таблицу хранилища сообщений и создавать необходимый идентификатор записи. Они могут передавать этот идентификатор записи непосредственно в [IMAPISession::OpenMsgStore,](imapisession-openmsgstore.md) и MAPI автоматически создает раздел профиля для поставщика, не связывая его со службой сообщений. 
  
## <a name="retrieve-an-entry-identifier-from-the-message-store-table"></a>Извлечение идентификатора записи из таблицы хранения сообщений
  
1. Вызовите [IMAPISession::GetMsgStoresTable,](imapisession-getmsgstorestable.md) чтобы открыть таблицу хранения сообщений. 
    
2. Вызовите **IMAPITable::SetColumns,** чтобы ограничить таблицу небольшим набором столбцов, который включает следующие столбцы: 
    
   - **PR_PROVIDER_DISPLAY** или **PR_DISPLAY_NAME**
   - **PR_ENTRYID** свойств 
   - **PR_MDB_PROVIDER**
   - **PR_RESOURCE_FLAGS**
    
3. Создайте ограничение, чтобы отфильтровать строку, представляюную хранилище сообщений, которое необходимо открыть. Дополнительные сведения о поиске хранения сообщений по умолчанию см. в [открываемом хранилище сообщений по умолчанию.](opening-the-default-message-store.md) Чтобы найти хранилище сообщений по имени, применим любое из следующих ограничений свойств:
    
   - Сопо **PR_PROVIDER_DISPLAY** ([PidTagProviderDisplay)](pidtagproviderdisplay-canonical-property.md)с общим именем для этого типа хранения сообщений. Например, PR_PROVIDER_DISPLAY "Личные папки".
    
   - Соответствие **PR_MDB_PROVIDER** [(PidTagStoreProvider)](pidtagstoreprovider-canonical-property.md)с **определенным MAPIUID** для этого типа хранилищ сообщений. 
    
   - Сопо **PR_DISPLAY_NAME** ([PidTagDisplayName)](pidtagdisplayname-canonical-property.md)с именем для этого конкретного хранения сообщений. Например,  PR_DISPLAY_NAME "Мои сообщения для финансового года 2010". 
    
4. Вызовите [HrQueryAllRows,](hrqueryallrows.md) чтобы извлечь соответствующую строку из таблицы хранения сообщений. Идентификатор записи для строки будет включен в массив значений свойств для члена **aRow** набора строк, на который указывает параметр _pprows._ 
    
5. Вызовите [FreeProws,](freeprows.md) чтобы освободить набор строк, на который указывает _pprows._
    
6. Освободите таблицу хранения сообщений, вызывая метод **IUnknown::Release.** 
    
Если вы создали пользовательский идентификатор записи для открытия хранилищ сообщений, вызовите функцию [WrapStoreEntryID,](wrapstoreentryid.md) чтобы преобразовать его в стандартный идентификатор записи. 
  
После того как у вас есть идентификатор записи в хранилище сообщений, вызовите один из следующих методов, чтобы открыть его:
  
- [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)
- [IMAPISession::OpenEntry](imapisession-openentry.md)
    
Вызовите **OpenMsgStore,** если необходимо указать различные специальные параметры для хранения сообщений. **OpenMsgStore** позволяет подавлять отображение диалогов, определять хранилище сообщений как временное или несекционное, устанавливать уровни доступа и откладывать ошибки. **OpenEntry** позволяет устанавливать только уровни доступа и откладывать ошибки. 
  
Установка флага MDB_NO_MAIL указывает mapI, что хранилище сообщений не будет использоваться для отправки или получения сообщений. MAPI не сообщает пулу MAPI о существовании этого хранилище сообщений. Флаг MDB_TEMPORARY обозначает хранилище сообщений как временное, подразумевая, что его нельзя использовать для хранения постоянной информации. Временные хранилища сообщений не отображаются в таблице хранилища сообщений. 
  
## <a name="see-also"></a>См. также

- [IMAPITable::SetColumns](imapitable-setcolumns.md)

