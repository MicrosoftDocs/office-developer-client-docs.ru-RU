---
title: Разработка поставщика TNEF-Enabled транспорта
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439004"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a>Разработка поставщика TNEF-Enabled транспорта

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Для обеспечения взаимодействия между системами обмена сообщениями, которые поддерживают различные наборы функций MAPI, MAPI предоставляет формат транспортной нейтральной инкапсуляции (TNEF) в качестве стандартного способа передачи данных. Этот формат инкапсулирует свойства MAPI, не поддерживаемые системой обмена сообщениями, в двоичный поток, который можно перенести вместе с сообщением при отправке его поставщиком транспорта. Поставщик транспорта, который получает сообщение, может расшифровать двоичный поток, чтобы получить все свойства исходного сообщения и сделать их доступными для клиентских приложений. Операционная модель TNEF:
  
- Клиенты обмена сообщениями представляют и получают сообщения в транспорт TNEF в обычном режиме.
    
- Транспорт разделяет свойства исходяющих сообщений на две категории: свойства, поддерживаемые системой сообщений, и свойства, которые она не поддерживает. Значения свойств, поддерживаемых системой обмена сообщениями, переводятся в требуемом формате.
    
- Транспорт использует методы TNEF MAPI для кодирования любых неподдержных свойств в единый поток данных. Затем транспорт перед отправкой сообщения превращает поток данных в специальное вложение в исходяние сообщения с помощью модели вложений системы обмена сообщениями.
    
- Транспорт С поддержкой TNEF, который получает такое сообщение, делает две вещи. Во-первых, он преобразует свойства входящих сообщений , поддерживаемые системой сообщений, в свойства MAPI. Во-вторых, если специальное вложение присутствует, он использует методы MAPI TNEF для получения дополнительных свойств MAPI из вложения перед доставкой сообщения в клиентском приложении.
    
MAPI обеспечивает реализацию интерфейса **ITnef** для использования поставщиками транспорта MAPI при работе с объектами TNEF. Функция [OpenTnefStreamEx](opentnefstreamex.md) используется для создания объектов TNEF и связывать их с сообщением. Потоки TNEF построены поверх интерфейса OLE **IStream** 
  
> [!NOTE]
> Вы используете **OpenTnefStreamEx** для создания объектов TNEF. Старая функция **OpenTnefStream** по-прежнему существует для совместимости со старым исходным кодом и не должна использоваться ни в чем новом. 
  
Интерфейс **ITnef** предоставляет следующие методы: 
  
- [AddProps](itnef-addprops.md)
    
- [EncodeRecips](itnef-encoderecips.md)
    
- [ExtractProps](itnef-extractprops.md)
    
- [Finish](itnef-finish.md)
    
- [FinishComponent](itnef-finishcomponent.md)
    
- [OpenTaggedBody](itnef-opentaggedbody.md)
    
- [SetProps](itnef-setprops.md)
    
Модель реализации MAPI TNEF поддерживает:
  
- Все свойства MAPI без влияния на другие свойства сообщений. Чтобы сообщения MAPI выживали при транспортировке через систему обмена сообщениями, необходимо инкапсулировать все свойства, которые не могут быть закодированы в качестве свойств системы обмена сообщениями. Так как во время отправки сообщения почти никогда не известно, получит ли клиент, совместимый с MAPI, схема инкапсуляции позволяет поставщику транспорта кодировать только те свойства сообщений MAPI, которые система обмена сообщениями не поддерживает. Это означает, что сообщения, которые используют TNEF, не являются "непрозрачной" для систем обмена сообщениями, которые не основаны на MAPI, таких как SMTP-UNIX системы обмена сообщениями. Эти системы получают свойства, поддерживаемые ими в любом типичном для них порядке, а другие свойства получаются в виде закодированного потока данных TNEF. Поставщик транспорта TNEF отвечает за дифференциации между этими двумя наборами свойств и отправку поддерживаемого набора надлежащим образом для системы обмена сообщениями. TNEF не делает предположений по уровню поддержки, предоставляемой системой обмена сообщениями. Однако в примерах использования TNEF, включенных в этот раздел, делается предположение, что система обмена сообщениями поддерживает хотя бы одно вложение помимо сообщения. В некоторых случаях вложение может поддерживаться только через поток uuencoded и передаваться как часть текста сообщения. Только в очень редких случаях система обмена сообщениями будет иметь так мало поддержки свойств сообщений, что требуется полное кодификат TNEF всех свойств.
    
- Механизм определения того, принадлежит ли поток TNEF для входящих сообщений сообщению на основе свойства MAPI **PR_TNEF_CORRELATION_KEY** [(PidTagTnefCorrelationKey).](pidtagtnefcorrelationkey-canonical-property.md) Это свойство должно быть найдено как в потоке TNEF, так и в соответствующем загоне сообщений. Если свойство имеет одинаковое значение в обоих местах или отсутствует в любом месте, предполагается, что поток TNEF принадлежит сообщению. В противном случае поток TNEF игнорируется. Транспорты с включенной поддержкой TNEF отвечают за выбор значения для этого свойства в исходящие сообщения и кодировать его в соответствующем загоне сообщений (например, Message-ID: header for SMTP messages) и в потоке TNEF.
    

