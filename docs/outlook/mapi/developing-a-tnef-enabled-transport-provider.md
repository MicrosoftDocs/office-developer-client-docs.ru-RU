---
title: Разработка поставщика транспорта с поддержкой TNEF
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439004"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a>Разработка поставщика транспорта с поддержкой TNEF

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Для повышения совместимости между системами обмена сообщениями, которые поддерживают различные наборы функций MAPI, MAPI предоставляет стандартный способ передачи данных в формате TNEF. Этот формат инкапсулирует свойства MAPI, которые не поддерживаются базовой системой обмена сообщениями, в двоичный поток, который можно передать вместе с сообщением, когда поставщик транспорта отправляет его. Поставщик транспорта, который получает сообщение, может декодировать двоичный поток, чтобы получить все свойства исходного сообщения и сделать их доступными для клиентских приложений. Рабочая модель для TNEF состоит из следующих компонентов:
  
- Клиенты обмена сообщениями отправляют и получают сообщения в транспорт TNEF обычным образом.
    
- Транспорт разделяет свойства исходящих сообщений на две категории: те, которые поддерживаются в базовой системе сообщений, и те, которые не поддерживаются. Значения свойств, которые поддерживаются базовой системой обмена сообщениями, преобразуются в требуемый формат.
    
- Транспорт использует методы MAPI TNEF для кодирования всех неподдерживаемых свойств в один поток данных. Затем транспортный поток данных преобразуется в специальное вложение исходящего сообщения с использованием модели вложений базовой системы обмена сообщениями перед отправкой сообщения.
    
- Транспортный транспорт с включенной поддержкой TNEF, который получает такое сообщение, выполняет две задачи. Во-первых, он преобразует свойства входящего сообщения, которые поддерживаются базовой системой обработки сообщений, в свойства MAPI. Во-вторых, если присутствует специальное вложение, он использует методы MAPI TNEF для получения дополнительных свойств MAPI из вложения перед доставкой сообщения клиентскому приложению.
    
MAPI предоставляет реализацию интерфейса **итнеф** для использования поставщиками транспорта MAPI при работе с объектами TNEF. Функция [опентнефстреамекс](opentnefstreamex.md) используется для создания объектов TNEF и связывания их с сообщением. Потоки TNEF построены поверх интерфейса OLE **IStream** 
  
> [!NOTE]
> С помощью **опентнефстреамекс** можно создавать объекты TNEF. Старая функция **опентнефстреам** по-прежнему существует для совместимости со старым исходным кодом и не должна использоваться ни в каких новых. 
  
Интерфейс **итнеф** предоставляет следующие методы: 
  
- [аддпропс](itnef-addprops.md)
    
- [енкодереЦипс](itnef-encoderecips.md)
    
- [екстрактпропс](itnef-extractprops.md)
    
- [Finish](itnef-finish.md)
    
- [финишкомпонент](itnef-finishcomponent.md)
    
- [опентагжедбоди](itnef-opentaggedbody.md)
    
- [SetProps](itnef-setprops.md)
    
Модель реализации MAPI TNEF поддерживает:
  
- Все свойства MAPI, не затрагивая другие свойства сообщения. Чтобы сообщения MAPI могли выдерживать транспорт через систему обмена сообщениями, все свойства, которые не могут быть закодированы как свойства системы обмена сообщениями, должны быть инкапсулированы. Так как он почти никогда не известен, когда сообщение отправляется независимо от того, будет ли получено сообщение от MAPI-совместимого клиента, схема инкапсуляции позволяет поставщику транспорта кодировать только те свойства сообщения MAPI, которые не поддерживаются системой обмена сообщениями. Это означает, что сообщения, использующие формат TNEF, не могут быть непрозрачными для систем обмена сообщениями, не основанных на MAPI, таких как системы обмена сообщениями UNIX на основе SMTP. Эти системы получают свойства, которые они поддерживают, как правило, и другие свойства принимаются как закодированный поток данных TNEF. Поставщик транспорта TNEF отвечает за различие между этими двумя наборами свойств и отправку поддерживаемого набора правильным способом для системы обмена сообщениями. В формате TNEF нет допущений по уровню поддержки, предоставляемым системой обмена сообщениями. Однако в примерах использования TNEF, включенных в этот раздел, предполагается, что система обмена сообщениями поддерживает по крайней мере одно вложение, не связанное с сообщением. В некоторых случаях вложение поддерживается только через поток ууенкодед и передается как часть текста сообщения. В очень редких обстоятельствах система обмена сообщениями будет иметь небольшую поддержку свойств сообщений, которые необходимы для полной кодировки TNEF для всех свойств.
    
- Механизм определения того, принадлежит ли поток TNEF входящего сообщения к сообщению, на основе свойства MAPI **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)). Это свойство должно быть найдено как в потоке TNEF, так и в соответствующем заголовке сообщения. Если свойство имеет одно и то же значение в обоих местах или отсутствует в любом месте, предполагается, что поток TNEF принадлежит этому сообщению. В противном случае поток TNEF игнорируется. Транспорты с включенной поддержкой TNEF отвечают за выбор значения этого свойства для исходящих сообщений и их кодирование в соответствующем заголовке сообщения (например, заголовок Message-ID: заголовок для SMTP-сообщений) и в потоке TNEF.
    

