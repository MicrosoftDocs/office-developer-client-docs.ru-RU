---
title: Разработка поставщика TNEF-Enabled транспорта
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439004"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a>Разработка поставщика TNEF-Enabled транспорта

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Для обеспечения взаимодействия между системами обмена сообщениями, которые поддерживают различные наборы функций MAPI, MAPI предоставляет формат TNEF в качестве стандартного способа передачи данных. Этот формат инкапсулирует свойства MAPI, не поддерживаемые системой обмена сообщениями, в двоичный поток, который можно передать вместе с сообщением, когда поставщик транспорта отправляет его. Затем поставщик транспорта, который получает сообщение, может декодировать двоичный поток, чтобы получить все свойства исходного сообщения и сделать их доступными для клиентских приложений. Операционная модель для TNEF:
  
- Клиенты обмена сообщениями обычно получают сообщения на TNEF-транспорт.
    
- Транспорт разделяет свойства исходяющих сообщений на две категории: те, которые поддерживаются системой сообщений, и те, которые не поддерживаются. Значения свойств, поддерживаемых системой обмена сообщениями, преобразуются в требуемом формате.
    
- Транспорт использует методы MAPI TNEF для кодирования любых неподдержных свойств в один поток данных. Затем транспорт превращает поток данных в специальное вложение в исходяском сообщении, используя модель вложений системы обмена сообщениями, перед отправкой сообщения.
    
- Транспорт с поддержкой TNEF, который получает такое сообщение, делает две вещи. Во-первых, он преобразует свойства входящих сообщений ( те, которые поддерживаются в системе сообщений) в свойства MAPI. Во-вторых, если присутствует специальное вложение, оно использует методы MAPI TNEF для получения дополнительных свойств MAPI из вложения перед доставкой сообщения в клиентском приложении.
    
MAPI обеспечивает реализацию **интерфейса ITnef** для использования поставщиками транспорта MAPI при работе с объектами TNEF. Функция [OpenTnefStreamEx](opentnefstreamex.md) используется для создания объектов TNEF и связываия их с сообщением. Потоки TNEF построены на основе интерфейса OLE **IStream** 
  
> [!NOTE]
> **OpenTnefStreamEx используется** для создания объектов TNEF. Старая функция **OpenTnefStream** по-прежнему существует для совместимости со старым исходным кодом и не должна использоваться ни в чем новом. 
  
Интерфейс **ITnef** предоставляет следующие методы: 
  
- [AddProps](itnef-addprops.md)
    
- [EncodeRecips](itnef-encoderecips.md)
    
- [ExtractProps](itnef-extractprops.md)
    
- [Finish](itnef-finish.md)
    
- [FinishComponent](itnef-finishcomponent.md)
    
- [OpenTaggedBody](itnef-opentaggedbody.md)
    
- [SetProps](itnef-setprops.md)
    
Модель реализации MAPI TNEF поддерживает:
  
- Все свойства MAPI без влияния на другие свойства сообщений. Чтобы сообщения MAPI сохранились при передаче через систему обмена сообщениями, необходимо инкапсулировать все свойства, которые не могут быть закодированы как свойства системы обмена сообщениями. Так как во время отправки сообщения почти никогда не известно, будет ли сообщение получать клиент, совместимый с MAPI, схема инкапсуляции позволяет поставщику транспорта кодировать только те свойства сообщений MAPI, которые система обмена сообщениями не поддерживает. Это означает, что сообщения, в которых используется TNEF, не являются непрозрачной для систем обмена сообщениями, не основанных на MAPI, таких как smTP-UNIX системы обмена сообщениями. Эти системы получают поддерживаемые свойства обычным для них способом, а другие свойства получаются в виде закодированного потока данных TNEF. Поставщик транспорта TNEF отвечает за разлиение этих двух наборов свойств и отправку поддерживаемого набора надлежащим образом для системы обмена сообщениями. В TNEF не делается предположений об уровне поддержки, предоставляемой системой обмена сообщениями. Однако в примерах использования TNEF, включенных в этот раздел, делается допущение, что система обмена сообщениями поддерживает хотя бы одно вложение, кроме сообщения. В некоторых случаях вложение может поддерживаться только через поток uuencoded и передаваться как часть текста сообщения. Только в очень редких случаях система обмена сообщениями будет иметь настолько мало поддержки свойств сообщений, что необходима полная кодивка всех свойств в TNEF.
    
- Механизм определения того, принадлежит ли поток TNEF для входящих сообщений сообщению на основе свойства MAPI **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey).](pidtagtnefcorrelationkey-canonical-property.md) Это свойство должно быть найдено как в потоке TNEF, так и в соответствующем загоне сообщения. Если свойство имеет одинаковое значение в обоих местах или отсутствует в обоих местах, предполагается, что поток TNEF принадлежит сообщению. В противном случае поток TNEF игнорируется. Транспорты с поддержкой TNEF отвечают за выбор значения для этого свойства в исходящие сообщения и его код в соответствующем загоне сообщения (например, message-ID: header for SMTP messages) и в потоке TNEF.
    

