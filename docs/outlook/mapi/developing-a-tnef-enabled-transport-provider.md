---
title: Разработка поставщика транспорта с поддержкой TNEF
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439004"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a><span data-ttu-id="42f5d-103">Разработка поставщика транспорта с поддержкой TNEF</span><span class="sxs-lookup"><span data-stu-id="42f5d-103">Developing a TNEF-Enabled Transport Provider</span></span>

  
  
<span data-ttu-id="42f5d-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="42f5d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="42f5d-105">Для повышения совместимости между системами обмена сообщениями, которые поддерживают различные наборы функций MAPI, MAPI предоставляет стандартный способ передачи данных в формате TNEF.</span><span class="sxs-lookup"><span data-stu-id="42f5d-105">To promote interoperability between messaging systems that support different sets of MAPI features, MAPI provides the Transport Neutral Encapsulation Format (TNEF) as a standard way to transfer data.</span></span> <span data-ttu-id="42f5d-106">Этот формат инкапсулирует свойства MAPI, которые не поддерживаются базовой системой обмена сообщениями, в двоичный поток, который можно передать вместе с сообщением, когда поставщик транспорта отправляет его.</span><span class="sxs-lookup"><span data-stu-id="42f5d-106">This format encapsulates MAPI properties not supported by an underlying messaging system into a binary stream that can be transferred along with the message when a transport provider sends it.</span></span> <span data-ttu-id="42f5d-107">Поставщик транспорта, который получает сообщение, может декодировать двоичный поток, чтобы получить все свойства исходного сообщения и сделать их доступными для клиентских приложений.</span><span class="sxs-lookup"><span data-stu-id="42f5d-107">The transport provider that receives the message can then decode the binary stream to retrieve all the properties of the original message and make them available to client applications.</span></span> <span data-ttu-id="42f5d-108">Рабочая модель для TNEF состоит из следующих компонентов:</span><span class="sxs-lookup"><span data-stu-id="42f5d-108">The operational model for TNEF is:</span></span>
  
- <span data-ttu-id="42f5d-109">Клиенты обмена сообщениями отправляют и получают сообщения в транспорт TNEF обычным образом.</span><span class="sxs-lookup"><span data-stu-id="42f5d-109">Messaging clients submit and receive messages to a TNEF transport as normal.</span></span>
    
- <span data-ttu-id="42f5d-110">Транспорт разделяет свойства исходящих сообщений на две категории: те, которые поддерживаются в базовой системе сообщений, и те, которые не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="42f5d-110">The transport separates the properties on outgoing messages into two categories: those that the underlying message system supports and those that it does not.</span></span> <span data-ttu-id="42f5d-111">Значения свойств, которые поддерживаются базовой системой обмена сообщениями, преобразуются в требуемый формат.</span><span class="sxs-lookup"><span data-stu-id="42f5d-111">The values of the properties that are supported by the underlying messaging system are translated into the required format.</span></span>
    
- <span data-ttu-id="42f5d-112">Транспорт использует методы MAPI TNEF для кодирования всех неподдерживаемых свойств в один поток данных.</span><span class="sxs-lookup"><span data-stu-id="42f5d-112">The transport uses the MAPI TNEF methods to encode any unsupported properties into a single data stream.</span></span> <span data-ttu-id="42f5d-113">Затем транспортный поток данных преобразуется в специальное вложение исходящего сообщения с использованием модели вложений базовой системы обмена сообщениями перед отправкой сообщения.</span><span class="sxs-lookup"><span data-stu-id="42f5d-113">The transport then turns that data stream into a special attachment on the outgoing message, using the underlying messaging system's attachment model, before sending the message.</span></span>
    
- <span data-ttu-id="42f5d-114">Транспортный транспорт с включенной поддержкой TNEF, который получает такое сообщение, выполняет две задачи.</span><span class="sxs-lookup"><span data-stu-id="42f5d-114">A TNEF enabled transport that receives such a message does two things.</span></span> <span data-ttu-id="42f5d-115">Во-первых, он преобразует свойства входящего сообщения, которые поддерживаются базовой системой обработки сообщений, в свойства MAPI.</span><span class="sxs-lookup"><span data-stu-id="42f5d-115">First, it translates the incoming message's properties — the ones supported by the underlying message system — into MAPI properties.</span></span> <span data-ttu-id="42f5d-116">Во-вторых, если присутствует специальное вложение, он использует методы MAPI TNEF для получения дополнительных свойств MAPI из вложения перед доставкой сообщения клиентскому приложению.</span><span class="sxs-lookup"><span data-stu-id="42f5d-116">Second, if the special attachment is present, it uses the MAPI TNEF methods to retrieve additional MAPI properties from the attachment before delivering the message to a client application.</span></span>
    
<span data-ttu-id="42f5d-117">MAPI предоставляет реализацию интерфейса **итнеф** для использования поставщиками транспорта MAPI при работе с объектами TNEF.</span><span class="sxs-lookup"><span data-stu-id="42f5d-117">MAPI supplies an implementation of the **ITnef** interface for use by MAPI transport providers when working with TNEF objects.</span></span> <span data-ttu-id="42f5d-118">Функция [опентнефстреамекс](opentnefstreamex.md) используется для создания объектов TNEF и связывания их с сообщением.</span><span class="sxs-lookup"><span data-stu-id="42f5d-118">The [OpenTnefStreamEx](opentnefstreamex.md) function is used to create TNEF objects and associate them with a message.</span></span> <span data-ttu-id="42f5d-119">Потоки TNEF построены поверх интерфейса OLE **IStream**</span><span class="sxs-lookup"><span data-stu-id="42f5d-119">TNEF streams are built on top of the OLE **IStream** interface</span></span> 
  
> [!NOTE]
> <span data-ttu-id="42f5d-120">С помощью **опентнефстреамекс** можно создавать объекты TNEF.</span><span class="sxs-lookup"><span data-stu-id="42f5d-120">You use **OpenTnefStreamEx** to create TNEF objects.</span></span> <span data-ttu-id="42f5d-121">Старая функция **опентнефстреам** по-прежнему существует для совместимости со старым исходным кодом и не должна использоваться ни в каких новых.</span><span class="sxs-lookup"><span data-stu-id="42f5d-121">The old **OpenTnefStream** function still exists for compatibility with old source code and should not be used in anything new.</span></span> 
  
<span data-ttu-id="42f5d-122">Интерфейс **итнеф** предоставляет следующие методы:</span><span class="sxs-lookup"><span data-stu-id="42f5d-122">The **ITnef** interface provides the following methods:</span></span> 
  
- [<span data-ttu-id="42f5d-123">аддпропс</span><span class="sxs-lookup"><span data-stu-id="42f5d-123">AddProps</span></span>](itnef-addprops.md)
    
- [<span data-ttu-id="42f5d-124">енкодереЦипс</span><span class="sxs-lookup"><span data-stu-id="42f5d-124">EncodeRecips</span></span>](itnef-encoderecips.md)
    
- [<span data-ttu-id="42f5d-125">екстрактпропс</span><span class="sxs-lookup"><span data-stu-id="42f5d-125">ExtractProps</span></span>](itnef-extractprops.md)
    
- [<span data-ttu-id="42f5d-126">Finish</span><span class="sxs-lookup"><span data-stu-id="42f5d-126">Finish</span></span>](itnef-finish.md)
    
- [<span data-ttu-id="42f5d-127">финишкомпонент</span><span class="sxs-lookup"><span data-stu-id="42f5d-127">FinishComponent</span></span>](itnef-finishcomponent.md)
    
- [<span data-ttu-id="42f5d-128">опентагжедбоди</span><span class="sxs-lookup"><span data-stu-id="42f5d-128">OpenTaggedBody</span></span>](itnef-opentaggedbody.md)
    
- [<span data-ttu-id="42f5d-129">SetProps</span><span class="sxs-lookup"><span data-stu-id="42f5d-129">SetProps</span></span>](itnef-setprops.md)
    
<span data-ttu-id="42f5d-130">Модель реализации MAPI TNEF поддерживает:</span><span class="sxs-lookup"><span data-stu-id="42f5d-130">The MAPI TNEF implementation model supports:</span></span>
  
- <span data-ttu-id="42f5d-131">Все свойства MAPI, не затрагивая другие свойства сообщения.</span><span class="sxs-lookup"><span data-stu-id="42f5d-131">All MAPI properties without affecting other message properties.</span></span> <span data-ttu-id="42f5d-132">Чтобы сообщения MAPI могли выдерживать транспорт через систему обмена сообщениями, все свойства, которые не могут быть закодированы как свойства системы обмена сообщениями, должны быть инкапсулированы.</span><span class="sxs-lookup"><span data-stu-id="42f5d-132">In order for MAPI messages to survive transport through a messaging system, all properties that cannot be encoded as properties of the messaging system must be encapsulated.</span></span> <span data-ttu-id="42f5d-133">Так как он почти никогда не известен, когда сообщение отправляется независимо от того, будет ли получено сообщение от MAPI-совместимого клиента, схема инкапсуляции позволяет поставщику транспорта кодировать только те свойства сообщения MAPI, которые не поддерживаются системой обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="42f5d-133">Because it is almost never known at the time a message is sent whether or not a MAPI-compliant client will receive the message, the encapsulation scheme allows a transport provider to encode only those MAPI message properties that the messaging system does not natively support.</span></span> <span data-ttu-id="42f5d-134">Это означает, что сообщения, использующие формат TNEF, не могут быть непрозрачными для систем обмена сообщениями, не основанных на MAPI, таких как системы обмена сообщениями UNIX на основе SMTP.</span><span class="sxs-lookup"><span data-stu-id="42f5d-134">This means that messages which use TNEF are not "opaque" to messaging systems that are not based on MAPI such as SMTP-based UNIX messaging systems.</span></span> <span data-ttu-id="42f5d-135">Эти системы получают свойства, которые они поддерживают, как правило, и другие свойства принимаются как закодированный поток данных TNEF.</span><span class="sxs-lookup"><span data-stu-id="42f5d-135">These systems receive the properties they support in whatever manner is typical for them, and other properties are received as an encoded TNEF data stream.</span></span> <span data-ttu-id="42f5d-136">Поставщик транспорта TNEF отвечает за различие между этими двумя наборами свойств и отправку поддерживаемого набора правильным способом для системы обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="42f5d-136">The TNEF transport provider is responsible for differentiating between these two sets of properties and sending the supported set in the proper manner for the messaging system.</span></span> <span data-ttu-id="42f5d-137">В формате TNEF нет допущений по уровню поддержки, предоставляемым системой обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="42f5d-137">TNEF makes no assumptions as to the level of support provided by a messaging system.</span></span> <span data-ttu-id="42f5d-138">Однако в примерах использования TNEF, включенных в этот раздел, предполагается, что система обмена сообщениями поддерживает по крайней мере одно вложение, не связанное с сообщением.</span><span class="sxs-lookup"><span data-stu-id="42f5d-138">However, in the examples of TNEF usage included in this section, the assumption is made that the messaging system supports at least one single attachment aside from the message.</span></span> <span data-ttu-id="42f5d-139">В некоторых случаях вложение поддерживается только через поток ууенкодед и передается как часть текста сообщения.</span><span class="sxs-lookup"><span data-stu-id="42f5d-139">In some cases, the attachment can only be supported through a uuencoded stream and transmitted as part of the message text.</span></span> <span data-ttu-id="42f5d-140">В очень редких обстоятельствах система обмена сообщениями будет иметь небольшую поддержку свойств сообщений, которые необходимы для полной кодировки TNEF для всех свойств.</span><span class="sxs-lookup"><span data-stu-id="42f5d-140">Only in very rare circumstances will the messaging system have so little support for message properties that full TNEF encoding of all properties is necessary.</span></span>
    
- <span data-ttu-id="42f5d-141">Механизм определения того, принадлежит ли поток TNEF входящего сообщения к сообщению, на основе свойства MAPI **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="42f5d-141">A mechanism for determining whether a TNEF stream on an incoming message belongs to the message, based on the MAPI property **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span></span> <span data-ttu-id="42f5d-142">Это свойство должно быть найдено как в потоке TNEF, так и в соответствующем заголовке сообщения.</span><span class="sxs-lookup"><span data-stu-id="42f5d-142">This property should be found both in the TNEF stream and in an appropriate message header.</span></span> <span data-ttu-id="42f5d-143">Если свойство имеет одно и то же значение в обоих местах или отсутствует в любом месте, предполагается, что поток TNEF принадлежит этому сообщению.</span><span class="sxs-lookup"><span data-stu-id="42f5d-143">If the property has the same value in both places, or is missing in either place, the TNEF stream is assumed to belong to the message.</span></span> <span data-ttu-id="42f5d-144">В противном случае поток TNEF игнорируется.</span><span class="sxs-lookup"><span data-stu-id="42f5d-144">Otherwise, the TNEF stream is ignored.</span></span> <span data-ttu-id="42f5d-145">Транспорты с включенной поддержкой TNEF отвечают за выбор значения этого свойства для исходящих сообщений и их кодирование в соответствующем заголовке сообщения (например, заголовок Message-ID: заголовок для SMTP-сообщений) и в потоке TNEF.</span><span class="sxs-lookup"><span data-stu-id="42f5d-145">TNEF enabled transports are responsible for choosing a value for this property on outbound messages and encoding it in an appropriate message header (for example, the Message-ID: header for SMTP messages) and in the TNEF stream.</span></span>
    

