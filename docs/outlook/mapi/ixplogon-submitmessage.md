---
title: IXPLogonSubmitMessage
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IXPLogon.SubmitMessage
api_type:
- COM
ms.assetid: a261ba0d-cb56-4935-b745-1d4bbd0b8b9d
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: ae124cb94cff5be0a655386d31f1bf2c82f66a85
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33423323"
---
# <a name="ixplogonsubmitmessage"></a>IXPLogon::SubmitMessage

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Указывает, что у пула MAPI есть сообщение, которое должен доставить поставщик транспорта.
  
```cpp
HRESULT SubmitMessage(
  ULONG ulFlags,
  LPMESSAGE lpMessage,
  ULONG FAR * lpulMsgRef,
  ULONG FAR * lpulReturnParm
);
```

## <a name="parameters"></a>Параметры

 _ulFlags_
  
> [in] Битоваяmas флагов, которая управляет отправкой сообщения. Можно установить следующий флаг:
    
BEGIN_DEFERRED 
  
> Пулер MAPI вызывает поставщика транспорта с сообщением, которое было ранее отложено. Идентификатор записи сообщения такой же, как и при его отложении. Сообщение было отложено путем передачи идентификатора записи обратно в пул mapI с помощью метода [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) с флагом NOTIFY_SENTDEFERRED. 
    
 _lpMessage_
  
> [in] Указатель на объект сообщения (представляющий сообщение для доставки), который имеет разрешение на чтение и записи, которое поставщик транспорта использует для доступа к этому сообщению и управления им. Этот объект остается действительным до тех пор, пока поставщик транспорта не вернется после последующего вызова метода [IXPLogon::EndMessage.](ixplogon-endmessage.md) 
    
 _lpulMsgRef_
  
> [out] Указатель на переменную, в которой поставщик транспорта возвращает значение ссылки, назначенное этому сообщению. Пулер MAPI передает это эталонное значение в последующих вызовах этого сообщения. Пулер MAPI инициализирует значение до 0, прежде чем возвращать его поставщику транспорта.
    
 _lpulReturnParm_
  
> [out] Указатель на переменную, соответствующую значению ошибки MAPI_E_WAIT или MAPI_E_NETWORK_ERROR, возвращаемой **SubmitMessage.**
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Вызов был успешным и возвратил ожидаемое значение или значения.
    
MAPI_E_BUSY 
  
> Поставщик транспорта не может обработать сообщение, так как выполняет другую операцию. Поставщик должен использовать это возвращаемую величину, чтобы указать, что обработка не произошла и что пулер MAPI не должен вызывать **EndMessage.** The MAPI spooler will try the **SubmitMessage** call again later. 
    
MAPI_E_CANCEL 
  
> Несмотря на то что поставщик транспорта запросил повторное сообщение от пула MAPI при предыдущем вызове **SpoolerNotify,** условия изменились, и сообщение не должно быть повторно доставлено. The MAPI spooler will go on to handle something else. 
    
MAPI_E_NETWORK_ERROR 
  
> Из-за сетевой ошибки не удалось успешно завершить операцию. Для  _параметра lpulReturnParm_ должно быть задано время в секундах, которое будет задано до того, как пулер MAPI повторно обнаправит сообщение. 
    
MAPI_E_NOT_ME 
  
> Поставщик транспорта не может обработать это сообщение. Пулер MAPI должен попытаться найти для него другого поставщика транспорта. Поставщик должен использовать это возвращаемую величину, чтобы указать, что обработка не произошла и что пулер MAPI не должен вызывать **EndMessage.**
    
MAPI_E_WAIT 
  
> Временная проблема не позволяет поставщику транспорта обрабатывать сообщение. Для  _параметра lpulReturnParm_ должно быть задано время в секундах, которое будет задано до того, как пулер MAPI повторно обнаправит сообщение. 
    
## <a name="remarks"></a>Примечания

Пулер MAPI вызывает метод **IXPLogon::SubmitMessage,** если у него есть сообщение, которое поставщик транспорта должен доставить. Сообщение передается поставщику транспорта с помощью параметра _lpMessage._ 
  
Если поставщик готов принять сообщение, он должен вернуть значение ссылки с помощью параметра  _lpulMsgRef,_ обработать переданный объект и вернуть соответствующее значение (обычно S_OK). Если поставщик не готов обработать передачу, он должен вернуть значение ошибки и, при желании, другое возвращаемого значения MAPI в  _lpulReturnParm,_ чтобы указать, сколько времени должен ждать пул MAPI перед повторной передачей сообщения. 
  
Реализация этого метода поставщиком транспорта может сделать следующее:
  
- Поместите сообщение во внутреннюю очередь, чтобы дождаться передачи, возможно, скопируйте сообщение в локальное хранилище и вернетесь.
    
- Попытка выполнить фактическую передачу и возврат после ее завершения либо успешно, либо безуспешно.
    
- Определите, следует ли отправлять сообщение после проверки задействованного ресурса. В этом случае, если ресурс бесплатный, поставщик может заблокировать ресурс, подготовить сообщение и отправить его. Если ресурс занят, поставщик может подготовить сообщение и отложить отправку на более позднее время.
    
Предпочтительный способ передачи сообщений зависит от поставщика транспорта и ожидаемого количества процессов, конкурирующих за системные ресурсы. 
  
Во время **вызова SubmitMessage** поставщик транспорта управляет передачей данных сообщения из объекта сообщения. Однако перед передачей данных поставщик транспорта должен назначить ссылку на сообщение, которому он возвращает указатель _в lpulMsgRef._ Это происходит потому, что в любой момент процесса пулер MAPI может вызвать метод [IXPLogon::TransportNotify](ixplogon-transportnotify.md) с флагом NOTIFY_CANCEL_MESSAGE, чтобы сигнализировать поставщику о том, что он должен освободить все открытые объекты и остановить передачу сообщений. 
  
Поставщик транспорта не должен отправлять какие-либо нераспросываемые свойства сообщения. Когда оно находит такое свойство, оно должно перейти к обработке следующего свойства. Поставщик должен приложить все усилия, чтобы не отображать MAPI_P1 получателя в составе передаваемого содержимого сообщения; поставщик должен использовать эти сведения о получателях только для адресов. MAPI_P1 получатели являются внутренними получателями, которые используются для повторной почты сообщений; они не должны передаваться. Вместо этого используйте другие получатели для передачи сведений о получателях. Цель этого соглашения состоит в том, чтобы разрешить получателям повторной выдачи видеть ту же таблицу получателей, что и исходные получатели.
  
Во время **вызова SubmitMessage** пулер MAPI обрабатывает методы для объектов, открытых во время передачи сообщения, и обрабатывает любые вложения. Эта обработка может занять много времени. Поставщики транспорта могут часто вызывать метод [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) для пула MAPI во время этой обработки, чтобы освободить время ЦП для других системных задач. 
  
В таблице получателей сообщения, переданного пулом MAPI, видны все получатели сообщений. Поставщик транспорта должен обрабатывать только тех получателей, которые он может обработать ( на основе идентификатора записи, типа адреса или и того, и другое), и у них еще нет свойства **PR_RESPONSIBILITY** ([PidTagResponsibility)](pidtagresponsibility-canonical-property.md)со свойством TRUE. Если **PR_RESPONSIBILITY** уже установлено true, другой поставщик транспорта обработил этого получателя. Когда поставщик завершает достаточную обработку получателя, чтобы определить, может ли он обрабатывать сообщения  для этого получателя, он должен установить для свойства PR_RESPONSIBILITY этого получателя в переданных сообщениях true. Обычно поставщик делает это определение после доставки сообщения. 
  
Обычно поставщик транспорта не возвращается из вызова **SubmitMessage,** пока не завершит передачу данных сообщения. Если ошибка не возвращается, следующим вызовом поставщика из пула MAPI является вызов метода [IXPLogon::EndMessage.](ixplogon-endmessage.md) 
  
Если **SubmitMessage** возвращает ошибку, пулер MAPI освобождает сообщение, не сохранения изменений. Если поставщик транспорта требует сохранения изменений сообщений, перед возвратом он должен вызвать метод [IMAPIProp::SaveChanges](imapiprop-savechanges.md) для сообщения. 
  
В случае ошибок, которые возникают из-за проблем с транспортировкой, пулер MAPI сохраняет сообщение, но задерживает повторное сообщение поставщику транспорта на основе значения, возвращенного _в lpulReturnParm._ Поставщик транспорта должен внести это значение, если его возвращаемая величина **из SubmitMessage** MAPI_E_WAIT или MAPI_E_NETWORK_ERROR. Если возникает серьезное состояние ошибки, поставщик транспорта должен вызвать метод [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) с NOTIFY_CRITICAL_ERROR флагом. 
  
## <a name="see-also"></a>См. также



[IMAPIProp::SaveChanges](imapiprop-savechanges.md)
  
[IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
  
[IMAPISupport::SpoolerYield](imapisupport-spooleryield.md)
  
[IXPLogon::EndMessage](ixplogon-endmessage.md)
  
[IXPLogon::TransportNotify](ixplogon-transportnotify.md)
  
[IXPLogon : IUnknown](ixplogoniunknown.md)

