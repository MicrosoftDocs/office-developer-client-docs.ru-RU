---
title: Иксплогонсубмитмессаже
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IXPLogon.SubmitMessage
api_type:
- COM
ms.assetid: a261ba0d-cb56-4935-b745-1d4bbd0b8b9d
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: ae124cb94cff5be0a655386d31f1bf2c82f66a85
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33423323"
---
# <a name="ixplogonsubmitmessage"></a>IXPLogon::SubmitMessage

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Указывает на то, что диспетчер очереди MAPI имеет сообщение, которое будет доставлено поставщику транспорта.
  
```cpp
HRESULT SubmitMessage(
  ULONG ulFlags,
  LPMESSAGE lpMessage,
  ULONG FAR * lpulMsgRef,
  ULONG FAR * lpulReturnParm
);
```

## <a name="parameters"></a>Параметры

 _ulFlags_
  
> возврата Битовая маска флагов, определяющих способ отправки сообщения. Можно задать следующий флаг:
    
БЕГИН_ДЕФЕРРЕД 
  
> Диспетчер очереди MAPI вызывает поставщик транспорта с сообщением, которое ранее было отложено. Идентификатор записи сообщения такой же, как и при его отложенной отправку. Сообщение было отложено путем передачи его идентификатора записи обратно в буфер обмена MAPI с помощью метода [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) с флагом нотифи_сентдеферред. 
    
 _Лпмессаже_
  
> возврата Указатель на объект Message (представляющий сообщение для доставки), у которого есть разрешение на чтение и запись, которое поставщик транспорта использует для доступа к этому сообщению и управления им. Этот объект остается действительным до тех пор, пока поставщик транспорта не вернется из последующего вызова метода [иксплогон:: ендмессаже](ixplogon-endmessage.md) . 
    
 _Лпулмсгреф_
  
> вышли Указатель на переменную, в которой поставщик транспорта возвращает значение ссылки, назначенное этому сообщению. Диспетчер очереди MAPI передает это значение ссылки в последующих вызовах этого сообщения. Диспетчер очереди MAPI Инициализирует значение равным 0 перед его возвратом поставщику транспорта.
    
 _Лпулретурнпарм_
  
> вышли Указатель на переменную, которая соответствует значению ошибки МАПИ_Е_ВАИТ или МАПИ_Е_НЕТВОРК_ЕРРОР, возвращенному **субмитмессаже**.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Вызов выполнен успешно и вернул ожидаемое значение или значения.
    
МАПИ_Е_БУСИ 
  
> Поставщик транспорта не может обработать сообщение, так как он выполняет другую операцию. Поставщик должен использовать это возвращаемое значение, чтобы показать, что обработка не выполнялась, и что диспетчер очереди MAPI не должен вызывать **ендмессаже**. Диспетчер очереди MAPI повторит вызов **субмитмессаже** позже. 
    
МАПИ_Е_КАНЦЕЛ 
  
> Хотя поставщик транспорта запросил, чтобы диспетчер очереди MAPI повторно отправил сообщение в предыдущий вызов **спулернотифи** , условия изменились, и сообщение не должно повторно использоваться. Диспетчер очереди MAPI перейдет на страницу, чтобы обработать что-либо еще. 
    
МАПИ_Е_НЕТВОРК_ЕРРОР 
  
> Не удалось успешно завершить операцию из – за сетевой ошибки. Для параметра _лпулретурнпарм_ необходимо указать время в секундах, по истечении которого диспетчер очереди MAPI повторно отправит сообщение. 
    
МАПИ_Е_НОТ_МЕ 
  
> Поставщик транспорта не может обработать это сообщение. Диспетчер очереди MAPI должен попытаться найти другого поставщика транспорта для него. Поставщик должен использовать это возвращаемое значение, чтобы показать, что обработка не выполнялась, и что диспетчер очереди MAPI не должен вызывать **ендмессаже**.
    
МАПИ_Е_ВАИТ 
  
> Временная проблема не позволяет поставщику транспорта обрабатывать сообщение. Для параметра _лпулретурнпарм_ необходимо указать время в секундах, по истечении которого диспетчер очереди MAPI повторно отправит сообщение. 
    
## <a name="remarks"></a>Примечания

Диспетчер очереди MAPI вызывает метод **иксплогон:: субмитмессаже** , когда у него есть сообщение для доставки поставщику транспорта. Сообщение передается поставщику транспорта с помощью параметра _лпмессаже_ . 
  
Если поставщик готов принять сообщение, он должен возвратить значение ссылки с помощью параметра _лпулмсгреф_ , обработать переданный объект и возвратить соответствующее значение (обычно S_OK). Если поставщик не готов к передаче, он должен возвратить значение ошибки и (необязательно) другое возвращаемое значение MAPI в _лпулретурнпарм_ , чтобы указать время ожидания перед повторной отправкой сообщения диспетчером MAPI. 
  
Реализация этого метода поставщиком транспорта может выполнить следующие действия:
  
- Помещение сообщения во внутреннюю очередь для ожидания передачи, возможно, копирования сообщения в локальное хранилище и возврата.
    
- Попытка выполнить фактическую передачу и возврат, когда передача завершается успешно или неудачно.
    
- Определите, следует ли отправлять сообщение после проверки задействованного ресурса. В этом случае, если ресурс свободен, поставщик может заблокировать ресурс, подготовить сообщение и передать его. Если ресурс занят, поставщик может подготовить сообщение и отложить отправку на более позднее время.
    
Предпочтительный способ передачи сообщений зависит от поставщика транспорта и от ожидаемого количества процессов, конкурирующих за системные ресурсы. 
  
При вызове **субмитмессаже** поставщик транспорта управляет передачей данных сообщения из объекта Message. Тем не менее, поставщик транспорта должен назначить значение ссылки на сообщение, чтобы оно возвращало указатель в _лпулмсгреф_, перед передачей данных. Это происходит потому, что в любой момент процесса диспетчер очереди MAPI может вызвать метод [иксплогон:: транспортнотифи](ixplogon-transportnotify.md) с установленным ФЛАГом нотифи_канцел_мессаже, чтобы сообщить поставщику, что он должен освободить открытые объекты и остановить передачу сообщений. 
  
Поставщик транспорта не должен отправлять недопустимые свойства сообщения. При обнаружении такого свойства он должен перейти к обработке следующего свойства. Поставщик должен сделать все усилия, чтобы не отображали сведения о получателе MAPI_P1 в переданном содержимом сообщения; Поставщик должен использовать эти сведения о получателе только для целей адресации. Получатели MAPI_P1 — это внутренние получатели, которые используются для повторной отправки сообщений; они не должны передаваться. Вместо этого используйте других получателей для передачи сведений о получателях. Цель этого размещения заключается в том, чтобы разрешить получателю повторной отправки просматривать точно ту же таблицу получателей, что и исходные получатели.
  
Во время вызова **субмитмессаже** Диспетчер очереди MAPI обрабатывает методы для объектов, которые открываются во время передачи сообщения, и обрабатывает все вложения. Обработка может занять длительное время. Поставщики транспорта могут часто вызывать метод [имаписуппорт:: спулериелд](imapisupport-spooleryield.md) для ДИСПЕТЧЕРА очереди MAPI во время этой обработки, чтобы освободить время ЦП для других системных задач. 
  
Все получатели сообщения отображаются в таблице получателей сообщения о первоначальном переданном диспетчере очереди MAPI. Поставщик транспорта должен обрабатывать только тех получателей, которые могут обрабатываться, на основе идентификатора записи, типа адреса или того, у которого нет свойства **пр_респонсибилити** ([PidTagResponsibility](pidtagresponsibility-canonical-property.md)), для которого не задано значение true. Если для **пр_респонсибилити** уже ЗАДАНО значение true, этот получатель обработал другой поставщик транспорта. Когда поставщик выполняет достаточную обработку получателя, чтобы определить, может ли он обрабатывать сообщения для этого получателя, он должен задать для свойства **пр_респонсибилити** этого получателя значение true в переданном сообщении. Как правило, поставщик выполняет это определение после завершения доставки сообщения. 
  
Как правило, поставщик транспорта не возвращает вызов **субмитмессаже** до завершения передачи данных сообщения. Если сообщение об ошибке не возвращается, следующий вызов из очереди MAPI к поставщику является вызовом метода [иксплогон:: ендмессаже](ixplogon-endmessage.md) . 
  
Если **субмитмессаже** возвращает ошибку, диспетчер очереди MAPI освобождает сообщение в процессе без сохранения изменений. Если поставщик транспорта требует сохранения изменений в сообщениях, он должен вызвать метод [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) для сообщения перед возвращением. 
  
В случае ошибок, возникающих из-за проблем транспорта, диспетчер очереди MAPI сохраняет сообщение, но откладывает повторную отправку сообщения поставщику транспорта на основании значения, возвращаемого в _лпулретурнпарм_. Поставщик транспорта должен заполнить это значение, если его возвращаемое значение из **субмитмессаже** равно МАПИ_Е_ВАИТ или мапи_е_нетворк_еррор. При возникновении критической ошибки поставщик транспорта должен вызвать метод [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) с флагом нотифи_критикал_еррор. 
  
## <a name="see-also"></a>См. также



[IMAPIProp::SaveChanges](imapiprop-savechanges.md)
  
[IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
  
[IMAPISupport::SpoolerYield](imapisupport-spooleryield.md)
  
[IXPLogon::EndMessage](ixplogon-endmessage.md)
  
[IXPLogon::TransportNotify](ixplogon-transportnotify.md)
  
[IXPLogon : IUnknown](ixplogoniunknown.md)

