---
title: IXPLogonSubmitMessage
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IXPLogon.SubmitMessage
api_type:
- COM
ms.assetid: a261ba0d-cb56-4935-b745-1d4bbd0b8b9d
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: ae124cb94cff5be0a655386d31f1bf2c82f66a85
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33423323"
---
# <a name="ixplogonsubmitmessage"></a>IXPLogon::SubmitMessage

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Указывает, что у пулера MAPI есть сообщение для поставщика транспорта для доставки.
  
```cpp
HRESULT SubmitMessage(
  ULONG ulFlags,
  LPMESSAGE lpMessage,
  ULONG FAR * lpulMsgRef,
  ULONG FAR * lpulReturnParm
);
```

## <a name="parameters"></a>Parameters

 _ulFlags_
  
> [in] Битмашка флагов, которые контролируют отправку сообщения. Можно установить следующий флаг:
    
BEGIN_DEFERRED 
  
> Spooler MAPI вызывает поставщика транспорта с ранее отложенным сообщением. Идентификатор записи сообщения такой же, как и при отложении. Сообщение было отложено, передав идентификатор записи обратно в шпалер MAPI с помощью метода [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) с флагом NOTIFY_SENTDEFERRED. 
    
 _lpMessage_
  
> [in] Указатель на объект сообщения (представляющий сообщение для доставки), который имеет разрешение на чтение и записи, которое поставщик транспорта использует для доступа к этому сообщению и управления им. Этот объект остается действительным до тех пор, пока поставщик транспорта не вернется после последующего вызова к [методу IXPLogon::EndMessage.](ixplogon-endmessage.md) 
    
 _lpulMsgRef_
  
> [вышел] Указатель на переменную, в которой поставщик транспорта возвращает назначенное этому сообщению значение. Шпалер MAPI передает это эталонное значение в последующих вызовах для этого сообщения. Spooler MAPI инициализирует значение до 0, прежде чем возвращать его поставщику транспорта.
    
 _lpulReturnParm_
  
> [вышел] Указатель на переменную, соответствующую значению MAPI_E_WAIT или MAPI_E_NETWORK_ERROR, возвращаемой **SubmitMessage.**
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Вызов удался и возвращает ожидаемое значение или значения.
    
MAPI_E_BUSY 
  
> Поставщик транспорта не может обрабатывать сообщение, так как выполняет другую операцию. Поставщик должен использовать это возвращаемая величина, чтобы указать, что обработка не была совершена и что пульпер MAPI не должен вызывать **EndMessage.** Spooler MAPI снова попробует **вызов SubmitMessage** позже. 
    
MAPI_E_CANCEL 
  
> Несмотря на то, что поставщик транспорта запросил повторное повторное сообщение от пулера MAPI на предыдущем вызове **SpoolerNotify,** условия с тех пор изменились, и сообщение не должно быть обижным. Шпалер MAPI будет обрабатывать что-то другое. 
    
MAPI_E_NETWORK_ERROR 
  
> Ошибка сети помешала успешному завершению операции. Параметр  _lpulReturnParm_ должен быть задан в количестве секунд, которое пройдет до повторного повторного сообщения spooler MAPI. 
    
MAPI_E_NOT_ME 
  
> Поставщик транспорта не может обрабатывать это сообщение. Spooler MAPI должен попытаться найти другого поставщика транспорта для него. Поставщик должен использовать это возвращаемая величина, чтобы указать, что обработка не была совершена и что пульпер MAPI не должен вызывать **EndMessage.**
    
MAPI_E_WAIT 
  
> Временная проблема не позволяет поставщику транспорта обрабатывать сообщение. Параметр  _lpulReturnParm_ должен быть задан в количестве секунд, которое пройдет до повторного повторного сообщения spooler MAPI. 
    
## <a name="remarks"></a>Примечания

Spooler MAPI вызывает **метод IXPLogon::SubmitMessage,** когда у него есть сообщение для поставщика транспорта для доставки. Сообщение передается поставщику транспорта с помощью _параметра lpMessage._ 
  
Если поставщик готов принять сообщение, он должен вернуть эталонное значение с помощью параметра  _lpulMsgRef,_ обработать переданный объект и вернуть соответствующее значение (как правило, S_OK). Если поставщик не готов обрабатывать передачу, он должен вернуть значение ошибки и, необязательно, другое значение возврата MAPI в  _lpulReturnParm,_ чтобы указать, как долго spooler MAPI должен ждать перед повторной передачей сообщения. 
  
Реализация этого метода поставщиком транспорта может сделать следующее:
  
- Поместите сообщение во внутреннюю очередь, чтобы дождаться передачи, возможно, скопируйте сообщение в локальное хранилище и вернись.
    
- Попытка выполнить фактическую передачу и вернуться после успешного или неудачного завершения передачи.
    
- Определите, отправлять ли сообщение после проверки задействованного ресурса. В этом случае, если ресурс бесплатный, поставщик может заблокировать ресурс, подготовить сообщение и отправить его. Если ресурс занят, поставщик может подготовить сообщение и отложить отправку на более позднее время.
    
Предпочтительный метод передачи сообщений зависит от поставщика транспорта и ожидаемого количества процессов, конкурирующих за системные ресурсы. 
  
Во время **вызова SubmitMessage** поставщик транспорта контролирует передачу данных сообщений из объекта сообщения. Однако перед передачей данных поставщик транспорта должен назначить ссылку на сообщение, которому возвращает указатель _в lpulMsgRef._ Это делается потому, что в любой момент во время процесса шпалер MAPI может вызвать метод [IXPLogon::TransportNotify](ixplogon-transportnotify.md) с набором флага NOTIFY_CANCEL_MESSAGE, чтобы сигнализировать поставщику о том, что он должен освободить все открытые объекты и остановить передачу сообщений. 
  
Поставщик транспорта не должен отправлять любые неограничимые свойства сообщения. Когда оно находит такое свойство, оно должно перейти к обработке следующего свойства. Поставщик должен приложить все усилия, чтобы не отображать MAPI_P1 получателей в составе передаваемых сообщений; поставщик должен использовать эти сведения получателя только для решения задач. MAPI_P1 получатели — это внутренне созданные получатели, которые используются для повторного использования сообщений; они не должны передаваться. Вместо этого используйте другие получатели для передачи сведений о получателях. Цель этого соглашения состоит в том, чтобы разрешить получателям повторной выдачи видеть ту же таблицу получателей, что и исходные получатели.
  
Во время **вызова SubmitMessage** пулер MAPI обрабатывает методы для объектов, которые открываются во время передачи сообщения, и обрабатывает любые вложения. Эта обработка может занять много времени. Поставщики транспорта могут часто вызывать [метод IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) для шпалеров MAPI во время этой обработки, чтобы освободить время ЦП для других системных задач. 
  
Все получатели сообщений видны в таблице получателей сообщения, которое изначально было передано спулером MAPI. Поставщик транспорта должен обрабатывать только те получатели, с которые он может обращаться , основываясь на идентификаторе записи, типе адреса или обоих, и у них уже нет свойств **PR_RESPONSIBILITY** [(PidTagResponsibility),](pidtagresponsibility-canonical-property.md)задаваемого true. Если **PR_RESPONSIBILITY** уже установлено true, другой поставщик транспорта обсправил этого получателя. Когда поставщик завершает достаточную обработку получателя, чтобы определить, может ли он обрабатывать сообщения  для этого получателя, он должен задать свойство PR_RESPONSIBILITY получателя true в переданных сообщениях. Обычно поставщик принимает это решение после завершения доставки сообщения. 
  
Обычно поставщик транспорта не возвращается с вызова **SubmitMessage** до завершения передачи данных сообщений. Если ошибка не возвращается, следующим вызовом от пулера MAPI к поставщику является вызов метода [IXPLogon::EndMessage.](ixplogon-endmessage.md) 
  
Если **SubmitMessage** возвращает ошибку, шпалер MAPI освобождает сообщение в процессе без сохранения изменений. Если поставщику транспорта требуется сохранить изменения сообщений, перед возвращением необходимо вызвать метод [IMAPIProp::SaveChanges](imapiprop-savechanges.md) в сообщении. 
  
В случае ошибок, которые возникают из-за транспортных проблем, шпалер MAPI сохраняет сообщение, но задерживает повторное сообщение поставщику транспорта на основе значения, возвращенного в  _lpulReturnParm_. Поставщик транспорта должен заполнить это значение, если его возвращаемая стоимость **из SubmitMessage** MAPI_E_WAIT или MAPI_E_NETWORK_ERROR. Если возникает серьезное состояние ошибки, поставщик транспорта должен вызвать [метод IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) с NOTIFY_CRITICAL_ERROR флагом. 
  
## <a name="see-also"></a>См. также



[IMAPIProp::SaveChanges](imapiprop-savechanges.md)
  
[IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
  
[IMAPISupport::SpoolerYield](imapisupport-spooleryield.md)
  
[IXPLogon::EndMessage](ixplogon-endmessage.md)
  
[IXPLogon::TransportNotify](ixplogon-transportnotify.md)
  
[IXPLogon : IUnknown](ixplogoniunknown.md)

