---
title: Имапипропжетпропс
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIProp.GetProps
api_type:
- COM
ms.assetid: 1c7a9cd2-d765-4218-9aee-52df1a2aae6c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9b03775d495f7d1f51142eb0ed06fc9ecdf6d1a3
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412459"
---
# <a name="imapipropgetprops"></a>IMAPIProp::GetProps

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Получает значение свойства одного или нескольких свойств объекта.
  
```cpp
HRESULT GetProps(
  LPSPropTagArray lpPropTagArray,
  ULONG ulFlags,
  ULONG FAR * lpcValues,
  LPSPropValue FAR * lppPropArray
);
```

## <a name="parameters"></a>Параметры

 _Лппроптагаррай_
  
> возврата Указатель на массив тегов свойств, определяющий свойства, значения которых требуется получить. Параметр _лппроптагаррай_ должен иметь значение null, указывая, что необходимо возвратить значения всех свойств объекта, или указать структуру [спроптагаррай](sproptagarray.md) , содержащую один или несколько тегов свойств. 
    
 _ulFlags_
  
> возврата Битовая маска флагов, указывающая формат для свойств с типом ПТ_УНСПЕЦИФИЕД. Можно задать следующий флаг:
    
MAPI_UNICODE 
  
> Строковые значения для этих свойств должны быть возвращены в формате Юникод. Если флаг МАПИ_УНИКОДЕ не установлен, строковые значения должны быть возвращены в формате ANSI.
    
 _Лпквалуес_
  
> вышли Указатель на число значений свойств, на которые указывает параметр _лпппропаррай_ . Если _лпппропаррай_ имеет значение null, то содержимое параметра _лпквалуес_ равно нулю. 
    
 _Лпппропаррай_
  
> вышли Указатель на указатель на извлеченные значения свойства.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Значения свойств успешно получены.
    
МАПИ_В_ЕРРОРС_РЕТУРНЕД 
  
> Вызов выполнен успешно, но не удалось получить доступ к одному или нескольким свойствам. Элемент **аулпроптаг** значения свойства для каждого недоступного свойства имеет тип свойства пт_еррор и нулевой идентификатор. При возвращении этого предупреждения вызов должен обрабатываться как успешный. Чтобы проверить это предупреждение, используйте макрос **хр_фаилед** . Дополнительные сведения см. [в разделе Использование макросов для обработки ошибок](using-macros-for-error-handling.md).
    
МАПИ_Е_ИНВАЛИД_ПАРАМЕТЕР 
  
> Нулевое значение передано в элемент **квалуес** структуры **спроптагаррай** , на который указывает _лппроптагаррай_.
    
## <a name="remarks"></a>Примечания

Метод **IMAPIProp::** /PROPS получает значения свойств одного или нескольких свойств объекта. 
  
Значения свойств возвращаются в том же порядке, в котором они были запрошены (то есть порядок свойств в массиве тегов свойств, на который указывает _лппроптагаррай_ , совпадает с порядком в массиве структур значений свойств, на который указывает _лпппропаррай _). 
  
Типы свойств, указанные в элементах **аулпроптаг** в массиве тегов свойств, указывают тип значения, которое должно возвращаться в элементе **value** каждой структуры значения свойства. Тем не менее, если вызывающему объекту не известен тип свойства, для типа в элементе **аулпроптаг** можно задать значение пт_унспеЦифиед. При получении значения параметру **PROPS** присваивается правильный тип в элементе **аулпроптаг** структуры значений свойств для свойства. 
  
Если типы свойств указаны в **спроптагаррай** в _лппроптагаррай_, то значения свойств в **Спропвалуе** , возвращенные в _лпппропаррай_ , имеют типы, которые точно соответствуют запрашиваемым типам, если не будет возвращено значение ошибки Вместо. 
  
Строковые свойства могут иметь один из двух типов свойств: ПТ_УНИКОДЕ для представления формата Юникода и PT_STRING8 для представления формата ANSI. Если в параметре _ulFlags_ ЗАДАН флаг мапи_уникоде, то при невозможности определить соответствующий формат для свойства String он возвращает его значение в формате Юникод. **** **** Свойства PROPS не могут определять точный тип свойства String в следующих ситуациях: 
  
- Параметр _лппроптагаррай_ имеет значение null, чтобы запросить все свойства. 
    
- Элемент **аулпроптаг** включает значение пт_унспеЦифиед в качестве типа свойства в массиве тегов свойств. 
    
Если для параметра _лппроптагаррай_ ЗАДАНО значение null, в результате которого извлекаются все свойства объекта без свойств, свойство- **PROPS** выполняет следующие действия: 
  
- Возвращает значение S_OK.
    
- Задает значение 0 в качестве значения счетчика в элементе **квалуес** в структуре значения свойства. 
    
- Задает значение 0 для содержимого _лпквалуес_ . 
    
- Задает для _ЛПППРОПАРРАЙ_ значение null. 
    
 **** Свойства PROPS не должны возвращать свойства с несколькими значениями, для **квалуес** задано значение 0. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

ВыЗовите функцию [мапиаллокатебуффер](mapiallocatebuffer.md) , чтобы сначала выделить память для структуры [спропвалуе](spropvalue.md) , на которую указывает _лппроптагаррай_; Вызовите [мапиаллокатеморе](mapiallocatemore.md) , чтобы выделить дополнительную память, необходимую для членов структуры. 
  
Возвращает МАПИ_В_ЕРРОРС_РЕТУРНЕД, если не удается получить значение для одного или нескольких запрошенных свойств. В структуре значение свойства задайте для параметра Тип элемента **аулпроптаг** значение пт_еррор и элемент **значение** — код состояния, описывающий ошибку. Например, если необходимо преобразовать строку в Юникод и не поддерживает Юникод, установите для элемента **value значение** мапи_е_бад_чарвидс. Если свойство слишком велико, задайте для него значение МАПИ_Е_НОТ_ЕНАУГХ_МЕМОРИ. Если объект не поддерживает это свойство, задайте для него значение МАПИ_Е_НОТ_ФАУНД. 
  
Реализация метода props в поставщике удаленного **** транспорта должна возвращать значения свойств папки для свойств, запрашиваемых вызывающим абонентом. Ваша реализация должна выполнять следующие действия: 
  
- Выделите массив значений свойства, чтобы вернуться к вызывающему объекту, и сохраните его адрес в параметре указателя значения свойства, переданном для этой цели.
    
- Скопируйте теги свойств из свойств папки в теги свойств в массиве значений свойства в соответствии с массивом тегов свойств, передаваемых в свойства **PROPS**.
    
- Убедитесь, что тип свойства задан для всех тегов свойств, которые передаются в свойствах **PROPS**. Вызывающий абонент может передавать тип свойства ПТ_УНСПЕЦИФИЕД, в этом случае параметру **** GetProperty необходимо задать правильный тип свойства для тега этого свойства. 
    
- Задайте значение каждого свойства в массиве значений свойства в соответствии с его тегом. Например, если в качестве тега свойства, запрошенного вызывающим абонентом, задано значение **пр_обжект_типе** ([PidTagObjectType](pidtagobjecttype-canonical-property.md)), то параметру- **PROPS** можно присвоить значение мапи_фолдер. 
    
- Если вызывающий абонент передает все теги свойств, которые не обрабатываются в вашей реализации, можно установить для тега свойства значение ПТ_ЕРРОР для этих свойств и задать для свойства значение МАПИ_Е_НОТ_ФАУНД.
    
- Возвращает значение S_OK при отсутствии ошибок или МАПИ_В_ЕРРОРС_РЕТУРНЕД при возникновении ошибок.
    
Реализация метода props в поставщике удаленного **** транспорта должна поддерживать следующие свойства по крайней мере: 
  
- **Пр_акцесс** ([PidTagAccess](pidtagaccess-canonical-property.md))
    
- **Пр_акцесс_левел** ([PidTagAccessLevel](pidtagaccesslevel-canonical-property.md))
    
- **Пр_ассок_контент_каунт** ([PidTagAssociatedContentCount](pidtagassociatedcontentcount-canonical-property.md))
    
- **Пр_контент_каунт** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))
    
- **Пр_креатион_тиме** ([PidTagCreationTime](pidtagcreationtime-canonical-property.md))
    
- **Пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))
    
- **Пр_дисплай_типе** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md))
    
- **Пр_фолдер_типе** ([PidTagFolderType](pidtagfoldertype-canonical-property.md))
    
- **ПР_ОБЖЕКТ_ТИПЕ**
    
- **Пр_субфолдерс** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md))
    
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Для свойств типа ПТ_ОБЖЕКТ вызовите метод [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) вместо PROPS. **** 
  
Для защищенных свойств не рекомендуется извлекать их с помощью вызова **** метода лпппроптагаррай, если для параметра __ задано значение null. При вызове метода PROPS необходимо явно задать идентификатор безопасного свойства в элементе **аулпроптаг** в массиве тегов свойств. **** Когда и как доступно безопасное свойство, у поставщика услуг. 
  
Освободите возвращаемую структуру **спропвалуе** , вызвав функцию [мапифрибуффер](mapifreebuffer.md) только в том случае, если метод **PROPS** возвращает значение S_OK или мапи_в_еррорс_ретурнед. 
  
Если **PROPS** возвращает мапи_в_еррорс_ретурнед, так как ему не удалось получить доступ к одному или нескольким свойствам, проверьте теги свойств возвращаемых свойств. Свойства Failed будут иметь следующие значения в структуре значений свойств: 
  
- Тип свойства в элементе **аулпроптаг** в наборе пт_еррор. 
    
- Значение свойства в элементе **value** устанавливается равным коду состояния ошибки, например мапи_е_нот_фаунд. 
    
Свойства, которые не удалось получить из-за слишком большого размера для удобного возврата в структуре значений свойств, имеют **значение** мапи_е_нот_енаугх_мемори. Обычно это происходит со строковыми или двоичными свойствами типа PT_STRING8, ПТ_УНИКОДЕ или ПТ_БИНАРИ, когда значение свойства равно 4 КБ или больше. Call **IMAPIProp:: опенпроперти** для получения больших свойств. 
  
Не все реализации методов **PROPS** поддерживают как формат Юникод, так и формат ANSI для символьных строк. Если конкретному свойству требуется преобразование строкового **** формата, а PROPS не поддерживают его, элементу Value для этого свойства присваивается **значение** мапи_е_бад_чарвидс. 
  
Чтобы проверить, является ли PST-файл PST SharePoint, подключите PST-файл с помощью [IMAPISession:: опенмсгсторе](imapisession-openmsgstore.md), а затем вызовите команду GetProperty для объекта хранилища сообщений, запрашивающего это свойство. **** Если он существует, можно предположить, что PST-файл настроен для SharePoint; в противном случае PST-файл не был настроен как PST-файл SharePoint. 
  
Дополнительные сведения о том, как использовать **** свойства, чтобы получить доступ к свойствам, можно узнать в статье [Получение свойств MAPI](retrieving-mapi-properties.md).
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Мапифунктионс. cpp  <br/> |Жетпропснулл  <br/> |MFCMAPI использует метод **IMAPIProp::** , чтобы получить все свойства объекта, ПЕРЕДАВ значение null или массив, возвращенный методом [IMAPIProp:: жетпроплист](imapiprop-getproplist.md) в параметре _лппроптагаррай_ .  <br/> |
   
## <a name="see-also"></a>См. также



[IMAPIProp::GetPropList](imapiprop-getproplist.md)
  
[IMAPIProp::OpenProperty](imapiprop-openproperty.md)
  
[MAPIAllocateBuffer](mapiallocatebuffer.md)
  
[MAPIAllocateMore](mapiallocatemore.md)
  
[MAPIFreeBuffer](mapifreebuffer.md)
  
[SPropTagArray](sproptagarray.md)
  
[SPropValue](spropvalue.md)
  
[IMAPIProp : IUnknown](imapipropiunknown.md)


[MFCMAPI как пример кода](mfcmapi-as-a-code-sample.md)
  
[Получение свойств MAPI](retrieving-mapi-properties.md)
  
[Использование макросов для обработки ошибок](using-macros-for-error-handling.md)

