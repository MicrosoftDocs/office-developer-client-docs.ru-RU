---
title: MAPILogonEx
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPILogonEx
api_type:
- HeaderDef
ms.assetid: 98091e5b-1abd-4814-9c7a-583b420ee11d
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9f2ec8f0ec00f7314982e9b112415f69901c358c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33424121"
---
# <a name="mapilogonex"></a>MAPILogonEx

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Занося клиентские приложения в сеанс с системой обмена сообщениями. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapix.h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPILogonEx(
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  LPSTR lpszPassword,
  FLAGS flFlags,
  LPMAPISESSION FAR * lppSession
);
```

## <a name="parameters"></a>Параметры

 _ulUIParam_
  
> [in] Обработать окно, в котором диалоговое окно для логотипа является модальным. Если во время вызова диалоговое окно не отображается, параметр  _ulUIParam_ игнорируется. Этот параметр может быть нулем. 
    
 _lpszProfileName_
  
> [in] Указатель на строку, которая содержит имя профиля, используемого при входе пользователя в систему. Эта строка может быть ограничена 64 символами.
    
 _lpszPassword_
  
> [in] Указатель на строку, содержаную пароль профиля. Параметр  _lpszPassword должен_ иметь NULL. 
    
 _flFlags_
  
> [in] Битоваяmas флагов, используемых для управления выполнением логово. Можно установить следующие флаги:
    
MAPI_ALLOW_OTHERS 
  
> Должен быть возвращен общий сеанс, который позволяет последующим клиентам получить сеанс без предоставления учетных данных пользователя. 
    
MAPI_BG_SESSION
  
> Войдите в сеанс и запустите все операции в фоновом режиме. В общем случае, если клиент собирается обрабатывать фоновый поток или отдельный процесс ненавязчивым для потока переднего плана, он должен вызвать флаг MAPI_BG_SESSION. Клиентские приложения, такие как механизм индексации или открытие файла личных папок (PST) для доступа к фоновому типу, являются примерами использования MAPI_BG_SESSION. MAPILogonEx.
    
MAPI_EXPLICIT_PROFILE 
  
> Профиль по умолчанию не следует использовать, и пользователю необходимо предоставить профиль. 
    
MAPI_EXTENDED 
  
> Войдите с расширенными возможностями. Этот флаг всегда должен быть установлен.
    
MAPI_FORCE_DOWNLOAD 
  
> Перед возвратом необходимо попытаться скачать все сообщения пользователя. Если флаг MAPI_FORCE_DOWNLOAD не установлен, сообщения можно скачать в фоновом режиме после возврата вызова MAPILogonEx. 
    
MAPI_LOGON_UI 
  
> При необходимости должно отобразиться диалоговое окно с запросом у пользователя сведений о пользователе. Если флаг MAPI_LOGON_UI не установлен, клиент вызова не отображает диалоговое окно входа и возвращает значение ошибки, если пользователь не вошел в систему.
    
MAPI_NEW_SESSION 
  
> Вместо получения общего сеанса необходимо попытаться создать новый сеанс MAPI. Если флаг MAPI_NEW_SESSION не установлен, MAPILogonEx использует существующий общий сеанс, даже если параметр  _lpszprofileName_ не имеет NULL. 
    
MAPI_NO_MAIL 
  
> MAPI не должен сообщать пулу MAPI о существовании сеанса. В результате в сеансе не может быть отправлено или получено ни одного сообщения, кроме как через тесно сопряженное хранилище и пару транспорта. Вызывающий клиент устанавливает этот флаг, если он действует как агент, если необходимо сделать настройку или если клиент просматривает доступные хранилища сообщений. 
    
MAPI_NT_SERVICE 
  
> Вызываемая служба работает как служба Windows. Вызывателям, которые не работают в качестве службы Windows, не следует устанавливать этот флаг; вызыватели, работающие в качестве службы, должны установить этот флаг. 
    
MAPI_SERVICE_UI_ALWAYS 
  
> MapILogonEx должен отображать диалоговое окно конфигурации для каждой службы сообщений в профиле. Диалоговые окна отображаются после того, как профиль был выбран, но до входа в систему какой-либо службы сообщений. Общее диалоговое окно MAPI для регистрации также содержит поле, которое запрашивает ту же операцию. 
    
MAPI_TIMEOUT_SHORT 
  
> Если он заблокирован более чем на несколько секунд, то при этом не удастся при этом. 
    
MAPI_UNICODE 
  
> Переданные строки имеют формат Юникод. Если флаг MAPI_UNICODE не установлен, строки будут в формате ANSI. 
    
MAPI_USE_DEFAULT 
  
> Подсистема обмена сообщениями должна заменить имя профиля по умолчанию для параметра _lpszProfileName._ Флаг MAPI_EXPLICIT_PROFILE игнорируется, если  _lpszProfileName_ не имеет NULL или не пуст. 
    
 _lppSession_
  
> [out] Указатель на указатель на интерфейс сеанса MAPI.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Успешно вошел в окну.
    
MAPI_E_LOGON_FAILED 
  
> Неудача при запуске из-за того, что один или несколько параметров MAPILogonEx недействительны, или из-за того, что открыто слишком много сеансов.
    
MAPI_E_TIMEOUT 
  
> MAPI сериализует все ведомости с помощью мьютэкса. Возвращается, если флаг MAPI_TIMEOUT_SHORT установлен, а другой поток удерживает мьюex. 
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию, обычно нажав  кнопку "Отмена" в диалоговом окне. 
    
## <a name="remarks"></a>Примечания

Клиентские приложения MAPI звонят функции MAPILogonEx для входа в сеанс с системой обмена сообщениями. Все строки, которые передаются и возвращаются в вызовы MAPI, завершаются с нулью и должны быть указаны в текущем наборе символов или кодовой странице операционной системы вызываемого клиента или поставщика.
  
Параметр  _lpszProfileName_ игнорируется, если существует предыдущий сеанс, который назывался MapiLogonEx с установленным флагом MAPI_ALLOW_OTHERS и если флаг MAPI_NEW_SESSION не установлен. Если параметр  _lpszProfileName_ имеет NULL или указывает на пустую строку, а параметр  _flFlags_ содержит флаг MAPI_LOGON_UI, функция MAPILogonEx создает диалоговое окно для логотипа с пустым полем для имени профиля. 
  
При входе в определенный профиль клиент должен передать флаг MAPI_NEW_SESSION mapILogonEx в дополнение к имени профиля. В противном случае, если другой клиент установил общий сеанс, войдя в систему с помощью MAPI_ALLOW_OTHERS, клиент будет вошел в общий сеанс, а не в запрашиваемом профиле. 
  
Флаг MAPI_EXPLICIT_PROFILE не вызывает использования имени профиля по умолчанию, если  _lpszProfileName_ имеет значение NULL или пуст, если MAPI_USE_DEFAULT флага также присутствует. 
  
Флаг MAPI_NO_MAIL имеет несколько эффектов, которые приводят к следующим последствиям, если не используется пулер MAPI:
  
- В ходе этого сеанса пул mapI не может отправлять и не доставлять сообщения. Отправлять и доставлять сообщения могут только тесно сжатые поставщики услуг хранения и транспорта. 
    
- Серверные хранилища могут по-прежнему отправлять или доставлять сообщения. 
    
- Сообщения, отправленные или доставленные серверным хранилищам, не обрабатываются ни одной службой обработки. 
    
- Параметры транспорта для каждого сообщения и получателя недоступны. 
    
- Таблица состояния не содержит записей для поставщиков транспорта, и все функции транспорта, зависящие от объектов состояния (например, конфигурации), недоступны. 
    
- Строка пула сообщений в таблице состояния содержит STATUS_FAILURE сообщения. 
    
- Разрешены висячие ветви, но они не приводят к тому, что предыдущий при этом не будет получать обновления объектов состояния. 
    
Служба всегда должна входить в систему с помощью MAPI_NO_MAIL флага. 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|MAPIObjects.cpp  <br/> |CMapiObjects::MAPILogonEx  <br/> |MFCMAPI использует метод MAPILogonEx для входа в MAPI.  <br/> |
   
## <a name="see-also"></a>См. также



[IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md)
  
[IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

