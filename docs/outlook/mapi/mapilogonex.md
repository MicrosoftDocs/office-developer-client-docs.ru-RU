---
title: MAPILogonEx
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPILogonEx
api_type:
- HeaderDef
ms.assetid: 98091e5b-1abd-4814-9c7a-583b420ee11d
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9f2ec8f0ec00f7314982e9b112415f69901c358c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33424121"
---
# <a name="mapilogonex"></a>MAPILogonEx

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Регистрирует клиентское приложение в сеансе с системой обмена сообщениями. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Мапикс. h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPILogonEx(
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  LPSTR lpszPassword,
  FLAGS flFlags,
  LPMAPISESSION FAR * lppSession
);
```

## <a name="parameters"></a>Параметры

 _улуипарам_
  
> возврата Дескриптор окна, в котором диалоговое окно входа является модальным. Если во время вызова не отображается диалоговое окно, параметр _улуипарам_ игнорируется. Этот параметр может принимать нулевое значение. 
    
 _лпсзпрофиленаме_
  
> возврата Указатель на строку, содержащую имя профиля, который будет использоваться при входе пользователя в систему. Эта строка ограничена 64 символами.
    
 _лпсзпассворд_
  
> возврата Указатель на строку, содержащую пароль профиля. Параметр _лпсзпассворд_ должен иметь значение null. 
    
 _флфлагс_
  
> возврата Битовая маска флагов, используемых для управления выполнением входа. Можно задать следующие флаги:
    
MAPI_ALLOW_OTHERS 
  
> Должен возвращаться общий сеанс, который позволяет клиентам позже получать сеанс без предоставления учетных данных пользователя. 
    
MAPI_BG_SESSION
  
> Выполните вход в сеанс и выполните все операции в фоновом режиме. Как правило, если клиент планирует выполнить обработку в фоновом потоке или в отдельном процессе, который не может быть недоступен к основному потоку, он должен вызываться с флагом MAPI_BG_SESSION. Клиентское приложение, такое как модуль индексирования или открытие файла личных папок (PST) для доступа к фоновому типу, — некоторые примеры того, где можно использовать MAPI_BG_SESSION. Мапилогонекс.
    
MAPI_EXPLICIT_PROFILE 
  
> Профиль по умолчанию не должен использоваться, и пользователю необходимо предоставить профиль. 
    
MAPI_EXTENDED 
  
> Войдите в систему с расширенными возможностями. Этот флаг должен быть всегда установлен.
    
MAPI_FORCE_DOWNLOAD 
  
> Перед возвратом необходимо выполнить попытку скачивания всех сообщений пользователя. Если флаг MAPI_FORCE_DOWNLOAD не установлен, сообщения можно загружать в фоновом режиме после вызова метода Мапилогонекс. 
    
MAPI_LOGON_UI 
  
> Откроется диалоговое окно с запросом на ввод учетных данных при необходимости. Если флаг MAPI_LOGON_UI не установлен, вызывающий клиент не отображает диалоговое окно входа и возвращает значение ошибки, если пользователь не вошел в систему.
    
MAPI_NEW_SESSION 
  
> Необходимо выполнить попытку создания нового сеанса MAPI вместо получения общего сеанса. Если флаг MAPI_NEW_SESSION не задан, Мапилогонекс использует существующий общий сеанс, даже если параметр _лпсзпрофиленаме_ имеет значение, отличное от NULL. 
    
MAPI_NO_MAIL 
  
> MAPI не должен сообщать диспетчеру MAPI о существовании сеанса. Результат заключается в том, что сообщения не могут быть отправлены или получены в сеансе, за исключением с помощью тесно связанных хранилища и пары транспорта. Вызывающий клиент устанавливает этот флаг, если он действует как агент, если необходимо выполнить действия по настройке, или если клиент выполняет просмотр доступных хранилищ сообщений. 
    
MAPI_NT_SERVICE 
  
> Вызывающий абонент работает как служба Windows. Вызывающие абоненты, которые не работают как служба Windows, не должны устанавливать этот флаг; для абонентов, работающих в качестве службы, необходимо установить этот флаг. 
    
MAPI_SERVICE_UI_ALWAYS 
  
> Мапилогонекс должно отображать диалоговое окно конфигурации для каждой службы сообщений в профиле. Диалоговые окна отображаются после выбора профиля, но перед входом в систему любой службы сообщений. В общем диалоговом окне MAPI для входа также имеется флажок, который запрашивает одну и ту же операцию. 
    
MAPI_TIMEOUT_SHORT 
  
> При блокировании в течение нескольких секунд произойдет ошибка входа в систему. 
    
MAPI_UNICODE 
  
> Переданные строки имеют формат Юникод. Если флаг MAPI_UNICODE не установлен, строки представлены в формате ANSI. 
    
MAPI_USE_DEFAULT 
  
> Подсистема обмена сообщениями должна заменить имя профиля профиля по умолчанию для параметра _лпсзпрофиленаме_ . Флаг MAPI_EXPLICIT_PROFILE игнорируется, если _лпсзпрофиленаме_ не имеет значение null или не задано значение null. 
    
 _лппсессион_
  
> вышли Указатель на указатель на интерфейс сеанса MAPI.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Вход выполнен успешно.
    
MAPI_E_LOGON_FAILED 
  
> Не удалось выполнить вход в систему из-за того, что один или несколько параметров Мапилогонекс недопустимы или в связи с тем, что уже открыто слишком много сеансов.
    
MAPI_E_TIMEOUT 
  
> MAPI сериализует все входы в систему с помощью мьютекса. Возвращается, если установлен флаг MAPI_TIMEOUT_SHORT и другой поток удерживал мьютекс. 
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне. 
    
## <a name="remarks"></a>Примечания

Клиентские приложения MAPI вызывают функцию Мапилогонекс для входа в сеанс с системой обмена сообщениями. Все строки, которые передаются и возвращаются из вызовов MAPI, завершаются нулем и должны быть указаны в текущем наборе символов или на странице кодов в операционной системе клиента или поставщика.
  
Параметр _лпсзпрофиленаме_ игнорируется, если существует предыдущий сеанс, вызвавший мапилогонекс с установленным флагом MAPI_ALLOW_OTHERS и если флаг MAPI_NEW_SESSION не задан. Если параметр _лпсзпрофиленаме_ имеет значение null или указывает на пустую строку, а параметр _флфлагс_ содержит флаг MAPI_LOGON_UI, функция мапилогонекс создает диалоговое окно входа с пустым полем для имени профиля. 
  
При входе в определенный профиль клиент должен передать MAPI_NEW_SESSIONный флаг в Мапилогонекс в дополнение к имени профиля. В противном случае, если другой клиент установил общий сеанс, войдя в систему MAPI_ALLOW_OTHERS, то клиент будет входить в общий сеанс, а не в запрошенный профиль. 
  
Флаг MAPI_EXPLICIT_PROFILE не приводит к использованию имени профиля по умолчанию, если _лпсзпрофиленаме_ имеет значение null, или пустое значение, если также не указан флаг MAPI_USE_DEFAULT. 
  
Флаг MAPI_NO_MAIL имеет несколько эффектов, которые приводят к возникновению следующего, если не используется диспетчер очереди MAPI:
  
- В течение этого сеанса Диспетчер очереди MAPI не может отправлять или доставлять сообщения. Только тесно связанные поставщики услуг хранения и транспорта могут отправлять и доставлять сообщения. 
    
- Хранилища на сервере могут по-прежнему отправлять и доставлять сообщения. 
    
- Сообщения, отправленные или доставляемые хранилищами на сервере, не обрабатываются какими-либо поставщиками обработчиков. 
    
- Параметры для отдельных сообщений и получателей для транспортов недоступны. 
    
- Таблица Status не содержит записей для поставщиков транспорта, а все функции транспорта, зависящие от объектов Status (например, Configuration), недоступны. 
    
- Строка "Диспетчер очереди сообщений" в таблице "состояние" содержит значение STATUS_FAILURE. 
    
- Вход в пиггибаккед разрешен, но эти входы не приводят к предыдущему входу в систему для получения обновлений объекта Status. 
    
Служба всегда должна входить в систему с помощью флага MAPI_NO_MAIL. 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Мапиобжектс. cpp  <br/> |Кмапиобжектс:: Мапилогонекс  <br/> |MFCMAPI использует метод Мапилогонекс для входа в MAPI.  <br/> |
   
## <a name="see-also"></a>См. также



[IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md)
  
[IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

