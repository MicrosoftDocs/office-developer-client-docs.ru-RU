---
title: MAPILogonEx
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPILogonEx
api_type:
- HeaderDef
ms.assetid: 98091e5b-1abd-4814-9c7a-583b420ee11d
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9f2ec8f0ec00f7314982e9b112415f69901c358c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33424121"
---
# <a name="mapilogonex"></a>MAPILogonEx

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Журналы клиентского приложения на сеанс с системой обмена сообщениями. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapix.h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPILogonEx(
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  LPSTR lpszPassword,
  FLAGS flFlags,
  LPMAPISESSION FAR * lppSession
);
```

## <a name="parameters"></a>Parameters

 _ulUIParam_
  
> [in] Ручка к окну, к которому диалоговое окно логотипа является модальным. Если во время вызова диалоговое окно не отображается,  _параметр ulUIParam_ игнорируется. Этот параметр может быть нулем. 
    
 _lpszProfileName_
  
> [in] Указатель на строку, которая содержит имя профиля, используемого при входе пользователя в систему. Эта строка ограничена 64 символами.
    
 _lpszPassword_
  
> [in] Указатель на строку, содержаную пароль профиля. Параметр  _lpszPassword должен_ быть NULL. 
    
 _flFlags_
  
> [in] Bitmask флагов, используемых для управления выполнением логотипа. Можно установить следующие флаги:
    
MAPI_ALLOW_OTHERS 
  
> Общий сеанс должен быть возвращен, что позволяет более поздним клиентам получать сеанс без предоставления учетных данных пользователей. 
    
MAPI_BG_SESSION
  
> Войдите в сеанс и запустите все операции в фоновом режиме. В общем случае, если клиент намерен делать обработку на фоновом потоке или в отдельном процессе ненавязчивым для переднего плана потоком, он должен вызывать его с MAPI_BG_SESSION флагом. Клиентские приложения, такие как двигатель индексации или открытие файла персональных папок (PST) для доступа к фоновому типу, являются примерами использования MAPI_BG_SESSION. MAPILogonEx.
    
MAPI_EXPLICIT_PROFILE 
  
> Не следует использовать профиль по умолчанию, и пользователю необходимо предоставить профиль. 
    
MAPI_EXTENDED 
  
> Войдите в систему с расширенными возможностями. Этот флаг всегда должен быть заданной.
    
MAPI_FORCE_DOWNLOAD 
  
> Перед возвращением необходимо скачать все сообщения пользователя. Если флаг MAPI_FORCE_DOWNLOAD не установлен, сообщения можно скачать в фоновом режиме после возврата вызова в MAPILogonEx. 
    
MAPI_LOGON_UI 
  
> Диалоговое окно должно отображаться, чтобы при необходимости подсказыть пользователю сведения о логотипе. Если флаг MAPI_LOGON_UI не установлен, клиент-вызов не отображает диалоговое окно с логотипом и возвращает значение ошибки, если пользователь не вошел в систему.
    
MAPI_NEW_SESSION 
  
> Следует предпринять попытку создания нового сеанса MAPI вместо приобретения общего сеанса. Если флаг MAPI_NEW_SESSION не установлен, MAPILogonEx использует существующий общий сеанс, даже если параметр  _lpszprofileName_ не является NULL. 
    
MAPI_NO_MAIL 
  
> MAPI не должна информировать шпалер MAPI о существовании сеанса. В результате в сеансе не может быть отправлено или получено сообщение, за исключением тесной пары магазинов и транспорта. Клиент-вызов задает этот флаг, если он действует как агент, если необходимо сделать работу по настройке или если клиент просматривает доступные хранилища сообщений. 
    
MAPI_NT_SERVICE 
  
> Вызываемая служба работает в качестве Windows службы. Вызыватели, которые не работают в качестве Windows службы, не должны устанавливать этот флаг; Вызыватели, работающие в качестве службы, должны установить этот флаг. 
    
MAPI_SERVICE_UI_ALWAYS 
  
> MAPILogonEx должен отображать диалоговое окно конфигурации для каждой службы сообщений в профиле. Диалоговые окна отображаются после того, как был выбран профиль, но перед входом в систему любой службы сообщений. Общий диалоговое окно MAPI для logon также содержит чековое поле, которое запрашивает ту же операцию. 
    
MAPI_TIMEOUT_SHORT 
  
> Логон должен сбой, если он заблокирован более чем на несколько секунд. 
    
MAPI_UNICODE 
  
> Переданные строки находятся в формате Unicode. Если флаг MAPI_UNICODE не установлен, строки находятся в формате ANSI. 
    
MAPI_USE_DEFAULT 
  
> Подсистема обмена сообщениями должна заменить имя профиля профиля по умолчанию для _параметра lpszProfileName._ Флаг MAPI_EXPLICIT_PROFILE, если  _lpszProfileName_ не является NULL или пустым. 
    
 _lppSession_
  
> [вышел] Указатель на указатель на интерфейс сеанса MAPI.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Логотип удалось.
    
MAPI_E_LOGON_FAILED 
  
> Логотип был неудачным либо из-за того, что один или несколько параметров MAPILogonEx были недействительны, либо из-за того, что было открыто слишком много сеансов.
    
MAPI_E_TIMEOUT 
  
> MAPI сериализует все логотипы через мутекс. Это возвращается, если MAPI_TIMEOUT_SHORT был установлен флаг и другой поток удерживает mutex. 
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне. 
    
## <a name="remarks"></a>Примечания

Клиентские приложения MAPI называют функцию MAPILogonEx для входа в сеанс с системой обмена сообщениями. Все строки, которые передаются и возвращаются на вызовы MAPI и обратно, не прекращаются и должны быть указаны в текущем наборе символов или на странице кода операционной системы вызываемого клиента или поставщика.
  
Параметр  _lpszProfileName_ игнорируется, если существует существующая предыдущая сессия, называемая MapiLogonEx с набором флага MAPI_ALLOW_OTHERS и если флаг MAPI_NEW_SESSION не установлен. Если параметр  _lpszProfileName_ является NULL или указывает на пустую строку, а параметр  _flFlags_ включает флаг MAPI_LOGON_UI, функция MAPILogonEx создает диалоговое окно с пустым полем для имени профиля. 
  
При входе в определенный профиль клиент должен передать флаг MAPI_NEW_SESSION в MAPILogonEx в дополнение к имени профиля. В противном случае, если другой клиент создал общий сеанс, войдя в MAPI_ALLOW_OTHERS, клиент будет вошел в общий сеанс, а не в запрашиваемом профиле. 
  
Флаг MAPI_EXPLICIT_PROFILE не вызывает использования имени профиля по умолчанию, если  _lpszProfileName_ является NULL или пуст, если MAPI_USE_DEFAULT флаг также присутствует. 
  
Флаг MAPI_NO_MAIL имеет несколько эффектов, которые вызывают следующее при не использовании шпалер MAPI:
  
- Во время этого сеанса шпалер MAPI не может отправлять или отправлять сообщения. Отправлять и доставлять сообщения могут только тесно скрепив магазины и поставщики транспорта. 
    
- Серверные магазины по-прежнему могут отправлять или доставлять сообщения. 
    
- Сообщения, отправленные или доставленные в хранилищах на сервере, не обрабатываются поставщиками крючков. 
    
- Параметры переноса для каждого сообщения и каждого получателя недоступны. 
    
- В таблице состояния не содержатся записи для поставщиков транспорта, а любые функции транспорта, зависящие от объектов состояния (например, конфигурации), недоступны. 
    
- Строка spooler сообщения в таблице состояния содержит значение STATUS_FAILURE. 
    
- Разрешены логотипы с копией, но эти логотипы не приводят к тому, что предыдущий логотип получает обновления объектов состояния. 
    
Служба всегда должна войти в систему с MAPI_NO_MAIL флагом. 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|MAPIObjects.cpp  <br/> |CMapiObjects::MAPILogonEx  <br/> |MFCMAPI использует метод MAPILogonEx для входа в MAPI.  <br/> |
   
## <a name="see-also"></a>См. также



[IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md)
  
[IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

