---
title: Основной идентификатор MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8787a873-6752-4b17-8ea3-8fed793e1371
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 5bf88de280b012c54d4caaac6bdfe877f476ac37
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33404724"
---
# <a name="mapi-primary-identity"></a>Основной идентификатор MAPI

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
В большинстве сеансов MAPI имеется определенный поставщик услуг, который обеспечивает основные удостоверения для сеанса. Как правило, это поставщик адресных книг, который поставляет удостоверения через один из объектов пользователя обмена сообщениями или списки рассылки. В действительности MAPI рекомендует службам сообщений, включающих поставщика адресных книг, использовать один из его объектов для основного удостоверения. Когда поставщик услуг, принадлежащий службе сообщений, передает основной идентификатор, все другие поставщики услуг в службе сообщений делятся этим удостоверением.
  
The MAPISVC. Файл конфигурации INF имеет записи, относящиеся к удостоверению, как на уровне службы сообщений, так и поставщика услуг. Разделы службы сообщений должны включать запись, в которую должна быть включена запись о том, может ли служба предоставить первичную удостоверение; Разделы поставщика услуг включают аналогичную запись только в том случае, если поставщик может предоставить удостоверение.
  
В следующей таблице перечислены записи, которые отображаются в разделах служба сообщений и поставщик услуг в MAPISVC. Файл INF.
  
|**Основной поставщик удостоверений**|**PR_RESOURCE_FLAGS**|
|:-----|:-----|
|Служба сообщений  <br/> | `SERVICE_PRIMARY_IDENTITY` <br/> |
|Не служба сообщений  <br/> | `SERVICE_NO_PRIMARY_IDENTITY` <br/> |
|Поставщик услуг  <br/> | `STATUS_PRIMARY_IDENTITY` <br/> |
   
Несмотря на то, что несколько служб сообщений могут объявить о своей способности предоставлять основные удостоверения сеанса, для этого выбрана только одна служба сообщений. Этот выбор может произойти:
  
- Когда создается профиль.
    
- Когда клиент вызывает **IMsgServiceAdmin::SetPrimaryIdentity,** чтобы явно установить определенную службу сообщений в качестве поставщика удостоверения сеанса. Дополнительные сведения. См. [iMsgServiceAdmin::SetPrimaryIdentity](imsgserviceadmin-setprimaryidentity.md).
    
Когда создается профиль, MAPI назначает первую настроенную службу сообщений, которая включает поставщика с флагом STATUS_PRIMARY_IDENTITY в его свойстве **PR_RESOURCE_FLAGS** [(PidTagResourceFlags)](pidtagresourceflags-canonical-property.md)для поставки основного удостоверения. В назначенной службе сообщений выбирается первый поставщик, настроенный с этим набором флагов ресурсов, чтобы предоставить удостоверение службы. Флаг STATUS_PRIMARY_IDENTITY для всех других поставщиков в указанной службе и других службах сообщений в профиле. Если в любое время поставщик, поставляющий первичные удостоверения, удаляется из профиля, MAPI назначает роль следующему поставщику, который будет настроен, который может предоставить удостоверение. Это определяется появлением записи в разделе поставщика  `PR_RESOURCE_FLAGS=STATUS_PRIMARY_IDENTITY` в MAPISVC.INF. 
  
Когда клиент вызывает метод **IMsgServiceAdmin::SetPrimaryIdentity** службы сообщений, он указывает MAPIUID для поставщика услуг в целевой службе. Дополнительные сведения см. [в mapIUID.](mapiuid.md) Поставщик услуг, представленный **MAPIUID,** должен предоставить основное удостоверение для службы сообщений и сеанса, и все другие поставщики в службе будут делиться этим удостоверением. 
  
Каждый поставщик в службе сообщений, ответственный за поставку основного удостоверения, обновляет строку в таблице состояния, чтобы включить следующие свойства.
  
|**Основное свойство удостоверений**|**Установлено, что**|
|:-----|:-----|
|**PR_IDENTITY_DISPLAY** [(PidTagIdentityDisplay)](pidtagidentitydisplay-canonical-property.md)  <br/> |Отображение имени объекта, снабжающего основной идентификатор.  <br/> |
|**PR_IDENTITY_SEARCH_KEY** [(PidTagIdentitySearchKey)](pidtagidentitysearchkey-canonical-property.md)  <br/> |Поиск ключа для объекта, снабжающего основной идентификатор.  <br/> |
|**PR_IDENTITY_ENTRYID** [(PidTagIdentityEntryId)](pidtagidentityentryid-canonical-property.md)  <br/> |Идентификатор входа для объекта, снабжающего основной идентификатор.  <br/> |
   
 **Извлечение идентификатора записи для объекта, снабжающего основной идентификатор**
  
- Вызов метода **IMAPISession::QueryIdentity.** Дополнительные сведения см. [в iMAPISession::QueryIdentity.](imapisession-queryidentity.md) **QueryIdentity** выполняет поиск таблицы состояния строки, которая содержит значение STATUS_PRIMARY_IDENTITY в столбце  **PR_RESOURCE_FLAGS** и возвращает соответствующий PR_IDENTITY_ENTRYID в качестве идентификатора входа для основного удостоверения. 
    

