---
title: Основное удостоверение MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8787a873-6752-4b17-8ea3-8fed793e1371
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 5bf88de280b012c54d4caaac6bdfe877f476ac37
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33404724"
---
# <a name="mapi-primary-identity"></a>Основное удостоверение MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Большинство сеансов MAPI имеют определенного поставщика услуг, который обеспечивает основное удостоверение для сеанса. Как правило, это поставщик адресной книги, который обеспечивает удостоверения через один из объектов пользователей системы обмена сообщениями или списков рассылки. В действительности MAPI рекомендует службам сообщений, включающего поставщика адресной книги, использовать один из его объектов для основного удостоверения. Когда поставщик услуг, принадлежащий службе сообщений, передает основное удостоверение, все остальные поставщики услуг в службе сообщений имеют это удостоверение.
  
The MAPISVC. InF-файл конфигурации имеет записи, относящиеся к удостоверению как на уровне службы сообщений, так и на уровне поставщика службы. Разделы службы сообщений должны включать запись, которая сообщает, может ли служба предоставить основное удостоверение; Разделы поставщика услуг включают аналогичную запись, только если поставщик может предоставить удостоверение.
  
В следующей таблице перечислены записи, которые отображаются в разделах службы сообщений и поставщиков служб в MAPISVC. INF-файл.
  
|**Основной поставщик удостоверений**|**PR_RESOURCE_FLAGS параметра**|
|:-----|:-----|
|Служба сообщений  <br/> | `SERVICE_PRIMARY_IDENTITY` <br/> |
|Не служба сообщений  <br/> | `SERVICE_NO_PRIMARY_IDENTITY` <br/> |
|Поставщик услуг  <br/> | `STATUS_PRIMARY_IDENTITY` <br/> |
   
Хотя несколько служб сообщений могут объявить свою способность предоставлять основное удостоверение сеанса, для этого выбрана только одна служба сообщений. Этот выбор может произойти:
  
- При этом создается профиль.
    
- Когда клиент вызывает **IMsgServiceAdmin::SetPrimaryIdentity,** чтобы явно установить определенную службу сообщений в качестве поставщика удостоверения сеанса. Дополнительные сведения. См. [IMsgServiceAdmin::SetPrimaryIdentity.](imsgserviceadmin-setprimaryidentity.md)
    
После создания профиля MAPI назначает первую настраиваемую службу сообщений, которая включает поставщика с флагом STATUS_PRIMARY_IDENTITY, установленным в свойстве **PR_RESOURCE_FLAGS** ([PidTagResourceFlags),](pidtagresourceflags-canonical-property.md)чтобы предоставить основное удостоверение. В назначенной службе сообщений выбирается первый поставщик, который будет настроен с этим набором флагов ресурсов, чтобы предоставить удостоверение для службы. Флаг STATUS_PRIMARY_IDENTITY для всех остальных поставщиков в указанной службе и других службах сообщений в профиле. Если поставщик, который в любой момент передает основное удостоверение, удаляется из профиля, MAPI назначает роль следующему настраиваемому поставщику, который может предоставить удостоверение. Это определяется внешним видом записи в разделе поставщика  `PR_RESOURCE_FLAGS=STATUS_PRIMARY_IDENTITY` в MAPISVC.INF. 
  
Когда клиент вызывает метод **IMsgServiceAdmin::SetPrimaryIdentity** службы сообщений, он указывает MAPIUID для поставщика службы в целевой службе. Дополнительные сведения см. в [mapIUID.](mapiuid.md) Поставщику услуг, представленного **MAPIUID,** назначено предоставить основное удостоверение для службы сообщений и для сеанса, и все остальные поставщики в службе будут совместно работать с этим удостоверением. 
  
Каждый поставщик в службе сообщений, отвечающий за обеспечение основного удостоверения, обновляет свою строку в таблице состояния, включая следующие свойства.
  
|**Свойство основного удостоверения**|**За установлено**|
|:-----|:-----|
|**PR_IDENTITY_DISPLAY** ([PidTagIdentityDisplay)](pidtagidentitydisplay-canonical-property.md)  <br/> |Отображает имя объекта, который является основным удостоверением.  <br/> |
|**PR_IDENTITY_SEARCH_KEY** ([PidTagIdentitySearchKey)](pidtagidentitysearchkey-canonical-property.md)  <br/> |Ключ поиска для объекта, который является основным удостоверением.  <br/> |
|**PR_IDENTITY_ENTRYID** ([PidTagIdentityEntryId)](pidtagidentityentryid-canonical-property.md)  <br/> |Идентификатор записи для объекта, который указывает основное удостоверение.  <br/> |
   
 **Извлечение идентификатора записи для объекта, который указывает основное удостоверение**
  
- Вызовите **метод IMAPISession::QueryIdentity.** Дополнительные сведения см. в [подразделе IMAPISession::QueryIdentity.](imapisession-queryidentity.md) **QueryIdentity** выполняет поиск строки в таблице состояния, содержаной значение STATUS_PRIMARY_IDENTITY в столбце  **PR_RESOURCE_FLAGS,** и возвращает соответствующий PR_IDENTITY_ENTRYID в качестве идентификатора записи для основного удостоверения. 
    

