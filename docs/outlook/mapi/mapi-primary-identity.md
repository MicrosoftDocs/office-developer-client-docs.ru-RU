---
title: Основной идентификатор MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8787a873-6752-4b17-8ea3-8fed793e1371
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 5bf88de280b012c54d4caaac6bdfe877f476ac37
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33404724"
---
# <a name="mapi-primary-identity"></a>Основной идентификатор MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Большинство сеансов MAPI имеют определенного поставщика услуг, который предоставляет основной идентификатор для сеанса. Как правило, это поставщик адресных книг, который обеспечивает идентификацию через один из объектов пользователя обмена сообщениями или списков рассылки. По сути, MAPI рекомендует, чтобы службы сообщений, которые включают поставщика адресных книг, использовали один из ее объектов для основного удостоверения. Если поставщик услуг, принадлежащий службе сообщений, предоставляет основное удостоверение, все остальные поставщики услуг в службе сообщений совместно используют это удостоверение.
  
MAPISVC. INF-файл конфигурации содержит записи, связанные с удостоверениями как на уровне службы сообщений, так и на уровне поставщика услуг. Разделы службы сообщений должны включать запись, в которой указывается, может ли служба указать основной идентификатор; разделы поставщика услуг содержат Похожие записи, только когда поставщик может предоставить удостоверение.
  
В следующей таблице перечислены записи, которые отображаются в разделах "Служба сообщений" и "поставщик услуг" в MAPISVC. INF-файл.
  
|**Первичный поставщик удостоверений**|**Параметр PR_RESOURCE_FLAGS**|
|:-----|:-----|
|Служба сообщений  <br/> | `SERVICE_PRIMARY_IDENTITY` <br/> |
|Не служба сообщений  <br/> | `SERVICE_NO_PRIMARY_IDENTITY` <br/> |
|Поставщик услуг  <br/> | `STATUS_PRIMARY_IDENTITY` <br/> |
   
Хотя несколько служб сообщений могут объявлять свои возможности для предоставления основного удостоверения сеанса, для этого выбирается только одна служба сообщений. Это может произойти по следующим параметрам:
  
- При создании профиля.
    
- Когда клиент вызывает метод **имсгсервицеадмин:: сетпримаридентити** , чтобы явно установить определенную службу сообщений в качестве поставщика удостоверения сеанса. Для получения дополнительных сведений. См. [имсгсервицеадмин:: сетпримаридентити](imsgserviceadmin-setprimaryidentity.md).
    
При создании профиля MAPI определяет первую службу сообщений, которая включает поставщик с флагом STATUS_PRIMARY_IDENTITY, установленным в свойстве **PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) для предоставления основного удостоверения. В назначенной службе сообщений первый поставщик, который необходимо настроить с помощью этого набора флагов ресурсов, выбирается для предоставления удостоверения службы. Флаг STATUS_PRIMARY_IDENTITY снимается для всех других поставщиков в указанной службе и других службах сообщений в профиле. Если поставщик поставляет первичное удостоверение из профиля, MAPI назначает роль следующему поставщику для настройки, которая может предоставлять удостоверение. Это определяется внешним видом `PR_RESOURCE_FLAGS=STATUS_PRIMARY_IDENTITY` записи в разделе поставщика в Mapisvc. INF. 
  
Когда клиент вызывает метод **имсгсервицеадмин:: сетпримаридентити** службы сообщений, он определяет мапиуид для поставщика услуг в целевой службе. Дополнительные сведения см. в разделе [мапиуид](mapiuid.md). Поставщик услуг, представленный **мапиуид** , назначается для предоставления основного удостоверения для службы сообщений и для сеанса, а все остальные поставщики в службе будут совместно использовать это удостоверение. 
  
Каждый поставщик в службе сообщений, ответственный за предоставление основного идентификатора, обновляет строку в таблице состояния, чтобы включить следующие свойства.
  
|**Основное свойство Identity**|**Значение**|
|:-----|:-----|
|**PR_IDENTITY_DISPLAY** ([PidTagIdentityDisplay](pidtagidentitydisplay-canonical-property.md))  <br/> |Отображаемое имя объекта, предоставляющего Основное удостоверение.  <br/> |
|**PR_IDENTITY_SEARCH_KEY** ([PidTagIdentitySearchKey](pidtagidentitysearchkey-canonical-property.md))  <br/> |Ключ поиска для объекта, предоставляющего Основное удостоверение.  <br/> |
|**PR_IDENTITY_ENTRYID** ([PidTagIdentityEntryId](pidtagidentityentryid-canonical-property.md))  <br/> |Идентификатор записи для объекта, предоставляющего Основное удостоверение.  <br/> |
   
 **Получение идентификатора записи для объекта, предоставляющего Основное удостоверение**
  
- Вызовите метод **IMAPISession:: куеридентити** . Дополнительные сведения см. в статье [IMAPISession:: куеридентити](imapisession-queryidentity.md). **Куеридентити** ищет в таблице состояние строку, содержащую значение, STATUS_PRIMARY_IDENTITY в **PR_RESOURCE_FLAGS** столбце и возвращает соответствующий **PR_IDENTITY_ENTRYID** в качестве идентификатора записи для основного удостоверения. 
    

