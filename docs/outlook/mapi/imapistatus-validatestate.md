---
title: имапистатусвалидатестате
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIStatus.ValidateState
api_type:
- COM
ms.assetid: 036b9b15-86e1-4a37-8e4b-e37b2963d8fb
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: adcdf04653f8c9fed2ecc6520648abd3acd36134
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438150"
---
# <a name="imapistatusvalidatestate"></a>IMAPIStatus::ValidateState

**Относится к**: Outlook 2013 | Outlook 2016 
  
Проверяет внешние сведения о состоянии, доступные для ресурса MAPI или поставщика услуг. Этот метод поддерживается во всех объектах Status. 
  
```cpp
HRESULT ValidateState(
  ULONG_PTR ulUIParam,
  ULONG ulFlags
);
```

## <a name="parameters"></a>Параметры

_улуипарам_
  
> возврата Дескриптор родительского окна всех диалоговых окон и окон, отображаемых данным методом.
    
_ulFlags_
  
> возврата Битовая маска флагов, управляющих проверкой. Можно задать следующие флаги:
    
ABORT_XP_HEADER_OPERATION
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в соответствующем диалоговом окне. Объект Status имеет два параметра: 
    
   - Продолжайте работу над операцией.
    
   - Остановите операцию и возвратите MAPI_E_USER_CANCELED.
    
CONFIG_CHANGED 
  
> Изменилось одно или несколько свойств конфигурации объекта Status. Клиенты могут установить этот флаг, чтобы диспетчер очереди MAPI мог динамически устранять критические сбои поставщика транспорта. 
    
FORCE_XP_CONNECT 
  
> Объект Status должен выполнить подключение. Если этот флаг используется с флагом REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE, подключение выполняется без кэширования.
    
FORCE_XP_DISCONNECT 
  
> Объект Status должен выполнить операцию отключения. Если этот флаг используется с флагом REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE, отключение происходит без кэширования.
    
PROCESS_XP_HEADER_CACHE 
  
> Записи в таблице кэша заголовков должны быть обработаны, все сообщения, отмеченные флажком MSGSTATUS_REMOTE_DOWNLOAD, будут скачаны, а все сообщения, помеченные флагом MSGSTATUS_REMOTE_DELETE, должны быть удалены. Сообщения, у которых есть как MSGSTATUS_REMOTE_DOWNLOAD, так и MSGSTATUS_REMOTE_DELETE Set, должны быть перемещены.
    
REFRESH_XP_HEADER_CACHE 
  
> Для удаленного поставщика транспорта необходимо скачать новый список заголовков сообщений, а все флаги, помечающие состояние сообщения, следует очистить.
    
SUPPRESS_UI 
  
> Запрещает отображение в объекте status пользовательского интерфейса в рамках операции.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Проверка прошла успешно.
    
MAPI_E_BUSY 
  
> Выполняется другая операция; ее выполнение должно быть разрешено или остановлено до инициирования этой операции.
    
MAPI_E_NO_SUPPORT 
  
> Объект Status не поддерживает метод проверки, как указано в отсутствие флага STATUS_VALIDATE_STATE в свойстве **PR_RESOURCE_METHODS** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)).
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию проверки, как правило, нажав кнопку **Отмена** в диалоговом окне. Это значение возвращается только удаленными поставщиками транспорта. 
    
## <a name="remarks"></a>Примечания

Метод **имапистатус:: валидатестате** проверяет состояние ресурса, связанного с объектом Status. **Валидатестате** — единственный метод в интерфейсе [имапистатус](imapistatusimapiprop.md) , необходимый для всех объектов Status. Точное поведение этого метода зависит от реализации. В следующей таблице описывается реализация каждого из различных типов объектов Status. 
  
|**Объект Status**|Реализация Валидатестате * * * *|
|:-----|:-----|
|Подсистема MAPI  <br/> |Проверяет состояние всех ресурсов, которыми владеет текущий активный поставщик услуг и сама подсистема.  <br/> |
|Диспетчер очереди MAPI  <br/> |Выполняет вход в систему для всех поставщиков транспорта независимо от того, были ли они уже зарегистрированы.  <br/> |
|Адресная книга MAPI  <br/> |Проверяет записи в разделе профиля.  <br/> |
|Поставщик услуг  <br/> |Реализация зависит от типа поставщика и флагов, заданные в параметре _ulFlags_ .  <br/> |
   
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Удаленные клиентские приложения вызывают метод **валидатестате** , чтобы запустить удаленную обработку для различных действий. Этот метод в основном существует для установки битов состояния для общения с диспетчером очереди MAPI, а не для фактического выполнения какой – либо работы. Как правило, поставщик транспорта устанавливает флаги в строке состояния, указывающие на очередь MAPI, какие действия необходимо инициировать для выполнения запроса клиента. 

В этой модели взаимодействия клиента с транспортным сервером действия, запрашиваемые клиентом, выполняются асинхронно, в то же **валидатестате** возвращаются до выполнения запрошенных действий. Однако действия, которые не включают в себя базовую систему обмена сообщениями или которые используют интерфейс, связанный с транспортом, могут быть синхронными. Клиентское приложение передает битовую маску следующих флагов, чтобы указать, какие действия должен выполнять удаленный поставщик транспорта. 
  
ABORT_XP_HEADER_OPERATION 
  
> Если это возможно, удаленный поставщик транспорта должен отменить все операции, которые включают загрузку заголовков. Для этого поставщик транспорта должен задать следующие значения свойств в строке состояния объекта входа:
    
   - Снимите флажки STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVEные биты в свойстве **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)), чтобы указать для диспетчера очереди MAPI остановить входящий процесс очистки для этого поставщика транспорта.
    
   - Установите бит STATUS_OFFLINE в свойстве **PR_STATUS_CODE** . 
    
   - Задайте для свойства **PR_REMOTE_VALIDATE_OK** ([PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)) значение true.
    
   - Задайте для свойства **PR_STATUS_STRING** ([PidTagStatusString](pidtagstatusstring-canonical-property.md)) строку, которая указывает состояние поставщика транспорта для пользователя.
    
   - Возврат S_OK. Однако если не удается отменить выполняемую операцию, **валидатестате** должен возвратить MAPI_E_BUSY. 
    
FORCE_XP_CONNECT 
  
> Удаленный поставщик транспорта не должен устанавливать подключение к общему ресурсу (например, модем или COM-порт) за пределами контекста диалога MAPI-Transport, используемого в методе [иксплогон:: FlushQueues](ixplogon-flushqueues.md) . Если **валидатестате** вызывается с этим флагом, ваш поставщик транспорта должен выполнить следующие действия: 
    
   - Установите флаг внутреннего состояния, чтобы указать, что удаленное подключение должно быть установлено при вызове метода **иксплогон:: FlushQueues** . 
    
   - Задайте правильные значения в таблице состояние, чтобы диспетчер очереди MAPI инициировал процесс очистки очереди.
    
   - После завершения очистки очередей Освободите общий ресурс.
    
   - Очистите STATUS_OFFLINE бит в свойстве **PR_STATUS_CODE** . 
    
   - Возврат S_OK.
    
FORCE_XP_DISCONNECT 
  
> Удаленный поставщик транспорта должен освободить свое подключение к системным ресурсам системы обмена сообщениями. После этого необходимо установить бит STATUS_OFFLINE в свойстве **PR_STATUS_CODE** и вернуть S_OK. 
    
PROCESS_XP_HEADER_CACHE 
  
> Удаленный поставщик транспорта должен обрабатывать удаленные сообщения и отправлять сообщения, которые были отложены. Для этого поставщик транспорта должен задать следующие значения свойств в строке состояния объекта входа:
    
   - Задайте для свойства **PR_STATUS_STRING** строку, которая указывает состояние поставщика транспорта для пользователя. 
    
   - Задайте STATUS_OUTBOUND_ENABLED и STATUS_OUTBOUND_ACTIVE бит в свойстве **PR_STATUS_CODE** . 
    
   - Задайте для свойства **PR_REMOTE_VALIDATE_OK** в строке состояния поставщика транспорта значение false. 
    
   - Если выполняется другая операция (например, Загрузка заголовков) при вызове **валидатестате** , **валидатестате** должен возвращать MAPI_E_BUSY. 
    
   - Выполните код для обработки флага REFRESH_XP_HEADER_CACHE, а также для удовлетворения требований клиента Microsoft Exchange.
    
REFRESH_XP_HEADER_CACHE 
  
> Удаленный поставщик транспорта должен получить все новые заголовки сообщений из системы обмена сообщениями. Для этого поставщик транспорта должен выполнить следующие действия:
    
   - Задайте для свойства **PR_STATUS_STRING** строку, которая указывает состояние поставщика транспорта для пользователя. 
    
   - Задайте STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE бит в свойстве **PR_STATUS_CODE** . 
    
   - Очистите STATUS_OFFLINE бит в свойстве **PR_STATUS_CODE** . 
    
   - Установите бит STATUS_ONLINE в свойстве **PR_STATUS_CODE** . 
    
   - Задайте для свойства **PR_REMOTE_VALIDATE_OK** в строке состояния поставщика транспорта значение false. 
    
SHOW_XP_SESSION_UI 
  
> Если у поставщика транспорта есть какие-либо фрагменты пользовательского интерфейса для обработки заголовков сообщений (например, диалоговое окно, которое подтверждает загрузку сообщений), откроется диалоговое окно. В противном случае **валидатестате** может вернуть MAPI_E_NO_SUPPORT. 
    
Если передаются любые другие флаги, **валидатестате** должен возвратить MAPI_E_UNKNOWN_FLAGS. 
  
Клиентский вызов поставщика транспорта часто будет поддерживать метод **имапистатус:: валидатестате** . При обработке **валидатестате**поставщик транспорта не должен выполнять никакие действия, которые выделяют недостаточные системные ресурсы, например модем или COM-порт. Это связано с тем, что диспетчеру MAPI иногда потребуется сбрасывать очереди на нескольких поставщиках транспорта. Тем не менее, клиент может в любой момент вызвать любой метод **валидатестате** поставщика транспорта. Если поставщик транспорта пытается выделить неограниченный ресурс во время обработки **валидатестате**, ошибка может возникать из-за конфликта с другим поставщиком транспорта, в котором диспетчер очереди MAPI предписывает очистить очереди. Если вы разрешите все неограниченные выделения ресурсов при использовании очереди печати MAPI, можно избежать подобных конфликтов. Поставщик транспорта должен поддерживать свойство **PR_REMOTE_VALIDATE_OK** , чтобы клиентские приложения могли определять, когда поставщик транспорта занят или ожидает, что диспетчер очереди MAPI начинает действие. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Так как этот метод может привести к выполнению других потенциально длительных вызовов, **валидатестате** может вернуть MAPI_E_BUSY, чтобы сообщить о том, что этот метод ожидает завершения другой операции. Перед попыткой выполнения другой задачи необходимо дождаться завершения ожидающей операции. 
  
Вы можете управлять вызовами объектов состояния поставщика транспорта. В **валидатестате** можно передать один или несколько флагов, которые влияют на операции поставщика транспорта. Например, флаг ABORT_XP_HEADER_OPERATION указывает, что пользователь отменил проверку. Поставщики транспорта могут отменить операцию, возвращая MAPI_E_USER_CANCELED или продолжить. 
  
Можно установить флаг CONFIG_CHANGED для вызова в объект Status поставщика услуг или в диспетчере очереди MAPI, чтобы указать, что параметр конфигурации был изменен. Для динамической перенастройки поставщика транспорта можно использовать CONFIG_CHANGED. Когда вы задаете CONFIG_CHANGED при вызове к объекту Status поставщика услуг, поставщик реагирует на вызов [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) для оповещения ДИСПЕТЧЕРА очереди MAPI об изменении. Когда вы задаете CONFIG_CHANGED при вызове объекта Status диспетчера MAPI, диспетчер очереди вызовов вызывает [иксплогон:: аддресстипес](ixplogon-addresstypes.md) для каждого активного поставщика транспорта. **Аддресстипес** информирует диспетчер очереди MAPI о поддерживаемых типах адресов транспорта. Некоторые поставщики услуг также отображают индикатор хода выполнения, если предполагается выполнение проверки в течение длительного времени. Отображение индикатора хода выполнения полезно, но не обязательно. 
  
Если установлен флаг SUPPRESS_UI, невозможно отобразить ни вкладки свойств конфигурации, ни диалоговые окна хода выполнения. 
  
## <a name="see-also"></a>См. также

- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)
- [IXPLogon::FlushQueues](ixplogon-flushqueues.md)
- [Каноническое свойство PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)
- [Каноническое свойство PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)
- [Каноническое свойство PidTagStatusCode](pidtagstatuscode-canonical-property.md)
- [Каноническое свойство PidTagStatusString](pidtagstatusstring-canonical-property.md)
- [IMAPIStatus : IMAPIProp](imapistatusimapiprop.md)

