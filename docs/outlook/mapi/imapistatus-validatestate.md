---
title: IMAPIStatusValidateState
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIStatus.ValidateState
api_type:
- COM
ms.assetid: 036b9b15-86e1-4a37-8e4b-e37b2963d8fb
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: adcdf04653f8c9fed2ecc6520648abd3acd36134
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438150"
---
# <a name="imapistatusvalidatestate"></a>IMAPIStatus::ValidateState

**Относится к**: Outlook 2013 | Outlook 2016 
  
Подтверждает сведения о внешнем состоянии, доступные для ресурса MAPI или поставщика услуг. Этот метод поддерживается во всех объектах состояния. 
  
```cpp
HRESULT ValidateState(
  ULONG_PTR ulUIParam,
  ULONG ulFlags
);
```

## <a name="parameters"></a>Параметры

_ulUIParam_
  
> [in] Handle to the parent window of any dialog boxes or windows that this method displays.
    
_ulFlags_
  
> [in] Битоваяmas флагов, контролирующая проверку. Можно установить следующие флаги:
    
ABORT_XP_HEADER_OPERATION
  
> Пользователь отменил операцию, обычно нажав  кнопку "Отмена" в соответствующем диалоговом окне. У объекта status есть два варианта: 
    
   - Продолжите работу над операцией.
    
   - Остановите операцию и MAPI_E_USER_CANCELED.
    
CONFIG_CHANGED 
  
> Изменено одно или несколько свойств конфигурации объекта состояния. Клиенты могут установить этот флаг, чтобы позволить пулу MAPI динамически исправлять критические сбои поставщика транспорта. 
    
FORCE_XP_CONNECT 
  
> Объект состояния должен выполнить подключение. Если этот флаг используется с флагом REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE, подключение происходит без кэшинга.
    
FORCE_XP_DISCONNECT 
  
> Объект состояния должен выполнить операцию отключения. Если этот флаг используется с флагом REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE, отключение происходит без кэшации.
    
PROCESS_XP_HEADER_CACHE 
  
> Записи в таблице кэша загона должны быть обработаны, все сообщения, помеченные флагом MSGSTATUS_REMOTE_DOWNLOAD, должны быть загружены, а все сообщения с флагом MSGSTATUS_REMOTE_DELETE должны быть удалены. Сообщения, для MSGSTATUS_REMOTE_DOWNLOAD и MSGSTATUS_REMOTE_DELETE, должны быть перемещены.
    
REFRESH_XP_HEADER_CACHE 
  
> Для удаленного поставщика транспорта необходимо скачать новый список заглавных сообщений и очистить все флаги, помечаемые состоянием сообщения.
    
SUPPRESS_UI 
  
> Предотвращает отображение пользовательского интерфейса в объекте состояния в рамках операции.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Проверка прошла успешно.
    
MAPI_E_BUSY 
  
> В настоящее время идет другая операция; его следует разрешить завершить или остановить перед началом этой операции.
    
MAPI_E_NO_SUPPORT 
  
> Объект состояния не поддерживает метод проверки, на что указывает отсутствие флага STATUS_VALIDATE_STATE в свойстве **PR_RESOURCE_METHODS** ([PidTagResourceMethods).](pidtagresourcemethods-canonical-property.md)
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию проверки, обычно нажав  кнопку "Отмена" в диалоговом окне. Это значение возвращается только удаленными поставщиками транспорта. 
    
## <a name="remarks"></a>Примечания

Метод **IMAPIStatus::ValidateState** проверяет состояние ресурса, связанного с объектом состояния. **ValidateState** — единственный метод в интерфейсе [IMAPIStatus,](imapistatusimapiprop.md) необходимый для всех объектов состояния. Точное поведение этого метода зависит от реализации. В следующей таблице описывается реализация каждого из различных типов объектов состояния. 
  
|**Объект Status**|Реализация ValidateState***|
|:-----|:-----|
|Подсистема MAPI  <br/> |Проверяет состояние всех ресурсов, которые принадлежат текущим активным поставщикам служб и подсистеме.  <br/> |
|MapI spooler  <br/> |Выполняет вход всех поставщиков транспорта независимо от того, вошли ли они в систему.  <br/> |
|Адресная книга MAPI  <br/> |Проверяет записи в разделе профиля.  <br/> |
|Поставщик услуг  <br/> |Реализация зависит от типа поставщика и флагов, установленных в _параметре ulFlags._  <br/> |
   
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Удаленные клиентские приложения звонят **методу ValidateState,** чтобы запустить удаленную обработку для различных действий. Этот метод в основном используется для того, чтобы устанавливать биты состояния для связи с пулером MAPI вместо того, чтобы фактически делать какие-либо работы. Как правило, поставщик транспорта устанавливает флаги в строке состояния, которые указывают пуле MAPI, какие действия необходимо инициировать для выполнения запроса клиента. 

В этой модели взаимодействия между клиентом и пулом транспорта действия, запрашиваемая клиентом, являются асинхронными, так как **ValidateState** возвращается до завершения запрашиваемого действия. Однако действия, которые необязательно связаны с системой обмена сообщениями или связаны с интерфейсом транспорта, могут быть синхронными. Клиентские приложения передает битовуюmass из следующих флагов, чтобы указать, какие действия должен принять удаленный поставщик транспорта. 
  
ABORT_XP_HEADER_OPERATION 
  
> По возможности поставщик удаленного транспорта должен отменить все операции, которые связаны с загрузкой headers. Для этого поставщик транспорта должен установить следующие значения свойств в строке состояния объекта для логотипа:
    
   - Очищайте биты STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE в свойстве **PR_STATUS_CODE** ([PidTagStatusCode),](pidtagstatuscode-canonical-property.md)чтобы сообщить пуле MAPI, что необходимо остановить процесс очистки входящих данных для этого поставщика транспорта.
    
   - За установите STATUS_OFFLINE в **свойстве** PR_STATUS_CODE. 
    
   - **Задайте PR_REMOTE_VALIDATE_OK** ([PidTagRemoteValidateOk) в](pidtagremotevalidateok-canonical-property.md)true.
    
   - Установите **для PR_STATUS_STRING** [(PidTagStatusString)](pidtagstatusstring-canonical-property.md)строку, которая указывает пользователю состояние поставщика транспорта.
    
   - Возврат S_OK. Однако если не удается отменить операцию, **ValidateState** должен вернуть MAPI_E_BUSY. 
    
FORCE_XP_CONNECT 
  
> Поставщик удаленного транспорта никогда не должен устанавливать подключение к общему ресурсу (например, модему или COM-порту) вне контекста взаимодействия mapI spooler-transport, задействованного в методе [IXPLogon::FlushQueues.](ixplogon-flushqueues.md) Если **проверка ValidateState** вызвана с этим флагом, ваш поставщик транспорта должен сделать следующее: 
    
   - Установите внутренний флаг состояния, чтобы указать, что удаленное подключение необходимо установить при методе **IXPLogon::FlushQueues.** 
    
   - Установите правильные значения в таблице состояния, чтобы пул mapI инициирует процесс очистки очереди.
    
   - После очистки очередей отпустите общий ресурс.
    
   - Очистка STATUS_OFFLINE в **свойстве** PR_STATUS_CODE. 
    
   - Возврат S_OK.
    
FORCE_XP_DISCONNECT 
  
> Поставщик удаленного транспорта должен освободить подключение к ресурсам системы обмена сообщениями. После этого он должен установить STATUS_OFFLINE в  свойстве PR_STATUS_CODE и вернуть S_OK. 
    
PROCESS_XP_HEADER_CACHE 
  
> Поставщик удаленного транспорта должен обрабатывать удаленные сообщения и отправлять все отложенные сообщения. Для этого поставщик транспорта должен установить следующие значения свойств в строке состояния объекта для логотипа:
    
   - Установите **для PR_STATUS_STRING** строку, которая указывает пользователю состояние поставщика транспорта. 
    
   - Установите STATUS_OUTBOUND_ENABLED и STATUS_OUTBOUND_ACTIVE в **свойстве** PR_STATUS_CODE. 
    
   - Установите **для PR_REMOTE_VALIDATE_OK** свойства в строке состояния поставщика транспорта false. 
    
   - Если при вызвании **ValidateState** происходит другая операция (например,  загрузка MAPI_E_BUSY). 
    
   - Выполните код для обработки REFRESH_XP_HEADER_CACHE флага, чтобы удовлетворить требования клиента Microsoft Exchange.
    
REFRESH_XP_HEADER_CACHE 
  
> Поставщик удаленного транспорта должен получить все новые заглавные сообщения из системы обмена сообщениями. Для этого поставщик транспорта должен сделать следующее:
    
   - Установите **для PR_STATUS_STRING** строку, которая указывает пользователю состояние поставщика транспорта. 
    
   - Установите STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE в **свойстве** PR_STATUS_CODE. 
    
   - Очистка STATUS_OFFLINE в **свойстве** PR_STATUS_CODE. 
    
   - За установите STATUS_ONLINE в **свойстве** PR_STATUS_CODE. 
    
   - Установите **для PR_REMOTE_VALIDATE_OK** свойства в строке состояния поставщика транспорта false. 
    
SHOW_XP_SESSION_UI 
  
> Если у вашего поставщика транспорта есть какие-либо элементы пользовательского интерфейса для обработки заглавных сообщений (например, диалоговое окно с подтверждением загрузки сообщений), это диалоговое окно должно отобразиться. В **противном случае ValidateState** может вернуть MAPI_E_NO_SUPPORT. 
    
Если передаются какие-либо флаги, кроме этих, **ValidateState** должен возвращать MAPI_E_UNKNOWN_FLAGS. 
  
Вызовом клиента к поставщику транспорта часто является метод **IMAPIStatus::ValidateState.** Во время обработки **ValidateState** поставщик транспорта не должен выполнять никаких действий, выделяющих системные ресурсы, например модем или COM-порт. Это происходит потому, что пулу MAPI иногда требуется очистить очереди для более чем одного поставщика транспорта. Однако клиент может в любое время вызвать метод **ValidateState** любого поставщика транспорта. Если поставщик транспорта пытается выделить ресурс- источающий ресурс во время обработки **ValidateState,** ошибка может привести к конфликту с другим поставщиком транспорта, который пулер MAPI проинструктировали о очистке очередей. Если вы разрешаете выделение всех ресурсоемких ресурсов под руководством пула MAPI, можно избежать таких конфликтов. Ваш поставщик транспорта должен поддерживать **PR_REMOTE_VALIDATE_OK,** чтобы клиентские приложения могли определить, когда ваш поставщик транспорта занят или ожидает, пока пулер MAPI инициирует действие. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Поскольку этот метод может привести к другим потенциально длительным вызовам, **ValidateState** может возвращать MAPI_E_BUSY, чтобы сообщить, что этот метод ожидает завершения другой операции. Необходимо дождаться завершения ожидающих операций, прежде чем пытаться выполнить другую задачу. 
  
Вы имеете самый полный контроль над вызовами объектов состояния поставщика транспорта. В **ValidateState** можно передать один или несколько флагов, влияющих на работу поставщика транспорта. Например, флаг ABORT_XP_HEADER_OPERATION указывает, что пользователь отменил проверку. Поставщики транспорта могут отменить, вернуть MAPI_E_USER_CANCELED или продолжить. 
  
Вы можете установить флаг CONFIG_CHANGED в вызове для объекта состояния поставщика услуг или пула MAPI, чтобы указать, что параметр конфигурации был изменен. Вы можете использовать CONFIG_CHANGED для динамической перенастройки поставщика транспорта. При CONFIG_CHANGED вызове объекта состояния поставщика услуг поставщик отвечает вызовом [IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md) чтобы оповещать пула MAPI об изменении. Когда вы CONFIG_CHANGED в вызове объекта состояния пула MAPI, пулер вызывает [IXPLogon::AddressTypes](ixplogon-addresstypes.md) для каждого активного поставщика транспорта. **AddressTypes** сообщает пулу MAPI о поддерживаемых типах адресов транспорта. Некоторые поставщики услуг также отображают индикатор хода выполнения, если ожидается, что проверка займет много времени. Отображение индикатора хода выполнения полезно, но не обязательно. 
  
Если установлен SUPPRESS_UI, никакие листы свойств конфигурации или диалоговые окна хода выполнения не отображаются. 
  
## <a name="see-also"></a>См. также

- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)
- [IXPLogon::FlushQueues](ixplogon-flushqueues.md)
- [Каноническое свойство PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)
- [Каноническое свойство PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)
- [Каноническое свойство PidTagStatusCode](pidtagstatuscode-canonical-property.md)
- [Каноническое свойство PidTagStatusString](pidtagstatusstring-canonical-property.md)
- [IMAPIStatus : IMAPIProp](imapistatusimapiprop.md)

