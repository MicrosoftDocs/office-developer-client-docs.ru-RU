---
title: IMAPIStatusValidateState
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIStatus.ValidateState
api_type:
- COM
ms.assetid: 036b9b15-86e1-4a37-8e4b-e37b2963d8fb
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 3ff29ac7e7f9b7876bb678930390ca556351ecf6
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19809118"
---
# <a name="imapistatusvalidatestate"></a>IMAPIStatus::ValidateState

**Относится к**: Outlook 
  
Проверяет состояние внешних информация, доступная для ресурсов MAPI или поставщика услуг. Этот метод поддерживается во всех объектах состояние. 
  
```cpp
HRESULT ValidateState(
  ULONG_PTR ulUIParam,
  ULONG ulFlags
);
```

## <a name="parameters"></a>Параметры

_ulUIParam_
  
> [in] Дескриптор родительского окна все диалоговые окна или окна, которые отображаются этот метод.
    
_ulFlags_
  
> [in] Битовая маска флаги, который управляет проверки. Можно задать следующие флажки:
    
ABORT_XP_HEADER_OPERATION
  
> Пользователь отменил операцию, как правило, нажмите кнопку **Отмена** в диалоговом окне соответствующего. Объект состояния имеет два варианта: 
    
   - Продолжить работу на операции.
    
   - Отменить эту операцию и вернуться MAPI_E_USER_CANCELED.
    
CONFIG_CHANGED 
  
> Один или несколько свойств конфигурации объекта состояния изменен. Клиенты можно задать этот флаг, чтобы разрешить диспетчер очереди MAPI для динамического исправления ошибок поставщика критические транспортировки. 
    
FORCE_XP_CONNECT 
  
> Объект состояния следует выполнить подключение. При использовании с флагом REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE этот флаг подключения происходит без кэширования.
    
FORCE_XP_DISCONNECT 
  
> Состояние объекта следует выполнить операцию отключения. При использовании с флагом REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE этот флаг отключения происходит без кэширования.
    
PROCESS_XP_HEADER_CACHE 
  
> Будут обрабатываться записей в таблице кэша заголовок, необходимо загрузить все сообщения, помеченные с флагом MSGSTATUS_REMOTE_DOWNLOAD и все сообщения, помеченные с флагом MSGSTATUS_REMOTE_DELETE подлежащий удалению. Необходимо переместить сообщения, для которых MSGSTATUS_REMOTE_DOWNLOAD и задать MSGSTATUS_REMOTE_DELETE.
    
REFRESH_XP_HEADER_CACHE 
  
> Для поставщика транспорта удаленного необходимо загрузить новый список заголовков сообщений и все флаги, пометить состояние сообщения должна быть удалена.
    
SUPPRESS_UI 
  
> Запрещает отображение пользовательского интерфейса в рамках операции объекта состояния.
    
## <a name="return-value"></a>������������ ��������

ЗНАЧЕНИЕ S_OK 
  
> Проверка прошла успешно.
    
MAPI_E_BUSY 
  
> Другой операции находится в стадии разработки; должны для выполнения или она должна быть остановлена, до инициализации этой операции.
    
MAPI_E_NO_SUPPORT 
  
> Состояние объекта не поддерживает метод проверки, что указывает на отсутствие флага STATUS_VALIDATE_STATE в свойстве **PR_RESOURCE_METHODS** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)).
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операции проверки, как правило, нажмите кнопку **Отмена** в диалоговом окне. Это значение возвращается только поставщиков удаленных транспорта. 
    
## <a name="remarks"></a>Замечания

Метод **IMAPIStatus::ValidateState** проверяет состояние ресурса, связанного с объектом состояния. **ValidateState** — это единственный метод в интерфейсе [IMAPIStatus](imapistatusimapiprop.md) , необходимое для всех объектов состояния. Точное поведение этого метода зависит от реализации. В следующей таблице описаны реализации каждого из различных типов объектов состояния. 
  
|**Состояние объекта**|ValidateState ** реализации **|
|:-----|:-----|
|Подсистема MAPI  <br/> |Проверяет состояние все ресурсы, которые поставщиков услуг текущего активного и сама подсистема владельцем.  <br/> |
|Диспетчер очереди MAPI  <br/> |Входит в систему всех поставщиков транспорта, независимо от того, является ли уже входе в систему.  <br/> |
|Адресная книга MAPI  <br/> |Проверяет, находятся в записях его раздела профиля.  <br/> |
|Поставщик услуг  <br/> |Реализация зависит от типа поставщика и флаги, задавать в параметре _ulFlags_ .  <br/> |
   
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Удаленные клиентские приложения вызовите метод **ValidateState** для запуска удаленного обработки для различных действий. Этот метод используется в основном для установки состояния битов для взаимодействия с диспетчер очереди MAPI, а не фактически операцию. Как правило поставщика транспорта устанавливает флаги в строке ее состояния, которые указывают диспетчер очереди MAPI, что действия необходимо быть инициирован для выполнения запроса клиента. 

В этой модели взаимодействия клиентов транспорта очереди действия, требуемой клиентом является асинхронным, в **ValidateState** возвращает до завершения запрошенного действия. Тем не менее может быть синхронного действия, не используя обязательно системы обмена сообщениями или которые включают транспорта интерфейса. Клиентское приложение передает Битовая маска следующие флажки, чтобы определить, какие действия, поставщика транспорта удаленного должен выполнять. 
  
ABORT_XP_HEADER_OPERATION 
  
> Если это возможно поставщика транспорта удаленного должен отменить любые операций на загрузку заголовков. Для этого поставщика транспорта необходимо присвоить следующие значения свойств в строке состояния объект вход в систему:
    
   - Снимите флажок STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE бит в свойстве **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)), чтобы сообщить диспетчер очереди MAPI для остановки входящих процесс очистки для данного поставщика транспорта.
    
   - Задайте STATUS_OFFLINE бит в свойстве **PR_STATUS_CODE** . 
    
   - Присвойте свойству **PR_REMOTE_VALIDATE_OK** ([PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)) имеет значение TRUE.
    
   - Присвойте свойству **PR_STATUS_STRING** ([PidTagStatusString](pidtagstatusstring-canonical-property.md)) к типу string, указывающее состояние поставщика транспорта для пользователя.
    
   - Возвращает значение S_OK. Тем не менее если не удается отменить эту операцию в процессе выполнения, **ValidateState** должен возвращать MAPI_E_BUSY. 
    
FORCE_XP_CONNECT 
  
> Поставщик удаленного транспорта никогда не следует установить подключение к общему ресурсу (например, модем или COM-порт) вне контекста взаимодействия очереди транспорта MAPI, участвующих в метод [IXPLogon::FlushQueues](ixplogon-flushqueues.md) . Если **ValidateState** вызван с этот флаг, поставщика транспорта должен выполните следующее: 
    
   - Задайте флаг внутреннего состояния, чтобы указать, что при вызове метода **IXPLogon::FlushQueues** должно быть установлено подключение к удаленному. 
    
   - Задайте правильные значения в таблице состояния, чтобы вызвать диспетчер очереди MAPI начать процесс очистки очереди.
    
   - После завершения очистки очередей release общего ресурса.
    
   - Снимите флажок STATUS_OFFLINE бит в свойстве **PR_STATUS_CODE** . 
    
   - Возвращает значение S_OK.
    
FORCE_XP_DISCONNECT 
  
> Поставщик удаленного транспорта освобождать его подключения к ресурсов системы обмена сообщениями. После этого, его следует установить бит STATUS_OFFLINE в свойстве **PR_STATUS_CODE** и возвращает значение S_OK. 
    
PROCESS_XP_HEADER_CACHE 
  
> Поставщик удаленного транспорта следует обработки удаленных сообщений и отправить все сообщения, которые были отложены. Для этого поставщика транспорта необходимо присвоить следующие значения свойств в строке состояния объект вход в систему:
    
   - Присвойте свойству **PR_STATUS_STRING** к типу string, указывающее состояние поставщика транспорта для пользователя. 
    
   - Установка двоичных файлов STATUS_OUTBOUND_ENABLED и STATUS_OUTBOUND_ACTIVE в свойстве **PR_STATUS_CODE** . 
    
   - Присвойте свойству **PR_REMOTE_VALIDATE_OK** в строке состояния поставщика транспорта значение FALSE. 
    
   - Если другой операции находится в стадии разработки (например, загрузку заголовков) при вызове **ValidateState** **ValidateState** должна вернуть MAPI_E_BUSY. 
    
   - Выполнение кода для обработки флаг REFRESH_XP_HEADER_CACHE, а также соблюдения требований клиента Microsoft Exchange.
    
REFRESH_XP_HEADER_CACHE 
  
> Поставщик удаленного транспорта должны получить любые новые заголовки сообщений из систем обмена сообщениями. Для этого поставщика транспорта необходимо выполнить следующее:
    
   - Присвойте свойству **PR_STATUS_STRING** к типу string, указывающее состояние поставщика транспорта для пользователя. 
    
   - Установка двоичных файлов STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE в свойстве **PR_STATUS_CODE** . 
    
   - Снимите флажок STATUS_OFFLINE бит в свойстве **PR_STATUS_CODE** . 
    
   - Задайте STATUS_ONLINE бит в свойстве **PR_STATUS_CODE** . 
    
   - Присвойте свойству **PR_REMOTE_VALIDATE_OK** в строке состояния поставщика транспорта значение FALSE. 
    
SHOW_XP_SESSION_UI 
  
> Если ваш поставщик транспорта любой части пользовательского интерфейса для обработки заголовков сообщений (например, диалоговое окно, которое подтверждает загрузку сообщений), окно должно отображаться. В противном случае **ValidateState** может вернуть MAPI_E_NO_SUPPORT. 
    
Если переданную флаги других **ValidateState** должен возвращать MAPI_E_UNKNOWN_FLAGS. 
  
Вызов клиента для поставщика транспорта часто будут в метод **IMAPIStatus::ValidateState** . Во время обработки **ValidateState**, поставщика транспорта не следует выполнять любые действия, которые выделение нехватки системных ресурсов, таких как модем или COM-порт. Это так, как диспетчер очереди MAPI в некоторых случаях требуется очистить очередей на более одного поставщика транспорта. Тем не менее клиент может вызывать метод **ValidateState** любого поставщика транспорта в любое время. Если ваш поставщик транспорта попытается выделить нехватки ресурсов во время обработки **ValidateState**, ошибка может привести к из-за конфликта с другого поставщика транспорта, предписывает диспетчер очереди MAPI для очистки очереди. Если вы включили все выделений нехватки ресурсов будет выполнена под руководством диспетчер очереди MAPI, можно избежать подобных конфликтов. Поставщика транспорта должны поддерживать свойство **PR_REMOTE_VALIDATE_OK** , поэтому клиентских приложений можно определить, когда поставщика транспорта «занят» или ожидая очереди MAPI для инициации действия. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Так как этот метод можно вызывать другие потенциально длительных вызовов, **ValidateState** может вернуть MAPI_E_BUSY, информирующее о том, что этот метод ожидает другой операции. Должен ожидать до завершения операции ожидающие прежде чем другой задачи. 
  
У вас есть полный контроль над звонков для передачи объектов состояние поставщика. Один или несколько флагов можно передать **ValidateState** , которые влияют на операции поставщика транспорта. Например флаг ABORT_XP_HEADER_OPERATION указывает, что пользователь отменил проверки. Поставщики транспорта можно указать, кто прервать, возвращая MAPI_E_USER_CANCELED, или по-прежнему. 
  
Флаг CONFIG_CHANGED можно задать на вызов объекта состояние поставщика службы или диспетчер очереди MAPI для указания изменения параметров конфигурации. CONFIG_CHANGED можно использовать для динамического назначения поставщика транспорта. При установке CONFIG_CHANGED на вызов объекта состояние поставщика услуг поставщика отвечает вызов [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) для оповещения диспетчер очереди MAPI изменения. При установке CONFIG_CHANGED на объект состояния очереди MAPI очереди вызывает [IXPLogon::AddressTypes](ixplogon-addresstypes.md) для каждого поставщика транспорта активный. **AddressTypes** информирует диспетчер очереди MAPI типов поддерживаемых адресов транспорта. Некоторых поставщиков услуг также отобразить индикатор выполнения, если проверка уйти много времени. Отображение индикатор выполнения полезным, но не требуется. 
  
Если для флага SUPPRESS_UI, ни одно из свойств конфигурации или диалоговые окна хода выполнения могут быть отображены. 
  
## <a name="see-also"></a>См. также

- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)
- [IXPLogon::FlushQueues](ixplogon-flushqueues.md)
- [Каноническое свойство PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)
- [Каноническое свойство PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)
- [Каноническое свойство PidTagStatusCode](pidtagstatuscode-canonical-property.md)
- [Каноническое свойство PidTagStatusString](pidtagstatusstring-canonical-property.md)
- [IMAPIStatus : IMAPIProp](imapistatusimapiprop.md)

