---
title: Имапистатусвалидатестате
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIStatus.ValidateState
api_type:
- COM
ms.assetid: 036b9b15-86e1-4a37-8e4b-e37b2963d8fb
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: adcdf04653f8c9fed2ecc6520648abd3acd36134
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438150"
---
# <a name="imapistatusvalidatestate"></a>IMAPIStatus::ValidateState

**Относится к**: Outlook 2013 | Outlook 2016 
  
Проверяет внешние сведения о состоянии, доступные для ресурса MAPI или поставщика услуг. Этот метод поддерживается во всех объектах Status. 
  
```cpp
HRESULT ValidateState(
  ULONG_PTR ulUIParam,
  ULONG ulFlags
);
```

## <a name="parameters"></a>Параметры

_Улуипарам_
  
> возврата Дескриптор родительского окна всех диалоговых окон и окон, отображаемых данным методом.
    
_ulFlags_
  
> возврата Битовая маска флагов, управляющих проверкой. Можно задать следующие флаги:
    
АБОРТ_КСП_ХЕАДЕР_ОПЕРАТИОН
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в соответствующем диалоговом окне. Объект Status имеет два параметра: 
    
   - Продолжайте работу над операцией.
    
   - Остановите операцию и возвратите МАПИ_Е_УСЕР_КАНЦЕЛЕД.
    
КОНФИГ_ЧАНЖЕД 
  
> Изменилось одно или несколько свойств конфигурации объекта Status. Клиенты могут установить этот флаг, чтобы диспетчер очереди MAPI мог динамически устранять критические сбои поставщика транспорта. 
    
ФОРЦЕ_КСП_КОННЕКТ 
  
> Объект Status должен выполнить подключение. Если этот флаг используется с флагом РЕФРЕШ_КСП_ХЕАДЕР_КАЧЕ или ПРОЦЕСС_КСП_ХЕАДЕР_КАЧЕ, подключение выполняется без кэширования.
    
ФОРЦЕ_КСП_ДИСКОННЕКТ 
  
> Объект Status должен выполнить операцию отключения. Если этот флаг используется с флагом РЕФРЕШ_КСП_ХЕАДЕР_КАЧЕ или ПРОЦЕСС_КСП_ХЕАДЕР_КАЧЕ, отключение происходит без кэширования.
    
ПРОЦЕСС_КСП_ХЕАДЕР_КАЧЕ 
  
> Записи в таблице кэша заголовков должны быть обработаны, все сообщения, отмеченные флагом МСГСТАТУС_РЕМОТЕ_ДОВНЛОАД, будут скачаны, а все сообщения, помеченные флагом МСГСТАТУС_РЕМОТЕ_ДЕЛЕТЕ, должны быть удалены. Сообщения с набором МСГСТАТУС_РЕМОТЕ_ДОВНЛОАД и МСГСТАТУС_РЕМОТЕ_ДЕЛЕТЕ должны быть перемещены.
    
РЕФРЕШ_КСП_ХЕАДЕР_КАЧЕ 
  
> Для удаленного поставщика транспорта необходимо скачать новый список заголовков сообщений, а все флаги, помечающие состояние сообщения, следует очистить.
    
СУППРЕСС_УИ 
  
> Запрещает отображение в объекте status пользовательского интерфейса в рамках операции.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Проверка прошла успешно.
    
МАПИ_Е_БУСИ 
  
> Выполняется другая операция; ее выполнение должно быть разрешено или остановлено до инициирования этой операции.
    
МАПИ_Е_НО_СУППОРТ 
  
> Объект Status не поддерживает метод проверки, как указано в отсутствие флага СТАТУС_ВАЛИДАТЕ_СТАТЕ в свойстве **пр_ресаурце_месодс** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)).
    
МАПИ_Е_УСЕР_КАНЦЕЛ 
  
> Пользователь отменил операцию проверки, как правило, нажав кнопку **Отмена** в диалоговом окне. Это значение возвращается только удаленными поставщиками транспорта. 
    
## <a name="remarks"></a>Примечания

Метод **имапистатус:: валидатестате** проверяет состояние ресурса, связанного с объектом Status. **Валидатестате** — единственный метод в интерфейсе [имапистатус](imapistatusimapiprop.md) , необходимый для всех объектов Status. Точное поведение этого метода зависит от реализации. В следующей таблице описывается реализация каждого из различных типов объектов Status. 
  
|**Объект Status**|Реализация Валидатестате * * * *|
|:-----|:-----|
|Подсистема MAPI  <br/> |Проверяет состояние всех ресурсов, которыми владеет текущий активный поставщик услуг и сама подсистема.  <br/> |
|Диспетчер очереди MAPI  <br/> |Выполняет вход в систему для всех поставщиков транспорта независимо от того, были ли они уже зарегистрированы.  <br/> |
|Адресная книга MAPI  <br/> |Проверяет записи в разделе профиля.  <br/> |
|Поставщик услуг  <br/> |Реализация зависит от типа поставщика и флагов, заданные в параметре _ulFlags_ .  <br/> |
   
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Удаленные клиентские приложения вызывают метод **валидатестате** , чтобы запустить удаленную обработку для различных действий. Этот метод в основном существует для установки битов состояния для общения с диспетчером очереди MAPI, а не для фактического выполнения какой – либо работы. Как правило, поставщик транспорта устанавливает флаги в строке состояния, указывающие на очередь MAPI, какие действия необходимо инициировать для выполнения запроса клиента. 

В этой модели взаимодействия клиента с транспортным сервером действия, запрашиваемые клиентом, выполняются асинхронно, в то же **валидатестате** возвращаются до выполнения запрошенных действий. Однако действия, которые не включают в себя базовую систему обмена сообщениями или которые используют интерфейс, связанный с транспортом, могут быть синхронными. Клиентское приложение передает битовую маску следующих флагов, чтобы указать, какие действия должен выполнять удаленный поставщик транспорта. 
  
АБОРТ_КСП_ХЕАДЕР_ОПЕРАТИОН 
  
> Если это возможно, удаленный поставщик транспорта должен отменить все операции, которые включают загрузку заголовков. Для этого поставщик транспорта должен задать следующие значения свойств в строке состояния объекта входа:
    
   - Очистите биты СТАТУС_ИНБАУНД_ЕНАБЛЕД и СТАТУС_ИНБАУНД_АКТИВЕ в свойстве **пр_статус_коде** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)), чтобы сообщить диспетчеру почтовых остановить входящий процесс очистки для этого поставщика транспорта.
    
   - Установите бит СТАТУС_ОФФЛИНЕ в свойстве **пр_статус_коде** . 
    
   - ПриСвойте свойству **пр_ремоте_валидате_ок** ([PIDTAGREMOTEVALIDATEOK](pidtagremotevalidateok-canonical-property.md)) значение true.
    
   - Задайте в качестве значения свойства **пр_статус_стринг** ([PidTagStatusString](pidtagstatusstring-canonical-property.md)) строку, которая указывает состояние поставщика транспорта для пользователя.
    
   - Возвращает значение S_OK. Однако если не удается отменить выполняемую операцию, **валидатестате** должен вернуть мапи_е_буси. 
    
ФОРЦЕ_КСП_КОННЕКТ 
  
> Удаленный поставщик транспорта не должен устанавливать подключение к общему ресурсу (например, модем или COM-порт) за пределами контекста диалога MAPI-Transport, используемого в методе [иксплогон:: FlushQueues](ixplogon-flushqueues.md) . Если **валидатестате** вызывается с этим флагом, ваш поставщик транспорта должен выполнить следующие действия: 
    
   - Установите флаг внутреннего состояния, чтобы указать, что удаленное подключение должно быть установлено при вызове метода **иксплогон:: FlushQueues** . 
    
   - Задайте правильные значения в таблице состояние, чтобы диспетчер очереди MAPI инициировал процесс очистки очереди.
    
   - После завершения очистки очередей Освободите общий ресурс.
    
   - Очистите бит СТАТУС_ОФФЛИНЕ в свойстве **пр_статус_коде** . 
    
   - Возвращает значение S_OK.
    
ФОРЦЕ_КСП_ДИСКОННЕКТ 
  
> Удаленный поставщик транспорта должен освободить свое подключение к системным ресурсам системы обмена сообщениями. После этого необходимо установить бит СТАТУС_ОФФЛИНЕ в свойстве **пр_статус_коде** и возвращать значение S_OK. 
    
ПРОЦЕСС_КСП_ХЕАДЕР_КАЧЕ 
  
> Удаленный поставщик транспорта должен обрабатывать удаленные сообщения и отправлять сообщения, которые были отложены. Для этого поставщик транспорта должен задать следующие значения свойств в строке состояния объекта входа:
    
   - ПриСвойте свойству **пр_статус_стринг** строку, которая указывает состояние поставщика транспорта для пользователя. 
    
   - Задайте биты СТАТУС_АУТБАУНД_ЕНАБЛЕД и СТАТУС_АУТБАУНД_АКТИВЕ в свойстве **пр_статус_коде** . 
    
   - Задайте для свойства **пр_ремоте_валидате_ок** в строке состояния поставщика транспорта значение false. 
    
   - Если выполняется другая операция (например, Загрузка заголовков) при вызове **валидатестате** , **валидатестате** должен возвратить мапи_е_буси. 
    
   - Выполните код для обработки флага РЕФРЕШ_КСП_ХЕАДЕР_КАЧЕ, а также для удовлетворения требований клиента Microsoft Exchange.
    
РЕФРЕШ_КСП_ХЕАДЕР_КАЧЕ 
  
> Удаленный поставщик транспорта должен получить все новые заголовки сообщений из системы обмена сообщениями. Для этого поставщик транспорта должен выполнить следующие действия:
    
   - ПриСвойте свойству **пр_статус_стринг** строку, которая указывает состояние поставщика транспорта для пользователя. 
    
   - Задайте биты СТАТУС_ИНБАУНД_ЕНАБЛЕД и СТАТУС_ИНБАУНД_АКТИВЕ в свойстве **пр_статус_коде** . 
    
   - Очистите бит СТАТУС_ОФФЛИНЕ в свойстве **пр_статус_коде** . 
    
   - Установите бит СТАТУС_ОНЛИНЕ в свойстве **пр_статус_коде** . 
    
   - Задайте для свойства **пр_ремоте_валидате_ок** в строке состояния поставщика транспорта значение false. 
    
ШОВ_КСП_СЕССИОН_УИ 
  
> Если у поставщика транспорта есть какие-либо фрагменты пользовательского интерфейса для обработки заголовков сообщений (например, диалоговое окно, которое подтверждает загрузку сообщений), откроется диалоговое окно. В противном случае **валидатестате** может вернуть мапи_е_но_суппорт. 
    
Если передаются любые другие флаги, **валидатестате** должен вернуть мапи_е_ункновн_флагс. 
  
Клиентский вызов поставщика транспорта часто будет поддерживать метод **имапистатус:: валидатестате** . При обработке **валидатестате**поставщик транспорта не должен выполнять никакие действия, которые выделяют недостаточные системные ресурсы, например модем или COM-порт. Это связано с тем, что диспетчеру MAPI иногда потребуется сбрасывать очереди на нескольких поставщиках транспорта. Тем не менее, клиент может в любой момент вызвать любой метод **валидатестате** поставщика транспорта. Если поставщик транспорта пытается выделить неограниченный ресурс во время обработки **валидатестате**, ошибка может возникать из-за конфликта с другим поставщиком транспорта, в котором диспетчер очереди MAPI предписывает очистить очереди. Если вы разрешите все неограниченные выделения ресурсов при использовании очереди печати MAPI, можно избежать подобных конфликтов. Поставщик транспорта должен поддерживать свойство **пр_ремоте_валидате_ок** , чтобы клиентские приложения могли определять, когда поставщик транспорта занят или ожидает, что диспетчер очереди MAPI начинает действие. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Так как этот метод может привести к выполнению других потенциально длительных вызовов, **валидатестате** может вернуть мапи_е_буси, чтобы сообщить о том, что этот метод ожидает завершения другой операции. Перед попыткой выполнения другой задачи необходимо дождаться завершения ожидающей операции. 
  
Вы можете управлять вызовами объектов состояния поставщика транспорта. В **валидатестате** можно передать один или несколько флагов, которые влияют на операции поставщика транспорта. Например, флаг АБОРТ_КСП_ХЕАДЕР_ОПЕРАТИОН указывает, что пользователь отменил проверку. Поставщики транспорта могут отменить операцию, возвращая МАПИ_Е_УСЕР_КАНЦЕЛЕД, или продолжить. 
  
Можно установить флаг КОНФИГ_ЧАНЖЕД для вызова в объект Status поставщика услуг или в диспетчере очереди MAPI, чтобы указать, что параметр конфигурации был изменен. Вы можете использовать КОНФИГ_ЧАНЖЕД для динамической перенастройки поставщика транспорта. Когда вы настраиваете КОНФИГ_ЧАНЖЕД при вызове к объекту Status поставщика услуг, поставщик реагирует на вызов [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) , чтобы предупредить Диспетчер очереди MAPI об изменении. Когда вы задаете КОНФИГ_ЧАНЖЕД при вызове объекта Status диспетчера MAPI, диспетчер очереди вызовов вызывает [иксплогон:: аддресстипес](ixplogon-addresstypes.md) для каждого активного поставщика транспорта. **Аддресстипес** информирует диспетчер очереди MAPI о поддерживаемых типах адресов транспорта. Некоторые поставщики услуг также отображают индикатор хода выполнения, если предполагается выполнение проверки в течение длительного времени. Отображение индикатора хода выполнения полезно, но не обязательно. 
  
Если установлен флаг СУППРЕСС_УИ, не отображаются ни вкладки свойств конфигурации, ни диалоговые окна хода выполнения. 
  
## <a name="see-also"></a>См. также

- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)
- [IXPLogon::FlushQueues](ixplogon-flushqueues.md)
- [Каноническое свойство PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)
- [Каноническое свойство PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)
- [Каноническое свойство PidTagStatusCode](pidtagstatuscode-canonical-property.md)
- [Каноническое свойство PidTagStatusString](pidtagstatusstring-canonical-property.md)
- [IMAPIStatus : IMAPIProp](imapistatusimapiprop.md)

