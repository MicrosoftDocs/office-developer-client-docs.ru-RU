---
title: IMAPIStatusValidateState
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIStatus.ValidateState
api_type:
- COM
ms.assetid: 036b9b15-86e1-4a37-8e4b-e37b2963d8fb
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: adcdf04653f8c9fed2ecc6520648abd3acd36134
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438150"
---
# <a name="imapistatusvalidatestate"></a>IMAPIStatus::ValidateState

**Область применения**: Outlook 2013 | Outlook 2016 
  
Подтверждает сведения о внешнем состоянии, доступные для ресурса MAPI или поставщика услуг. Этот метод поддерживается во всех объектах состояния. 
  
```cpp
HRESULT ValidateState(
  ULONG_PTR ulUIParam,
  ULONG ulFlags
);
```

## <a name="parameters"></a>Parameters

_ulUIParam_
  
> [in] Ручка родительского окна любых диалогов или окон, отображаемого этим методом.
    
_ulFlags_
  
> [in] Битмашка флагов, контролирующая проверку. Можно установить следующие флаги:
    
ABORT_XP_HEADER_OPERATION
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в соответствующем диалоговом окне. Объект состояния имеет два варианта: 
    
   - Продолжить работу над операцией.
    
   - Остановите операцию и MAPI_E_USER_CANCELED.
    
CONFIG_CHANGED 
  
> Изменено одно или несколько свойств конфигурации объекта состояния. Клиенты могут установить этот флаг, чтобы разрешить пульперу MAPI динамически исправлять критически важные сбои поставщика транспорта. 
    
FORCE_XP_CONNECT 
  
> Объект состояния должен выполнять подключение. Если этот флаг используется с REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE флагом, подключение происходит без кэшинга.
    
FORCE_XP_DISCONNECT 
  
> Объект состояния должен выполнять операцию отключения. Если этот флаг используется с REFRESH_XP_HEADER_CACHE или PROCESS_XP_HEADER_CACHE флагом, отключение происходит без кэшинга.
    
PROCESS_XP_HEADER_CACHE 
  
> Записи в таблице кэша загона должны обрабатываться, все сообщения с флагом MSGSTATUS_REMOTE_DOWNLOAD должны быть загружены, а все сообщения, помеченные флагом MSGSTATUS_REMOTE_DELETE, должны быть удалены. Сообщения с набором MSGSTATUS_REMOTE_DOWNLOAD и MSGSTATUS_REMOTE_DELETE должны быть перемещены.
    
REFRESH_XP_HEADER_CACHE 
  
> Для поставщика удаленного транспорта необходимо загрузить новый список заглавных сообщений и очистить все флаги, помеченные состоянием сообщения.
    
SUPPRESS_UI 
  
> Предотвращает отображение объекта состояния пользовательского интерфейса в рамках операции.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Проверка прошла успешно.
    
MAPI_E_BUSY 
  
> В настоящее время продолжается другая операция; это должно быть разрешено для завершения или его следует остановить, прежде чем эта операция будет начата.
    
MAPI_E_NO_SUPPORT 
  
> Объект состояния не поддерживает метод проверки, как указывает отсутствие флага STATUS_VALIDATE_STATE в  свойстве[PR_RESOURCE_METHODS (PidTagResourceMethods).](pidtagresourcemethods-canonical-property.md)
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию проверки, как правило, нажав кнопку **Отмена** в диалоговом окне. Это значение возвращается только удаленными поставщиками транспорта. 
    
## <a name="remarks"></a>Примечания

Метод **IMAPIStatus::ValidateState** проверяет состояние ресурса, связанного с объектом состояния. **ValidateState** — это единственный метод в [интерфейсе IMAPIStatus,](imapistatusimapiprop.md) который необходим для всех объектов состояния. Точное поведение этого метода зависит от реализации. В следующей таблице описывается реализация каждого из различных типов объектов состояния. 
  
|**Объект Status**|Реализация ValidateState** **|
|:-----|:-----|
|Подсистема MAPI  <br/> |Проверяет состояние всех ресурсов, которые в настоящее время принадлежат действующим поставщикам услуг и самой подсистеме.  <br/> |
|Шпалер MAPI  <br/> |Выполняет логотип всех поставщиков транспорта независимо от того, вошли ли они в систему.  <br/> |
|Адресная книга MAPI  <br/> |Проверяет записи в разделе профилей.  <br/> |
|Поставщик услуг  <br/> |Реализация зависит от типа поставщика и флагов, заданных в _параметре ulFlags._  <br/> |
   
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Удаленные клиентские приложения звонят **методу ValidateState,** чтобы приступить к удаленной обработке для различных действий. Этот метод существует в первую очередь для набора битов состояния для связи со шпалером MAPI вместо того, чтобы фактически делать какие-либо работы. Обычно поставщик транспорта задает флажки в строке состояния, которые указывают на то, какие действия необходимо инициировать для выполнения запроса клиента. 

В этой модели взаимодействия клиента с транспортом и пулером действия, запрашиваемая клиентом, являются асинхронными, так как **ПроверкаState** возвращается до завершения запрашиваемого действия. Однако действия, которые не обязательно связаны с системой обмена сообщениями или связаны с транспортным интерфейсом, могут быть синхронными. Клиентская заявка передается в битмаске следующих флагов, чтобы указать, какие действия должен принять поставщик удаленного транспорта. 
  
ABORT_XP_HEADER_OPERATION 
  
> Если это возможно, поставщик удаленного транспорта должен отменить все операции, которые связаны с загрузкой загодеров. Для этого поставщик транспорта должен задать следующие значения свойств в строке состояния объекта logon:
    
   - Очистить STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE биты в **свойстве PR_STATUS_CODE** [(PidTagStatusCode),](pidtagstatuscode-canonical-property.md)чтобы сообщить шпалеру MAPI остановить процесс входящих флеш-данных для этого поставщика транспорта.
    
   - Установите STATUS_OFFLINE в **свойстве PR_STATUS_CODE.** 
    
   - Установите **свойство PR_REMOTE_VALIDATE_OK** [(PidTagRemoteValidateOk)](pidtagremotevalidateok-canonical-property.md)в true.
    
   - Установите **свойство PR_STATUS_STRING** [(PidTagStatusString)](pidtagstatusstring-canonical-property.md)строке, которая указывает пользователю состояние поставщика транспорта.
    
   - Возвращение S_OK. Однако, если операция не может быть отменена, **ПроверкаState** должна вернуться MAPI_E_BUSY. 
    
FORCE_XP_CONNECT 
  
> Поставщик удаленного транспорта никогда не должен устанавливать подключение к общему ресурсу (например, к модему или порту COM) вне контекста взаимодействия пуловер-транспорта MAPI, задействованного в методе [IXPLogon::FlushQueues.](ixplogon-flushqueues.md) Если с этим флагом **вызвана ПроверкаState,** поставщик транспорта должен сделать следующее: 
    
   - Установите внутренний флаг состояния, чтобы указать, что удаленное подключение должно быть установлено при призыве метода **IXPLogon::FlushQueues.** 
    
   - Установите правильные значения в таблице состояния, чтобы вызвать spooler MAPI, чтобы инициировать процесс очистки очереди.
    
   - После завершения очистки очередей отпустите общий ресурс.
    
   - Очистить STATUS_OFFLINE в **свойстве PR_STATUS_CODE.** 
    
   - Возвращение S_OK.
    
FORCE_XP_DISCONNECT 
  
> Поставщик удаленного транспорта должен освободить подключение к ресурсам системы обмена сообщениями. После этого следует установить STATUS_OFFLINE в свойстве  PR_STATUS_CODE и S_OK. 
    
PROCESS_XP_HEADER_CACHE 
  
> Поставщик удаленного транспорта должен обрабатывать удаленные сообщения и отправлять отложенные сообщения. Для этого поставщик транспорта должен задать следующие значения свойств в строке состояния объекта logon:
    
   - Установите **свойство PR_STATUS_STRING** строку, которая указывает пользователю состояние поставщика транспорта. 
    
   - Установите STATUS_OUTBOUND_ENABLED и STATUS_OUTBOUND_ACTIVE в **свойстве** PR_STATUS_CODE. 
    
   - Установите **свойство PR_REMOTE_VALIDATE_OK** в строке состояния поставщика транспорта false. 
    
   - Если еще одна операция (например, загрузка заготавлителей) при назважении **ValidateState, ПроверкаState** должна MAPI_E_BUSY.  
    
   - Выполните код для обработки REFRESH_XP_HEADER_CACHE флага, а также для удовлетворения требований клиента Microsoft Exchange.
    
REFRESH_XP_HEADER_CACHE 
  
> Поставщик удаленного транспорта должен получать новые заглавные сообщения из системы обмена сообщениями. Для этого поставщик транспорта должен сделать следующее:
    
   - Установите **свойство PR_STATUS_STRING** строку, которая указывает пользователю состояние поставщика транспорта. 
    
   - Установите STATUS_INBOUND_ENABLED и STATUS_INBOUND_ACTIVE в **свойстве** PR_STATUS_CODE. 
    
   - Очистить STATUS_OFFLINE в **свойстве PR_STATUS_CODE.** 
    
   - Установите STATUS_ONLINE в **свойстве PR_STATUS_CODE.** 
    
   - Установите **свойство PR_REMOTE_VALIDATE_OK** в строке состояния поставщика транспорта false. 
    
SHOW_XP_SESSION_UI 
  
> Если у поставщика транспорта есть какие-либо части пользовательского интерфейса для обработки загонщиков сообщений (например, диалоговое окно, которое подтверждает загрузку сообщений), диалоговое окно должно отображаться. В противном **случае ValidateState** может MAPI_E_NO_SUPPORT. 
    
Если какие-либо флаги, кроме этих, передаются, **ПроверкаState** должна MAPI_E_UNKNOWN_FLAGS. 
  
Часто клиент звонит поставщику транспорта по методу **IMAPIStatus::ValidateState.** Во время обработки **ValidateState** поставщик транспорта не должен выполнять действия, выделяющие ограниченные системные ресурсы, такие как модем или порт COM. Это происходит из-за того, что для пульпера MAPI иногда требуется смыть очереди на несколько поставщиков транспорта. Однако клиент может вызвать метод **ValidateState** любого поставщика транспорта в любое время. Если поставщик транспорта пытается выделить ограниченный ресурс во время обработки **ValidateState,** ошибка может привести к конфликту с другим поставщиком транспорта, который шпалер MAPI поручил смыть очереди. Если вы разрешаете все ограниченные выделения ресурсов происходить под руководством пулера MAPI, можно избежать таких конфликтов. Поставщик транспорта должен поддерживать свойство **PR_REMOTE_VALIDATE_OK,** чтобы клиентские приложения могли обнаруживать, когда поставщик транспорта занят или ждет, когда пуллер MAPI начнет действие. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Поскольку этот метод может вызвать другие потенциально длительные вызовы, **ValidateState** может вернуться MAPI_E_BUSY, чтобы сообщить вам, что этот метод ожидает завершения другой операции. Прежде чем пытаться выполнить другую задачу, необходимо дождаться завершения ожидаемой операции. 
  
Вы имеете самый полный контроль над вызовами объектов состояния поставщика транспорта. Вы можете передать один или несколько флагов **в ValidateState,** которые влияют на работу поставщика транспорта. Например, флаг ABORT_XP_HEADER_OPERATION указывает, что пользователь отменил проверку. Поставщики транспорта могут решить прервать, MAPI_E_USER_CANCELED или продолжить. 
  
Вы можете CONFIG_CHANGED флаг на вызов либо к объекту состояния поставщика услуг, либо к шпалеру MAPI, чтобы указать, что параметр конфигурации изменен. Вы можете использовать CONFIG_CHANGED для динамической перенастройки поставщика транспорта. При CONFIG_CHANGED вызове объекта состояния поставщика услуг поставщик отвечает вызовом [на IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md) чтобы предупредить шпалер MAPI об изменении. Когда вы CONFIG_CHANGED на вызов объекта состояния пульпера MAPI, шпалер вызывает [IXPLogon::AddressTypes](ixplogon-addresstypes.md) для каждого активного поставщика транспорта. **AddressTypes** информирует шпалер MAPI о поддерживаемых типах адресов транспорта. Некоторые поставщики услуг также отображают индикатор прогресса, если проверка, как ожидается, займет много времени. Отображение индикатора прогресса полезно, но не обязательно. 
  
Когда заданная SUPPRESS_UI, ни один из листов свойств конфигурации или диалоговых окне хода не может отображаться. 
  
## <a name="see-also"></a>См. также

- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)
- [IXPLogon::FlushQueues](ixplogon-flushqueues.md)
- [Каноническое свойство PidTagRemoteValidateOk](pidtagremotevalidateok-canonical-property.md)
- [Каноническое свойство PidTagResourceMethods](pidtagresourcemethods-canonical-property.md)
- [Каноническое свойство PidTagStatusCode](pidtagstatuscode-canonical-property.md)
- [Каноническое свойство PidTagStatusString](pidtagstatusstring-canonical-property.md)
- [IMAPIStatus : IMAPIProp](imapistatusimapiprop.md)

