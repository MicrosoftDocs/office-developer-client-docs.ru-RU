---
title: Реализация входа у поставщика услуг
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3d3c309f-fe60-43a9-beda-16b09ec769db
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 533c00a0c994e7dfc5adc476899553bc39a2a9ab
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32310089"
---
# <a name="implementing-service-provider-logon"></a>Реализация входа у поставщика услуг

**Область применения**: Outlook 2013 | Outlook 2016 
  
MAPI вызывает метод в объекте поставщика, чтобы начать процесс входа с помощью указателя, возвращенного из функции точки входа. Метод изменяется следующим образом в зависимости от типа поставщика услуг:
  
- [Иабпровидер:: вход](iabprovider-logon.md) для поставщиков адресных книг 
    
- [Функцииimsprovider:: вход в систему](imsprovider-logon.md) для поставщиков хранилищ сообщений 
    
- [Иксппровидер:: транспортлогон](ixpprovider-transportlogon.md) для поставщиков транспорта 
    
Выполните следующие действия в любом методе входа, который вы реализуете:
  
1. Увеличьте значение счетчика ссылок для объекта support, который передается в качестве входного параметра, вызвав его метод [IUnknown:: AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) . 
    
2. ВыЗовите метод [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md) объекта support для доступа к разделу профиля. 
    
3. ВыЗовите метод [IMAPIProp:: SetProps](imapiprop-setprops.md) раздела profile, чтобы задать следующие свойства: 
    
  - **Пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))
    
  - **Пр_ентрид** ([PidTagEntryId](pidtagentryid-canonical-property.md))
    
  - **Пр_провидер_дисплай** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))
    
  - **Пр_рекорд_кэй** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md))
    
  > [!NOTE]
  > Не пытайтесь задать свойства **пр_ресаурце_флагс** и **пр_провидер_длл_наме** раздела profile. Во время входа эти свойства доступны только для чтения. 
  
4. Убедитесь, что свойства, необходимые для настройки, хранятся в профиле или доступны от пользователя. Для получения дополнительных сведений о проверке конфигурации ознакомьтесь со статьей [Проверка конфигурации поставщика услуг](verifying-service-provider-configuration.md).
    
5. ВыЗовите метод [имаписуппорт:: сетпровидеруид](imapisupport-setprovideruid.md) объекта support, чтобы зарегистрировать уникальный идентификатор, или [мапиуид](mapiuid.md), если поставщик является адресной книгой или поставщиком хранилища сообщений. Поставщики транспорта регистрируют структуры **мапиуид** при вызове MAPI метода [Иксплогон:: аддресстипес](ixplogon-addresstypes.md) . Дополнительные сведения о регистрации **мапиуид**можно найти в статье [Регистрация уникальных идентификаторов поставщиков служб](registering-service-provider-unique-identifiers.md).
    
6. Создайте экземпляр объекта logon и возвратите одно из следующих значений:
    
  - Значение S_OK, указывающее на Успешный вход в систему.
    
  - МАПИ_Е_УНКОНФИГУРЕД, чтобы указать, что одно или несколько свойств конфигурации были недоступны.
    
  - МАПИ_Е_УСЕР_КАНЦЕЛ, чтобы указать, что пользователь отменил диалоговое окно Configuration, что привело к недоступности свойств конфигурации.
    
  - МАПИ_Е_ФАИЛОНЕПРОВИДЕР, чтобы указать, что поставщик не может быть настроен, но MAPI должен разрешить его использование независимо. Методы входа должны возвращать это значение, чтобы сообщить о неустранимой ошибке, например, когда поставщик требует пароль и не может запросить пользователя, так как интерфейс пользователя отключен. 
    
В предыдущем списке задач описывается минимальная реализация метода входа поставщика услуг. При необходимости можно включить дополнительные функции. Например, некоторые поставщики вызывают [имаписуппорт:: модифистатусров](imapisupport-modifystatusrow.md) для обновления таблицы состояний в методе logon. 
  
> [!NOTE]
> Чтобы обеспечить наилучшую производительность при входе в систему, не выполняйте вызов [имаписуппорт::P репаресубмит](imapisupport-preparesubmit.md) или [Имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md). Перед выполнением этих вызовов и возвратом управления методу входа в систему необходимо запустить диспетчер очереди MAPI. 
  
## <a name="see-also"></a>См. также

- [Запуск поставщика услуг](starting-a-service-provider.md)

