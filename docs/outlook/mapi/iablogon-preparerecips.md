---
title: IABLogonPrepareRecips
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IABLogon.PrepareRecips
api_type:
- COM
ms.assetid: 3c1845ea-e291-4855-9afd-51d2c64d7e85
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 0a9b88d762ca88cebd6d9acecf06db53a0b778f6
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33423862"
---
# <a name="iablogonpreparerecips"></a>IABLogon::PrepareRecips

**Область применения**: Outlook 2013 | Outlook 2016 
  
Подготавливает список получателей для более позднего использования системой обмена сообщениями.
  
```cpp
HRESULT PrepareRecips(
  ULONG ulFlags,
  LPSPropTagArray lpPropTagArray,
  LPADRLIST lpRecipList
);
```

## <a name="parameters"></a>Parameters

_ulFlags_
  
> [in] Немного флагов, которые контролируют тип текста в возвращенных строках. Можно установить следующий флаг:
    
  - MAPI_CACHE_ONLY. Для выполнения разрешения имен используйте только офлайн-адресную книгу. Например, этот флаг можно использовать, чтобы разрешить клиентской приложению открывать глобальный список адресов (GAL) в кэшном режиме обмена и получать доступ к записи в этой адресной книге из кэша без создания трафика между клиентом и сервером. Этот флаг поддерживается только поставщиком Exchange адресной книги.
    
_lpPropTagArray_
  
> [in] Указатель на структуру [SPropTagArray,](sproptagarray.md) которая содержит массив тегов свойств, которые указывают свойства, которые требуют обновления, если таковые имеются. Параметр  _lpPropTagArray может_ быть NULL. 
    
_lpRecipList_
  
> [in] Указатель на структуру [ADRLIST,](adrlist.md) которая содержит список получателей. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Список получателей был успешно подготовлен.
    
MAPI_E_NOT_FOUND 
  
> Один или несколько получателей в параметре  _lpRecipList_ не существуют. 
    
## <a name="return-value"></a>Возвращаемое значение

Клиент вызывает метод MAPI [IAddrBook::P repareRecips,](iaddrbook-preparerecips.md) чтобы изменить или изменить набор свойств для одного или более получателей. Получатели могут быть или не быть частью списка получателей исходя из сообщения. MAPI передает этот вызов **методу IABLogon::P repareRecips.** 
  
**IABLogon::P repareRecips** выполняет четыре основные задачи: 
  
- Гарантирует, что все получатели в списке адресов, на которые указывает параметр  _lpRecipList,_ имеют долгосрочный идентификатор входа. 
    
- Гарантирует, что все получатели имеют свойства, указанные в массиве значений свойств, указанных _параметром lpPropTagArray._ 
    
- Гарантирует, что свойства из массива значений свойств отображаются перед любыми другими свойствами, существовать до вызова.
    
- Гарантирует, что порядок свойств в структуре [ADRENTRY](adrentry.md) каждого получателя в **структуре ADRLIST** будет таким же, как в массиве значений свойств. 
    
Структура **ADRENTRY** в параметре  _lpRecipList_ содержит одну **структуру ADRENTRY** для каждого получателя. Каждая **структура ADRENTRY** содержит массив [структур SPropValue](spropvalue.md) для описания свойств получателя. Когда **возвращается IABLogon::P repareRecips,** массив **структуры SPropValue** для каждого получателя включает свойства  _из lpPropTagArray,_ а затем другие свойства для получателя. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Реализация **IABLogon::P repareRecips** предполагает ввод свойств в определенный порядок, ирисовку значений свойств и преобразование краткосрочных идентификаторов записей в долгосрочные идентификаторы записей. Свойства, запрашиваемые в параметре _lpPropTagArray,_ должны быть в начале массива значений свойств, связанного со структурой **ADRENTRY** каждого получателя в параметре _lpRecipList._ Если значений для этих свойств не существует, откройте связанного пользователя обмена сообщениями или список рассылки с помощью его идентификатора записи и извлекайте недостающие значения свойств. 
  
Распределите каждую структуру **SPropValue,** переданную в  _lpRecipList_ отдельно, чтобы эти структуры могли быть освобождены по отдельности. Если необходимо выделить дополнительное пространство для любой структуры **SPropValue,** например для хранения данных для свойства строки, используйте функцию [MAPIAllocateBuffer](mapiallocatebuffer.md) для выделения дополнительного пространства для полного массива значений свойства. Используйте [функцию MAPIFreeBuffer,](mapifreebuffer.md) чтобы освободить исходный массив значений свойств, а затем использовать функцию [MAPIAllocateMore,](mapiallocatemore.md) чтобы выделить любую необходимую дополнительную память. 
  
Чтобы реализовать **IABLogon::P repareRecips,** используйте следующую процедуру:
  
1. Проверьте записи в _параметре lpPropTagArray._ Если массив значений свойств пуст, не нужно делать никаких работ. Возврат значения успешности. 
    
2. Обработать каждого получателя в _параметре lpRecipList._ Для каждого получателя в списке имеется один член структуры **ADRENTRY.** Игнорируйте следующие типы получателей: 
    
   - Получатели без идентификатора записи в **члене rgPropVals** их **структуры ADRENTRY** (то есть неурегулированных получателей). 
    
   - Получатели с идентификатором записи, который не принадлежит поставщику. Эти получатели будут переданы другому поставщику адресной книги.
    
3. Откройте получателя и извлекай свойства, которые уже настроены для получателя.
    
4. Объединение массива значений свойств, указанного в _lpRecipList,_ с массивом свойств, возвращаемых **из GetProps.** Если одно и то же свойство встречается в обоих массивах свойств, используйте значение _из lpRecipList._
    
5. Если массив  _свойств lpRecipList_ достаточно велик, чтобы вместить все необходимые свойства, просто замените его объединенным массивом. Если массив  _свойств lpRecipList_ недостаточно велик, замените его новым выделенным массивом. Убедитесь, что новый массив имеет обновленное значение в каждом из членов **cValues.** 
    
6. Если вы не распознаёте одно или несколько свойств в параметре  _lpPropTagArray,_ установите тип свойства в структуре **ADRENTRY** получателя PT_ERROR и значение свойства MAPI_E_NOT_FOUND или другое значение, которое дает более конкретную причину недоступности свойства. Сведения о PT_ERROR см. в этой PT_ERROR [типах свойств.](property-types.md)
    
> [!NOTE]
> Никогда не перерасполнять структуру **ADRLIST,** которая передается в **IABLogon::P repareRecips,** или изменять ее количество записей. 
  
## <a name="see-also"></a>См. также

- [ADRLIST](adrlist.md)
- [IMAPIProp::GetProps](imapiprop-getprops.md)
- [Каноническое свойство PidTagEntryId](pidtagentryid-canonical-property.md)
- [SPropValue](spropvalue.md)
- [IABLogon : IUnknown](iablogoniunknown.md)

