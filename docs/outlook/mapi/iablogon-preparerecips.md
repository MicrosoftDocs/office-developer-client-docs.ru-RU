---
title: IABLogonPrepareRecips
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IABLogon.PrepareRecips
api_type:
- COM
ms.assetid: 3c1845ea-e291-4855-9afd-51d2c64d7e85
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 0a9b88d762ca88cebd6d9acecf06db53a0b778f6
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33423862"
---
# <a name="iablogonpreparerecips"></a>IABLogon::PrepareRecips

**Относится к**: Outlook 2013 | Outlook 2016 
  
Подготавливает список получателей к дальнейшему использованию системой обмена сообщениями.
  
```cpp
HRESULT PrepareRecips(
  ULONG ulFlags,
  LPSPropTagArray lpPropTagArray,
  LPADRLIST lpRecipList
);
```

## <a name="parameters"></a>Параметры

_ulFlags_
  
> [in] Битоваяmas флагов, которая управляет типом текста в возвращаемой строке. Можно установить следующий флаг:
    
  - MAPI_CACHE_ONLY: используйте только автономной адресной книги для разрешения имен. Например, этот флаг можно использовать, чтобы разрешить клиентского приложения открывать глобальный список адресов (GAL) в режиме кэшации exchange и получать доступ к записи в этой адресной книге из кэша без создания трафика между клиентом и сервером. Этот флаг поддерживается только поставщиком адресной книги Exchange.
    
_lpPropTagArray_
  
> [in] Указатель на структуру [SPropTagArray,](sproptagarray.md) которая содержит массив тегов свойств, которые указывают свойства, которые требуют обновления, если таковые имеются. Параметр  _lpPropTagArray может_ иметь NULL. 
    
_lpRecipList_
  
> [in] Указатель на структуру [ADRLIST,](adrlist.md) которая содержит список получателей. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Список получателей успешно подготовлен.
    
MAPI_E_NOT_FOUND 
  
> Один или несколько получателей в параметре  _lpRecipList_ не существуют. 
    
## <a name="return-value"></a>Возвращаемое значение

Клиент вызывает метод MAPI [IAddrBook::P repareRecips](iaddrbook-preparerecips.md) для изменения или переустановки набора свойств для одного или более получателей. Получатели могут быть или не быть частью списка получателей исходяния сообщения. MAPI передает этот вызов методу **IABLogon::P repareRecips** поставщика адресной книги. 
  
**IABLogon::P repareRecips** выполняет четыре основных задачи: 
  
- Гарантирует, что все получатели в списке адресов, на которые указывает параметр  _lpRecipList,_ имеют долгосрочный идентификатор записи. 
    
- Гарантирует, что у всех получателей есть свойства, указанные в массиве значений свойств, на которые указывает параметр _lpPropTagArray._ 
    
- Гарантирует, что свойства из массива значений свойств будут отображаться перед любыми другими свойствами, которые существовали перед вызовом.
    
- Обеспечивает тот же порядок свойств в структуре [ADRENTRY](adrentry.md) каждого получателя в структуре **ADRLIST,** что и в массиве значений свойств. 
    
Структура **ADRENTRY** в параметре  _lpRecipList_ содержит одну структуру **ADRENTRY** для каждого получателя. Каждая **структура ADRENTRY** содержит массив [структур SPropValue](spropvalue.md) для описания свойств получателя. Когда **возвращается IABLogon::P repareRecips,** массив структуры **SPropValue** для каждого получателя включает свойства  _из lpPropTagArray_ и другие свойства получателя. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Реализация **IABLogon::P repareRecips** подразумевает размещение свойств в определенном порядке, и получения значений свойств и преобразование краткосрочных идентификаторов записей в долгосрочные идентификаторы записей. Свойства, запрашиваемые в параметре _lpPropTagArray,_ должны быть в начале массива значений свойств, связанного со структурой **ADRENTRY** каждого получателя в параметре _lpRecipList._ Если значения этих свойств не существуют, откройте связанный с ним пользователь или список рассылки сообщений, используя идентификатор записи и извлекая отсутствующие значения свойств. 
  
Распределите **каждую структуру SPropValue,** переданную  _в lpRecipList,_ отдельно, чтобы структуры можно было освободить по отдельности. Если необходимо выделить дополнительное пространство для любой структуры **SPropValue,** например для хранения данных для строкового свойства, используйте функцию [MAPIAllocateBuffer,](mapiallocatebuffer.md) чтобы выделить дополнительное пространство для всего массива значений свойств. Используйте [функцию MAPIFreeBuffer,](mapifreebuffer.md) чтобы освободить исходный массив значений свойств, а затем используйте функцию [MAPIAllocateMore,](mapiallocatemore.md) чтобы выделить дополнительную память, необходимую. 
  
Чтобы реализовать **IABLogon::P repareRecips,** используйте следующую процедуру:
  
1. Проверьте записи в параметре _lpPropTagArray._ Если массив значений свойств пуст, то не нужно ничего делать. Возврат значения успешности. 
    
2. Обработать каждого получателя в _параметре lpRecipList._ Для каждого получателя в списке имеется один член структуры **ADRENTRY.** Игнорируйте следующие типы получателей: 
    
   - Получатели без идентификатора записи в члене **rgPropVals** их **структуры ADRENTRY** (то есть не разрешенные получатели). 
    
   - Получатели с идентификатором записи, который не принадлежит поставщику. Эти получатели будут переданы другому поставщику адресной книги.
    
3. Откройте получателя и извлекаете свойства, которые уже настроены для получателя.
    
4. Объединение массива значений свойств, указанного в _lpRecipList,_ с массивом свойств, возвращаемого **getProps.** Если одно и то же свойство происходит в обоих массивах свойств, используйте значение _из lpRecipList._
    
5. Если массив  _значений свойств lpRecipList_ достаточно велик для размещения всех необходимых свойств, просто замените его объединенным массивом. Если массив  _значений свойств lpRecipList_ недостаточно велик, замените его новым выделенным массивом. Убедитесь, что новый массив имеет обновленное значение в каждом из его **членов cValues.** 
    
6. Если одно или несколько свойств в параметре  _lpPropTagArray_ не распознаются, установите для типа свойства в структуре **получателя ADRENTRY** значение PT_ERROR и значение свойства MAPI_E_NOT_FOUND или другое значение, которое дает более конкретную причину недоступности свойства. Сведения о PT_ERROR [см.](property-types.md)в
    
> [!NOTE]
> Никогда не перерасполнять структуру **ADRLIST,** которая передается в **IABLogon::P repareRecips,** или изменять количество записей. 
  
## <a name="see-also"></a>См. также

- [ADRLIST](adrlist.md)
- [IMAPIProp::GetProps](imapiprop-getprops.md)
- [Каноническое свойство PidTagEntryId](pidtagentryid-canonical-property.md)
- [SPropValue](spropvalue.md)
- [IABLogon : IUnknown](iablogoniunknown.md)

