---
title: иаблогонпрепаререЦипс
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IABLogon.PrepareRecips
api_type:
- COM
ms.assetid: 3c1845ea-e291-4855-9afd-51d2c64d7e85
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 0a9b88d762ca88cebd6d9acecf06db53a0b778f6
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33423862"
---
# <a name="iablogonpreparerecips"></a>IABLogon::PrepareRecips

**Относится к**: Outlook 2013 | Outlook 2016 
  
Подготавливает список получателей для последующего использования системой обмена сообщениями.
  
```cpp
HRESULT PrepareRecips(
  ULONG ulFlags,
  LPSPropTagArray lpPropTagArray,
  LPADRLIST lpRecipList
);
```

## <a name="parameters"></a>Параметры

_ulFlags_
  
> возврата Битовая маска флагов, определяющая тип текста в возвращаемых строках. Можно задать следующий флаг:
    
  - MAPI_CACHE_ONLY: для разрешения имен используется только автономная адресная книга. Например, вы можете использовать этот флаг, чтобы разрешить клиентскому приложению открывать глобальный список адресов (GAL) в режиме кэширования Exchange и получать доступ к записи в этой адресной книге из кэша, не создавая трафик между клиентом и сервером. Этот флаг поддерживается только поставщиком адресной книги Exchange.
    
_лппроптагаррай_
  
> возврата Указатель на структуру [спроптагаррай](sproptagarray.md) , которая содержит массив тегов свойств, указывающих свойства, которые требуют обновления, если таковые имеются. Параметр _лппроптагаррай_ может иметь значение null. 
    
_лпреЦиплист_
  
> возврата Указатель на структуру [ADRLIST](adrlist.md) , в которой хранится список получателей. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Список получателей был успешно подготовлен.
    
MAPI_E_NOT_FOUND 
  
> Один или несколько получателей в параметре _лпреЦиплист_ не существуют. 
    
## <a name="return-value"></a>Возвращаемое значение

Клиент вызывает метод MAPI [IAddrBook::P репаререЦипс](iaddrbook-preparerecips.md) , чтобы изменить или изменить набор свойств для одного или нескольких получателей. Получатели могут или не входить в список получателей исходящих сообщений. MAPI передает этот вызов методу поставщика адресных книг **иаблогон::P репаререЦипс** . 
  
**Иаблогон::P репаререЦипс** выполняет четыре основные задачи: 
  
- Гарантирует, что все получатели в списке адресов, на которые указывает параметр _лпреЦиплист_ , содержат долгосрочный идентификатор записи. 
    
- Гарантирует, что все получатели имеют свойства, указанные в массиве значений свойства, на который указывает параметр _лппроптагаррай_ . 
    
- Гарантирует, что свойства из массива значений свойств появятся перед всеми другими свойствами, существовавшими перед вызовом.
    
- Гарантирует, что порядок свойств в структуре [адрентри](adrentry.md) каждого получателя в структуре **ADRLIST** совпадает с порядком в массиве значений свойства. 
    
Структура **адрентри** в параметре _лпреЦиплист_ содержит одну структуру **адрентри** для каждого получателя. Каждая структура **адрентри** содержит массив структур [спропвалуе](spropvalue.md) , описывающих свойства получателя. Когда **иаблогон::P репаререЦипс** возвращает, массив структуры **спропвалуе** для каждого получателя содержит свойства _лппроптагаррай_ , за которыми следуют другие свойства получателя. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Реализация **иаблогон::P репаререЦипс** включает в себя размещение свойств в определенном порядке, извлечение значений свойств и преобразование коротких идентификаторов записей в долгосрочные идентификаторы записей. Свойства, запрашиваемые в параметре _лппроптагаррай_ , должны находиться в начале массива значений свойства, связанного с каждой структурой **адрентри** каждого получателя в параметре _лпреЦиплист_ . Если значения для этих свойств не существуют, откройте связанный пользователь обмена сообщениями или список рассылки с помощью идентификатора записи и извлеките отсутствующие значения свойств. 
  
Разделяйте каждую структуру **спропвалуе** , переданную в _лпреЦиплист_ , по отдельности, чтобы можно было освободить отдельные структуры. Если необходимо выделить дополнительное пространство для любой структуры **спропвалуе** , например для хранения данных для свойства String, используйте функцию [мапиаллокатебуффер](mapiallocatebuffer.md) , чтобы выделить дополнительное пространство для полного массива значений свойства. С помощью функции [мапифрибуффер](mapifreebuffer.md) Освободите исходный массив значений свойства, а затем используйте функцию [мапиаллокатеморе](mapiallocatemore.md) , чтобы выделить необходимую дополнительную память. 
  
Чтобы реализовать **иаблогон::P репаререЦипс**, используйте следующую процедуру:
  
1. Проверьте наличие записей в параметре _лппроптагаррай_ . Если массив значений свойства пуст, нет действий, которые можно выполнить. Возвращает значение Success. 
    
2. Обработайте каждого получателя в параметре _лпреЦиплист_ . Для каждого получателя в списке существует один элемент структуры **адрентри** . Пропускать следующие типы получателей: 
    
   - Получатели без идентификатора записи в **ргпропвалс** -члене структуры **адрентри** (то есть неразрешенных получателей). 
    
   - Получатели с идентификатором записи, который не принадлежит поставщику. Эти получатели будут переданы другому поставщику адресных книг.
    
3. Откройте получателя и извлеките свойства, которые уже заданы для получателя.
    
4. Слияние массива значений свойства, указанного в параметре _лпреЦиплист_ , с массивом свойств, возвращаемых методом **PROPS**. Если одно и то же свойство присутствует в обоих массивах свойств, используйте значение из _лпреЦиплист_.
    
5. Если массив значений свойства _лпреЦиплист_ достаточно велик для хранения всех необходимых свойств, просто замените его на объединенный массив. Если массив значений свойства _лпреЦиплист_ недостаточно велик, замените его новым выделенным массивом. Убедитесь, что новый массив имеет обновленное значение в каждом из его элементов **квалуес** . 
    
6. Если вы не распознаете одно или несколько свойств в параметре _лппроптагаррай_ , задайте для свойства тип свойства в структуре **адрентри** получателя значение PT_ERROR и значение свойства — MAPI_E_NOT_FOUND или другое значение, которое предоставляет более конкретную причину недоступности свойства. Дополнительные сведения о PT_ERRORх: [типы свойств](property-types.md).
    
> [!NOTE]
> Никогда не Перераспределите структуру **ADRLIST** , переданную в **Иаблогон::P репаререЦипс** или измените количество записей. 
  
## <a name="see-also"></a>См. также

- [ADRLIST](adrlist.md)
- [IMAPIProp::GetProps](imapiprop-getprops.md)
- [Каноническое свойство PidTagEntryId](pidtagentryid-canonical-property.md)
- [SPropValue](spropvalue.md)
- [IABLogon : IUnknown](iablogoniunknown.md)

