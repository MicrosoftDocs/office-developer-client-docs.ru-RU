---
title: имаписессионопенмсгсторе
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPISession.OpenMsgStore
api_type:
- COM
ms.assetid: 7f73b5cf-7093-42e9-8acc-63d73df77cf5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 19d3df004676a71e2bf6243d9288efd824d99c33
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33418024"
---
# <a name="imapisessionopenmsgstore"></a>IMAPISession::OpenMsgStore

**Относится к**: Outlook 2013 | Outlook 2016 
  
Открывает хранилище сообщений и возвращает указатель [IMsgStore](imsgstoreimapiprop.md) для получения доступа. 
  
```cpp
HRESULT OpenMsgStore(
  ULONG_PTR ulUIParam,
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  LPCIID lpInterface,
  ULONG ulFlags,
  LPMDB FAR * lppMDB
);
```

## <a name="parameters"></a>Параметры

_улуипарам_
  
> возврата Дескриптор родительского окна для диалогового окна общего адреса и других связанных дисплеев.
    
_кбентрид_
  
> возврата Число байтов в идентификаторе записи, на которое указывает параметр _лпентрид_ . 
    
_лпентрид_
  
> возврата Указатель на идентификатор записи хранилища сообщений, который необходимо открыть. Параметр _лпентрид_ не должен иметь значение null. 
    
_лпинтерфаце_
  
> возврата Указатель на идентификатор интерфейса (IID), представляющий интерфейс, который будет использоваться для доступа к хранилищу сообщений. При передаче значения NULL параметр _лппмдб_ возвращает указатель на стандартный интерфейс для хранилища сообщений (**IMsgStore**).
    
_ulFlags_
  
> возврата Битовая маска флагов, определяющих способ открытия объекта. Можно использовать следующие флаги:
    
  - MAPI_BEST_ACCESS: запросы, которые должны быть открыты в хранилище сообщений с максимальными разрешениями в сети, разрешенными для пользователя и максимальными разрешениями клиентского приложения. Например, если у клиента есть разрешение на чтение и запись, необходимо открыть хранилище сообщений с разрешением на чтение и запись; Если клиент имеет разрешение только на чтение, оно должно быть открыто с разрешением только для чтения. 
      
  - MAPI_DEFERRED_ERRORS: разрешает успешно возвращаться **опенмсгсторе** , возможно, перед тем, как хранилище сообщений будет полностью доступно для вызывающего клиента. Если хранилище сообщений недоступно, то выполнение следующего вызова объекта может вызвать ошибку. 
      
  - NO_DIALOG\_MDB: запрещает отображение диалоговых окон входа в систему. Если этот флаг установлен, а **опенмсгсторе** не хватает сведений о конфигурации, чтобы открыть хранилище сообщений без пользовательской справки, возвращается MAPI_E_LOGON_FAILED. Если этот флаг не установлен, поставщик хранилища сообщений может предложить пользователю исправить имя или пароль или выполнить другие действия, необходимые для установки подключения к хранилищу сообщений. 
      
  - NO_MAIL\_MDB: хранилище сообщений не должно использоваться для отправки и получения почты. Если этот флаг установлен, MAPI не уведомляет Диспетчер очереди MAPI о том, что это хранилище сообщений открыто.
      
  - MDB\_Online: в режиме кэширования Exchange клиент или поставщик услуг может вызвать этот метод с MDB_ONLINE для переопределения подключения к локальному хранилищу сообщений и открытия хранилища на удаленном сервере. Вы не можете открыть хранилище Exchange в режиме кэширования и в некэшированном режиме одновременно в том же сеансе MAPI. Если вы уже открыли хранилище кэшированных сообщений, потребуется его закрыть перед открытием с этим флагом или открыть новый сеанс MAPI, в котором можно будет открыть хранилище Exchange на удаленном сервере с использованием этого флага.
      
  - MDB_TEMPORARY: предписывает MAPI, что хранилище сообщений не является постоянным и не должно добавляться в таблицу хранения сообщений. Этот флаг используется для входа в хранилище сообщений, что позволяет программно получать данные из раздела профиля. 
      
  - MDB_WRITE: запрашивает разрешение на чтение и запись в хранилище сообщений.
    
_лппмдб_
  
> вышли Указатель на указатель хранилища сообщений.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Хранилище сообщений успешно открыто.
    
MAPI_E_NO_ACCESS 
  
> Предпринята попытка получить доступ к хранилищу сообщений, для которого у пользователя недостаточно разрешений.
    
MAPI_E_NOT_FOUND 
  
> Хранилище сообщений, указанное в _лпентрид_ , не существует. 
    
MAPI_E_UNKNOWN_CPID 
  
> Сервер не настроен для поддержки кодовой страницы клиента.
    
MAPI_E_UNKNOWN_LCID 
  
> Сервер не настроен для поддержки информации о языковых стандартах клиента.
    
MAPI_W_ERRORS_RETURNED 
  
> Вызов выполнен успешно, но у поставщика хранилища сообщений есть доступные сведения об ошибке. При возвращении этого предупреждения вызов должен обрабатываться как успешный. Чтобы получить сведения об ошибке от поставщика, вызовите метод [IMAPISession:: GetLastError](imapisession-getlasterror.md) . Чтобы проверить это предупреждение, используйте макрос **HR_FAILED** . Дополнительные сведения см. [в разделе Использование макросов для обработки ошибок](using-macros-for-error-handling.md).
    
## <a name="remarks"></a>Примечания

Метод **IMAPISession:: опенмсгсторе** открывает определенное хранилище сообщений. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Уровень разрешений по умолчанию для хранилищ сообщений доступен только для чтения. Если вы установили флаг MDB_WRITE, вы по-прежнему можете получить разрешение на чтение и запись. Конечный уровень доступа, который MAPI назначает хранилищу сообщений, зависит от вашего уровня разрешений, самого хранилища сообщений и поставщика хранилища сообщений. 
  
Если вы вызовите **опенмсгсторе** , чтобы открыть хранилище сообщений с разрешением только для чтения, произойдет следующее: 
  
- Для свойства **\_STORE_SUPPORT_MASK** в магазине Store ([PIDTAGSTORESUPPORTMASK](pidtagstoresupportmask-canonical-property.md)) не будет MODIFY_OK Store\_и хранилище\_CREATE_OK BITS. 
    
- Вызовы для открытия одного из сообщений или папок хранилища сообщений с помощью [IMAPISession:: OpenEntry](imapisession-openentry.md) с установленным флагом MAPI_MODIFY завершатся с ошибками. 
    
- Вызовы для открытия одного из свойств сообщений или папок хранилища сообщений с помощью [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) с флагом MAPI_MODIFY завершатся с ошибками. 
    
- При вызове любого из следующих методов произойдет ошибка: 
    
  - [IMAPIFolder::CreateMessage](imapifolder-createmessage.md)
    
  - [IMAPIFolder::DeleteMessages](imapifolder-deletemessages.md)
    
  - [IMAPIFolder::CreateFolder](imapifolder-createfolder.md)
    
  - [IMAPIFolder::DeleteFolder](imapifolder-deletefolder.md)
    
  - [IMAPIFolder::SetMessageStatus](imapifolder-setmessagestatus.md)
    
  - [IMAPIProp::SetProps](imapiprop-setprops.md)
    
  - [IMAPIProp::DeleteProps](imapiprop-deleteprops.md)
  
- Вызовы следующих методов завершатся с ошибками, если целевой объект для скопированного сообщения доступен только для чтения, независимо от того, совпадает ли целевой объект с исходным хранилищем сообщений или другое хранилище, доступное только для чтения.
    
  - [IMAPIFolder::CopyMessages](imapifolder-copymessages.md)
    
  - [IMAPIFolder::CopyFolder](imapifolder-copyfolder.md)
    
  - [IMAPIProp::CopyTo](imapiprop-copyto.md)
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Маписторефунктионс. cpp  <br/> |каллопенмсгсторе  <br/> |MFCMAPI использует метод **IMAPISession:: опенмсгсторе** , чтобы открыть хранилище сообщений.  <br/> |
   
## <a name="see-also"></a>См. также

- [IMsgStore: IMAPIProp](imsgstoreimapiprop.md)
- [IMAPISession::GetLastError](imapisession-getlasterror.md)
- [IMAPISession::OpenEntry](imapisession-openentry.md)
- [IMAPIProp::OpenProperty](imapiprop-openproperty.md)
- [IMAPISession: IUnknown](imapisessioniunknown.md)
- [MFCMAPI как пример кода](mfcmapi-as-a-code-sample.md)
- [Использование макросов для обработки ошибок](using-macros-for-error-handling.md)

