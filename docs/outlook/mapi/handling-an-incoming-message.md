---
title: Обработка входящего сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d45d5ed9-41cd-4aaf-91d2-1e4a27bb16d4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: f3fbe34793e3520b26b984f4bd6b14fbcab7a951
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438983"
---
# <a name="handling-an-incoming-message"></a><span data-ttu-id="ff9b1-103">Обработка входящего сообщения</span><span class="sxs-lookup"><span data-stu-id="ff9b1-103">Handling an incoming message</span></span>

<span data-ttu-id="ff9b1-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="ff9b1-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="ff9b1-105">Входящее сообщение — это сообщение, которое было отправлено в одну или несколько систем обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-105">An incoming message is a message that has been sent across one or more messaging systems.</span></span> <span data-ttu-id="ff9b1-106">Оно может быть отправлено только вам или нескольким другим получателям.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-106">It may have been sent only to you or to many other recipients.</span></span> <span data-ttu-id="ff9b1-107">Входящие сообщения помещаются в папку получения, предназначенную для хранения сообщений определенного класса.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-107">Incoming messages are placed in a receive folder designated to hold messages of a particular class.</span></span> <span data-ttu-id="ff9b1-108">Вы можете настроить другую папку получения для каждого класса сообщений, который обрабатывает или использует одну папку для всех классов.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-108">You can set up a different receive folder for each message class that you handle or use one folder for all of the classes.</span></span>
  
<span data-ttu-id="ff9b1-109">Если вы зарегистрировались для получения уведомлений о новых почтовых сообщениях с хранилищем сообщений, вы получите уведомление, когда сообщение помещается в папку получения.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-109">If you have registered for new mail notifications with the message store, you will be notified whenever a message is placed in a receive folder.</span></span> <span data-ttu-id="ff9b1-110">Если вы не зарегистрировались для получения новых почтовых уведомлений, необходимо периодически открывать соответствующую папку получения, чтобы вручную проверить поступление новых сообщений.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-110">If you have not registered for new mail notifications, you must open the appropriate receive folder periodically to manually check for the arrival of new messages.</span></span>
  
<span data-ttu-id="ff9b1-111">Клиенты регистрируют уведомления о новых почтовых сообщениях, устанавливая параметры в [IMsgStore:: Advise](imsgstore-advise.md) следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ff9b1-111">Clients register for new mail notifications by setting the parameters to [IMsgStore::Advise](imsgstore-advise.md) as follows:</span></span> 
  
- <span data-ttu-id="ff9b1-112">Задайте для параметра _кбентрид_ значение 0.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-112">Set  _cbEntryID_ to 0.</span></span> 
    
- <span data-ttu-id="ff9b1-113">Присвойте параметру _лпентрид_ значение null.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-113">Set  _lpEntryID_ to NULL.</span></span> 
    
- <span data-ttu-id="ff9b1-114">Задайте для параметра _улевентмаск_ значение фневневмаил.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-114">Set  _ulEventMask_ to fnevNewMail.</span></span> 
    
<span data-ttu-id="ff9b1-115">Параметр _лпнотификатионс_ в вызове метода **имапиадвисесинк:: OnNotify** указывает на структуру **уведомлений NEWMAIL\_** , которая содержит сведения о входящем сообщении, такие как класс Message, его идентификатор записи, идентификатор записи родительской папки и содержимое его свойства **PR_MESSAGE_FLAGS** .</span><span class="sxs-lookup"><span data-stu-id="ff9b1-115">The  _lpNotifications_ parameter in the call to your **IMAPIAdviseSink::OnNotify** method points to a **NEWMAIL\_NOTIFICATION** structure that contains information about the incoming message, such as its message class, its entry identifier, the entry identifier of its parent folder, and the contents of its **PR_MESSAGE_FLAGS** property.</span></span> <span data-ttu-id="ff9b1-116">Дополнительные сведения о регистрации и обработке уведомлений можно найти в статье [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md), [NEWMAIL_NOTIFICATION](newmail_notification.md), **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) и [обработки уведомлений](handling-notifications.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-116">For more information about registering for and handling notifications, see [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md), [NEWMAIL_NOTIFICATION](newmail_notification.md), **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)), and [Handling Notifications](handling-notifications.md).</span></span> 
  
<span data-ttu-id="ff9b1-117">Перед отображением входящего сообщения для пользователя определите, является ли его класс сообщений классом, поддерживаемым клиентом.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-117">Before displaying an incoming message to a user, determine if its message class is a class that your client supports.</span></span> <span data-ttu-id="ff9b1-118">Если нет, проигнорируйте сообщение.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-118">If not, ignore the message.</span></span> <span data-ttu-id="ff9b1-119">Если вы поддерживаете этот класс, вы можете открыть и отобразить сообщение в форме, которая соответствует классу сообщения сообщения.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-119">If the class is one that you support, you can open and display the message with a form that is appropriate for the message class of the message.</span></span> <span data-ttu-id="ff9b1-120">Выбор форм зависит от класса Message.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-120">The choice of forms is based on message class.</span></span> <span data-ttu-id="ff9b1-121">Сообщения, принадлежащие классу IPM, используют стандартную форму, реализуемую MAPI.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-121">Messages that belong to the IPM class use a default form implemented by MAPI.</span></span> <span data-ttu-id="ff9b1-122">Сообщения, принадлежащие пользовательским классам, которые определяются клиентами, могут использовать как пользовательские формы, так и формы MAPI по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-122">Messages that belong to custom classes defined by clients can use either client-defined specialized forms or the MAPI default form.</span></span>
  
## <a name="open-and-display-an-incoming-message"></a><span data-ttu-id="ff9b1-123">Открытие и отображение входящего сообщения</span><span class="sxs-lookup"><span data-stu-id="ff9b1-123">Open and display an incoming message</span></span>
  
1. <span data-ttu-id="ff9b1-124">Call **IMsgStore:: жетрецеивефолдер** для получения идентификатора записи папки получения для класса сообщений и передайте этот идентификатор записи в **IMsgStore:: OpenEntry** , чтобы открыть папку.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-124">Call **IMsgStore::GetReceiveFolder** to retrieve the entry identifier of the receive folder for the message class of the message and pass this entry identifier to **IMsgStore::OpenEntry** to open the folder.</span></span> <span data-ttu-id="ff9b1-125">Дополнительные сведения см. в статье [IMsgStore:: жетрецеивефолдер](imsgstore-getreceivefolder.md), [IMsgStore:: OpenEntry](imsgstore-openentry.md)и [Открытие папки хранилища сообщений](opening-a-message-store-folder.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-125">For more information, see [IMsgStore::GetReceiveFolder](imsgstore-getreceivefolder.md), [IMsgStore::OpenEntry](imsgstore-openentry.md), and [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
    
2. <span data-ttu-id="ff9b1-126">Вызовите метод **IMAPIContainer:: жетконтентстабле** папки получения для получения его таблицы содержимого.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-126">Call the receive folder's **IMAPIContainer::GetContentsTable** method to retrieve its contents table.</span></span> <span data-ttu-id="ff9b1-127">Дополнительные сведения см. в статье [IMAPIContainer:: жетконтентстабле](imapicontainer-getcontentstable.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-127">For more information, see [IMAPIContainer::GetContentsTable](imapicontainer-getcontentstable.md).</span></span> <span data-ttu-id="ff9b1-128">Вызовите метод **IMAPITable:: QueryRows** для получения всех строк в таблице.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-128">Call the table's **IMAPITable::QueryRows** method to retrieve all the rows in the table.</span></span> <span data-ttu-id="ff9b1-129">Дополнительные сведения см. в статье [IMAPITable:: QueryRows](imapitable-queryrows.md) and [Content Tables](contents-tables.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-129">For more information see [IMAPITable::QueryRows](imapitable-queryrows.md) and [Contents Tables](contents-tables.md).</span></span> <span data-ttu-id="ff9b1-130">Дополнительные сведения о отображении таблицы содержимого приведены в статье [Отображение таблицы содержимого папки](displaying-a-folder-contents-table.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-130">For more information about displaying a contents table, see [Displaying a Folder Contents Table](displaying-a-folder-contents-table.md).</span></span>
    
3. <span data-ttu-id="ff9b1-131">Если ваш клиент является интерактивным, разрешить пользователю выбирать сообщение из таблицы и определять форму, которая будет использоваться для отображения этого сообщения.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-131">If your client is interactive, allow the user to select a message from the table and determine the form to be used to display that message.</span></span> <span data-ttu-id="ff9b1-132">Клиенты могут использовать форму по умолчанию, предоставляемую MAPI или настраиваемую форму.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-132">Clients can use the default form provided by MAPI or a custom form.</span></span> <span data-ttu-id="ff9b1-133">Более подробную информацию можно найти в статье [Обработка форм MAPI](handling-mapi-forms.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-133">For more information, see [Handling MAPI Forms](handling-mapi-forms.md).</span></span>
    
4. <span data-ttu-id="ff9b1-134">Call **IMsgStore:: OpenEntry** , чтобы открыть сообщение.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-134">Call **IMsgStore::OpenEntry** to open the message.</span></span> <span data-ttu-id="ff9b1-135">Дополнительную информацию можно узнать в статье [Открытие сообщения](opening-a-message.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-135">For more information, see [Opening a Message](opening-a-message.md).</span></span>
    
5. <span data-ttu-id="ff9b1-136">Обработка текста сообщения.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-136">Process the message text.</span></span> <span data-ttu-id="ff9b1-137">Дополнительные сведения можно найти в разделе [Открытие текста сообщения](opening-message-text.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-137">For more information, see [Opening Message Text](opening-message-text.md).</span></span>
    
6. <span data-ttu-id="ff9b1-138">Отображение всех вложений в сообщениях.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-138">Render each of the message attachments.</span></span> <span data-ttu-id="ff9b1-139">Дополнительную информацию можно узнать [в статье отображение вложения в виде обычного текста](rendering-an-attachment-in-plain-text.md) или [Отображение вложения в тексте в формате RTF](rendering-an-attachment-in-rtf-text.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-139">For more information, see [Rendering an Attachment in Plain Text](rendering-an-attachment-in-plain-text.md) or [Rendering an Attachment in RTF Text](rendering-an-attachment-in-rtf-text.md).</span></span>
    
7. <span data-ttu-id="ff9b1-140">При необходимости откройте вложение.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-140">Open an attachment if desired.</span></span> <span data-ttu-id="ff9b1-141">Дополнительные сведения см. [в разделе Открытие вложения](opening-an-attachment.md).</span><span class="sxs-lookup"><span data-stu-id="ff9b1-141">For more information see [Opening an Attachment](opening-an-attachment.md).</span></span>
    
## <a name="in-this-section"></a><span data-ttu-id="ff9b1-142">В этом разделе</span><span class="sxs-lookup"><span data-stu-id="ff9b1-142">In this section</span></span>

- <span data-ttu-id="ff9b1-143">[Открытие текста сообщения](opening-message-text.md): инструкции по открытию текста сообщения.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-143">[Opening Message Text](opening-message-text.md): Describes how to open the message text.</span></span>
    
- <span data-ttu-id="ff9b1-144">[Отображение вложения в виде обычного текста](rendering-an-attachment-in-plain-text.md): в этой статье описывается, как отобразить вложение в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-144">[Rendering an Attachment in Plain Text](rendering-an-attachment-in-plain-text.md): Describes how to render an attachment in plain text.</span></span>
    
- <span data-ttu-id="ff9b1-145">[Отображение вложения в тексте в формате RTF](rendering-an-attachment-in-rtf-text.md): в этой статье описывается, как отобразить вложение в форматированном тексте.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-145">[Rendering an Attachment in RTF Text](rendering-an-attachment-in-rtf-text.md): Describes how to render an attachment in formatted text.</span></span>
    
- <span data-ttu-id="ff9b1-146">[Открытие вложения](opening-an-attachment.md): в этой статье описывается, как открыть вложение.</span><span class="sxs-lookup"><span data-stu-id="ff9b1-146">[Opening an Attachment](opening-an-attachment.md): Describes how to open an attachment.</span></span>
    

