---
title: Обработка входящего сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d45d5ed9-41cd-4aaf-91d2-1e4a27bb16d4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: f3fbe34793e3520b26b984f4bd6b14fbcab7a951
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438983"
---
# <a name="handling-an-incoming-message"></a>Обработка входящего сообщения

**Относится к**: Outlook 2013 | Outlook 2016 
  
Входящее сообщение — это сообщение, которое было отправлено в одну или несколько систем обмена сообщениями. Оно может быть отправлено только вам или нескольким другим получателям. Входящие сообщения помещаются в папку получения, предназначенную для хранения сообщений определенного класса. Вы можете настроить другую папку получения для каждого класса сообщений, который обрабатывает или использует одну папку для всех классов.
  
Если вы зарегистрировались для получения уведомлений о новых почтовых сообщениях с хранилищем сообщений, вы получите уведомление, когда сообщение помещается в папку получения. Если вы не зарегистрировались для получения новых почтовых уведомлений, необходимо периодически открывать соответствующую папку получения, чтобы вручную проверить поступление новых сообщений.
  
Клиенты регистрируют уведомления о новых почтовых сообщениях, устанавливая параметры в [IMsgStore:: Advise](imsgstore-advise.md) следующим образом: 
  
- Задайте для параметра _кбентрид_ значение 0. 
    
- Присвойте параметру _лпентрид_ значение null. 
    
- Задайте для параметра _улевентмаск_ значение фневневмаил. 
    
Параметр _лпнотификатионс_ в вызове метода **имапиадвисесинк:: OnNotify** указывает на структуру **уведомлений NEWMAIL\_** , которая содержит сведения о входящем сообщении, такие как класс Message, его идентификатор записи, идентификатор записи родительской папки и содержимое его свойства **PR_MESSAGE_FLAGS** . Дополнительные сведения о регистрации и обработке уведомлений можно найти в статье [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md), [NEWMAIL_NOTIFICATION](newmail_notification.md), **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) и [обработки уведомлений](handling-notifications.md). 
  
Перед отображением входящего сообщения для пользователя определите, является ли его класс сообщений классом, поддерживаемым клиентом. Если нет, проигнорируйте сообщение. Если вы поддерживаете этот класс, вы можете открыть и отобразить сообщение в форме, которая соответствует классу сообщения сообщения. Выбор форм зависит от класса Message. Сообщения, принадлежащие классу IPM, используют стандартную форму, реализуемую MAPI. Сообщения, принадлежащие пользовательским классам, которые определяются клиентами, могут использовать как пользовательские формы, так и формы MAPI по умолчанию.
  
## <a name="open-and-display-an-incoming-message"></a>Открытие и отображение входящего сообщения
  
1. Call **IMsgStore:: жетрецеивефолдер** для получения идентификатора записи папки получения для класса сообщений и передайте этот идентификатор записи в **IMsgStore:: OpenEntry** , чтобы открыть папку. Дополнительные сведения см. в статье [IMsgStore:: жетрецеивефолдер](imsgstore-getreceivefolder.md), [IMsgStore:: OpenEntry](imsgstore-openentry.md)и [Открытие папки хранилища сообщений](opening-a-message-store-folder.md).
    
2. Вызовите метод **IMAPIContainer:: жетконтентстабле** папки получения для получения его таблицы содержимого. Дополнительные сведения см. в статье [IMAPIContainer:: жетконтентстабле](imapicontainer-getcontentstable.md). Вызовите метод **IMAPITable:: QueryRows** для получения всех строк в таблице. Дополнительные сведения см. в статье [IMAPITable:: QueryRows](imapitable-queryrows.md) and [Content Tables](contents-tables.md). Дополнительные сведения о отображении таблицы содержимого приведены в статье [Отображение таблицы содержимого папки](displaying-a-folder-contents-table.md).
    
3. Если ваш клиент является интерактивным, разрешить пользователю выбирать сообщение из таблицы и определять форму, которая будет использоваться для отображения этого сообщения. Клиенты могут использовать форму по умолчанию, предоставляемую MAPI или настраиваемую форму. Более подробную информацию можно найти в статье [Обработка форм MAPI](handling-mapi-forms.md).
    
4. Call **IMsgStore:: OpenEntry** , чтобы открыть сообщение. Дополнительную информацию можно узнать в статье [Открытие сообщения](opening-a-message.md).
    
5. Обработка текста сообщения. Дополнительные сведения можно найти в разделе [Открытие текста сообщения](opening-message-text.md).
    
6. Отображение всех вложений в сообщениях. Дополнительную информацию можно узнать [в статье отображение вложения в виде обычного текста](rendering-an-attachment-in-plain-text.md) или [Отображение вложения в тексте в формате RTF](rendering-an-attachment-in-rtf-text.md).
    
7. При необходимости откройте вложение. Дополнительные сведения см. [в разделе Открытие вложения](opening-an-attachment.md).
    
## <a name="in-this-section"></a>В этом разделе

- [Открытие текста сообщения](opening-message-text.md): инструкции по открытию текста сообщения.
    
- [Отображение вложения в виде обычного текста](rendering-an-attachment-in-plain-text.md): в этой статье описывается, как отобразить вложение в виде обычного текста.
    
- [Отображение вложения в тексте в формате RTF](rendering-an-attachment-in-rtf-text.md): в этой статье описывается, как отобразить вложение в форматированном тексте.
    
- [Открытие вложения](opening-an-attachment.md): в этой статье описывается, как открыть вложение.
    

