---
title: Обработка входящего сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d45d5ed9-41cd-4aaf-91d2-1e4a27bb16d4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: f3fbe34793e3520b26b984f4bd6b14fbcab7a951
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438983"
---
# <a name="handling-an-incoming-message"></a>Обработка входящего сообщения

**Относится к**: Outlook 2013 | Outlook 2016 
  
Входящие сообщения — это сообщения, отправленные в одну или несколько систем обмена сообщениями. Возможно, он был отправлен только вам или многим другим получателям. Входящие сообщения помещаются в папку получения, предназначенную для удержания сообщений определенного класса. Вы можете настроить разные папки получения для каждого класса сообщений, который обрабатывается, или использовать одну папку для всех классов.
  
Если вы зарегистрировались для получения новых уведомлений в хранилище сообщений, вы будете получать уведомления при размещении сообщения в папке получения. Если вы еще не зарегистрировались для получения новых уведомлений, необходимо периодически открывать соответствующую папку получения, чтобы вручную проверить получение новых сообщений.
  
Клиенты регистрируются для новых уведомлений электронной почты, устанавливая для параметров [IMsgStore::Advise](imsgstore-advise.md) следующим образом: 
  
- Установите  _для cbEntryID_ 0. 
    
- Установите  _для lpEntryID_ nULL. 
    
- Установите  _для ulEventMask_ fnevNewMail. 
    
Параметр _lpNotifications_ в вызове метода **IMAPIAdviseSink::OnNotify** указывает на структуру **УВЕДОМЛЕНий NEWMAIL, \_** содержащую сведения о входящих сообщениях, таких как класс сообщения, идентификатор записи, идентификатор записи родительской папки и содержимое **его свойства PR_MESSAGE_FLAGS.** Дополнительные сведения о регистрации и обработке уведомлений см. в подразделах [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md), [NEWMAIL_NOTIFICATION,](newmail_notification.md) **PR_MESSAGE_FLAGS** ([PidTagMessageFlags)](pidtagmessageflags-canonical-property.md)и [Handling Notifications](handling-notifications.md). 
  
Перед отображением входящих сообщений для пользователя определите, является ли его класс сообщения классом, поддерживаемым вашим клиентом. Если нет, игнорируйте сообщение. Если вы поддерживаете класс, вы можете открыть и отобразить сообщение в форме, соответствующей классу сообщения. Выбор форм основан на классе сообщений. Сообщения, принадлежащие классу IPM, используют форму по умолчанию, реализованную в MAPI. Сообщения, принадлежащие настраиваемому классу, определяемому клиентами, могут использовать клиентские специализированные формы или форму по умолчанию MAPI.
  
## <a name="open-and-display-an-incoming-message"></a>Открытие и отображение входящих сообщений
  
1. Вызовите **IMsgStore::GetReceiveFolder,** чтобы получить идентификатор записи папки получения для класса сообщения и передать этот идентификатор записи **в IMsgStore::OpenEntry,** чтобы открыть папку. Дополнительные сведения см. в [iMsgStore::GetReceiveFolder,](imsgstore-getreceivefolder.md) [IMsgStore::OpenEntry](imsgstore-openentry.md)и открытии папки [магазина сообщений.](opening-a-message-store-folder.md)
    
2. Вызовите метод **IMAPIContainer::GetContentsTable** папки получения, чтобы получить ее таблицу содержимого. Дополнительные сведения см. в подразделе [IMAPIContainer::GetContentsTable.](imapicontainer-getcontentstable.md) Вызовите метод **IMAPITable::QueryRows** таблицы, чтобы получить все строки в таблице. Дополнительные сведения см. в таблице [IMAPITable::QueryRows](imapitable-queryrows.md) и [Contents Tables.](contents-tables.md) Дополнительные сведения о отображение таблицы содержимого см. в таблице "Отображение [таблицы содержимого папки".](displaying-a-folder-contents-table.md)
    
3. Если клиент интерактивный, разрешите пользователю выбрать сообщение из таблицы и определить форму, которая будет использоваться для отображения этого сообщения. Клиенты могут использовать форму по умолчанию, предоставляемую MAPI или настраиваемой формой. Дополнительные сведения см. в [поддоме "Обработка форм MAPI".](handling-mapi-forms.md)
    
4. Вызовите **IMsgStore::OpenEntry,** чтобы открыть сообщение. Дополнительные сведения см. [в открываемом сообщении.](opening-a-message.md)
    
5. Обработка текста сообщения. Дополнительные сведения см. в [документе "Открытие текста сообщения".](opening-message-text.md)
    
6. Отрисовка каждого вложения сообщения. Дополнительные сведения см. в документе ["Отрисовка](rendering-an-attachment-in-plain-text.md) вложения в обычном тексте" или "Отрисовка вложения [в тексте RTF".](rendering-an-attachment-in-rtf-text.md)
    
7. При желании откройте вложение. Дополнительные сведения [см. в открываемом вложении.](opening-an-attachment.md)
    
## <a name="in-this-section"></a>В этом разделе:

- [Opening Message Text](opening-message-text.md): Describes how to open the message text.
    
- [Отрисовка вложения в обычном тексте](rendering-an-attachment-in-plain-text.md): описывает, как отрисовка вложения в виде обычного текста.
    
- [Отрисовка вложения в тексте RTF](rendering-an-attachment-in-rtf-text.md): описывается, как отрисовка вложения в форматированный текст.
    
- [Открытие вложения](opening-an-attachment.md): описывает, как открыть вложение.
    

