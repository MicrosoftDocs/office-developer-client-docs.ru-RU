---
title: Обработка входящего сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d45d5ed9-41cd-4aaf-91d2-1e4a27bb16d4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: f3fbe34793e3520b26b984f4bd6b14fbcab7a951
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438983"
---
# <a name="handling-an-incoming-message"></a>Обработка входящего сообщения

**Область применения**: Outlook 2013 | Outlook 2016 
  
Входящие сообщения — это сообщение, отправленное через одну или несколько систем обмена сообщениями. Возможно, он был отправлен только вам или многим другим получателям. Входящие сообщения размещаются в папке приемки, предназначенной для удержания сообщений определенного класса. Вы можете настроить другую папку получения для каждого класса сообщений, которые обрабатываются или используют одну папку для всех классов.
  
Если вы зарегистрировались для новых уведомлений почты в хранилище сообщений, вы будете уведомлены при размещении сообщения в папке получения. Если вы не зарегистрировались для получения новых уведомлений, необходимо периодически открывать соответствующую папку получения, чтобы вручную проверить поступление новых сообщений.
  
Клиенты регистрируются для новых уведомлений почты, заявив параметры [в IMsgStore::Advise](imsgstore-advise.md) следующим образом: 
  
- Установите  _cbEntryID_ до 0. 
    
- Установите  _lpEntryID в_ NULL. 
    
- Установите  _ulEventMask в_ fnevNewMail. 
    
Параметр  _lpNotifications_ в вызове к методу **IMAPIAdviseSink::OnNotify** указывает на структуру **УВЕДОМЛЕНий NEWMAIL, \_** содержащую сведения о входящих сообщениях, таких как **класс сообщения, его** идентификатор записи, идентификатор записи родительской папки и содержимое его PR_MESSAGE_FLAGS свойства. Дополнительные сведения о регистрации и обработке уведомлений см. в странице [IMAPIAdviseSink::OnNotify,](imapiadvisesink-onnotify.md) [NEWMAIL_NOTIFICATION,](newmail_notification.md) **PR_MESSAGE_FLAGS** [(PidTagMessageFlags)](pidtagmessageflags-canonical-property.md)и [Handling Notifications](handling-notifications.md). 
  
Перед отображением входящих сообщений пользователю определите, является ли класс сообщения классом, поддерживаемым клиентом. Если нет, игнорируйте сообщение. Если класс поддерживается, вы можете открыть и отобразить сообщение в форме, соответствующей классу сообщений. Выбор форм основан на классе сообщений. Сообщения, принадлежащие классу IPM, используют форму по умолчанию, реализованную MAPI. Сообщения, которые относятся к настраиваемому классу, определенному клиентами, могут использовать либо клиентские специализированные формы, либо форму по умолчанию MAPI.
  
## <a name="open-and-display-an-incoming-message"></a>Откройте и отобразить входящие сообщения
  
1. Позвоните **в IMsgStore::GetReceiveFolder,** чтобы получить идентификатор записи папки получения для класса сообщений сообщения и передать этот идентификатор записи **в IMsgStore::OpenEntry,** чтобы открыть папку. Дополнительные сведения см. в [книгах IMsgStore::GetReceiveFolder,](imsgstore-getreceivefolder.md) [IMsgStore::OpenEntry](imsgstore-openentry.md)и [Opening a Message Store Folder](opening-a-message-store-folder.md).
    
2. Для получения таблицы содержимого вызываем метод **IMAPIContainer::GetContentsTable.** Дополнительные сведения см. [в iMAPIContainer::GetContentsTable](imapicontainer-getcontentstable.md). Чтобы получить все строки в таблице, позвоните по методу **IMAPITable::QueryRows.** Дополнительные сведения см. [в таблице IMAPITable::QueryRows](imapitable-queryrows.md) и [Contents Tables.](contents-tables.md) Дополнительные сведения о показе таблицы содержимого см. в таблице Отображения таблицы содержимого [папок.](displaying-a-folder-contents-table.md)
    
3. Если клиент интерактивный, разрешить пользователю выбрать сообщение из таблицы и определить форму, которая будет использоваться для отображения этого сообщения. Клиенты могут использовать форму по умолчанию, предоставленную MAPI или настраиваемую форму. Дополнительные сведения см. в [переработчике форм MAPI.](handling-mapi-forms.md)
    
4. Чтобы открыть сообщение, позвоните **в IMsgStore::OpenEntry.** Дополнительные сведения см. в [тексте Открытие сообщения.](opening-a-message.md)
    
5. Обработка текста сообщения. Дополнительные сведения см. в [тексте открытия сообщения.](opening-message-text.md)
    
6. Отрисовка каждого из вложений сообщений. Дополнительные сведения см. в документе [Rendering an Attachment in Plain Text](rendering-an-attachment-in-plain-text.md) или [Rendering an Attachment in RTF Text.](rendering-an-attachment-in-rtf-text.md)
    
7. Откройте вложение при желании. Дополнительные сведения см. [в статью Открытие вложения.](opening-an-attachment.md)
    
## <a name="in-this-section"></a>В этом разделе

- [Открытие текста сообщения.](opening-message-text.md)Описывается, как открыть текст сообщения.
    
- [Отрисовка вложения в простом тексте:](rendering-an-attachment-in-plain-text.md)описывает, как отрисовка вложения в обычном тексте.
    
- [Визуализация вложения в тексте RTF:](rendering-an-attachment-in-rtf-text.md)описывает, как отрисовка вложения в форматированный текст.
    
- [Открытие вложения.](opening-an-attachment.md)Описывает, как открыть вложение.
    

