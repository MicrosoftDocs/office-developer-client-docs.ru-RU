---
title: IMsgStoreAdvise
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMsgStore.Advise
api_type:
- COM
ms.assetid: 8c57e743-a798-4e39-a61a-46dff8b1ac7c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 3b4abef731541e308b2c2ebc6f4aaddf4458e257
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32317327"
---
# <a name="imsgstoreadvise"></a>IMsgStore::Advise

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Регистрируется для получения уведомлений об указанных событиях, влияющих на хранилище сообщений.
  
```cpp
HRESULT Advise(
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulEventMask,
  LPMAPIADVISESINK lpAdviseSink,
  ULONG_PTR lpulConnection
);
```

## <a name="parameters"></a>Параметры

 _cbEntryID_
  
> [in] Количество byte в идентификаторе записи, на который указывает параметр _lpEntryID._ 
    
 _lpEntryID_
  
> [in] Указатель на идентификатор записи папки или сообщения о том, какие уведомления должны быть созданы, или **null.** Если _для lpEntryID_ задано NULL,  советуем регистрировать уведомления во всем хранилище сообщений. 
    
 _ulEventMask_
  
> [in] Маска значений, которые указывают типы событий уведомлений, которые интересуют вызываемого и должны быть включены в регистрацию. Существует соответствующая структура [УВЕДОМЛЕНий,](notification.md) связанная с каждым типом события, который содержит сведения о событии. Допустимые значения параметра _ulEventMask:_ 
    
 _fnevCriticalError_
  
> Регистрирует уведомления о серьезных ошибках, например нехватке памяти.
    
 _fnevExtended_
  
> Регистрируется для уведомлений о событиях, характерных для конкретного поставщика store сообщений.
    
 _fnevNewMail_
  
> Регистрируется для уведомлений о поступлении новых сообщений. 
    
 _fnevObjectCreated_
  
> Регистрируется для уведомлений о создании новой папки или сообщения.
    
 _fnevObjectCopied_
  
> Регистрируется для уведомлений о папке или скопировании сообщения.
    
 _fnevObjectDeleted_
  
> Регистрируется для уведомлений об удаляемой папке или сообщении.
    
 _fnevObjectModified_
  
> Регистрирует уведомления о папке или изменяемом сообщении.
    
 _fnevObjectMoved_
  
> Регистрирует уведомления о перемещаемой папке или сообщении.
    
 _fnevSearchComplete_
  
> Регистрируется для уведомлений о завершении операции поиска.
    
 _lpAdviseSink_
  
> [in] Указатель на объект приемника рекомендации для получения последующих уведомлений. Этот рекомендуемый объект-тоник должен быть уже выделен.
    
 _lpulConnection_
  
> [out] Указатель на ненумерный номер, представляющий соединение между объектом-томером консультации вызываемого вызываемого объекта и сеансом. 
    
 _lpAdviseSink_
  
> [in] Указатель на объект приемника рекомендации для получения последующих уведомлений. Этот рекомендуемый объект-тоник должен быть уже выделен. 
    
 _lpulConnection_
  
> [out] Указатель на ненумеровый номер подключения, представляющий соединение между объектом-сигнальным сигналом вызываемого вызываемого объекта и хранилищем сообщений.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Регистрация прошла успешно.
    
MAPI_E_NO_SUPPORT 
  
> Поставщик store сообщений не поддерживает регистрацию уведомлений через хранилище сообщений.
    
## <a name="remarks"></a>Примечания

Метод **IMsgStore::Advise** устанавливает связь между объектом приемника консультации вызываемого объекта и хранилищем сообщений или объектом в хранилище сообщений. Это подключение используется для отправки уведомлений в оконсультантный точек, когда одно или несколько событий, как указано в параметре  _ulEventMask,_ происходят с объектом источника консультации. Если параметр  _lpEntryID_ указывает на допустимый идентификатор записи, источником рекомендации является объект, определяемой этим идентификатором записи. Если  _lpEntryID_ имеет NULL, источником рекомендации является хранилище сообщений. 
  
Чтобы отправить уведомление, поставщик store сообщений или MAPI вызывает метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) зарегистрированного приемника уведомлений. Один из параметров **OnNotify**, структура уведомлений, содержит сведения, описывая конкретное событие.
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Вы можете поддерживать уведомления с помощью MAPI или без нее. MAPI имеет три метода объекта поддержки для помощи поставщикам услуг в реализации уведомлений: [IMAPISupport::Subscribe,](imapisupport-subscribe.md) [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)и [IMAPISupport::Notify](imapisupport-notify.md). Если вы выбрали использование методов поддержки  MAPI, вызовите subscribe при вызове метода **Advise** и отпустите указатель _lpAdviseSink._ 
  
Если вы самостоятельно выбрали поддержку уведомления, вызовите метод [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) приемника консультации, представленного параметром  _lpAdviseSink,_ чтобы сохранить копию этого указателя. Сохраните эту копию, пока не будет вызван метод [IMsgStore::Unadvise](imsgstore-unadvise.md) для отмены регистрации. 
  
Независимо от того, как вы поддерживаете уведомление, назначьте ненулевой номер подключения регистрации уведомлений и _вернетесь в параметре lpulConnection._ Не отпустите этот номер подключения, пока не будет вызвана и завершена **unadvise.** 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

В системах, поддерживаюх несколько потоков выполнения, вызов **OnNotify** также может происходить в любом потоке в любое время. Если вы должны быть уверены в том, что уведомления появляются только в определенное время в определенном потоке, вызовите функцию [HrThisThreadAdviseSink,](hrthisthreadadvisesink.md) чтобы создать объект-замещение, передав его в "Совет". 
  
После успешного  вызова "Консультация" и перед вызовом **Unadvise** для отмены регистрации подготовьсь к тому, что объект-токонвейдер консультации будет отпущен. После возврата "Advise"  (Сообщить) вам следует освободить объект-конвессник, если для него не используется определенная долгосрочная версия. 
  
Дополнительные сведения о процессе уведомления см. в [уведомлении о событии в MAPI.](event-notification-in-mapi.md) 
  
Дополнительные сведения об обработке уведомлений см. в [этой теме.](handling-notifications.md) 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|BaseDialog.cpp  <br/> |CBaseDialog::OnNotificationsOn  <br/> |MFCMAPI использует метод **IMsgStore::Advise** для регистрации уведомлений во всем хранилище сообщений.  <br/> |
   
## <a name="see-also"></a>См. также



[HrThisThreadAdviseSink](hrthisthreadadvisesink.md)
  
[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)
  
[IMsgStore::Unadvise](imsgstore-unadvise.md)
  
[�����������](notification.md)
  
[IMsgStore: IMAPIProp](imsgstoreimapiprop.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

