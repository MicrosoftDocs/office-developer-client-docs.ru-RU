---
title: Имсгстореадвисе
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMsgStore.Advise
api_type:
- COM
ms.assetid: 8c57e743-a798-4e39-a61a-46dff8b1ac7c
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 3b4abef731541e308b2c2ebc6f4aaddf4458e257
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32317327"
---
# <a name="imsgstoreadvise"></a>IMsgStore::Advise

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Регистрируется для получения уведомлений об указанных событиях, влияющих на хранилище сообщений.
  
```cpp
HRESULT Advise(
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulEventMask,
  LPMAPIADVISESINK lpAdviseSink,
  ULONG_PTR lpulConnection
);
```

## <a name="parameters"></a>Параметры

 _Кбентрид_
  
> возврата Число байтов в идентификаторе записи, на которое указывает параметр _лпентрид_ . 
    
 _Лпентрид_
  
> возврата Указатель на идентификатор записи папки или сообщения о том, какие уведомления должны создаваться, или **значение NULL**. Если для _лпентрид_ ЗАДАНО значение null, регистры **рекомендаций** для уведомлений для всего хранилища сообщений. 
    
 _Улевентмаск_
  
> возврата Маска значений, указывающая типы событий уведомлений, в которых заинтересован вызывающий абонент, которые необходимо включить в регистрацию. Существует соответствующая структура [уведомлений](notification.md) , связанная с каждым типом события, в котором хранятся сведения о событии. Ниже приведены допустимые значения параметра _улевентмаск_ . 
    
 _Фневкритикалеррор_
  
> Регистрирует уведомления о серьезных ошибках, таких как недостаток памяти.
    
 _Фневекстендед_
  
> Регистрирует уведомления о событиях, относящихся к определенному поставщику хранилища сообщений.
    
 _Фневневмаил_
  
> Регистрирует уведомления о поступлении новых сообщений. 
    
 _Фневобжекткреатед_
  
> Регистрирует уведомления о создании новой папки или сообщения.
    
 _Фневобжекткопиед_
  
> Регистрирует уведомления о копируемых папках или сообщениях.
    
 _Фневобжектделетед_
  
> Регистрирует уведомления об удалении папки или сообщения.
    
 _Фневобжектмодифиед_
  
> Регистрирует уведомления об изменении папки или сообщения.
    
 _Фневобжектмовед_
  
> Регистрирует уведомления о перемещении папки или сообщения.
    
 _Фневсеарчкомплете_
  
> Регистрирует уведомления о завершении операции поиска.
    
 _Лпадвисесинк_
  
> возврата Указатель на объект приемника уведомлений для получения последующих уведомлений. Этот объект приемника уведомлений должен быть уже выделен.
    
 _Лпулконнектион_
  
> вышли Указатель на ненулевое число, которое представляет соединение между объектом приемника уведомлений вызывающего абонента и сеансом. 
    
 _Лпадвисесинк_
  
> возврата Указатель на объект приемника уведомлений для получения последующих уведомлений. Этот объект приемника уведомлений должен быть уже выделен. 
    
 _Лпулконнектион_
  
> вышли Указатель на ненулевый номер подключения, представляющий соединение между объектом приемника уведомлений вызывающего абонента и хранилищем сообщений.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Регистрация выполнена успешно.
    
МАПИ_Е_НО_СУППОРТ 
  
> Поставщик хранилища сообщений не поддерживает регистрацию для уведомления в хранилище сообщений.
    
## <a name="remarks"></a>Замечания

Метод **IMsgStore:: Advise** устанавливает соединение между объектом приемника уведомлений вызывающего абонента и либо хранилищем сообщений, либо объектом в хранилище сообщений. Это подключение используется для отправки уведомлений в приемник уведомлений, когда одно или несколько событий, указанных в параметре _улевентмаск_ , происходят с исходным объектом Advise. Если параметр _лпентрид_ указывает на допустимый идентификатор записи, источником рекомендаций является объект, идентифицируемый этим идентификатором записи. Если _лпентрид_ имеет значение null, то источником уведомления является хранилище сообщений. 
  
Чтобы отправить уведомление, поставщик хранилища сообщений или MAPI вызывает зарегистрированный метод [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md) приемника уведомлений. Один из параметров для параметра **OnNotify**, структура уведомления содержит сведения, описывающие конкретное событие.
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Вы можете поддерживать уведомления с помощью интерфейса MAPI или без него. В MAPI есть три метода поддержки объектов для оказания помощи поставщикам услуг по внедрению уведомлений: [имаписуппорт:: Subscribe](imapisupport-subscribe.md), [имаписуппорт:: unsubscribe](imapisupport-unsubscribe.md)и [имаписуппорт:: notify](imapisupport-notify.md). Если вы намерены использовать методы поддержки MAPI, вызовите **подписку** при вызове метода **advise** и освободите указатель _лпадвисесинк_ . 
  
Если вы хотите самостоятельно поддерживать уведомления, вызовите метод [IUnknown:: AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) приемника уведомлений, представленный параметром _лпадвисесинк_ , чтобы сохранить копию этого указателя. Сохраняйте эту копию до тех пор, пока не будет вызван метод [IMsgStore:: unadvise](imsgstore-unadvise.md) для отмены регистрации. 
  
Независимо от того, как вы можете поддерживать уведомления, назначьте ненулевой номер подключения для регистрации уведомлений и верните его в параметр _лпулконнектион_ . Не освобождайте этот номер подключения, пока не будет вызвано и завершено действие **unadvise** . 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

В системах, поддерживающих несколько потоков выполнения, вызов onNotify **** также может выполняться в любом потоке в любое время. Если необходимо гарантировать, что уведомления происходят только в определенный момент в определенном потоке, вызовите функцию [хрсиссреададвисесинк](hrthisthreadadvisesink.md) , чтобы создать объект приемника уведомлений, который вы передаете в предложение **advise**. 
  
После успешного выполнения вызова **advise** и вызова метода unadvise **** для отмены регистрации необходимо подготовить объект приемника уведомлений. Вы должны освободить объект приемника уведомлений после **** возврата, если для него не задано конкретное долгосрочное использование. 
  
Дополнительные сведения о процессе уведомления можно найти в статье [уведомление о событии в MAPI](event-notification-in-mapi.md). 
  
Более подробную информацию об обработке уведомлений можно узнать в статье [обработка уведомлений](handling-notifications.md). 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Баседиалог. cpp  <br/> |Кбаседиалог:: Оннотификатионсон  <br/> |MFCMAPI использует метод **IMsgStore:: Advise** для регистрации уведомлений во всем хранилище сообщений.  <br/> |
   
## <a name="see-also"></a>См. также



[HrThisThreadAdviseSink](hrthisthreadadvisesink.md)
  
[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)
  
[IMsgStore::Unadvise](imsgstore-unadvise.md)
  
[�����������](notification.md)
  
[IMsgStore: IMAPIProp](imsgstoreimapiprop.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

