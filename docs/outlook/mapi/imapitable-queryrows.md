---
title: имапитаблекуерировс
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPITable.QueryRows
api_type:
- COM
ms.assetid: f26384f1-467e-4343-92b3-0425da9d2123
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 26d6ffe66a5e7749c9d8c4e5210e9f72de808932
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416295"
---
# <a name="imapitablequeryrows"></a>IMAPITable::QueryRows

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Возвращает одну или несколько строк из таблицы, начиная с текущего положения курсора.
  
```cpp
HRESULT QueryRows(
LONG lRowCount,
ULONG ulFlags,
LPSRowSet FAR * lppRows
);
```

## <a name="parameters"></a>Параметры

 _лровкаунт_
  
> возврата Максимальное количество возвращаемых строк.
    
 _ulFlags_
  
> возврата Битовая маска флагов, которые управляют способом возвращения строк. Можно задать следующий флаг:
    
TBL_NOADVANCE 
  
> Запрещает прием курсора в результате извлечения строки. Если установлен флаг TBL_NOADVANCE, курсор указывает на первую возвращаемую строку. Если флаг TBL_NOADVANCE не установлен, курсор указывает на строку, следующую за последней возвращенной строкой.
    
 _лппровс_
  
> вышли Указатель на указатель на структуру [SRowSet](srowset.md) , содержащую строки таблицы. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Строки успешно возвращены.
    
MAPI_E_BUSY 
  
> Выполняется другая операция, которая не позволяет запустить операцию извлечения строк. Выполнение выполняемой операции должно быть разрешено или остановлено.
    
MAPI_E_INVALID_PARAMETER 
  
> Для параметра _ировкаунт_ задано значение 0. 
    
## <a name="remarks"></a>Примечания

Метод **IMAPITable:: QueryRows** получает одну или несколько строк данных из таблицы. Значение параметра _ировкаунт_ влияет на отправную точку извлечения. Если _ировкаунт_ положительно, строки считываются в направлении вперед, начиная с текущей позиции. Если _ировкаунт_ имеет отрицательное значение, **QueryRows** сбрасывает начальную точку, перемещая на задний план указанное число строк. После сброса курсора строки считываются в порядке "вперед". 
  
Элемент **CRowset** в структуре [SRowSet](srowset.md) , на которую указывает параметр _лппровс_ , указывает количество возвращаемых строк. Если возвращаются нулевые строки: 
  
- Курсор уже размещается в начале таблицы, а значение _ировкаунт_ — отрицательное. Также 
    
- Курсор уже размещается в конце таблицы, а значение _ировкаунт_ — положительное. 
    
Количество столбцов и их порядок одинаково для каждой строки. Если для строки не существует свойства или возникла ошибка при чтении свойства, структура **спропвалуе** для свойства в строке содержит следующие значения: 
  
- PT_ERROR для типа свойства в элементе **улпроптаг** . 
    
- MAPI_E_NOT_FOUND для элемента **value** . 
    
Объем памяти, используемый для структур [спропвалуе](spropvalue.md) в наборе строк, на который указывает параметр _лппровс_ , должен быть отдельно выделен и освобожден для каждой строки. Используйте [мапифрибуффер](mapifreebuffer.md) , чтобы освободить структуры значений свойств и освободить набор строк. Если при вызове **QueryRows** возвращается ноль, что указывает на начало или конец таблицы, необходимо освободить только саму структуру **SRowSet** . Дополнительные сведения о выделении и освобождении памяти в структуре **SRowSet** можно найти в статье [Управление памятью для структур ADRLIST и SRowSet](managing-memory-for-adrlist-and-srowset-structures.md).
  
Возвращаемые строки и порядок их возвращения зависит от того, были ли выполнены успешные вызовы [IMAPITable:: restrict](imapitable-restrict.md) и [IMAPITable:: сорттабле](imapitable-sorttable.md). **Ограничивает** фильтры строк в представлении, в результате чего **QueryRows** возвращает только те строки, которые совпадают с условиями, указанными в ограничении. **Сорттабле** устанавливает стандартный или упорядоченный порядок сортировки, влияя на последовательность строк, возвращаемых **QueryRows**. Возвращаемые строки находятся в порядке, указанном в структуре [ссортордерсет](ssortorderset.md) , переданной в **сорттабле**.
  
Столбцы, возвращаемые для каждой строки, и порядок их возвращения зависит от того, был ли выполнен вызов [IMAPITable:: метода SetColumns](imapitable-setcolumns.md). **Метода SetColumns** устанавливает набор столбцов, указывая свойства, включаемые в столбцы таблицы, и порядок, в котором они должны быть включены. Если был выполнен вызов **метода SetColumns** , то определенные столбцы в каждой строке и порядок этих столбцов соответствуют набору столбцов, указанному в вызове. Если вызов **метода SetColumns** не выполнен, таблица возвращает набор столбцов по умолчанию. 
  
Если ни один из этих вызовов не был выполнен, **QueryRows** возвращает все строки в таблице. Каждая строка содержит набор столбцов по умолчанию в порядке по умолчанию. 
  
Когда набор столбцов, установленный при вызове [IMAPITable:: метода SetColumns](imapitable-setcolumns.md) , включает столбцы, для которых задано значение PR_NULL, массив [спропвалуе](spropvalue.md) в наборе строк, возвращаемом в _лппровс_ , будет содержать пустые слоты. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Вы можете разрешить абоненту запросить неподдерживаемый столбец, чтобы включить его в набор столбцов. В этом случае разместите PT_ERROR в части типа свойства тега свойства и MAPI_E_NOT_FOUND в значении свойства для неподдерживаемого столбца. 
  
Считать количество строк запросом, а не требованием. Вы можете возвратить в любом месте из нулевых строк, если в направлении запроса нет строк, к запрошенному числу. 
  
Возвращать только те строки, которые пользователь увидит при запросе строк из представления таблицы с классификацией, что позволяет вызывающему абоненту сделать допустимые предположения относительно области данных и избежать дополнительной работы. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Как правило, вы можете использовать столько строк, сколько указано в параметре _лровкаунт_ . Тем не менее, если превышаются возможности памяти или реализации или если операция достигает начала или конца таблицы, **QueryRows** возвращает не более чем запрошенных строк. 
  
Если **QueryRows** возвращает MAPI_E_BUSY, вызовите метод [IMAPITable:: ваитфоркомплетион](imapitable-waitforcompletion.md) и повторите вызов **QueryRows** после завершения асинхронной операции. 
  
При вызове **QueryRows**следует учитывать, что время асинхронных уведомлений может привести к тому, что набор строк, полученный из **QueryRows** , не будет точно представлять базовые данные. Например, вызов **QueryRows** к таблице содержимого папки после удаления сообщения, но перед получением соответствующего уведомления приведет к возврату удаленной строки в наборе строк. Всегда дождитесь поступления уведомления перед обновлением представления данных пользователя. 
  
Дополнительные сведения о получении строк из таблиц приведены в статье [Извлечение данных из строк таблицы](retrieving-data-from-table-rows.md).
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Контентстаблелистктрл. cpp  <br/> |двсреадфунклоадтабле  <br/> |MFCMAPI использует метод **IMAPITable:: QueryRows** для получения строк в таблице, которые необходимо загрузить в представление.  <br/> |
   
## <a name="see-also"></a>См. также



[ADRENTRY](adrentry.md)
  
[FreeProws](freeprows.md)
  
[HrQueryAllRows](hrqueryallrows.md)
  
[IMAPIProp::GetProps](imapiprop-getprops.md)
  
[IMAPITable::SetColumns](imapitable-setcolumns.md)
  
[IMAPITable::WaitForCompletion](imapitable-waitforcompletion.md)
  
[MAPIFreeBuffer](mapifreebuffer.md)
  
[SRow](srow.md)
  
[SRowSet](srowset.md)
  
[IMAPITable : IUnknown](imapitableiunknown.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

