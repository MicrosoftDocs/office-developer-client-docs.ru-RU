---
title: IMAPITableQueryRows
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPITable.QueryRows
api_type:
- COM
ms.assetid: f26384f1-467e-4343-92b3-0425da9d2123
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 26d6ffe66a5e7749c9d8c4e5210e9f72de808932
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416295"
---
# <a name="imapitablequeryrows"></a>IMAPITable::QueryRows

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Возвращает одну или несколько строк из таблицы, начиная с текущей позиции курсора.
  
```cpp
HRESULT QueryRows(
LONG lRowCount,
ULONG ulFlags,
LPSRowSet FAR * lppRows
);
```

## <a name="parameters"></a>Parameters

 _lRowCount_
  
> [in] Максимальное количество возвращаемых строк.
    
 _ulFlags_
  
> [in] Bitmask флагов, которые контролируют, как строки возвращаются. Можно установить следующий флаг:
    
TBL_NOADVANCE 
  
> Предотвращает продвижение курсора в результате повторного ирисовки строки. Если флаг TBL_NOADVANCE, курсор указывает на возвращенную первую строку. Если флаг TBL_NOADVANCE не установлен, курсор указывает на строку после возвращения последней строки.
    
 _lppRows_
  
> [вышел] Указатель на указатель на структуру [SRowSet](srowset.md) с строками таблицы. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Строки были успешно возвращены.
    
MAPI_E_BUSY 
  
> В настоящее время продолжается еще одна операция, которая не позволяет начать операцию по выимке строки. Либо операция должна быть разрешена к завершению, либо она должна быть остановлена.
    
MAPI_E_INVALID_PARAMETER 
  
> Параметр  _IRowCount_ задан до нуля. 
    
## <a name="remarks"></a>Примечания

Метод **IMAPITable::QueryRows** получает одну или несколько строк данных из таблицы. Значение параметра  _IRowCount_ влияет на отправную точку для ирисовки. Если  _IRowCount_ является положительным, строки читают в направлении вперед, начиная с текущей позиции. Если  _iRowCount_ является отрицательным, **QueryRows** сбрасывает отправную точку, перемещая назад указанные строки. После сброса курсора строки считываются в порядке вперед. 
  
Участник **cRows** в структуре [SRowSet,](srowset.md) на который указывает параметр  _lppRows,_ указывает количество возвращенных строк. Если возвращаются нулевые строки: 
  
- Курсор уже находится в начале таблицы, а значение  _IRowCount_ отрицательное. -Or- 
    
- Курсор уже находится в конце таблицы, и значение  _IRowCount_ положительное. 
    
Количество столбцов и их упорядочение одинаковы для каждой строки. Если свойство не существует для строки или существует ошибка чтения свойства, структура **SPropValue** для свойства в строке содержит следующие значения: 
  
- PT_ERROR для типа свойства в **члене ulPropTag.** 
    
- MAPI_E_NOT_FOUND для **участника Value.** 
    
Память, используемая для [структур SPropValue](spropvalue.md) в наборе строк, на которые указывает параметр  _lppRows,_ должна быть выделена отдельно и освобождена для каждой строки. Используйте [MAPIFreeBuffer,](mapifreebuffer.md) чтобы освободить структуры значений свойств и освободить набор строк. Однако когда вызов **в QueryRows** возвращает ноль с указанием начала или конца таблицы, необходимо освободить только сам **набор SRowSet.** Дополнительные сведения о выделении и бесплатной памяти в структуре **SRowSet** см. в статью Управление памятью [для структур ADRLIST и SRowSet.](managing-memory-for-adrlist-and-srowset-structures.md)
  
Возвращаемые строки и порядок их возврата зависят от того, были ли успешные вызовы сделаны в [IMAPITable:::Restrict](imapitable-restrict.md) и [IMAPITable::SortTable](imapitable-sorttable.md). **Ограничить** строки фильтров из представления, в результате чего **в QueryRows** возвращаются только строки, которые соответствуют критериям, указанным в ограничении. **SortTable** устанавливает стандартный или категоризируемый порядок сортировки, влияющий на последовательность строк, возвращаемых **QueryRows.** Возвращенные строки находятся в порядке, указанном в структуре [SSortOrderSet,](ssortorderset.md) переданном **в SortTable.**
  
Возвращаемые столбцы для каждой строки и порядок их возврата зависят от того, был ли выполнен успешный вызов [в IMAPITable::SetColumns.](imapitable-setcolumns.md) **SetColumns** устанавливает набор столбцов, указывая свойства, которые должны быть включены в столбцы в таблице, и порядок, в который они должны быть включены. Если вызов **SetColumns** выполнен, определенные столбцы в каждой строке и порядок этих столбцов совпадают с набором столбцов, указанным в вызове. Если вызов **SetColumns** не выполнен, в таблице возвращается набор столбцов по умолчанию. 
  
Если ни один из этих вызовов не был выполнен, **QueryRows** возвращает все строки в таблице. Каждая строка содержит столбец по умолчанию, установленный в порядке по умолчанию. 
  
Когда набор столбцов, установленный в вызове [IMAPITable::SetColumns,](imapitable-setcolumns.md) включает столбцы, задаваемые PR_NULL, массив [SPropValue](spropvalue.md) в наборе строк, возвращаемых в  _lppRows,_ будет содержать пустые слоты. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Вы можете разрешить звонячему запрашивать неподдермываемую колонку, которая будет включена в набор столбцов. В этом случае PT_ERROR в тип свойства тега свойства и MAPI_E_NOT_FOUND в значении свойства для неподтверченного столбца. 
  
Обрабатывайте количество строк как запрос, а не как требование. Вы можете вернуться из нулевых строк, если строк в направлении запроса нет, на запрашиваемую строку. 
  
Возвращайте только строки, которые пользователь увидит, когда строки запрашиваются из представления таблицы категории, что позволяет вызываемой стороне делать допустимые предположения о области данных и избегать дополнительных действий. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Обычно у вас будет столько строк, сколько указано в параметре _lRowCount._ Однако если ограничения памяти или реализации являются проблемой или когда операция преждевременно достигает начала или окончания таблицы, **в QueryRows** возвращается меньше строк, чем запрашивается. 
  
Если **QueryRows** возвращает MAPI_E_BUSY, позвоните по методу [IMAPITable::WaitForCompletion](imapitable-waitforcompletion.md) и выполните повторное вызов в **QueryRows** после завершения асинхронной операции. 
  
При **вызове QueryRows** следует помнить, что время асинхронных уведомлений может привести к тому, что набор строк, возвращающийся из **QueryRows,** не будет точно представлять эти данные. Например, вызов **в QueryRows** в таблицу содержимого папки после удаления сообщения, но до получения соответствующего уведомления приведет к тому, что удаленная строка будет возвращена в набор строк. Всегда ждите уведомления перед обновлением представления данных пользователем. 
  
Дополнительные сведения о сборе строк из таблиц см. в таблице "Сбор данных [из строк таблиц".](retrieving-data-from-table-rows.md)
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|ContentsTableListCtrl.cpp  <br/> |DwThreadFuncLoadTable  <br/> |MFCMAPI использует метод **IMAPITable::QueryRows** для получения строк в таблице для загрузки в представление.  <br/> |
   
## <a name="see-also"></a>См. также



[ADRENTRY](adrentry.md)
  
[FreeProws](freeprows.md)
  
[HrQueryAllRows](hrqueryallrows.md)
  
[IMAPIProp::GetProps](imapiprop-getprops.md)
  
[IMAPITable::SetColumns](imapitable-setcolumns.md)
  
[IMAPITable::WaitForCompletion](imapitable-waitforcompletion.md)
  
[MAPIFreeBuffer](mapifreebuffer.md)
  
[SRow](srow.md)
  
[SRowSet](srowset.md)
  
[IMAPITable : IUnknown](imapitableiunknown.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

