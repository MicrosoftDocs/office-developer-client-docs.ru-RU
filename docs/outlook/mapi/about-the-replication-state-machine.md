---
title: Сведения о конечном автомате репликации
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: cf36c6cb-57b4-7b2b-e23d-e0bc8696de96
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 30dd43a3ac9a315cd41919872b918bee639ca259
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22593055"
---
# <a name="about-the-replication-state-machine"></a>Сведения о конечном автомате репликации

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
В этом разделе приводится обзор конечного автомата для репликации данных Microsoft Outlook 2013 и Microsoft Outlook 2010.
  
> [!NOTE]
> API репликации необходимо полностью реализованы согласно инструкциям в данном разделе, чтобы быть полезными или не поддерживается. API репликации доступна только для репликации изменений Outlook 2013 или Outlook 2010 и с сервера. 
  
## <a name="iostx-and-the-state-machine"></a>IOSTX и конечного компьютера

Клиент вызывает **[IOSTX::SyncBeg](iostx-syncbeg.md)**, **[IOSTX::SyncEnd](iostx-syncend.md)**, **[IOSTX::SyncHdrBeg](iostx-synchdrbeg.md)** и **[IOSTX::SyncHdrEnd](iostx-synchdrend.md)** в последовательности синхронизация папок Outlook 2013 или Outlook 2010 и элементов между локального хранилища и сервером. Фактическая последовательность вызовов, зависит от данных, которую необходимо реплицировать (для пример, иерархии папок Outlook 2013 или Outlook 2010, Outlook 2013 или папки Outlook 2010, почтовых элементов, элементы календаря и т. п.) и направление синхронизации ( Отправка из локального хранилища на сервере или загрузки с сервера в локальном хранилище). Вот типичные последовательности вызовов: 
  
1. Клиент вызывает **IOSTX::SyncBeg** для начала репликации, указание идентификатором состояния и указатель на адрес соответствующего структуры данных. 
    
2. Outlook 2010 или Outlook 2013 выделяет структуры данных и инициализирует структуры данных с помощью сведения, необходимые для клиента. 
    
3. Клиент выполняет репликацию обновление структуры данных для передачи в локальном хранилище все необходимые сведения о репликации.
    
4. После выполнения репликации, клиент вызывает **[IOSTX::SetSyncResult](iostx-setsyncresult.md)** и **IOSTX::SyncEnd** для уведомления локального хранилища завершения конкретного репликации. 
    
> [!NOTE]
> Клиент всегда вызывает **IOSTX::SyncEnd** для завершения репликации, который начнется клиента для определенного состояния. В зависимости от общего данных, которую необходимо синхронизировать клиента клиент может вызывать пары вызовов **IOSTX::SyncBeg** и **IOSTX::SyncEnd** более одного раза. 
  
## <a name="state-table"></a>В таблице состояния

> [!NOTE]
> В следующей таблице перечислены допустимые состояния в компьютера состояние репликации, а также соответствующие идентификаторы состояние и структуры данных. В столбце **Репликации данных** термин «элементы» включает в себя почты, календаря, контактов, примечание, журнал и элементы задачи. При репликации изменений из локального хранилища на сервере, используйте идентификаторы состояние, определяющее «Отправить» и структуры данных с префикса «Вверх» (например, **LR_SYNC_UPLOAD_HIERARCHY** и **[UPHIER](uphier.md)** ). При репликации изменений с сервера в локальном хранилище, используйте идентификаторы состояние, определяющее «Загрузить» и структуры данных с префикса «DN» (например, **LR_SYNC_DOWNLOAD_HIERARCHY** и **[DNHIER](dnhier.md)** ). 
  
|||||
|:-----|:-----|:-----|:-----|
|**State** <br/> |**Репликация данных** <br/> |**Код состояния** <br/> |**Структура данных** <br/> |
|[Состояние бездействия](idle-state.md) <br/> | *None*  <br/> |**LR_SYNC_IDLE** <br/> | *None*  <br/> |
|[Состояние синхронизации](synchronize-state.md) <br/> |Папки или элементов  <br/> |**LR_SYNC** <br/> |**[SYNC](sync.md)** <br/> |
|[Отправка иерархия состояний](upload-hierarchy-state.md) <br/> |Папки  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**[UPHIER](uphier.md)** <br/> |
|[Отправить состояние папки](upload-folder-state.md) <br/> |Folder  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**[UPFLD](upfld.md)** <br/> |
|[Синхронизировать состояние содержимого](synchronize-contents-state.md) <br/> |Items  <br/> |**LR_SYNC_CONTENTS** <br/> |**[SYNCCONT](synccont.md)** <br/> |
|[Отправка состояний в таблице](upload-table-state.md) <br/> |Items  <br/> |**LR_SYNC_UPLOAD_TABLE** <br/> |**[UPTBL](uptbl.md)** <br/> |
|[Отправка сообщения состояния](upload-message-state.md) <br/> |Item  <br/> |**LR_SYNC_UPLOAD_MESSAGE** <br/> |**[UPMSG](upmsg.md)** <br/> |
|[Отправка состояний просмотра состояния](upload-read-status-state.md) <br/> |Items  <br/> |**LR_SYNC_UPLOAD_MESSAGE_READ** <br/> |**[UPREAD](upread.md)** <br/> |
|[Отправка удалить состояние состояние](upload-delete-status-state.md) <br/> |Items  <br/> |**LR_SYNC_UPLOAD_MESSAGE_DEL** <br/> |**[UPDEL](updel.md)** <br/> |
|[Загрузите иерархия состояний](download-hierarchy-state.md) <br/> |Папки  <br/> |**LR_SYNC_DOWNLOAD_HIERARCHY** <br/> |**[DNHIER](dnhier.md)** <br/> |
|[Загрузите таблицу состояний](download-table-state.md) <br/> |Items  <br/> |**LR_SYNC_DOWNLOAD_TABLE** <br/> |**[DNTBL](dntbl.md)** <br/> |
|[Загрузить состояние заголовка сообщения](download-message-header-state.md) <br/> |Заголовок сообщения  <br/> |**LR_SYNC_DOWNLOAD_HEADER** <br/> |**[HDRSYNC](hdrsync.md)** <br/> |
   
## <a name="state-transition-diagram"></a>Схема смены состояния

На следующей схеме показана переходы между состояниями, возникающие при отправку пользователями или выполнение полной синхронизации (загрузки, а затем отправка) из папки или содержимое папок (почту, календарь, контакт, примечание, задач или элементы дневника). 
  
@@@NEED ДЛЯ ВСТАВКИ, С ПОМОЩЬЮ ЗДЕСЬ ОТСУТСТВУЕТ @@@
  
## <a name="example-uploading-a-folder-hierarchy"></a>Пример: Отправка иерархии папок

 При загрузке иерархии папок, выполняется следующая последовательность действий: 
  
|||||
|:-----|:-----|:-----|:-----|
|**Шаг** <br/> |**Действие** <br/> |**State** <br/> |**Структура данных, связанных с ними** <br/> |
|1.  <br/> |Клиент инициирует отправляемых иерархии с **IOSTX::SyncBeg**.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|2.  <br/> |Outlook 2010 или Outlook 2013 заполняет **UPHIER** информацию для клиента. Этот компонент включает инициализация параметрах [out]: *iEnt* имеет значение 0, а *централизованной* числу папок в иерархии, которое должно отправку пользователями.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|3.  <br/> |Клиент не отправляемых фактический иерархии. Например если *централизованной* — 10 для каждого из 10 папок вызывает **IOSTX::SyncBeg**, указывающий идентификатор соответствующее состояние и структура данных для передачи в папку.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|4.  <br/> |Outlook 2010 или Outlook 2013 заполняет **UPFLD** , инициализация его [out] параметров, включая причина для папки загрузки, указатель на объект папки и идентификатор записи для папки.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|5.  <br/> |Клиент передает указанную папку.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|6.  <br/> |Клиент уведомляет локального хранилища завершения загрузки папки: после успешного выполнения, клиент задает [in] параметр *ulFlags* в **UPFLD** с **UPF_OK**, а затем вызывает **IOSTX::SetSyncResult (S_OK)** и **IOSTX::SyncEnd **. После сбоя клиент не будет задан *ulFlags* с флагом **UPF_OK** . Он вызывает **IOSTX::SetSyncResult**, передав в значение **HRESULT** и **IOSTX::SyncEnd**.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|7.  <br/> |Если **UPF_OK** имеет значение, Outlook 2013 или Outlook 2010 будет снимите внутренний запрос для загрузки в папку. Затем вне зависимости от состояния *ulFlags* , он будет Очистка какие-либо сведения внутренних регистрации. Если есть по-прежнему папки в иерархии, чтобы отправить (*iEnt* по-прежнему меньше, чем *централизованной*), клиент и Outlook 2013 или Outlook 2010 повторите шаги 3 – 7.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|8.  <br/> |Клиент уведомляет локального хранилища завершения загрузки иерархии: после успешного выполнения, клиент задает [in] флаг в **UPHIER** с **UPH_OK**и затем вызывает **IOSTX::SetSyncResult (S_OK)** и **IOSTX::SyncEnd**. После сбоя клиент не будет задан флаг **UPH_OK** . Он вызывает **IOSTX::SetSyncResult**, передав в значение **HRESULT** и **IOSTX::SyncEnd**.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|9.  <br/> |Имеет значение **UPH_OK** , Outlook 2013 и Outlook 2010 будет снимите внутренний запрос для загрузки иерархии. Затем вне зависимости от состояния *ulFlags* , он будет Очистка какие-либо сведения внутренних регистрации.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
   
## <a name="see-also"></a>См. также



[Сведения об API репликации](about-the-replication-api.md)
  
[Константы MAPI](mapi-constants.md)
  
[SYNCSTATE](syncstate.md)

