---
title: Сведения о конечном автомате репликации
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: cf36c6cb-57b4-7b2b-e23d-e0bc8696de96
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: a0644e4bf5c6847d61cc59e203d50f61ad142e84
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416484"
---
# <a name="about-the-replication-state-machine"></a>Сведения о конечном автомате репликации

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
В этой статье представлен обзор конечного автомата для Microsoft Outlook 2013 и репликации данных Microsoft Outlook 2010.
  
> [!NOTE]
> API репликации должен быть полностью реализован в соответствии с инструкциями, приведенными в этом разделе, чтобы быть полезной и поддерживаемой. API репликации доступен исключительно для репликации изменений Outlook 2013 или Outlook 2010 на сервер и с него. 
  
## <a name="iostx-and-the-state-machine"></a>ИОСТКС и конечный автомат

Клиент вызывает **[иосткс:: синкбег](iostx-syncbeg.md)**, **[Иосткс:: синценд](iostx-syncend.md)**, **[Иосткс:: Синчдрбег](iostx-synchdrbeg.md)** и **[иосткс:: синчдренд](iostx-synchdrend.md)** в последовательности для синхронизации папок и элементов Outlook 2013 и Outlook 2010 между локальным хранилищем и сервером. Фактическая последовательность вызовов зависит от данных, которые необходимо реплицировать (например, иерархия папок Outlook 2013 или Outlook 2010, папки Outlook 2013 или Outlook 2010, элементы почты, элементы календаря и т. д.) и направление синхронизации (отправка из локального хранилища на сервер или загрузка с сервера в локальное хранилище). Типичная последовательность вызовов: 
  
1. Клиент вызывает **иосткс:: синкбег** для начала репликации, указывая идентификатор состояния и указатель на адрес соответствующей структуры данных. 
    
2. Outlook 2013 или Outlook 2010 выделяет структуру данных и инициализирует структуру данных с необходимыми сведениями для клиента. 
    
3. Клиент выполняет репликацию, обновляя структуру данных для передачи в локальное хранилище и все необходимые сведения о репликации.
    
4. После выполнения репликации клиент вызывает **[иосткс:: сетсинкресулт](iostx-setsyncresult.md)** и **Иосткс:: синценд** , чтобы уведомить локальное хранилище о завершении конкретной репликации. 
    
> [!NOTE]
> Клиент всегда вызывает метод **иосткс:: синценд** , чтобы завершить репликацию, которая началась клиентом в определенном состоянии. В зависимости от общих данных, которые клиент должен синхронизировать, клиент может вызвать **иосткс:: синкбег** и **Иосткс:: синценд** несколько раз. 
  
## <a name="state-table"></a>Таблица State

> [!NOTE]
> В приведенной ниже таблице перечислены все допустимые состояния конечного автомата репликации, а также соответствующие идентификаторы состояний и структуры данных. В столбце **реплицированные данные** термин "элементы" включает в себя почту, календарь, контакты, заметки, журнал и элементы задач. При репликации изменений из локального хранилища на сервер используйте идентификаторы состояний, указывающие "UPLOAD" и структуры данных с префиксом "UP" (например, **LR_SYNC_UPLOAD_HIERARCHY** и **[уфиер](uphier.md)** ). При репликации изменений с сервера в локальное хранилище используйте идентификаторы состояний, указывающие "DOWNLOAD" и структуры данных с префиксом "DN" (например, **LR_SYNC_DOWNLOAD_HIERARCHY** и **[днхиер](dnhier.md)** ). 
  
|||||
|:-----|:-----|:-----|:-----|
|**State** <br/> |**Реплицированные данные** <br/> |**Идентификатор состояния** <br/> |**Структура данных** <br/> |
|[Состояние бездействия](idle-state.md) <br/> | *Нет*  <br/> |**LR_SYNC_IDLE** <br/> | *Нет*  <br/> |
|[Состояние синхронизации](synchronize-state.md) <br/> |Папки или элементы  <br/> |**LR_SYNC** <br/> |**[Синхр](sync.md)** <br/> |
|[Состояние отправки иерархии](upload-hierarchy-state.md) <br/> |Folders  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**[UPHIER](uphier.md)** <br/> |
|[Отправка состояния папки](upload-folder-state.md) <br/> |Folder  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**[UPFLD](upfld.md)** <br/> |
|[Состояние синхронизации контента](synchronize-contents-state.md) <br/> |Элементы  <br/> |**LR_SYNC_CONTENTS** <br/> |**[SYNCCONT](synccont.md)** <br/> |
|[Состояние отправки таблицы](upload-table-state.md) <br/> |Элементы  <br/> |**LR_SYNC_UPLOAD_TABLE** <br/> |**[UPTBL](uptbl.md)** <br/> |
|[Состояние отправки сообщения](upload-message-state.md) <br/> |Item  <br/> |**LR_SYNC_UPLOAD_MESSAGE** <br/> |**[UPMSG](upmsg.md)** <br/> |
|[Состояние отправки состояния чтения](upload-read-status-state.md) <br/> |Элементы  <br/> |**LR_SYNC_UPLOAD_MESSAGE_READ** <br/> |**[UPREAD](upread.md)** <br/> |
|[Состояние отправки состояния удаления](upload-delete-status-state.md) <br/> |Элементы  <br/> |**LR_SYNC_UPLOAD_MESSAGE_DEL** <br/> |**[UPDEL](updel.md)** <br/> |
|[Состояние загрузки иерархии](download-hierarchy-state.md) <br/> |Folders  <br/> |**LR_SYNC_DOWNLOAD_HIERARCHY** <br/> |**[DNHIER](dnhier.md)** <br/> |
|[Состояние загрузки таблицы](download-table-state.md) <br/> |Элементы  <br/> |**LR_SYNC_DOWNLOAD_TABLE** <br/> |**[DNTBL](dntbl.md)** <br/> |
|[Загрузка состояния заголовка сообщения](download-message-header-state.md) <br/> |Заголовок сообщения  <br/> |**LR_SYNC_DOWNLOAD_HEADER** <br/> |**[HDRSYNC](hdrsync.md)** <br/> |
   
## <a name="state-transition-diagram"></a>Схема смены состояний

На следующей схеме показаны переходы состояний, происходящие при отправке или выполнении полной синхронизации (Загрузка, а затем отправка) папок или содержимого папок (элементы почты, календарей, контактов, заметок, задач и элементов журнала). 
  
@ @ @ @ @NEED, ЧТОБЫ ВСТАВИТЬ ИЛЛЮСТРАЦИЮ, КОТОРАЯ ОТСУТСТВУЕТ @@@@@@
  
## <a name="example-uploading-a-folder-hierarchy"></a>Пример: отправка иерархии папок

 При отправке иерархии папок выполняется следующая последовательность действий: 
  
|||||
|:-----|:-----|:-----|:-----|
|**Шаг** <br/> |**Действие** <br/> |**State** <br/> |**Связанная структура данных** <br/> |
|1.  <br/> |Клиент инициирует отправку иерархии с **иосткс:: синкбег**.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|2.  <br/> |Outlook 2013 или Outlook 2010 заполняет **уфиер** данными для клиента. Сюда входит Инициализация параметров [out]: *иент* имеет значение 0 *, а увеличение числа папок в иерархии* , требующих отправки.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|3.  <br/> |Клиент выполняет фактическую отправку иерархии. Например *, если увеличение* 10 для каждой из 10 папок, клиент вызывает **Иосткс:: синкбег**, указывая соответствующий идентификатор состояния и структуру данных для отправки папки.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|4.  <br/> |Outlook 2013 или Outlook 2010 заполняет **упфлд** , инициализируя параметры [out], включая причину отправки папки, указатель на объект Folder и идентификатор записи для папки.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|5.  <br/> |Клиент отправляет указанную папку.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|6.  <br/> |Клиент уведомляет локальное хранилище о завершении загрузки папки: после успешного выполнения клиент задает параметр [in] *ulFlags* в **упфлд** с **UPF_OK**, а затем вызывает **иосткс:: сетсинкресулт (S_OK)** и **иосткс:: синценд**. После сбоя клиент не настроил *ulFlags* с помощью флага **UPF_OK** . Вызывает **иосткс:: сетсинкресулт**, передает значение **HRESULT** и **иосткс:: синценд**.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|7.  <br/> |Если задано значение **UPF_OK** , Outlook 2013 или Outlook 2010 будет очищать внутренний запрос на отправку папки. Затем, независимо от состояния *ulFlags* , он очистит все внутренние сведения о регистрации. Несмотря на то, что в иерархии по-прежнему находятся папки для отправки (*иент* по-прежнему меньше, чем *цент*), клиент и outlook 2013 или Outlook 2010 повторите шаги 3 – 7.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|8.  <br/> |Клиент уведомляет локальное хранилище о завершении отправки иерархии: после успешного выполнения клиент устанавливает флаг [in] в **уфиер** с **UPH_OK**, а затем вызывает **иосткс:: Сетсинкресулт (S_OK)** и **иосткс:: синценд**. После сбоя клиент не установил флаг **UPH_OK** . Вызывает **иосткс:: сетсинкресулт**, передает значение **HRESULT** и **иосткс:: синценд**.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|9.  <br/> |Если задано значение **UPH_OK** , Outlook 2013 или Outlook 2010 будет очищать внутренний запрос на отправку иерархии. Затем, независимо от состояния *ulFlags* , он очистит все внутренние сведения о регистрации.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
   
## <a name="see-also"></a>См. также



[Сведения об API репликации](about-the-replication-api.md)
  
[��������� MAPI](mapi-constants.md)
  
[SYNCSTATE](syncstate.md)

