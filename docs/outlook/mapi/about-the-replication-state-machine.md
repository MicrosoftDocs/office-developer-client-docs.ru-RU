---
title: Сведения о конечном автомате репликации
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: cf36c6cb-57b4-7b2b-e23d-e0bc8696de96
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: a0644e4bf5c6847d61cc59e203d50f61ad142e84
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416484"
---
# <a name="about-the-replication-state-machine"></a>Сведения о конечном автомате репликации

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
В этом разделе представлен обзор машины состояния для репликации Microsoft Outlook 2013 Microsoft Outlook 2010, русская версия данных.
  
> [!NOTE]
> API репликации должен быть полностью реализован в соответствии с инструкциями в этом разделе, чтобы быть полезным или поддерживаемым. API репликации доступен исключительно для репликации Outlook 2013 или Outlook 2010 г. изменений на сервер и с сервера. 
  
## <a name="iostx-and-the-state-machine"></a>IOSTX и государственная машина

Клиент вызывает **[IOSTX::SyncBeg,](iostx-syncbeg.md)** **[IOSTX::SyncEnd,](iostx-syncend.md)** **[IOSTX::SyncHdrBeg](iostx-synchdrbeg.md)** и **[IOSTX::SyncHdrEnd](iostx-synchdrend.md)** в последовательности для синхронизации Outlook 2013 или Outlook 2010 папок и элементов между локальным магазином и сервером. Фактическая последовательность вызовов зависит от данных, которые необходимо реплицировать (например, иерархия папок Outlook 2013 или Outlook 2010 г., папки Outlook или Outlook 2010 г., почтовые элементы, элементы календаря и т. п.) и направление синхронизации (будь то загрузка из локального магазина на сервер или загрузка с сервера в локальный магазин). Вот типичная последовательность вызовов: 
  
1. Клиент вызывает **IOSTX::SyncBeg,** чтобы начать репликацию, указав идентификатор состояния и указатель на адрес соответствующей структуры данных. 
    
2. Outlook 2013 или Outlook 2010 г. выделяет структуру данных и инициализирует структуру данных с необходимой для клиента информацией. 
    
3. Клиент выполняет репликацию, обновляя структуру данных, чтобы передать в локальный магазин все необходимые сведения о репликации.
    
4. После выполнения репликации клиент вызывает **[IOSTX::SetSyncResult](iostx-setsyncresult.md)** и **IOSTX::SyncEnd,** чтобы уведомить локальный магазин о завершении определенной репликации. 
    
> [!NOTE]
> Клиент всегда вызывает **IOSTX::SyncEnd,** чтобы закончить репликацию, которую клиент начал для определенного состояния. В зависимости от общих данных, которые клиент должен синхронизировать, клиент может вызывать пару вызовов **IOSTX::SyncBeg** и **IOSTX::SyncEnd** несколько раз. 
  
## <a name="state-table"></a>Таблица состояния

> [!NOTE]
> В следующей таблице перечислены все допустимые состояния в машине состояния репликации, а также соответствующие идентификаторы состояния и структуры данных. В **столбце Репликация** данных термин "элементы" включает элементы почты, календаря, контакта, заметки, журнала и задач. При репликации изменений из локального магазина на сервер используйте идентификаторы состояния с указанием "UPLOAD" и структуры данных с префиксом "UP" **(например, LR_SYNC_UPLOAD_HIERARCHY** и **[UPHIER).](uphier.md)** При репликации изменений с сервера в локальный магазин используйте идентификаторы состояния с указанием "DOWNLOAD" и структуры данных с префиксом "DN" **(например, LR_SYNC_DOWNLOAD_HIERARCHY** **[и DNHIER).](dnhier.md)** 
  
|||||
|:-----|:-----|:-----|:-----|
|**Состояние** <br/> |**Репликация данных** <br/> |**Идентификатор состояния** <br/> |**Структура данных** <br/> |
|[Состояние бездействия](idle-state.md) <br/> | *Нет*  <br/> |**LR_SYNC_IDLE** <br/> | *Нет*  <br/> |
|[Состояние синхронизации](synchronize-state.md) <br/> |Папки или элементы  <br/> |**LR_SYNC** <br/> |**[SYNC](sync.md)** <br/> |
|[Upload иерархии](upload-hierarchy-state.md) <br/> |Folders  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**[UPHIER](uphier.md)** <br/> |
|[Upload состояния папок](upload-folder-state.md) <br/> |Folder  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**[UPFLD](upfld.md)** <br/> |
|[Синхронизация состояния содержимого](synchronize-contents-state.md) <br/> |Элементы  <br/> |**LR_SYNC_CONTENTS** <br/> |**[SYNCCONT](synccont.md)** <br/> |
|[Upload таблицы](upload-table-state.md) <br/> |Элементы  <br/> |**LR_SYNC_UPLOAD_TABLE** <br/> |**[UPTBL](uptbl.md)** <br/> |
|[Upload состояния сообщений](upload-message-state.md) <br/> |Item  <br/> |**LR_SYNC_UPLOAD_MESSAGE** <br/> |**[UPMSG](upmsg.md)** <br/> |
|[Upload состояние состояния чтения](upload-read-status-state.md) <br/> |Элементы  <br/> |**LR_SYNC_UPLOAD_MESSAGE_READ** <br/> |**[UPREAD](upread.md)** <br/> |
|[Upload состояние состояния](upload-delete-status-state.md) <br/> |Элементы  <br/> |**LR_SYNC_UPLOAD_MESSAGE_DEL** <br/> |**[UPDEL](updel.md)** <br/> |
|[Состояние иерархии загрузки](download-hierarchy-state.md) <br/> |Folders  <br/> |**LR_SYNC_DOWNLOAD_HIERARCHY** <br/> |**[DNHIER](dnhier.md)** <br/> |
|[Состояние таблицы загрузки](download-table-state.md) <br/> |Элементы  <br/> |**LR_SYNC_DOWNLOAD_TABLE** <br/> |**[DNTBL](dntbl.md)** <br/> |
|[Скачивание состояния загона сообщений](download-message-header-state.md) <br/> |Заголовок сообщения  <br/> |**LR_SYNC_DOWNLOAD_HEADER** <br/> |**[HDRSYNC](hdrsync.md)** <br/> |
   
## <a name="state-transition-diagram"></a>Схема перехода состояния

На следующей схеме показаны переходы состояния, которые происходят при загрузке или выполнении полной синхронизации (загрузка с последующим загрузкой) папок или содержимого папок (почты, календаря, контакта, заметки, задачи или элементов журнала). 
  
@@@@@NEED ВСТАВИТЬ ЗДЕСЬ НЕДОСТАЮЩЕЕ ИСКУССТВО @@@@@@
  
## <a name="example-uploading-a-folder-hierarchy"></a>Пример: Загрузка иерархии папок

 При загрузке иерархии папок происходит следующая последовательность действий: 
  
|||||
|:-----|:-----|:-----|:-----|
|**Шаг** <br/> |**Действие** <br/> |**Состояние** <br/> |**Связанная структура данных** <br/> |
|1.  <br/> |Клиент инициирует загрузку иерархии с **помощью IOSTX::SyncBeg**.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|2.  <br/> |Outlook 2013 или Outlook 2010 г. заполняет **UPHIER** информацией для клиента. Это включает инициализацию параметров [out]:  *iEnt*  задан в 0,  *а cEnt*  — количеству папок в иерархии, которая нуждается в загрузке.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|3.  <br/> |Клиент делает фактическую загрузку иерархии. Например, если  *cEnt*  10, для каждой из 10 папок клиент вызывает **IOSTX::SyncBeg,** указав соответствующий идентификатор состояния и структуру данных для загрузки папки.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|4.  <br/> |Outlook 2013 или Outlook 2010 г. заполняет **upFLD** путем инициализации параметров [out], включая причину загрузки папки, указатель на объект папки и ИД записи для папки.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|5.  <br/> |Клиент загружает указанную папку.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|6.  <br/> |Клиент сообщает локальному магазину о завершении загрузки папки: после успешного выполнения клиент задает параметр  *ulFlags*  [in] в **UPFLD** с **помощью UPF_OK,** а затем вызывает **IOSTX::SetSyncResult (S_OK)** и **IOSTX::SyncEnd**. При сбое клиент не будет устанавливать  *ulFlags*  с **UPF_OK** флагом. Он вызывает **IOSTX::SetSyncResult,** передавая значение **HRESULT,** **и IOSTX::SyncEnd**.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|7.  <br/> |Если **UPF_OK** установлено, Outlook 2013 или Outlook 2010 г. очищает внутренний запрос на отправку папки. Затем независимо от состояния  *ulFlags,*  он будет очищать все внутренние сведения бухгалтерского учета. Несмотря на то, что в иерархии по-прежнему есть папки для загрузки *(iEnt* по-прежнему меньше *cEnt),* клиент и Outlook 2013 или Outlook 2010 повторяют шаги 3-7.  <br/> |**LR_SYNC_UPLOAD_FOLDER** <br/> |**UPFLD** <br/> |
|8.  <br/> |Клиент сообщает локальному магазину о завершении загрузки иерархии: после успешного выполнения клиент задает флаг [in] в **UPHIER** с **UPH_OK,** а затем вызывает **IOSTX::SetSyncResult (S_OK)** и **IOSTX::SyncEnd**. При сбое клиент не будет устанавливать **UPH_OK** флага. Он вызывает **IOSTX::SetSyncResult,** передавая значение **HRESULT,** **и IOSTX::SyncEnd**.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
|9.  <br/> |Если **UPH_OK** установлено, Outlook 2013 или Outlook 2010 г. очищает внутренний запрос на загрузку иерархии. Затем независимо от состояния  *ulFlags,*  он будет очищать все внутренние сведения бухгалтерского учета.  <br/> |**LR_SYNC_UPLOAD_HIERARCHY** <br/> |**UPHIER** <br/> |
   
## <a name="see-also"></a>См. также



[Сведения об API репликации](about-the-replication-api.md)
  
[��������� MAPI](mapi-constants.md)
  
[SYNCSTATE](syncstate.md)

