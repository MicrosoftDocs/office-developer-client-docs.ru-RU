---
title: Копирование или перемещение сообщения или папки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 72290fd3-00d7-4055-bbfa-0c47b6e0f62d
description: 'Последнее изменение: 08 ноября 2011 г.'
ms.openlocfilehash: c5e92c44d7078560ed84d72b3477d5cf2e809353
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33413502"
---
# <a name="copying-or-moving-a-message-or-a-folder"></a>Копирование или перемещение сообщения или папки
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Клиент может использовать один из четырех методов для копирования или перемещения сообщения или папки:
  
- [IMAPIFolder::CopyFolder](imapifolder-copyfolder.md)
    
- [IMAPIFolder::CopyMessages](imapifolder-copymessages.md)
    
- [IMAPIProp::CopyTo](imapiprop-copyto.md)
    
- [IMAPIProp::CopyProps](imapiprop-copyprops.md)
    
Установив соответствующие флаги и параметры, **CopyTo** и **CopyProps** можно сделать так же, как **CopyFolder** или **CopyMessages**. При выборе метода вызова следует учитывать следующие проблемы.
  
- Копируете или перемещаете папку или сообщение?
    
- Сколько вы знаете о папке или сообщении, которые будут перемещены или скопированы?
    
- Сколько свойств папки или сообщения будет перемещено или скопировано?
    
С помощью **методов IMAPIProp** можно скопировать или переместить папку или сообщение. **IMAPIFolder::CopyMessages работает** только с сообщениями; **IMAPIFolder::CopyFolder** работает только с папками. 
  
В то время как использование методов **IMAPIFolder** не требует каких-либо знаний о свойствах, поддерживаемых папкой или сообщением для копирования или перемещений, необходимо иметь некоторые знания для использования методов **IMAPIProp.** С **помощью IMAPIProp::CopyProps** необходимо четко указать, какие из свойств папки или сообщений необходимо скопировать или переместить. С **IMAPIProp::CopyTo**, если вы не хотите скопировать или переместить все свойства, необходимо четко указать, какие из них следует исключить. Дополнительные сведения об этих методах см. в дополнительных сведениях [о копировании свойств MAPI.](copying-mapi-properties.md)
  
Количество свойств, которые будут скопированы или перемещены, может повлиять на ваше решение о том, какой метод использовать. Если вы копируете или перемещает несколько сообщений, позвоните **в IMAPIFolder::CopyMessages**. Альтернативный выбор — вызвать **IMAPIProp::CopyProps,** **чтобы скопировать** только свойство [PR_CONTAINER_CONTENTS (PidTagContainerContents).](pidtagcontainercontents-canonical-property.md) Следующая процедура показывает, как использовать **CopyMessages**. 
  
### <a name="to-copy-or-move-one-or-more-messages"></a>Копирование или перемещение одного или более сообщений
  
1. Найдите допустимые идентификаторы записи для исходных и назначений папок.
    
2. Откройте эти папки в режиме чтения и записи, позвонив [в IMAPISession::OpenEntry](imapisession-openentry.md) или [IMsgStore::OpenEntry](imsgstore-openentry.md) и задав флаг MAPI_MODIFY. 
    
3. Убедитесь, что указатель интерфейса, возвращенный **из OpenEntry,** является **указателем интерфейса IMAPIFolder.** Если нет, отведите его в тип LPMAPIFOLDER. 
    
4. Создайте массив идентификаторов записей, представляющих одно или несколько сообщений, которые будут скопированы или перемещены. 
    
5. Вызов **IMAPIFolder::CopyMessages со** следующим набором флагов: 
    
   - MESSAGE_MOVE, если вы хотите выполнить операцию перемещения. 
    
   - MESSAGE_DIALOG и передай ручку окна в  _параметре ulUIParam,_ если нужно, чтобы в папке был индикатор прогресса. 
    
6. **Отпустите указатели IMAPIFolder** для исходных папок и папок назначения. 
    
Если вы хотите скопировать полное содержимое папки в другую папку, позвоните по методу **IMAPIFolder::CopyFolder** или **IMAPIProp::CopyTo.** 
  
Чтобы скопировать несколько свойств папки, позвоните по методу **IMAPIProp::CopyProps.** Чтобы скопировать большинство свойств папки, позвоните **в IMAPIProp::CopyTo**. 
  
Например, если вы хотите скопировать свойства  PR_DISPLAY_NAME [(PidTagDisplayName)](pidtagdisplayname-canonical-property.md)и **PR_COMMENT** [(PidTagComment),](pidtagcomment-canonical-property.md)у вас есть следующие параметры:
  
- Позвоните **в IMAPIFolder::CopyFolder,** чтобы скопировать все свойства папки, а затем удалить нежелательные из новой папки. 
    
- Вызов **CopyTo** и исключить все свойства папки, за исключением PR_DISPLAY_NAME **и PR_COMMENT**.  
    
- Вызов **CopyProps,** **PR_DISPLAY_NAME** и **PR_COMMENT** в массиве включить. 
    
В этом случае **CopyProps** — это лучший выбор, так как он предназначен для копирования небольшого набора свойств и является самым простым вызовом для реализации. 
  
Чтобы скопировать или переместить только свойства папок, не включая сообщения, позвоните по методу **IMAPIProp::CopyTo** и исключите следующие свойства: 
  
- **PR_CONTAINER_CONTENTS** [(PidTagContainerContents)](pidtagcontainercontents-canonical-property.md)
    
- **PR_FOLDER_ASSOCIATED_CONTENTS** [(PidTagFolderAssociatedContents)](pidtagfolderassociatedcontents-canonical-property.md)
    
Методы копирования могут S_OK, что указывает на общий успех, MAPI_W_PARTIAL_COMPLETION, что указывает на частичный успех или ошибку. Если MAPI_W_PARTIAL_COMPLETION возвращается, **используйте макрос HR_FAILED,** чтобы получить доступ к более конкретной ошибке. Дополнительные сведения см. в [дополнительных сведениях Об использовании макроса для обработки ошибок.](using-macros-for-error-handling.md)
  
Если вы скопируете сообщения из одного магазина сообщений в другой и Юникод не поддерживается обеими сторонами, следует помнить, что информация может быть потеряна из-за преобразования страницы кода. Обычно вы не можете знать, поддерживают ли хранилища сообщений один или оба формата, из-за чего невозможно определить, следует ли копировать свойства текста как строки ASCII или строки Юникод. Если вы поддерживаете Юникод, попробуйте выполнить копию Юникод; если она не справилась со значением ошибки MAPI_E_BAD_CHARWIDTH, прибегли к ASCII.
  

