---
title: Копирование или перемещение сообщения или папки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 72290fd3-00d7-4055-bbfa-0c47b6e0f62d
description: 'Дата последнего изменения: 08 ноября 2011 г.'
ms.openlocfilehash: c5e92c44d7078560ed84d72b3477d5cf2e809353
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32333042"
---
# <a name="copying-or-moving-a-message-or-a-folder"></a>Копирование или перемещение сообщения или папки
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Для копирования или перемещения сообщения или папки клиент может использовать один из четырех способов:
  
- [IMAPIFolder::CopyFolder](imapifolder-copyfolder.md)
    
- [IMAPIFolder::CopyMessages](imapifolder-copymessages.md)
    
- [IMAPIProp::CopyTo](imapiprop-copyto.md)
    
- [IMAPIProp::CopyProps](imapiprop-copyprops.md)
    
Настроив соответствующие флаги и параметры, можно выполнить параметры **CopyTo** и **копипропс** , чтобы работать так же, как и **CopyFolder** , или **копимессажес**. При выборе метода для вызова необходимо учитывать следующие моменты.
  
- Вы копируете или перемещаете папку или сообщение?
    
- Насколько вы узнаете о папке или сообщении для перемещения или копирования?
    
- Как будет перемещаться или копироваться количество свойств папки или сообщения?
    
Можно использовать методы **IMAPIProp** для копирования или перемещения папки или сообщения. **IMAPIFolder:: копимессажес** работает только с сообщениями; **IMAPIFolder:: CopyFolder** работает только с папками. 
  
В то время как при использовании методов **IMAPIFolder** не требуется знать о свойствах, поддерживаемых папкой или сообщением, для копирования или перемещения, необходимы некоторые знания для использования методов **IMAPIProp** . С помощью **IMAPIProp:: копипропс**необходимо явным образом указать, какую папку или свойства сообщения необходимо скопировать или переместить. С **IMAPIProp:: CopyTo**, если вы не хотите копировать или перемещать все свойства, необходимо явным образом указать, какие из них следует исключить. Дополнительные сведения об этих методах приведены в статье [Копирование свойств MAPI](copying-mapi-properties.md).
  
Число копируемых или перемещаемых свойств может повлиять на ваше решение относительно используемого метода. При копировании или перемещении нескольких сообщений вызовите метод **IMAPIFolder:: копимессажес**. Альтернативный вариант — вызвать метод **IMAPIProp:: копипропс** , чтобы скопировать только свойство **пр_контаинер_контентс** папки ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md)). В следующей процедуре показано, как использовать **копимессажес**. 
  
### <a name="to-copy-or-move-one-or-more-messages"></a>Копирование или перемещение одного или нескольких сообщений
  
1. Поиск допустимых идентификаторов записей для исходной и конечной папок.
    
2. Откройте эти папки в режиме чтения и записи, вызвав один из [IMAPISession:: OpenEntry](imapisession-openentry.md) или [IMsgStore:: OpenEntry](imsgstore-openentry.md) и установив флаг мапи_модифи. 
    
3. Убедитесь, что указатель интерфейса, возвращенный из **OpenEntry** , является указателем интерфейса **IMAPIFolder** . Если нет, приведите его к типу ЛПМАПИФОЛДЕР. 
    
4. Создайте массив идентификаторов записей, представляющих одно или несколько сообщений, которые необходимо скопировать или переместить. 
    
5. Call **IMAPIFolder:: копимессажес** со следующими установленными флагами: 
    
   - МЕССАЖЕ_МОВЕ, если вы хотите выполнить операцию перемещения. 
    
   - МЕССАЖЕ_ДИАЛОГ и передайте дескриптор окна в параметре _улуипарам_ , если необходимо, чтобы в папке отображался индикатор хода выполнения. 
    
6. Освободите указатели **IMAPIFolder** для исходной и конечной папок. 
    
Если требуется скопировать полное содержимое папки в другую папку, вызовите метод **IMAPIFolder:: CopyFolder** или **IMAPIProp:: CopyTo** для исходной папки. 
  
Чтобы скопировать несколько свойств папки, вызовите ее метод **IMAPIProp:: копипропс** . Чтобы скопировать большую часть свойств папки, вызовите **IMAPIProp:: CopyTo**. 
  
Например, если нужно скопировать свойства папки **пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) и **пр_коммент** ([PidTagComment](pidtagcomment-canonical-property.md)), доступны следующие параметры:
  
- Call **IMAPIFolder:: CopyFolder** , чтобы скопировать все свойства папки, а затем удалить ненужные из новой папки. 
    
- ВыЗовите функцию **CopyTo** и исключите все свойства папки, кроме **пр_дисплай_наме** и **пр_коммент**. 
    
- ВыЗовите **копипропс**, передав **пр_дисплай_наме** и **пр_коммент** в массив include. 
    
В этом случае **копипропс** является лучшим вариантом, так как он предназначен для копирования небольшого набора свойств и является самым простым вызовом для реализации. 
  
Чтобы скопировать или переместить только свойства папки, не включая сообщения, вызовите метод **IMAPIProp:: CopyTo** для папки и исключите следующие свойства: 
  
- **Пр_контаинер_контентс** ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md))
    
- **Пр_фолдер_ассоЦиатед_контентс** ([PidTagFolderAssociatedContents](pidtagfolderassociatedcontents-canonical-property.md))
    
Методы Copy могут возвращать значение S_OK, указывающее общее значение Success, МАПИ_В_ПАРТИАЛ_КОМПЛЕТИОН, указывающее на частичный успех или ошибку. Если возвращается МАПИ_В_ПАРТИАЛ_КОМПЛЕТИОН, используйте макрос **хр_фаилед** для получения доступа к более подробной ошибке. Дополнительные сведения см. [в разделе Использование макросов для обработки ошибок](using-macros-for-error-handling.md).
  
Если вы копируете сообщения из одного хранилища сообщений в другое, и Юникод не поддерживается обоими, то помните, что данные могут быть потеряны из-за преобразования кодовой страницы. Как правило, вы не можете определить, поддерживает ли хранилище сообщений один или оба формата, что невозможно определить, нужно ли копировать свойства текста как строки ASCII или как строки Юникода. Если вы поддерживаете Юникод, попробуйте выполнить копирование в кодировке Юникод; Если произойдет сбой со значением ошибки МАПИ_Е_БАД_ЧАРВИДС, следует прибегнуть к ТЕКСТОВОМу символу ASCII.
  

