---
title: Копирование и перемещение папки или сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 72290fd3-00d7-4055-bbfa-0c47b6e0f62d
description: 'Последнее изменение: 08 ноября 2011 г.'
ms.openlocfilehash: 26fe135da93e0f5f94d9f7d264453b74f97a518b
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19808233"
---
# <a name="copying-or-moving-a-message-or-a-folder"></a>Копирование и перемещение папки или сообщения
  
**Применимо к**: Outlook 
  
Клиент может использовать один из четырех методов для копирования или перемещения сообщения или папки:
  
- [IMAPIFolder::CopyFolder](imapifolder-copyfolder.md)
    
- [IMAPIFolder::CopyMessages](imapifolder-copymessages.md)
    
- [IMAPIProp::CopyTo](imapiprop-copyto.md)
    
- [IMAPIProp::CopyProps](imapiprop-copyprops.md)
    
Задав соответствующие флаги и параметры, **CopyTo** и **CopyProps** может быть установлено работают так же, как **CopyFolder** или **CopyMessages**. При выборе метод, вызываемый необходимо учитывайте следующее:
  
- Копирование или перемещение папки или сообщение?
    
- Сколько вы знаете о папку или сообщение для перемещения или копирования?
    
- Сколько папки или свойства сообщения будут перемещены или скопированы?
    
Скопируйте или переместите папку или сообщение воспользуйтесь методом **IMAPIProp** . **IMAPIFolder::CopyMessages** для работы с сообщений **IMAPIFolder::CopyFolder** для работы с только папки. 
  
В то время как с помощью методов **IMAPIFolder** не требует знания свойства, поддерживаемые в папку или на сообщение, чтобы скопировать или переместить, необходимо иметь некоторые базы знаний, чтобы использовать методы **IMAPIProp** . С помощью **IMAPIProp::CopyProps**необходимо явно указать, какие свойства папки или сообщения, которые нужно скопировать или переместить. С помощью **IMAPIProp::CopyTo**Если не требуется скопировать или переместить все свойства, необходимо явно задать какие из них следует исключить. Дополнительные сведения об этих методов можно [Копирование свойств MAPI](copying-mapi-properties.md).
  
Число свойств можно скопировать или переместить могут повлиять на ваше решение о том, какой метод следует использовать. Если копирование или перемещение нескольких сообщений, вызовите **IMAPIFolder::CopyMessages**. Альтернативный вариант — вызов **IMAPIProp::CopyProps** для копирования только свойства папки **PR_CONTAINER_CONTENTS** ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md)). Следующей процедуре показано, как использовать **CopyMessages**. 
  
### <a name="to-copy-or-move-one-or-more-messages"></a>Копирование или перемещение одно или несколько сообщений
  
1. Найдите идентификаторы записей для исходной и конечной папки.
    
2. Откройте эти папки в режиме чтения и записи, вызов [IMAPISession::OpenEntry](imapisession-openentry.md) или [IMsgStore::OpenEntry](imsgstore-openentry.md) и установка флага MAPI_MODIFY. 
    
3. Убедитесь, что указатель интерфейса, возвращенный из **OpenEntry** указатель интерфейса **IMAPIFolder** . В противном случае привести к типу LPMAPIFOLDER. 
    
4. Создайте массив идентификаторов запись представляет одно или несколько сообщений можно скопировать или переместить. 
    
5. Вызовите **IMAPIFolder::CopyMessages** с помощью следующей последовательности флаги: 
    
   - MESSAGE_MOVE, если требуется выполнить операции перемещения. 
    
   - MESSAGE_DIALOG и передайте окно обрабатывать с помощью параметра _ulUIParam_ папка для отображения индикатора хода выполнения. 
    
6. Освобождение указатели **IMAPIFolder** для исходной и конечной папки. 
    
Если требуется скопировать все содержимое папки в другую папку, вызовите метод **IMAPIFolder::CopyFolder** или **IMAPIProp::CopyTo** исходной папки. 
  
Чтобы скопировать несколько свойств папки, вызове метода **IMAPIProp::CopyProps** . Чтобы скопировать большая часть свойств папки, вызовите **IMAPIProp::CopyTo**. 
  
Например если требуется скопировать свойства **PR_COMMENT** ([PidTagComment](pidtagcomment-canonical-property.md)) и **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) папки, у вас есть следующие параметры:
  
- Вызовите **IMAPIFolder::CopyFolder** , чтобы скопировать все свойства папки, а затем удалить ненужные из них в новую папку. 
    
- Вызовите **CopyTo** и исключить все свойства папки кроме **PR_DISPLAY_NAME** и **PR_COMMENT**. 
    
- Вызовите **CopyProps**, передав **PR_DISPLAY_NAME** и **PR_COMMENT** в массиве include. 
    
В этом случае **CopyProps** является оптимальным выбором, так как он должен использоваться для копирования небольшой набор свойств и это самый простой вызов для реализации. 
  
Чтобы скопировать или переместить только свойства папки, не включая сообщения, вызовите метод **IMAPIProp::CopyTo** папки и исключить следующие свойства: 
  
- **PR_CONTAINER_CONTENTS** ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md))
    
- **PR_FOLDER_ASSOCIATED_CONTENTS** ([PidTagFolderAssociatedContents](pidtagfolderassociatedcontents-canonical-property.md))
    
Методы копирования может возвращать значение S_OK, общее успешно, MAPI_W_PARTIAL_COMPLETION, указывающего на то, указывающее, частичный успех или ошибка. Если MAPI_W_PARTIAL_COMPLETION возвращается, используйте макрос **HR_FAILED** для доступа к более конкретной ошибки. Дополнительные сведения можно [С помощью макросов для обработки ошибок](using-macros-for-error-handling.md).
  
Если копирование сообщений из одного хранилища в другое и Юникод не поддерживается в обоих, обратите внимание, что данные могут быть потеряны из-за преобразования кода страницы. Обычно нельзя известно, если хранилищ сообщений поддерживает форматы один или оба, делая невозможным определить, нужно ли скопировать текст свойства как строки ASCII или Юникод. Если вы поддерживаете Юникод, попробуйте выполнить копия Юникод. в случае сбоя со значением ошибки MAPI_E_BAD_CHARWIDTH прибегать к ASCII.
  

