---
title: Взаимодействие с диспетчером очереди MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432151"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="e28a3-103">Взаимодействие с диспетчером очереди MAPI</span><span class="sxs-lookup"><span data-stu-id="e28a3-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="e28a3-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="e28a3-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="e28a3-105">Методы в интерфейсе [иксплогон: IUnknown](ixplogoniunknown.md) используются диспетчером очереди MAPI при вызове поставщика транспорта.</span><span class="sxs-lookup"><span data-stu-id="e28a3-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="e28a3-106">Большинству типов поставщиков транспорта рекомендуется реализовать большинство из этих методов, чтобы они быстро возвращались.</span><span class="sxs-lookup"><span data-stu-id="e28a3-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="e28a3-107">Это желательно, так как если метод занимает много времени, то он должен быть разбит на вызовы обратно в буфер обмена MAPI, чтобы освободить ЦП для других задач.</span><span class="sxs-lookup"><span data-stu-id="e28a3-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="e28a3-108">Диспетчер очереди MAPI выполняет свою работу и выполняет звонки поставщикам транспорта, когда фоновые приложения простаивают.</span><span class="sxs-lookup"><span data-stu-id="e28a3-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="e28a3-109">После необязательного отображения диалоговых окон при первом входе в систему поставщика транспорта (управляемого с помощью флагов, переданных из MAPI в поставщика транспорта), поставщики транспорта работают в фоновом режиме, если клиент не вызывает сброс очередей отправки и получения.</span><span class="sxs-lookup"><span data-stu-id="e28a3-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="e28a3-110">Очистка очередей — единственный момент, когда поставщик транспорта не должен освобождать ЦП, а затем только в том случае, если пользователь сообщает о том, что выполнение потенциально длительного действия выполняется.</span><span class="sxs-lookup"><span data-stu-id="e28a3-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="e28a3-111">Диспетчер очереди MAPI обычно запрашивает у поставщика транспорта сброс своих очередей в ответ на действие пользователя, поэтому поставщику транспорта обычно не требуется выполнять никаких действий, чтобы убедиться, что пользователь сообщает об этом.</span><span class="sxs-lookup"><span data-stu-id="e28a3-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="e28a3-112">Поставщик транспорта может независимо заменять очередь и использовать биты СТАТУС_ИНБАУНД_ФЛУШ и СТАТУС_АУТБАУНД_ФЛУШ в свойстве **пр_статус_коде** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) в строке состояния, чтобы уведомить Диспетчер очереди MAPI о необходимости Обратите внимание на то, чтобы оно могло выполнить задачу.</span><span class="sxs-lookup"><span data-stu-id="e28a3-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="e28a3-113">Строка состояния обновляется с помощью метода [имаписуппорт:: модифистатусров](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="e28a3-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="e28a3-114">В этом случае поставщик транспорта, вероятно, должен отображать индикатор хода выполнения или другой интерфейс для информирования пользователя о том, что выполняется длинное действие.</span><span class="sxs-lookup"><span data-stu-id="e28a3-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="e28a3-115">Так как активность сети часто занимает более 0,2 секунд, поставщики транспорта должны, по мере возможности, использовать асинхронные сетевые запросы.</span><span class="sxs-lookup"><span data-stu-id="e28a3-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="e28a3-116">Это позволяет им инициировать запрос, освобождать процессор путем обратного вызова к диспетчеру очереди MAPI, а также когда диспетчер очереди MAPI снова предоставляет им контроль, чтобы проверить, завершился ли их сетевой запрос.</span><span class="sxs-lookup"><span data-stu-id="e28a3-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="e28a3-117">Если он еще не завершен, он снова выполнит освобождение ЦП, выполнив обратное вызов к диспетчеру очереди MAPI с помощью метода [имаписуппорт:: спулериелд](imapisupport-spooleryield.md) .</span><span class="sxs-lookup"><span data-stu-id="e28a3-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="e28a3-118">Во время обработки сообщений между [иксплогон:: субмитмессаже](ixplogon-submitmessage.md) и [Иксплогон:: ендмессаже](ixplogon-endmessage.md) и во время [иксплогон:: стартмессаже](ixplogon-startmessage.md), поставщик транспорта, как правило, выполняет множество вызовов на объектах, предоставляемых диспетчером MAPI.</span><span class="sxs-lookup"><span data-stu-id="e28a3-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="e28a3-119">В процессе обработки этих объектов, диспетчер очереди MAPI помогает поставщику транспорта правильно работать в фоновом режиме, выдавая его при необходимости.</span><span class="sxs-lookup"><span data-stu-id="e28a3-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="e28a3-120">Поставщик транспорта, требующий обработки по крайней мере, может объявить критический раздел для диспетчера очереди MAPI с помощью метода [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) support Object.</span><span class="sxs-lookup"><span data-stu-id="e28a3-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="e28a3-121">В этом случае ЦП высвобождается только на явных вызовах **спулериелд** поставщиком транспорта, пока поставщик транспорта не завершит обработку критической секции с другим вызовом **спулернотифи**.</span><span class="sxs-lookup"><span data-stu-id="e28a3-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="e28a3-122">Это не то же самое, что и критический раздел Win32.</span><span class="sxs-lookup"><span data-stu-id="e28a3-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="e28a3-123">Это следует делать только в том случае, когда поставщик транспорта требует управления внешними ресурсами в режиме реального времени, например чтения входящих данных из строки факса.</span><span class="sxs-lookup"><span data-stu-id="e28a3-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="e28a3-124">Так как это приводит к появлению приоритета обработки очереди MAPI и может привести к тому, что Рабочая станция не будет реагировать на длительность операции, рекомендуется уведомить пользователя о том, что выполнение потенциально длительного действия и подать индикатор выполнения, если это возможно.</span><span class="sxs-lookup"><span data-stu-id="e28a3-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

