---
title: Взаимодействие со Spooler MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432151"
---
# <a name="interacting-with-the-mapi-spooler"></a>Взаимодействие со Spooler MAPI

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Методы в [интерфейсе IXPLogon : IUnknown](ixplogoniunknown.md) используются spooler MAPI при вызове поставщика транспорта. Большинство типов транспортных поставщиков должны реализовать большинство этих методов, чтобы они быстро возвращались. Это желательно, так как если метод занимает много времени, чтобы вернуться, его следует разбить с вызовами обратно в пульпер MAPI, чтобы освободить ЦП для других задач. 
  
Spooler MAPI делает свою работу и вызывает поставщиков транспорта, когда приложения переднего плана простаивают. После необязательного отображения диалоговых ящиков, когда поставщик транспорта впервые вошел в систему (управляется флагами, переданными из MAPI поставщику транспорта), поставщики транспорта работают в фоновом режиме, если клиент не вызвал их для очистки отправки и получения очередей. Очистка очередей — это единственный раз, когда поставщику транспорта не требуется освободить ЦП, а затем только в том случае, если пользователю будет известно о возможном длительном действии. Пульпер MAPI обычно запрашивает, чтобы поставщик транспорта смыл очереди в ответ на действия пользователя, поэтому поставщику транспорта обычно не нужно ничего делать, чтобы убедиться, что пользователь проинформирован.
  
Поставщик транспорта может самостоятельно принять решение смыть очередь и использовать биты STATUS_INBOUND_FLUSH и STATUS_OUTBOUND_FLUSH в свойстве **PR_STATUS_CODE** [(PidTagStatusCode)](pidtagstatuscode-canonical-property.md)строки состояния, чтобы сообщить пульперу MAPI о том, что он хочет обратить внимание, чтобы получить задание. Строка состояния обновляется с помощью [метода IMAPISupport::ModifyStatusRow.](imapisupport-modifystatusrow.md) В этом случае поставщик транспорта, вероятно, должен отображать индикатор прогресса или другой интерфейс, чтобы сообщить пользователю о том, что происходит длительное действие. 
  
Так как работа сети часто занимает более 0,2 секунды, поставщики транспорта должны по возможности использовать асинхронные сетевые запросы. Это позволяет им инициировать запрос, освободить ЦП, позвонив обратно в пулер MAPI, и когда пульпер MAPI снова даст им управление, чтобы проверить, завершен ли их сетевой запрос. Если он еще не завершен, они снова выпускают ЦП, вызывая обратно в [spooler MAPI с помощью метода IMAPISupport::SpoolerYield.](imapisupport-spooleryield.md) 
  
Во время обработки сообщений между [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) и [IXPLogon::EndMessage](ixplogon-endmessage.md) и во время [IXPLogon::StartMessage](ixplogon-startmessage.md)поставщик транспорта обычно совершает множество вызовов на объекты, подвергающиеся воздействию пулера MAPI. В рамках обработки этих объектов шпалер MAPI помогает поставщику транспорта вести себя надлежащим образом в качестве фонового процесса, уступая при необходимости самостоятельно. Поставщик транспорта, требующий критической обработки во времени, может объявить критический раздел для пулера MAPI с помощью метода объекта поддержки [IMAPISupport::SpoolerNotify.](imapisupport-spoolernotify.md) В этом случае ЦП выпускается только при явных вызовах **SpoolerYield** поставщиком транспорта, пока поставщик транспорта не завершит обработку критически важных разделов другим вызовом **в SpoolerNotify**.
  
> [!NOTE]
> Это не то же самое, что критический раздел Win32. Это должно быть сделано только в том случае, если поставщику транспорта необходимо в режиме реального времени контролировать внешние ресурсы, такие как чтение входящих данных из факсимиловой строки. Так как это повышает приоритет процесса пульпера MAPI и может привести к тому, что рабочие станции не будут работать на протяжении операции, следует уведомить пользователя о возможном длительном действии и предоставить индикатор прогресса, если это возможно. 
  

