---
title: Взаимодействие с диспетчером очереди MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432151"
---
# <a name="interacting-with-the-mapi-spooler"></a>Взаимодействие с диспетчером очереди MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Методы в интерфейсе [иксплогон: IUnknown](ixplogoniunknown.md) используются диспетчером очереди MAPI при вызове поставщика транспорта. Большинству типов поставщиков транспорта рекомендуется реализовать большинство из этих методов, чтобы они быстро возвращались. Это желательно, так как если метод занимает много времени, то он должен быть разбит на вызовы обратно в буфер обмена MAPI, чтобы освободить ЦП для других задач. 
  
Диспетчер очереди MAPI выполняет свою работу и выполняет звонки поставщикам транспорта, когда фоновые приложения простаивают. После необязательного отображения диалоговых окон при первом входе в систему поставщика транспорта (управляемого с помощью флагов, переданных из MAPI в поставщика транспорта), поставщики транспорта работают в фоновом режиме, если клиент не вызывает сброс очередей отправки и получения. Очистка очередей — единственный момент, когда поставщик транспорта не должен освобождать ЦП, а затем только в том случае, если пользователь сообщает о том, что выполнение потенциально длительного действия выполняется. Диспетчер очереди MAPI обычно запрашивает у поставщика транспорта сброс своих очередей в ответ на действие пользователя, поэтому поставщику транспорта обычно не требуется выполнять никаких действий, чтобы убедиться, что пользователь сообщает об этом.
  
Поставщик транспорта может независимо заменять очередь и использовать биты СТАТУС_ИНБАУНД_ФЛУШ и СТАТУС_АУТБАУНД_ФЛУШ в свойстве **пр_статус_коде** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) в строке состояния, чтобы уведомить Диспетчер очереди MAPI о необходимости Обратите внимание на то, чтобы оно могло выполнить задачу. Строка состояния обновляется с помощью метода [имаписуппорт:: модифистатусров](imapisupport-modifystatusrow.md) . В этом случае поставщик транспорта, вероятно, должен отображать индикатор хода выполнения или другой интерфейс для информирования пользователя о том, что выполняется длинное действие. 
  
Так как активность сети часто занимает более 0,2 секунд, поставщики транспорта должны, по мере возможности, использовать асинхронные сетевые запросы. Это позволяет им инициировать запрос, освобождать процессор путем обратного вызова к диспетчеру очереди MAPI, а также когда диспетчер очереди MAPI снова предоставляет им контроль, чтобы проверить, завершился ли их сетевой запрос. Если он еще не завершен, он снова выполнит освобождение ЦП, выполнив обратное вызов к диспетчеру очереди MAPI с помощью метода [имаписуппорт:: спулериелд](imapisupport-spooleryield.md) . 
  
Во время обработки сообщений между [иксплогон:: субмитмессаже](ixplogon-submitmessage.md) и [Иксплогон:: ендмессаже](ixplogon-endmessage.md) и во время [иксплогон:: стартмессаже](ixplogon-startmessage.md), поставщик транспорта, как правило, выполняет множество вызовов на объектах, предоставляемых диспетчером MAPI. В процессе обработки этих объектов, диспетчер очереди MAPI помогает поставщику транспорта правильно работать в фоновом режиме, выдавая его при необходимости. Поставщик транспорта, требующий обработки по крайней мере, может объявить критический раздел для диспетчера очереди MAPI с помощью метода [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) support Object. В этом случае ЦП высвобождается только на явных вызовах **спулериелд** поставщиком транспорта, пока поставщик транспорта не завершит обработку критической секции с другим вызовом **спулернотифи**.
  
> [!NOTE]
> Это не то же самое, что и критический раздел Win32. Это следует делать только в том случае, когда поставщик транспорта требует управления внешними ресурсами в режиме реального времени, например чтения входящих данных из строки факса. Так как это приводит к появлению приоритета обработки очереди MAPI и может привести к тому, что Рабочая станция не будет реагировать на длительность операции, рекомендуется уведомить пользователя о том, что выполнение потенциально длительного действия и подать индикатор выполнения, если это возможно. 
  

