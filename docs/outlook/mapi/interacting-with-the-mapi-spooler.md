---
title: Взаимодействие с пулером MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432151"
---
# <a name="interacting-with-the-mapi-spooler"></a>Взаимодействие с пулером MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Методы в интерфейсе [IXPLogon : IUnknown](ixplogoniunknown.md) используются пулером MAPI при вызове поставщика транспорта. Большинство типов поставщиков транспорта должны реализовывать большинство этих методов, чтобы они быстро возвращались. Это желательно, так как если метод возвращается длительное время, его следует разбить на вызовы к пуле MAPI, чтобы освободить ЦП для других задач. 
  
Пулер MAPI делает свою работу и вызывает поставщиков транспорта, когда приложения переднего плана простаивают. После дополнительного отображения диалоговых окна при первом входе поставщика транспорта в систему (управляется флагами, переданными из MAPI поставщику транспорта), поставщики транспорта работают в фоновом режиме, если клиент не вызвал их для очистки очередей отправки и получения. Очистка очередей — это единственный раз, когда поставщику транспорта не требуется освободить ЦП, а затем только в том случае, если пользователь получает информацию о том, что происходит потенциально длительное действие. Пулер MAPI обычно запрашивает у поставщика транспорта очистку очередей в ответ на действия пользователя, поэтому поставщику транспорта обычно не нужно ничего делать, чтобы пользователь был в курсе событий.
  
Поставщик транспорта может независимо принять решение очистить очередь и использовать биты STATUS_INBOUND_FLUSH и STATUS_OUTBOUND_FLUSH в свойстве **PR_STATUS_CODE** ([PidTagStatusCode)](pidtagstatuscode-canonical-property.md)строки состояния, чтобы сообщить пуле MAPI о том, что он хочет привлечь внимание, чтобы получить задание. Строка состояния обновляется с помощью метода [IMAPISupport::ModifyStatusRow.](imapisupport-modifystatusrow.md) В этом случае поставщик транспорта, вероятно, должен отобразить индикатор хода выполнения или другой интерфейс, чтобы сообщить пользователю о том, что происходит длительное действие. 
  
Поскольку сетевое действие часто занимает более 0,2 секунд, поставщики транспорта по возможности должны использовать асинхронные сетевые запросы. Это позволяет им инициировать запрос, освободить ЦП путем обратного вызова пула MAPI и, когда пул MAPI снова предоставляет им управление, чтобы проверить, выполнен ли сетевой запрос. Если это еще не завершено, ЦП снова освобождается путем обратного вызова пула MAPI с помощью метода [IMAPISupport::SpoolerYield.](imapisupport-spooleryield.md) 
  
Во время обработки сообщений между [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) и [IXPLogon::EndMessage](ixplogon-endmessage.md) и во время [IXPLogon::StartMessage](ixplogon-startmessage.md)поставщик транспорта обычно совершает множество вызовов объектов, которые ему представляются пулом MAPI. В рамках обработки этих объектов пул MAPI помогает поставщику транспорта вести себя надлежащим образом в фоновом процессе, когда это необходимо. Поставщик транспорта, которому требуется критически важная обработка, может объявить критический раздел для пула MAPI с помощью метода объекта поддержки [IMAPISupport::SpoolerNotify.](imapisupport-spoolernotify.md) В этом случае ЦП отпущен только для явных вызовов **SpoolerYield** поставщиком транспорта, пока поставщик транспорта не завершит обработку критических разделов с помощью другого вызова **SpoolerNotify.**
  
> [!NOTE]
> Это не то же самое, что критический раздел Win32. Это следует делать только в том случае, если поставщику транспорта требуется контроль внешних ресурсов в режиме реального времени, таких как чтение входящих данных из факс-линии. Так как это повышает приоритет процесса пула MAPI и может привести к тому, что рабочие станции не будут действовать в течение всего периода выполнения операции, следует уведомить пользователя о том, что происходит потенциально длительное действие, и по возможности предоставить индикатор хода выполнения. 
  

