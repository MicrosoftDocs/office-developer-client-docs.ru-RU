---
title: Взаимодействие с системой буферизации MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: faf3d48b63d1858a2b91f66c83d9ce08e9daa02b
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19809446"
---
# <a name="interacting-with-the-mapi-spooler"></a>Взаимодействие с системой буферизации MAPI

  
  
**Относится к**: Outlook 
  
Методы в [IXPLogon: IUnknown](ixplogoniunknown.md) интерфейс используемые диспетчер очереди MAPI при вызове поставщика транспорта. Возможно, для большинства поставщиков транспорта для реализации большая часть этих методов, чтобы быстро вернуть. Это желательно, поскольку если метод принимает много времени для возвращения нажмите его следует выделить со звонками обратно в диспетчер очереди MAPI для освобождения ЦП для других задач. 
  
Диспетчер очереди MAPI работы и делает его вызовы поставщиками транспорта, если приложения переднего плана, простоя. После отображения диалоговых окон, при необходимости для зарегистрированного поставщика транспорта сначала (управляется флаги, передаваемые из интерфейса MAPI для поставщика транспорта), поставщиками транспорта работать в фоновом режиме до вызова клиентом для очистки отправки и получения очереди. Очистка очереди имеет только один раз, что поставщик транспорта не требует освобождения ЦП, а затем только в том случае, если пользователь уведомляется о том, что потенциально длинный действие находится в стадии разработки. Диспетчер очереди MAPI обычно запрашивает, что поставщик транспорта Очистка очереди в ответ на действия пользователя, поставщика транспорта обычно не требуется выполнять любые действия, чтобы убедиться, что пользователь получает сведения.
  
Служба транспорта независимо друг от друга может принять очистки очереди и использовать биты STATUS_INBOUND_FLUSH и STATUS_OUTBOUND_FLUSH в свойстве **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) его состояние строки для оповещения диспетчер очереди MAPI, который он хочет внимание, что он может выполнить необходимые действия. В строке состояния обновляется с помощью метода [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) . В этом случае поставщика транспорта, вероятно, должны отображать индикатор хода выполнения или других интерфейс для оповещения пользователя, что много действие является отмену. 
  
Так как часто сети занимает более 0,2 секунд, поставщиками транспорта по возможности использовать асинхронный сетевой запрос. Это позволяет их инициировать запрос, отмены Процессора с помощью обратного вызова в очередь MAPI и диспетчер очереди MAPI еще раз дает им элемента управления, чтобы проверить, если их сетевой запрос завершен. Если он еще не завершен, они еще раз отмены Процессора с помощью обратного вызова в очередь MAPI с помощью метода [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) . 
  
Во время обработки между [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) и [IXPLogon::EndMessage](ixplogon-endmessage.md) и во время [IXPLogon::StartMessage](ixplogon-startmessage.md)сообщения поставщика транспорта обычно вызывает много объектов, предоставляемые диспетчер очереди MAPI. В процессе обработки этих объектов диспетчер очереди MAPI помогает поставщика транспорта надлежащим образом работать в фоновом путем получения самостоятельно при необходимости. Поставщика транспорта, требующие срочных обработки можно объявить критический раздел очереди MAPI, с помощью метода [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) поддержки объектов. В этом случае ЦП освобождается только на явных вызовов **SpoolerYield** поставщиком транспорта до завершения обработки с другой вызов **SpoolerNotify**критический раздел поставщика транспорта.
  
> [!NOTE]
> Это не то же, что критического раздела Win32. Это должно осуществляться только в том случае, когда поставщика транспорта необходимо в режиме реального времени управлять внешним ресурсам, например чтение входящих данных из строки факс. Поскольку это повышение приоритета процесса очереди MAPI и может привести к рабочей станции не реагирует во время выполнения операции, рекомендуется уведомления пользователя об потенциально длинный действие выполняется и предоставляют индикатор выполнения, если это возможно. 
  

