---
title: Взаимодействие с системой буферизации MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: c8032172ef19fbb01af68058b2e0255e269183a8
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22587896"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="1caa2-103">Взаимодействие с системой буферизации MAPI</span><span class="sxs-lookup"><span data-stu-id="1caa2-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="1caa2-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="1caa2-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="1caa2-105">Методы в [IXPLogon: IUnknown](ixplogoniunknown.md) интерфейс используемые диспетчер очереди MAPI при вызове поставщика транспорта.</span><span class="sxs-lookup"><span data-stu-id="1caa2-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="1caa2-106">Возможно, для большинства поставщиков транспорта для реализации большая часть этих методов, чтобы быстро вернуть.</span><span class="sxs-lookup"><span data-stu-id="1caa2-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="1caa2-107">Это желательно, поскольку если метод принимает много времени для возвращения нажмите его следует выделить со звонками обратно в диспетчер очереди MAPI для освобождения ЦП для других задач.</span><span class="sxs-lookup"><span data-stu-id="1caa2-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="1caa2-108">Диспетчер очереди MAPI работы и делает его вызовы поставщиками транспорта, если приложения переднего плана, простоя.</span><span class="sxs-lookup"><span data-stu-id="1caa2-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="1caa2-109">После отображения диалоговых окон, при необходимости для зарегистрированного поставщика транспорта сначала (управляется флаги, передаваемые из интерфейса MAPI для поставщика транспорта), поставщиками транспорта работать в фоновом режиме до вызова клиентом для очистки отправки и получения очереди.</span><span class="sxs-lookup"><span data-stu-id="1caa2-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="1caa2-110">Очистка очереди имеет только один раз, что поставщик транспорта не требует освобождения ЦП, а затем только в том случае, если пользователь уведомляется о том, что потенциально длинный действие находится в стадии разработки.</span><span class="sxs-lookup"><span data-stu-id="1caa2-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="1caa2-111">Диспетчер очереди MAPI обычно запрашивает, что поставщик транспорта Очистка очереди в ответ на действия пользователя, поставщика транспорта обычно не требуется выполнять любые действия, чтобы убедиться, что пользователь получает сведения.</span><span class="sxs-lookup"><span data-stu-id="1caa2-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="1caa2-112">Служба транспорта независимо друг от друга может принять очистки очереди и использовать биты STATUS_INBOUND_FLUSH и STATUS_OUTBOUND_FLUSH в свойстве **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) его состояние строки для оповещения диспетчер очереди MAPI, который он хочет внимание, что он может выполнить необходимые действия.</span><span class="sxs-lookup"><span data-stu-id="1caa2-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="1caa2-113">В строке состояния обновляется с помощью метода [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="1caa2-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="1caa2-114">В этом случае поставщика транспорта, вероятно, должны отображать индикатор хода выполнения или других интерфейс для оповещения пользователя, что много действие является отмену.</span><span class="sxs-lookup"><span data-stu-id="1caa2-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="1caa2-115">Так как часто сети занимает более 0,2 секунд, поставщиками транспорта по возможности использовать асинхронный сетевой запрос.</span><span class="sxs-lookup"><span data-stu-id="1caa2-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="1caa2-116">Это позволяет их инициировать запрос, отмены Процессора с помощью обратного вызова в очередь MAPI и диспетчер очереди MAPI еще раз дает им элемента управления, чтобы проверить, если их сетевой запрос завершен.</span><span class="sxs-lookup"><span data-stu-id="1caa2-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="1caa2-117">Если он еще не завершен, они еще раз отмены Процессора с помощью обратного вызова в очередь MAPI с помощью метода [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) .</span><span class="sxs-lookup"><span data-stu-id="1caa2-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="1caa2-118">Во время обработки между [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) и [IXPLogon::EndMessage](ixplogon-endmessage.md) и во время [IXPLogon::StartMessage](ixplogon-startmessage.md)сообщения поставщика транспорта обычно вызывает много объектов, предоставляемые диспетчер очереди MAPI.</span><span class="sxs-lookup"><span data-stu-id="1caa2-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="1caa2-119">В процессе обработки этих объектов диспетчер очереди MAPI помогает поставщика транспорта надлежащим образом работать в фоновом путем получения самостоятельно при необходимости.</span><span class="sxs-lookup"><span data-stu-id="1caa2-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="1caa2-120">Поставщика транспорта, требующие срочных обработки можно объявить критический раздел очереди MAPI, с помощью метода [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) поддержки объектов.</span><span class="sxs-lookup"><span data-stu-id="1caa2-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="1caa2-121">В этом случае ЦП освобождается только на явных вызовов **SpoolerYield** поставщиком транспорта до завершения обработки с другой вызов **SpoolerNotify**критический раздел поставщика транспорта.</span><span class="sxs-lookup"><span data-stu-id="1caa2-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="1caa2-122">Это не то же, что критического раздела Win32.</span><span class="sxs-lookup"><span data-stu-id="1caa2-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="1caa2-123">Это должно осуществляться только в том случае, когда поставщика транспорта необходимо в режиме реального времени управлять внешним ресурсам, например чтение входящих данных из строки факс.</span><span class="sxs-lookup"><span data-stu-id="1caa2-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="1caa2-124">Поскольку это повышение приоритета процесса очереди MAPI и может привести к рабочей станции не реагирует во время выполнения операции, рекомендуется уведомления пользователя об потенциально длинный действие выполняется и предоставляют индикатор выполнения, если это возможно.</span><span class="sxs-lookup"><span data-stu-id="1caa2-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

