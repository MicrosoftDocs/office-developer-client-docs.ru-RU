---
title: Использование потокобезопасных объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e688db5e-d1a1-4afc-998f-b3d31eb6239b
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 4a66f892043b9a90893a60f3fa6ba69ea6457f5a
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19812600"
---
# <a name="using-thread-safe-objects"></a>Использование потокобезопасных объектов

  
  
**Относится к**: Outlook 
  
Клиентские приложения можно допустить, что объекты непосредственно или как обратные вызовы всегда являются потокобезопасными за исключением в следующих случаях:
  
- Объект состояния поставщика транспорта получить с помощью клиента вызов [IMAPISession::OpenEntry](imapisession-openentry.md) с идентификатором записи из строки состояния таблицы поставщика. 
    
- Получить с помощью вызова клиента [MAPIOpenFormMgr](mapiopenformmgr.md)все объекты формы MAPI. Объекты формы соблюдать правила модели подразделения и клиенты должны использовать их и все объекты, содержащиеся в них только в потоке, создавшего их.
    
При обращении поставщика транспорта строки в таблице состояния, которая включает в себя идентификатор записи объекта связанного состояния, клиент может вызывать **OpenEntry** с этим идентификатором записи для открытия объекта состояния. Этот объект состояния не являющихся потокобезопасными, так как поставщики транспорта выполняться в контексте диспетчер очереди MAPI и не поддерживать отдельные контекста для их состояние объекта. Состояние объекта подчиняется правилам модели подразделения и клиенты должны использовать только в потоке, который он был создан. 
  
Перед использованием любых объектов MAPI и [MAPIUninitialize](mapiuninitialize.md) после завершения, в которых используется клиентом необходимо вызвать в на каждый поток [MAPIInitialize](mapiinitialize.md) . Эти вызовы следует выполнить даже в том случае, если объекты для использования в систему, передаются в поток из внешнего источника. **MAPIInitialize** и **MAPIUninitialize** могут вызываться из в любом месте за исключением из в функцию Win32 **DllMain** , функция, которая вызывается системой при процессы и потоки инициализируется и завершен или при вызовы ** LoadLibrary** и функции **FreeLibrary** . 
  
Косвенные использовать объекты должны никогда не оценивается в являющихся потокобезопасными. Косвенные использования объектов, методов, которые требуют указателей интерфейса назначения в качестве входных параметров. Примеры таких методов, **IMAPIProp::CopyTo** и **CopyProps**, **IMAPIFolder::CopyFolder** и **CopyMessage**и **IMsgServiceAdmin::CopyMsgService**. Если поставщик услуг хочет вызов такой объект из потока, отличного от того, для которого был передан, поставщик несет ответственность за явно маршалинга объекта.
  

