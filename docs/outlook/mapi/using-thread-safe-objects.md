---
title: Использование потокобезопасных объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e688db5e-d1a1-4afc-998f-b3d31eb6239b
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 611e0a49f0fd8df8fe40205a33ed5501055c3d45
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32329591"
---
# <a name="using-thread-safe-objects"></a>Использование потокобезопасных объектов

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения могут предполагать, что объекты, которые использовались напрямую или как обратные вызовы, всегда являются потокобезопасными, за исключением следующих случаев:
  
- Объект состояния поставщика транспорта, полученный через клиентский вызов [IMAPISession:: OpenEntry](imapisession-openentry.md) с идентификатором записи из строки таблицы состояния поставщика. 
    
- Все объекты форм MAPI, полученные с помощью клиентского вызова в [мапиопенформмгр](mapiopenformmgr.md). Объекты форм следует использовать для правил и клиентов апартаментной модели, а также все объекты, которые они содержат, только в создавшем их потоке.
    
Когда клиент получает доступ к строке поставщика транспорта в таблице status, включающей идентификатор связанного объекта status, клиент может вызвать **OpenEntry** с этим идентификатором записи, чтобы открыть объект Status. Этот объект Status не является потокобезопасным, так как поставщики транспорта работают в контексте диспетчера очереди MAPI и не сохраняют отдельный контекст для своего объекта Status. Объект Status подчиняется правилам, связанным с апартаментной моделью, и клиенты должны использовать его только в создавшем его потоке. 
  
Кроме того, клиент должен вызвать [мапиинитиализе](mapiinitialize.md) для каждого потока перед использованием любых объектов MAPI и [мапиунинитиализе](mapiuninitialize.md) при завершении использования. Эти вызовы должны быть сделаны, даже если используемые объекты передаются в поток из внешнего источника. **Мапиинитиализе** и **мапиунинитиализе** можно вызывать из любого места за исключением того, что в функции Win32 **DllMain** функция, вызываемая системой при инициализации и завершении процессов и потоков, а также при вызовах ** Функции LoadLibrary** и **FreeLibrary** . 
  
Никогда не следует предполагать, что объекты косвенного использования не являются потокобезопасными. Объекты косвенного использования возвращаются методами, которые потребуют указателей конечного интерфейса в качестве входных параметров. Примеры таких методов **: IMAPIProp:: CopyTo** и **копипропс**, **IMAPIFolder:: CopyFolder** и **копимессаже**и **имсгсервицеадмин:: копимсгсервице**. Если поставщик услуг хочет вызвать такой объект из потока, отличного от того, в котором он был передан, поставщик несет ответственность за явное маршалирование объекта.
  

