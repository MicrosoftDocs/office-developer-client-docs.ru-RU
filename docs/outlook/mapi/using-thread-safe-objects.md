---
title: Использование Thread-Safe объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e688db5e-d1a1-4afc-998f-b3d31eb6239b
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 611e0a49f0fd8df8fe40205a33ed5501055c3d45
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33425171"
---
# <a name="using-thread-safe-objects"></a>Использование Thread-Safe объектов

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения могут предполагать, что объекты, используемые напрямую или в качестве вызовов, всегда потокобезопасны, за исключением следующих случаев:
  
- Объект состояния поставщика транспорта, полученный с помощью клиентского вызова [IMAPISession::OpenEntry](imapisession-openentry.md) с идентификатором записи из строки таблицы состояния поставщика. 
    
- Все объекты форм MAPI, полученные с помощью клиентского вызова [MAPIOpenFormMgr.](mapiopenformmgr.md) Объекты форм подчиняются правилам модели apartment, и клиенты должны использовать их и все объекты, содержащиеся в них, только в потоке, который их создал.
    
Когда клиент получает доступ к строке поставщика транспорта в таблице состояния, которая содержит идентификатор записи связанного объекта состояния, клиент может вызвать **OpenEntry** с этим идентификатором записи, чтобы открыть объект состояния. Этот объект состояния не потокобезопасн, так как поставщики транспорта работают в контексте пула MAPI и не поддерживают отдельный контекст для своего объекта состояния. Объект состояния подчиняется правилам модели apartment, и клиенты должны использовать его только в созданном потоке. 
  
Клиент также должен вызывать [MAPIInitialize в каждом](mapiinitialize.md) потоке, прежде чем использовать объекты MAPI и [MAPIUninitialize](mapiuninitialize.md) после завершения этого использования. Эти вызовы следует делать даже в том случае, если используемые объекты передаются в поток из внешнего источника. **MAPIInitialize** и **MAPIUninitialize** можно вызывать из любого места, за исключением функции **Win32 DllMain,** функции, вызываемой системой при инициализации и завершении процессов и потоков, а также при вызовах функций **LoadLibrary** и **FreeLibrary.** 
  
Объекты непрямого использования никогда не должны считаться потокобезопасными. Объекты непрямого использования возвращаются методами, которые требуют указателей интерфейса назначения в качестве входных параметров. Примеры таких **методов: IMAPIProp::CopyTo** и **CopyProps,** **IMAPIFolder::CopyFolder** и **CopyMessage** и **IMsgServiceAdmin::CopyMsgService**. Если поставщик службы хочет вызвать такой объект из потока, который не является тем, в котором он был передан, поставщик несет ответственность за явное маршалинг объекта.
  

