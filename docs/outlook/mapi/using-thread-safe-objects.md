---
title: Использование Thread-Safe объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e688db5e-d1a1-4afc-998f-b3d31eb6239b
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 611e0a49f0fd8df8fe40205a33ed5501055c3d45
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33425171"
---
# <a name="using-thread-safe-objects"></a>Использование Thread-Safe объектов

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения могут предположить, что объекты, используемые напрямую или в качестве откатов, всегда безопасны для потоков, за исключением следующих случаев:
  
- Объект состояния поставщика транспорта, полученный в результате клиентского вызова [в IMAPISession::OpenEntry](imapisession-openentry.md) с идентификатором входа из строки таблицы состояния поставщика. 
    
- Все объекты формы MAPI, полученные с помощью клиентского вызова [в MAPIOpenFormMgr.](mapiopenformmgr.md) Объекты форм подчиняются правилам модели квартиры, и клиенты должны использовать их и все объекты, содержащиеся в них, только в созданном ими потоке.
    
Когда клиент получает доступ к строке поставщика транспорта в таблице состояния, которая включает идентификатор входа связанного объекта состояния, клиент может вызвать **OpenEntry** с этим идентификатором входа, чтобы открыть объект состояния. Этот объект состояния не является безопасным для потоков, так как поставщики транспорта работают в контексте пулера MAPI и не поддерживают отдельный контекст для объекта состояния. Объект состояния подчиняется правилам модели квартиры, и клиенты должны использовать его только в созданном потоке. 
  
Клиент также должен вызывать [MAPIInitialize](mapiinitialize.md) на каждом потоке, прежде чем использовать любые объекты MAPI и [MAPIUninitialize,](mapiuninitialize.md) когда это использование будет завершено. Эти вызовы должны быть сделаны, даже если используемые объекты передаются потоку из внешнего источника. **MAPIInitialize** и **MAPIUninitialize** можно вызывать из любого места, за исключением функции Win32 **DllMain,** функции, вызываемой системой при инициализации и прекращении процессов и потоков, или при вызовах функций **LoadLibrary** и **FreeLibrary.** 
  
Объекты косвенного использования никогда не должны считаться безопасными для потоков. Объекты косвенного использования возвращаются методами, которые требуют указателей интерфейса назначения в качестве параметров ввода. Примерами таких методов являются **IMAPIProp::CopyTo** и **CopyProps,** **IMAPIFolder::CopyFolder** и **CopyMessage** и **IMsgServiceAdmin::CopyMsgService**. Если поставщик службы хочет вызвать такой объект из потока, за исключением того, на котором он был передан, поставщик несет ответственность за явное маршалинг объекта.
  

