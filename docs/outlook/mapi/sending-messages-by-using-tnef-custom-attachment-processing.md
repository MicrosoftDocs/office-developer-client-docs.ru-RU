---
title: Отправка сообщений с использованием настраиваемой обработки вложений TNEF
manager: soliver
ms.date: 12/07/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: da318b6f-128a-44b5-8357-a130022030a1
description: 'Дата последнего изменения: 7 декабря 2015 года'
ms.openlocfilehash: f9d154b26319f5ed72b1abd6aeef307d07a63bda
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25388569"
---
# <a name="sending-messages-by-using-tnef-custom-attachment-processing"></a>Отправка сообщений с использованием настраиваемой обработки вложений TNEF

 
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Для настройки обработки вложений при отправке сообщения:
  
1. Получение объекта TNEF, передав интерфейс **IStream** и сообщение в функцию [OpenTnefStreamEx](opentnefstreamex.md) . 
    
2. Получите список всех свойств, определенных для сообщения путем вызова метода [IMAPIProp::GetPropList](imapiprop-getproplist.md) . 
    
3. Используйте методы [IMAPIProp](imapipropiunknown.md) , чтобы исключить все свойства, поддерживаемые системой обмена сообщениями. Во время записи этих свойств в систему обмена сообщениями в формате, необходимые для системы обмена сообщениями. 
    
4. Вызовите метод [ITnef::AddProps](itnef-addprops.md) для добавления только свойства в окне сообщения — то есть, ни одно из свойств на вложения, установив для флага TNEF_PROP_MESSAGE_ONLY. 
    
5. Вызовите [ITnef::AddProps](itnef-addprops.md) с этих элементов: флаг TNEF_PROP_EXCLUDE, массив тега свойства, который содержит **PR_ATTACH_DATA_BIN** ([PidTagAttachDataBinary](pidtagattachdatabinary-canonical-property.md)) или **PR_ATTACH_DATA_OBJ** ([PidTagAttachDataObject](pidtagattachdataobject-canonical-property.md)) свойство и идентификатор вложения, указывающее вложений для обработки.
    
6. Метод [ITnef::SetProps](itnef-setprops.md) используется для добавления тега свойства **PR_ATTACH_TRANSPORT_NAME** ([PidTagAttachTransportName](pidtagattachtransportname-canonical-property.md)) с уникальная строка, которая идентифицирует вложения в системе обмена сообщениями, если вложение содержит имя файла, который не поддерживает системы обмена сообщениями. Например несколько вложений с тем же именем исходного файла или имени файла, который не является допустимым именем файла для системы обмена сообщениями. Эта строка будет использоваться с номер ключа при записи теги вложений в текст с тегами сообщения для связи с данными вложения. Дополнительные сведения см., [TNEF-Tagged текста сообщения](tnef-tagged-message-text.md).
    
7. Повторите **AddProps** и **SetProps** звонков для каждого вложения. 
    
8. Вызовите метод [ITnef::Finish](itnef-finish.md) для кодирования сообщений в поток TNEF после добавления все запрошенные свойства. 
    
9. Получает текст с тегами сообщения путем вызова метода [ITnef::OpenTaggedBody](itnef-opentaggedbody.md) . Этот текст с тегами считываются с помощью методов из интерфейса **IStream** , кодируются с помощью модели вложения системе обмена сообщениями и записывается в системе обмена сообщениями. 
    
10. Вызовите метод [функции IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) для освобождения объекта [ITnef](itnefiunknown.md) . 
    
11. Написание оставшихся вложения в системе обмена сообщениями через модель вложения системе обмена сообщениями.
    
Поставщика транспорта следует использовать уже было сказано процедуру, чтобы процесс вложения. Если это невозможно, поставщика транспорта следует использовать следующие шаги для обработки настраиваемых вложений:
  
1. Поставщика транспорта гарантирует, что свойства **PR_ATTACH_TRANSPORT_NAME** всех вложений содержит уникальные значения, которые являются идентификаторы допустимого вложения для системы обмена сообщениями. 
    
2. Поставщика транспорта затем использует один вызов **ITnef::AddProps** для каждого вложения, передав в флаг TNEF_PROP_CONTAINED. 
    

