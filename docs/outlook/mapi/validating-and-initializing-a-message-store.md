---
title: Проверка и инициализация магазина сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 74f0a1fe-2a79-4b32-ab88-85a8839a2639
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 77b3f707fc36a868de5acd7c7ba4642a1da4e3c9
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433691"
---
# <a name="validating-and-initializing-a-message-store"></a>Проверка и инициализация магазина сообщений

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Когда вы открываете хранилище сообщений с помощью метода [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) без установки флага MDB_NO_MAIL, MAPI создает несколько папок и назначает им имена и роли по умолчанию. MAPI отвечает за создание этих папок, чтобы избежать несовместимости, которая неизбежно возникает, если за создание отвечали клиенты или поставщики магазинов сообщений. 
  
Иногда необходимо убедиться, что соответствующие папки созданы и являются допустимы. Для [этого доступна функция HrValidateIPMSubtree.](hrvalidateipmsubtree.md) Если вы проходите проверку магазина сообщений по умолчанию, передай MAPI_FULL_IPM_TREE флаг. Для магазина сообщений по умолчанию создается более обширная группа папок. Когда **hrValidateIPMSubtree** получает флаг MAPI_FULL_IPM_TREE, он проверяет следующие папки: 
  
- Корневая папка для подтриба IPM
    
- Папка "Удаленные элементы" в корневой папке IPM
    
- Папка "Входящие" в корневой папке IPM
    
- Папка "Outbox" в корневой папке IPM
    
- Папка Отправленные элементы в корневой папке IPM
    
- Представления папок в корневой папке магазина сообщений
    
- Общие представления в корневой папке магазина сообщений
    
- Папка поиска в корневой папке магазина сообщений
    
Если хранилище сообщений не является по умолчанию, можно установить или MAPI_FULL_IPM_TREE флаг. Если этот флаг не задан, **HrValidateIPMSubtree** проверяет только корневую папку для подтрия, папку Удаленные элементы и корневую папку для результатов поиска в хранилище сообщений. 
  
Чтобы инициализировать хранилище сообщений, храните следующие свойства в памяти, чтобы они были легко доступны:
  
- **PR_VALID_FOLDER_MASK** [(PidTagValidFolderMask](pidtagvalidfoldermask-canonical-property.md))
    
- **PR_STORE_SUPPORT_MASK** [(PidTagStoreSupportMask)](pidtagstoresupportmask-canonical-property.md)
    
Эти свойства — битмаски, описывая функции магазина сообщений. **PR_VALID_FOLDER_MASK** имеет один бит для каждой специальной папки, которая существует в хранилище сообщений, и имеет допустимый идентификатор записи. Дополнительные сведения о доступе к этим папкам и их идентификаторам записей см. в документе [Opening a Message Store Folder.](opening-a-message-store-folder.md) 
  
 **PR_STORE_SUPPORT_MASK** имеет один бит для каждой функции, поддерживаемой в хранилище сообщений. Например, если хранилище сообщений поддерживает уведомление и  форматированный текст, PR_STORE_SUPPORT_MASK его STORE_NOTIFY_OK и STORE_RTF_OK битов. 
  
Другие свойства, которые должны храниться локально, включают идентификаторы записей для папок, **которые** свойство PR_VALID_FOLDER_MASK описывает как допустимые. Каждая из этих специальных папок, за исключением папки "Входящие", имеет свойство идентификатора входа, связанное с ним. Например, идентификатор входа для папки "Избокс" — это **свойство** [PR_IPM_OUTBOX_ENTRYID (PidTagIpIpmOutboxEntryId).](pidtagipmoutboxentryid-canonical-property.md) Поскольку эти папки являются папками, которые будут открываться часто, лучше иметь их идентификаторы записи легко доступны.
  

