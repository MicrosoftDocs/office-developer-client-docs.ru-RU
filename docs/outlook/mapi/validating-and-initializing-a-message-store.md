---
title: Проверка и инициализация магазина сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 74f0a1fe-2a79-4b32-ab88-85a8839a2639
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 77b3f707fc36a868de5acd7c7ba4642a1da4e3c9
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433691"
---
# <a name="validating-and-initializing-a-message-store"></a>Проверка и инициализация магазина сообщений

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Когда вы открываете хранилище сообщений с помощью метода [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) без установки флага MDB_NO_MAIL, MAPI создает несколько папок и назначает им имена и роли по умолчанию. MAPI отвечает за создание этих папок, чтобы избежать несовместимостей, которые неизбежно возникнут, если за создание отвечает клиенты или поставщики store сообщений. 
  
Иногда необходимо проверить, созданы ли соответствующие папки и являются ли они действительными. Функция [HrValidateIPMSubtree](hrvalidateipmsubtree.md) доступна для этой цели. При проверке стандартного хранения сообщений передай флаг MAPI_FULL_IPM_TREE сообщений. Для хранения сообщений по умолчанию создается более широкая группа папок. Когда **HrValidateIPMSubtree** получает флаг MAPI_FULL_IPM_TREE, он проверяет наличие следующих папок: 
  
- Корневая папка для поддерево IPM
    
- Папка "Удаленные" в корневой папке IPM
    
- Папка "Входящие" в корневой папке IPM
    
- Папка "Outbox" в корневой папке IPM
    
- Папка "Отправленные" в корневой папке IPM
    
- Представления папок в корневой папке хранения сообщений
    
- Общие представления в корневой папке хранения сообщений
    
- Папка поиска в корневой папке хранения сообщений
    
Если хранилище сообщений не является хранилищем по умолчанию, вы можете установить или не установить флаг MAPI_FULL_IPM_TREE сообщений. Если этот флаг не установлен, **HrValidateIPMSubtree** проверяет только корневую папку для поддерева, папку "Удаленные" и корневую папку для результатов поиска в хранилище сообщений. 
  
Чтобы инициализировать хранилище сообщений, храните в памяти следующие свойства, чтобы они были доступны:
  
- **PR_VALID_FOLDER_MASK** ([PidTagValidFolderMask)](pidtagvalidfoldermask-canonical-property.md)
    
- **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask)](pidtagstoresupportmask-canonical-property.md)
    
Эти свойства являются битами, которые описывают функции хранения сообщений. **PR_VALID_FOLDER_MASK** имеет один бит для каждой специальной папки, которая существует в хранилище сообщений, и имеет действительный идентификатор назначенной записи. Дополнительные сведения о доступе к этим папок и их идентификаторам записей см. в открываемой папке [магазина сообщений.](opening-a-message-store-folder.md) 
  
 **PR_STORE_SUPPORT_MASK** каждый из функций, поддерживаемых в хранилище сообщений, имеет по одному биту. Например, если хранилище сообщений поддерживает уведомление и  форматированный текст, PR_STORE_SUPPORT_MASK его STORE_NOTIFY_OK и STORE_RTF_OK биты. 
  
Другие свойства, которые должны храниться локально, включают идентификаторы записей для папок, **которые** свойство PR_VALID_FOLDER_MASK как допустимые. Каждая из этих специальных папок, кроме папки "Входящие", имеет связанное с ней свойство идентификатора записи. Например, идентификатором записи для папки "Outbox" является свойство **PR_IPM_OUTBOX_ENTRYID** ([PidTagIpmOutboxEntryId).](pidtagipmoutboxentryid-canonical-property.md) Так как эти папки являются папками, которые будут открываться часто, лучше, чтобы их идентификаторы записей были легко доступны.
  

