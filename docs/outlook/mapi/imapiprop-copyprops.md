---
title: Имапипропкопипропс
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIProp.CopyProps
api_type:
- COM
ms.assetid: f65da1c8-d49b-44e8-8c66-9c53d088d334
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 7319f1abb4a74ee17b0a4a1220215c29434d256b
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32345509"
---
# <a name="imapipropcopyprops"></a>IMAPIProp::CopyProps

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Копирование или перемещение выбранных свойств. 
  
```cpp
HRESULT CopyProps(
  LPSPropTagArray lpIncludeProps,
  ULONG_PTR ulUIParam,
  LPMAPIPROGRESS lpProgress,
  LPCIID lpInterface,
  LPVOID lpDestObj,
  ULONG ulFlags,
  LPSPropProblemArray FAR * lppProblems
);
```

## <a name="parameters"></a>Параметры

 _Лпинклудепропс_
  
> возврата Указатель на массив тегов свойств, указывающий свойства, которые необходимо скопировать или переместить. **Пр_нулл** ([PidTagNull](pidtagnull-canonical-property.md)) невозможно включить в массив. Параметр _лпинклудепропс_ не может иметь **значение NULL**.
    
 _Улуипарам_
  
> возврата Дескриптор родительского окна индикатора хода выполнения. 
    
 _Лппрогресс_
  
> возврата Указатель на реализацию индикатора хода выполнения. Если в параметре _лппрогресс_ передается **значение NULL** , индикатор хода выполнения отображается с помощью реализации MAPI. Параметр _лппрогресс_ игнорируется, если не установлен флаг мапи_диалог в параметре _ulFlags_ . 
    
 _Лпинтерфаце_
  
> возврата Указатель на идентификатор интерфейса (IID), представляющий интерфейс, который должен использоваться для доступа к объекту, на который указывает параметр _лпдестобж_ . Параметр _лпинтерфаце_ не должен иметь **значение NULL**.
    
 _Лпдестобж_
  
> возврата Указатель на объект, который будет получать скопированные или перемещенные свойства.
    
 _ulFlags_
  
> возврата Битовая маска флагов, управляющих операциями копирования или перемещения. Можно задать следующие флаги:
    
МАПИ_ДЕКЛИНЕ_ОК 
  
> Если **копипропс** вызывает метод [Имаписуппорт::D окопипропс](imapisupport-docopyprops.md) для обработки операции копирования или перемещения, он должен вместо этого возвращаться сразу со значением ошибки мапи_е_деклине_копи. Чтобы ограничить рекурсию, установите флаг МАПИ_ДЕКЛИНЕ_ОК MAPI. Клиенты не устанавливают этот флаг. 
    
МАПИ_ДИАЛОГ 
  
> Отображает индикатор хода выполнения.
    
МАПИ_МОВЕ 
  
> **Копипропс** должен выполнять операцию перемещения, а не операцию копирования. Если этот флаг не задан, **копипропс** выполняет операцию копирования. 
    
МАПИ_НОРЕПЛАЦЕ 
  
> Существующие свойства в целевом объекте не должны быть перезаписаны. Если этот флаг не задан, **копипропс** перезаписывает существующие свойства. 
    
 _Лпппроблемс_
  
> [вход, выход] На входе указатель на указатель на структуру [спроппроблемаррай](spropproblemarray.md) ; в противном случае — **значение NULL**, указывающее, что нет необходимости в сведениях об ошибке. Если _лпппроблемс_ является допустимым указателем на входе, **копипропс** возвращает подробные сведения об ошибках при копировании одного или нескольких свойств. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Свойства успешно скопированы или перемещены.
    
МАПИ_Е_КОЛЛИСИОН 
  
> Невозможно скопировать подобъект, так как в целевом объекте уже существует с таким же отображаемым именем, определенный свойством **пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)). 
    
МАПИ_Е_ДЕКЛИНЕ_КОПИ 
  
> Поставщик услуг не реализует операцию копирования.
    
МАПИ_Е_ФОЛДЕР_ЦИКЛЕ 
  
> Исходный объект, выполняющий операцию копирования или перемещения напрямую или косвенно, содержит целевой объект. Прежде чем было обнаружено это условие, можно выполнить значительную работу, чтобы исходный и конечный объекты могли быть изменены частично. 
    
МАПИ_Е_ИНТЕРФАЦЕ_НОТ_СУППОРТЕД 
  
> Интерфейс, определенный параметром _лпинтерфаце_ , не поддерживается целевым объектом. 
    
МАПИ_Е_НО_АКЦЕСС 
  
> Предпринята попытка получить доступ к объекту, для которого вызывающая сторона не имеет достаточных разрешений. Эта ошибка возвращается, если целевой объект совпадает с исходным объектом.
    
Следующие значения могут возвращаться в структуре **спроппроблемаррай** , но не в качестве возвращаемых значений для **копипропс**. Эти ошибки относятся к одному свойству.
  
МАПИ_Е_БАД_ЧАРВИДС 
  
> Установлен либо флаг МАПИ_УНИКОДЕ, либо **копипропс** не поддерживает Юникод, или мапи_уникоде не задано и **Копипропс** поддерживает только Юникод. 
    
МАПИ_Е_КОМПУТЕД 
  
> Абонент не может изменить свойство, так как оно является свойством только для чтения, которое вычисляется владельцем целевого объекта. Эта ошибка не серьезна; вызывающая сторона должна разрешить продолжение операции копирования.
    
МАПИ_Е_ИНВАЛИД_ТИПЕ 
  
> Недопустимый тип свойства.
    
МАПИ_Е_УНЕКСПЕКТЕД_ТИПЕ 
  
> Тип свойства не является типом, ожидаемым вызывающим абонентом.
    
## <a name="remarks"></a>Комментарии

Метод **IMAPIProp:: копипропс** копирует или перемещает выбранные свойства из текущего объекта в целевой объект. **Копипропс** используется в основном для ответа и пересылки сообщений, в которых только некоторые свойства из исходного сообщения передаются вместе с ответом или с переадресованной копией. 
  
Любые подобъекты в исходном объекте автоматически включаются в операцию и копируются или перемещаются целиком, независимо от использования свойств, указанных в структуре [спроптагаррай](sproptagarray.md) . По умолчанию **копипропс** перезаписывает все свойства в целевом объекте, которые совпадают со свойствами исходного объекта. Если какие-либо из скопированных или перемещенных свойств уже существуют в целевом объекте, существующие свойства перезаписываются новыми свойствами, если в параметре _ulFlags_ не задано значение флага мапи_нореплаце. Существующие сведения в целевом объекте, которые не перезаписываются, остаются нетронутыми. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Вы можете предоставить полную реализацию **копипропс** или использовать реализацию MAPI в своем объекте поддержки. Если вы хотите использовать реализацию MAPI, вызовите метод **имаписуппорт::D окопипропс** . Тем не менее, если вы выполняете обработку делегата в **докопипропс** и вы передали флаг мапи_деклине_ок, избегайте вызова поддержки и возврата мапи_е_деклине_копи вместо этого. Этот флаг будет вызываться с помощью MAPI, чтобы избежать возможной рекурсии, которая может возникнуть при копировании папок. 
  
Так как операция копирования может быть длительной, необходимо отобразить индикатор хода выполнения. Используйте реализацию [IMAPIProgress](imapiprogressiunknown.md) , которая передается в параметре _лппрогресс_ , если таковой имеется. Если _лппрогресс_ имеет **значение NULL**, вызовите метод [имаписуппорт::D ОПРОГРЕССДИАЛОГ](imapisupport-doprogressdialog.md) , чтобы использовать реализацию MAPI. 
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Не задавайте флаг МАПИ_ДЕКЛИНЕ_ОК; Он используется MAPI в вызовах реализаций поставщика хранилища сообщений **копипропс** . 
  
Так как операции копирования и перемещения могут занимать некоторое время, рекомендуется запрашивать отображение индикатора хода выполнения путем установки флага МАПИ_ДИАЛОГ. Вы можете задать для параметра _лппрогресс_ реализацию **IMAPIProgress**, если таковая имеется, или **значение NULL**. Если _лппрогресс_ имеет **значение NULL**, **копипропс** будет использовать индикатор хода выполнения по умолчанию, предоставляемый MAPI. 
  
Вы можете отключить отображение индикатора хода выполнения, не устанавливая флаг МАПИ_ДИАЛОГ. **Копипропс** будет игнорировать параметры _улуипарам_ и _лппрогресс_ и не отображать индикатор. 
  
 **Копипропс** может сообщать о глобальных и индивидуальных ошибках, а также об ошибках, происходящих с одним или несколькими свойствами. Эти отдельные ошибки помещаются в структуру **спроппроблемаррай** . Вы можете отключить отчеты об ошибках на уровне свойств, передав **значение NULL**вместо допустимого указателя для параметра структуры массива проблем свойств. 
  
Если вы хотите получать сведения об ошибках, передайте допустимый указатель структуры **спроппроблемаррай** в параметр _лпппроблемс_ . Когда **копипропс** ВОЗВРАЩАЕТ значение S_OK, проверьте возможные ошибки с отдельными свойствами в структуре. Когда **копипропс** возвращает ошибку, в структуре **спроппроблемаррай** не возвращается никакой информации. Вместо этого вызовите метод [IMAPIProp:: GetLastError](imapiprop-getlasterror.md) , чтобы получить подробные сведения об ошибке. 
  
Если **копипропс** ВОЗВРАЩАЕТ значение S_OK, то освободите возвращаемую структуру **спроппроблемаррай** , вызвав функцию [мапифрибуффер](mapifreebuffer.md) . 
  
При копировании свойств, которые являются уникальными для типа исходного объекта, необходимо убедиться в том, что целевой объект относится к тому же типу. **Копипропс** не запрещает присоединение свойств, которые обычно относятся к одному типу объекта, с другим типом объекта. Вы можете скопировать свойства, которые имеют смысл для целевого объекта. Например, не следует копировать свойства сообщений в контейнер адресной книги. 
  
Чтобы гарантировать копирование между объектами одного типа, убедитесь, что исходный объект и целевой объект имеют один и тот же тип, либо сравнивая указатели объектов, либо вызывая метод [IUnknown:: QueryInterface](https://msdn.microsoft.com/library/54d5ff80-18db-43f2-b636-f93ac053146d%28Office.15%29.aspx) . ПриСвойте идентификатору интерфейса, на который указывает _лпинтерфаце_ , стандартный интерфейс для исходного объекта. Кроме того, убедитесь, что для двух объектов задано одно и то же свойство тип объекта или свойство **пр_обжект_типе** ([PidTagObjectType](pidtagobjecttype-canonical-property.md)). Например, при копировании из сообщения задайте для параметра _лпинтерфаце_ значение Иид_имессаже и **пр_обжект_типе** для обоих объектов мапи_мессаже. 
  
Если в параметре _лпдестобж_ передан недопустимый указатель, результаты будут непредсказуемыми. 
  
Чтобы скопировать список получателей сообщения, вызовите метод **копипропс** сообщения и добавьте свойство **пр_мессаже_реЦипиентс** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) в массиве тегов свойств. Чтобы скопировать вложения сообщения, включите свойство **пр_мессаже_аттачментс** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)). 
  
Чтобы скопировать иерархию или таблицу контента контейнера папки или адресной книги, включите свойства **пр_контаинер_хиерарчи** ([PidTagContainerHierarchy](pidtagcontainerhierarchy-canonical-property.md)) или **пр_контаинер_контентс** ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md)) в элемент массив тегов свойств. Чтобы включить таблицу с содержимым, связанным с папкой, включите в массив свойство **пр_фолдер_ассоЦиатед_контентс** ([PidTagFolderAssociatedContents](pidtagfolderassociatedcontents-canonical-property.md)). 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Мапифунктионс. cpp  <br/> |Копинамедпропс  <br/> |MFCMAPI использует метод **IMAPIProp:: копипропс** для копирования именованных свойств из одного сообщения в другое.  <br/> |
|Синглемапипроплистктрл. cpp  <br/> |Ксинглемапипроплистктрл:: Онпастепроперти  <br/> |MFCMAPI использует метод **IMAPIProp:: копипропс** для вставки свойства, которое было скопировано из другого объекта.  <br/> |
   
## <a name="see-also"></a>См. также



[IMAPIFolder::CopyMessages](imapifolder-copymessages.md)
  
[IMAPIProgress : IUnknown](imapiprogressiunknown.md)
  
[IMAPIProp::CopyTo](imapiprop-copyto.md)
  
[IMAPIProp::GetLastError](imapiprop-getlasterror.md)
  
[IMAPISupport::DoCopyProps](imapisupport-docopyprops.md)
  
[IMAPISupport::DoProgressDialog](imapisupport-doprogressdialog.md)
  
[MAPIFreeBuffer](mapifreebuffer.md)
  
[Каноническое свойство PidTagContainerContents](pidtagcontainercontents-canonical-property.md)
  
[Каноническое свойство PidTagContainerHierarchy](pidtagcontainerhierarchy-canonical-property.md)
  
[Каноническое свойство PidTagDisplayName](pidtagdisplayname-canonical-property.md)
  
[Каноническое свойство PidTagFolderAssociatedContents](pidtagfolderassociatedcontents-canonical-property.md)
  
[Каноническое свойство PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)
  
[Каноническое свойство PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)
  
[Каноническое свойство PidTagObjectType](pidtagobjecttype-canonical-property.md)
  
[SPropProblemArray](spropproblemarray.md)
  
[SPropTagArray](sproptagarray.md)
  
[IMAPIProp : IUnknown](imapipropiunknown.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

