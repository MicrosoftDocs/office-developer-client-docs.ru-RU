---
title: Модель COM и MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: cca4c70d-b73a-4834-80b5-9cb5889f63cc
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: a91ab8497a690fd4b99f76274d0213284253fd06
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32334470"
---
# <a name="component-object-model-and-mapi"></a>Модель COM и MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
В документации по пакету SDK для Windows входит подробное описание правил реализации объектов, которые соответствуют модели компонентных объектов (COM). Эти правила позволяют выполнять следующие действия:
  
- Разработайте интерфейсы и объекты.
    
- Реализуйте интерфейс [IUnknown](https://msdn.microsoft.com/library/ms680509%28VS.85%29.aspx) . 
    
- Управление памятью.
    
- Обработка подсчета ссылок.
    
- Реализуйте объекты с апартаментными потоками.
    
Несмотря на то, что все объекты MAPI считаются основанными на COM, так как они реализуют интерфейсы, наследующие от [IUnknown](https://msdn.microsoft.com/library/ms680509%28VS.85%29.aspx), MAPI-отклонения в некоторых ситуациях от стандартных правил com. Это отклонение позволяет разработчикам больше гибкости в реализациях. Например, интерфейс MAPI, как и любой COM-интерфейс, описывает контракт между разработчиком и вызывающим абонентом. После создания и публикации интерфейса его определение не может и не изменится. В этом описании MAPI не имеет отклонения, но он может быть недоступен. Разработчики могут отказаться от реализации определенных методов, возвращая одно из следующих значений ошибки вызывающему абоненту: 
  
- MAPI_E_NO_SUPPORT
    
- MAPI_E_TOO_COMPLEX
    
- MAPI_E_BAD_CHARWIDTH
    
- MAPI_E_TYPE_NO_SUPPORT
    
Другие отклонения от стандартных правил COM описаны в таблице ниже.
  
|**Правило программирования COM**|**Вариант MAPI**|
|:-----|:-----|
|Все строковые параметры в методах интерфейса должны иметь формат Юникод.  <br/> |Интерфейсы MAPI определяют, чтобы разрешить строковые параметры Юникода или ANSI. Многие методы, у которых есть строковый параметр, также имеют параметр **ulFlags** ; Ширина строкового параметра указывается значением флага MAPI_UNICODE в **ulFlags**. Некоторые интерфейсы MAPI не поддерживают Юникод и не возвращают MAPI_E_BAD_CHARWIDTH, если установлен флаг MAPI_UNICODE.  <br/> |
|Все методы интерфейса должны иметь тип возвращаемого значения HRESULT.  <br/> |В MAPI есть по крайней мере один метод, который возвращает значение, отличное от HRESULT: [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md).  <br/> |
|Вызывающим объектам и разработчикам следует выделить и освободить память для параметров интерфейса с помощью стандартных механизмами выделения задач COM.  <br/> |Все методы MAPI используют связанные распределителя памяти [мапиаллокатебуффер](mapiallocatebuffer.md), [мапиаллокатеморе](mapiallocatemore.md)и [мапифрибуффер](mapifreebuffer.md) для управления памятью для параметров интерфейса. Все реализации MAPI интерфейсов, определенных в OLE, например [IStream](https://msdn.microsoft.com/library/aa380034%28VS.85%29.aspx), используют стандартные распределителя памяти для задач COM.  <br/> |
|Все параметры указателя должны явно иметь значение NULL, если метод завершается с ошибкой.  <br/> |Для интерфейсов MAPI необходимо, чтобы для параметров указателя out было задано значение NULL или не было изменено при сбое метода. Все реализации MAPI интерфейсов, определенные в OLE, явно задают для параметров out значение NULL в случае сбоя.  <br/> |
|Реализуйте статистические объекты везде, где это возможно.  <br/> |Интерфейсы MAPI не поддерживают статистическую обработку.  <br/> |
   
## <a name="see-also"></a>См. также



[MAPIAllocateBuffer](mapiallocatebuffer.md)
  
[MAPIAllocateMore](mapiallocatemore.md)
  
[MAPIFreeBuffer](mapifreebuffer.md)


[Общие сведения об объекте и интерфейсе MAPI](mapi-object-and-interface-overview.md)

