---
title: Получение свойств MAPI
manager: soliver
ms.date: 12/07/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: bd3f9f59-9020-46e6-9560-86a7a0eeca20
description: '���� ���������� ���������: 7 ������� 2015 �.'
ms.openlocfilehash: 9666c551543cefd12ee8c902db1a2372aab20632
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33417086"
---
# <a name="retrieving-mapi-properties"></a>Получение свойств MAPI

 
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Когда клиент или поставщик услуг получает свойство из объекта, объект делает доступным значение, тип и идентификатор свойства. 
  
Клиенты и поставщики услуг могут извлекать свойства объекта, вызывая один из следующих вариантов:
  
[IMAPIProp::GetProps](imapiprop-getprops.md)
  
[IMAPIProp::OpenProperty](imapiprop-openproperty.md)
  
[HrGetOneProp](hrgetoneprop.md)
  
Метод **PROPS** используется для получения одного или нескольких свойств, которые не нуждаются в специализированном или альтернативном интерфейсе для Access. Это означает, что свойства, доступные с помощью параметра **PROPS** , небольшие, такие как целые числа и логические значения. 
  
 **Получение нескольких свойств**
  
1. Выделение структуры [спроптагаррай](sproptagarray.md) , достаточно большой для хранения числа извлекаемых свойств. 
    
2. Присвойте элементу **квалуес** структуры **спроптагаррай** число извлекаемых свойств и задайте для каждого элемента **аулпроптаг** идентификатор и тип (если это возможно) одного из целевых свойств. Если тип неизвестен, задайте для него значение PT_UNSPECIFIED. Если тип и идентификатор неизвестны, укажите эти сведения, вызвав [IMAPIProp:: жетпроплист](imapiprop-getproplist.md). **Жетпроплист** возвращает массив тегов свойств со всеми поддерживаемыми свойствами объекта. Если доступно только имя свойства, вызовите метод [IMAPIProp:: жетидсфромнамес](imapiprop-getidsfromnames.md) , чтобы получить доступ к связанному идентификатору. 
    
3. Call [IMAPIProp:: — PROPS](imapiprop-getprops.md) , чтобы открыть свойство или свойства. 
    
Метод **опенпроперти** используется для открытия больших свойств, для которых требуется альтернативный интерфейс, такой как **IStream** или [IMAPITable](imapitableiunknown.md) для Access. **Опенпроперти** обычно используется для открытия свойств строки с большим символом, двоичного файла и свойств объекта, и может открывать только одно свойство за раз. Вызывающие абоненты передают идентификатор дополнительного интерфейса, который необходимо указать в качестве одного из входных параметров. 
  
Некоторые из распространенных случаев использования **опенпроперти** включают открытие **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)), свойство, содержащее текст текстового сообщения, **PR_ATTACH_DATA_OBJ** ([PidTagAttachDataObject](pidtagattachdataobject-canonical-property.md)), свойство, содержащее объект OLE или вложение в сообщение, и **PR_CONTAINER_CONTENTS** ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md)), свойство, которое содержит таблицу содержимого контейнера или адресной книги. 
  
В зависимости от свойства в **опенпроперти**запрашивается другой интерфейс. Интерфейс **IStream**, который позволяет считывать и записывать данные свойств в виде потока байтов, обычно используется для доступа к **PR_BODY**. Для доступа к **PR_ATTACH_DATA_OBJ**можно использовать [iMessage](imessageimapiprop.md) или **IStream** . Встроенные вложения сообщений, которые являются стандартными сообщениями, используют **iMessage** , а сообщения в формате TNEF используют **IStream**. Так как **PR_CONTAINER_CONTENTS** является объектом Table, доступ к нему осуществляется с помощью [IMAPITable](imapitableiunknown.md).
  
 **Извлечение свойства PR_ATTACH_DATA_BIN вложения**
  
1. Вызовите функцию [опенстреамонфиле](openstreamonfile.md) , чтобы открыть поток для файла. 
    
2. Вызовите метод [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) для получения свойства **PR_ATTACH_DATA_BIN** ([PidTagAttachDataBinary](pidtagattachdatabinary-canonical-property.md)) с помощью интерфейса **IStream** . Установите флаги MAPI_MODIFY и MAPI_CREATE. 
    
3. Выделите структуру **статстг** и передайте ее в вызове метода **IStream:: stat** , чтобы определить его размер. Другой способ определить размер потока — вызвать **IStream:: Seek** с флагом STREAM_SEEK_END. 
    
4. Вызовите метод **IStream:: CopyTo** для копирования данных из потока файла в поток вложений. 
    
5. После завершения операции копирования освободите оба потока, вызвав их методы **IUnknown:: Release** . 
    
Если для доступа к свойствам используется **IStream** , некоторые поставщики услуг автоматически отправляют размер свойства обратно с потоком. Вызов **опенпроперти** с помощью флага MAPI_DEFERRED_ERRORS может задержать открытие свойства и возврат размера потока. Если метод **IStream:: stat** вызывается для получения этого размера после **опенпроперти** с установленным флагом MAPI_DEFERRED_ERRORS, производительность будет снижена, так как данная последовательность вызовов вызывает дополнительный удаленный вызов процедур. Чтобы избежать попадания в производительность, клиенты могут вызывать любой метод MAPI между вызовами **опенпроперти** и **stat**.
  
Функция [хржетонепроп](hrgetoneprop.md) , например **опенпроперти**, открывает по одному свойству за раз. **Хржетонепроп** следует использовать только в том случае, если целевой объект существует на локальном компьютере. Если целевой объект не доступен на локальном компьютере, многократное использование **хржетонепроп** может привести к нескольким удаленным вызовам процедур и снижению производительности. 
  
Вызывающие абоненты, которым требуется несколько свойств, могут вызывать **хржетонепроп** или **опенпроперти** в цикле или совершать один вызов **PROPS**. Однократное вызов **PROPS** является более эффективным. 
  
> [!NOTE]
> Свойства Secure не доступны автоматически с другими свойствами в вызовах **PROPS**, **хржетонепроп**или **жетпроплист** . Защищенные свойства должны быть явно запрошены с помощью идентификаторов свойств. 
  
## <a name="see-also"></a>См. также



[Обзор свойств MAPI](mapi-property-overview.md)

