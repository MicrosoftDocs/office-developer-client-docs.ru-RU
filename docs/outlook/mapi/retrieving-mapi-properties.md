---
title: Ирисовка свойств MAPI
manager: soliver
ms.date: 12/07/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: bd3f9f59-9020-46e6-9560-86a7a0eeca20
description: '���� ���������� ���������: 7 ������� 2015 �.'
ms.openlocfilehash: 9666c551543cefd12ee8c902db1a2372aab20632
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33417086"
---
# <a name="retrieving-mapi-properties"></a>Ирисовка свойств MAPI

 
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Когда клиент или поставщик услуг извлекает свойство из объекта, объект дает доступ к значению, типу и идентификатору свойства. 
  
Клиенты и поставщики услуг могут получить свойства объекта, позвонив по одному из следующих вариантов:
  
[IMAPIProp::GetProps](imapiprop-getprops.md)
  
[IMAPIProp::OpenProperty](imapiprop-openproperty.md)
  
[HrGetOneProp](hrgetoneprop.md)
  
Метод **GetProps** используется для получения одного или более свойств, которые не требуют специализированного или альтернативного интерфейса для доступа. Это означает, что свойства, доступные **с GetProps,** являются небольшими, например значениями integers и Boolean. 
  
 **Для получения нескольких свойств**
  
1. [Выделите структуру SPropTagArray](sproptagarray.md) достаточно большой, чтобы удерживать количество извлекаемого свойства. 
    
2. Установите **член cValues** структуры **SPropTagArray** количество свойств, которые необходимо получить, и установите каждому члену **aulPropTag** идентификатор и тип, по возможности, одного из целевых свойств. Если тип неизвестен, установите его PT_UNSPECIFIED. Если тип и идентификатор неизвестны, найдите эти сведения, позвонив [в IMAPIProp::GetPropList.](imapiprop-getproplist.md) **GetPropList** возвращает массив тегов свойств со всеми поддерживаемами свойствами объекта. Если доступно только имя свойства, позвоните [в IMAPIProp::GetIDsFromNames,](imapiprop-getidsfromnames.md) чтобы получить доступ к связанному идентификатору. 
    
3. Вызов [IMAPIProp::GetProps,](imapiprop-getprops.md) чтобы открыть свойство или свойства. 
    
Метод **OpenProperty** используется для открытия более крупных свойств, для доступа к ним требуется альтернативный интерфейс, например **IStream** или [IMAPITable.](imapitableiunknown.md) **OpenProperty** обычно используется для открытия свойств большой строки символов, двоичных и объектов и может открывать только одно свойство одновременно. Звонители передают идентификатор дополнительного интерфейса, который требуется в качестве одного из параметров ввода. 
  
Некоторые из распространенных применений **OpenProperty** включают открытие **PR_BODY** [(PidTagBody),](pidtagbody-canonical-property.md)свойство, которое содержит тело текстового **сообщения, PR_ATTACH_DATA_OBJ** [(PidTagAttachDataObject),](pidtagattachdataobject-canonical-property.md)свойство, которое содержит объект OLE или вложение сообщения, и **PR_CONTAINER_CONTENTS** [(PidTagContainerContents),](pidtagcontainercontents-canonical-property.md)свойство, которое содержит папку или таблицу содержимого контейнера адресной книги. 
  
В зависимости от свойства в **OpenProperty** запрашивается другой интерфейс. **IStream**— интерфейс, который позволяет читать и писать данные свойств в качестве потока bytes, обычно используется для доступа к **PR_BODY.** Для доступа к PR_ATTACH_DATA_OBJ можно использовать [IMessage](imessageimapiprop.md) **или** **IStream.** Встроенные вложения сообщений, которые являются стандартными сообщениями, используют **IMessage,** а сообщения в формате TNEF — **IStream.** Поскольку **PR_CONTAINER_CONTENTS** является объектом таблицы, к нему можно получить доступ [с помощью IMAPITable.](imapitableiunknown.md)
  
 **Для получения свойства PR_ATTACH_DATA_BIN вложения**
  
1. Вызов [функции OpenStreamOnFile,](openstreamonfile.md) чтобы открыть поток для файла. 
    
2. Вызов [IMAPIProp::OpenProperty](imapiprop-openproperty.md) **для** получения свойства [PR_ATTACH_DATA_BIN (PidTagAttachDataBinary)](pidtagattachdatabinary-canonical-property.md)с интерфейсом **IStream.** Установите флажки MAPI_MODIFY и MAPI_CREATE. 
    
3. Распределите **структуру STATSTG** и передай ее в вызов **методу IStream::Stat** потока файлов, чтобы определить ее размер. Другим способом определения размера потока является вызов **IStream::Seek** с флагом STREAM_SEEK_END. 
    
4. Вызовите метод **IStream::CopyTo** потока, чтобы скопировать данные из потока файла в поток вложений. 
    
5. Когда операция копирования будет завершена, отпустите оба потока, назвав их **методы IUnknown::Release.** 
    
Когда **IStream** используется для доступа к свойствам, некоторые поставщики услуг автоматически отправляют размер свойства обратно с потоком. Вызов **OpenProperty** с флагом MAPI_DEFERRED_ERRORS может задержать открытие свойства и возвращение размера потока. Если **IStream::Stat** вызывается для получения этого размера после **OpenProperty** с набором флага MAPI_DEFERRED_ERRORS, производительность будет влиять, так как эта последовательность вызовов вызывает дополнительный удаленный вызов процедуры. Чтобы избежать попадания производительности, клиенты могут вызывать любой метод MAPI между вызовами **в OpenProperty** и **Stat**.
  
Функция [HrGetOneProp,](hrgetoneprop.md) как **и OpenProperty,** открывает одно свойство одновременно. **HrGetOneProp** следует использовать только в том случае, если целевой объект существует на локальной машине. Если целевой объект не доступен локально, использование **HrGetOneProp** может привести к нескольким удаленным вызовам процедур и ухудшению производительности. 
  
Звонители, которые нуждаются в нескольких свойствах, могут вызвать **HrGetOneProp** или **OpenProperty** в цикле или сделать один вызов **в GetProps**. Вызов **GetProps один** раз является более эффективным. 
  
> [!NOTE]
> Безопасные свойства не доступны автоматически с другими свойствами в **вызове GetProps,** **HrGetOneProp или** **GetPropList.** Защищенные свойства необходимо явно запрашивать с помощью их идентификаторов свойств. 
  
## <a name="see-also"></a>См. также



[Обзор свойств MAPI](mapi-property-overview.md)

