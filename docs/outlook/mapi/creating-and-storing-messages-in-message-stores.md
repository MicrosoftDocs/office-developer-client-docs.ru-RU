---
title: Создание и сохранение сообщений в хранилищах
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: cc74b31c-d7ed-4fcf-9535-a2f9222901b7
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 7c923a330c542dff8b1bbc476461ccd21680a5b7
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32332902"
---
# <a name="creating-and-storing-messages-in-message-stores"></a>Создание и сохранение сообщений в хранилищах

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
То, как ваш поставщик услуг хранилища сообщения создает и сохраняет сообщения с помощью базового механизма хранилища, зависит от самого базового механизма хранилища. Как правило, вам нужно только написать код для сохранения свойств сообщения и их значений.
  
Когда поставщик хранилища сообщения создает сообщение, поставщику необходимо создать сообщение с обязательными свойствами сообщений. Список таких свойств см. в документации интерфейса[IMAPIFolder: IMAPIContainer](imapifolderimapicontainer.md). После этого клиентские приложения добавляют любые дополнительные свойства с помощью метода [IMAPIProp](imapipropiunknown.md). 
  
Когда сообщение сохраняете поставщика сохраняет сообщение, чтобы базовые механизм хранилища, поставщик нужно вывести следующий свойства сообщений и сохранить их базовые механизм хранилище так, что им может быть полностью восстановлен при последующем открытии сообщения.
  
MAPI требует, чтобы свойства интерфейсов [IMessage](imessageimapiprop.md) передавались, что означает, что вносимые изменения не становятся постоянными, пока метод [IMAPIProp::SaveChanges](imapiprop-savechanges.md) вызывается для объекта сообщения. Поставщик услуг хранилища сообщения несет ответственность за реализацию данного поведение. Как правило, выполнить это несложно; это просто подразумевает удержание свойств в памяти, пока в них вносятся изменения, и внесение их в базовый механизм хранилища при вызове**SaveChanges**. 
  
Некоторые свойства для объектов обладают специальной семантикой для клиентских приложений в отношении метода **SaveChanges**, как показано ниже: 
  
- Некоторые свойства должны быть доступны для чтения/записи до вызова**SaveChanges**, а после должны быть доступны только для чтения. Например, **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) определяется изначально клиентским приложением, которое создает сообщение (и поэтому может быть доступно для чтения и записи), но внести изменения будет нельзя после первого вызова ** SaveChanges**.
    
- Некоторые свойства имеют особенные связи со свойствами папки, которые связаны с методами **IMAPIFolder**. Например, свойство **PR_MESSAGE_FLAGS** связано с флагами, которые используются вызовом [IMAPIFolder::CreateMessage](imapifolder-createmessage.md). 
    
- Некоторые свойства могут быть недоступны до первого вызова **SaveChanges**. Например, свойство **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) может быть недоступно до вызова **SaveChanges**. 
    
- Некоторые свойства могут иметь специальные связи с другими свойствами объекта сообщения. Например, свойство**PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) обычно получают из свойства **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) поставщиков услуг хранилища сообщений, которые поддерживают сообщения в формате RTF.
    
- Некоторые свойства используются более чем одним типом объекта, связанным с сообщением. Например, свойство **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) требуется для объектов папки и сообщения, а также объектов хранилища сообщения.
    
В ответственность поставщика услуг хранилища сообщения входит реализации правильной семантики для таких свойств.
  
## <a name="see-also"></a>См. также



[Включение сообщений в хранилищах сообщений](implementing-messages-in-message-stores.md)

