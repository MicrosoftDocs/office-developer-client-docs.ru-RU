---
title: Модель приема сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d85d269e-2251-4399-9159-a2f47a85e3d1
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 487598374f15300cc8b899a50d74b535b5a33c91
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33415119"
---
# <a name="message-reception-model"></a>Модель приема сообщений

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Поставщик транспорта управляет тем, должен ли пулер MAPI оповещая его для входящих сообщений или выполняет ли он вызов пула MAPI при поступления новой почты. Поставщик транспорта устанавливает флаг SP_LOGON_POLL при возвращении из [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) для запроса опроса. В противном случае поставщик транспорта использует [IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md) если входящие сообщения доступны. После того как вы узнали, что входящий почтовый ящик доступен, пулер MAPI открывает новое сообщение и просит поставщика транспорта сохранить полученные свойства сообщения в сообщении. 
  
Этот процесс работает следующим образом:
  
1. Доступные сообщения указываются поставщиком транспорта, который вызывает **IMAPISupport::SpoolerNotify,** или пулером MAPI, который вызывает [IXPLogon::P oll.](ixplogon-poll.md)
    
2. Пулер MAPI вызывает [IXPLogon::StartMessage](ixplogon-startmessage.md) для запуска процесса. 
    
3. Поставщик транспорта помещает значение ссылки в расположение, на который ссылается **StartMessage.** Эти эталонные значения позволяют поставщику транспорта и пулу MAPI отслеживать, какое сообщение обрабатывается при доставке нескольких сообщений.
    
4. Поставщик транспорта сохраняет данные сообщения в переданный [экземпляр IMessage : IMAPIProp.](imessageimapiprop.md) 
    
5. Поставщик транспорта вызывает метод [IMAPIProp::SaveChanges](imapiprop-savechanges.md) в экземпляре **IMessage** и возвращается из **StartMessage.**
    
6. Пулер MAPI вызывает [IXPLogon::TransportNotify,](ixplogon-transportnotify.md) если необходимо остановить доставку сообщений. 
    
> [!NOTE]
> Если поставщик транспорта должен доставлять большое количество сообщений, а поставщик транспорта использует **IMAPISupport::SpoolerNotify** вместо **IXPLogon::P oll,** следует не вызывать **SpoolerNotify** слишком часто, чтобы не переполнить других поставщиков транспорта времени ЦП. У пула MAPI есть логика для предотвращения этого, но обычно интервал между вызовами **SpoolerNotify** должен быть больше времени, необходимого поставщику транспорта для обработки одного сообщения. > кроме того, пульщик MAPI может не обрабатывать входящие сообщения немедленно. Пулер MAPI может попросить поставщика транспорта выполнить другие задачи перед получением входящих сообщений. 
  

