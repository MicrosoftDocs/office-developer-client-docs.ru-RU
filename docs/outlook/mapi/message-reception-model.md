---
title: Модель приема сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d85d269e-2251-4399-9159-a2f47a85e3d1
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: cecdb2c30d6c9df2aafbeed43714269b863ebc48
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/15/2018
ms.locfileid: "19810011"
---
# <a name="message-reception-model"></a>Модель приема сообщений

  
  
**Относится к**: Outlook 
  
Поставщик транспорта управляет ли диспетчер очереди MAPI должен опроса его для входящей почты или ли оно выполняет вызов диспетчер очереди MAPI при поступлении новых сообщений. Поставщика транспорта устанавливает флаг SP_LOGON_POLL при возврате из [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) для запроса опроса. В противном случае поставщика транспорта использует [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) при входящей почты. После обучения, что входящую почту, доступен, диспетчер очереди MAPI откроется новое сообщение и запрашивает поставщика транспорта для хранения свойства полученного сообщения в сообщение. 
  
Этот процесс работает следующим образом:
  
1. Доступные сообщения указываются с любого из поставщика транспорта, вызов **IMAPISupport::SpoolerNotify** или диспетчер очереди MAPI, вызов [IXPLogon::Poll](ixplogon-poll.md).
    
2. Диспетчер очереди MAPI вызывает [IXPLogon::StartMessage](ixplogon-startmessage.md) для запуска процесса. 
    
3. Поставщика транспорта устанавливает значение ссылки в расположение, на который ссылается **StartMessage**. Эти значения ссылку разрешить поставщика транспорта и диспетчер очереди MAPI для отслеживания сообщений, обрабатывается при наличии нескольких сообщения для доставки.
    
4. Поставщика транспорта хранит данные сообщений в передаваемый [IMessage: IMAPIProp](imessageimapiprop.md) экземпляра. 
    
5. Поставщика транспорта вызывается метод [IMAPIProp::SaveChanges](imapiprop-savechanges.md) **IMessage** экземпляра и возвращает из **StartMessage**.
    
6. Диспетчер очереди MAPI вызывает [IXPLogon::TransportNotify](ixplogon-transportnotify.md) , если ее необходимо остановить доставки сообщений. 
    
> [!NOTE]
> Если поставщика транспорта используется **IMAPISupport::SpoolerNotify** вместо **IXPLogon::Poll**поставщика транспорта должна предоставить большое число сообщений, следует соблюдать осторожность не для вызова **SpoolerNotify** слишком часто в порядке, чтобы не привести другими поставщиками транспорта времени ЦП. Диспетчер очереди MAPI имеют логику, чтобы предотвратить это, но в целом интервал между вызовами **SpoolerNotify** должно быть длиннее время, затраченное поставщика транспорта для обработки одного сообщения. > Кроме того диспетчер очереди MAPI может обрабатывать входящие сообщения сразу же. Диспетчер очереди MAPI может потребоваться поставщика транспорта для выполнения других задач до получения входящих сообщений. 
  

