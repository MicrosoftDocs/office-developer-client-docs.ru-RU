---
title: Поддержка уведомлений о событиях
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327428"
---
# <a name="supporting-event-notification"></a>Поддержка уведомлений о событиях

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Поскольку поддержка уведомлений о событиях может быть сложной, MAPI обеспечивает три метода объекта поддержки, реализующих наиболее сложные части процесса. Эти методы работают как единица, и поставщик должен использовать все три или ни один из них.
  
Методы поддержки MAPI используют ключи уведомлений для управления подключениями между приемниками уведомлений и объектами, которые создают уведомления. Ключ уведомления — это структура [NOTIFKEY,](notifkey.md) которая содержит двоичные данные, определяя объект в процессах. Ключ уведомления обычно копируется из долгосрочного идентификатора записи объекта источника консультации. Если клиент предоставил идентификатор записи в вызове "Сообщить", его можно использовать в качестве ключа уведомления. Если параметр _lpEntryID_ для advise имеет NULL, используйте идентификатор записи для максимального возможного объекта контейнера, например для хранения сообщений.  
  
Чтобы использовать методы поддержки, вызовите [IMAPISupport::Subscribe](imapisupport-subscribe.md) каждый раз, когда клиент вызывает метод **Advise** для регистрации уведомления. [Выделите структуру NOTIFKEY](notifkey.md) и создайте уникальный ключ уведомления для объекта источника консультации. Например, поставщик store сообщений, который получает запрос на уведомление клиента при получении сообщения в определенную папку, создает ключ уведомления для этой папки. Передайте указатель в структуру **NOTIFKEY** в вызове **подписки** вместе с указателем на клиентский канал с советом. **Подписка** вызывает метод [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) приемника консультации для инкрементного подсчета ссылок, а MAPI сохраняет указатель, пока регистрация не будет отменена. 
  
Вы можете передать флаг NOTIFY_SYNC  для подписки, чтобы запросить, что **Notify** работает синхронно и не возвращается, пока он не будет выполнен все вызовы методов [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) зарегистрированных приемники рекомендации. Установите этот флаг только для собственного внутреннего использования. Не устанавливайте его при ответе на звонок **"Консультация** клиента". Уведомления о событиях между клиентами и поставщиками всегда асинхронные. То есть MAPI гарантирует, что вызов, во время которого происходит событие, будет возвращен клиенту до того, как будет выполнен какой-либо из вызовов **OnNotify.** 
  
Если вы установите флаг NOTIFY_SYNC, не вносим никаких изменений ни в какие объекты-оболочки-оболочки и не передайте оболочку, созданную [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) для подписки. **HrThisThreadAdviseSink** создает потокобезопасную версию замещения для использования только с асинхронным уведомлением. 
  
Если замещает уведомление, зарегистрированное для синхронного уведомления, возвращается из **OnNotify** с установленным флагом CALLBACK_DISCONTINUE, [IMAPISupport::Notify](imapisupport-notify.md) устанавливает флаг NOTIFY_CANCELED и возвращается без каких-либо вызовов **OnNotify.** 
  
Когда **подписка** будет возвращена, вам больше не придется удерживать свою копию клиентского мюнике с консультацией. Вызовите метод [IUnknown::Release,](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) чтобы освободить его. **Подписка** возвращает номер подключения без 0, который необходимо вернуть клиенту. Номер подключения представляет собой ссылку между источником консультации и оконсультантом. Он остается действительным, пока клиент не сделает успешный вызов **Unadvise.** 
  
Когда клиент готов отменить регистрацию, он вызывает метод **Unadvise.** Передав номер подключения из вызова **Unadvise** в [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md). **При отписке** вызывается метод **IUnknown::Release** приемника рекомендации. Как и **в окне** **"Сообщить"** и "Отписаться", вызовы **подписки** и подписки должны **быть** сопряжены. Необходимо сделать один вызов для **подписки на** каждый вызов, сделанный для **подписки.** Однако вам не нужно вызывать **подписку каждый** раз при вызове метода **Advise.** И наоборот, его можно вызвать для настройки внутренних уведомлений. 
  
При событии выделяем одну или несколько структур [УВЕДОМЛЕНий](notification.md) типа, соответствующего событию, и вызовите [IMAPISupport::Notify.](imapisupport-notify.md) **Уведомление** создает уведомление для каждого зарегистрированного мюник консультации. Для всех неиспользованных членов структуры [NOTIFICATION](notification.md) необходимо установить нулевое значение. Этот метод инициализации структуры **УВЕДОМЛЕНий** помогает клиентам создавать более мелкие, быстрые и менее подверженные ошибкам реализации **OnNotify.** 
  
Обратите внимание, что для **каждого** события требуется отдельная структура УВЕДОМЛЕНий, даже для нескольких событий одного типа. Например, если для уведомления о таблице в конкретной таблице зарегистрировано три клиента и в  таблицу добавлены пять строк, необходимо создать пять OBJECT_NOTIFICATION для вызова **Notify.** Пакетное уведомление, например это, приводит к более производительности, чем вызов **Notify** пять раз. Для каждого **вызова Notify** MAPI вызывает метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) каждого зарегистрированного приемника консультации. Если зарегистрированные мюникы для консультаций не зарегистрированы, MAPI игнорирует вызов. 
  
Поставщики услуг, которые отправляют пакетные уведомления, должны указать их, чтобы их можно было интерпретировать с первого уведомления до последнего. Этот порядок особенно необходим, если пакет уведомлений содержит ряд событий, например события TABLE_ROW_ADDED с одним событием, которое ссылается на предыдущие строки, добавленные в другое событие в том же пакете.
  
## <a name="see-also"></a>См. также



[Поставщики услуг MAPI](mapi-service-providers.md)

