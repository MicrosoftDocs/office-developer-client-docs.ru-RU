---
title: Поддержка уведомлений о событиях
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25397144"
---
# <a name="supporting-event-notification"></a>Поддержка уведомлений о событиях

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Так как поддержка уведомления о событии, может быть затруднена, MAPI предоставляет три метода объекта поддержки, которые реализуют самые сложные части процесса. Эти методы работать как одно целое и поставщика необходимо использовать все три или ни один из них.
  
Методы поддержки MAPI стрелками уведомления для управления подключениями между приемники уведомлений и объекты, которые создают уведомления. Ключ уведомлений представляет собой структуру [NOTIFKEY](notifkey.md) , который содержит двоичные данные, идентифицирующий объект процессов. Клавиша уведомлений обычно копируются из долгосрочного идентификатор записи объекта источника уведомлений. Если клиент имеет указанный идентификатор записи в вызове **уведомлений**, его можно использовать для уведомления ключа. Если параметр _lpEntryID_ **уведомлений** , NULL, используйте идентификатор записи объекта внешней возможные контейнер, такие как хранилища сообщений. 
  
Чтобы использовать методы поддержки, вызовите [IMAPISupport::Subscribe](imapisupport-subscribe.md) каждый раз, когда клиент вызывает метод **уведомлений** для регистрации уведомления. Выделить [NOTIFKEY](notifkey.md) структуры и создания ключа уникальный уведомления для объекта источника уведомлений. Например поставщика хранилища сообщений, который будет запрашиваться для уведомления клиента при получении сообщения в определенную папку создает ключ уведомления для этой папки. Передайте указатель в **NOTIFKEY** структуру в вызове **подписки на** вместе с указатель на клиенте уведомить приемника. **Подписки на** вызывает метод [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) приемник уведомлений, чтобы увеличить счетчик ссылок на него и MAPI сохраняет указатель до отмены регистрации. 
  
Вы можете передать флаг NOTIFY_SYNC для **подписки на** запрашивать **уведомление** ведут себя синхронно, а не возвращаемое только после выполнения всех вызовов методов [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) зарегистрированных приемников уведомлений. Установите этот флажок только для внутреннего использования. Не задан его, если отвечает на клиентских вызовов **уведомлений** . Уведомление о событии между клиентами и поставщиками всегда является асинхронным. То есть MAPI гарантирует, что звонок, во время которого событие происходит возвращает клиенту до выполнения любой из **OnNotify** вызовов. 
  
Если установлен флаг NOTIFY_SYNC, не вносите никаких изменений для любого объекта приемник уведомлений и не передает приемник уведомлений программы-оболочки, созданные [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) для **подписки на**. **HrThisThreadAdviseSink** создает версию потоками приемника уведомления, который будет использоваться с только асинхронного уведомления. 
  
Если приемника уведомления, зарегистрированные для синхронного уведомления возвращает из **OnNotify** с установленным флагом CALLBACK_DISCONTINUE, [IMAPISupport::Notify](imapisupport-notify.md) задает флаг NOTIFY_CANCELED и возвращает без внесения все вызовы **OnNotify**. 
  
После **подписки на** вернул, больше не будет предоставляться применения к удержанию копию клиента уведомить приемника. Вызов метода его [функции IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) для освобождения его. **Подписки на** возвращает число ненулевое подключения, которая должна вернуть клиенту. Номер соединения представляет связь между источником уведомлений и приемник уведомлений. Действует только после успешного вызова **Unadvise**делает клиента. 
  
Когда клиент будет готов для отмены регистрации, он вызывает метод **Unadvise** . Передайте номер подключения от вызова **Unadvise** [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md). **Отказа от подписки** вызывает метод **функции IUnknown::Release** приемник уведомлений. Как и в **уведомлений** и **Unadvise**будет соединяться вызовы **подписки на** и **отказа от подписки** . Необходимо выполнить один вызов **отказа от подписки** для каждого вызова к **подписке на**. Тем не менее не нужно вызвать **подписки на** каждый раз при вызове метода **уведомлений** . С другой стороны его можно вызвать для настройки внутренних уведомлений. 
  
При возникновении события выделить один или несколько [УВЕДОМЛЕНИЙ](notification.md) структуры в тип, подходящий для события и вызовите [IMAPISupport::Notify](imapisupport-notify.md). **Уведомлять** создает уведомления для каждой приемник зарегистрированных уведомлений. Необходимо установить все неиспользуемые элементы структуры [УВЕДОМЛЕНИЙ](notification.md) нулевое значение. Этот метод для инициализации структуры **уведомление** может помочь Создание меньшего размера, быстрее и меньше ошибок реализации **OnNotify** клиентов. 
  
Обратите внимание, что отдельные структуры **уведомления** для каждого события, даже для нескольких событий для одного типа. Например если пять строк добавляются к таблице три клиенты регистрируются для уведомлений в таблице на отдельной таблицей, необходимо создать пять структур **OBJECT_NOTIFICATION** **Уведомлять** вызова. Уведомление batch таких как это приводит к более высокую производительность, чем вызов **Уведомлять** пять раз. Для каждого вызова **Уведомлять** MAPI вызывает метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) каждый приемник зарегистрированных уведомлений. Если нет зарегистрированных приемников, уведомлений MAPI игнорирует вызова. 
  
Поставщиков услуг, которые отправляют пакетной уведомлений необходимо упорядочить их, чтобы они могут распознавать звук из первого уведомления к последнему. Этот порядок необходим, особенно если пакета уведомлений содержит последовательность событий, например TABLE_ROW_ADDED с одно событие, который относится к предыдущей строкой, который был добавлен в другой события в одном пакете.
  
## <a name="see-also"></a>См. также



[Поставщиков служб MAPI](mapi-service-providers.md)

