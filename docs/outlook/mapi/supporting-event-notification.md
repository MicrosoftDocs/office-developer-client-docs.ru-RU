---
title: Поддержка уведомления о событиях
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327428"
---
# <a name="supporting-event-notification"></a>Поддержка уведомления о событиях

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Так как поддержка уведомлений о событиях может быть сложной, MAPI поставляет три метода объектов поддержки, реализующих самые сложные части процесса. Эти методы работают как единица, и поставщик должен использовать все три или ни один из них.
  
Методы поддержки MAPI используют ключи уведомлений для управления подключениями между приемниками рекомендации и объектами, которые создают уведомления. Ключ уведомления — это [структура NOTIFKEY,](notifkey.md) которая содержит двоичные данные, идентифицируя объект во всех процессах. Ключ уведомления обычно копируется из долгосрочного идентификатора входа объекта-источника консультации. Если клиент предоставил идентификатор записи в вызове к **консультации,** вы можете использовать его для ключа уведомления. Если _параметр lpEntryID_ для консультирования — NULL, используйте идентификатор входа максимально возможного контейнерного объекта, например хранилище сообщений.  
  
Чтобы использовать методы поддержки, позвоните [в службу IMAPISupport::Subscribe](imapisupport-subscribe.md) всякий раз, когда клиент вызывает метод **Advise** для регистрации уведомления. Распределите [структуру NOTIFKEY](notifkey.md) и создайте уникальный ключ уведомления для объекта-источника консультаций. Например, поставщик магазина сообщений, который получает запрос на уведомление клиента при получении сообщения в определенную папку, создает ключ уведомления для этой папки. Передай указатель в структуру **NOTIFKEY** в вызове **Подписаться** вместе с указателем на раковину рекомендации клиента. **Подписка** вызывает метод [IUnknown::AddRef,](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) чтобы прибавить количество ссылок, и MAPI сохраняет указатель до отмены регистрации. 
  
Вы можете передать флаг NOTIFY_SYNC  для подписки, чтобы попросить, чтобы Уведомить себя синхронно и не возвращать, пока он не сделал все вызовы [в IMAPIAdviseSink:::OnNotify](imapiadvisesink-onnotify.md) методы зарегистрированных советуем раковины.  Установите этот флаг только для собственного внутреннего использования. Не устанавливайте его при ответе на вызов "Совет **клиента".** Уведомление о событиях между клиентами и поставщиками всегда асинхронно. То есть MAPI гарантирует, что вызов, во время которого происходит событие, вернется клиенту до того, как будут сделаны какие-либо вызовы **OnNotify.** 
  
Если вы установите флаг NOTIFY_SYNC, не вносим никаких изменений ни в один из объектов раковины рекомендации и не передайте раковину для обертки, созданную [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) для подписки **.** **HrThisThreadAdviseSink** создает нитобезопасную версию раковины рекомендации, которая будет использоваться только с асинхронным уведомлением. 
  
Если раковина рекомендации, зарегистрированная для синхронного уведомления, возвращается из **OnNotify** с набором флага [CALLBACK_DISCONTINUE, IMAPISupport:::Notify](imapisupport-notify.md) задает флаг NOTIFY_CANCELED и возвращается без звонков **в OnNotify.** 
  
После **возврата Подписка** больше не будет необходимости держаться за копию клиентской раковины рекомендации. Вызов метода [IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) для его выпуска. **Подписка** возвращает нецеронный номер подключения, который необходимо вернуть клиенту. Номер подключения представляет связь между источником консультации и раковиной рекомендации. Он остается действительным до тех пор, пока клиент не сделает успешный вызов **в Unadvise**. 
  
Когда клиент готов отменить регистрацию, он вызывает метод **Unadvise.** Передай номер подключения из **вызова Unadvise** в [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md). **Отписка** вызывает метод **IUnknown::Release.** Как и **в окне** Advise и **Unadvise,** вызовы **подписки** и отписки **должны** быть сопряжены. Необходимо сделать один вызов для **отписки** для каждого звонка, который делается для **подписки**. Однако при каждом вызове метода Advise  не нужно вызывать **Подписку.** И наоборот, вы можете вызвать его для настройки внутренних уведомлений. 
  
В случае возникновения события выделяем одну или несколько структур [УВЕДОМЛЕНий](notification.md) соответствующего типа и вызываем [IMAPISupport::Notify](imapisupport-notify.md). **Уведомление** создает уведомление для каждой зарегистрированной раковины рекомендации. Необходимо установить значение нуля для всех [](notification.md) неиспользованых членов структуры УВЕДОМЛЕНий. Этот метод инициализации структуры **УВЕДОМЛЕНИй** помогает клиентам создавать более мелкие, быстрые и менее подверженные ошибкам реализации **OnNotify.** 
  
Обратите внимание, что для каждого **события** необходима отдельная структура УВЕДОМЛЕНий, даже для нескольких событий одного типа. Например, если три клиента зарегистрированы для уведомления о таблице в определенной таблице и в  таблицу добавлены пять строк, необходимо создать пять OBJECT_NOTIFICATION для вызова **Notify.** Пакетное уведомление, например это, приводит к большей производительности, чем **вызову Уведомления** пять раз. Для каждого **вызова Notify** MAPI вызывает [метод IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) для каждого зарегистрированного приемника консультации. Если зарегистрированных сухтов не существует, MAPI игнорирует вызов. 
  
Поставщики услуг, отправив пакетные уведомления, должны заказать их, чтобы их можно было интерпретировать с первого уведомления до последнего. Этот порядок особенно необходим, когда пакет уведомлений содержит ряд событий, таких как TABLE_ROW_ADDED с одним событием, которое ссылается на предыдущее строку, которая была добавлена в другом событии в той же партии.
  
## <a name="see-also"></a>См. также



[Поставщики услуг MAPI](mapi-service-providers.md)

