---
title: Обзор поддержки объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: ecc5439b4abbbfd920fba5456db7462f7967388f
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19812399"
---
# <a name="support-object-overview"></a>Обзор поддержки объектов

  
  
**Относится к**: Outlook 
  
MAPI предоставляющей объект поддержки объект, реализующий [IMAPISupport: IUnknown](imapisupportiunknown.md) интерфейс для всех поставщиков услуг при входе в систему и для всех служб сообщения во время настройки. 
  
Объекты поддержки недоступны для клиентов; они являются реализован MAPI и вызывается только поставщиков услуг. Интерфейс **IMAPISupport** указана в файле заголовка Mapispi.h. Идентификатор является IID_IMAPISup и его тип указателя является LPMAPISUP. Свойства MAPI, не предоставляемые интерфейсом объекты поддержки. 
  
Поставщик может быть задан один или несколько объектов поддержки, в зависимости от того, сколько раз MAPI входе поставщик или сколько раз вызывается функция запись службы поставщика сообщения. Как правило поставщик будет войти в систему по крайней мере один раз за сеанс. Поставщики адресной книги и транспорта вход при каждом запуске клиента сеанса с записью профиля, который их запрашивает. Поставщики хранилища сообщений вход при каждом клиент вызывает метод [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) . 
  
В случае нескольких входов в систему в сеансе вы можете либо удержания и использовать каждый объект поддержки отдельно для удержания и использовать только первые пропуск каждого объекта последующих поддержки. Чтобы сохранить объект поддержки, вызове метода **IUnknown::AddRef** . Вызов **AddRef** для поддержки объекта, который необходимо сохранить в сеансе играет важнейшую роль; Если вызов не выполняется, MAPI освобождает объект поддержки и освобождает его память. 
  
Объект поддержки предназначен для предоставления реализаций довольно много методы, обычно используемые поставщиками. Каждый объект поддержки также содержит контекстную данные, относящиеся к собственному экземпляру, такие как поставщик работает в раздел профиля, который использует поставщик сеанса и сведения об ошибках для сеанса. 
  
Существует четыре разных типов объектов поддержки: один для каждого типа основных поставщика (адресной книги, хранилища сообщений и транспорта), а другая — для поддержки конфигурации. 
  
MAPI настраивает каждого объекта поддержки, включая реализации методов, которые относятся к его использования. Реализации некоторые методы, такие как [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)включены в все объекты поддержки. Реализации другие методы, такие как [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), применяются только к объектов определенного поддержки. Только сообщение хранилища и поставщиками транспорта можно использовать этот метод; При попытке вызова поставщика адресных книг или службы сообщений MAPI возвращает MAPI_E_NO_SUPPORT.
  
Объекты поддержки можно использовать для выполнения многих задач, включая следующие:
  
- Доступ к профиля.
    
- Копирование папок или сообщений. Для получения дополнительных сведений см. [копирование или перехода сообщение или папку](copying-or-moving-a-message-or-a-folder.md).
    
- Доступ к объектам, относящихся к других поставщиков. Для получения дополнительных сведений см [Поддержка доступа к объектам и сравнения](supporting-object-access-and-comparison.md). 
    
- Обработка события уведомления. Для получения дополнительных сведений см [Поддержка уведомления о событии](supporting-event-notification.md).
    
- Выделение и освобождение памяти.
    
- Получение уникального идентификатора.
    
- Аннулирование объекты.
    
- Обработка ошибок.
    
- Регистрация preprocessors сообщение. 
    
- Подготовка отчеты о доставке сообщения. 
    
Во время входа в систему MAPI вызывает метод входа в систему объекта поставщика каждого поставщика служб. Для поставщиками адресной книги MAPI вызывает [IABProvider::Logon](iabprovider-logon.md). Для поставщиков хранилища сообщений MAPI вызывает [IMSProvider::Logon](imsprovider-logon.md). Для поставщиков транспорта MAPI вызывает [IXPProvider::TransportLogon](ixpprovider-transportlogon.md). MAPI передает указатель на объект поддержки в один из параметров в этот метод. Метод входа в систему в свою очередь создает экземпляр объекта входа в систему, передав ее указателя на объект поддержки. Объект вход в систему вызывает метод **IUnknown::AddRef** объекта поддержка хранения, при необходимости. Дополнительные сведения о входе для поставщиков услуг содержатся в разделе [Запуск поставщика услуг](starting-a-service-provider.md).
  
При выходе клиент MAPI вызывает метод logoff объект вход в систему. Метод выхода из системы вызывает метод **функции IUnknown::Release** объект поддержки для указания, что поставщик больше не планирует вызова любой из способов поддержки. Как и для входа в систему, выход из системы методы имеют немного разные имена. Интерфейсы [IABLogon](iablogoniunknown.md) и [IMSLogon](imslogoniunknown.md) имеют методов **выхода из системы** . интерфейс [IXPLogon](ixplogoniunknown.md) содержит метод [TransportLogoff](ixplogon-transportlogoff.md) . 
  
Функции точки входа службы сообщений, называются случае неудачной попытки входа в систему с ошибкой MAPI_E_UNCONFIGURED или при клиентом запроса на конфигурации. MAPI создает экземпляр объекта поддержки конфигурации и вызывает функцию точки входа службы сообщений не настроенные поставщика или поставщика, параметры которого является изменение. В отличие от других объектов поддержки объекты поддержки конфигурации являются допустимыми только до точки входа, функция возвращает; службы сообщений не вызывайте методы **AddRef** этих объектов для сохранения их. 
  
Как правило MAPI вызывает функцию точки входа службы поставщика сообщения, но в некоторых случаях задаваемые поставщика для выполнения вызова. Это происходит, когда клиент вызывает метод [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) поставщика запроса поставщика, чтобы открыть окно свойств конфигурации. **SettingsDialog** должны вызывать [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) для получения объекта поддержки конфигурации, его можно передать в функцию точки входа службы сообщений. 
  
Метод [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) для определения адреса функции выделения и освобождения памяти без необходимости для связывания с MAPI. С помощью **GetMemAllocRoutines** также упрощает отслеживание утечек памяти с соседних вызовы функций выделения при отладке кода. При вызове **GetMemAllocRoutines**как рекомендуется, сделать это до вызова функции [CreateIProp](createiprop.md) , для которой требуется адреса функции распределения как параметры. 
  
При необходимости для создания новой адресной книги или сообщения хранения объектов, создайте и назначьте ключ поиска для объекта в своем свойстве **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)). Вызов [IMAPISupport::NewUID](imapisupport-newuid.md) для получения уникального идентификатора для построения ключ поиска. Не используйте свои собственные жестко [MAPIUID](mapiuid.md). Поставщик **MAPIUID** следует использовать только для записи идентификаторов. Дополнительные сведения о создании ключей поиска просмотрите [записи MAPI и ключи поиска](mapi-record-and-search-keys.md).
  
Клиентское приложение в некоторых случаях можно освободить объект без освобождения одно или несколько его дочерние объекты. В этом случае поставщик может потребоваться нарушить работоспособность не выпускавшиеся объекта. Для этого поставщика освобождает все ресурсы, подключенных с помощью объекта и затем вызывает [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) Чтобы объявить недействительным vtable объекта. **MakeInvalid** заменяет методы **IUnknown** vtable (**QueryInterface**, **AddRef**и **выпуск**) с помощью стандартных реализаций интерфейса MAPI и вызывает другие методы для возврата MAPI_E_INVALID_OBJECT. **MakeInvalid** также освобождает объект памяти, отличный от vtable. 
  
## <a name="see-also"></a>См. также



[Поставщиков служб MAPI](mapi-service-providers.md)

