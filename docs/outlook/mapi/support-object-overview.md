---
title: Обзор объектов поддержки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 55d8a9c78ae5132eaa8cf0f0aec5b252ef83b926
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433614"
---
# <a name="support-object-overview"></a><span data-ttu-id="ac17d-103">Обзор объектов поддержки</span><span class="sxs-lookup"><span data-stu-id="ac17d-103">Support Object Overview</span></span>

  
  
<span data-ttu-id="ac17d-104">**Область применения**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="ac17d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="ac17d-105">MAPI представляет объект поддержки, объект, который реализует [интерфейс IMAPISupport : IUnknown](imapisupportiunknown.md) для всех поставщиков услуг во время логотипа и для всех служб сообщений во время настройки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-105">MAPI furnishes a support object, an object that implements the [IMAPISupport : IUnknown](imapisupportiunknown.md) interface, for all service providers during logon and for all message services during configuration.</span></span> 
  
<span data-ttu-id="ac17d-106">Объекты поддержки недоступны клиентам; они реализованы MAPI и вызваны только поставщиками услуг.</span><span class="sxs-lookup"><span data-stu-id="ac17d-106">Support objects are not accessible by clients; they are implemented by MAPI and called only by service providers.</span></span> <span data-ttu-id="ac17d-107">Интерфейс **IMAPISupport** указан в файле заголовки Mapispi.h.</span><span class="sxs-lookup"><span data-stu-id="ac17d-107">The **IMAPISupport** interface is specified in the Mapispi.h header file.</span></span> <span data-ttu-id="ac17d-108">Его идентификатор IID_IMAPISup, а тип указателя — LPMAPISUP.</span><span class="sxs-lookup"><span data-stu-id="ac17d-108">Its identifier is IID_IMAPISup and its pointer type is LPMAPISUP.</span></span> <span data-ttu-id="ac17d-109">Никакие свойства MAPI не подвергаются воздействию объектов поддержки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-109">No MAPI properties are exposed by support objects.</span></span> 
  
<span data-ttu-id="ac17d-110">Поставщику может быть предоставлен один или несколько объектов поддержки в зависимости от количества журналов MAPI поставщика или количества случаев, когда вызвана функция входа службы сообщений поставщика.</span><span class="sxs-lookup"><span data-stu-id="ac17d-110">A provider can be given one or more support objects, depending on the number of times MAPI logs the provider on or the number of times the provider's message service entry function is called.</span></span> <span data-ttu-id="ac17d-111">Как правило, поставщик регистрируется не реже одного раза за сеанс.</span><span class="sxs-lookup"><span data-stu-id="ac17d-111">Typically, a provider will be logged on at least once per session.</span></span> <span data-ttu-id="ac17d-112">Адресная книга и поставщики транспорта регистрируются каждый раз, когда клиент начинает сеанс с помощью записи профиля, которая запрашивает их.</span><span class="sxs-lookup"><span data-stu-id="ac17d-112">Address book and transport providers are logged on every time a client starts a session with a profile entry that requests them.</span></span> <span data-ttu-id="ac17d-113">Поставщики магазинов сообщений регистрируются каждый раз, когда клиент вызывает [метод IMAPISession::OpenMsgStore.](imapisession-openmsgstore.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-113">Message store providers are logged on every time a client calls the [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) method.</span></span> 
  
<span data-ttu-id="ac17d-114">В случае нескольких логотипов в сеансе можно выбрать либо сохранить и использовать каждый объект поддержки отдельно, либо сохранить и использовать только первый, отбрасыв каждый последующий объект поддержки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-114">In the case of multiple logons in a session, you can choose either to retain and use each support object separately or to retain and use only the first, discarding each subsequent support object.</span></span> <span data-ttu-id="ac17d-115">Чтобы сохранить объект поддержки, позвоните по методу **IUnknown::AddRef.**</span><span class="sxs-lookup"><span data-stu-id="ac17d-115">To retain a support object, call its **IUnknown::AddRef** method.</span></span> <span data-ttu-id="ac17d-116">Вызов **AddRef** на объекте поддержки, который необходимо сохранить на протяжении сеанса, крайне важен; если вызов не выполнен, MAPI освобождает объект поддержки и освобождает его память.</span><span class="sxs-lookup"><span data-stu-id="ac17d-116">Calling **AddRef** on a support object that you want to retain throughout a session is extremely important; if the call is not made, MAPI releases the support object and frees its memory.</span></span> 
  
<span data-ttu-id="ac17d-117">Целью объекта поддержки является предоставление реализаций для довольно большого количества методов, обычно используемых поставщиками.</span><span class="sxs-lookup"><span data-stu-id="ac17d-117">The purpose of the support object is to provide implementations for a fairly large number of methods commonly used by the providers.</span></span> <span data-ttu-id="ac17d-118">Каждый объект поддержки также содержит контекстные данные, специфические для собственного экземпляра, такие как сеанс, в котором работает поставщик, раздел профилей, который использует поставщик, и сведения об ошибках для сеанса.</span><span class="sxs-lookup"><span data-stu-id="ac17d-118">Each support object also contains contextual data specific to its own instance, such as the session the provider is running in, the profile section the provider is using, and error information for the session.</span></span> 
  
<span data-ttu-id="ac17d-119">Существует четыре различных типа объектов поддержки: один для каждого крупного типа поставщика (адресная книга, хранилище сообщений и транспорт) и один для поддержки конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ac17d-119">There are four different types of support objects: one for each major provider type (address book, message store, and transport) and one for configuration support.</span></span> 
  
<span data-ttu-id="ac17d-120">MAPI настраивает каждый объект поддержки, включив в них реализацию методов, соответствующих его использованию.</span><span class="sxs-lookup"><span data-stu-id="ac17d-120">MAPI customizes each support object by including implementations of methods that are relevant for its usage.</span></span> <span data-ttu-id="ac17d-121">Реализация некоторых методов, таких как [IMAPISupport::OpenProfileSection,](imapisupport-openprofilesection.md)включена во все объекты поддержки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-121">Implementations of some methods, such as [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md), are included in all support objects.</span></span> <span data-ttu-id="ac17d-122">Реализация других методов, таких как [IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md)применяется только к определенным объектам поддержки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-122">Implementations of other methods, such as [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), apply only to particular support objects.</span></span> <span data-ttu-id="ac17d-123">Только поставщики сообщений и поставщики транспорта могут использовать этот метод; когда поставщик адресной книги или служба сообщений пытается вызвать его, MAPI возвращает MAPI_E_NO_SUPPORT.</span><span class="sxs-lookup"><span data-stu-id="ac17d-123">Only message store and transport providers can use this method; when an address book provider or a message service try to call it, MAPI returns MAPI_E_NO_SUPPORT.</span></span>
  
<span data-ttu-id="ac17d-124">Объекты поддержки можно использовать для выполнения многих задач, например следующих:</span><span class="sxs-lookup"><span data-stu-id="ac17d-124">Support objects can be used to accomplish many tasks, such as the following:</span></span>
  
- <span data-ttu-id="ac17d-125">Доступ к разделу профилей.</span><span class="sxs-lookup"><span data-stu-id="ac17d-125">Accessing a profile section.</span></span>
    
- <span data-ttu-id="ac17d-126">Копирование папок или сообщений.</span><span class="sxs-lookup"><span data-stu-id="ac17d-126">Copying folders or messages.</span></span> <span data-ttu-id="ac17d-127">Дополнительные сведения см. в [тексте Копирование или Перемещение сообщения или папки.](copying-or-moving-a-message-or-a-folder.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-127">For more information, see [Copying or Moving a Message or a Folder](copying-or-moving-a-message-or-a-folder.md).</span></span>
    
- <span data-ttu-id="ac17d-128">Доступ к объектам, принадлежащим другим поставщикам.</span><span class="sxs-lookup"><span data-stu-id="ac17d-128">Accessing objects that belong to other providers.</span></span> <span data-ttu-id="ac17d-129">Дополнительные сведения см. в [дополнительных сведениях о поддержке доступа к объектам и сравнения.](supporting-object-access-and-comparison.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-129">For more information, see [Supporting Object Access and Comparison](supporting-object-access-and-comparison.md).</span></span> 
    
- <span data-ttu-id="ac17d-130">Обработка уведомлений о событиях.</span><span class="sxs-lookup"><span data-stu-id="ac17d-130">Handling event notification.</span></span> <span data-ttu-id="ac17d-131">Дополнительные сведения см. в [вспомогательных уведомлениях о событиях.](supporting-event-notification.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-131">For more information, see [Supporting Event Notification](supporting-event-notification.md).</span></span>
    
- <span data-ttu-id="ac17d-132">Напев и освободив память.</span><span class="sxs-lookup"><span data-stu-id="ac17d-132">Allocating and freeing memory.</span></span>
    
- <span data-ttu-id="ac17d-133">Получение уникального идентификатора.</span><span class="sxs-lookup"><span data-stu-id="ac17d-133">Obtaining a unique identifier.</span></span>
    
- <span data-ttu-id="ac17d-134">Недействительные объекты.</span><span class="sxs-lookup"><span data-stu-id="ac17d-134">Invalidating objects.</span></span>
    
- <span data-ttu-id="ac17d-135">Обработка ошибок.</span><span class="sxs-lookup"><span data-stu-id="ac17d-135">Handling errors.</span></span>
    
- <span data-ttu-id="ac17d-136">Регистрация препроцессоров сообщений.</span><span class="sxs-lookup"><span data-stu-id="ac17d-136">Registering message preprocessors.</span></span> 
    
- <span data-ttu-id="ac17d-137">Подготовка отчетов о доставке сообщений.</span><span class="sxs-lookup"><span data-stu-id="ac17d-137">Preparing message delivery reports.</span></span> 
    
<span data-ttu-id="ac17d-138">Во время логотипа MAPI вызывает метод logon для объекта поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="ac17d-138">At logon time, MAPI calls the logon method of each service provider's provider object.</span></span> <span data-ttu-id="ac17d-139">Для поставщиков адресных книг MAPI вызывает [IABProvider::Logon](iabprovider-logon.md).</span><span class="sxs-lookup"><span data-stu-id="ac17d-139">For address book providers, MAPI calls [IABProvider::Logon](iabprovider-logon.md).</span></span> <span data-ttu-id="ac17d-140">Для поставщиков магазинов сообщений MAPI вызывает [IMSProvider::Logon](imsprovider-logon.md).</span><span class="sxs-lookup"><span data-stu-id="ac17d-140">For message store providers, MAPI calls [IMSProvider::Logon](imsprovider-logon.md).</span></span> <span data-ttu-id="ac17d-141">Для поставщиков транспорта MAPI вызывает [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span><span class="sxs-lookup"><span data-stu-id="ac17d-141">For transport providers, MAPI calls [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span></span> <span data-ttu-id="ac17d-142">MAPI передает указатель соответствующему объекту поддержки в одном из параметров этого метода.</span><span class="sxs-lookup"><span data-stu-id="ac17d-142">MAPI passes a pointer to the appropriate support object in one of the parameters to this method.</span></span> <span data-ttu-id="ac17d-143">Метод logon, в свою очередь, моментиалит объект logon, передав ему указатель объекта поддержки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-143">The logon method in turn instantiates a logon object, passing it the support object pointer.</span></span> <span data-ttu-id="ac17d-144">Объект logon вызывает метод **IUnknown::AddRef,** чтобы при необходимости сохранить его.</span><span class="sxs-lookup"><span data-stu-id="ac17d-144">The logon object calls the support object's **IUnknown::AddRef** method to retain it, if necessary.</span></span> <span data-ttu-id="ac17d-145">Дополнительные сведения о процессе логона для поставщиков услуг см. в [этой информации.](starting-a-service-provider.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-145">For more information about the logon process for service providers, see [Starting a Service Provider](starting-a-service-provider.md).</span></span>
  
<span data-ttu-id="ac17d-146">При отключении клиента MAPI вызывает метод входа объекта logon.</span><span class="sxs-lookup"><span data-stu-id="ac17d-146">When a client logs off, MAPI calls the logon object's logoff method.</span></span> <span data-ttu-id="ac17d-147">Метод журнала вызывает метод **IUnknown::Release** объекта поддержки, чтобы указать, что поставщик больше не намерен вызывать какие-либо из методов поддержки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-147">The logoff method calls the support object's **IUnknown::Release** method to indicate that the provider no longer intends to call any of the support methods.</span></span> <span data-ttu-id="ac17d-148">Как и в logon, методы входа имеют несколько другие имена.</span><span class="sxs-lookup"><span data-stu-id="ac17d-148">As with logon, the logoff methods have slightly different names.</span></span> <span data-ttu-id="ac17d-149">Интерфейсы [IABLogon и](iablogoniunknown.md) [IMSLogon](imslogoniunknown.md) имеют **методы Logoff;** интерфейс [IXPLogon имеет](ixplogoniunknown.md) метод [TransportLogoff.](ixplogon-transportlogoff.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-149">The [IABLogon](iablogoniunknown.md) and [IMSLogon](imslogoniunknown.md) interfaces have **Logoff** methods; the [IXPLogon](ixplogoniunknown.md) interface has a [TransportLogoff](ixplogon-transportlogoff.md) method.</span></span> 
  
<span data-ttu-id="ac17d-150">Функции точки входа службы сообщений называются при сбойе попытки логона с ошибкой MAPI_E_UNCONFIGURED или когда клиент инициирует запрос конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ac17d-150">Message service entry point functions are called when a logon attempt fails with the error MAPI_E_UNCONFIGURED or when a client initiates a configuration request.</span></span> <span data-ttu-id="ac17d-151">MAPI мгновенно вызывает объект поддержки конфигурации и вызывает функцию точки входа службы сообщений для неконфигурованного поставщика или поставщика, конфигурация которого вот-вот изменится.</span><span class="sxs-lookup"><span data-stu-id="ac17d-151">MAPI instantiates a configuration support object and calls the message service entry point function for either the unconfigured provider or the provider whose configuration is about to change.</span></span> <span data-ttu-id="ac17d-152">В отличие от других объектов поддержки, объекты поддержки конфигурации действительны только до возвращения функции точки входа; Службы сообщений не называют методы **AddRef** этих объектов для их сохранения.</span><span class="sxs-lookup"><span data-stu-id="ac17d-152">Unlike the other support objects, configuration support objects are valid only until the entry point function returns; message services do not call these objects' **AddRef** methods to retain them.</span></span> 
  
<span data-ttu-id="ac17d-153">Как правило, MAPI вызывает функцию точки входа службы сообщений поставщика, но иногда поставщику предложено сделать вызов.</span><span class="sxs-lookup"><span data-stu-id="ac17d-153">Typically, MAPI makes calls to a provider's message service entry point function, but sometimes a provider is asked to make the call.</span></span> <span data-ttu-id="ac17d-154">Это может произойти, когда клиент вызывает метод [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) поставщика для отображения его таблицы свойств конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ac17d-154">This can occur when a client calls a provider's [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) method to prompt the provider to display its configuration property sheet.</span></span> <span data-ttu-id="ac17d-155">**SettingsDialog** должен вызвать [IMAPISupport::GetSvcConfigSupportObj,](imapisupport-getsvcconfigsupportobj.md) чтобы получить объект поддержки конфигурации, который он может передать функции точки входа службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="ac17d-155">**SettingsDialog** should call [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) to obtain a configuration support object that it can pass to the message service entry point function.</span></span> 
  
<span data-ttu-id="ac17d-156">Метод [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) доступен для определения адресов функций распределения и распределения памяти без привязки к MAPI.</span><span class="sxs-lookup"><span data-stu-id="ac17d-156">The [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) method is available for determining the addresses of the memory allocation and deallocation functions without having to link with MAPI.</span></span> <span data-ttu-id="ac17d-157">Использование **GetMemAllocRoutines** также упрощает отслеживание утечек памяти, окружав вызовы функции распределения кодом отладки.</span><span class="sxs-lookup"><span data-stu-id="ac17d-157">Using **GetMemAllocRoutines** also makes it easier to trace memory leaks by surrounding the allocation function calls with debugging code.</span></span> <span data-ttu-id="ac17d-158">Если вы вызываете **GetMemAllocRoutines**, как рекомендуется, перед вызовом функции [CreateIProp,](createiprop.md) которая требует адресов функции выделения в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="ac17d-158">If you call **GetMemAllocRoutines**, as is recommended, do so before calling the [CreateIProp](createiprop.md) function, which requires the allocation function addresses as parameters.</span></span> 
  
<span data-ttu-id="ac17d-159">При создании нового объекта адресной книги или магазина сообщений создайте и установите ключ поиска для объекта в **свойстве PR_SEARCH_KEY** [(PidTagSearchKey).](pidtagsearchkey-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-159">When you need to create a new address book or message store object, create and set a search key for the object in its **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) property.</span></span> <span data-ttu-id="ac17d-160">Позвоните [в IMAPISupport::NewUID,](imapisupport-newuid.md) чтобы получить уникальный идентификатор, который можно использовать при создании ключа поиска.</span><span class="sxs-lookup"><span data-stu-id="ac17d-160">Call [IMAPISupport::NewUID](imapisupport-newuid.md) to obtain a unique identifier to use in building a search key.</span></span> <span data-ttu-id="ac17d-161">Не используйте свой собственный жесткий код [MAPIUID](mapiuid.md).</span><span class="sxs-lookup"><span data-stu-id="ac17d-161">Do not use your own hard-coded [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="ac17d-162">**MAPIUID поставщика** должен использоваться только для идентификаторов записей.</span><span class="sxs-lookup"><span data-stu-id="ac17d-162">A provider's **MAPIUID** should be used only for entry identifiers.</span></span> <span data-ttu-id="ac17d-163">Дополнительные сведения о построении ключей поиска см. в [записи MAPI и клавишах поиска.](mapi-record-and-search-keys.md)</span><span class="sxs-lookup"><span data-stu-id="ac17d-163">For more information about constructing search keys, see [MAPI Record and Search Keys](mapi-record-and-search-keys.md).</span></span>
  
<span data-ttu-id="ac17d-164">Клиентские приложения иногда могут выпускать объект, не выпуская один или несколько связанных с ним объектов.</span><span class="sxs-lookup"><span data-stu-id="ac17d-164">A client application can sometimes release an object without releasing one or more of its affiliated objects.</span></span> <span data-ttu-id="ac17d-165">В этом случае поставщику может потребоваться сделать неиспользоваемый объект непригодным для оказания помощи.</span><span class="sxs-lookup"><span data-stu-id="ac17d-165">In such a case, a provider may need to render an unreleased object unusable.</span></span> <span data-ttu-id="ac17d-166">Для этого поставщик освободит все ресурсы, связанные с объектом, а затем вызывает [IMAPISupport::MakeInvalid,](imapisupport-makeinvalid.md) чтобы признать недействительным vtable объекта.</span><span class="sxs-lookup"><span data-stu-id="ac17d-166">To do this, the provider frees all of the resources connected with the object and then calls [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) to invalidate the object's vtable.</span></span> <span data-ttu-id="ac17d-167">**MakeInvalid** заменяет методы **IUnknown** vtable **(QueryInterface,** **AddRef** и **Release)** стандартными реализациями MAPI и вызывает возвращение всех других методов MAPI_E_INVALID_OBJECT.</span><span class="sxs-lookup"><span data-stu-id="ac17d-167">**MakeInvalid** replaces the vtable's **IUnknown** methods (**QueryInterface**, **AddRef**, and **Release**) with standard MAPI implementations and causes all other methods to return MAPI_E_INVALID_OBJECT.</span></span> <span data-ttu-id="ac17d-168">**MakeInvalid** также освободит всю память объекта, кроме vtable.</span><span class="sxs-lookup"><span data-stu-id="ac17d-168">**MakeInvalid** also frees all the object's memory other than the vtable.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="ac17d-169">См. также</span><span class="sxs-lookup"><span data-stu-id="ac17d-169">See also</span></span>



[<span data-ttu-id="ac17d-170">Поставщики услуг MAPI</span><span class="sxs-lookup"><span data-stu-id="ac17d-170">MAPI Service Providers</span></span>](mapi-service-providers.md)

