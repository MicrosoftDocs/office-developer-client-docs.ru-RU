---
title: Обзор объектов поддержки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 55d8a9c78ae5132eaa8cf0f0aec5b252ef83b926
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433614"
---
# <a name="support-object-overview"></a>Обзор объектов поддержки

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
MAPI представляет объект поддержки, который реализует интерфейс [IMAPISupport : IUnknown,](imapisupportiunknown.md) для всех поставщиков служб во время выполнения и для всех служб сообщений во время настройки. 
  
Клиенты не могут сделать объекты поддержки недоступными; они реализованы с помощью MAPI и вызваны только поставщиками услуг. Интерфейс **IMAPISupport** указывается в файле заголовок Mapispi.h. Идентификатором является IID_IMAPISup, а типом указателя является LPMAPISUP. Объекты поддержки не имеют свойств MAPI. 
  
Поставщику может быть предоставлен один или несколько объектов поддержки в зависимости от того, сколько раз MAPI занося в журнал поставщика или сколько раз была вызвана функция записи службы сообщений поставщика. Как правило, поставщик вошел в систему по крайней мере один раз в сеансе. Поставщики адресной книги и транспорта регистрируются каждый раз, когда клиент начинает сеанс с помощью записи профиля, которая их запрашивает. Поставщики хранилищ сообщений регистрируются при каждом вызове клиентом метода [IMAPISession::OpenMsgStore.](imapisession-openmsgstore.md) 
  
При использовании нескольких учетных то есть в сеансе можно либо сохранить и использовать каждый объект поддержки отдельно, либо сохранить и использовать только первый, отклоняя каждый последующий объект поддержки. Чтобы сохранить объект поддержки, вызовите его метод **IUnknown::AddRef.** Вызов **AddRef** для объекта поддержки, который вы хотите сохранить во время сеанса, очень важен; Если вызов не выполнен, MAPI освобождает объект поддержки и освобождает память. 
  
Объект поддержки предназначен для реализации довольно большого числа методов, часто используемых поставщиками. Каждый объект поддержки также содержит контекстные данные, специфические для своего экземпляра, например сеанс, в котором работает поставщик, раздел профиля, который использует поставщик, и сведения об ошибке для сеанса. 
  
Существует четыре различных типа объектов поддержки: один для каждого крупного типа поставщика (адресная книга, хранилище сообщений и транспорт) и один для поддержки конфигурации. 
  
MAPI настраивает каждый объект поддержки, включив реализации методов, релевантные для его использования. Реализации некоторых методов, например [IMAPISupport::OpenProfileSection,](imapisupport-openprofilesection.md)включены во все объекты поддержки. Реализации других методов, например [IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md)применяются только к определенным объектам поддержки. Этот метод может применяться только поставщиками хранения сообщений и транспорта; Когда поставщик адресной книги или служба сообщений пытается вызвать ее, MAPI возвращает MAPI_E_NO_SUPPORT.
  
Объекты поддержки можно использовать для выполнения многих задач, например:
  
- Доступ к разделу профиля.
    
- Копирование папок или сообщений. Дополнительные сведения см. в сведениях о копировании [или перемещении сообщения или папки.](copying-or-moving-a-message-or-a-folder.md)
    
- Доступ к объектам, принадлежащим другим поставщикам. Дополнительные сведения см. в [дополнительных сведениях о поддержке доступа к объектам и сравнения.](supporting-object-access-and-comparison.md) 
    
- Обработка уведомления о событии. Дополнительные сведения см. в [соответствующем уведомлении.](supporting-event-notification.md)
    
- Выбор и освободит память.
    
- Получение уникального идентификатора.
    
- Недействительные объекты.
    
- Обработка ошибок.
    
- Регистрация препроцессоров сообщений. 
    
- Подготовка отчетов о доставке сообщений. 
    
Во время логотипа MAPI вызывает метод для каждого объекта поставщика службы. Для поставщиков адресных книг MAPI вызывает [IABProvider::Logon.](iabprovider-logon.md) Для поставщиков store сообщений MAPI вызывает [IMSProvider::Logon.](imsprovider-logon.md) Для поставщиков транспорта MAPI вызывает [IXPProvider::TransportLogon.](ixpprovider-transportlogon.md) MAPI передает указатель на соответствующий объект поддержки в одном из параметров этого метода. Метод для логотипа, в свою очередь, представляет объект для логотипа, передавая ему указатель на объект поддержки. Объект для логотипа вызывает метод **IUnknown::AddRef** объекта поддержки, чтобы сохранить его при необходимости. Дополнительные сведения о процессе запуска для поставщиков услуг см. в процедуре [запуска поставщика услуг.](starting-a-service-provider.md)
  
Когда клиент выключается, MAPI вызывает метод выйдите из объекта входа. Метод выхода вызывает метод **IUnknown::Release** объекта поддержки, чтобы указать, что поставщик больше не собирается вызывать какие-либо из методов поддержки. Как и при входе в систему, имена методов входа немного отличаются. Интерфейсы [IABLogon](iablogoniunknown.md) и [IMSLogon](imslogoniunknown.md) имеют методы **Logoff;** Интерфейс [IXPLogon имеет](ixplogoniunknown.md) метод [TransportLogoff.](ixplogon-transportlogoff.md) 
  
Функции точки входа службы сообщений вызваны, когда попытка входа не выполняется с ошибкой MAPI_E_UNCONFIGURED или когда клиент инициирует запрос конфигурации. MAPI вызывает объект поддержки конфигурации и вызывает функцию точки входа службы сообщений для ненастроенного поставщика или поставщика, конфигурация которого вот-вот изменится. В отличие от других объектов поддержки, объекты поддержки конфигурации действительны только до тех пор, пока не будет возвращена функция точки входа; службы сообщений не называют методы **AddRef** этих объектов для их сохранения. 
  
Как правило, MAPI вызывает функцию точки входа службы сообщений поставщика, но иногда поставщику будет предложено позвонить. Это может произойти, когда клиент вызывает метод [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) поставщика, чтобы он отображал свою таблицу свойств конфигурации. **SettingsDialog** должен вызвать [IMAPISupport::GetSvcConfigSupportObj,](imapisupport-getsvcconfigsupportobj.md) чтобы получить объект поддержки конфигурации, который он может передать функции точки входа службы сообщений. 
  
Метод [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) доступен для определения адресов функций выделения памяти и распределения без привязки к MAPI. Использование **GetMemAllocRoutines** также упрощает трассировку утечек памяти путем вокруг вызовов функции выделения с помощью кода отладки. Если вы вызываете **GetMemAllocRoutines**, как рекомендуется, сделайте это перед вызовом функции [CreateIProp,](createiprop.md) которая требует адресов функции выделения в качестве параметров. 
  
Если необходимо создать новую адресную книгу или объект хранения сообщений, создайте и задайте ключ поиска для объекта в его свойстве **PR_SEARCH_KEY** ([PidTagSearchKey).](pidtagsearchkey-canonical-property.md) Вызовите [IMAPISupport::NewUID,](imapisupport-newuid.md) чтобы получить уникальный идентификатор, который будет применяться при создании ключа поиска. Не используйте собственный жестко задав код [MAPIUID.](mapiuid.md) **MAPIUID** поставщика должен использоваться только для идентификаторов записей. Дополнительные сведения о построении ключей поиска см. в записях [MAPI и поисковых ключах.](mapi-record-and-search-keys.md)
  
Клиентские приложения иногда могут освободить объект, не освобождая один или несколько связанных с ним объектов. В этом случае поставщику может потребоваться отрисовка непригодного для нее объекта. Для этого поставщик освободит все ресурсы, подключенные к объекту, а затем вызывает [IMAPISupport::MakeInvalid,](imapisupport-makeinvalid.md) чтобы сделать недействительной ветвь объекта. **MakeInvalid** заменяет методы **IUnknown** vtable **(QueryInterface,** **AddRef** и **Release)** стандартными реализациями MAPI и возвращает все остальные методы MAPI_E_INVALID_OBJECT. **MakeInvalid** также освободит всю память объекта, кроме vtable. 
  
## <a name="see-also"></a>См. также



[Поставщики услуг MAPI](mapi-service-providers.md)

