---
title: Обзор объектов поддержки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 55d8a9c78ae5132eaa8cf0f0aec5b252ef83b926
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433614"
---
# <a name="support-object-overview"></a><span data-ttu-id="3d6b7-103">Обзор объектов поддержки</span><span class="sxs-lookup"><span data-stu-id="3d6b7-103">Support Object Overview</span></span>

  
  
<span data-ttu-id="3d6b7-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="3d6b7-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="3d6b7-105">MAPI предоставляет объект поддержки, объект, реализующий интерфейс [имаписуппорт: IUnknown](imapisupportiunknown.md) , для всех поставщиков служб во время входа и для всех служб сообщений во время настройки.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-105">MAPI furnishes a support object, an object that implements the [IMAPISupport : IUnknown](imapisupportiunknown.md) interface, for all service providers during logon and for all message services during configuration.</span></span> 
  
<span data-ttu-id="3d6b7-106">Объекты поддержки не доступны клиентам; они реализуются MAPI и вызываются только поставщиками служб.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-106">Support objects are not accessible by clients; they are implemented by MAPI and called only by service providers.</span></span> <span data-ttu-id="3d6b7-107">Интерфейс **имаписуппорт** указывается в файле заголовка маписпи. h.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-107">The **IMAPISupport** interface is specified in the Mapispi.h header file.</span></span> <span data-ttu-id="3d6b7-108">Его идентификатор IID_IMAPISup, а тип его указателя — ЛПМАПИСУП.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-108">Its identifier is IID_IMAPISup and its pointer type is LPMAPISUP.</span></span> <span data-ttu-id="3d6b7-109">Объекты поддержки не представляют свойства MAPI.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-109">No MAPI properties are exposed by support objects.</span></span> 
  
<span data-ttu-id="3d6b7-110">Поставщику может быть назначен один или несколько объектов поддержки, в зависимости от того, сколько раз протокол MAPI регистрирует поставщик, или сколько раз вызывается функция записи службы сообщений поставщика.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-110">A provider can be given one or more support objects, depending on the number of times MAPI logs the provider on or the number of times the provider's message service entry function is called.</span></span> <span data-ttu-id="3d6b7-111">Как правило, поставщик будет зарегистрирован как минимум один раз для каждого сеанса.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-111">Typically, a provider will be logged on at least once per session.</span></span> <span data-ttu-id="3d6b7-112">Адресные книги и поставщики транспорта записываются каждый раз, когда клиент начинает сеанс с записью профиля, запрашивающей их.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-112">Address book and transport providers are logged on every time a client starts a session with a profile entry that requests them.</span></span> <span data-ttu-id="3d6b7-113">Поставщики хранилища сообщений записываются каждый раз, когда клиент вызывает метод [IMAPISession:: опенмсгсторе](imapisession-openmsgstore.md) .</span><span class="sxs-lookup"><span data-stu-id="3d6b7-113">Message store providers are logged on every time a client calls the [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) method.</span></span> 
  
<span data-ttu-id="3d6b7-114">В случае с несколькими входами в сеансе можно выбрать сохранение и использование каждого объекта поддержки отдельно или сохранить и использовать только первый, отменяющий каждый последующий объект поддержки.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-114">In the case of multiple logons in a session, you can choose either to retain and use each support object separately or to retain and use only the first, discarding each subsequent support object.</span></span> <span data-ttu-id="3d6b7-115">Чтобы сохранить объект поддержки, вызовите его метод **IUnknown:: AddRef** .</span><span class="sxs-lookup"><span data-stu-id="3d6b7-115">To retain a support object, call its **IUnknown::AddRef** method.</span></span> <span data-ttu-id="3d6b7-116">Вызов **AddRef** для объекта поддержки, который необходимо хранить во время сеанса, чрезвычайно важен; Если вызов не выполняется, MAPI освобождает объект поддержки и освобождает память.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-116">Calling **AddRef** on a support object that you want to retain throughout a session is extremely important; if the call is not made, MAPI releases the support object and frees its memory.</span></span> 
  
<span data-ttu-id="3d6b7-117">Цель объекта поддержки состоит в том, чтобы реализовать достаточно большое количество методов, которые обычно используются поставщиками.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-117">The purpose of the support object is to provide implementations for a fairly large number of methods commonly used by the providers.</span></span> <span data-ttu-id="3d6b7-118">Каждый объект support также содержит контекстные данные, относящиеся к собственному экземпляру, например сеанс, в котором выполняется поставщик, раздел профиля, который использует поставщик, и сведения об ошибке для сеанса.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-118">Each support object also contains contextual data specific to its own instance, such as the session the provider is running in, the profile section the provider is using, and error information for the session.</span></span> 
  
<span data-ttu-id="3d6b7-119">Существует четыре различных типа объектов поддержки: один для каждого типа основных поставщиков (адресная книга, хранилище сообщений и транспорт), а другая — для поддержки конфигурации.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-119">There are four different types of support objects: one for each major provider type (address book, message store, and transport) and one for configuration support.</span></span> 
  
<span data-ttu-id="3d6b7-120">MAPI настраивает каждый объект поддержки, включая реализации методов, которые относятся к его использованию.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-120">MAPI customizes each support object by including implementations of methods that are relevant for its usage.</span></span> <span data-ttu-id="3d6b7-121">Реализации некоторых методов, таких как [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md), включаются во все объекты support.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-121">Implementations of some methods, such as [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md), are included in all support objects.</span></span> <span data-ttu-id="3d6b7-122">Реализации других методов, например [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md), применяются только к определенным объектам поддержки.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-122">Implementations of other methods, such as [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), apply only to particular support objects.</span></span> <span data-ttu-id="3d6b7-123">Этот метод могут использовать только хранилище сообщений и поставщики транспорта. когда поставщик адресных книг или служба сообщений пытаются позвонить, MAPI возвращает MAPI_E_NO_SUPPORT.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-123">Only message store and transport providers can use this method; when an address book provider or a message service try to call it, MAPI returns MAPI_E_NO_SUPPORT.</span></span>
  
<span data-ttu-id="3d6b7-124">Объекты поддержки можно использовать для выполнения многих задач, в том числе следующих:</span><span class="sxs-lookup"><span data-stu-id="3d6b7-124">Support objects can be used to accomplish many tasks, such as the following:</span></span>
  
- <span data-ttu-id="3d6b7-125">Доступ к разделу профиля.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-125">Accessing a profile section.</span></span>
    
- <span data-ttu-id="3d6b7-126">Копирование папок или сообщений.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-126">Copying folders or messages.</span></span> <span data-ttu-id="3d6b7-127">Более подробную информацию можно узнать в статье [копирование или перемещение сообщения или папки](copying-or-moving-a-message-or-a-folder.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-127">For more information, see [Copying or Moving a Message or a Folder](copying-or-moving-a-message-or-a-folder.md).</span></span>
    
- <span data-ttu-id="3d6b7-128">Доступ к объектам, принадлежащим другим поставщикам.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-128">Accessing objects that belong to other providers.</span></span> <span data-ttu-id="3d6b7-129">Дополнительные сведения см в разделе [Поддержка доступа к объектам и сравнение](supporting-object-access-and-comparison.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-129">For more information, see [Supporting Object Access and Comparison](supporting-object-access-and-comparison.md).</span></span> 
    
- <span data-ttu-id="3d6b7-130">Обработка уведомления о событии.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-130">Handling event notification.</span></span> <span data-ttu-id="3d6b7-131">Более подробную информацию можно узнать в статье [Поддержка уведомлений о событиях](supporting-event-notification.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-131">For more information, see [Supporting Event Notification](supporting-event-notification.md).</span></span>
    
- <span data-ttu-id="3d6b7-132">Выделение и освобождение памяти.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-132">Allocating and freeing memory.</span></span>
    
- <span data-ttu-id="3d6b7-133">Получение уникального идентификатора.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-133">Obtaining a unique identifier.</span></span>
    
- <span data-ttu-id="3d6b7-134">Непроверяемые объекты.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-134">Invalidating objects.</span></span>
    
- <span data-ttu-id="3d6b7-135">Обработка ошибок.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-135">Handling errors.</span></span>
    
- <span data-ttu-id="3d6b7-136">Регистрация препроцессора сообщений.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-136">Registering message preprocessors.</span></span> 
    
- <span data-ttu-id="3d6b7-137">Подготовка отчетов о доставке сообщений.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-137">Preparing message delivery reports.</span></span> 
    
<span data-ttu-id="3d6b7-138">При входе в систему MAPI вызывает метод logon для каждого объекта поставщика поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-138">At logon time, MAPI calls the logon method of each service provider's provider object.</span></span> <span data-ttu-id="3d6b7-139">Для поставщиков адресных книг MAPI вызывает [иабпровидер:: logon](iabprovider-logon.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-139">For address book providers, MAPI calls [IABProvider::Logon](iabprovider-logon.md).</span></span> <span data-ttu-id="3d6b7-140">Для поставщиков хранилищ сообщений вызовы MAPI [функцииimsprovider:: logon](imsprovider-logon.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-140">For message store providers, MAPI calls [IMSProvider::Logon](imsprovider-logon.md).</span></span> <span data-ttu-id="3d6b7-141">Для поставщиков транспорта вызовы MAPI [иксппровидер:: транспортлогон](ixpprovider-transportlogon.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-141">For transport providers, MAPI calls [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span></span> <span data-ttu-id="3d6b7-142">MAPI передает указатель на соответствующий объект поддержки в одном из параметров для этого метода.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-142">MAPI passes a pointer to the appropriate support object in one of the parameters to this method.</span></span> <span data-ttu-id="3d6b7-143">Метод logon, в свою очередь, создает экземпляр объекта logon, передавая ему указатель на объект support.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-143">The logon method in turn instantiates a logon object, passing it the support object pointer.</span></span> <span data-ttu-id="3d6b7-144">Объект logon вызывает метод **IUnknown:: AddRef** объекта support для сохранения, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-144">The logon object calls the support object's **IUnknown::AddRef** method to retain it, if necessary.</span></span> <span data-ttu-id="3d6b7-145">Дополнительные сведения о процессе входа для поставщиков услуг приведены в разделе [Запуск поставщика услуг](starting-a-service-provider.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-145">For more information about the logon process for service providers, see [Starting a Service Provider](starting-a-service-provider.md).</span></span>
  
<span data-ttu-id="3d6b7-146">Когда клиент выходит из системы, MAPI вызывает метод logoff для объекта logon.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-146">When a client logs off, MAPI calls the logon object's logoff method.</span></span> <span data-ttu-id="3d6b7-147">Метод logoff вызывает метод **IUnknown:: Release** объекта support, чтобы показать, что поставщик больше не планирует вызывать какие бы то ни было методы поддержки.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-147">The logoff method calls the support object's **IUnknown::Release** method to indicate that the provider no longer intends to call any of the support methods.</span></span> <span data-ttu-id="3d6b7-148">Как и при входе в систему, методы выхода имеют несколько разных имен.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-148">As with logon, the logoff methods have slightly different names.</span></span> <span data-ttu-id="3d6b7-149">Интерфейсы [иаблогон](iablogoniunknown.md) и [Имслогон](imslogoniunknown.md) имеют методы **выхода** ; интерфейс [иксплогон](ixplogoniunknown.md) имеет метод [транспортлогофф](ixplogon-transportlogoff.md) .</span><span class="sxs-lookup"><span data-stu-id="3d6b7-149">The [IABLogon](iablogoniunknown.md) and [IMSLogon](imslogoniunknown.md) interfaces have **Logoff** methods; the [IXPLogon](ixplogoniunknown.md) interface has a [TransportLogoff](ixplogon-transportlogoff.md) method.</span></span> 
  
<span data-ttu-id="3d6b7-150">Функции точки входа службы сообщений вызываются при неудачной попытке входа с ошибкой MAPI_E_UNCONFIGURED или когда клиент инициирует запрос на настройку.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-150">Message service entry point functions are called when a logon attempt fails with the error MAPI_E_UNCONFIGURED or when a client initiates a configuration request.</span></span> <span data-ttu-id="3d6b7-151">MAPI создает экземпляр объекта поддержки конфигурации и вызывает функцию точки входа службы сообщений для ненастроенного поставщика или поставщика, конфигурацию которого собираетесь изменить.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-151">MAPI instantiates a configuration support object and calls the message service entry point function for either the unconfigured provider or the provider whose configuration is about to change.</span></span> <span data-ttu-id="3d6b7-152">В отличие от других объектов поддержки, объекты поддержки конфигурации действительны только до возвращения функции точки входа; службы сообщений не вызывают методы **AddRef** этих объектов для их хранения.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-152">Unlike the other support objects, configuration support objects are valid only until the entry point function returns; message services do not call these objects' **AddRef** methods to retain them.</span></span> 
  
<span data-ttu-id="3d6b7-153">Как правило, протокол MAPI вызывает функцию точки входа службы сообщений поставщика, но иногда поставщику предлагается совершить вызов.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-153">Typically, MAPI makes calls to a provider's message service entry point function, but sometimes a provider is asked to make the call.</span></span> <span data-ttu-id="3d6b7-154">Это может произойти, когда клиент вызывает метод [имапистатус:: сеттингсдиалог](imapistatus-settingsdialog.md) поставщика, чтобы запросить у поставщика отображение его страницы свойств конфигурации.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-154">This can occur when a client calls a provider's [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) method to prompt the provider to display its configuration property sheet.</span></span> <span data-ttu-id="3d6b7-155">**Сеттингсдиалог** должен вызывать [Имаписуппорт:: жетсвкконфигсуппортобж](imapisupport-getsvcconfigsupportobj.md) , чтобы получить объект поддержки конфигурации, который он может передать в функцию точки входа службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-155">**SettingsDialog** should call [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) to obtain a configuration support object that it can pass to the message service entry point function.</span></span> 
  
<span data-ttu-id="3d6b7-156">Метод [имаписуппорт:: жетмемаллокраутинес](imapisupport-getmemallocroutines.md) доступен для определения адресов функций выделения и изъятия памяти без необходимости связи с MAPI.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-156">The [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) method is available for determining the addresses of the memory allocation and deallocation functions without having to link with MAPI.</span></span> <span data-ttu-id="3d6b7-157">Использование **жетмемаллокраутинес** также упрощает отслеживание утечек памяти за счет заключения вызовов функций выделения с помощью отлаживаемого кода.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-157">Using **GetMemAllocRoutines** also makes it easier to trace memory leaks by surrounding the allocation function calls with debugging code.</span></span> <span data-ttu-id="3d6b7-158">Если вы вызываете **жетмемаллокраутинес**, как рекомендуется, сделайте это перед вызовом функции [креатеипроп](createiprop.md) , которая требует, чтобы функция выделения адресов была в качестве параметров.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-158">If you call **GetMemAllocRoutines**, as is recommended, do so before calling the [CreateIProp](createiprop.md) function, which requires the allocation function addresses as parameters.</span></span> 
  
<span data-ttu-id="3d6b7-159">Если вам нужно создать новую адресную книгу или объект хранилища сообщений, создайте и задайте ключ поиска для объекта в его свойстве **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-159">When you need to create a new address book or message store object, create and set a search key for the object in its **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) property.</span></span> <span data-ttu-id="3d6b7-160">Call [имаписуппорт:: невуид](imapisupport-newuid.md) для получения уникального идентификатора, используемого при создании ключа поиска.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-160">Call [IMAPISupport::NewUID](imapisupport-newuid.md) to obtain a unique identifier to use in building a search key.</span></span> <span data-ttu-id="3d6b7-161">Не используйте собственные жестко запрограммированные [мапиуид](mapiuid.md).</span><span class="sxs-lookup"><span data-stu-id="3d6b7-161">Do not use your own hard-coded [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="3d6b7-162">**Мапиуид** поставщика следует использовать только для идентификаторов записей.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-162">A provider's **MAPIUID** should be used only for entry identifiers.</span></span> <span data-ttu-id="3d6b7-163">Дополнительные сведения о создании ключей поиска можно найти в разделе " [записи и поисковые ключи MAPI](mapi-record-and-search-keys.md)".</span><span class="sxs-lookup"><span data-stu-id="3d6b7-163">For more information about constructing search keys, see [MAPI Record and Search Keys](mapi-record-and-search-keys.md).</span></span>
  
<span data-ttu-id="3d6b7-164">Клиентское приложение иногда может освободить объект, не открывая один или несколько из его прикрепленных объектов.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-164">A client application can sometimes release an object without releasing one or more of its affiliated objects.</span></span> <span data-ttu-id="3d6b7-165">В таком случае поставщику может потребоваться отобразить Неосвобожденный объект, который будет недоступен для использования.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-165">In such a case, a provider may need to render an unreleased object unusable.</span></span> <span data-ttu-id="3d6b7-166">Для этого поставщик освобождает все ресурсы, связанные с объектом, а затем вызывает метод [имаписуппорт:: макеинвалид](imapisupport-makeinvalid.md) , чтобы сделать недействительным таблицу vtable объекта.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-166">To do this, the provider frees all of the resources connected with the object and then calls [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) to invalidate the object's vtable.</span></span> <span data-ttu-id="3d6b7-167">**Макеинвалид** заменяет методы **IUnknown** для vtable (**QueryInterface**, **ADDREF**и **Release**) на стандартные реализации MAPI и приводит к тому, что все остальные методы возвращают MAPI_E_INVALID_OBJECT.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-167">**MakeInvalid** replaces the vtable's **IUnknown** methods (**QueryInterface**, **AddRef**, and **Release**) with standard MAPI implementations and causes all other methods to return MAPI_E_INVALID_OBJECT.</span></span> <span data-ttu-id="3d6b7-168">**Макеинвалид** также освобождает всю память объекта, кроме таблицы vtable.</span><span class="sxs-lookup"><span data-stu-id="3d6b7-168">**MakeInvalid** also frees all the object's memory other than the vtable.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="3d6b7-169">См. также</span><span class="sxs-lookup"><span data-stu-id="3d6b7-169">See also</span></span>



[<span data-ttu-id="3d6b7-170">Поставщики службы MAPI</span><span class="sxs-lookup"><span data-stu-id="3d6b7-170">MAPI Service Providers</span></span>](mapi-service-providers.md)

