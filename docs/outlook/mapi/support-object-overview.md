---
title: Обзор поддержки объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 7f43a50d08daedc623fa1e4570eafa5d58be71f6
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22577438"
---
# <a name="support-object-overview"></a><span data-ttu-id="699b3-103">Обзор поддержки объектов</span><span class="sxs-lookup"><span data-stu-id="699b3-103">Support Object Overview</span></span>

  
  
<span data-ttu-id="699b3-104">**Применимо к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="699b3-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="699b3-105">MAPI предоставляющей объект поддержки объект, реализующий [IMAPISupport: IUnknown](imapisupportiunknown.md) интерфейс для всех поставщиков услуг при входе в систему и для всех служб сообщения во время настройки.</span><span class="sxs-lookup"><span data-stu-id="699b3-105">MAPI furnishes a support object, an object that implements the [IMAPISupport : IUnknown](imapisupportiunknown.md) interface, for all service providers during logon and for all message services during configuration.</span></span> 
  
<span data-ttu-id="699b3-106">Объекты поддержки недоступны для клиентов; они являются реализован MAPI и вызывается только поставщиков услуг.</span><span class="sxs-lookup"><span data-stu-id="699b3-106">Support objects are not accessible by clients; they are implemented by MAPI and called only by service providers.</span></span> <span data-ttu-id="699b3-107">Интерфейс **IMAPISupport** указана в файле заголовка Mapispi.h.</span><span class="sxs-lookup"><span data-stu-id="699b3-107">The **IMAPISupport** interface is specified in the Mapispi.h header file.</span></span> <span data-ttu-id="699b3-108">Идентификатор является IID_IMAPISup и его тип указателя является LPMAPISUP.</span><span class="sxs-lookup"><span data-stu-id="699b3-108">Its identifier is IID_IMAPISup and its pointer type is LPMAPISUP.</span></span> <span data-ttu-id="699b3-109">Свойства MAPI, не предоставляемые интерфейсом объекты поддержки.</span><span class="sxs-lookup"><span data-stu-id="699b3-109">No MAPI properties are exposed by support objects.</span></span> 
  
<span data-ttu-id="699b3-110">Поставщик может быть задан один или несколько объектов поддержки, в зависимости от того, сколько раз MAPI входе поставщик или сколько раз вызывается функция запись службы поставщика сообщения.</span><span class="sxs-lookup"><span data-stu-id="699b3-110">A provider can be given one or more support objects, depending on the number of times MAPI logs the provider on or the number of times the provider's message service entry function is called.</span></span> <span data-ttu-id="699b3-111">Как правило поставщик будет войти в систему по крайней мере один раз за сеанс.</span><span class="sxs-lookup"><span data-stu-id="699b3-111">Typically, a provider will be logged on at least once per session.</span></span> <span data-ttu-id="699b3-112">Поставщики адресной книги и транспорта вход при каждом запуске клиента сеанса с записью профиля, который их запрашивает.</span><span class="sxs-lookup"><span data-stu-id="699b3-112">Address book and transport providers are logged on every time a client starts a session with a profile entry that requests them.</span></span> <span data-ttu-id="699b3-113">Поставщики хранилища сообщений вход при каждом клиент вызывает метод [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) .</span><span class="sxs-lookup"><span data-stu-id="699b3-113">Message store providers are logged on every time a client calls the [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) method.</span></span> 
  
<span data-ttu-id="699b3-114">В случае нескольких входов в систему в сеансе вы можете либо удержания и использовать каждый объект поддержки отдельно для удержания и использовать только первые пропуск каждого объекта последующих поддержки.</span><span class="sxs-lookup"><span data-stu-id="699b3-114">In the case of multiple logons in a session, you can choose either to retain and use each support object separately or to retain and use only the first, discarding each subsequent support object.</span></span> <span data-ttu-id="699b3-115">Чтобы сохранить объект поддержки, вызове метода **IUnknown::AddRef** .</span><span class="sxs-lookup"><span data-stu-id="699b3-115">To retain a support object, call its **IUnknown::AddRef** method.</span></span> <span data-ttu-id="699b3-116">Вызов **AddRef** для поддержки объекта, который необходимо сохранить в сеансе играет важнейшую роль; Если вызов не выполняется, MAPI освобождает объект поддержки и освобождает его память.</span><span class="sxs-lookup"><span data-stu-id="699b3-116">Calling **AddRef** on a support object that you want to retain throughout a session is extremely important; if the call is not made, MAPI releases the support object and frees its memory.</span></span> 
  
<span data-ttu-id="699b3-117">Объект поддержки предназначен для предоставления реализаций довольно много методы, обычно используемые поставщиками.</span><span class="sxs-lookup"><span data-stu-id="699b3-117">The purpose of the support object is to provide implementations for a fairly large number of methods commonly used by the providers.</span></span> <span data-ttu-id="699b3-118">Каждый объект поддержки также содержит контекстную данные, относящиеся к собственному экземпляру, такие как поставщик работает в раздел профиля, который использует поставщик сеанса и сведения об ошибках для сеанса.</span><span class="sxs-lookup"><span data-stu-id="699b3-118">Each support object also contains contextual data specific to its own instance, such as the session the provider is running in, the profile section the provider is using, and error information for the session.</span></span> 
  
<span data-ttu-id="699b3-119">Существует четыре разных типов объектов поддержки: один для каждого типа основных поставщика (адресной книги, хранилища сообщений и транспорта), а другая — для поддержки конфигурации.</span><span class="sxs-lookup"><span data-stu-id="699b3-119">There are four different types of support objects: one for each major provider type (address book, message store, and transport) and one for configuration support.</span></span> 
  
<span data-ttu-id="699b3-120">MAPI настраивает каждого объекта поддержки, включая реализации методов, которые относятся к его использования.</span><span class="sxs-lookup"><span data-stu-id="699b3-120">MAPI customizes each support object by including implementations of methods that are relevant for its usage.</span></span> <span data-ttu-id="699b3-121">Реализации некоторые методы, такие как [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)включены в все объекты поддержки.</span><span class="sxs-lookup"><span data-stu-id="699b3-121">Implementations of some methods, such as [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md), are included in all support objects.</span></span> <span data-ttu-id="699b3-122">Реализации другие методы, такие как [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), применяются только к объектов определенного поддержки.</span><span class="sxs-lookup"><span data-stu-id="699b3-122">Implementations of other methods, such as [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), apply only to particular support objects.</span></span> <span data-ttu-id="699b3-123">Только сообщение хранилища и поставщиками транспорта можно использовать этот метод; При попытке вызова поставщика адресных книг или службы сообщений MAPI возвращает MAPI_E_NO_SUPPORT.</span><span class="sxs-lookup"><span data-stu-id="699b3-123">Only message store and transport providers can use this method; when an address book provider or a message service try to call it, MAPI returns MAPI_E_NO_SUPPORT.</span></span>
  
<span data-ttu-id="699b3-124">Объекты поддержки можно использовать для выполнения многих задач, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="699b3-124">Support objects can be used to accomplish many tasks, such as the following:</span></span>
  
- <span data-ttu-id="699b3-125">Доступ к профиля.</span><span class="sxs-lookup"><span data-stu-id="699b3-125">Accessing a profile section.</span></span>
    
- <span data-ttu-id="699b3-126">Копирование папок или сообщений.</span><span class="sxs-lookup"><span data-stu-id="699b3-126">Copying folders or messages.</span></span> <span data-ttu-id="699b3-127">Для получения дополнительных сведений см. [копирование или перехода сообщение или папку](copying-or-moving-a-message-or-a-folder.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-127">For more information, see [Copying or Moving a Message or a Folder](copying-or-moving-a-message-or-a-folder.md).</span></span>
    
- <span data-ttu-id="699b3-128">Доступ к объектам, относящихся к других поставщиков.</span><span class="sxs-lookup"><span data-stu-id="699b3-128">Accessing objects that belong to other providers.</span></span> <span data-ttu-id="699b3-129">Для получения дополнительных сведений см [Поддержка доступа к объектам и сравнения](supporting-object-access-and-comparison.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-129">For more information, see [Supporting Object Access and Comparison](supporting-object-access-and-comparison.md).</span></span> 
    
- <span data-ttu-id="699b3-130">Обработка события уведомления.</span><span class="sxs-lookup"><span data-stu-id="699b3-130">Handling event notification.</span></span> <span data-ttu-id="699b3-131">Для получения дополнительных сведений см [Поддержка уведомления о событии](supporting-event-notification.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-131">For more information, see [Supporting Event Notification](supporting-event-notification.md).</span></span>
    
- <span data-ttu-id="699b3-132">Выделение и освобождение памяти.</span><span class="sxs-lookup"><span data-stu-id="699b3-132">Allocating and freeing memory.</span></span>
    
- <span data-ttu-id="699b3-133">Получение уникального идентификатора.</span><span class="sxs-lookup"><span data-stu-id="699b3-133">Obtaining a unique identifier.</span></span>
    
- <span data-ttu-id="699b3-134">Аннулирование объекты.</span><span class="sxs-lookup"><span data-stu-id="699b3-134">Invalidating objects.</span></span>
    
- <span data-ttu-id="699b3-135">Обработка ошибок.</span><span class="sxs-lookup"><span data-stu-id="699b3-135">Handling errors.</span></span>
    
- <span data-ttu-id="699b3-136">Регистрация preprocessors сообщение.</span><span class="sxs-lookup"><span data-stu-id="699b3-136">Registering message preprocessors.</span></span> 
    
- <span data-ttu-id="699b3-137">Подготовка отчеты о доставке сообщения.</span><span class="sxs-lookup"><span data-stu-id="699b3-137">Preparing message delivery reports.</span></span> 
    
<span data-ttu-id="699b3-138">Во время входа в систему MAPI вызывает метод входа в систему объекта поставщика каждого поставщика служб.</span><span class="sxs-lookup"><span data-stu-id="699b3-138">At logon time, MAPI calls the logon method of each service provider's provider object.</span></span> <span data-ttu-id="699b3-139">Для поставщиками адресной книги MAPI вызывает [IABProvider::Logon](iabprovider-logon.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-139">For address book providers, MAPI calls [IABProvider::Logon](iabprovider-logon.md).</span></span> <span data-ttu-id="699b3-140">Для поставщиков хранилища сообщений MAPI вызывает [IMSProvider::Logon](imsprovider-logon.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-140">For message store providers, MAPI calls [IMSProvider::Logon](imsprovider-logon.md).</span></span> <span data-ttu-id="699b3-141">Для поставщиков транспорта MAPI вызывает [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-141">For transport providers, MAPI calls [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span></span> <span data-ttu-id="699b3-142">MAPI передает указатель на объект поддержки в один из параметров в этот метод.</span><span class="sxs-lookup"><span data-stu-id="699b3-142">MAPI passes a pointer to the appropriate support object in one of the parameters to this method.</span></span> <span data-ttu-id="699b3-143">Метод входа в систему в свою очередь создает экземпляр объекта входа в систему, передав ее указателя на объект поддержки.</span><span class="sxs-lookup"><span data-stu-id="699b3-143">The logon method in turn instantiates a logon object, passing it the support object pointer.</span></span> <span data-ttu-id="699b3-144">Объект вход в систему вызывает метод **IUnknown::AddRef** объекта поддержка хранения, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="699b3-144">The logon object calls the support object's **IUnknown::AddRef** method to retain it, if necessary.</span></span> <span data-ttu-id="699b3-145">Дополнительные сведения о входе для поставщиков услуг содержатся в разделе [Запуск поставщика услуг](starting-a-service-provider.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-145">For more information about the logon process for service providers, see [Starting a Service Provider](starting-a-service-provider.md).</span></span>
  
<span data-ttu-id="699b3-146">При выходе клиент MAPI вызывает метод logoff объект вход в систему.</span><span class="sxs-lookup"><span data-stu-id="699b3-146">When a client logs off, MAPI calls the logon object's logoff method.</span></span> <span data-ttu-id="699b3-147">Метод выхода из системы вызывает метод **функции IUnknown::Release** объект поддержки для указания, что поставщик больше не планирует вызова любой из способов поддержки.</span><span class="sxs-lookup"><span data-stu-id="699b3-147">The logoff method calls the support object's **IUnknown::Release** method to indicate that the provider no longer intends to call any of the support methods.</span></span> <span data-ttu-id="699b3-148">Как и для входа в систему, выход из системы методы имеют немного разные имена.</span><span class="sxs-lookup"><span data-stu-id="699b3-148">As with logon, the logoff methods have slightly different names.</span></span> <span data-ttu-id="699b3-149">Интерфейсы [IABLogon](iablogoniunknown.md) и [IMSLogon](imslogoniunknown.md) имеют методов **выхода из системы** . интерфейс [IXPLogon](ixplogoniunknown.md) содержит метод [TransportLogoff](ixplogon-transportlogoff.md) .</span><span class="sxs-lookup"><span data-stu-id="699b3-149">The [IABLogon](iablogoniunknown.md) and [IMSLogon](imslogoniunknown.md) interfaces have **Logoff** methods; the [IXPLogon](ixplogoniunknown.md) interface has a [TransportLogoff](ixplogon-transportlogoff.md) method.</span></span> 
  
<span data-ttu-id="699b3-150">Функции точки входа службы сообщений, называются случае неудачной попытки входа в систему с ошибкой MAPI_E_UNCONFIGURED или при клиентом запроса на конфигурации.</span><span class="sxs-lookup"><span data-stu-id="699b3-150">Message service entry point functions are called when a logon attempt fails with the error MAPI_E_UNCONFIGURED or when a client initiates a configuration request.</span></span> <span data-ttu-id="699b3-151">MAPI создает экземпляр объекта поддержки конфигурации и вызывает функцию точки входа службы сообщений не настроенные поставщика или поставщика, параметры которого является изменение.</span><span class="sxs-lookup"><span data-stu-id="699b3-151">MAPI instantiates a configuration support object and calls the message service entry point function for either the unconfigured provider or the provider whose configuration is about to change.</span></span> <span data-ttu-id="699b3-152">В отличие от других объектов поддержки объекты поддержки конфигурации являются допустимыми только до точки входа, функция возвращает; службы сообщений не вызывайте методы **AddRef** этих объектов для сохранения их.</span><span class="sxs-lookup"><span data-stu-id="699b3-152">Unlike the other support objects, configuration support objects are valid only until the entry point function returns; message services do not call these objects' **AddRef** methods to retain them.</span></span> 
  
<span data-ttu-id="699b3-153">Как правило MAPI вызывает функцию точки входа службы поставщика сообщения, но в некоторых случаях задаваемые поставщика для выполнения вызова.</span><span class="sxs-lookup"><span data-stu-id="699b3-153">Typically, MAPI makes calls to a provider's message service entry point function, but sometimes a provider is asked to make the call.</span></span> <span data-ttu-id="699b3-154">Это происходит, когда клиент вызывает метод [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) поставщика запроса поставщика, чтобы открыть окно свойств конфигурации.</span><span class="sxs-lookup"><span data-stu-id="699b3-154">This can occur when a client calls a provider's [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) method to prompt the provider to display its configuration property sheet.</span></span> <span data-ttu-id="699b3-155">**SettingsDialog** должны вызывать [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) для получения объекта поддержки конфигурации, его можно передать в функцию точки входа службы сообщений.</span><span class="sxs-lookup"><span data-stu-id="699b3-155">**SettingsDialog** should call [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) to obtain a configuration support object that it can pass to the message service entry point function.</span></span> 
  
<span data-ttu-id="699b3-156">Метод [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) для определения адреса функции выделения и освобождения памяти без необходимости для связывания с MAPI.</span><span class="sxs-lookup"><span data-stu-id="699b3-156">The [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) method is available for determining the addresses of the memory allocation and deallocation functions without having to link with MAPI.</span></span> <span data-ttu-id="699b3-157">С помощью **GetMemAllocRoutines** также упрощает отслеживание утечек памяти с соседних вызовы функций выделения при отладке кода.</span><span class="sxs-lookup"><span data-stu-id="699b3-157">Using **GetMemAllocRoutines** also makes it easier to trace memory leaks by surrounding the allocation function calls with debugging code.</span></span> <span data-ttu-id="699b3-158">При вызове **GetMemAllocRoutines**как рекомендуется, сделать это до вызова функции [CreateIProp](createiprop.md) , для которой требуется адреса функции распределения как параметры.</span><span class="sxs-lookup"><span data-stu-id="699b3-158">If you call **GetMemAllocRoutines**, as is recommended, do so before calling the [CreateIProp](createiprop.md) function, which requires the allocation function addresses as parameters.</span></span> 
  
<span data-ttu-id="699b3-159">При необходимости для создания новой адресной книги или сообщения хранения объектов, создайте и назначьте ключ поиска для объекта в своем свойстве **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="699b3-159">When you need to create a new address book or message store object, create and set a search key for the object in its **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) property.</span></span> <span data-ttu-id="699b3-160">Вызов [IMAPISupport::NewUID](imapisupport-newuid.md) для получения уникального идентификатора для построения ключ поиска.</span><span class="sxs-lookup"><span data-stu-id="699b3-160">Call [IMAPISupport::NewUID](imapisupport-newuid.md) to obtain a unique identifier to use in building a search key.</span></span> <span data-ttu-id="699b3-161">Не используйте свои собственные жестко [MAPIUID](mapiuid.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-161">Do not use your own hard-coded [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="699b3-162">Поставщик **MAPIUID** следует использовать только для записи идентификаторов.</span><span class="sxs-lookup"><span data-stu-id="699b3-162">A provider's **MAPIUID** should be used only for entry identifiers.</span></span> <span data-ttu-id="699b3-163">Дополнительные сведения о создании ключей поиска просмотрите [записи MAPI и ключи поиска](mapi-record-and-search-keys.md).</span><span class="sxs-lookup"><span data-stu-id="699b3-163">For more information about constructing search keys, see [MAPI Record and Search Keys](mapi-record-and-search-keys.md).</span></span>
  
<span data-ttu-id="699b3-164">Клиентское приложение в некоторых случаях можно освободить объект без освобождения одно или несколько его дочерние объекты.</span><span class="sxs-lookup"><span data-stu-id="699b3-164">A client application can sometimes release an object without releasing one or more of its affiliated objects.</span></span> <span data-ttu-id="699b3-165">В этом случае поставщик может потребоваться нарушить работоспособность не выпускавшиеся объекта.</span><span class="sxs-lookup"><span data-stu-id="699b3-165">In such a case, a provider may need to render an unreleased object unusable.</span></span> <span data-ttu-id="699b3-166">Для этого поставщика освобождает все ресурсы, подключенных с помощью объекта и затем вызывает [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) Чтобы объявить недействительным vtable объекта.</span><span class="sxs-lookup"><span data-stu-id="699b3-166">To do this, the provider frees all of the resources connected with the object and then calls [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) to invalidate the object's vtable.</span></span> <span data-ttu-id="699b3-167">**MakeInvalid** заменяет методы **IUnknown** vtable (**QueryInterface**, **AddRef**и **выпуск**) с помощью стандартных реализаций интерфейса MAPI и вызывает другие методы для возврата MAPI_E_INVALID_OBJECT.</span><span class="sxs-lookup"><span data-stu-id="699b3-167">**MakeInvalid** replaces the vtable's **IUnknown** methods (**QueryInterface**, **AddRef**, and **Release**) with standard MAPI implementations and causes all other methods to return MAPI_E_INVALID_OBJECT.</span></span> <span data-ttu-id="699b3-168">**MakeInvalid** также освобождает объект памяти, отличный от vtable.</span><span class="sxs-lookup"><span data-stu-id="699b3-168">**MakeInvalid** also frees all the object's memory other than the vtable.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="699b3-169">См. также</span><span class="sxs-lookup"><span data-stu-id="699b3-169">See also</span></span>



[<span data-ttu-id="699b3-170">Поставщиков служб MAPI</span><span class="sxs-lookup"><span data-stu-id="699b3-170">MAPI Service Providers</span></span>](mapi-service-providers.md)

