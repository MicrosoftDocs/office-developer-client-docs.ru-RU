---
title: Обзор объектов поддержки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 55d8a9c78ae5132eaa8cf0f0aec5b252ef83b926
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433614"
---
# <a name="support-object-overview"></a>Обзор объектов поддержки

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
MAPI предоставляет объект поддержки, объект, реализующий интерфейс [имаписуппорт: IUnknown](imapisupportiunknown.md) , для всех поставщиков служб во время входа и для всех служб сообщений во время настройки. 
  
Объекты поддержки не доступны клиентам; они реализуются MAPI и вызываются только поставщиками служб. Интерфейс **имаписуппорт** указывается в файле заголовка маписпи. h. Его идентификатор IID_IMAPISup, а тип его указателя — ЛПМАПИСУП. Объекты поддержки не представляют свойства MAPI. 
  
Поставщику может быть назначен один или несколько объектов поддержки, в зависимости от того, сколько раз протокол MAPI регистрирует поставщик, или сколько раз вызывается функция записи службы сообщений поставщика. Как правило, поставщик будет зарегистрирован как минимум один раз для каждого сеанса. Адресные книги и поставщики транспорта записываются каждый раз, когда клиент начинает сеанс с записью профиля, запрашивающей их. Поставщики хранилища сообщений записываются каждый раз, когда клиент вызывает метод [IMAPISession:: опенмсгсторе](imapisession-openmsgstore.md) . 
  
В случае с несколькими входами в сеансе можно выбрать сохранение и использование каждого объекта поддержки отдельно или сохранить и использовать только первый, отменяющий каждый последующий объект поддержки. Чтобы сохранить объект поддержки, вызовите его метод **IUnknown:: AddRef** . Вызов **AddRef** для объекта поддержки, который необходимо хранить во время сеанса, чрезвычайно важен; Если вызов не выполняется, MAPI освобождает объект поддержки и освобождает память. 
  
Цель объекта поддержки состоит в том, чтобы реализовать достаточно большое количество методов, которые обычно используются поставщиками. Каждый объект support также содержит контекстные данные, относящиеся к собственному экземпляру, например сеанс, в котором выполняется поставщик, раздел профиля, который использует поставщик, и сведения об ошибке для сеанса. 
  
Существует четыре различных типа объектов поддержки: один для каждого типа основных поставщиков (адресная книга, хранилище сообщений и транспорт), а другая — для поддержки конфигурации. 
  
MAPI настраивает каждый объект поддержки, включая реализации методов, которые относятся к его использованию. Реализации некоторых методов, таких как [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md), включаются во все объекты support. Реализации других методов, например [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md), применяются только к определенным объектам поддержки. Этот метод могут использовать только хранилище сообщений и поставщики транспорта. когда поставщик адресных книг или служба сообщений пытаются позвонить, MAPI возвращает MAPI_E_NO_SUPPORT.
  
Объекты поддержки можно использовать для выполнения многих задач, в том числе следующих:
  
- Доступ к разделу профиля.
    
- Копирование папок или сообщений. Более подробную информацию можно узнать в статье [копирование или перемещение сообщения или папки](copying-or-moving-a-message-or-a-folder.md).
    
- Доступ к объектам, принадлежащим другим поставщикам. Дополнительные сведения см в разделе [Поддержка доступа к объектам и сравнение](supporting-object-access-and-comparison.md). 
    
- Обработка уведомления о событии. Более подробную информацию можно узнать в статье [Поддержка уведомлений о событиях](supporting-event-notification.md).
    
- Выделение и освобождение памяти.
    
- Получение уникального идентификатора.
    
- Непроверяемые объекты.
    
- Обработка ошибок.
    
- Регистрация препроцессора сообщений. 
    
- Подготовка отчетов о доставке сообщений. 
    
При входе в систему MAPI вызывает метод logon для каждого объекта поставщика поставщика услуг. Для поставщиков адресных книг MAPI вызывает [иабпровидер:: logon](iabprovider-logon.md). Для поставщиков хранилищ сообщений вызовы MAPI [функцииimsprovider:: logon](imsprovider-logon.md). Для поставщиков транспорта вызовы MAPI [иксппровидер:: транспортлогон](ixpprovider-transportlogon.md). MAPI передает указатель на соответствующий объект поддержки в одном из параметров для этого метода. Метод logon, в свою очередь, создает экземпляр объекта logon, передавая ему указатель на объект support. Объект logon вызывает метод **IUnknown:: AddRef** объекта support для сохранения, если это необходимо. Дополнительные сведения о процессе входа для поставщиков услуг приведены в разделе [Запуск поставщика услуг](starting-a-service-provider.md).
  
Когда клиент выходит из системы, MAPI вызывает метод logoff для объекта logon. Метод logoff вызывает метод **IUnknown:: Release** объекта support, чтобы показать, что поставщик больше не планирует вызывать какие бы то ни было методы поддержки. Как и при входе в систему, методы выхода имеют несколько разных имен. Интерфейсы [иаблогон](iablogoniunknown.md) и [Имслогон](imslogoniunknown.md) имеют методы **выхода** ; интерфейс [иксплогон](ixplogoniunknown.md) имеет метод [транспортлогофф](ixplogon-transportlogoff.md) . 
  
Функции точки входа службы сообщений вызываются при неудачной попытке входа с ошибкой MAPI_E_UNCONFIGURED или когда клиент инициирует запрос на настройку. MAPI создает экземпляр объекта поддержки конфигурации и вызывает функцию точки входа службы сообщений для ненастроенного поставщика или поставщика, конфигурацию которого собираетесь изменить. В отличие от других объектов поддержки, объекты поддержки конфигурации действительны только до возвращения функции точки входа; службы сообщений не вызывают методы **AddRef** этих объектов для их хранения. 
  
Как правило, протокол MAPI вызывает функцию точки входа службы сообщений поставщика, но иногда поставщику предлагается совершить вызов. Это может произойти, когда клиент вызывает метод [имапистатус:: сеттингсдиалог](imapistatus-settingsdialog.md) поставщика, чтобы запросить у поставщика отображение его страницы свойств конфигурации. **Сеттингсдиалог** должен вызывать [Имаписуппорт:: жетсвкконфигсуппортобж](imapisupport-getsvcconfigsupportobj.md) , чтобы получить объект поддержки конфигурации, который он может передать в функцию точки входа службы сообщений. 
  
Метод [имаписуппорт:: жетмемаллокраутинес](imapisupport-getmemallocroutines.md) доступен для определения адресов функций выделения и изъятия памяти без необходимости связи с MAPI. Использование **жетмемаллокраутинес** также упрощает отслеживание утечек памяти за счет заключения вызовов функций выделения с помощью отлаживаемого кода. Если вы вызываете **жетмемаллокраутинес**, как рекомендуется, сделайте это перед вызовом функции [креатеипроп](createiprop.md) , которая требует, чтобы функция выделения адресов была в качестве параметров. 
  
Если вам нужно создать новую адресную книгу или объект хранилища сообщений, создайте и задайте ключ поиска для объекта в его свойстве **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)). Call [имаписуппорт:: невуид](imapisupport-newuid.md) для получения уникального идентификатора, используемого при создании ключа поиска. Не используйте собственные жестко запрограммированные [мапиуид](mapiuid.md). **Мапиуид** поставщика следует использовать только для идентификаторов записей. Дополнительные сведения о создании ключей поиска можно найти в разделе " [записи и поисковые ключи MAPI](mapi-record-and-search-keys.md)".
  
Клиентское приложение иногда может освободить объект, не открывая один или несколько из его прикрепленных объектов. В таком случае поставщику может потребоваться отобразить Неосвобожденный объект, который будет недоступен для использования. Для этого поставщик освобождает все ресурсы, связанные с объектом, а затем вызывает метод [имаписуппорт:: макеинвалид](imapisupport-makeinvalid.md) , чтобы сделать недействительным таблицу vtable объекта. **Макеинвалид** заменяет методы **IUnknown** для vtable (**QueryInterface**, **ADDREF**и **Release**) на стандартные реализации MAPI и приводит к тому, что все остальные методы возвращают MAPI_E_INVALID_OBJECT. **Макеинвалид** также освобождает всю память объекта, кроме таблицы vtable. 
  
## <a name="see-also"></a>См. также



[Поставщики службы MAPI](mapi-service-providers.md)

