---
title: Обзор объектов поддержки
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 55d8a9c78ae5132eaa8cf0f0aec5b252ef83b926
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433614"
---
# <a name="support-object-overview"></a>Обзор объектов поддержки

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
MAPI представляет объект поддержки, объект, который реализует [интерфейс IMAPISupport : IUnknown](imapisupportiunknown.md) для всех поставщиков услуг во время логотипа и для всех служб сообщений во время настройки. 
  
Объекты поддержки недоступны клиентам; они реализованы MAPI и вызваны только поставщиками услуг. Интерфейс **IMAPISupport** указан в файле заголовки Mapispi.h. Его идентификатор IID_IMAPISup, а тип указателя — LPMAPISUP. Никакие свойства MAPI не подвергаются воздействию объектов поддержки. 
  
Поставщику может быть предоставлен один или несколько объектов поддержки в зависимости от количества журналов MAPI поставщика или количества случаев, когда вызвана функция входа службы сообщений поставщика. Как правило, поставщик регистрируется не реже одного раза за сеанс. Адресная книга и поставщики транспорта регистрируются каждый раз, когда клиент начинает сеанс с помощью записи профиля, которая запрашивает их. Поставщики магазинов сообщений регистрируются каждый раз, когда клиент вызывает [метод IMAPISession::OpenMsgStore.](imapisession-openmsgstore.md) 
  
В случае нескольких логотипов в сеансе можно выбрать либо сохранить и использовать каждый объект поддержки отдельно, либо сохранить и использовать только первый, отбрасыв каждый последующий объект поддержки. Чтобы сохранить объект поддержки, позвоните по методу **IUnknown::AddRef.** Вызов **AddRef** на объекте поддержки, который необходимо сохранить на протяжении сеанса, крайне важен; если вызов не выполнен, MAPI освобождает объект поддержки и освобождает его память. 
  
Целью объекта поддержки является предоставление реализаций для довольно большого количества методов, обычно используемых поставщиками. Каждый объект поддержки также содержит контекстные данные, специфические для собственного экземпляра, такие как сеанс, в котором работает поставщик, раздел профилей, который использует поставщик, и сведения об ошибках для сеанса. 
  
Существует четыре различных типа объектов поддержки: один для каждого крупного типа поставщика (адресная книга, хранилище сообщений и транспорт) и один для поддержки конфигурации. 
  
MAPI настраивает каждый объект поддержки, включив в них реализацию методов, соответствующих его использованию. Реализация некоторых методов, таких как [IMAPISupport::OpenProfileSection,](imapisupport-openprofilesection.md)включена во все объекты поддержки. Реализация других методов, таких как [IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md)применяется только к определенным объектам поддержки. Только поставщики сообщений и поставщики транспорта могут использовать этот метод; когда поставщик адресной книги или служба сообщений пытается вызвать его, MAPI возвращает MAPI_E_NO_SUPPORT.
  
Объекты поддержки можно использовать для выполнения многих задач, например следующих:
  
- Доступ к разделу профилей.
    
- Копирование папок или сообщений. Дополнительные сведения см. в [тексте Копирование или Перемещение сообщения или папки.](copying-or-moving-a-message-or-a-folder.md)
    
- Доступ к объектам, принадлежащим другим поставщикам. Дополнительные сведения см. в [дополнительных сведениях о поддержке доступа к объектам и сравнения.](supporting-object-access-and-comparison.md) 
    
- Обработка уведомлений о событиях. Дополнительные сведения см. в [вспомогательных уведомлениях о событиях.](supporting-event-notification.md)
    
- Напев и освободив память.
    
- Получение уникального идентификатора.
    
- Недействительные объекты.
    
- Обработка ошибок.
    
- Регистрация препроцессоров сообщений. 
    
- Подготовка отчетов о доставке сообщений. 
    
Во время логотипа MAPI вызывает метод logon для объекта поставщика услуг. Для поставщиков адресных книг MAPI вызывает [IABProvider::Logon](iabprovider-logon.md). Для поставщиков магазинов сообщений MAPI вызывает [IMSProvider::Logon](imsprovider-logon.md). Для поставщиков транспорта MAPI вызывает [IXPProvider::TransportLogon](ixpprovider-transportlogon.md). MAPI передает указатель соответствующему объекту поддержки в одном из параметров этого метода. Метод logon, в свою очередь, моментиалит объект logon, передав ему указатель объекта поддержки. Объект logon вызывает метод **IUnknown::AddRef,** чтобы при необходимости сохранить его. Дополнительные сведения о процессе логона для поставщиков услуг см. в [этой информации.](starting-a-service-provider.md)
  
При отключении клиента MAPI вызывает метод входа объекта logon. Метод журнала вызывает метод **IUnknown::Release** объекта поддержки, чтобы указать, что поставщик больше не намерен вызывать какие-либо из методов поддержки. Как и в logon, методы входа имеют несколько другие имена. Интерфейсы [IABLogon и](iablogoniunknown.md) [IMSLogon](imslogoniunknown.md) имеют **методы Logoff;** интерфейс [IXPLogon имеет](ixplogoniunknown.md) метод [TransportLogoff.](ixplogon-transportlogoff.md) 
  
Функции точки входа службы сообщений называются при сбойе попытки логона с ошибкой MAPI_E_UNCONFIGURED или когда клиент инициирует запрос конфигурации. MAPI мгновенно вызывает объект поддержки конфигурации и вызывает функцию точки входа службы сообщений для неконфигурованного поставщика или поставщика, конфигурация которого вот-вот изменится. В отличие от других объектов поддержки, объекты поддержки конфигурации действительны только до возвращения функции точки входа; Службы сообщений не называют методы **AddRef** этих объектов для их сохранения. 
  
Как правило, MAPI вызывает функцию точки входа службы сообщений поставщика, но иногда поставщику предложено сделать вызов. Это может произойти, когда клиент вызывает метод [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) поставщика для отображения его таблицы свойств конфигурации. **SettingsDialog** должен вызвать [IMAPISupport::GetSvcConfigSupportObj,](imapisupport-getsvcconfigsupportobj.md) чтобы получить объект поддержки конфигурации, который он может передать функции точки входа службы сообщений. 
  
Метод [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) доступен для определения адресов функций распределения и распределения памяти без привязки к MAPI. Использование **GetMemAllocRoutines** также упрощает отслеживание утечек памяти, окружав вызовы функции распределения кодом отладки. Если вы вызываете **GetMemAllocRoutines**, как рекомендуется, перед вызовом функции [CreateIProp,](createiprop.md) которая требует адресов функции выделения в качестве параметров. 
  
При создании нового объекта адресной книги или магазина сообщений создайте и установите ключ поиска для объекта в **свойстве PR_SEARCH_KEY** [(PidTagSearchKey).](pidtagsearchkey-canonical-property.md) Позвоните [в IMAPISupport::NewUID,](imapisupport-newuid.md) чтобы получить уникальный идентификатор, который можно использовать при создании ключа поиска. Не используйте свой собственный жесткий код [MAPIUID](mapiuid.md). **MAPIUID поставщика** должен использоваться только для идентификаторов записей. Дополнительные сведения о построении ключей поиска см. в [записи MAPI и клавишах поиска.](mapi-record-and-search-keys.md)
  
Клиентские приложения иногда могут выпускать объект, не выпуская один или несколько связанных с ним объектов. В этом случае поставщику может потребоваться сделать неиспользоваемый объект непригодным для оказания помощи. Для этого поставщик освободит все ресурсы, связанные с объектом, а затем вызывает [IMAPISupport::MakeInvalid,](imapisupport-makeinvalid.md) чтобы признать недействительным vtable объекта. **MakeInvalid** заменяет методы **IUnknown** vtable **(QueryInterface,** **AddRef** и **Release)** стандартными реализациями MAPI и вызывает возвращение всех других методов MAPI_E_INVALID_OBJECT. **MakeInvalid** также освободит всю память объекта, кроме vtable. 
  
## <a name="see-also"></a>См. также



[Поставщики услуг MAPI](mapi-service-providers.md)

