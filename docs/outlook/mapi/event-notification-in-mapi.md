---
title: Уведомление о событии в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: '���� ���������� ���������: 23 ���� 2011 �.'
ms.openlocfilehash: 9c1fd58a31481d8666ca931408c16bd73aaba660
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19808410"
---
# <a name="event-notification-in-mapi"></a><span data-ttu-id="b65b0-103">Уведомление о событии в MAPI</span><span class="sxs-lookup"><span data-stu-id="b65b0-103">Event notification in MAPI</span></span>

<span data-ttu-id="b65b0-104">**Применимо к**: Outlook</span><span class="sxs-lookup"><span data-stu-id="b65b0-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="b65b0-105">Уведомление о событии является связи информации между двумя объектов MAPI.</span><span class="sxs-lookup"><span data-stu-id="b65b0-105">Event notification is the communication of information between two MAPI objects.</span></span> <span data-ttu-id="b65b0-106">Через один из объектов клиента или поставщика регистрируется для получения уведомлений о изменений или ошибка, вызывается событие, которое может выполнять в другой объект.</span><span class="sxs-lookup"><span data-stu-id="b65b0-106">Through one of the objects, a client or service provider registers for notification of a change or error, called an event, which may take place in the other object.</span></span> <span data-ttu-id="b65b0-107">После возникновения события первый объект получает уведомление об изменении или ошибка.</span><span class="sxs-lookup"><span data-stu-id="b65b0-107">After the event occurs, the first object is notified of the change or error.</span></span> <span data-ttu-id="b65b0-108">Объект, получив оповещение, называется приемник уведомлений; Объект, ответственный за уведомление называется источник уведомлений.</span><span class="sxs-lookup"><span data-stu-id="b65b0-108">The object receiving the notification is called the advise sink; the object responsible for the notification is called the advise source.</span></span>
  
<span data-ttu-id="b65b0-109">Существует три типа этого вызова объектов приемника (все типы являются стандартные объекты MAPI):</span><span class="sxs-lookup"><span data-stu-id="b65b0-109">There are three types of advise sink objects (all types are standard MAPI objects):</span></span>
  
- <span data-ttu-id="b65b0-110">Уведомить объектов приемника.</span><span class="sxs-lookup"><span data-stu-id="b65b0-110">Advise sink objects.</span></span>   
- <span data-ttu-id="b65b0-111">Форма уведомить объектов приемника.</span><span class="sxs-lookup"><span data-stu-id="b65b0-111">Form advise sink objects.</span></span>  
- <span data-ttu-id="b65b0-112">Просмотр рекомендаций объектов приемника.</span><span class="sxs-lookup"><span data-stu-id="b65b0-112">View advise sink objects.</span></span>
    
<span data-ttu-id="b65b0-113">Уведомить объектов приемника — наиболее распространенный тип.</span><span class="sxs-lookup"><span data-stu-id="b65b0-113">Advise sink objects are the most common type.</span></span> <span data-ttu-id="b65b0-114">Уведомить приемники обычно реализуются посредством клиентских приложений для получения адресной книги и хранилища уведомления и поддержка [IMAPIAdviseSink: IUnknown](imapiadvisesinkiunknown.md) интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b65b0-114">Advise sinks are typically implemented by client applications to receive address book and message store notifications and support the [IMAPIAdviseSink : IUnknown](imapiadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="b65b0-115">**IMAPIAdviseSink** содержит единственный метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span><span class="sxs-lookup"><span data-stu-id="b65b0-115">**IMAPIAdviseSink** contains a single method, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span></span> <span data-ttu-id="b65b0-116">Формы и представления о том, приемники менее распространены; они реализованы на получение уведомлений об изменениях в настраиваемых форм.</span><span class="sxs-lookup"><span data-stu-id="b65b0-116">Form and view advise sinks are less common; they are implemented to receive notifications about changes to custom forms.</span></span> <span data-ttu-id="b65b0-117">Форма уведомить поддержки приемники [IMAPIFormAdviseSink: IUnknown](imapiformadvisesinkiunknown.md) интерфейс и представления уведомить поддержки приемники [IMAPIViewAdviseSink: IUnknown](imapiviewadvisesinkiunknown.md) интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b65b0-117">Form advise sinks support the [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) interface and view advise sinks support the [IMAPIViewAdviseSink : IUnknown](imapiviewadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="b65b0-118">Поскольку большинство клиентов реализация стандартный уведомить приемника объектов, предполагается, что обсуждения уведомлений, которые относятся к адресной книги и сообщение уведомления о хранилище, а не уведомления о формах.</span><span class="sxs-lookup"><span data-stu-id="b65b0-118">Because most clients implement standard advise sink objects, assume that discussions of notifications relate to address book and message store notifications rather than forms notifications.</span></span> <span data-ttu-id="b65b0-119">Дополнительные сведения о формах уведомлений видеть [Уведомлений формы MAPI](mapi-forms-notifications.md) и [Написание кода формы сервера](writing-form-server-code.md).</span><span class="sxs-lookup"><span data-stu-id="b65b0-119">For more information about forms notifications, see [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span></span>
  
<span data-ttu-id="b65b0-120">Уведомить источник, объекты реализуемый поставщиков услуг и MAPI.</span><span class="sxs-lookup"><span data-stu-id="b65b0-120">Advise source objects are implemented by service providers and by MAPI.</span></span> <span data-ttu-id="b65b0-121">Не все поставщики службы поддерживают уведомления о событии; Это необязательно, но настоятельно рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="b65b0-121">Not all service providers support event notification; it is optional, but strongly recommended.</span></span> <span data-ttu-id="b65b0-122">Хранилища сообщений и адресной книги поставщиков обычно уведомления о поддержке объекта на несколько объектов и таблицы уведомлений на их содержимое и таблиц иерархии.</span><span class="sxs-lookup"><span data-stu-id="b65b0-122">Message store and address book providers usually support object notifications on several of their objects and table notifications on their contents and hierarchy tables.</span></span> <span data-ttu-id="b65b0-123">Поставщики транспорта не поддерживают уведомления напрямую; они используют альтернативных методов взаимодействия с клиентами.</span><span class="sxs-lookup"><span data-stu-id="b65b0-123">Transport providers do not support notifications directly; they rely on alternative methods of communication with clients.</span></span>
  
<span data-ttu-id="b65b0-124">В отличие от приемники уведомлений о том, объекты источника не уникальный тип объекта MAPI.</span><span class="sxs-lookup"><span data-stu-id="b65b0-124">Unlike advise sinks, advise source objects are not a unique type of MAPI object.</span></span> <span data-ttu-id="b65b0-125">Количество объектов MAPI, хранилищ сообщений, таблицы, можно берут на себя роль источника уведомлений.</span><span class="sxs-lookup"><span data-stu-id="b65b0-125">Many MAPI objects, such as message stores and tables, can take on the role of advise source.</span></span> <span data-ttu-id="b65b0-126">Источник уведомлений — это любой объект MAPI, который выполняет следующее:</span><span class="sxs-lookup"><span data-stu-id="b65b0-126">An advise source is any MAPI object that does the following:</span></span>
  
- <span data-ttu-id="b65b0-127">Реализует способ получения уведомления о регистрации **уведомлений** .</span><span class="sxs-lookup"><span data-stu-id="b65b0-127">Implements an **Advise** method to receive notification registrations.</span></span> 
    
- <span data-ttu-id="b65b0-128">Реализует **Unadvise** способ получения уведомлений отмены.</span><span class="sxs-lookup"><span data-stu-id="b65b0-128">Implements an **Unadvise** method to receive notification cancellations.</span></span> 
    
- <span data-ttu-id="b65b0-129">Создает уведомления подходящий тип объектов приемника соответствующих уведомлений, которые зарегистрированы, вызвав их **IMAPIAdviseSink::OnNotify** методы.</span><span class="sxs-lookup"><span data-stu-id="b65b0-129">Generates notifications of the appropriate type to the appropriate advise sink objects that have registered by calling their **IMAPIAdviseSink::OnNotify** methods.</span></span> 
    
<span data-ttu-id="b65b0-130">Клиенты, которые реализуют уведомить объектов приемника вызываемый **уведомлений** при их требуется зарегистрировать для уведомлений, в большинстве случаев, передав в запись идентификатор объекта, с которым должно происходить регистрации и **Unadvise** для отмены Регистрация.</span><span class="sxs-lookup"><span data-stu-id="b65b0-130">Clients that implement advise sink objects call **Advise** when they want to register for a notification, in most cases passing in the entry identifier of the object with which registration should occur, and **Unadvise** when they want to cancel the registration.</span></span> <span data-ttu-id="b65b0-131">Клиенты передайте параметр **уведомлений** , которое указывает, какую из несколько типов событий, которые требуется отслеживать.</span><span class="sxs-lookup"><span data-stu-id="b65b0-131">Clients pass a parameter to **Advise** that indicates which of the several types of events they want to monitor.</span></span> <span data-ttu-id="b65b0-132">**Уведомлений** возвращается ненулевое число, представляющее успешное соединение между приемник уведомлений и источник уведомлений.</span><span class="sxs-lookup"><span data-stu-id="b65b0-132">**Advise** returns a nonzero number that represents a successful connection between the advise sink and advise source.</span></span> 
  
<span data-ttu-id="b65b0-133">До вызова метода **уведомлений**, клиенты могут определить, поддерживает ли поставщик хранения сообщений уведомление, проверяя, флаг STORE_NOTIFY_OK установлен в хранилище сообщений **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) свойство.</span><span class="sxs-lookup"><span data-stu-id="b65b0-133">Before calling **Advise**, clients can determine whether a message store provider supports notification by checking that the STORE_NOTIFY_OK flag is set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span> <span data-ttu-id="b65b0-134">Нет возможности для клиентов определить заранее того поставщика адресных книг, поддерживает ли уведомления.</span><span class="sxs-lookup"><span data-stu-id="b65b0-134">There is no way for clients to determine ahead of time whether or not an address book provider supports notifications.</span></span> <span data-ttu-id="b65b0-135">Клиенты должны пытаться регистрации и в случае сбоя попытка их можно предположить, что уведомления не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="b65b0-135">Clients must attempt to register and if the attempt fails, they can assume notifications are unsupported.</span></span>
  
<span data-ttu-id="b65b0-136">При возникновении события, для которого зарегистрирован клиента, источник уведомлений уведомляет приемник уведомлений путем вызова метода [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) со структурой данных уведомлений, который содержит сведения о событии.</span><span class="sxs-lookup"><span data-stu-id="b65b0-136">When an event for which a client has registered occurs, the advise source notifies the advise sink by calling its [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method with a notification data structure that contains information about the event.</span></span> <span data-ttu-id="b65b0-137">Реализация приемника уведомления **OnNotify** может выполнять задачи в ответ на уведомление, такие как обновление данных в памяти или обновление экрана.</span><span class="sxs-lookup"><span data-stu-id="b65b0-137">An advise sink's implementation of **OnNotify** can perform tasks in response to the notification, such as updating data in memory or refreshing a screen display.</span></span> 
  
<span data-ttu-id="b65b0-138">Поставщиков услуг можно обеспечить поддержку уведомлений вручную или воспользоваться преимуществами справки, представленные в три метода **IMAPISupport** : [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)и [IMAPISupport::Notify ](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="b65b0-138">Service providers can implement support for notifications manually or take advantage of the help provided in three **IMAPISupport** methods: [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md), and [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="b65b0-139">Методы **подписки на** и **предлагающий** обрабатывать регистрации уведомлений и отмену регистрации для поставщиков; метод **Уведомлять** обрабатывает отправку уведомлений, когда это необходимо.</span><span class="sxs-lookup"><span data-stu-id="b65b0-139">The **Subscribe** and **Unsubscribe** methods handle notification registration and deregistration for providers; the **Notify** method handles sending notifications when appropriate.</span></span> 
  
<span data-ttu-id="b65b0-140">Чтобы использовать методы объекта поддержки для регистрации уведомлений, поставщиков услуг вызвать [IMAPISupport::Subscribe](imapisupport-subscribe.md) в их методы **уведомлений** и передать для **подписки на** указателя приемника уведомлений, клиенты передачи **уведомлений**.</span><span class="sxs-lookup"><span data-stu-id="b65b0-140">To use the support object methods for notification registration, service providers call [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span></span> <span data-ttu-id="b65b0-141">Идентификатор записи передается в качестве входного параметра, чтобы указать источник уведомлений, поставщиков услуг преобразование двоичных ключу.</span><span class="sxs-lookup"><span data-stu-id="b65b0-141">If an entry identifier is passed as an input parameter to specify an advise source, service providers convert it to a binary key.</span></span> <span data-ttu-id="b65b0-142">**Подписки на** создает номер уникальное подключение и является этот номер, который поставщиков услуг вернуться к клиентам.</span><span class="sxs-lookup"><span data-stu-id="b65b0-142">**Subscribe** creates a unique connection number and it is this number that service providers return to clients.</span></span> <span data-ttu-id="b65b0-143">Поставщики услуг могут освобождать клиента уведомить указателя на объект приемника в любое время после завершения звонка **уведомлений** .</span><span class="sxs-lookup"><span data-stu-id="b65b0-143">Service providers can release the client's advise sink object pointer at any time after the **Advise** call has completed.</span></span> 
  
<span data-ttu-id="b65b0-144">Когда клиенты вызовите **Unadvise** для отмены регистрации, поставщиков услуг либо уменьшения счетчик ссылок на стороне клиента уведомить указателя приемника или **отказа от подписки** на это.</span><span class="sxs-lookup"><span data-stu-id="b65b0-144">When clients call **Unadvise** to cancel a registration, service providers either decrement the reference count on the client's advise sink pointer or call **Unsubscribe** to do the same.</span></span> 
  
<span data-ttu-id="b65b0-145">После создания уведомления поставщиков услуг выполните внутреннюю обработку, которая относится к уведомления и инициализирует [УВЕДОМЛЕНИЙ](notification.md) структура путем установки всех его неиспользуемых членов нулевое значение.</span><span class="sxs-lookup"><span data-stu-id="b65b0-145">When it is time to generate a notification, service providers perform any internal processing that relates to the notification and initializes a [NOTIFICATION](notification.md) structure by setting all of its unused members to zero.</span></span> <span data-ttu-id="b65b0-146">Этот метод для инициализации структуры **уведомление** может помочь Создание меньшего размера, быстрее и меньше ошибок реализации **OnNotify** клиентов.</span><span class="sxs-lookup"><span data-stu-id="b65b0-146">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="b65b0-147">На следующем рисунке показана связь между уведомить объектов приемника, рекомендуем объектов источника и MAPI.</span><span class="sxs-lookup"><span data-stu-id="b65b0-147">The following illustration shows the communication between advise sink objects, advise source objects, and MAPI.</span></span> <span data-ttu-id="b65b0-148">MAPI возникает только в том случае, если источник уведомлений вызывает методы **IMAPISupport** для поддержки уведомлений.</span><span class="sxs-lookup"><span data-stu-id="b65b0-148">MAPI is involved only when the advise source calls the **IMAPISupport** methods for notification support.</span></span> 
  
<span data-ttu-id="b65b0-149">**Вызовы уведомлений о событиях**</span><span class="sxs-lookup"><span data-stu-id="b65b0-149">**Event notification calls**</span></span>
  
<span data-ttu-id="b65b0-150">![Вызовы уведомлений о событиях] (media/amapi_51.gif "Вызовы уведомлений о событиях")</span><span class="sxs-lookup"><span data-stu-id="b65b0-150">![Event notification calls](media/amapi_51.gif "Event notification calls")</span></span>
  
<span data-ttu-id="b65b0-151">Mfcmapi (en) **CAdviseSink** класса (с использованием файлов AdviseSink.h и AdviseSink.cpp) реализует объект приемника уведомлений для всех вызовов **уведомлений**.</span><span class="sxs-lookup"><span data-stu-id="b65b0-151">The MFCMAPI **CAdviseSink** class (using the AdviseSink.h and AdviseSink.cpp files) implements the advise sink object for all calls to **Advise**.</span></span> <span data-ttu-id="b65b0-152">Дополнительные сведения о mfcmapi (en) можно [mfcmapi (en) в качестве примера кода](mfcmapi-as-a-code-sample.md) и [mfcmapi (en)](http://go.microsoft.com/fwlink/?LinkId=124154).</span><span class="sxs-lookup"><span data-stu-id="b65b0-152">For more information about MFCMAPI, see [MFCMAPI as a Code Sample](mfcmapi-as-a-code-sample.md) and [MFCMAPI](http://go.microsoft.com/fwlink/?LinkId=124154).</span></span>
  

