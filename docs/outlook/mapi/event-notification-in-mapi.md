---
title: Уведомление о событиях в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321400"
---
# <a name="event-notification-in-mapi"></a>Уведомление о событиях в MAPI

**Относится к**: Outlook 2013 | Outlook 2016 
  
Уведомление о событии — это связь информации между двумя объектами MAPI. С помощью одного из объектов клиент или поставщик услуг регистрируется для уведомления об изменении или ошибке, называемом событием, которое может происходить в другом объекте. После возникновения события первый объект будет уведомлен об изменении или ошибке. Объект, получающий уведомление, называется приемником консультации; Объект, отвечающий за уведомление, называется источником консультации.
  
Существует три типа рекомендуемых объектов-тонух (все типы являются стандартными объектами MAPI):
  
- Рекомендуемые объекты-висяки.   
- Объекты-токонвители с консультацией по формам.  
- Просматривать рекомендуемые объекты-висяки.
    
Наиболее распространенным типом являются рекомендуемые объекты-висяки. Приемники уведомлений обычно реализуются клиентские приложения для получения уведомлений адресной книги и из магазина сообщений, а также для поддержки интерфейса [IMAPIAdviseSink : IUnknown.](imapiadvisesinkiunknown.md) **IMAPIAdviseSink** содержит один метод [IMAPIAdviseSink::OnNotify.](imapiadvisesink-onnotify.md) В формах и представлениях они менее распространены; они реализуются для получения уведомлений об изменениях настраиваемой формы. Точек с консультацией по формам поддерживают [интерфейс IMAPIFormAdviseSink : интерфейс IUnknown](imapiformadvisesinkiunknown.md) и точки просмотра, которые поддерживают [интерфейс IMAPIViewAdviseSink : IUnknown.](imapiviewadvisesinkiunknown.md) Так как в большинстве клиентов реализованы стандартные объекты-сигналы, предположим, что обсуждения уведомлений относятся к уведомлениям адресной книги и хранилище сообщений, а не к уведомлениям форм. Дополнительные сведения об уведомлениях о формах см. в уведомлениях [форм MAPI](mapi-forms-notifications.md) и [написании кода сервера форм.](writing-form-server-code.md)
  
Рекомендуемые исходные объекты реализуются поставщиками служб и MAPI. Не все поставщики услуг поддерживают уведомление о событиях; это необязательный, но настоятельно рекомендуемый вариант. Поставщики хранения сообщений и адресных книг обычно поддерживают уведомления об объектах для нескольких объектов и табличные уведомления в их содержимом и таблицах иерархии. Поставщики транспорта не поддерживают уведомления напрямую; они используют альтернативные методы связи с клиентами.
  
В отличие от младоконсультных источников, рекомендуемые исходные объекты не являются уникальным типом объекта MAPI. Многие объекты MAPI, такие как хранилища сообщений и таблицы, могут принимать на себя роль источника консультаций. Источником консультации является любой объект MAPI, который делает следующее:
  
- Реализует метод **Advise** для получения регистраций уведомлений. 
    
- Реализует метод **Unadvise** для получения уведомлений об отмене. 
    
- Создает уведомления соответствующего типа для соответствующих рекомендуемых объектов приемника, которые зарегистрированы путем вызова их методов **IMAPIAdviseSink::OnNotify.** 
    
Клиенты, реализующие  объекты-вхождения с консультацией, вызовите "Сообщить", когда они хотят зарегистрироваться  для уведомления, в большинстве случаев передав идентификатор записи объекта, с которым должна выполняться регистрация, и отменить регистрацию. Клиенты передают параметр **advise,** который указывает, какой из нескольких типов событий они хотят отслеживать. **Advise** возвращает ненужий номер, представляющий успешное соединение между источником и источником консультации. 
  
Перед вызовом "Консультация" клиенты могут определить, поддерживает ли поставщик услуг хранения сообщений уведомление,  проверив, установлен ли флаг STORE_NOTIFY_OK в свойстве PR_STORE_SUPPORT_MASK ([PidTagStoreSupportMask).](pidtagstoresupportmask-canonical-property.md) Клиенты не могут заранее определить, поддерживает ли поставщик адресной книги уведомления. Клиенты должны попытаться зарегистрироваться, и в случае неудачной попытки они могут предположить, что уведомления неподтверщены.
  
Когда происходит событие, для которого зарегистрирован клиент, источник консультации оповещений оповещений, вызывая его [метод IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) со структурой данных уведомлений, содержащего сведения о событии. Реализация **OnNotify,** совмещенная с осями, может выполнять задачи в ответ на уведомление, такие как обновление данных в памяти или обновление дисплея экрана. 
  
Поставщики услуг могут реализовать поддержку уведомлений вручную или воспользоваться справкой, предоставляемой тремя методами **IMAPISupport:** [IMAPISupport::Subscribe,](imapisupport-subscribe.md) [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)и [IMAPISupport::Notify](imapisupport-notify.md). Методы **Subscribe** и **Unsubscribe** обрабатывают регистрацию и дерегистрацию уведомлений для поставщиков; Метод **Notify** обрабатывает отправку уведомлений, когда это необходимо. 
  
Чтобы использовать методы объекта поддержки для регистрации уведомлений, поставщики услуг  звонят по  методу [IMAPISupport::Subscribe](imapisupport-subscribe.md) в своих методах advise и передают в подписку указатель приемника рекомендации, который клиенты передают в **"Совет".** Если идентификатор записи передается в качестве входного параметра для указания источника консультации, поставщики служб преобразуют его в двоичный ключ. **Подписка** создает уникальный номер подключения, и именно этот номер поставщики услуг возвращают клиентам. Поставщики услуг могут освободить указатель на объект-сигнальный сигнал клиента в любое время после завершения **вызова** advise. 
  
Когда клиенты звонят **unadvise** для отмены регистрации, поставщики услуг либо понишают  количество ссылок на указатель на сигнальный сигнал клиента, либо звонят отменить отмену регистрации, чтобы сделать то же самое. 
  
Когда пора создать уведомление, поставщики услуг выполняют любую внутреннюю обработку, связанную с уведомлением, и инициализируют структуру [УВЕДОМЛЕНий,](notification.md) устанавливая для всех ее неиспользованных членов нулевое значение. Этот метод инициализации структуры **УВЕДОМЛЕНий** помогает клиентам создавать более мелкие, быстрые и менее подверженные ошибкам реализации **OnNotify.** 
  
На следующем рисунке показана связь между объектами-тонами- и исходными объектами-консультациями, а также MAPI. MAPI задействован только в том случае, если источник консультаций вызывает методы **IMAPISupport** для поддержки уведомлений. 
  
**Вызовы уведомлений о событии**
  
![Уведомление о событии вызывает вызовы](media/amapi_51.gif "уведомлений о событиях")
  
Класс MFCMAPI **CAdviseSink** (с использованием файлов AdviseSink.h и AdviseSink.cpp) реализует объект-консультант для всех вызовов **advise.** Дополнительные сведения о MFCMAPI см. в [MFCMAPI в](mfcmapi-as-a-code-sample.md) качестве примера кода и [MFCMAPI.](https://go.microsoft.com/fwlink/?LinkId=124154)
  

