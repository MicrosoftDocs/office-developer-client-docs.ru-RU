---
title: Уведомление о событии в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25389976"
---
# <a name="event-notification-in-mapi"></a>Уведомление о событии в MAPI

**Относится к**: Outlook 2013 | Outlook 2016 
  
Уведомление о событии является связи информации между двумя объектов MAPI. Через один из объектов клиента или поставщика регистрируется для получения уведомлений о изменений или ошибка, вызывается событие, которое может выполнять в другой объект. После возникновения события первый объект получает уведомление об изменении или ошибка. Объект, получив оповещение, называется приемник уведомлений; Объект, ответственный за уведомление называется источник уведомлений.
  
Существует три типа этого вызова объектов приемника (все типы являются стандартные объекты MAPI):
  
- Уведомить объектов приемника.   
- Форма уведомить объектов приемника.  
- Просмотр рекомендаций объектов приемника.
    
Уведомить объектов приемника — наиболее распространенный тип. Уведомить приемники обычно реализуются посредством клиентских приложений для получения адресной книги и хранилища уведомления и поддержка [IMAPIAdviseSink: IUnknown](imapiadvisesinkiunknown.md) интерфейса. **IMAPIAdviseSink** содержит единственный метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md). Формы и представления о том, приемники менее распространены; они реализованы на получение уведомлений об изменениях в настраиваемых форм. Форма уведомить поддержки приемники [IMAPIFormAdviseSink: IUnknown](imapiformadvisesinkiunknown.md) интерфейс и представления уведомить поддержки приемники [IMAPIViewAdviseSink: IUnknown](imapiviewadvisesinkiunknown.md) интерфейса. Поскольку большинство клиентов реализация стандартный уведомить приемника объектов, предполагается, что обсуждения уведомлений, которые относятся к адресной книги и сообщение уведомления о хранилище, а не уведомления о формах. Дополнительные сведения о формах уведомлений видеть [Уведомлений формы MAPI](mapi-forms-notifications.md) и [Написание кода формы сервера](writing-form-server-code.md).
  
Уведомить источник, объекты реализуемый поставщиков услуг и MAPI. Не все поставщики службы поддерживают уведомления о событии; Это необязательно, но настоятельно рекомендуется. Хранилища сообщений и адресной книги поставщиков обычно уведомления о поддержке объекта на несколько объектов и таблицы уведомлений на их содержимое и таблиц иерархии. Поставщики транспорта не поддерживают уведомления напрямую; они используют альтернативных методов взаимодействия с клиентами.
  
В отличие от приемники уведомлений о том, объекты источника не уникальный тип объекта MAPI. Количество объектов MAPI, хранилищ сообщений, таблицы, можно берут на себя роль источника уведомлений. Источник уведомлений — это любой объект MAPI, который выполняет следующее:
  
- Реализует способ получения уведомления о регистрации **уведомлений** . 
    
- Реализует **Unadvise** способ получения уведомлений отмены. 
    
- Создает уведомления подходящий тип объектов приемника соответствующих уведомлений, которые зарегистрированы, вызвав их **IMAPIAdviseSink::OnNotify** методы. 
    
Клиенты, которые реализуют уведомить объектов приемника вызываемый **уведомлений** при их требуется зарегистрировать для уведомлений, в большинстве случаев, передав в запись идентификатор объекта, с которым должно происходить регистрации и **Unadvise** для отмены Регистрация. Клиенты передайте параметр **уведомлений** , которое указывает, какую из несколько типов событий, которые требуется отслеживать. **Уведомлений** возвращается ненулевое число, представляющее успешное соединение между приемник уведомлений и источник уведомлений. 
  
До вызова метода **уведомлений**, клиенты могут определить, поддерживает ли поставщик хранения сообщений уведомление, проверяя, флаг STORE_NOTIFY_OK установлен в хранилище сообщений **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) свойство. Нет возможности для клиентов определить заранее того поставщика адресных книг, поддерживает ли уведомления. Клиенты должны пытаться регистрации и в случае сбоя попытка их можно предположить, что уведомления не поддерживаются.
  
При возникновении события, для которого зарегистрирован клиента, источник уведомлений уведомляет приемник уведомлений путем вызова метода [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) со структурой данных уведомлений, который содержит сведения о событии. Реализация приемника уведомления **OnNotify** может выполнять задачи в ответ на уведомление, такие как обновление данных в памяти или обновление экрана. 
  
Поставщиков услуг можно обеспечить поддержку уведомлений вручную или воспользоваться преимуществами справки, представленные в три метода **IMAPISupport** : [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)и [IMAPISupport::Notify ](imapisupport-notify.md). Методы **подписки на** и **предлагающий** обрабатывать регистрации уведомлений и отмену регистрации для поставщиков; метод **Уведомлять** обрабатывает отправку уведомлений, когда это необходимо. 
  
Чтобы использовать методы объекта поддержки для регистрации уведомлений, поставщиков услуг вызвать [IMAPISupport::Subscribe](imapisupport-subscribe.md) в их методы **уведомлений** и передать для **подписки на** указателя приемника уведомлений, клиенты передачи **уведомлений**. Идентификатор записи передается в качестве входного параметра, чтобы указать источник уведомлений, поставщиков услуг преобразование двоичных ключу. **Подписки на** создает номер уникальное подключение и является этот номер, который поставщиков услуг вернуться к клиентам. Поставщики услуг могут освобождать клиента уведомить указателя на объект приемника в любое время после завершения звонка **уведомлений** . 
  
Когда клиенты вызовите **Unadvise** для отмены регистрации, поставщиков услуг либо уменьшения счетчик ссылок на стороне клиента уведомить указателя приемника или **отказа от подписки** на это. 
  
После создания уведомления поставщиков услуг выполните внутреннюю обработку, которая относится к уведомления и инициализирует [УВЕДОМЛЕНИЙ](notification.md) структура путем установки всех его неиспользуемых членов нулевое значение. Этот метод для инициализации структуры **уведомление** может помочь Создание меньшего размера, быстрее и меньше ошибок реализации **OnNotify** клиентов. 
  
На следующем рисунке показана связь между уведомить объектов приемника, рекомендуем объектов источника и MAPI. MAPI возникает только в том случае, если источник уведомлений вызывает методы **IMAPISupport** для поддержки уведомлений. 
  
**Вызовы уведомлений о событии**
  
![Вызовы уведомлений о событиях] (media/amapi_51.gif "Вызовы уведомлений о событиях")
  
Mfcmapi (en) **CAdviseSink** класса (с использованием файлов AdviseSink.h и AdviseSink.cpp) реализует объект приемника уведомлений для всех вызовов **уведомлений**. Дополнительные сведения о mfcmapi (en) можно [mfcmapi (en) в качестве примера кода](mfcmapi-as-a-code-sample.md) и [mfcmapi (en)](https://go.microsoft.com/fwlink/?LinkId=124154).
  

