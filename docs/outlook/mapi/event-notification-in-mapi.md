---
title: Уведомление о событиях в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321400"
---
# <a name="event-notification-in-mapi"></a>Уведомление о событиях в MAPI

**Область применения**: Outlook 2013 | Outlook 2016 
  
Уведомление о событии — это сообщение информации между двумя объектами MAPI. Через один из объектов клиент или поставщик услуг регистрируется для уведомления об изменении или ошибке, называемом событием, которое может иметь место в другом объекте. После события первый объект уведомлен об изменении или ошибке. Объект, получающий уведомление, называется раковиной консультаций; объект, ответственный за уведомление, называется источником консультаций.
  
Существует три типа объектов раковины-рекомендации (все типы являются стандартными объектами MAPI):
  
- Советую объекты раковины.   
- Форма советует объекты раковины.  
- Просмотр рекомендуемые объекты раковины.
    
Советую объекты раковины являются наиболее распространенным типом. Обычно клиентские приложения реализуют прием уведомлений о адресной книге и хранилище сообщений и поддерживают [интерфейс IMAPIAdviseSink: IUnknown.](imapiadvisesinkiunknown.md) **IMAPIAdviseSink** содержит один метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md). Формы и представления советовать раковины являются менее распространенными; они реализуются для получения уведомлений об изменениях в настраиваемые формы. Форма советует раковинам поддерживать [интерфейс IMAPIFormAdviseSink: интерфейс iUnknown](imapiformadvisesinkiunknown.md) и представления советовать раковинам поддерживать [интерфейс IMAPIViewAdviseSink : IUnknown.](imapiviewadvisesinkiunknown.md) Поскольку большинство клиентов реализуют стандартные объекты раковины, предположим, что обсуждения уведомлений касаются уведомлений адресной книги и магазина сообщений, а не форм уведомлений. Дополнительные сведения об уведомлениях форм см. в [заметке MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code.](writing-form-server-code.md)
  
Рекомендуемые исходные объекты реализуются поставщиками услуг и MAPI. Не все поставщики услуг поддерживают уведомление о событиях; это необязательно, но настоятельно рекомендуется. Поставщики хранения сообщений и адресных книг обычно поддерживают уведомления об объектах на нескольких объектах и таблицы уведомлений в их содержимом и таблицах иерархии. Поставщики транспорта не поддерживают уведомления напрямую; они полагаются на альтернативные методы общения с клиентами.
  
В отличие от советуем раковины, советовать исходные объекты не являются уникальным типом объекта MAPI. Многие объекты MAPI, такие как хранилища сообщений и таблицы, могут взять на себя роль источника консультаций. Источником консультаций является любой объект MAPI, который делает следующее:
  
- Реализует метод **Advise** для получения регистрации уведомлений. 
    
- Реализует метод **Unadvise** для получения отмены уведомлений. 
    
- Генерирует уведомления соответствующего типа соответствующим объектам раковины, зарегистрированным путем вызова их **методов IMAPIAdviseSink::OnNotify.** 
    
Клиенты, реализующие  рекомендации по вызову объектов раковины, советуют, когда они хотят зарегистрироваться для уведомления, в большинстве случаев передав идентификатор входа объекту, с которым должна произойти регистрация, и **отменить,** когда они хотят отменить регистрацию. Клиенты передают параметр **Advise,** который указывает, какие из нескольких типов событий они хотят отслеживать. **Советую** возвращать номер nonzero, который представляет успешное подключение между раковиной рекомендации и источником консультации. 
  
Перед вызовом консультации клиенты могут определить, поддерживает ли поставщик магазина сообщений уведомление, проверяя,  что флаг STORE_NOTIFY_OK установлен в свойстве PR_STORE_SUPPORT_MASK магазина сообщений[(PidTagStoreSupportMask).](pidtagstoresupportmask-canonical-property.md) Клиенты не могут заранее определить, поддерживает ли поставщик адресной книги уведомления. Клиенты должны попытаться зарегистрироваться, и если попытка не удалась, они могут предположить, что уведомления неподтверчены.
  
Когда происходит событие, для которого зарегистрирован клиент, источник консультирования оповещен о приеме рекомендации, вызывая его [метод IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) со структурой данных уведомлений, содержащего сведения о событии. Реализация **OnNotify,** выполняемая по рекомендации, может выполнять задачи в ответ на уведомление, например обновление данных в памяти или обновление экрана. 
  
Поставщики услуг могут реализовать поддержку уведомлений вручную или воспользоваться помощью, предоставляемой в трех методах **IMAPISupport:** [IMAPISupport::Subscribe,](imapisupport-subscribe.md) [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)и [IMAPISupport::Notify](imapisupport-notify.md). Методы **Подписки** и **отписки** обрабатывают регистрацию уведомлений и дерегулирование для поставщиков; Метод **Notify** обрабатывает отправку уведомлений при необходимости. 
  
Чтобы использовать методы объекта поддержки для регистрации уведомлений, поставщики услуг  звонят в  [IMAPISupport::Subscribe](imapisupport-subscribe.md) в своих методах консультирования и передают подписку на указатель рекомендации по приему, который клиенты передают в Службу консультирования.  Если идентификатор записи передается в качестве параметра ввода для указания источника консультаций, поставщики услуг преобразуют его в двоичный ключ. **Подписка** создает уникальный номер подключения, и именно этот номер поставщики услуг возвращают клиентам. Поставщики услуг могут освободить указатель объекта раковины клиента в любое время после завершения вызова **advise.** 
  
Когда клиенты звонят **в Unadvise,** чтобы отменить регистрацию, поставщики услуг либо приумножить количество ссылок на указатель раковины рекомендации клиента, либо вызвать отмену, чтобы сделать то же самое.  
  
Когда пришло время для создания уведомления, поставщики услуг выполняют любую внутреннюю обработку, связанную с уведомлением, и инициализируют структуру УВЕДОМЛЕНий, установив все неиспользованые участники до нуля. [](notification.md) Этот метод инициализации структуры **УВЕДОМЛЕНИй** помогает клиентам создавать более мелкие, быстрые и менее подверженные ошибкам реализации **OnNotify.** 
  
На следующей иллюстрации показана связь между объектами раковины, советовать исходные объекты и MAPI. MAPI участвует только тогда, когда источник консультаций вызывает **методы IMAPISupport** для поддержки уведомлений. 
  
**Вызовы уведомлений о событии**
  
![Уведомление о событии вызывает вызовы](media/amapi_51.gif "уведомлений события")
  
Класс MFCMAPI **CAdviseSink** (с помощью файлов AdviseSink.h и AdviseSink.cpp) реализует объект рекомендации по раковине для всех вызовов. Дополнительные сведения о MFCMAPI см. в примере [MFCMAPI](mfcmapi-as-a-code-sample.md) и [MFCMAPI.](https://go.microsoft.com/fwlink/?LinkId=124154)
  

