---
title: Уведомление о событиях в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321400"
---
# <a name="event-notification-in-mapi"></a>Уведомление о событиях в MAPI

**Относится к**: Outlook 2013 | Outlook 2016 
  
Уведомление о событии — это обмен данными между двумя объектами MAPI. С помощью одного из объектов клиент или поставщик услуг регистрирует уведомление об изменении или ошибке, называемом событием, которое может происходить в другом объекте. После возникновения события первый объект уведомляется об изменении или ошибке. Объект, получающий уведомление, называется приемником уведомлений. Объект, ответственный за уведомление, называется источником рекомендаций.
  
Существует три типа объектов приемника уведомлений (все типы являются стандартными объектами MAPI).
  
- Посоветовать объекты приемника.   
- Объекты приемника рекомендаций для форм.  
- Просмотр объектов приемника уведомлений.
    
Объекты приемника уведомлений являются наиболее распространенным типом. Приемники уведомлений обычно реализуются клиентскими приложениями для получения уведомлений об адресных книгах и хранилищах сообщений, а также для поддержки интерфейса [имапиадвисесинк: IUnknown](imapiadvisesinkiunknown.md) . **Имапиадвисесинк** содержит один метод, [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md). Приемники уведомлений о формах и представлениях менее распространены; они реализуются для получения уведомлений об изменениях настраиваемых форм. Приемники рекомендаций для форм поддерживают [имапиформадвисесинк: интерфейс IUnknown](imapiformadvisesinkiunknown.md) и приемники уведомлений о просмотре поддерживают интерфейс [имапивиевадвисесинк: IUnknown](imapiviewadvisesinkiunknown.md) . Так как большинство клиентов реализуют стандартные объекты приемника уведомлений, предполагается, что обсуждения уведомлений связаны с адресными книгами и уведомлениями хранилища сообщений, а не уведомлениями форм. Для получения дополнительных сведений [о уведомлениях форм см.](mapi-forms-notifications.md) [Writing Form Server Code](writing-form-server-code.md)
  
Исходные объекты реализуются поставщиками услуг и MAPI. Не все поставщики услуг поддерживают уведомления о событиях; Это необязательно, но настоятельно рекомендуется. Поставщики хранилищ сообщений и адресных книг обычно поддерживают уведомления объектов для нескольких объектов и табличных уведомлений в их содержимом и таблицах иерархий. Поставщики транспорта не поддерживают уведомления напрямую; они основываются на альтернативных методах взаимодействия с клиентами.
  
В отличие от приемников уведомлений, рекомендации исходных объектов не являются уникальными типами объекта MAPI. Многие объекты MAPI, такие как хранилища сообщений и таблицы, могут принимать роли источника уведомлений. Источник уведомления — это любой объект MAPI, который выполняет следующие действия:
  
- Реализует метод **advise** для получения регистраций уведомлений. 
    
- Реализует метод **unadvise** для получения уведомлений об отмене уведомлений. 
    
- Создает уведомления о соответствующем типе для соответствующих объектов приемника уведомлений, зарегистрированных с помощью вызовов методов **имапиадвисесинк:: OnNotify** . 
    
Клиенты, реализующие объекты приемника **уведомлений,** выдают рекомендации по вызову, когда требуется зарегистрировать уведомление, в большинстве случаев передача идентификатора записи объекта, с которым должна выполняться регистрация, и **unadvise** , когда требуется отменить регистрацию. Клиенты передают **параметр,** указывающий, какой из нескольких типов событий требуется отслеживать. **Advise** возвращает ненулевое значение, представляющее успешное соединение между приемником уведомлений и источником рекомендаций. 
  
Перед вызовом **advise**клиенты могут определить, поддерживает ли поставщик хранилища сообщений уведомление, проверив, установлен ли флаг STORE_NOTIFY_OK в свойстве **PR_STORE_SUPPORT_MASK** хранилища сообщений ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)). Клиенты не могут заранее определить, поддерживает ли поставщик адресных книг уведомления. Клиенты должны попытаться зарегистрироваться и, если попытка не удалась, могут быть недоступны уведомления.
  
Когда происходит событие, для которого клиент зарегистрировался, источник уведомления уведомляет приемник уведомлений, вызывая его метод [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md) со структурой данных уведомлений, которая содержит сведения о событии. Реализация приемника уведомлений **OnNotify** может выполнять задачи в ответ на уведомление, например обновление данных в памяти или обновление экрана. 
  
Поставщики услуг могут реализовать поддержку уведомлений вручную или воспользоваться справочными сведениями, предоставленными в трех методах **имаписуппорт** : [Имаписуппорт:: Subscribe](imapisupport-subscribe.md), [имаписуппорт:: unsubscribe](imapisupport-unsubscribe.md)и [имаписуппорт:: notify](imapisupport-notify.md). Методы **Subscribe** и **Unsubscribe** обрабатывают регистрацию и отмену регистрации уведомлений для поставщиков; метод **Notify** обрабатывает отправку уведомлений при необходимости. 
  
Чтобы использовать методы объекта поддержки для регистрации уведомлений, поставщики услуг вызывают [имаписуппорт:: Subscribe](imapisupport-subscribe.md) в методах **advise** и передают **подписаться** указатель приемника уведомлений о том, что клиенты передаются в предложение **advise**. Если идентификатор записи передается в качестве входного параметра для указания источника уведомлений, поставщики служб преобразуют их в двоичный ключ. **Subscribe** создает уникальный номер подключения и это номер, который поставщики служб возвращают клиентам. Поставщики услуг могут освободить указатель на объект приемника уведомлений клиента в любое время после завершения вызова метода **advise** . 
  
Когда клиенты вызывают команду **unadvise** для отмены регистрации, поставщики услуг либо уменьшают значение счетчика ссылок в указателе приемника уведомлений клиента, либо вызывают **отмену подписки** . 
  
Когда вы создаете уведомление, поставщики услуг выполняют внутреннюю обработку, связанную с уведомлением, и инициализирует структуру [уведомлений](notification.md) путем установки для всех неиспользуемых членов нулевого значения. Этот метод инициализации структуры **уведомлений** помогает клиентам создавать небольшие, быстрые и менее подверженные ошибкам реализации **OnNotify** . 
  
На следующем рисунке показана связь между объектами приемника уведомлений, исходными объектами и MAPI. MAPI применяется только в том случае, когда источник advise вызывает методы **имаписуппорт** для поддержки уведомлений. 
  
**Вызовы уведомлений о событии**
  
![Уведомления]о событиях вызывает уведомления о(media/amapi_51.gif "событиях")
  
Класс MFCMAPI **кадвисесинк** (с использованием файлов адвисесинк. h и адвисесинк. cpp) реализует объект приемника уведомлений для всех вызовов, для которых требуется **advise**. Дополнительные сведения о MFCMAPI см MFCMAPI в [примере кода](mfcmapi-as-a-code-sample.md) и [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).
  

