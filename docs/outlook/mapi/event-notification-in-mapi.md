---
title: Уведомление о событиях в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321400"
---
# <a name="event-notification-in-mapi"></a><span data-ttu-id="7fa5d-103">Уведомление о событиях в MAPI</span><span class="sxs-lookup"><span data-stu-id="7fa5d-103">Event notification in MAPI</span></span>

<span data-ttu-id="7fa5d-104">**Область применения**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="7fa5d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="7fa5d-105">Уведомление о событии — это сообщение информации между двумя объектами MAPI.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-105">Event notification is the communication of information between two MAPI objects.</span></span> <span data-ttu-id="7fa5d-106">Через один из объектов клиент или поставщик услуг регистрируется для уведомления об изменении или ошибке, называемом событием, которое может иметь место в другом объекте.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-106">Through one of the objects, a client or service provider registers for notification of a change or error, called an event, which may take place in the other object.</span></span> <span data-ttu-id="7fa5d-107">После события первый объект уведомлен об изменении или ошибке.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-107">After the event occurs, the first object is notified of the change or error.</span></span> <span data-ttu-id="7fa5d-108">Объект, получающий уведомление, называется раковиной консультаций; объект, ответственный за уведомление, называется источником консультаций.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-108">The object receiving the notification is called the advise sink; the object responsible for the notification is called the advise source.</span></span>
  
<span data-ttu-id="7fa5d-109">Существует три типа объектов раковины-рекомендации (все типы являются стандартными объектами MAPI):</span><span class="sxs-lookup"><span data-stu-id="7fa5d-109">There are three types of advise sink objects (all types are standard MAPI objects):</span></span>
  
- <span data-ttu-id="7fa5d-110">Советую объекты раковины.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-110">Advise sink objects.</span></span>   
- <span data-ttu-id="7fa5d-111">Форма советует объекты раковины.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-111">Form advise sink objects.</span></span>  
- <span data-ttu-id="7fa5d-112">Просмотр рекомендуемые объекты раковины.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-112">View advise sink objects.</span></span>
    
<span data-ttu-id="7fa5d-113">Советую объекты раковины являются наиболее распространенным типом.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-113">Advise sink objects are the most common type.</span></span> <span data-ttu-id="7fa5d-114">Обычно клиентские приложения реализуют прием уведомлений о адресной книге и хранилище сообщений и поддерживают [интерфейс IMAPIAdviseSink: IUnknown.](imapiadvisesinkiunknown.md)</span><span class="sxs-lookup"><span data-stu-id="7fa5d-114">Advise sinks are typically implemented by client applications to receive address book and message store notifications and support the [IMAPIAdviseSink : IUnknown](imapiadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="7fa5d-115">**IMAPIAdviseSink** содержит один метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span><span class="sxs-lookup"><span data-stu-id="7fa5d-115">**IMAPIAdviseSink** contains a single method, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span></span> <span data-ttu-id="7fa5d-116">Формы и представления советовать раковины являются менее распространенными; они реализуются для получения уведомлений об изменениях в настраиваемые формы.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-116">Form and view advise sinks are less common; they are implemented to receive notifications about changes to custom forms.</span></span> <span data-ttu-id="7fa5d-117">Форма советует раковинам поддерживать [интерфейс IMAPIFormAdviseSink: интерфейс iUnknown](imapiformadvisesinkiunknown.md) и представления советовать раковинам поддерживать [интерфейс IMAPIViewAdviseSink : IUnknown.](imapiviewadvisesinkiunknown.md)</span><span class="sxs-lookup"><span data-stu-id="7fa5d-117">Form advise sinks support the [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) interface and view advise sinks support the [IMAPIViewAdviseSink : IUnknown](imapiviewadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="7fa5d-118">Поскольку большинство клиентов реализуют стандартные объекты раковины, предположим, что обсуждения уведомлений касаются уведомлений адресной книги и магазина сообщений, а не форм уведомлений.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-118">Because most clients implement standard advise sink objects, assume that discussions of notifications relate to address book and message store notifications rather than forms notifications.</span></span> <span data-ttu-id="7fa5d-119">Дополнительные сведения об уведомлениях форм см. в [заметке MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code.](writing-form-server-code.md)</span><span class="sxs-lookup"><span data-stu-id="7fa5d-119">For more information about forms notifications, see [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span></span>
  
<span data-ttu-id="7fa5d-120">Рекомендуемые исходные объекты реализуются поставщиками услуг и MAPI.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-120">Advise source objects are implemented by service providers and by MAPI.</span></span> <span data-ttu-id="7fa5d-121">Не все поставщики услуг поддерживают уведомление о событиях; это необязательно, но настоятельно рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-121">Not all service providers support event notification; it is optional, but strongly recommended.</span></span> <span data-ttu-id="7fa5d-122">Поставщики хранения сообщений и адресных книг обычно поддерживают уведомления об объектах на нескольких объектах и таблицы уведомлений в их содержимом и таблицах иерархии.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-122">Message store and address book providers usually support object notifications on several of their objects and table notifications on their contents and hierarchy tables.</span></span> <span data-ttu-id="7fa5d-123">Поставщики транспорта не поддерживают уведомления напрямую; они полагаются на альтернативные методы общения с клиентами.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-123">Transport providers do not support notifications directly; they rely on alternative methods of communication with clients.</span></span>
  
<span data-ttu-id="7fa5d-124">В отличие от советуем раковины, советовать исходные объекты не являются уникальным типом объекта MAPI.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-124">Unlike advise sinks, advise source objects are not a unique type of MAPI object.</span></span> <span data-ttu-id="7fa5d-125">Многие объекты MAPI, такие как хранилища сообщений и таблицы, могут взять на себя роль источника консультаций.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-125">Many MAPI objects, such as message stores and tables, can take on the role of advise source.</span></span> <span data-ttu-id="7fa5d-126">Источником консультаций является любой объект MAPI, который делает следующее:</span><span class="sxs-lookup"><span data-stu-id="7fa5d-126">An advise source is any MAPI object that does the following:</span></span>
  
- <span data-ttu-id="7fa5d-127">Реализует метод **Advise** для получения регистрации уведомлений.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-127">Implements an **Advise** method to receive notification registrations.</span></span> 
    
- <span data-ttu-id="7fa5d-128">Реализует метод **Unadvise** для получения отмены уведомлений.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-128">Implements an **Unadvise** method to receive notification cancellations.</span></span> 
    
- <span data-ttu-id="7fa5d-129">Генерирует уведомления соответствующего типа соответствующим объектам раковины, зарегистрированным путем вызова их **методов IMAPIAdviseSink::OnNotify.**</span><span class="sxs-lookup"><span data-stu-id="7fa5d-129">Generates notifications of the appropriate type to the appropriate advise sink objects that have registered by calling their **IMAPIAdviseSink::OnNotify** methods.</span></span> 
    
<span data-ttu-id="7fa5d-130">Клиенты, реализующие  рекомендации по вызову объектов раковины, советуют, когда они хотят зарегистрироваться для уведомления, в большинстве случаев передав идентификатор входа объекту, с которым должна произойти регистрация, и **отменить,** когда они хотят отменить регистрацию.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-130">Clients that implement advise sink objects call **Advise** when they want to register for a notification, in most cases passing in the entry identifier of the object with which registration should occur, and **Unadvise** when they want to cancel the registration.</span></span> <span data-ttu-id="7fa5d-131">Клиенты передают параметр **Advise,** который указывает, какие из нескольких типов событий они хотят отслеживать.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-131">Clients pass a parameter to **Advise** that indicates which of the several types of events they want to monitor.</span></span> <span data-ttu-id="7fa5d-132">**Советую** возвращать номер nonzero, который представляет успешное подключение между раковиной рекомендации и источником консультации.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-132">**Advise** returns a nonzero number that represents a successful connection between the advise sink and advise source.</span></span> 
  
<span data-ttu-id="7fa5d-133">Перед вызовом консультации клиенты могут определить, поддерживает ли поставщик магазина сообщений уведомление, проверяя,  что флаг STORE_NOTIFY_OK установлен в свойстве PR_STORE_SUPPORT_MASK магазина сообщений[(PidTagStoreSupportMask).](pidtagstoresupportmask-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="7fa5d-133">Before calling **Advise**, clients can determine whether a message store provider supports notification by checking that the STORE_NOTIFY_OK flag is set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span> <span data-ttu-id="7fa5d-134">Клиенты не могут заранее определить, поддерживает ли поставщик адресной книги уведомления.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-134">There is no way for clients to determine ahead of time whether or not an address book provider supports notifications.</span></span> <span data-ttu-id="7fa5d-135">Клиенты должны попытаться зарегистрироваться, и если попытка не удалась, они могут предположить, что уведомления неподтверчены.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-135">Clients must attempt to register and if the attempt fails, they can assume notifications are unsupported.</span></span>
  
<span data-ttu-id="7fa5d-136">Когда происходит событие, для которого зарегистрирован клиент, источник консультирования оповещен о приеме рекомендации, вызывая его [метод IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) со структурой данных уведомлений, содержащего сведения о событии.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-136">When an event for which a client has registered occurs, the advise source notifies the advise sink by calling its [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method with a notification data structure that contains information about the event.</span></span> <span data-ttu-id="7fa5d-137">Реализация **OnNotify,** выполняемая по рекомендации, может выполнять задачи в ответ на уведомление, например обновление данных в памяти или обновление экрана.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-137">An advise sink's implementation of **OnNotify** can perform tasks in response to the notification, such as updating data in memory or refreshing a screen display.</span></span> 
  
<span data-ttu-id="7fa5d-138">Поставщики услуг могут реализовать поддержку уведомлений вручную или воспользоваться помощью, предоставляемой в трех методах **IMAPISupport:** [IMAPISupport::Subscribe,](imapisupport-subscribe.md) [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)и [IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="7fa5d-138">Service providers can implement support for notifications manually or take advantage of the help provided in three **IMAPISupport** methods: [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md), and [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="7fa5d-139">Методы **Подписки** и **отписки** обрабатывают регистрацию уведомлений и дерегулирование для поставщиков; Метод **Notify** обрабатывает отправку уведомлений при необходимости.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-139">The **Subscribe** and **Unsubscribe** methods handle notification registration and deregistration for providers; the **Notify** method handles sending notifications when appropriate.</span></span> 
  
<span data-ttu-id="7fa5d-140">Чтобы использовать методы объекта поддержки для регистрации уведомлений, поставщики услуг  звонят в  [IMAPISupport::Subscribe](imapisupport-subscribe.md) в своих методах консультирования и передают подписку на указатель рекомендации по приему, который клиенты передают в Службу консультирования. </span><span class="sxs-lookup"><span data-stu-id="7fa5d-140">To use the support object methods for notification registration, service providers call [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span></span> <span data-ttu-id="7fa5d-141">Если идентификатор записи передается в качестве параметра ввода для указания источника консультаций, поставщики услуг преобразуют его в двоичный ключ.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-141">If an entry identifier is passed as an input parameter to specify an advise source, service providers convert it to a binary key.</span></span> <span data-ttu-id="7fa5d-142">**Подписка** создает уникальный номер подключения, и именно этот номер поставщики услуг возвращают клиентам.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-142">**Subscribe** creates a unique connection number and it is this number that service providers return to clients.</span></span> <span data-ttu-id="7fa5d-143">Поставщики услуг могут освободить указатель объекта раковины клиента в любое время после завершения вызова **advise.**</span><span class="sxs-lookup"><span data-stu-id="7fa5d-143">Service providers can release the client's advise sink object pointer at any time after the **Advise** call has completed.</span></span> 
  
<span data-ttu-id="7fa5d-144">Когда клиенты звонят **в Unadvise,** чтобы отменить регистрацию, поставщики услуг либо приумножить количество ссылок на указатель раковины рекомендации клиента, либо вызвать отмену, чтобы сделать то же самое. </span><span class="sxs-lookup"><span data-stu-id="7fa5d-144">When clients call **Unadvise** to cancel a registration, service providers either decrement the reference count on the client's advise sink pointer or call **Unsubscribe** to do the same.</span></span> 
  
<span data-ttu-id="7fa5d-145">Когда пришло время для создания уведомления, поставщики услуг выполняют любую внутреннюю обработку, связанную с уведомлением, и инициализируют структуру УВЕДОМЛЕНий, установив все неиспользованые участники до нуля. [](notification.md)</span><span class="sxs-lookup"><span data-stu-id="7fa5d-145">When it is time to generate a notification, service providers perform any internal processing that relates to the notification and initializes a [NOTIFICATION](notification.md) structure by setting all of its unused members to zero.</span></span> <span data-ttu-id="7fa5d-146">Этот метод инициализации структуры **УВЕДОМЛЕНИй** помогает клиентам создавать более мелкие, быстрые и менее подверженные ошибкам реализации **OnNotify.**</span><span class="sxs-lookup"><span data-stu-id="7fa5d-146">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="7fa5d-147">На следующей иллюстрации показана связь между объектами раковины, советовать исходные объекты и MAPI.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-147">The following illustration shows the communication between advise sink objects, advise source objects, and MAPI.</span></span> <span data-ttu-id="7fa5d-148">MAPI участвует только тогда, когда источник консультаций вызывает **методы IMAPISupport** для поддержки уведомлений.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-148">MAPI is involved only when the advise source calls the **IMAPISupport** methods for notification support.</span></span> 
  
<span data-ttu-id="7fa5d-149">**Вызовы уведомлений о событии**</span><span class="sxs-lookup"><span data-stu-id="7fa5d-149">**Event notification calls**</span></span>
  
<span data-ttu-id="7fa5d-150">![Уведомление о событии вызывает вызовы](media/amapi_51.gif "уведомлений события")</span><span class="sxs-lookup"><span data-stu-id="7fa5d-150">![Event notification calls](media/amapi_51.gif "Event notification calls")</span></span>
  
<span data-ttu-id="7fa5d-151">Класс MFCMAPI **CAdviseSink** (с помощью файлов AdviseSink.h и AdviseSink.cpp) реализует объект рекомендации по раковине для всех вызовов.</span><span class="sxs-lookup"><span data-stu-id="7fa5d-151">The MFCMAPI **CAdviseSink** class (using the AdviseSink.h and AdviseSink.cpp files) implements the advise sink object for all calls to **Advise**.</span></span> <span data-ttu-id="7fa5d-152">Дополнительные сведения о MFCMAPI см. в примере [MFCMAPI](mfcmapi-as-a-code-sample.md) и [MFCMAPI.](https://go.microsoft.com/fwlink/?LinkId=124154)</span><span class="sxs-lookup"><span data-stu-id="7fa5d-152">For more information about MFCMAPI, see [MFCMAPI as a Code Sample](mfcmapi-as-a-code-sample.md) and [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).</span></span>
  

