---
title: Вход в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419711"
---
# <a name="logging-on-to-mapi"></a>Вход в MAPI
 
**Область применения**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения войдите в подсистему MAPI, позвонив в **функцию MAPILogonEx.** Дополнительные сведения см. в [mapILogonEx.](mapilogonex.md) **MAPILogonEx** проверяет выбор профиля и конфигурацию каждого поставщика услуг в профиле. После настройки MAPI запускает поставщиков адресных книг перед запуском поставщиков магазинов сообщений. Поставщики транспортных услуг запущены, когда их службы требуются в первую очередь. 
  
## <a name="choose-a-profile"></a>Выбор профиля
  
- Передай строку символов, которая представляет имя профиля в параметре  _lpszProfileName_ в **MAPILogonEx** или...
    
- Разрешить пользователю указать профиль, передав NULL в  _параметре lpszProfileName_ и установив флаг MAPI_LOGON_UI или... 

- Выберите профиль по умолчанию, передав NULL в  _параметре lpszProfileName_ и задав MAPI_USE_DEFAULT флага. 
    
Если требуется определенный профиль, кроме профиля по умолчанию, необходимо сохранить его имя в собственной базе данных конфигурации или использовать определенную конвенцию именования. MAPI не предоставляет атрибуты профилей, кроме флага имени и по умолчанию в таблице профилей, а флаг профиля по умолчанию зарезервирован для клиентских сообщений и связанных приложений IPM.
  
Клиенты, которые поставляют частичные сведения о конфигурации профиля или поставщика **в MAPILogonEx,** должны предоставить пользователю дополнительные данные, разрешив отображать диалоговое окно. Если сведения отсутствуют, **и MAPILogonEx** не может побудить пользователя предоставить ее, логотип не удается. Клиенты, не нуждающиеся в пользовательском входе, могут подавить диалоговое окно. 
  
Флаги, которые **MAPILogonEx** использует для обеспечения пользовательского интерфейса, являются взаимоисключающими; только один может быть установлен. Оставление этих флагов неустановленным подавляет отображение пользовательского интерфейса, в результате чего **MAPILogonEx** не удается, если отсутствуют необходимые сведения. То есть, если отключить пользовательский интерфейс и передать NULL для параметра  _lpszProfileName_ и не задать флаг MAPI_USE_DEFAULT, **MAPILogonEx** не сможет получить имя профиля. 
  
Сеанс, который **создает MAPILogonEx,** может быть отдельным сеансом обмена сообщениями, сеансом обмена общими сообщениями или сеансом без обмена сообщениями. Отдельные сеансы обмена сообщениями являются личными подключениями между клиентом и подсистемой MAPI и могут быть установлены путем установки флага MAPI_NEW_SESSION в вызове **MAPILogonEx**.
  
Сеансы обмена сообщениями — это подключения, которые могут использовать несколько клиентов обмена сообщениями. Общие сеансы обычно устанавливаются для клиентов, которые используют один и тот же профиль. Чтобы установить новый сеанс в качестве общего сеанса, установите флаг MAPI_ALLOW_OTHERS. 
  
## <a name="use-an-existing-shared-session"></a>Использование существующего общего сеанса
  
- Не установите флаг MAPI_NEW_SESSION.
    
- Не установите флаг MAPI_ALLOW_OTHERS.
    
- Передай NULL для _параметра lpszProfileName._ 
    
- Передай NULL для _параметра lpszPassword._ 
    
Сеансы nonmessaging позволяют клиентам получать доступ к подсистеме MAPI, но не позволяют отправлять или получать сообщения. Приложения конфигурации или администрирования — это примеры клиентов, которые могут потребоваться для создания сеансов немессинга. Чтобы запросить сеанс nonmessaging, установите MAPI_NO_MAIL флаг. Настройка этого флага записи клиента без информирования шпалер MAPI. Клиенты, войдите в MAPI с этим флагом, не могут рассчитывать на получение отчетов о состоянии чтения.
  
Флаг MAPI_NO_MAIL должен быть только установлен:
  
- Если клиент не будет отправлять или получать сообщения во время сеанса.
    
- Если клиент полностью контролирует содержимое профиля, а сообщения отправляются и получаются с помощью тесно скрепляемого магазина сообщений и поставщиков транспорта, таких как поставщики Exchange Майкрософт.
    
Клиент обмена сообщениями может делиться сеансом с клиентом, не вступающий в систему обмена сообщениями. Характеристики одного члена общего сеанса не влияют на характеристики других участников. То есть, если вы входите в систему с набором флагов MAPI_NO_MAIL и MAPI_ALLOW_OTHERS, клиент обмена сообщениями, войдя в сеанс, не влияет на работу клиента и наоборот. Клиент обмена сообщениями по-прежнему сможет отправлять и получать сообщения, а клиент не будет.
  
**MAPILogonEx** определяет несколько других флагов, которые можно установить: 
  
- MAPI_FORCE_DOWNLOAD указывает, что входящие сообщения следует скачивать до возвращения **MAPILogonEx.** Не установка этого флага приводит к загрузке сообщений в фоновом режиме в более позднее время. 
    
- MAPI_SERVICE_UI_ALWAYS, чтобы каждая служба сообщений в профиле отображала диалоговое окно конфигурации.
    
- MAPI_NT_SERVICE указывает, что клиент реализован в качестве Windows службы. Этот флаг должен быть установлен, если клиент является службой.
    
При каждом успешном логотипе **MAPILogonEx** возвращает указатель на сеанс MAPI. Этот указатель можно использовать для вызова методов **интерфейса IMAPISession.** Дополнительные сведения см. [в iMAPISession : IUnknown](imapisessioniunknown.md). Указатели сеанса, независимо от типа сеанса, являются уникальными для клиентов, которые их получают, и не допустимы для всех задач.
  

