---
title: Вход в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419711"
---
# <a name="logging-on-to-mapi"></a>Вход в MAPI
 
**Относится к**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения войдите в подсистему MAPI, вызывая **функцию MAPILogonEx.** Дополнительные сведения см. в [mapILogonEx.](mapilogonex.md) **MAPILogonEx** проверяет выбор профиля и конфигурацию каждого поставщика службы в профиле. После настройки MAPI запускает поставщиков адресных книг перед запуском поставщиков store сообщений. Поставщики транспорта запущены, когда их службы в первую очередь необходимы. 
  
## <a name="choose-a-profile"></a>Выбор профиля
  
- Передав строку символов, представляюную имя профиля в параметре  _lpszProfileName,_ **в MAPILogonEx** или...
    
- Разрешить пользователю указать профиль, передав NULL в параметр  _lpszProfileName_ и установив флаг MAPI_LOGON_UI или... 

- Выберите профиль по умолчанию, передав значение NULL в параметр  _lpszProfileName_ и установив MAPI_USE_DEFAULT флага. 
    
Если требуется определенный профиль, кроме профиля по умолчанию, необходимо сохранить его имя в собственной базе данных конфигурации или использовать определенное соглашение об именовнии. MAPI не предоставляет атрибуты профиля, кроме имени и флага по умолчанию, в таблице профилей, а флаг профиля по умолчанию зарезервирован для клиента обмена сообщениями и связанных приложений IPM.
  
Клиенты, которые поставляют в **MAPILogonEx** сведения о частичном профиле или конфигурации поставщика, должны запросить пользователю дополнительные данные, разрешив отображение диалоговых окно. Если сведения отсутствуют, **и MAPILogonEx** не может предоставить их пользователю, то при этом не удастся. Клиенты, которые не нуждаются в пользовательском вводе, могут ото всех отобразить диалоговое окно. 
  
Флаги, которые **MAPILogonEx** использует для обеспечения пользовательского интерфейса, являются взаимоисключающими; Можно установить только один из них. Если оставить эти флаги неустановленным, отображение пользовательского интерфейса не будет отображаться, что приводит к **сбойу MAPILogonEx,** если отсутствуют необходимые сведения. То есть, если отключить пользовательский интерфейс и передать NULL для параметра  _lpszProfileName_ и не установить флаг MAPI_USE_DEFAULT, **MAPILogonEx** не сможет получить имя профиля. 
  
Сеанс, который **создает MAPILogonEx,** может быть отдельным сеансом обмена сообщениями, сеансом обмена общими сообщениями или сеансом несекреционного обмена сообщениями. Отдельные сеансы обмена сообщениями — это частные подключения между клиентом и подсистемой MAPI, которые можно установить, установив флаг MAPI_NEW_SESSION в вызове **MAPILogonEx.**
  
Сеансы обмена общими сообщениями — это подключения, которые могут использовать несколько клиентов обмена сообщениями. Общие сеансы обычно устанавливаются для клиентов, которые используют один и тот же профиль. Чтобы установить новый сеанс в качестве общего сеанса, установите MAPI_ALLOW_OTHERS сеанса. 
  
## <a name="use-an-existing-shared-session"></a>Использование существующего общего сеанса
  
- Не устанавливать флаг MAPI_NEW_SESSION.
    
- Не устанавливать флаг MAPI_ALLOW_OTHERS.
    
- Передав NULL для _параметра lpszProfileName._ 
    
- Передав NULL для _параметра lpszPassword._ 
    
Неmessaging sessions allow clients to access the MAPI subsystem, but do not allow messages to be sent or received. Приложения конфигурации или администрирования — это примеры клиентов, которые могут потребоваться для создания немессагистрных сеансов. Чтобы запросить немессагивный сеанс, установите MAPI_NO_MAIL флага. Установка этого флага занося в журнал клиента без информирования пула MAPI. Клиенты, которые войдите в MAPI с этим флагом, не смогут получать отчеты о состоянии чтения.
  
Флажок MAPI_NO_MAIL должен быть установлен только:
  
- Если клиент не будет отправлять или получать сообщения во время сеанса.
    
- Если клиент полностью контролирует содержимое профиля, а сообщения отправляются и получаются с помощью тесно сжатых служб хранения сообщений и поставщиков транспорта, таких как поставщики Microsoft Exchange.
    
Клиент обмена сообщениями может совместно использовать сеанс с клиентом, который не является немессагизационным. Характеристики одного участника общего сеанса не влияют на характеристики других участников. То есть, если вы входите в систему с установленными флагами MAPI_NO_MAIL и MAPI_ALLOW_OTHERS, клиент обмена сообщениями, войдя в сеанс, не влияет на работу клиента и наоборот. Клиент обмена сообщениями по-прежнему сможет отправлять и получать сообщения, а клиент не сможет этого делать.
  
**MAPILogonEx** определяет несколько других флагов, которые можно установить: 
  
- MAPI_FORCE_DOWNLOAD указывает, что входящие сообщения необходимо скачать до возврата **MAPILogonEx.** Если не установить этот флаг, сообщения будут загружаться в фоновом режиме позже. 
    
- MAPI_SERVICE_UI_ALWAYS, чтобы каждая служба сообщений в профиле отображала диалоговое окно конфигурации.
    
- MAPI_NT_SERVICE указывает, что клиент реализован в качестве службы Windows. Этот флаг должен быть установлен, если клиент является службой.
    
При каждом успешном сеансе работы **mapILogonEx** возвращает указатель на сеанс MAPI. Этот указатель можно использовать для вызова методов интерфейса **IMAPISession.** Дополнительные сведения см. в [подразделе IMAPISession : IUnknown](imapisessioniunknown.md). Указатели сеанса, независимо от типа сеанса, являются уникальными для клиентов, которые их получают, и не являются допустимыми для задач.
  

