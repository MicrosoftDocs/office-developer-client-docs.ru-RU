---
title: Вход в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419711"
---
# <a name="logging-on-to-mapi"></a><span data-ttu-id="359c5-103">Вход в MAPI</span><span class="sxs-lookup"><span data-stu-id="359c5-103">Logging on to MAPI</span></span>
 
<span data-ttu-id="359c5-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="359c5-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="359c5-105">Клиентские приложения выполняют вход в подсистему MAPI, вызывая функцию **мапилогонекс** .</span><span class="sxs-lookup"><span data-stu-id="359c5-105">Client applications log on to the MAPI subsystem by calling the **MAPILogonEx** function.</span></span> <span data-ttu-id="359c5-106">Дополнительные сведения см. в разделе [мапилогонекс](mapilogonex.md).</span><span class="sxs-lookup"><span data-stu-id="359c5-106">For more information, see [MAPILogonEx](mapilogonex.md).</span></span> <span data-ttu-id="359c5-107">**Мапилогонекс** проверяет выбор профиля и конфигурацию каждого поставщика услуг в профиле.</span><span class="sxs-lookup"><span data-stu-id="359c5-107">**MAPILogonEx** validates the profile selection and the configuration of each service provider in the profile.</span></span> <span data-ttu-id="359c5-108">После настройки MAPI запускает поставщиков адресных книг перед запуском поставщиков хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="359c5-108">Once configured, MAPI starts the address book providers before starting the message store providers.</span></span> <span data-ttu-id="359c5-109">Поставщики транспорта запускаются, когда их службы впервые требуются.</span><span class="sxs-lookup"><span data-stu-id="359c5-109">Transport providers are started when their services are first required.</span></span> 
  
## <a name="choose-a-profile"></a><span data-ttu-id="359c5-110">Выбор профиля</span><span class="sxs-lookup"><span data-stu-id="359c5-110">Choose a profile</span></span>
  
- <span data-ttu-id="359c5-111">Передайте строку символов, представляющую имя профиля в параметре _лпсзпрофиленаме_ , в **мапилогонекс**или...</span><span class="sxs-lookup"><span data-stu-id="359c5-111">Pass in a character string that represents the name of the profile in the  _lpszProfileName_ parameter to **MAPILogonEx**, or...</span></span>
    
- <span data-ttu-id="359c5-112">Разрешить пользователю указывать профиль, передавая значение NULL в параметре _лпсзпрофиленаме_ и устанавливая флаг MAPI_LOGON_UI или...</span><span class="sxs-lookup"><span data-stu-id="359c5-112">Allow the user to specify the profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_LOGON_UI flag, or...</span></span> 

- <span data-ttu-id="359c5-113">Выберите профиль по умолчанию, передав значение NULL в параметре _лпсзпрофиленаме_ и установив флаг MAPI_USE_DEFAULT.</span><span class="sxs-lookup"><span data-stu-id="359c5-113">Select the default profile by passing NULL in the  _lpszProfileName_ parameter and setting the MAPI_USE_DEFAULT flag.</span></span> 
    
<span data-ttu-id="359c5-114">Если требуется определенный профиль, отличный от профиля по умолчанию, необходимо сохранить его имя в собственной базе данных конфигурации или использовать конкретное соглашение об именовании.</span><span class="sxs-lookup"><span data-stu-id="359c5-114">If you require a specific profile other than the default profile, you must save its name in your own configuration database or use a specific naming convention.</span></span> <span data-ttu-id="359c5-115">MAPI не предоставляет атрибуты профиля, отличные от имени и флага по умолчанию в таблице профиля, а флаг профиля по умолчанию зарезервирован для клиента обмена сообщениями и связанных приложений IPM.</span><span class="sxs-lookup"><span data-stu-id="359c5-115">MAPI does not expose any profile attributes other than the name and default flag in the profile table, and the default profile flag is reserved for messaging client and related IPM applications.</span></span>
  
<span data-ttu-id="359c5-116">Клиенты, которые поставляет в **мапилогонекс** сведения о конфигурации с частичными профилями или поставщиками, должны запрашивать у пользователя дополнительные данные, разрешив отображение диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="359c5-116">Clients that supply partial profile or provider configuration information to **MAPILogonEx** must prompt the user for the additional data by allowing a dialog box to be displayed.</span></span> <span data-ttu-id="359c5-117">Если информация отсутствует, и **мапилогонекс** не может предложить пользователю ввести его, произойдет сбой входа.</span><span class="sxs-lookup"><span data-stu-id="359c5-117">If information is missing and **MAPILogonEx** cannot prompt the user to supply it, the logon fails.</span></span> <span data-ttu-id="359c5-118">Клиенты, которые не нуждаются в пользовательском вводе, могут подавить отображение диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="359c5-118">Clients that do not need user input can suppress the dialog box display.</span></span> 
  
<span data-ttu-id="359c5-119">Флаги, которые **мапилогонекс** использует для включения пользовательского интерфейса, являются взаимоисключающими; можно задать только один из них.</span><span class="sxs-lookup"><span data-stu-id="359c5-119">The flags that **MAPILogonEx** uses to enable a user interface are mutually exclusive; only one can be set.</span></span> <span data-ttu-id="359c5-120">Если оставить эти флаги без изменений, отображение пользовательского интерфейса подавляется, что приводит к сбою **мапилогонекс** при отсутствии необходимой информации.</span><span class="sxs-lookup"><span data-stu-id="359c5-120">Leaving these flags unset suppresses the display of a user interface, causing **MAPILogonEx** to fail if necessary information is missing.</span></span> <span data-ttu-id="359c5-121">То есть, если отключить пользовательский интерфейс и передать значение NULL для параметра _лпсзпрофиленаме_ и не устанавливать флаг MAPI_USE_DEFAULT, то **мапилогонекс** завершится с ошибками, так как не удается получить имя профиля.</span><span class="sxs-lookup"><span data-stu-id="359c5-121">That is, if you disable the user interface and pass NULL for the  _lpszProfileName_ parameter and do not set the MAPI_USE_DEFAULT flag, **MAPILogonEx** will fail because it cannot retrieve a profile name.</span></span> 
  
<span data-ttu-id="359c5-122">Сеанс, установленный **мапилогонекс** , может быть отдельным сеансом обмена сообщениями, сеансом обмена сообщениями или сеансом, не используемым для обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="359c5-122">The session that **MAPILogonEx** establishes can be an individual messaging session, a shared messaging session, or a nonmessaging session.</span></span> <span data-ttu-id="359c5-123">Отдельные сеансы обмена сообщениями — это частные подключения между клиентом и подсистемой MAPI, которые можно установить путем установки флага MAPI_NEW_SESSION в вызове **мапилогонекс**.</span><span class="sxs-lookup"><span data-stu-id="359c5-123">Individual messaging sessions are private connections between your client and the MAPI subsystem and can be established by setting the MAPI_NEW_SESSION flag in the call to **MAPILogonEx**.</span></span>
  
<span data-ttu-id="359c5-124">Сеансы общего обмена сообщениями — это подключения, которые могут использовать несколько клиентов обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="359c5-124">Shared messaging sessions are connections that multiple messaging clients can use.</span></span> <span data-ttu-id="359c5-125">Общие сеансы обычно устанавливаются для клиентов, использующих один и тот же профиль.</span><span class="sxs-lookup"><span data-stu-id="359c5-125">Shared sessions are typically established for clients use the same profile.</span></span> <span data-ttu-id="359c5-126">Чтобы создать новый сеанс в качестве общего сеанса, установите флаг MAPI_ALLOW_OTHERS.</span><span class="sxs-lookup"><span data-stu-id="359c5-126">To establish a new session as a shared session, set the MAPI_ALLOW_OTHERS flag.</span></span> 
  
## <a name="use-an-existing-shared-session"></a><span data-ttu-id="359c5-127">Использование существующего общего сеанса</span><span class="sxs-lookup"><span data-stu-id="359c5-127">Use an existing shared session</span></span>
  
- <span data-ttu-id="359c5-128">Не задавайте флаг MAPI_NEW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="359c5-128">Do not set the MAPI_NEW_SESSION flag.</span></span>
    
- <span data-ttu-id="359c5-129">Не задавайте флаг MAPI_ALLOW_OTHERS.</span><span class="sxs-lookup"><span data-stu-id="359c5-129">Do not set the MAPI_ALLOW_OTHERS flag.</span></span>
    
- <span data-ttu-id="359c5-130">Передайте значение NULL для параметра _лпсзпрофиленаме_ .</span><span class="sxs-lookup"><span data-stu-id="359c5-130">Pass NULL for the  _lpszProfileName_ parameter.</span></span> 
    
- <span data-ttu-id="359c5-131">Передайте значение NULL для параметра _лпсзпассворд_ .</span><span class="sxs-lookup"><span data-stu-id="359c5-131">Pass NULL for the  _lpszPassword_ parameter.</span></span> 
    
<span data-ttu-id="359c5-132">Сеансы без обмена сообщениями позволяют клиентам получать доступ к подсистеме MAPI, но не разрешать отправку и получение сообщений.</span><span class="sxs-lookup"><span data-stu-id="359c5-132">Nonmessaging sessions allow clients to access the MAPI subsystem, but do not allow messages to be sent or received.</span></span> <span data-ttu-id="359c5-133">Приложения конфигурации или администрирования — это примеры клиентов, которым может потребоваться установить сеансы, не являющиеся сеансами обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="359c5-133">Configuration or administration applications are examples of clients that might need to establish nonmessaging sessions.</span></span> <span data-ttu-id="359c5-134">Чтобы запросить сеанс, не являющийся сеансом обмена сообщениями, установите флаг MAPI_NO_MAIL.</span><span class="sxs-lookup"><span data-stu-id="359c5-134">To request a nonmessaging session, set the MAPI_NO_MAIL flag.</span></span> <span data-ttu-id="359c5-135">При установке этого флага записывается в журнал клиент, который не сообщает диспетчер очереди MAPI.</span><span class="sxs-lookup"><span data-stu-id="359c5-135">Setting this flag logs your client on without informing the MAPI spooler.</span></span> <span data-ttu-id="359c5-136">Клиенты, которые подключаются к MAPI с помощью этого флага, не могут ожидать получения отчетов о состоянии прочтения.</span><span class="sxs-lookup"><span data-stu-id="359c5-136">Clients that log on to MAPI with this flag cannot expect to ever receive read status reports.</span></span>
  
<span data-ttu-id="359c5-137">Флаг MAPI_NO_MAIL должен быть установлен только:</span><span class="sxs-lookup"><span data-stu-id="359c5-137">The MAPI_NO_MAIL flag should only be set:</span></span>
  
- <span data-ttu-id="359c5-138">Если клиент не будет отправлять и получать сообщения во время сеанса.</span><span class="sxs-lookup"><span data-stu-id="359c5-138">If your client will not send or receive messages during the session.</span></span>
    
- <span data-ttu-id="359c5-139">Если ваш клиент имеет полный контроль над содержимым профиля, а сообщения отправляются и принимаются с помощью тесно связанных хранилищ сообщений и поставщиков транспорта, таких как поставщики Microsoft Exchange.</span><span class="sxs-lookup"><span data-stu-id="359c5-139">If your client has complete control over the contents of the profile and messages are sent and received using tightly coupled message store and transport providers, such as the Microsoft Exchange providers.</span></span>
    
<span data-ttu-id="359c5-140">Клиент обмена сообщениями может совместно использовать сеанс с клиентом без обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="359c5-140">A messaging client can share a session with a nonmessaging client.</span></span> <span data-ttu-id="359c5-141">Характеристики других членов не влияют на характеристики одного участника общего сеанса.</span><span class="sxs-lookup"><span data-stu-id="359c5-141">The characteristics of one member of a shared session are not affected by the characteristics of other members.</span></span> <span data-ttu-id="359c5-142">То есть, если вы входите в систему с установленным флажком MAPI_NO_MAIL и MAPI_ALLOW_OTHERS, то клиент обмена сообщениями, который входит в сеанс, не влияет на работу клиента и наоборот.</span><span class="sxs-lookup"><span data-stu-id="359c5-142">That is, if you log on with the MAPI_NO_MAIL and MAPI_ALLOW_OTHERS flags set, a messaging client logging on to your session has no affect on the operation of your client and vice versa.</span></span> <span data-ttu-id="359c5-143">Клиент обмена сообщениями по-прежнему сможет отправлять и получать сообщения, а клиент не будет.</span><span class="sxs-lookup"><span data-stu-id="359c5-143">The messaging client will still be able to send and receive messages and your client will not.</span></span>
  
<span data-ttu-id="359c5-144">**Мапилогонекс** определяет несколько других флагов, которые можно задать:</span><span class="sxs-lookup"><span data-stu-id="359c5-144">**MAPILogonEx** defines a few other flags that you can set:</span></span> 
  
- <span data-ttu-id="359c5-145">MAPI_FORCE_DOWNLOAD указывает, что следует загружать входящие сообщения до возврата **мапилогонекс** .</span><span class="sxs-lookup"><span data-stu-id="359c5-145">MAPI_FORCE_DOWNLOAD indicates that incoming messages should be downloaded before **MAPILogonEx** returns.</span></span> <span data-ttu-id="359c5-146">Если этот флажок не установлен, сообщения будут загружаться в фоновом режиме позже.</span><span class="sxs-lookup"><span data-stu-id="359c5-146">Not setting this flag causes messages to be downloaded in the background at a later time.</span></span> 
    
- <span data-ttu-id="359c5-147">MAPI_SERVICE_UI_ALWAYS запрашивает, чтобы каждая служба сообщений в диалоговом окне "профиль" отображала диалоговое окно настройки.</span><span class="sxs-lookup"><span data-stu-id="359c5-147">MAPI_SERVICE_UI_ALWAYS requests that every message service in the profile display a configuration dialog box.</span></span>
    
- <span data-ttu-id="359c5-148">MAPI_NT_SERVICE указывает, что клиент реализован как служба Windows.</span><span class="sxs-lookup"><span data-stu-id="359c5-148">MAPI_NT_SERVICE indicates that your client is implemented as a Windows service.</span></span> <span data-ttu-id="359c5-149">Этот флаг должен быть установлен, если ваш клиент является службой.</span><span class="sxs-lookup"><span data-stu-id="359c5-149">This flag must be set if your client is a service.</span></span>
    
<span data-ttu-id="359c5-150">При каждом успешном входе в систему **мапилогонекс** возвращает указатель на сеанс MAPI.</span><span class="sxs-lookup"><span data-stu-id="359c5-150">With every successful logon, **MAPILogonEx** returns a pointer to a MAPI session.</span></span> <span data-ttu-id="359c5-151">Этот указатель можно использовать для вызова методов интерфейса **IMAPISession** .</span><span class="sxs-lookup"><span data-stu-id="359c5-151">You can use this pointer to call the methods of the **IMAPISession** interface.</span></span> <span data-ttu-id="359c5-152">Дополнительные сведения см. в статье [IMAPISession: IUnknown](imapisessioniunknown.md).</span><span class="sxs-lookup"><span data-stu-id="359c5-152">For more information, see [IMAPISession : IUnknown](imapisessioniunknown.md).</span></span> <span data-ttu-id="359c5-153">Указатели сеансов, независимо от типа сеанса, являются уникальными для клиентов, которые их получают и недействительны для разных задач.</span><span class="sxs-lookup"><span data-stu-id="359c5-153">Session pointers, regardless of the type of session, are unique to the clients that receive them and are not valid across tasks.</span></span>
  

