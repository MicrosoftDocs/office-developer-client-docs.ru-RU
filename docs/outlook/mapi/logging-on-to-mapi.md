---
title: Вход в MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419711"
---
# <a name="logging-on-to-mapi"></a>Вход в MAPI
 
**Относится к**: Outlook 2013 | Outlook 2016 
  
Клиентские приложения выполняют вход в подсистему MAPI, вызывая функцию **мапилогонекс** . Дополнительные сведения см. в разделе [мапилогонекс](mapilogonex.md). **Мапилогонекс** проверяет выбор профиля и конфигурацию каждого поставщика услуг в профиле. После настройки MAPI запускает поставщиков адресных книг перед запуском поставщиков хранилища сообщений. Поставщики транспорта запускаются, когда их службы впервые требуются. 
  
## <a name="choose-a-profile"></a>Выбор профиля
  
- Передайте строку символов, представляющую имя профиля в параметре _лпсзпрофиленаме_ , в **мапилогонекс**или...
    
- Разрешить пользователю указывать профиль, передавая значение NULL в параметре _лпсзпрофиленаме_ и устанавливая флаг мапи_логон_уи или... 

- Выберите профиль по умолчанию, передав значение NULL в параметре _лпсзпрофиленаме_ и УСТАНОВИВ флаг мапи_усе_дефаулт. 
    
Если требуется определенный профиль, отличный от профиля по умолчанию, необходимо сохранить его имя в собственной базе данных конфигурации или использовать конкретное соглашение об именовании. MAPI не предоставляет атрибуты профиля, отличные от имени и флага по умолчанию в таблице профиля, а флаг профиля по умолчанию зарезервирован для клиента обмена сообщениями и связанных приложений IPM.
  
Клиенты, которые поставляет в **мапилогонекс** сведения о конфигурации с частичными профилями или поставщиками, должны запрашивать у пользователя дополнительные данные, разрешив отображение диалогового окна. Если информация отсутствует, и **мапилогонекс** не может предложить пользователю ввести его, произойдет сбой входа. Клиенты, которые не нуждаются в пользовательском вводе, могут подавить отображение диалогового окна. 
  
Флаги, которые **мапилогонекс** использует для включения пользовательского интерфейса, являются взаимоисключающими; можно задать только один из них. Если оставить эти флаги без изменений, отображение пользовательского интерфейса подавляется, что приводит к сбою **мапилогонекс** при отсутствии необходимой информации. То есть, если отключить пользовательский интерфейс и передать значение NULL для параметра _лпсзпрофиленаме_ и не устанавливать флаг Мапи_усе_дефаулт, **мапилогонекс** завершится с ошибками, так как не удается получить имя профиля. 
  
Сеанс, установленный **мапилогонекс** , может быть отдельным сеансом обмена сообщениями, сеансом обмена сообщениями или сеансом, не используемым для обмена сообщениями. Отдельные сеансы обмена сообщениями — это частные подключения между клиентом и подсистемой MAPI, которые можно установить путем установки флага МАПИ_НЕВ_СЕССИОН в вызове **мапилогонекс**.
  
Сеансы общего обмена сообщениями — это подключения, которые могут использовать несколько клиентов обмена сообщениями. Общие сеансы обычно устанавливаются для клиентов, использующих один и тот же профиль. Чтобы создать новый сеанс в качестве общего сеанса, установите флаг МАПИ_АЛЛОВ_ОСЕРС. 
  
## <a name="use-an-existing-shared-session"></a>Использование существующего общего сеанса
  
- Не задавайте флаг МАПИ_НЕВ_СЕССИОН.
    
- Не задавайте флаг МАПИ_АЛЛОВ_ОСЕРС.
    
- Передайте значение NULL для параметра _лпсзпрофиленаме_ . 
    
- Передайте значение NULL для параметра _лпсзпассворд_ . 
    
Сеансы без обмена сообщениями позволяют клиентам получать доступ к подсистеме MAPI, но не разрешать отправку и получение сообщений. Приложения конфигурации или администрирования — это примеры клиентов, которым может потребоваться установить сеансы, не являющиеся сеансами обмена сообщениями. Чтобы запросить сеанс, не являющийся сеансом обмена сообщениями, установите флаг МАПИ_НО_МАИЛ. При установке этого флага записывается в журнал клиент, который не сообщает диспетчер очереди MAPI. Клиенты, которые подключаются к MAPI с помощью этого флага, не могут ожидать получения отчетов о состоянии прочтения.
  
Флаг МАПИ_НО_МАИЛ должен быть установлен только:
  
- Если клиент не будет отправлять и получать сообщения во время сеанса.
    
- Если ваш клиент имеет полный контроль над содержимым профиля, а сообщения отправляются и принимаются с помощью тесно связанных хранилищ сообщений и поставщиков транспорта, таких как поставщики Microsoft Exchange.
    
Клиент обмена сообщениями может совместно использовать сеанс с клиентом без обмена сообщениями. Характеристики других членов не влияют на характеристики одного участника общего сеанса. То есть, если вы входите в систему с установленными флагами МАПИ_НО_МАИЛ и МАПИ_АЛЛОВ_ОСЕРС, то клиент обмена сообщениями, который входит в сеанс, не влияет на работу клиента и наоборот. Клиент обмена сообщениями по-прежнему сможет отправлять и получать сообщения, а клиент не будет.
  
**Мапилогонекс** определяет несколько других флагов, которые можно задать: 
  
- МАПИ_ФОРЦЕ_ДОВНЛОАД указывает, что следует загружать входящие сообщения перед возвратом **мапилогонекс** . Если этот флажок не установлен, сообщения будут загружаться в фоновом режиме позже. 
    
- МАПИ_СЕРВИЦЕ_УИ_АЛВАЙС запрашивает, чтобы каждая служба сообщений в диалоговом окне "профиль" отображала диалоговое окно настройки.
    
- МАПИ_НТ_СЕРВИЦЕ указывает, что клиент реализован как служба Windows. Этот флаг должен быть установлен, если ваш клиент является службой.
    
При каждом успешном входе в систему **мапилогонекс** возвращает указатель на сеанс MAPI. Этот указатель можно использовать для вызова методов интерфейса **IMAPISession** . Дополнительные сведения см. в статье [IMAPISession: IUnknown](imapisessioniunknown.md). Указатели сеансов, независимо от типа сеанса, являются уникальными для клиентов, которые их получают и недействительны для разных задач.
  

