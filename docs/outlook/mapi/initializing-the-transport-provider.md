---
title: Инициализация поставщика транспорта
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 977c18ce-ece5-4ad1-ac97-5a680846ab83
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 3b369e20101bbaba5e246b2ef9f6ab3ed1771ef6
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22563557"
---
# <a name="initializing-the-transport-provider"></a><span data-ttu-id="9c1b9-103">Инициализация поставщика транспорта</span><span class="sxs-lookup"><span data-stu-id="9c1b9-103">Initializing the Transport Provider</span></span>

  
  
<span data-ttu-id="9c1b9-104">**Применимо к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="9c1b9-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="9c1b9-105">Интерфейс диспетчера очереди транспорта определяет вызовах, выполненных диспетчер очереди MAPI для поставщика транспорта.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-105">The transport-spooler interface defines calls the MAPI spooler makes to a transport provider.</span></span> <span data-ttu-id="9c1b9-106">Эти процедуры внедряемые поставщиками транспорта в библиотеке динамической компоновки (DLL).</span><span class="sxs-lookup"><span data-stu-id="9c1b9-106">Transport providers implement these routines in a dynamic-link library (DLL).</span></span> <span data-ttu-id="9c1b9-107">Первой точкой ввод в DLL-ФАЙЛ, используемый диспетчером очереди MAPI должен быть функции инициализации поставщика транспорта [XPProviderInit](xpproviderinit.md).</span><span class="sxs-lookup"><span data-stu-id="9c1b9-107">The first direct entry point into the DLL used by the MAPI spooler must be the transport provider initialization function [XPProviderInit](xpproviderinit.md).</span></span>
  
<span data-ttu-id="9c1b9-108">MAPI использует процедуру **GetProcAddress** получить адрес программа инициализации поставщика услуг и затем вызывает подпрограмма.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-108">MAPI uses the routine **GetProcAddress** to get the address of the service provider's initialization routine and then calls that routine.</span></span> <span data-ttu-id="9c1b9-109">Имя процедуры инициализации — **XPProviderInit** поставщиками транспорта.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-109">The name of the initialization routine is **XPProviderInit** for transport providers.</span></span> <span data-ttu-id="9c1b9-110">Оно отличается для других типов поставщиков служб MAPI, чтобы одна библиотека DLL может содержать любое сочетание типов поставщика служб, но только одну службу поставщика определенного типа.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-110">It is different for other types of MAPI service providers so that one DLL can contain any combination of service provider types, but only one service provider of a particular type.</span></span> <span data-ttu-id="9c1b9-111">Тем не менее один поставщик службы данного типа можно реализовать несколько служб этого типа.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-111">However, one service provider of a given type can implement multiple services of its type.</span></span> <span data-ttu-id="9c1b9-112">Например, для одного поставщика транспорта можно реализовать средства транспорта сообщений для нескольких служб сообщения.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-112">For example, one transport provider can implement message transport functionality to multiple message services.</span></span> 
  
<span data-ttu-id="9c1b9-113">Файл заголовка mapispi.h имеет определение типа для прототипа функции функции инициализации поставщика транспорта и имя предварительно определенные процедуры для него.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-113">The mapispi.h header file has a type definition for the function prototype of the transport provider initialization function, and a predefined procedure name for it.</span></span> <span data-ttu-id="9c1b9-114">Назвав процедуры инициализации в файлах C и C++ с теми же именами, используемых **GetProcAddress** и с помощью простой экспортируйте объявление в библиотеке DLL. Файл DEF автоматически получить проверки параметров на Подпрограмма инициализации типа.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-114">By naming the initialization routines in your C and C++ files with the same names used by **GetProcAddress** and by using a straightforward export declaration in your DLL.DEF file, you automatically get type checking of the parameters on your initialization routine.</span></span> <span data-ttu-id="9c1b9-115">Просмотрите поставщика транспорта примеров исходного кода примеры.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-115">See the sample transport provider source code for examples.</span></span> <span data-ttu-id="9c1b9-116">Для получения дополнительных сведений см [Пример поставщика транспорта](transport-provider-sample.md).</span><span class="sxs-lookup"><span data-stu-id="9c1b9-116">For more information, see [Transport Provider Sample](transport-provider-sample.md).</span></span>
  
<span data-ttu-id="9c1b9-117">Если звонок инициализации поставщика услуг успешно, но возвращает номер версии интерфейса, поставщика услуг, слишком мало для MAPI для обработки, MAPI сразу же вызывает метод **выпуске** объекта поставщика службы и переходит как если бы инициализация звонок Возникла ошибка с MAPI_E_VERSION.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-117">If a service provider's initialization call succeeds but returns a service provider interface version number too small for MAPI to handle, MAPI immediately calls the **Release** method of the service provider object and proceeds as if the initialization call had failed with MAPI_E_VERSION.</span></span> <span data-ttu-id="9c1b9-118">Таким образом MAPI и поставщика услуг совместно определяют диапазон номеров версий интерфейс поставщика службы, они могут обрабатывать, и если ничего не соответствует, то загрузка поставщика услуг завершается MAPI_E_VERSION возвращают значение.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-118">This way MAPI and the service provider jointly define the range of service provider interface version numbers they can handle, and if nothing matches then service provider loading fails with a MAPI_E_VERSION return value.</span></span> 
  
<span data-ttu-id="9c1b9-119">Последний шаг для очереди MAPI в получении доступа к ресурсам поставщика службы — войдите в систему поставщика транспорта.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-119">The last step for the MAPI spooler in getting access to service provider resources is to log on to the transport provider.</span></span> <span data-ttu-id="9c1b9-120">Диспетчер очереди MAPI вызывает метод [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) [IXPProvider: IUnknown](ixpprovideriunknown.md) объект, возвращенный из **XPProviderInit**.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-120">The MAPI spooler calls the [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) method of the [IXPProvider : IUnknown](ixpprovideriunknown.md) object returned from **XPProviderInit**.</span></span> <span data-ttu-id="9c1b9-121">Это вызов, где учетные данные, при использовании проверяется, и можно разрешить диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-121">This is the call where credentials, if used, are checked and dialog boxes can be allowed.</span></span>
  
<span data-ttu-id="9c1b9-122">Если процесс открывается второй сеанс транспорта на того же поставщика транспорта и сеанса MAPI, поставщика транспорта DLL не следует создавать второй объект поставщика.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-122">If a process opens a second transport session on the same transport provider and MAPI session, the transport provider DLL should not create a second provider object.</span></span> <span data-ttu-id="9c1b9-123">Первый объект поставщика должен использоваться для входа на второй сеанс транспорта.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-123">The first provider object should be used to log on to the second transport session.</span></span> <span data-ttu-id="9c1b9-124">Для поддержки нескольких сеансов транспорта в объект одного поставщика необходимо запрограммировать поставщика транспорта.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-124">A transport provider should be programmed to support multiple transport sessions in a single provider object.</span></span> <span data-ttu-id="9c1b9-125">Второй объект поставщика должны быть созданы только в том случае, если в тот же самый процесс используются разные сеансов MAPI.</span><span class="sxs-lookup"><span data-stu-id="9c1b9-125">A second provider object should only be created if different MAPI sessions are used in the same process.</span></span>
  

