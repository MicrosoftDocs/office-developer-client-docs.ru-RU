---
title: Реализация Thread-Safe объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3c911694-b953-4d35-9a3a-22c17cfd79bc
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 9160136542c7960bad0be2423872171b17d99fe3
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33413530"
---
# <a name="implementing-thread-safe-objects"></a>Реализация Thread-Safe объектов

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
При непосредственном вызове объектов, возвращаемых из метода интерфейса, поставщик несет ответственность за обеспечение безопасности потоков. При вызове объектов это ответственность клиентского приложения.
  
Клиент может реализовать вызов, безопасный для потоковых уведомлений, позвонив в утилиту [MAPI HrThisThreadAdviseSink.](hrthisthreadadvisesink.md) **HrThisThreadAdviseSink** преобразует непотобезопасную советую погрузиться в безопасный поток. Для отзовов хода выполнения такой утилиты не существует. Клиент может выбрать, использовать объект mapI, безопасный для потоков, или создать его вручную. 
  
Объект, безопасный для потоков, может быть или не знать поток. Объект с учетом потоков поддерживает отдельный контекст для каждого используемого потока. Поставщики услуг не обязаны поддерживать осведомленность о потоке в своих объектах, безопасных для потоков, хотя поддержка осведомленности о потоках может быть полезной в некоторых ситуациях. Две таблицы MAPI всегда предоставляют собственный контекст по определению. Одна таблица, используемая в разных потоках, не предоставляет и не должна предоставлять уникальный контекст.
  
Клиент может выбрать между получением уведомлений на том же потоке, который использовался для вызова **MAPIInitialize,** на том же потоке, который использовался для вызова "Совет", или на отдельном потоке, который принадлежит MAPI.  Чтобы убедиться, что уведомления поступают по тому же потоку, который использовался для вызова **MAPIInitialize,** клиент вызывает [MAPIInitialize](mapiinitialize.md) и пропускает ноль в члене **ulFlags** структуры MAPIINIT_0. [](mapiinit_0.md) Затем уведомления доставляются во время основного цикла сообщений. 
  
Чтобы получать уведомления в потоке MAPI, клиент вызывает **MAPIInitialize** с членом **ulFlags** структуры MAPIINIT_0, задаемой MAPI_MULTITHREAD_NOTIFICATIONS.  Вызов **"Советовать"** выполнен с объектом помойки клиента, а не с завернутой версией. 
  
Чтобы убедиться, что уведомления поступают на том же потоке, который использовался для вызова **Advise,** клиент вызывает [HrThisThisThreadAdviseSink](hrthisthreadadvisesink.md) и передает недавно созданный завернутый совет раковина советую советовать, а не оригинальный раковина советовать.  **MAPIInitialize** можно назвать со значением флага. 
  

