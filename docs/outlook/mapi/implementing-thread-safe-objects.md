---
title: Реализация потокобезопасных объектов
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3c911694-b953-4d35-9a3a-22c17cfd79bc
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 9160136542c7960bad0be2423872171b17d99fe3
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33413530"
---
# <a name="implementing-thread-safe-objects"></a>Реализация потокобезопасных объектов

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
С объектами, возвращаемыми непосредственно из вызовов метода интерфейса, это ответственность поставщика на обеспечение безопасности потоков. С объектами обратного вызова это ответственность за клиентское приложение.
  
Клиент может реализовать безопасный обратный вызов уведомлений, вызвав служебную программу MAPI [хрсиссреададвисесинк](hrthisthreadadvisesink.md). **Хрсиссреададвисесинк** преобразует приемник уведомлений без посторонних потоков в потокобезопасный один. Для обратных вызовов выполнения такая служебная программа отсутствует. Клиент может выбрать, использовать ли потоковый объект степени безопасности MAPI, или создать его вручную. 
  
Потокобезопасный объект также может поддерживать поток. Объект, поддерживающий цепочку, поддерживает отдельный контекст для каждого потока, который использует его. Поставщики услуг не обязаны поддерживать поддержку потоков в потокобезопасных объектах, хотя поддержка обработки потоков может быть полезна в некоторых ситуациях. Две таблицы MAPI всегда предоставляют собственный контекст по определению. Одна таблица, используемая в разных потоках, не должна обеспечивать уникальный контекст.
  
Клиент может выбрать между получением уведомлений в том же потоке, который использовался для вызова **мапиинитиализе** , в том же потоке, который использовался для вызова **advise** , или в отдельном потоке, принадлежащем MAPI. Чтобы гарантировать, что уведомления приходятся на тот же поток, который использовался для вызова **мапиинитиализе**, клиент вызывает [мапиинитиализе](mapiinitialize.md) и передает ноль в элементе **ulFlags** структуры [MAPIINIT_0](mapiinit_0.md) . Затем уведомления доставляются в рамках основного цикла сообщений. 
  
Чтобы получать уведомления о потоке, принадлежащем MAPI, клиент вызывает **мапиинитиализе** с элементом **ulFlags** структуры **MAPIINIT_0** , равным MAPI_MULTITHREAD_NOTIFICATIONS. Вызов **advise** осуществляется с использованием объекта приемника уведомлений клиента, а не упакованной версии. 
  
Чтобы убедиться, что уведомления приходят в том же потоке, который использовался для вызова **advise**, клиент вызывает [хрсиссреададвисесинк](hrthisthreadadvisesink.md) и передает новый созданный приемник оповещений **, а не** исходный приемник уведомлений. **Мапиинитиализе** можно вызывать с любым значением флага. 
  

