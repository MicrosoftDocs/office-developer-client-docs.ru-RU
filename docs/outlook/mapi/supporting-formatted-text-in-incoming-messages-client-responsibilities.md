---
title: Поддержка форматированного текста во входящих сообщениях обязанности клиента
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 79727700-5ef1-4a29-9ed0-fd46c7de3202
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 7f3cf5b245bdcd2c2707f0e2028d52a15c7e0f6b
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33434503"
---
# <a name="supporting-formatted-text-in-incoming-messages-client-responsibilities"></a>Поддержка форматированного текста во входящих сообщениях: обязанности клиентов

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Когда сообщения передаются между системами обмена сообщениями, диспетчер очереди MAPI гарантирует, что форматирование форматированного текста будет синхронизировано с текстом сообщения. Диспетчер очереди MAPI вызывает функцию [ртфсинк](rtfsync.md) из упакованной версии сообщения, которая передается поставщику транспорта. Поставщик транспорта сохраняет изменения, внесенные в сообщение, вызывая метод [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) и направляет его новому получателю. 
  
Когда клиентское приложение, поддерживающее формат RTF, открывает сообщение для отображения текста, оно должно синхронизировать текст с форматированием и открыть либо **пр_ртф_компрессед** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)), либо **пр_боди** ([PidTagBody](pidtagbody-canonical-property.md)). в зависимости от того, какое свойство доступно.
  
 **Открытие сообщения и клиентов, поддерживающих RTF**
  
1. Вызов **ртфсинк** для синхронизации текста сообщения с форматированием, если хранилище сообщений не имеет формата RTF. Если свойство **пр_ртф_ин_синк** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) отсутствует или имеет значение false, необходимо передать флаг Ртф_синк_боди_чанжед в параметре _ulFlags_ . Для клиентов, работающих с хранилищами сообщений в формате RTF, не требуется выполнять вызов **ртфсинк** , так как он занимается хранилищем сообщений. 
    
2. Call [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) , если текст сообщения был обновлен. 
    
3. Call [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) , чтобы открыть свойство **пр_ртф_компрессед** . Если **пр_ртф_компрессед** недоступен, для отображения содержимого сообщения следует открыть свойство **пр_боди** . 
    
4. ВыЗовите функцию [врапкомпресседртфстреам](wrapcompressedrtfstream.md) , чтобы создать несжатую версию сжатых данных RTF, если они доступны. 
    
5. Отображение несжатых данных в формате RTF или данных в формате обычного текста для пользователя.
    
 **Ртфсинк** возвращает логическое значение, указывающее, было ли обновление сообщения. Если это значение возвращает значение TRUE, метод **SaveChanges** вызывается в некоторый момент, чтобы сделать обновление постоянным. Вызов необязательно должен быть выполнен сразу после возврата **ртфсинк** . 
  
> [!NOTE]
> Так как многие компоненты обрабатывают форматированный текст перед его получением, существует вероятность повреждения. Это может происходить из поставщика хранилища сообщений, стороннего приложения, шлюза или ошибки передачи. 
  

