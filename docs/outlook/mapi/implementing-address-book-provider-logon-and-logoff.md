---
title: Реализация входа и выхода для поставщика адресных книг
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: c4a1fb5d-ae23-445b-a6f0-ef430b03fc9a
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 8d33bccdd01075d692e5a887082ba51ee23bb083
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438738"
---
# <a name="implementing-address-book-provider-logon-and-logoff"></a>Реализация входа и выхода для поставщика адресных книг

**Относится к**: Outlook 2013 | Outlook 2016 
  
Поставщики адресных книг поддерживают вход в сеанс и выход из нее путем реализации методов интерфейса [иабпровидер: IUnknown](iabprovideriunknown.md) . Интерфейс * * Иабпровидер * * наследуется напрямую от **IUnknown** и добавляет только два других метода: **Вход** и **Завершение**. 
  
## <a name="logoff"></a>Logoff

MAPI вызывает метод [иабпровидер:: logon](iabprovider-logon.md) поставщика в начале каждого сеанса и каждый раз, когда поставщик добавляется в текущий профиль, и клиент поддерживает динамическую перенастройку. Когда MAPI вызывает метод **иабпровидер:: logon** , поставщик адресных книг начинает процесс входа в систему. 
  
**Реализация Иабпровидер:: log**
  
1. Инициализируйте все указатели выходных параметров, переданные с помощью MAPI. 
    
2. Вызовите метод **IUnknown:: AddRef** объекта support, чтобы увеличить счетчик ссылок. 
    
3. Вызовите метод [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md) объекта support, чтобы открыть раздел профиля, содержащий сведения о конфигурации поставщика. Передайте значение NULL для параметра _лпуид_ и флага MAPI_MODIFY, если вы собираетесь вносить изменения. 
    
4. Вызовите метод [IMAPIProp::/PROPS](imapiprop-getprops.md) раздела profile, чтобы получить свойства, необходимые поставщику для входа в систему, например имя файла данных или таблицы базы данных. 
    
5. Убедитесь, что свойства доступны и действительны. Если необходимо, отобразите диалоговое окно, предлагающее пользователю внести исправления или добавления в недопустимые или отсутствующие сведения, и вызвать метод [IMAPIProp:: SetProps](imapiprop-setprops.md) для сохранения изменений. Ниже приведены некоторые из стандартных свойств, которые должны быть доступны. 
    
   **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))
    
   **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md))
    
   **PR_PROVIDER_DISPLAY** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))
    
   **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md))
    
   > [!NOTE]
   > Не задавайте **PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) или **PR_PROVIDER_DLL_NAME** ([PidTagProviderDllName](pidtagproviderdllname-canonical-property.md)). Во время входа эти свойства доступны только для чтения. 
  
6. Если одно или несколько свойств конфигурации недоступны, произошел отказ и возвратите значение MAPI_E_UNCONFIGURED.
    
7. Call [имаписуппорт:: сетпровидеруид](imapisupport-setprovideruid.md) для регистрации [мапиуид](mapiuid.md). Поставщик может создать **мапиуид** , выполнив следующие действия: 
    
   - Вызов метода [имаписуппорт:: невуид](imapisupport-newuid.md) . 
    
   - Вызов УУИДЖЕН. EXE, чтобы определить GUID, который использует поставщик для включения в один из файлов заголовков.
    
8. При необходимости сохраните недавно созданный **мапиуид** в текущем профиле, вызвав метод * * IMAPIProp:: SetProps * *. 
    
9. Отпустите раздел профиля, вызвав его метод **IUnknown:: Release** . 
    
10. Создайте экземпляр нового объекта logon и задайте для параметра _лппаблогон_ значение Address этого нового объекта. 
    
Так как MAPI может вызывать метод * * logon * * несколько раз во время сеанса, рекомендуется обеспечить возможность создания нескольких объектов входа и отслеживания каждого созданного объекта в вашей реализации. Поддержка нескольких вызовов **входа** позволяет пользователю клиентского приложения, например, выполнить вход в сеанс с другими удостоверениями или использовать другие назначения доставки. 
  
**Завершение работы** вызывается при завершении сеанса. MAPI вызывает метод [иабпровидер:: Shutdown](iabprovider-shutdown.md) в качестве одной из последних задач, связанных с завершением сеанса. MAPI освободил все объекты входа поставщика и, когда поставщик получает этот вызов, он может предположить, что этот вызов будет получен последним. В реализации **иабпровидер:: Shutdown**, выполните последнюю очистку, которая вам нужна. Например, поставщик может вызвать **мапидеинитидле** , если он вызывал **мапиинитидле** , чтобы использовать антивирусное ядро во время сеанса или метод **IUnknown:: Release** всех объектов, которые еще не были выпущены. 
  
Если у поставщика нет завершающей очистки, его реализация может состоять из одной строки кода: 
  
```cpp
return S_OK;

```


