---
title: Создание текста сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 70d1fb24-91a9-4043-8c9d-be1523012e6b
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 5b4a4107d6326a61f50a4023ebc2538f699224b5
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32335723"
---
# <a name="creating-message-text"></a>Создание текста сообщения

**Область применения**: Outlook 2013 | Outlook 2016 
  
Несмотря на то, что некоторые сообщения состоят только из списка получателей и строки темы, содержимое большинства сообщений, в частности, IPM. Обратите внимание, что в сообщениях есть текст. Текст сообщения может быть простым или форматированным и храниться в трех свойствах: **\_Body** ([PidTagBody](pidtagbody-canonical-property.md)) **,\_HTML** ([PidTagHtml](pidtaghtml-canonical-property.md)) и **пр_ртф_компрессед** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)). 

Если ваш клиент является обычным текстовым, задайте **текст\_** для поля Цена. Если вы поддерживаете форматирование текста в формате RTF, задайте либо **пр_ртф_компрессед** , либо только текст **пр_ртф_компрессед** и **PR\_**, в зависимости от используемого поставщика хранилища сообщений. Когда клиент, поддерживающий RTF, использует хранилище сообщений с поддержкой RTF, он устанавливает только **пр_ртф_компрессед** . Когда клиент с поддержкой RTF использует хранилище сообщений, не поддерживающий RTF, он задает оба свойства. Если ваш клиент поддерживает HTML, задайте свойство **пр_хтмл** . 
  
## <a name="determine-whether-your-message-store-supports-rich-text-format"></a>Определение того, поддерживает ли хранилище сообщений форматированный текст
  
1. ВыЗовите метод [IMAPIProp::](imapiprop-getprops.md) -PROPS хранилища сообщений для получения свойства **пр_сторе_суппорт_маск** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)).
    
2. Проверьте наличие бита СТОРЕ_РТФ_ОК. Если задано значение СТОРЕ_РТФ_ОК, поставщик хранилища сообщений поддерживает текст RTF. Если оно не задано, то поставщик хранилища сообщений поддерживает только обычный текст.
    
## <a name="determine-whether-your-message-store-supports-html"></a>Определение того, поддерживает ли ваше хранилище сообщений HTML
  
1. ВыЗовите метод [IMAPIProp::](imapiprop-getprops.md) /PROPS хранилища сообщений, чтобы получить свойство **пр_сторе_суппорт_маск** . 
    
2. Проверьте наличие бита СТОРЕ_ХТМЛ_ОК. Если задано значение СТОРЕ_ХТМЛ_ОК, поставщик хранилища сообщений поддерживает HTML-текст. 
    
## <a name="set-prrtfcompressed"></a>Настройка ртф_компрессед\_для PR
  
1. ВыЗовите метод [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) , чтобы открыть свойство **Пр_ртф_компрессед** , указав иид_истреам в качестве идентификатора интерфейса и установив флаг мапи_креате. 
    
2. ВыЗовите функцию [врапкомпресседртфстреам](wrapcompressedrtfstream.md) , ПЕРЕДАВ флаг сторе_ункомпрессед_ртф, если установлен бит сторе_ункомпрессед_ртф в свойстве **пр_сторе_суппорт_маск** хранилища сообщений. 
    
3. Освободите исходный поток, вызвав его метод * * IUnknown:: Release * *. 
    
4. Call — * * IStream:: Write * * или **IStream:: CopyTo** для записи текста сообщения в поток, возвращенный из **врапкомпресседртфстреам**.
    
5. ВыЗовите методы **commit** и **Release** в потоке, возвращенном из метода **опенпроперти** . 
    
На этом шаге, если поставщик хранилища сообщений поддерживает RTF, вы выполнили все необходимые действия. Вы можете зависеть от поставщика хранилища сообщений, чтобы обрабатывать синхронизацию содержимого и форматирования сообщения и при необходимости создавать **свойство\_текста PR** . Хранилища сообщений с поддержкой RTF [ртфсинк](rtfsync.md) вызовов для обработки синхронизации. Если для флага RTF\_синк_боди_чанжед ЗАДАНО значение true, то поставщик повторно вычисляет свойство **пр_боди** . 
  
Если поставщик хранилища сообщений не поддерживает формат RTF, необходимо также добавить содержимое сообщений, не включенное в формат RTF, с помощью свойства **пр_боди** . 
  
## <a name="set-prhtml"></a>Set ПР_ХТМЛ
  
1. ВыЗовите метод [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) , чтобы открыть свойство **пр_хтмл** с помощью интерфейса **IStream** . 
    
2. Call **IStream:: Write** для записи текстовых данных сообщения в поток, возвращенный из **опенпроперти**. 
    
3. Вызов **IStream:: Commit** and **IUnknown:: Release** в потоке для фиксации изменений и освобождения памяти. 
    
## <a name="set-prbody"></a>Set ПР_БОДИ
  
1. ВыЗовите метод [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) , чтобы открыть свойство **пр_боди** с помощью интерфейса **IStream** . 
    
2. Call **IStream:: Write** для записи текстовых данных сообщения в поток, возвращенный из **опенпроперти**. 
    
3. ВыЗовите функцию [ртфсинк](rtfsync.md) для синхронизации текста с форматированием. Так как это новое сообщение, установите флаги РТФ_СИНК_РТФ_ЧАНЖЕД и РТФ_СИНК_БОДИ_ЧАНЖЕД, чтобы указать, что текст сообщения был изменен как в формате RTF, так и в виде обычного текста. **Ртфсинк** задаст несколько связанных свойств, необходимых поставщику хранилища сообщений, например **пр_ртф_ин_синк** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)), и запишите их в сообщение.
    
4. Вызов **IStream:: Commit** and **IUnknown:: Release** в потоке для фиксации изменений и освобождения памяти. 
    

