---
title: Структуры потоков полей папок
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: edbc9e6c-008c-4c13-9a0c-cb47ac0f3686
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d6724914896fe7c40e9a456785aa5c92b84532fe
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19808458"
---
# <a name="folder-fields-stream-structures"></a>Структуры потоков полей папок

**Относится к**: Outlook 
  
Свойство [PidTagUserFields](pidtaguserfields-canonical-property.md) сообщение содержит двоичный поток FolderUserFields, который содержит определения полей, пользовательские папки. В этом разделе описываются структуры потока для определения пользовательских полей папки. 

Структура потока FolderUserFields состоит из структуры FolderUserFieldsA или FolderUserFieldsA структуры, а затем FolderUserFieldsW структуры.
  
Элементы данных в этот поток, хранятся сразу после друг с другом в следующем порядке:
  
- **FolderUserFieldsAnsi**: FolderUserFieldsA в потоковом режиме структуры.
    
- **FolderUserFieldsUnicode** (необязательно): FolderUserFieldsW в потоковом режиме структуры.
    
Общая длина FolderUserFields, которые больше, чем длина FolderUserFieldsAnsi обнаруживает присутствие FolderUserFieldsUnicode.
  
> [!IMPORTANT]
> FolderUserFieldsAnsi используется для обеспечения совместимости с старые, Юникод, версий клиентов MAPI, поэтому при наличии FolderUserFieldsUnicode, содержимое FolderUserFieldsAnsi игнорируется. Чтобы избежать возможных данных потери в преобразование ANSI, при создании потока FolderUserFields всегда включать часть FolderUserFieldsW. 
  
## <a name="folderuserfieldsa-stream-structure"></a>Структура FolderUserFieldsA потока

Структура потока FolderUserFieldsA — массива структур FolderFieldDefinitionA потока, которые содержат определения для всех пользовательских полей в папке Outlook, если оно не переопределено FolderUserFieldsW частью структуры FolderUserFields.
  
Элементы данных в этот поток, хранятся в прямом байтовом, сразу после друг с другом в следующем порядке:
  
- **FieldDefinitionCount**: DWORD (4 байта), количество определения полей в этот поток. Это число элементов в массиве **FieldDefinitions** .
    
- **FieldDefinitions**: массив FolderFieldDefinitionA в потоковом режиме структуры. Число этого массива равно **FieldDefinitionCount** элемента данных.
    
Если этот FolderUserFieldsA переопределяется FolderUserFieldsW частью структуры FolderUserFields, массива **FieldDefinitions** должен быть «символом null», если его последнего элемента FolderFieldDefinitionA Common.FieldType поля равно Чтобы ftNull.
  
## <a name="folderuserfieldsw-stream-structure"></a>Структура FolderUserFieldsW потока

Структура потока FolderUserFieldsW — массива структур FolderFieldDefinitionW потока, которые содержат определения для всех пользовательских полей в папке Outlook.
  
Элементы данных в этот поток, хранятся в прямом байтовом, сразу после друг с другом в следующем порядке:
  
- **FieldDefinitionCount**: DWORD (4 байта), количество определения полей в этот поток. Это число элементов в массиве **FieldDefinitions** .
    
- **FieldDefinitions**: массив FolderFieldDefinitionW в потоковом режиме структуры. Число этого массива равно **FieldDefinitionCount** элемента данных.
    
Массив **FieldDefinitions** должен быть «символом null», если его последнего элемента FolderFieldDefinitionW Common.FieldType поля равно ftNull.
  
## <a name="folderfielddefinitiona-stream-structure"></a>Структура FolderFieldDefinitionA потока

Структура потока FolderFieldDefinitionA содержит определение того, пользовательские поля с имя поля, хранящиеся в формате ANSI.
  
Элементы данных в этот поток, хранятся в прямом байтовом, сразу после друг с другом в следующем порядке:
  
- **FieldType**: FldType (4 байта), тип данного поля.
    
- **FieldNameLength**: WORD (2 байта), число элементов в массиве **FieldName** .
    
- **FieldName**: массив символов. Это представление кодовая страница ANSI CP_ACP имя поля. Число этого массива равно **FieldNameLength**. Имя поля должны соответствовать ограничения на параметр Name, как указано в метод [UserProperties.Add](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.outlook.userproperties.add.aspx) . 
    
   > [!NOTE]
   > Для обеспечения совместимости прежних версий Outlook может быть обрабатывать некоторые **FieldName** значения не удовлетворить эти ограничения, однако таких случаях не распространяются в этом разделе. 
  
- **Общие**: FolderFieldDefinitionCommon в потоковом режиме структуры.
    
## <a name="folderfielddefinitionw-stream-structure"></a>Структура FolderFieldDefinitionW потока

Структура потока FolderFieldDefinitionW содержит определение того, пользовательские поля с именем сохранен в формате Юникод.
  
Элементы данных в этот поток, хранятся в прямом байтовом, сразу после друг с другом в следующем порядке:
  
- **FieldType**: FldType (4 байта), тип данного поля.
    
- **FieldNameLength**: WORD (2 байта), число элементов в массиве **FieldName** .
    
- **FieldName**: массив WCHAR. Это представление Юникод (UTF-16) имя поля. Число этого массива равно **FieldNameLength**. Имя поля должны соответствовать ограничения на параметр Name, как указано в метод [UserProperties.Add](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.outlook.userproperties.add.aspx) . 
    
   > [!NOTE]
   > Для обеспечения совместимости прежних версий Outlook может быть обрабатывать некоторые **FieldName** значения не удовлетворить эти ограничения, но таких случаях не распространяются в этом разделе. 
  
- **Общие**: FolderFieldDefinitionCommon в потоковом режиме структуры.
    
## <a name="fldtype-enumeration"></a>Перечисление FldType

В следующей таблице перечислены значения перечисления **FldType** . 
  
|Имя|Значение|Описание|
|:-----|:-----|:-----|
|ftNull  <br/> |0x0  <br/> |Этот тип поля используется для завершите массив определения полей.  <br/> |
|ftString  <br/> |0x1  <br/> |Текст  <br/> |
|ftInteger  <br/> |0x3  <br/> |Целое число  <br/> |
|ftTime  <br/> |0x5  <br/> |Дата, время  <br/> |
|ftBoolean  <br/> |0x6  <br/> |Да/Нет  <br/> |
|ftDuration  <br/> |0x7  <br/> |Продолжительность  <br/> |
|ftMultiString  <br/> |0xb  <br/> |Keywords  <br/> |
|ftFloat  <br/> |0xC  <br/> |Число или процент  <br/> |
|ftCurrency  <br/> |0xE  <br/> |Денежный  <br/> |
|ftCalc  <br/> |0x12  <br/> |Формула  <br/> |
|ftSwitch  <br/> |0x13  <br/> |Сочетание типа отображение только первое поле пустым - пропуская последующие.  <br/> |
|ftConcat  <br/> |0x17  <br/> |Сочетание типа объединять поля и любые фрагменты текста друг с другом.  <br/> |
   
## <a name="folderfielddefinitioncommon-stream-structure"></a>Структура FolderFieldDefinitionCommon потока

Структура потока FolderFieldDefinitionCommon содержит данные определения пользовательских полей, общий для FolderFieldDefinitionA и FolderFieldDefinitionW.
  
Элементы данных в этот поток, хранятся в прямом байтовом, сразу после друг с другом в следующем порядке:
  
- **PropSetGuid**: идентификатор GUID (16 байт), идентификатор GUID папки поля соответствующего имени свойства MAPI набора свойств. В этом поле значение должно быть равно PS_PUBLIC_STRINGS, если тип поля не **ftNone** , в противном случае это поле значение должно быть равно GUID_NULL. 
    
   > [!NOTE]
   > Для обеспечения совместимости прежних версий Outlook может быть обрабатывать некоторые **PropSetGuid** значения не удовлетворить это ограничение, однако таких случаях не распространяются в этом разделе. 
  
- **fcapm**: DWORD (4 байта), комбинация флагов ноль или больше, значения которого и значения перечислены в следующей таблице. Флаги с тем же значением имеют значения зависят от типа поля, то есть, FldType значение.
    
    |Имя флага|Значение  |Описание|
    |:-----|:-----|:-----|
    |FCAPM_CAN_EDIT  <br/> |0x00000001  <br/> |Поля можно редактировать.  <br/> |
    |FCAPM_CAN_SORT  <br/> |0x00000002  <br/> |Поле подлежит сортировке.  <br/> |
    |FCAPM_CAN_GROUP  <br/> |0x00000004  <br/> |Поле группируемое.  <br/> |
    |FCAPM_MULTILINE_TEXT  <br/> |0x00000100  <br/> |Поле может содержать несколько строк текста.  <br/> |
    |FCAPM_PERCENT  <br/> |0x01000000  <br/> |В этом поле ftFloat тип — это процентное поле.  <br/> |
    |FCAPM_DATEONLY  <br/> |0x01000000  <br/> |В этом поле ftTime типа является поля только для даты времени.  <br/> |
    |FCAPM_UNITLESS  <br/> |0x01000000  <br/> |Для этого поля ftInteger тип единица не разрешена в формат отображения; для примера таких форматов как «Computer - 640 K...» не допускается.  <br/> |
    |FCAPM_CAN_EDIT_IN_ITEM  <br/> |0x80000000  <br/> |Это поле может быть изменено в элементе: это специально для настраиваемых форм.  <br/> |
   
- **dwString**: DWORD (4 байта). В разделе первого следующее примечание.
    
- **dwBitmap**: DWORD (4 байта). В разделе первого следующее примечание.
    
- **dwDisplay**: DWORD (4 байта). В разделе первого следующее примечание.
    
- **iFmt**: INT (4 байта). Для типов полей, которые имеют «формате:» поле со списком в «Новое поле», «Изменить поле» и «Свойства поля» диалоговых окон, нуля индекс формата, выбранного в этом поле со списком. Для полей типа без, поле со списком это должно быть 0. В поле значение вместе с типом поля однозначно определить значения **dwString**, **dwBitmap**и **dwDisplay** полей см первого.
    
- **wszFormulaLength**: WORD (2 байта), число элементов в массиве **wszFormulaLength** .
    
- **wszFormulaLength**: массив WCHAR. Это представление поля формул строки в его стандартный формат Юникод (UTF-16). В разделе второй следующее примечание описание стандартных и пользовательский Интерфейс форматы формулу поля. Число этого массива равно **wszFormulaLength**. Формулы строка должна быть пустой строке, если тип поля не **ftCalc**, **ftSwitch** и **ftConcat**.
    
> [!NOTE]
> Несмотря на то, что значения **dwString**, **dwBitmap**и **dwDisplay** однозначно определяются на основе значения **FldType** и **iFmt** значения, которые являются избыточными, правильных значений по-прежнему необходимы для правильного Обработка определения поля с Outlook. Нет нет простое описание алгоритм, который выполняет это определение. 
> 
> Таким образом чтобы узнать, какие **dwString**, **dwBitmap**и **dwDisplay** значения соответствуют заданным **FldType** значение и значение **iFmt** , можно выполните проверку, создав пользовательские поля этого типа и с этим форматом выбранные в поле со списком **Формат** при условии его применимость изучите итоговый **FolderUserFields** потока, который создает Outlook для этого поля, выбранные пользователем. 
  
В текстовом поле **Формула** **Новое поле**, **Изменить поле**и диалоговых окнах **Свойств поля** для пользовательского поля изменяется формулу поля в формате пользовательского интерфейса. Алгоритм для преобразования формулы в формате пользовательского интерфейса в стандартный формат зависит от типа поля, как описано в следующих: 
- Для полей типа **ftCalc** и **ftSwitch**стандартный формат для встроенных полей, не являющихся соответствующих свойств MAPI с именем свойства типа MNID\_СТРОКУ, полученный путем замены фрагментов имя поля, то есть `[<field_name>]` с помощью фрагментов `[_<field_dispid_decimal>]`. 

  Например, если имеет формат пользовательского интерфейса формулу в поле введите **формулу**, которая является **ftCalc**, с помощью языка пользовательского интерфейса Office, английский (США), `[Business Phone] & [My custom field]`, где `My custom field` — это имя поля, выбранные пользователем, стандартный формат такой формулы будет `[_14856] & [My custom field]`.

- Для полей типа **ftConcat**стандартный формат полученные в результате следующих:

  1. Усекать начальные и конечные пробелы. 
  2. Синтаксический анализ формулу в последовательность фрагментов два следующих типа: 
     - Имя поля в квадратных скобках, то есть, `[<field_name>]`. 
     - Подстроки, не содержащий квадратные скобки.   
      Убедитесь, что указаны не двух фрагментов второго типа рядом в последовательности. Если формула невозможно выполнить синтаксический анализ таким образом, считается недействительной. 
  3. Выполнение одной замены для фрагментов первый из них как для поля **ftCalc** и **ftSwitch** . 
  4. Для каждого фрагмента второго типа escape-все двойные кавычки ("" ") символы, если они существуют, с двумя последовательными знаками кавычек и заключите его в двойные кавычки. 
  5. Вставить строку амперсанд (`&`) между каждой парой смежных фрагментов.
 
  Например, с помощью язык пользовательского интерфейса Office, английский (США), если имеет формат пользовательского интерфейса формулу в поле Тип **ftConcat** `text1 [Business Phone] "text2" [My custom field]`, где `My custom field` — это имя пользовательского поля, стандартный формат для такой формулы будет `""text1" & [_14856] & """text2""" & [My custom field]"`. 
  
## <a name="see-also"></a>См. также

- [Пример потока FolderUserFields](folderuserfields-stream-sample.md)
- [Добавление определения для нового пользовательского поля](how-to-add-a-definition-for-a-new-user-defined-field.md)

