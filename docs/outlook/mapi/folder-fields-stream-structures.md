---
title: Структуры потока полей папок
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: edbc9e6c-008c-4c13-9a0c-cb47ac0f3686
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 96051bd2b62fd7c0e908a1018aac0225e44986be
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32336892"
---
# <a name="folder-fields-stream-structures"></a>Структуры потока полей папок

**Относится к**: Outlook 2013 | Outlook 2016 
  
Свойство [PidTagUserFields](pidtaguserfields-canonical-property.md) сообщения содержит двоичный поток FolderUserFields, который содержит определения пользовательских полей папки. В этом разделе описываются структуры потоков для определений пользовательских полей папок. 

Структура потока FolderUserFields состоит из структуры FolderUserFieldsA или FolderUserFieldsA, за которой следует структура FolderUserFieldsW.
  
Элементы данных в этом потоке хранятся сразу после друг друга в следующем указанном порядке:
  
- **FolderUserFieldsAnsi**: структура потока FolderUserFieldsA.
    
- **FolderUserFieldsUnicode** (необязательно): структура потока FolderUserFieldsW.
    
Наличие FolderUserFieldsUnicode определяется общей длиной FolderUserFields, которая превышает длину FolderUserFieldsAnsi.
  
> [!IMPORTANT]
> FolderUserFieldsAnsi используется для обеспечения совместимости с более старыми версиями MAPI-клиентов, не относясь к Юникоду, поэтому если folderUserFieldsUnicode присутствует, содержимое FolderUserFieldsAnsi игнорируется. Чтобы избежать возможной потери данных при преобразовании ANSI, при создании потока FolderUserFields всегда включается часть FolderUserFieldsW. 
  
## <a name="folderuserfieldsa-stream-structure"></a>Структура потока FolderUserFieldsA

Структура потока FolderUserFieldsA — это массив структур потока FolderFieldDefinitionA, который содержит определения для всех пользовательских полей в папке Outlook, если только она не переопределена частью FolderUserFieldsW структуры FolderUserFields.
  
Элементы данных в этом потоке хранятся в порядок с небольшими конечными битами, сразу же после друг друга в указанном порядке:
  
- **FieldDefinitionCount**: DWORD (4 bytes), количество определений полей в этом потоке. Это количество элементов в **массиве FieldDefinitions.**
    
- **FieldDefinitions**: массив структур потока FolderFieldDefinitionA. Количество массивов равно элементу **данных FieldDefinitionCount.**
    
Если эта папка FolderUserFieldsA не переопределена частью FolderUserFieldsW структуры FolderUserFields, массив **FieldDefinitions** должен быть орван нулью, если поле Common.FieldType последнего элемента FolderFieldDefinitionA равно ftNull.
  
## <a name="folderuserfieldsw-stream-structure"></a>Структура потока FolderUserFieldsW

Структура потока FolderUserFieldsW — это массив структур потока FolderFieldDefinitionW, содержащий определения для всех пользовательских полей в папке Outlook.
  
Элементы данных в этом потоке хранятся в порядок с небольшими конечными битами, сразу же после друг друга в указанном порядке:
  
- **FieldDefinitionCount**: DWORD (4 bytes), количество определений полей в этом потоке. Это количество элементов в **массиве FieldDefinitions.**
    
- **FieldDefinitions**: массив структур потока FolderFieldDefinitionW. Количество массивов равно элементу **данных FieldDefinitionCount.**
    
Массив **FieldDefinitions** должен быть орван нулью, так как поле Common.FieldType последнего элемента FolderFieldDefinitionW равно ftNull.
  
## <a name="folderfielddefinitiona-stream-structure"></a>Структура потока FolderFieldDefinitionA

Структура потока FolderFieldDefinitionA содержит определение пользовательского поля с именем поля, сохраненным в ANSI.
  
Элементы данных в этом потоке хранятся в порядок с небольшими конечными битами, сразу же после друг друга в указанном порядке:
  
- **FieldType**: FldType (4 bytes), тип этого поля.
    
- **FieldNameLength**: WORD (2 bytes), количество элементов в **массиве FieldName.**
    
- **FieldName**: массив CHAR. Это представление CP_ACP anSI для имени поля. Количество массивов равно **FieldNameLength.** Имя поля должно удовлетворять ограничениям параметра Name, как указано в [методе UserProperties.Add.](https://msdn.microsoft.com/library/microsoft.office.interop.outlook.userproperties.add.aspx) 
    
   > [!NOTE]
   > По причинам совместимости прежних версий Outlook может обрабатывать некоторые значения **FieldName,** не удовлетворяющие этим ограничениям, однако в этом разделе такие случаи не освещаются. 
  
- **Common**: структура потока FolderFieldDefinitionCommon.
    
## <a name="folderfielddefinitionw-stream-structure"></a>Структура потока FolderFieldDefinitionW

Структура потока FolderFieldDefinitionW содержит определение определяемого пользователем поля с именем поля, сохраненным в Юникоде.
  
Элементы данных в этом потоке хранятся в порядок с небольшими конечными битами, сразу же после друг друга в указанном порядке:
  
- **FieldType**: FldType (4 bytes), тип этого поля.
    
- **FieldNameLength**: WORD (2 bytes), количество элементов в **массиве FieldName.**
    
- **FieldName**: массив WCHAR. Это представление имени поля в коде Юникод (UTF-16). Количество массивов равно **FieldNameLength.** Имя поля должно удовлетворять ограничениям параметра Name, как указано в [методе UserProperties.Add.](https://msdn.microsoft.com/library/microsoft.office.interop.outlook.userproperties.add.aspx) 
    
   > [!NOTE]
   > По причинам совместимости прежних версий Outlook может обрабатывать некоторые значения **FieldName,** не удовлетворяющие этим ограничениям, но в этом разделе такие случаи не освещаются. 
  
- **Common**: структура потока FolderFieldDefinitionCommon.
    
## <a name="fldtype-enumeration"></a>FldType Enumeration

**Значения перечисления FldType** перечислены в следующей таблице. 
  
|Имя|Значение|Смысл|
|:-----|:-----|:-----|
|ftNull  <br/> |0x0  <br/> |Этот тип поля используется для опечатки массива определений полей.  <br/> |
|ftString  <br/> |0x1  <br/> |Текст  <br/> |
|ftInteger  <br/> |0x3  <br/> |Целое число  <br/> |
|ftTime  <br/> |0x5  <br/> |Дата и время  <br/> |
|ftBoolean  <br/> |0x6  <br/> |Да или Нет  <br/> |
|ftDuration  <br/> |0x7  <br/> |Duration  <br/> |
|ftMultiString  <br/> |0xB  <br/> |Ключевые слова  <br/> |
|ftFloat  <br/> |0xC  <br/> |Число или процент  <br/> |
|ftCurrency  <br/> |0xE  <br/> |Валюта  <br/> |
|ftCalc  <br/> |0x12  <br/> |Формула  <br/> |
|ftSwitch  <br/> |0x13  <br/> |Сочетание типа, в котором отображается только первое непустое поле, игнорируя последующие.  <br/> |
|ftConcat  <br/> |0x17  <br/> |Сочетание типов, которые объединяют поля и фрагменты текста друг с другом.  <br/> |
   
## <a name="folderfielddefinitioncommon-stream-structure"></a>Структура потока FolderFieldDefinitionCommon

Структура потока FolderFieldDefinitionCommon содержит данные пользовательского определения поля, которые являются общими для FolderFieldDefinitionA и FolderFieldDefinitionW.
  
Элементы данных в этом потоке хранятся в порядок с небольшими конечными битами, сразу же после друг друга в указанном порядке:
  
- **PropSetGuid**: GUID (16 bytes), guID набора свойств соответствующего имени свойства MAPI поля папки. Значение этого поля должно быть равно PS_PUBLIC_STRINGS, если только тип поля не **является ftNone,** в этом случае значение этого поля должно быть равно GUID_NULL. 
    
   > [!NOTE]
   > По причинам совместимости с устаревшей версией Outlook может обрабатывать некоторые значения **PropSetGuid,** не удовлетворяющие этому ограничению, однако в этом разделе такие случаи не освещаются. 
  
- **fcapm**: DWORD (4 bytes), сочетание 0 или более помечает значения, которые и значения перечислены в следующей таблице. Значения флагов с одинаковым значением зависят от типа поля, то есть от значения FldType.
    
    |Имя флага|Значение|Смысл|
    |:-----|:-----|:-----|
    |FCAPM_CAN_EDIT  <br/> |0x00000001  <br/> |Поле можно редактировать.  <br/> |
    |FCAPM_CAN_SORT  <br/> |0x00000002  <br/> |Поле можно сортировать.  <br/> |
    |FCAPM_CAN_GROUP  <br/> |0x00000004  <br/> |Поле можно сгруппить.  <br/> |
    |FCAPM_MULTILINE_TEXT  <br/> |0x00000100  <br/> |Поле может вметь несколько строк текста.  <br/> |
    |FCAPM_PERCENT  <br/> |0x01000000  <br/> |Это поле типа ftFloat — это процентное поле.  <br/> |
    |FCAPM_DATEONLY  <br/> |0x01000000  <br/> |Это поле типа ftTime является полем времени только для даты.  <br/> |
    |FCAPM_UNITLESS  <br/> |0x01000000  <br/> |Для этого поля типа ftInteger не допускается ни одна единица в формате отображения; например, такие форматы, как "Computer - 640 K..." не разрешено.  <br/> |
    |FCAPM_CAN_EDIT_IN_ITEM  <br/> |0x80000000  <br/> |Поле можно изменить в элементе: это специально для настраиваемой формы.  <br/> |
   
- **dwString**: DWORD (4 bytes). См. первое примечание.
    
- **dwBitmap**: DWORD (4 bytes). См. первое примечание.
    
- **dwDisplay**: DWORD (4 bytes). См. первое примечание.
    
- **iFmt**: INT (4 bytes). Для типов полей с полем со combo "Format:" в диалоговых окнах "Новое поле", "Изменение поля" и "Свойства поля" индекс на основе 0 формата, выбранного в этом поле. Для типов полей без этого поля со счетом это должно быть 0. Значение поля вместе с типом поля однозначно определяет значения полей **dwString,** **dwBitmap** и **dwDisplay,** см. первое примечание.
    
- **wszFormulaLength**: WORD (2 bytes), количество элементов в **массиве wszFormulaLength.**
    
- **wszFormulaLength**: массив WCHAR. Это представление строки формулы поля Юникод (UTF-16) в стандартном формате. Описание стандартных форматов и форматов пользовательского интерфейса формулы поля см. во втором примечате. Количество массивов равно **wszFormulaLength.** Строка формулы должна быть пустой строкой, если тип поля не **ftCalc,** **ftSwitch** **или ftConcat.**
    
> [!NOTE]
> Хотя значения **dwString,** **dwBitmap** и **dwDisplay** однозначно определяются на основе значения **FldType** и **iFmt,** которые являются избыточными, их правильные значения по-прежнему необходимы для правильной обработки определения поля в Outlook. Простого описания алгоритма, который выполняет это определение, нет. 
> 
> Таким образом, чтобы узнать, какие значения  **dwString,** **dwBitmap** и **dwDisplay** соответствуют заданным значениям **FldType** и **iFmt,** выполните проверку, создав определяемое пользователем поле этого типа и выбрав формат, выбранный в поле со значением "Формат", при условии его применимости проверьте итоговый поток **FolderUserFields,** который Outlook создает для этого пользовательского поля. 
  
Формула поля в формате пользовательского интерфейса редактирована в текстовом  поле "Формула" диалоговых окна "Новое поле", "Изменение поля" и "Свойства поля" для пользовательского поля.   Алгоритм преобразования формулы из формата пользовательского интерфейса в стандартный зависит от типа поля, как описано в следующем примере: 
- Для полей типов **ftCalc** и **ftSwitch** стандартный формат для встроенных полей, для которых соответствующие свойства MAPI не являются именованными свойствами типа MNID STRING, получается путем замены фрагментов имен полей, то есть \_ `[<field_name>]` `[_<field_dispid_decimal>]` фрагментов. 

  Например, если формат пользовательского интерфейса формулы для поля типа **Formula**, то есть **ftCalc**, с языком пользовательского интерфейса Office, который является английский (США), где это имя определяемого пользователем `[Business Phone] & [My custom field]` поля, стандартным форматом такой формулы будет `My custom field` `[_14856] & [My custom field]` .

- Для полей типа **ftConcat** стандартный формат получается путем выполнения следующих процедур:

  1. Усечение белого пространства в окнах и в окнах. 
  2. Разблокировать формулу на последовательность фрагментов следующих двух видов: 
     - Имя поля в квадратных скобках, то `[<field_name>]` есть. 
     - Подстрока, не содержащая квадратные скобки.   
      Убедитесь, что в последовательности нет двух фрагментов второго типа. Если формулу не удается таким образом разлить, она считается недопустимой. 
  3. Выполните ту же замену фрагментов первого типа, что и для полей **ftCalc** и **ftSwitch.** 
  4. Для каждого фрагмента второго типа escape все символы двойных кавычках (""), если они есть, с двумя последовательными символами двойных кавычках и заключены в двойные кавычка. 
  5. Вставьте строку амперанд () между `&` каждой парой смежных фрагментов.
 
  Например, если используется английский язык пользовательского интерфейса Office, если формат пользовательского интерфейса формулы для поля типа **ftConcat** — где это имя определяемого пользователем поля, стандартным форматом для такой формулы будет `text1 [Business Phone] "text2" [My custom field]` `My custom field` `""text1" & [_14856] & """text2""" & [My custom field]"` . 
  
## <a name="see-also"></a>См. также

- [Пример потока FolderUserFields](folderuserfields-stream-sample.md)
- [Добавление определения для нового поля User-Defined](how-to-add-a-definition-for-a-new-user-defined-field.md)

