---
title: Структуры потока полей папок
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: edbc9e6c-008c-4c13-9a0c-cb47ac0f3686
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 96051bd2b62fd7c0e908a1018aac0225e44986be
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32336892"
---
# <a name="folder-fields-stream-structures"></a>Структуры потока полей папок

**Область применения**: Outlook 2013 | Outlook 2016 
  
Свойство [PidTagUserFields](pidtaguserfields-canonical-property.md) сообщения содержит двоичный поток, FolderUserFields, который содержит определения определяемых пользователем полей папки. В этом разделе описываются структуры потока для определений определяемых пользователем полей папки. 

Структура потока FolderUserFields состоит из структуры Фолдерусерфиелдса или структуры Фолдерусерфиелдса, а затем структуры Фолдерусерфиелдсв.
  
Элементы данных в этом потоке хранятся сразу друг от друга в следующем порядке:
  
- **Фолдерусерфиелдсанси**: структура потока фолдерусерфиелдса.
    
- **Фолдерусерфиелдсуникоде** (необязательно): структура потока Фолдерусерфиелдсв.
    
Присутствие Фолдерусерфиелдсуникоде определяется общей длиной FolderUserFields, превышающей длину Фолдерусерфиелдсанси.
  
> [!IMPORTANT]
> Фолдерусерфиелдсанси используется для совместимости с более старыми версиями клиентов MAPI, не поддерживающими Юникод, поэтому при наличии Фолдерусерфиелдсуникоде содержимое Фолдерусерфиелдсанси игнорируется. Чтобы избежать возможной потери данных в преобразовании ANSI, при создании потока FolderUserFields всегда включается часть Фолдерусерфиелдсв. 
  
## <a name="folderuserfieldsa-stream-structure"></a>Структура потока Фолдерусерфиелдса

Структура потока Фолдерусерфиелдса — это массив структуры потоков Фолдерфиелддефинитиона, который содержит определения для всех пользовательских полей в папке Outlook, если не переопределен частью Фолдерусерфиелдсв структуры FolderUserFields.
  
Элементы данных в этом потоке хранятся в обратном порядке байтов, который выполняется сразу же после каждого следующего порядка:
  
- **Фиелддефинитионкаунт**: DWORD (4 байта), количество определений полей в этом потоке. Это количество элементов в массиве **фиелддефинитионс** .
    
- **Фиелддефинитионс**: массив структуры потоков фолдерфиелддефинитиона. Количество этого массива равно элементу данных **фиелддефинитионкаунт** .
    
Если это Фолдерусерфиелдса не переопределено частью Фолдерусерфиелдсв структуры FolderUserFields, массив **фиелддефинитионс** должен иметь значение "null-завершено", так как для последнего поля фолдерфиелддефинитиона элемента указано значение "равно". FieldType в Фтнулл.
  
## <a name="folderuserfieldsw-stream-structure"></a>Структура потока Фолдерусерфиелдсв

Структура потока Фолдерусерфиелдсв — это массив структуры потоков Фолдерфиелддефинитионв, в котором содержатся определения для всех полей, определенных пользователем, в папке Outlook.
  
Элементы данных в этом потоке хранятся в обратном порядке байтов, который выполняется сразу же после каждого следующего порядка:
  
- **Фиелддефинитионкаунт**: DWORD (4 байта), количество определений полей в этом потоке. Это количество элементов в массиве **фиелддефинитионс** .
    
- **Фиелддефинитионс**: массив структуры потоков фолдерфиелддефинитионв. Количество этого массива равно элементу данных **фиелддефинитионкаунт** .
    
Массив **фиелддефинитионс** должен иметь значение "нулем — завершено", так как его Последнее поле Фолдерфиелддефинитионв элемента равно фтнулл.
  
## <a name="folderfielddefinitiona-stream-structure"></a>Структура потока Фолдерфиелддефинитиона

Структура потока Фолдерфиелддефинитиона содержит определение определяемого пользователем поля с именем поля, хранящимся в КОДИРОВКе ANSI.
  
Элементы данных в этом потоке хранятся в обратном порядке байтов, который выполняется сразу же после каждого следующего порядка:
  
- **FieldType**: флдтипе (4 байта), тип этого поля.
    
- **Фиелднамеленгс**: Word (2 байта), количество элементов в самом массиве. ****
    
- **Fieldname**: массив char. Это КП_АКП кодовое представление имени поля в КОДИРОВКе ANSI. Количество этого массива равно **фиелднамеленгс**. Имя поля должно удовлетворять ограничениям для параметра name, как указано в методе [UserProperties. Add](https://msdn.microsoft.com/library/microsoft.office.interop.outlook.userproperties.add.aspx) . 
    
   > [!NOTE]
   > В целях обеспечения совместимости с устаревшими версиями Outlook может обрабатывать некоторые значения **** , которые не удовлетворяют этим ограничениям, но такие случаи не рассматриваются в этом разделе. 
  
- **Общие**: структура потока фолдерфиелддефинитионкоммон.
    
## <a name="folderfielddefinitionw-stream-structure"></a>Структура потока Фолдерфиелддефинитионв

Структура потока Фолдерфиелддефинитионв содержит определение определяемого пользователем поля с именем поля, хранящимся в Юникоде.
  
Элементы данных в этом потоке хранятся в обратном порядке байтов, который выполняется сразу же после каждого следующего порядка:
  
- **FieldType**: флдтипе (4 байта), тип этого поля.
    
- **Фиелднамеленгс**: Word (2 байта), количество элементов в самом массиве. ****
    
- **Fieldname**: массив типа WCHAR. Это представление в Юникоде (UTF-16) имени поля. Количество этого массива равно **фиелднамеленгс**. Имя поля должно удовлетворять ограничениям для параметра name, как указано в методе [UserProperties. Add](https://msdn.microsoft.com/library/microsoft.office.interop.outlook.userproperties.add.aspx) . 
    
   > [!NOTE]
   > В целях совместимости с устаревшими версиями Outlook может обрабатывать некоторые значения, **** которые не удовлетворяют этим ограничениям, но такие случаи не рассматриваются в этом разделе. 
  
- **Общие**: структура потока фолдерфиелддефинитионкоммон.
    
## <a name="fldtype-enumeration"></a>ПереЧисление Флдтипе

Значения перечислений **флдтипе** перечислены в следующей таблице. 
  
|Имя|Значение|Значение|
|:-----|:-----|:-----|
|Фтнулл  <br/> |0x0  <br/> |Этот тип поля используется для завершения работы массива определений поля (null).  <br/> |
|Фтстринг  <br/> |0x1  <br/> |Текст  <br/> |
|Фтинтежер  <br/> |0x3  <br/> |Целое число  <br/> |
|Фттиме  <br/> |0x5  <br/> |Дата/время  <br/> |
|Фтбулеан  <br/> |0x6  <br/> |Да или Нет  <br/> |
|Фтдуратион  <br/> |0x7  <br/> |Duration (Длительность)  <br/> |
|Фтмултистринг  <br/> |0xB  <br/> |Ключевые слова  <br/> |
|Фтфлоат  <br/> |0xC  <br/> |Число или процент  <br/> |
|Фткурренци  <br/> |0xE  <br/> |Денежный  <br/> |
|Фткалк  <br/> |0x12  <br/> |Формула  <br/> |
|Фтсвитч  <br/> |0x13  <br/> |Комбинация типа, отражающая только первое непустое поле — игнорирует последующие.  <br/> |
|Фтконкат  <br/> |0x17  <br/> |Сочетание типа присоединяемых полей и любых фрагментов текста друг с другом.  <br/> |
   
## <a name="folderfielddefinitioncommon-stream-structure"></a>Структура потока Фолдерфиелддефинитионкоммон

Структура потока Фолдерфиелддефинитионкоммон содержит данные определяемого пользователем определения поля, которое является общим для Фолдерфиелддефинитиона и Фолдерфиелддефинитионв.
  
Элементы данных в этом потоке хранятся в обратном порядке байтов, который выполняется сразу же после каждого следующего порядка:
  
- **Пропсетгуид**: GUID (16 байт), идентификатор GUID набора свойств соответствующего имени свойства MAPI для поля папки. Значение этого поля должно равняться ПС_ПУБЛИК_СТРИНГС, если типом поля не является **фтноне** , в этом случае значение этого поля должно быть равно гуид_нулл. 
    
   > [!NOTE]
   > В целях обеспечения совместимости с устаревшими версиями Outlook может обрабатывать некоторые значения **пропсетгуид** , не соответствующие этому ограничению, однако такие случаи не рассматриваются в этом разделе. 
  
- **фкапм**: DWORD (4 байта), комбинация нуля или более флагов. значения этих флагов перечислены в следующей таблице. Флаги с одинаковым значением имеют значения, зависящие от типа поля, то есть значения Флдтипе.
    
    |Имя флага|Значение|Значение|
    |:-----|:-----|:-----|
    |ФКАПМ_КАН_ЕДИТ  <br/> |0x00000001  <br/> |Поле доступно для редактирования.  <br/> |
    |ФКАПМ_КАН_СОРТ  <br/> |0x00000002  <br/> |Поле доступно для сортировки.  <br/> |
    |ФКАПМ_КАН_ГРАУП  <br/> |0x00000004  <br/> |Поле является группированным.  <br/> |
    |ФКАПМ_МУЛТИЛИНЕ_ТЕКСТ  <br/> |0x00000100  <br/> |Поле может содержать несколько строк текста.  <br/> |
    |ФКАПМ_ПЕРЦЕНТ  <br/> |0x01000000  <br/> |Это поле типа Фтфлоат является процентным.  <br/> |
    |ФКАПМ_ДАТЕОНЛИ  <br/> |0x01000000  <br/> |Это поле типа Фттиме — это поле даты и времени.  <br/> |
    |ФКАПМ_УНИТЛЕСС  <br/> |0x01000000  <br/> |В этом поле типа Фтинтежер не допускается использование единиц в формате отображения; Например, такие форматы, как "Computering 640 K..." не разрешены.  <br/> |
    |ФКАПМ_КАН_ЕДИТ_ИН_ИТЕМ  <br/> |0x80000000  <br/> |Поле можно редактировать в элементе: это относится только к настраиваемым формам.  <br/> |
   
- **двстринг**: DWORD (4 байта). Ознакомьтесь с первой заМеткой.
    
- **двбитмап**: DWORD (4 байта). Ознакомьтесь с первой заМеткой.
    
- **двдисплай**: DWORD (4 байта). Ознакомьтесь с первой заМеткой.
    
- **ифмт**: int (4 байта). Для типов полей с раскрывающимся списком "формат:" в диалоговых окнах "Создание поля", "изменение поля" и "Свойства поля" — индекс формата, который выбран в поле со списком. Для типов полей без поля со списком это значение должно быть равно 0. Значение поля, вместе с типом поля, однозначно определяет значения полей **двстринг**, **двбитмап**и **двдисплай** , приведенные в первой заметке.
    
- **всзформулаленгс**: Word (2 байта), количество элементов в массиве **всзформулаленгс** .
    
- **всзформулаленгс**: массив типа WCHAR. Это представление Юникод (UTF-16) строки формулы поля в стандартном формате. В следующей заМетке представлено описание стандартных форматов и форматов ПОЛЬЗОВАТЕЛЬСКОГО интерфейса формулы поля. Количество этого массива равно **всзформулаленгс**. Строка формулы должна быть пустой строкой, если тип поля — **фткалк**, **фтсвитч** или **фтконкат**.
    
> [!NOTE]
> Несмотря на то, что значения **двстринг**, **двбитмап**и **двдисплай** однозначно определяются на основе значения **флдтипе** , а значение **ифмт** , которое является избыточным, их правильные значения по-прежнему необходимы для правильной Обработка определения поля приложением Outlook. Не существует простого описания алгоритма, который выполняет это определение. 
> 
> Таким образом, чтобы узнать, какие значения **двстринг**, **двбитмап**и **двдисплай** соответствуют заданному значению **флдтипе** и **ифмт** значению, выполните тест, создав определяемое пользователем поле этого типа, и с выбранным форматом в поле со списком **Формат** , предполагая, что его применимость, изучите полученный в результате поток **FolderUserFields** , который создает Outlook для поля, определенного пользователем. 
  
Формула поля в формате ПОЛЬЗОВАТЕЛЬСКОГО интерфейса редактируется в текстовом поле **Формула** для диалогового окна **Создание поля**, **изменение поля**и **Свойства поля** для поля, определяемого пользователем. Алгоритм преобразования формулы из формата ПОЛЬЗОВАТЕЛЬСКОГО интерфейса в стандартный формат зависит от типа поля, как описано ниже. 
- Для полей типов **фткалк** и **фтсвитч**стандартный формат для встроенных полей, которые соответствующие свойства MAPI не называются свойствами строки мнид\_, заменяются на фрагменты имени поля, то есть `[<field_name>]` с фрагментами `[_<field_dispid_decimal>]`. 

  Например, если формат ПОЛЬЗОВАТЕЛЬСКОГО интерфейса формулы для поля типа **Формула**( **фткалк**) с языком пользовательского интерфейса Office Английский (США), то `[Business Phone] & [My custom field]`есть, где `My custom field` — имя определенного пользователем поля, стандартный формат такой формулы будет `[_14856] & [My custom field]`.

- Для полей типа **фтконкат**стандартный формат получается путем выполнения следующих действий:

  1. Усечение начальных и конечных пробелов. 
  2. ПроАнализируйте формулу в последовательности фрагментов следующих двух типов: 
     - Имя поля в квадратных скобках, то есть, `[<field_name>]`. 
     - Подстрока, не содержащая квадратных скобок.   
      Убедитесь, что ни один из двух фрагментов второго типа не является смежным в последовательности. Если формула не может быть проанализирована таким образом, она считается недопустимой. 
  3. Выполните ту же замену для фрагментов первого типа, что и для полей **фткалк** и **фтсвитч** . 
  4. Для каждого фрагмента второго типа все символы двойных кавычек ("" "), если они есть, с двумя последовательными символами двойной кавычки и заключить их в двойные кавычки. 
  5. Вставка строки амперсанда (`&`) между каждой из двух смежных фрагментов.
 
  Например, если используется английский язык ПОЛЬЗОВАТЕЛЬСКОГО интерфейса Office, то если для поля типа **фтконкат** ЗАДАН `text1 [Business Phone] "text2" [My custom field]`формат пользовательского интерфейса, где `My custom field` — это имя определяемого пользователем поля, то для такой формулы будет использоваться `""text1" & [_14856] & """text2""" & [My custom field]"`стандартный формат. 
  
## <a name="see-also"></a>См. также

- [Пример потока FolderUserFields](folderuserfields-stream-sample.md)
- [Добавление определения для нового пользовательского поля](how-to-add-a-definition-for-a-new-user-defined-field.md)

