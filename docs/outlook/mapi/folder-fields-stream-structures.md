---
title: Структуры потока поля папок
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
ms.assetid: edbc9e6c-008c-4c13-9a0c-cb47ac0f3686
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 96051bd2b62fd7c0e908a1018aac0225e44986be
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32336892"
---
# <a name="folder-fields-stream-structures"></a>Структуры потока поля папок

**Область применения**: Outlook 2013 | Outlook 2016 
  
Свойство [PidTagUserFields](pidtaguserfields-canonical-property.md) сообщения содержит двоичный поток FolderUserFields, который содержит определения поля, определенные пользователем папки. В этом разделе описываются структуры потока для определений полей, определенных пользователем для папок. 

Структура потока FolderUserFields состоит из структуры FolderUserFieldsA или структуры FolderUserFieldsA, а затем структуры FolderUserFieldsW.
  
Элементы данных в этом потоке хранятся сразу после друг друга в указанном ниже порядке:
  
- **FolderUserFieldsAnsi**: структура потока folderUserFieldsA.
    
- **FolderUserFieldsUnicode** (необязательно): структура потока folderUserFieldsW.
    
Наличие folderUserFieldsUnicode определяется общей длиной folderUserFields, которая превышает длину FolderUserFieldsAnsi.
  
> [!IMPORTANT]
> FolderUserFieldsAnsi используется для совместимости с более старыми версиями клиентов MAPI, поэтому если folderUserFieldsUnicode присутствует, содержимое FolderUserFieldsAnsi игнорируется. Чтобы избежать возможной потери данных при преобразовании ANSI, при создании потока FolderUserFields всегда включается часть FolderUserFieldsW. 
  
## <a name="folderuserfieldsa-stream-structure"></a>Структура потока folderUserFieldsA

Структура потока FolderUserFieldsA — это массив структур потока FolderFieldDefinitionA, содержащих определения для всех определенных пользователем полей в папке Outlook, если только она не переопределена частью folderUserFieldsW структуры FolderUserFields.
  
Элементы данных в этом потоке хранятся в порядке маленького byte, сразу же следуя друг за другом в указанном ниже порядке:
  
- **FieldDefinitionCount**: DWORD (4 bytes), количество определений полей в этом потоке. Это количество элементов в **массиве FieldDefinitions.**
    
- **FieldDefinitions:** массив структур потока FolderFieldDefinitionA. Количество этого массива равно элементу **данных FieldDefinitionCount.**
    
Если эта folderUserFieldsA не будет переопределена частью folderUserFieldsW структуры FolderUserFields, массив **FieldDefinitions** должен быть "неокончен", имея поле Common.FieldType последнего элемента FolderFieldDefinitionA, равное поле ftNull.
  
## <a name="folderuserfieldsw-stream-structure"></a>Структура потока folderUserFieldsW

Структура потока FolderUserFieldsW — это массив структур потока FolderFieldDefinitionW, содержащих определения для всех определенных пользователем полей в Outlook папке.
  
Элементы данных в этом потоке хранятся в порядке маленького byte, сразу же следуя друг за другом в указанном ниже порядке:
  
- **FieldDefinitionCount**: DWORD (4 bytes), количество определений полей в этом потоке. Это количество элементов в **массиве FieldDefinitions.**
    
- **FieldDefinitions:** массив структур потока FolderFieldDefinitionW. Количество этого массива равно элементу **данных FieldDefinitionCount.**
    
Массив **FieldDefinitions** должен быть "прекращен" с помощью поля Common.FieldType последнего элемента FolderFieldDefinitionW, равного поле ftNull.
  
## <a name="folderfielddefinitiona-stream-structure"></a>Структура потока folderFieldDefinitionA

Структура потока FolderFieldDefinitionA содержит определение определенного пользователем поля с именем поля, хранимого в ANSI.
  
Элементы данных в этом потоке хранятся в порядке маленького byte, сразу же следуя друг за другом в указанном ниже порядке:
  
- **FieldType**: FldType (4 bytes), тип этого поля.
    
- **FieldNameLength**: WORD (2 bytes), количество элементов в **массиве FieldName.**
    
- **FieldName**: массив CHAR. Это представление кода CP_ACP anSI. Количество этого массива равно **FieldNameLength**. Имя поля должно удовлетворять ограничениям по параметру Name, указанным в [методе UserProperties.Add.](https://msdn.microsoft.com/library/microsoft.office.interop.outlook.userproperties.add.aspx) 
    
   > [!NOTE]
   > По причинам устаревшей совместимости Outlook могут обрабатывать некоторые значения **FieldName,** не удовлетворяющие этим ограничениям, однако такие случаи не охватываются этой темой. 
  
- **Общие:** структура потока FolderFieldDefinitionCommon.
    
## <a name="folderfielddefinitionw-stream-structure"></a>Структура потока folderFieldDefinitionW

Структура потока FolderFieldDefinitionW содержит определение пользовательского поля с именем поля, хранимого в Unicode.
  
Элементы данных в этом потоке хранятся в порядке маленького byte, сразу же следуя друг за другом в указанном ниже порядке:
  
- **FieldType**: FldType (4 bytes), тип этого поля.
    
- **FieldNameLength**: WORD (2 bytes), количество элементов в **массиве FieldName.**
    
- **Имя поля:** массив WCHAR. Это представление имени поля Unicode (UTF-16). Количество этого массива равно **FieldNameLength**. Имя поля должно удовлетворять ограничениям по параметру Name, указанным в [методе UserProperties.Add.](https://msdn.microsoft.com/library/microsoft.office.interop.outlook.userproperties.add.aspx) 
    
   > [!NOTE]
   > По причинам устаревшей совместимости Outlook могут обрабатывать некоторые значения **FieldName,** не удовлетворяющие этим ограничениям, но такие случаи не охватываются этой темой. 
  
- **Общие:** структура потока FolderFieldDefinitionCommon.
    
## <a name="fldtype-enumeration"></a>Переумерия FldType

**Значения перечисления FldType** перечислены в следующей таблице. 
  
|Имя|Значение|Смысл|
|:-----|:-----|:-----|
|ftNull  <br/> |0x0  <br/> |Этот тип поля используется для null-terminate массива определений полей.  <br/> |
|ftString  <br/> |0x1  <br/> |Текст  <br/> |
|ftInteger  <br/> |0x3  <br/> |Целое число  <br/> |
|ftTime  <br/> |0x5  <br/> |Дата/время  <br/> |
|ftBoolean  <br/> |0x6  <br/> |Да или Нет  <br/> |
|ftDuration  <br/> |0x7  <br/> |Длительность  <br/> |
|ftMultiString  <br/> |0xB  <br/> |Ключевые слова  <br/> |
|ftFloat  <br/> |0xC  <br/> |Число или процент  <br/> |
|ftCurrency  <br/> |0xE  <br/> |Денежный  <br/> |
|ftCalc  <br/> |0x12  <br/> |Формула  <br/> |
|ftSwitch  <br/> |0x13  <br/> |Сочетание типа, показывающая только первое не пустое поле, игнорируя последующие.  <br/> |
|ftConcat  <br/> |0x17  <br/> |Сочетание типовой присоединение полей и любых фрагментов текста друг к другу.  <br/> |
   
## <a name="folderfielddefinitioncommon-stream-structure"></a>Структура потока folderFieldDefinitionCommon

Структура потока folderFieldDefinitionCommon содержит данные определения поля, определяемого пользователем, которое является общим как для folderFieldDefinitionA, так и для folderFieldDefinitionW.
  
Элементы данных в этом потоке хранятся в порядке маленького byte, сразу же следуя друг за другом в указанном ниже порядке:
  
- **PropSetGuid**: GUID (16 bytes), набор свойств GUID соответствующего имени свойства MAPI поля папки. Значение этого поля должно быть равно PS_PUBLIC_STRINGS, если тип поля не **является ftNone,** в этом случае значение этого поля должно быть равно GUID_NULL. 
    
   > [!NOTE]
   > По причинам устаревшей совместимости Outlook могут обрабатывать некоторые значения **PropSetGuid,** не удовлетворяющие этому ограничению, однако такие случаи не охватываются этой темой. 
  
- **fcapm**: DWORD (4 bytes), сочетание нуля или более флагов, значения которых и значения перечислены в следующей таблице. Флаги с одинаковым значением имеют значения, зависящие от типа поля, то есть значения FldType.
    
    |Имя флага|Значение|Смысл|
    |:-----|:-----|:-----|
    |FCAPM_CAN_EDIT  <br/> |0x00000001  <br/> |Поле редактируемо.  <br/> |
    |FCAPM_CAN_SORT  <br/> |0x00000002  <br/> |Поле сортируемый.  <br/> |
    |FCAPM_CAN_GROUP  <br/> |0x00000004  <br/> |Поле сгруппивное.  <br/> |
    |FCAPM_MULTILINE_TEXT  <br/> |0x00000100  <br/> |Поле может вметь несколько строк текста.  <br/> |
    |FCAPM_PERCENT  <br/> |0x01000000  <br/> |Это поле типа ftFloat — это процентное поле.  <br/> |
    |FCAPM_DATEONLY  <br/> |0x01000000  <br/> |Это поле типа ftTime — это поле времени только для дат.  <br/> |
    |FCAPM_UNITLESS  <br/> |0x01000000  <br/> |Для этого поля типа ftInteger ни один блок не разрешен в формате отображения; например, такие форматы, как "Computer - 640 K..." не допускается.  <br/> |
    |FCAPM_CAN_EDIT_IN_ITEM  <br/> |0x80000000  <br/> |Поле может быть изменено в элементе. Это специально для настраиваемой формы.  <br/> |
   
- **dwString**: DWORD (4 bytes). См. первую следующую заметку.
    
- **dwBitmap**: DWORD (4 bytes). См. первую следующую заметку.
    
- **dwDisplay**: DWORD (4 bytes). См. первую следующую заметку.
    
- **iFmt**: INT (4 bytes). Для типов полей, которые имеют диалоговое окно "Format:" в диалоговых окнах "Новое поле", "Изменить поле" и "Свойства поля", индекс формата на основе 0, выбранный в этом диалоговом окне. Для типов полей без этого комбо-окна это должно быть 0. Значение поля вместе с типом поля однозначно определяет значения полей **dwString,** **dwBitmap** и **dwDisplay,** см. в первой следующей заметке.
    
- **wszFormulaLength**: WORD (2 bytes), количество элементов в **массиве wszFormulaLength.**
    
- **wszFormulaLength**: массив WCHAR. Это представление единой строки формулы поля (UTF-16) в стандартном формате. См. вторую ниже примечание для описания стандартных форматов и форматов пользовательского интерфейса формулы поля. Количество этого массива равно **wszFormulaLength**. Строка формулы должна быть пустой строкой, если тип поля **не является ftCalc,** **ftSwitch** или **ftConcat.**
    
> [!NOTE]
> Хотя значения **dwString,** **dwBitmap** и **dwDisplay** однозначно определяются на основе значения **FldType** и **значения iFmt,** которые являются избыточными, их правильные значения по-прежнему необходимы для правильной обработки определения поля Outlook. Нет простого описания алгоритма, который выполняет это определение. 
> 
> Таким образом, чтобы выяснить, какие значения **dwString,** **dwBitmap** и **dwDisplay** соответствуют заданным значениям **FldType** и **iFmt,** выполните тест, создав определенное пользователем поле этого типа, а также с помощью этого формата, выбранного в поле **Комбо** Format, при условии его применимости, проверьте создаваемый поток **FolderUserFields,** который Outlook создается для этого пользовательского поля. 
  
Формула поля в формате пользовательского интерфейса  редактирована в текстовом окне Формула диалоговых диалогов **New Field,** **Edit Field** и **Field Properties** для определенного пользователем поля. Алгоритм преобразования формулы из формата пользовательского интерфейса в стандартный зависит от типа поля, описанного ниже: 
- Для полей типов **ftCalc** и **ftSwitch** стандартный формат встроенных полей, для которых соответствующие свойства MAPI не называются свойствами типа MNID STRING, получается путем замены фрагментов имен полей, то есть \_ `[<field_name>]` `[_<field_dispid_decimal>]` фрагментов. 

  Например, если формат пользовательского интерфейса формулы для поля типа Formula **,** то есть **ftCalc,** с языком Office пользовательского интерфейса, который является английским, является , где имя определенного пользователем поля, стандартный формат такой формулы будет `[Business Phone] & [My custom field]` `My custom field` `[_14856] & [My custom field]` .

- Для полей типа **ftConcat** стандартный формат получается, выполняя следующие:

  1. Усечено ведущее и трейлинг-белое пространство. 
  2. Размыть формулу в последовательность фрагментов следующих двух видов: 
     - Имя поля в квадратных скобках, то есть `[<field_name>]` . 
     - Подстройка, не содержащая квадратных скобок.   
      Убедитесь, что в последовательности нет двух фрагментов второго типа. Если формула не может быть разсчитана таким образом, она считается недействительной. 
  3. Выполните ту же замену фрагментов первого типа, что и для **полей ftCalc** и **ftSwitch.** 
  4. Для каждого фрагмента второго типа избежите все символы двойного кавычка ("""), если они есть, с двумя последовательными двукавыми символами и заключим его в двойные кавычка. 
  5. Вставьте строку ampersand `&` () между каждой парой смежных фрагментов.
 
  Например, с помощью языка Office пользовательского интерфейса us English, если формат пользовательского интерфейса формулы для поля типа **ftConcat** — где имя определенного пользователем поля, стандартный формат для такой формулы будет `text1 [Business Phone] "text2" [My custom field]` `My custom field` `""text1" & [_14856] & """text2""" & [My custom field]"` . 
  
## <a name="see-also"></a>См. также

- [Пример потока folderUserFields](folderuserfields-stream-sample.md)
- [Добавление определения для нового User-Defined поля](how-to-add-a-definition-for-a-new-user-defined-field.md)

