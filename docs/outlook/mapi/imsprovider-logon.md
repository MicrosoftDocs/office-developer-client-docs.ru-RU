---
title: имспровидерлогон
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMSProvider.Logon
api_type:
- COM
ms.assetid: 890d9cbe-3570-4cf0-aeae-667c0e5ba181
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 9c7f62c69c7a06f7ca0e4bfddcf789cddc536ea6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32309669"
---
# <a name="imsproviderlogon"></a><span data-ttu-id="89a6b-103">IMSProvider::Logon</span><span class="sxs-lookup"><span data-stu-id="89a6b-103">IMSProvider::Logon</span></span>

  
  
<span data-ttu-id="89a6b-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="89a6b-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="89a6b-105">Регистрирует MAPI на одном экземпляре поставщика хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-105">Logs MAPI on to one instance of a message store provider.</span></span>
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulFlags,
  LPCIID lpInterface,
  ULONG FAR * lpcbSpoolSecurity,
  LPBYTE FAR * lppbSpoolSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPMSLOGON FAR * lppMSLogon,
  LPMDB FAR * lppMDB
);
```

## <a name="parameters"></a><span data-ttu-id="89a6b-106">Параметры</span><span class="sxs-lookup"><span data-stu-id="89a6b-106">Parameters</span></span>

 <span data-ttu-id="89a6b-107">_лпмаписуп_</span><span class="sxs-lookup"><span data-stu-id="89a6b-107">_lpMAPISup_</span></span>
  
> <span data-ttu-id="89a6b-108">возврата Указатель на текущий объект поддержки MAPI для хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-108">[in] A pointer to the current MAPI support object for the message store.</span></span>
    
 <span data-ttu-id="89a6b-109">_улуипарам_</span><span class="sxs-lookup"><span data-stu-id="89a6b-109">_ulUIParam_</span></span>
  
> <span data-ttu-id="89a6b-110">возврата Дескриптор родительского окна любых диалоговых окон или окон, которые отображает этот метод.</span><span class="sxs-lookup"><span data-stu-id="89a6b-110">[in] A handle to the parent window of any dialog boxes or windows this method displays.</span></span> 
    
 <span data-ttu-id="89a6b-111">_лпсзпрофиленаме_</span><span class="sxs-lookup"><span data-stu-id="89a6b-111">_lpszProfileName_</span></span>
  
> <span data-ttu-id="89a6b-112">возврата Указатель на строку, содержащую имя профиля, используемого для входа в систему поставщика хранилища.</span><span class="sxs-lookup"><span data-stu-id="89a6b-112">[in] A pointer to a string that contains the name of the profile being used for store provider logon.</span></span> <span data-ttu-id="89a6b-113">Эта строка может отображаться в диалоговых окнах, записанных в файл журнала или просто игнорироваться.</span><span class="sxs-lookup"><span data-stu-id="89a6b-113">This string can be displayed in dialog boxes, written out to a log file, or simply ignored.</span></span> <span data-ttu-id="89a6b-114">Он должен быть в формате Юникод, если установлен флаг MAPI_UNICODE в параметре _ulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="89a6b-114">It must be in Unicode format if the MAPI_UNICODE flag is set in the  _ulFlags_ parameter.</span></span> 
    
 <span data-ttu-id="89a6b-115">_кбентрид_</span><span class="sxs-lookup"><span data-stu-id="89a6b-115">_cbEntryID_</span></span>
  
> <span data-ttu-id="89a6b-116">возврата Размер (в байтах) идентификатора записи, на который указывает параметр _лпентрид_ .</span><span class="sxs-lookup"><span data-stu-id="89a6b-116">[in] The size, in bytes, of the entry identifier pointed to by the  _lpEntryID_ parameter.</span></span> 
    
 <span data-ttu-id="89a6b-117">_лпентрид_</span><span class="sxs-lookup"><span data-stu-id="89a6b-117">_lpEntryID_</span></span>
  
> <span data-ttu-id="89a6b-118">возврата Указатель на идентификатор записи для хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-118">[in] A pointer to the entry identifier for the message store.</span></span> <span data-ttu-id="89a6b-119">При передаче **значения NULL** в _лпентрид_ показывается, что хранилище сообщений еще не выбрано и диалоговые окна, позволяющие пользователю выбрать хранилище сообщений, могут быть представлены.</span><span class="sxs-lookup"><span data-stu-id="89a6b-119">Passing **null** in  _lpEntryID_ indicates that a message store has not yet been selected and that dialog boxes that enable the user to select a message store can be presented.</span></span> 
    
 <span data-ttu-id="89a6b-120">_ulFlags_</span><span class="sxs-lookup"><span data-stu-id="89a6b-120">_ulFlags_</span></span>
  
> <span data-ttu-id="89a6b-121">возврата Битовая маска флагов, определяющая способ выполнения входа.</span><span class="sxs-lookup"><span data-stu-id="89a6b-121">[in] A bitmask of flags that controls how the logon is performed.</span></span> <span data-ttu-id="89a6b-122">Можно задать следующие флаги:</span><span class="sxs-lookup"><span data-stu-id="89a6b-122">The following flags can be set:</span></span>
    
<span data-ttu-id="89a6b-123">MAPI_DEFERRED_ERRORS</span><span class="sxs-lookup"><span data-stu-id="89a6b-123">MAPI_DEFERRED_ERRORS</span></span> 
  
> <span data-ttu-id="89a6b-124">Вызов может быть выполнен, даже если базовый объект недоступен для вызывающей реализации.</span><span class="sxs-lookup"><span data-stu-id="89a6b-124">The call is allowed to succeed even if the underlying object is not available to the calling implementation.</span></span> <span data-ttu-id="89a6b-125">Если объект недоступен, последующий вызов объекта может вызвать ошибку.</span><span class="sxs-lookup"><span data-stu-id="89a6b-125">If the object is not available, a subsequent call to the object might raise an error.</span></span>
    
<span data-ttu-id="89a6b-126">MAPI_UNICODE</span><span class="sxs-lookup"><span data-stu-id="89a6b-126">MAPI_UNICODE</span></span> 
  
> <span data-ttu-id="89a6b-127">Переданные строки имеют формат Юникод.</span><span class="sxs-lookup"><span data-stu-id="89a6b-127">The passed-in strings are in Unicode format.</span></span> <span data-ttu-id="89a6b-128">Если MAPI_UNICODE не заданы, строки представлены в формате ANSI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-128">If MAPI_UNICODE is not set, the strings are in ANSI format.</span></span>
    
<span data-ttu-id="89a6b-129">MDB_NO_DIALOG</span><span class="sxs-lookup"><span data-stu-id="89a6b-129">MDB_NO_DIALOG</span></span> 
  
> <span data-ttu-id="89a6b-130">Запрещает отображение диалоговых окон входа в систему.</span><span class="sxs-lookup"><span data-stu-id="89a6b-130">Prevents the display of logon dialog boxes.</span></span> <span data-ttu-id="89a6b-131">Если этот флаг установлен, значение ошибки MAPI_E_LOGON_FAILED возвращается в случае неудачного входа.</span><span class="sxs-lookup"><span data-stu-id="89a6b-131">If this flag is set, the error value MAPI_E_LOGON_FAILED is returned if the logon is unsuccessful.</span></span> <span data-ttu-id="89a6b-132">Если этот флаг не задан, поставщик хранилища сообщений может предложить пользователю исправить имя или пароль, вставить диск или выполнить другие действия, необходимые для подключения к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="89a6b-132">If this flag is not set, the message store provider can prompt the user to correct a name or password, to insert a disk, or to perform other actions that are necessary to establish connection to the store.</span></span>
    
<span data-ttu-id="89a6b-133">MDB_NO_MAIL</span><span class="sxs-lookup"><span data-stu-id="89a6b-133">MDB_NO_MAIL</span></span> 
  
> <span data-ttu-id="89a6b-134">Хранилище сообщений не следует использовать для отправки и получения почты.</span><span class="sxs-lookup"><span data-stu-id="89a6b-134">The message store should not be used for sending or receiving mail.</span></span> <span data-ttu-id="89a6b-135">Флаг сигнализирует MAPI, что он не уведомляет Диспетчер очереди MAPI о том, что это хранилище сообщений открыто.</span><span class="sxs-lookup"><span data-stu-id="89a6b-135">The flag signals MAPI not to notify the MAPI spooler that this message store is being opened.</span></span> <span data-ttu-id="89a6b-136">Если этот флаг установлен и банк сообщений тесно связан с поставщиком транспорта, поставщику не требуется вызывать метод [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-136">If this flag is set and the message store is tightly coupled with a transport provider, the provider does not need to call the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method.</span></span> 
    
<span data-ttu-id="89a6b-137">MDB_TEMPORARY</span><span class="sxs-lookup"><span data-stu-id="89a6b-137">MDB_TEMPORARY</span></span> 
  
> <span data-ttu-id="89a6b-138">Заносит в журнал данные, чтобы данные можно было получать программно из раздела profile без использования диалоговых окон.</span><span class="sxs-lookup"><span data-stu-id="89a6b-138">Logs on the store so that information can be retrieved programmatically from the profile section, without use of dialog boxes.</span></span> <span data-ttu-id="89a6b-139">Этот флаг указывает MAPI, что хранилище не добавляется в таблицу хранилища сообщений, и что хранилище невозможно сделать необратимым.</span><span class="sxs-lookup"><span data-stu-id="89a6b-139">This flag instructs MAPI that the store is not to be added to the message store table and that the store cannot be made permanent.</span></span> <span data-ttu-id="89a6b-140">Если этот флаг установлен, поставщикам хранилища сообщений не требуется вызывать метод [имаписуппорт:: модифипрофиле](imapisupport-modifyprofile.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-140">If this flag is set, message store providers do not need to call the [IMAPISupport::ModifyProfile](imapisupport-modifyprofile.md) method.</span></span> 
    
<span data-ttu-id="89a6b-141">MDB_WRITE</span><span class="sxs-lookup"><span data-stu-id="89a6b-141">MDB_WRITE</span></span> 
  
> <span data-ttu-id="89a6b-142">Запрашивает разрешение на чтение и запись.</span><span class="sxs-lookup"><span data-stu-id="89a6b-142">Requests read/write permission.</span></span>
    
 <span data-ttu-id="89a6b-143">_лпинтерфаце_</span><span class="sxs-lookup"><span data-stu-id="89a6b-143">_lpInterface_</span></span>
  
> <span data-ttu-id="89a6b-144">возврата Указатель на идентификатор интерфейса (IID) для подключения к хранилищу сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-144">[in] A pointer to the interface identifier (IID) for the message store to log on to.</span></span> <span data-ttu-id="89a6b-145">Передача **значения NULL** указывает, что возвращается интерфейс MAPI для хранилища сообщений ( [IMsgStore](imsgstoreimapiprop.md)).</span><span class="sxs-lookup"><span data-stu-id="89a6b-145">Passing **null** indicates the MAPI interface for the message store ( [IMsgStore](imsgstoreimapiprop.md)) is returned.</span></span> <span data-ttu-id="89a6b-146">Для параметра _лпинтерфаце_ также можно задать идентификатор соответствующего интерфейса для хранилища сообщений (например, IID_IUnknown или IID_IMAPIProp).</span><span class="sxs-lookup"><span data-stu-id="89a6b-146">The  _lpInterface_ parameter can also be set to an identifier for an appropriate interface for the message store (for example, IID_IUnknown or IID_IMAPIProp).</span></span> 
    
 <span data-ttu-id="89a6b-147">_лпкбспулсекурити_</span><span class="sxs-lookup"><span data-stu-id="89a6b-147">_lpcbSpoolSecurity_</span></span>
  
> <span data-ttu-id="89a6b-148">вышли Указатель на переменную, в которой поставщик хранилища возвращает размер данных проверки (в байтах) в параметре _лппбспулсекурити_ .</span><span class="sxs-lookup"><span data-stu-id="89a6b-148">[out] A pointer to the variable in which the store provider returns the size, in bytes, of the validation data in the  _lppbSpoolSecurity_ parameter.</span></span> 
    
 <span data-ttu-id="89a6b-149">_лппбспулсекурити_</span><span class="sxs-lookup"><span data-stu-id="89a6b-149">_lppbSpoolSecurity_</span></span>
  
> <span data-ttu-id="89a6b-150">вышли Указатель на указатель на возвращенные данные проверки.</span><span class="sxs-lookup"><span data-stu-id="89a6b-150">[out] A pointer to the pointer to the returned validation data.</span></span> <span data-ttu-id="89a6b-151">Эти данные проверки предоставляются, поэтому метод [функцииimsprovider:: спулерлогон](imsprovider-spoolerlogon.md) может записать Диспетчер очереди MAPI в то же хранилище, что и поставщик хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-151">This validation data is provided so the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method can log the MAPI spooler on to the same store as the message store provider.</span></span> 
    
 <span data-ttu-id="89a6b-152">_лппмапиеррор_</span><span class="sxs-lookup"><span data-stu-id="89a6b-152">_lppMAPIError_</span></span>
  
> <span data-ttu-id="89a6b-153">вышли Указатель на указатель на возвращенную структуру [мапиеррор](mapierror.md) (при наличии), содержащую сведения о версии, компоненте и контексте ошибки.</span><span class="sxs-lookup"><span data-stu-id="89a6b-153">[out] A pointer to a pointer to the returned [MAPIERROR](mapierror.md) structure, if any, that contains version, component, and context information for an error.</span></span> <span data-ttu-id="89a6b-154">Параметр _лппмапиеррор_ может иметь значение **null** , если структура **мапиеррор** для возврата отсутствует.</span><span class="sxs-lookup"><span data-stu-id="89a6b-154">The  _lppMAPIError_ parameter can be set to **null** if there is no **MAPIERROR** structure to return.</span></span> 
    
 <span data-ttu-id="89a6b-155">_лппмслогон_</span><span class="sxs-lookup"><span data-stu-id="89a6b-155">_lppMSLogon_</span></span>
  
> <span data-ttu-id="89a6b-156">вышли Указатель на указатель на объект входа хранилища сообщений для входа MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-156">[out] A pointer to the pointer to the message store logon object for MAPI to log on to.</span></span>
    
 <span data-ttu-id="89a6b-157">_лппмдб_</span><span class="sxs-lookup"><span data-stu-id="89a6b-157">_lppMDB_</span></span>
  
> <span data-ttu-id="89a6b-158">вышли Указатель на указатель на объект хранилища сообщений для системы буферизации MAPI и клиентских приложений для входа в.</span><span class="sxs-lookup"><span data-stu-id="89a6b-158">[out] A pointer to the pointer to the message store object for the MAPI spooler and client applications to log on to.</span></span>
    
## <a name="return-value"></a><span data-ttu-id="89a6b-159">Возвращаемое значение</span><span class="sxs-lookup"><span data-stu-id="89a6b-159">Return value</span></span>

<span data-ttu-id="89a6b-160">S_OK</span><span class="sxs-lookup"><span data-stu-id="89a6b-160">S_OK</span></span> 
  
> <span data-ttu-id="89a6b-161">����� ������� � ������ ��������� ��������� ��� ��������.</span><span class="sxs-lookup"><span data-stu-id="89a6b-161">The call succeeded and has returned the expected value or values.</span></span>
    
<span data-ttu-id="89a6b-162">MAPI_E_FAILONEPROVIDER</span><span class="sxs-lookup"><span data-stu-id="89a6b-162">MAPI_E_FAILONEPROVIDER</span></span> 
  
> <span data-ttu-id="89a6b-163">Этот поставщик не может выполнить вход, но эта ошибка не должна отключать службу.</span><span class="sxs-lookup"><span data-stu-id="89a6b-163">This provider cannot log on, but this error should not disable the service.</span></span> 
    
<span data-ttu-id="89a6b-164">MAPI_E_LOGON_FAILED</span><span class="sxs-lookup"><span data-stu-id="89a6b-164">MAPI_E_LOGON_FAILED</span></span> 
  
> <span data-ttu-id="89a6b-165">Не удалось установить сеанс входа в систему.</span><span class="sxs-lookup"><span data-stu-id="89a6b-165">A logon session could not be established.</span></span>
    
<span data-ttu-id="89a6b-166">MAPI_E_UNCONFIGURED</span><span class="sxs-lookup"><span data-stu-id="89a6b-166">MAPI_E_UNCONFIGURED</span></span> 
  
> <span data-ttu-id="89a6b-167">Профиль не содержит достаточно сведений для завершения входа.</span><span class="sxs-lookup"><span data-stu-id="89a6b-167">The profile does not contain enough information for the logon to complete.</span></span> <span data-ttu-id="89a6b-168">Когда возвращается это значение, MAPI вызывает функцию точки входа службы сообщений для поставщика хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-168">When this value is returned, MAPI calls the message store provider's message-service entry point function.</span></span>
    
<span data-ttu-id="89a6b-169">MAPI_E_USER_CANCEL</span><span class="sxs-lookup"><span data-stu-id="89a6b-169">MAPI_E_USER_CANCEL</span></span> 
  
> <span data-ttu-id="89a6b-170">Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне.</span><span class="sxs-lookup"><span data-stu-id="89a6b-170">The user canceled the operation, typically by clicking the **Cancel** button in a dialog box.</span></span> 
    
<span data-ttu-id="89a6b-171">MAPI_E_UNKNOWN_CPID</span><span class="sxs-lookup"><span data-stu-id="89a6b-171">MAPI_E_UNKNOWN_CPID</span></span> 
  
> <span data-ttu-id="89a6b-172">Сервер не настроен для поддержки кодовой страницы клиента.</span><span class="sxs-lookup"><span data-stu-id="89a6b-172">The server is not configured to support the client's code page.</span></span>
    
<span data-ttu-id="89a6b-173">MAPI_E_UNKNOWN_LCID</span><span class="sxs-lookup"><span data-stu-id="89a6b-173">MAPI_E_UNKNOWN_LCID</span></span> 
  
> <span data-ttu-id="89a6b-174">Сервер не настроен для поддержки информации о языковых стандартах клиента.</span><span class="sxs-lookup"><span data-stu-id="89a6b-174">The server is not configured to support the client's locale information.</span></span>
    
<span data-ttu-id="89a6b-175">MAPI_W_ERRORS_RETURNED</span><span class="sxs-lookup"><span data-stu-id="89a6b-175">MAPI_W_ERRORS_RETURNED</span></span> 
  
> <span data-ttu-id="89a6b-176">Вызов выполнен успешно, но у поставщика хранилища сообщений есть доступные сведения об ошибке.</span><span class="sxs-lookup"><span data-stu-id="89a6b-176">The call succeeded, but the message store provider has error information available.</span></span> <span data-ttu-id="89a6b-177">При возвращении этого предупреждения вызов должен обрабатываться как успешный.</span><span class="sxs-lookup"><span data-stu-id="89a6b-177">When this warning is returned, the call should be handled as successful.</span></span> <span data-ttu-id="89a6b-178">Чтобы проверить это предупреждение, используйте макрос **HR_FAILED** .</span><span class="sxs-lookup"><span data-stu-id="89a6b-178">To test for this warning, use the **HR_FAILED** macro.</span></span> <span data-ttu-id="89a6b-179">Дополнительные сведения см. [в разделе Использование макросов для обработки ошибок](using-macros-for-error-handling.md).</span><span class="sxs-lookup"><span data-stu-id="89a6b-179">For more information, see [Using Macros for Error Handling](using-macros-for-error-handling.md).</span></span> <span data-ttu-id="89a6b-180">Чтобы получить сведения об ошибке от поставщика, вызовите метод [IMAPISession:: GetLastError](imapisession-getlasterror.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-180">To get the error information from the provider, call the [IMAPISession::GetLastError](imapisession-getlasterror.md) method.</span></span> 
    
## <a name="remarks"></a><span data-ttu-id="89a6b-181">Примечания</span><span class="sxs-lookup"><span data-stu-id="89a6b-181">Remarks</span></span>

<span data-ttu-id="89a6b-182">MAPI вызывает метод **функцииimsprovider:: logon** для выполнения большинства действий, необходимых для получения доступа к хранилищу сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-182">MAPI calls the **IMSProvider::Logon** method to do the majority of processing necessary to obtain access to a message store.</span></span> <span data-ttu-id="89a6b-183">Поставщики хранилищ сообщений проверяйте все учетные данные пользователя, необходимые для доступа к определенному хранилищу, и возвращают объект хранилища сообщений в параметре _лппмдб_ , на который могут входить клиент и клиентские приложения.</span><span class="sxs-lookup"><span data-stu-id="89a6b-183">Message store providers validate any user credentials necessary to access a particular store and return a message store object in the  _lppMDB_ parameter that the MAPI spooler and client applications can log on to.</span></span> 
  
<span data-ttu-id="89a6b-184">В дополнение к возвращенному объекту хранилища сообщений для использования диспетчером очереди для клиента и MAPI поставщик также возвращает объект входа в хранилище сообщений для MAPI, используемый для управления открытым хранилищем.</span><span class="sxs-lookup"><span data-stu-id="89a6b-184">In addition to the returned message store object for client and MAPI spooler use, the provider also returns a message store logon object for MAPI to use in controlling the opened store.</span></span> <span data-ttu-id="89a6b-185">Объект входа в хранилище сообщений и объект хранилища сообщений должны быть тесно связаны внутри поставщика хранилища сообщений, поэтому каждое из них может повлиять на другой.</span><span class="sxs-lookup"><span data-stu-id="89a6b-185">The message store logon object and the message store object should be tightly linked inside the message store provider so each can affect the other.</span></span> <span data-ttu-id="89a6b-186">Использование объекта Store и объекта logon должно быть одинаковым; между объектом logon и объектом Store должно быть отношение "один к одному", чтобы объекты действовали так, как если бы они были одним объектом, который предоставляет два интерфейса.</span><span class="sxs-lookup"><span data-stu-id="89a6b-186">The use of the store object and the logon object should be identical; there should be a one-to-one correspondence between the logon object and the store object such that the objects act as if they are one object that exposes two interfaces.</span></span> <span data-ttu-id="89a6b-187">Оба объекта также должны быть созданы вместе и освобождены вместе.</span><span class="sxs-lookup"><span data-stu-id="89a6b-187">The two objects should also be created together and freed together.</span></span> 
  
<span data-ttu-id="89a6b-188">Объект поддержки MAPI, созданный MAPI и передаваемый поставщику в параметре _лпмаписуп_ , обеспечивает доступ к функциям MAPI, которые необходимы поставщику.</span><span class="sxs-lookup"><span data-stu-id="89a6b-188">The MAPI support object, created by MAPI and passed to the provider in the  _lpMAPISup_ parameter, provides access to functions in MAPI that the provider requires.</span></span> <span data-ttu-id="89a6b-189">Сюда входят функции, которые сохраняют и извлекают сведения о профиле, обращаются к адресным книгам и т. д.</span><span class="sxs-lookup"><span data-stu-id="89a6b-189">These include functions that save and retrieve profile information, access address books, and so on.</span></span> <span data-ttu-id="89a6b-190">Указатель _лпмаписуп_ может различаться для каждого открываемого хранилища.</span><span class="sxs-lookup"><span data-stu-id="89a6b-190">The  _lpMAPISup_ pointer can be different for each store that is opened.</span></span> <span data-ttu-id="89a6b-191">При обработке вызовов для хранилища сообщений после входа поставщик магазина должен использовать переменную _лпмаписуп_ , относящуюся к этому хранилищу.</span><span class="sxs-lookup"><span data-stu-id="89a6b-191">While processing calls for a message store after logon, the store provider should use the  _lpMAPISup_ variable that is specific to that store.</span></span> <span data-ttu-id="89a6b-192">Для любого **вызова** , которое открывает хранилище сообщений и успешно создает объект входа в хранилище сообщений, поставщик должен сохранить указатель на объект поддержки MAPI в объекте Store logon и вызвать метод [IUnknown:: AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) , чтобы добавить ссылку для объекта support.</span><span class="sxs-lookup"><span data-stu-id="89a6b-192">For any **Logon** call that opens a message store and succeeds in creating a message store logon object, the provider must save a pointer to the MAPI support object in the store logon object and must call the [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) method to add a reference for the support object.</span></span> 
  
<span data-ttu-id="89a6b-193">Параметр _улуипарам_ следует использовать, если поставщик представляет диалоговые окна во время вызова **входа** .</span><span class="sxs-lookup"><span data-stu-id="89a6b-193">The  _ulUIParam_ parameter should be used if the provider presents dialog boxes during the **Logon** call.</span></span> <span data-ttu-id="89a6b-194">Тем не менее диалоговые окна не отображаются, если _ulFlags_ содержит флаг MDB_NO_DIALOG.</span><span class="sxs-lookup"><span data-stu-id="89a6b-194">However, dialog boxes should not be presented if  _ulFlags_ contains the MDB_NO_DIALOG flag.</span></span> <span data-ttu-id="89a6b-195">Если пользовательский интерфейс необходимо вызвать, но _ulFlags_ не разрешает его, или если по какой – либо иной причине интерфейс пользователя не может быть отображен, поставщик должен возвратить MAPI_E_LOGON_FAILED.</span><span class="sxs-lookup"><span data-stu-id="89a6b-195">If a user interface needs to be called but  _ulFlags_ does not allow it, or if for some other reason a user interface cannot be displayed, the provider should return MAPI_E_LOGON_FAILED.</span></span> <span data-ttu-id="89a6b-196">Если при **входе** отображается диалоговое окно, а пользователь отменяет вход в систему, как правило, при нажатии кнопки **Отмена** диалогового окна поставщик должен возвратить MAPI_E_USER_CANCEL.</span><span class="sxs-lookup"><span data-stu-id="89a6b-196">If **Logon** displays a dialog box and the user cancels the logon, typically by clicking the dialog box's **Cancel** button, the provider should return MAPI_E_USER_CANCEL.</span></span> 
  
<span data-ttu-id="89a6b-197">Параметр _лпентрид_ может иметь **значение NULL** или указывать на неупакованный идентификатор записи в хранилище сообщений, созданном ранее.</span><span class="sxs-lookup"><span data-stu-id="89a6b-197">The  _lpEntryID_ parameter can either be **null** or point to an unwrapped store entry identifier that this message store previously created.</span></span> <span data-ttu-id="89a6b-198">Если _лпентрид_ указывает на неупакованный идентификатор записи, этот идентификатор может быть получен из одного из следующих мест:</span><span class="sxs-lookup"><span data-stu-id="89a6b-198">If  _lpEntryID_ points to an unwrapped entry identifier, that entry identifier can come from one of several places:</span></span> 
  
- <span data-ttu-id="89a6b-199">Это может быть идентификатор записи, который ранее обернут и написал поставщик хранилища в раздел профиля как свойство **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="89a6b-199">It can be an entry identifier that the store provider previously wrapped and wrote to the profile section as a **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) property.</span></span>
    
- <span data-ttu-id="89a6b-200">Это может быть идентификатор записи, который был ранее упакован и возвращен в вызывающий клиент как свойство **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="89a6b-200">It can be an entry identifier that the provider previously wrapped and returned to a calling client as a **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) property.</span></span> 
    
- <span data-ttu-id="89a6b-201">Это может быть идентификатор записи, который был ранее упакован и возвращен в вызывающий клиент в качестве свойства **PR_ENTRYID** объекта хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-201">It can be an entry identifier that the provider previously wrapped and returned to a calling client as the **PR_ENTRYID** property of a message store object.</span></span> 
    
<span data-ttu-id="89a6b-202">В любом из этих случаев возможно, что идентификатор записи был создан на компьютере, отличном от используемого в данный момент.</span><span class="sxs-lookup"><span data-stu-id="89a6b-202">In any of these cases, it is possible that the entry identifier was created on a different computer than the one currently being used.</span></span>
  
<span data-ttu-id="89a6b-203">Если _лпентрид_ имеет значение, отличное от **null**, оно должно содержать все сведения, необходимые для идентификации и поиска хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="89a6b-203">When  _lpEntryID_ is not **null**, it should contain all of the information needed to identify and locate the message store.</span></span> <span data-ttu-id="89a6b-204">Эти сведения могут включать имена сетевых томов, Номера телефонов, имена учетных записей пользователей и т. д.</span><span class="sxs-lookup"><span data-stu-id="89a6b-204">This information can include network volume names, phone numbers, user account names, and so on.</span></span> <span data-ttu-id="89a6b-205">Если подключение к хранилищу невозможно выполнить с помощью данных в идентификаторе записи, поставщик магазина должен отобразить диалоговое окно, которое позволяет пользователю выбрать открываемое хранилище.</span><span class="sxs-lookup"><span data-stu-id="89a6b-205">If the connection to the store cannot be made by using the data in the entry identifier, the store provider should display a dialog box that enables the user to select the store to be opened.</span></span> <span data-ttu-id="89a6b-206">Может потребоваться диалоговое окно, например, если сервер был переименован, имя учетной записи изменилось или часть сети недоступна.</span><span class="sxs-lookup"><span data-stu-id="89a6b-206">A dialog box might be required, for example, if a server has been renamed, an account name has changed, or portions of the network are not available.</span></span>
  
<span data-ttu-id="89a6b-207">Если _лпентрид_ имеет **значение NULL**, то хранилище сообщений пока не выбрано.</span><span class="sxs-lookup"><span data-stu-id="89a6b-207">When  _lpEntryID_ is **null**, the message store to use has not yet been selected.</span></span> <span data-ttu-id="89a6b-208">Поставщик по-прежнему может получить доступ к хранилищу без отображения диалогового окна, если он поддерживает дальнейшие действия для указания хранилища.</span><span class="sxs-lookup"><span data-stu-id="89a6b-208">The provider can still access a store without displaying a dialog box if it supports further methods to specify the store.</span></span> <span data-ttu-id="89a6b-209">Например, поставщик может проверить файл инициализации или выполнить поиск дополнительных свойств, которые были размещены в разделе профиля службы сообщений в конфигурации.</span><span class="sxs-lookup"><span data-stu-id="89a6b-209">For example, the provider can check its initialization file, or it can look for additional properties that were placed in its or its message service's profile section at configuration.</span></span>
  
<span data-ttu-id="89a6b-210">Если поставщик обнаружит, что все необходимые сведения отсутствуют в профиле, возвращается MAPI_E_UNCONFIGURED.</span><span class="sxs-lookup"><span data-stu-id="89a6b-210">If a provider finds that all the required information is not in the profile, it should return MAPI_E_UNCONFIGURED.</span></span> <span data-ttu-id="89a6b-211">Затем MAPI выполнит функцию точки входа службы сообщений поставщика, чтобы позволить пользователю выбрать хранилище или даже создать его и ввести имя и пароль учетной записи по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="89a6b-211">MAPI will then call the provider's message service entry point function to enable the user to select a store, or even to create one, and to enter an account name and password, as needed.</span></span> <span data-ttu-id="89a6b-212">MAPI автоматически создает новый раздел профиля для нового хранилища; Этот новый раздел профиля может быть временным или постоянным в зависимости от того, как он был добавлен.</span><span class="sxs-lookup"><span data-stu-id="89a6b-212">MAPI automatically creates a new profile section for a new store; this new profile section can be temporary or permanent, depending on how it has been added.</span></span> <span data-ttu-id="89a6b-213">Если поставщик услуг хранения вызывает метод **имаписуппорт:: модифипрофиле** , новый раздел профиля становится постоянным и хранилище добавляется в список хранилищ сообщений, возвращаемых методом [IMAPISession:: жетмсгсторестабле](imapisession-getmsgstorestable.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-213">If the store provider calls the **IMAPISupport::ModifyProfile** method, the new profile section becomes permanent and the store is added to the list of message stores returned by the [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) method.</span></span> 
  
<span data-ttu-id="89a6b-214">Параметр _лпинтерфаце_ указывает IID интерфейса, необходимого для вновь открытого объекта Store.</span><span class="sxs-lookup"><span data-stu-id="89a6b-214">The  _lpInterface_ parameter specifies the IID of the interface required for the newly opened store object.</span></span> <span data-ttu-id="89a6b-215">При передаче **значения NULL** в _лпинтерфаце_ указывается, что необходим интерфейс хранилища сообщений MAPI, **IMsgStore**.</span><span class="sxs-lookup"><span data-stu-id="89a6b-215">Passing **null** in  _lpInterface_ specifies that the MAPI message store interface, **IMsgStore**, is required.</span></span> <span data-ttu-id="89a6b-216">При передаче объекта хранилища сообщений IID_IMsgStore также указывается, что **IMsgStore** является обязательным.</span><span class="sxs-lookup"><span data-stu-id="89a6b-216">Passing the message store object, IID_IMsgStore, also specifies that **IMsgStore** is required.</span></span> <span data-ttu-id="89a6b-217">Если IID_IUnknown передается в _лпинтерфаце_, то поставщик должен открыть хранилище с помощью любого интерфейса, производного от [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) , для поставщика (опять-то, как правило, это **IMsgStore**).</span><span class="sxs-lookup"><span data-stu-id="89a6b-217">If IID_IUnknown is passed in  _lpInterface_, the provider should open the store by using whatever interface derived from [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) is best for the provider (again, this is typically **IMsgStore**).</span></span> <span data-ttu-id="89a6b-218">При передаче IID_IUnknown реализация вызывает метод [IUnknown:: QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) , чтобы выбрать интерфейс после успешного выполнения операции Store Open.</span><span class="sxs-lookup"><span data-stu-id="89a6b-218">When IID_IUnknown is passed, the calling implementation uses the [IUnknown::QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) method to select an interface after the store open operation succeeds.</span></span> 
  
<span data-ttu-id="89a6b-219">Вызов **функцииimsprovider:: logon** должен возвращать достаточно информации, например путь к хранилищу и учетные данные для доступа к хранилищу, чтобы диспетчер очереди MAPI мог выполнить вход в то же хранилище, что и поставщик хранилища, не выполняя показ диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="89a6b-219">The **IMSProvider::Logon** call should return sufficient information, such as a path to the store and credentials for accessing the store, to allow the MAPI spooler to log on to the same store that the store provider does without presenting a dialog box.</span></span> <span data-ttu-id="89a6b-220">Для возврата этих сведений используются параметры _лпкбспулсекурити_ и _лппбспулсекурити_ .</span><span class="sxs-lookup"><span data-stu-id="89a6b-220">The  _lpcbSpoolSecurity_ and  _lppbSpoolSecurity_ parameters are used to return this information.</span></span> <span data-ttu-id="89a6b-221">Поставщик выделяет память для этих данных, передавая указатель на буфер в параметре _лпфаллокатебуффер_ функции [мспровидеринит](msproviderinit.md) . Поставщик поместит размер этого буфера в _лпкбспулсекурити_.</span><span class="sxs-lookup"><span data-stu-id="89a6b-221">The provider allocates the memory for this data by passing a pointer to a buffer in the [MSProviderInit](msproviderinit.md) function's  _lpfAllocateBuffer_ parameter; the provider places the size of this buffer in  _lpcbSpoolSecurity_.</span></span> 
  
<span data-ttu-id="89a6b-222">При необходимости этот буфер освобождается MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-222">MAPI frees this buffer when appropriate.</span></span> <span data-ttu-id="89a6b-223">Если вход в магазин с помощью диспетчера MAPI может осуществляться только из сведений в разделе профиля, поставщик может вернуть значение NULL в _лппбспулсекурити_ и 0 для размера данных в _лпкбспулсекурити_.</span><span class="sxs-lookup"><span data-stu-id="89a6b-223">If the MAPI spooler's logon to the store can be accomplished from the information in the profile section alone, the provider can return null in  _lppbSpoolSecurity_ and 0 for the information's size in  _lpcbSpoolSecurity_.</span></span> <span data-ttu-id="89a6b-224">Вход в систему почтовых подстановки MAPI выполняется как часть процесса, отличного от процесса входа в хранилище; так как буфер, содержащий переданные сведения, копируется между процессами, он может не находиться в памяти в том же расположении, что и процесс поставщика хранилища MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-224">The MAPI spooler logon occurs as part of a different process than the store logon; because the buffer that contains the passed information gets copied between processes, it might not be in memory at the same location for the MAPI spooler process as for the store provider process.</span></span> <span data-ttu-id="89a6b-225">Таким образом, поставщик не должен помещать адреса в этот буфер.</span><span class="sxs-lookup"><span data-stu-id="89a6b-225">Therefore, a provider shouldn't put addresses into this buffer.</span></span> <span data-ttu-id="89a6b-226">Дополнительные сведения о входе в систему почтовых [функцииimsprovider:: спулерлогон](imsprovider-spoolerlogon.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-226">For more information about MAPI spooler logon, see the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method.</span></span> 
  
<span data-ttu-id="89a6b-227">Большинство поставщиков магазинов используют метод [IMAPISession:: опенпрофилесектион](imapisession-openprofilesection.md) объекта support, переданный в параметре _лпмаписуп_ для сохранения и получения учетных данных и параметров пользователя.</span><span class="sxs-lookup"><span data-stu-id="89a6b-227">Most store providers use the [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) method of the support object passed in the  _lpMAPISup_ parameter for saving and retrieving user credentials and options.</span></span> <span data-ttu-id="89a6b-228">**Опенпрофилесектион** позволяет поставщику услуг хранения сохранять дополнительные сведения в разделе профиля и связывать его с определенным ресурсом.</span><span class="sxs-lookup"><span data-stu-id="89a6b-228">**OpenProfileSection** enables a store provider to save additional arbitrary information in a profile section and associate it with a particular resource.</span></span> <span data-ttu-id="89a6b-229">Например, поставщик хранилища может сохранить имя и пароль учетной записи пользователя, связанные с ресурсом, а также любые пути и другие сведения, необходимые для доступа к этому ресурсу.</span><span class="sxs-lookup"><span data-stu-id="89a6b-229">For example, a store provider can save the user account name and password associated with a resource and any paths or other information needed to access that resource.</span></span> 
  
<span data-ttu-id="89a6b-230">Свойства с идентификаторами свойств, 0x6600 через 0x67FF, — это безопасные свойства, доступные поставщику для собственного использования для хранения конфиденциальных данных в разделах Profile.</span><span class="sxs-lookup"><span data-stu-id="89a6b-230">Properties with property identifiers 0x6600 through 0x67FF are secure properties available to the provider for its own use to store private data in profile sections.</span></span> <span data-ttu-id="89a6b-231">Дополнительные сведения об использовании свойств в объектах разделов профилей см в методе [ипрофсект: IMAPIProp](iprofsectimapiprop.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-231">For more information about the uses of properties in profile section objects, see the [IProfSect : IMAPIProp](iprofsectimapiprop.md) method.</span></span> 
  
<span data-ttu-id="89a6b-232">В дополнение к личным данным в свойствах с идентификаторами 0x6600 через 0x67FF, поставщик магазина должен предоставить сведения для свойства **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) в разделе профиля.</span><span class="sxs-lookup"><span data-stu-id="89a6b-232">In addition to any private data in properties with identifiers 0x6600 through 0x67FF, the store provider should provide information for the **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in its profile section.</span></span> <span data-ttu-id="89a6b-233">Он должен размещаться в **PR_DISPLAY_NAME** отображаемого имени самого поставщика — идентифицирующей строки (например, "Банк личных данных Майкрософт"), которая отображается для пользователей, чтобы пользователи могли отличать это хранилище сообщений от других пользователей, к которым у них может быть доступ.</span><span class="sxs-lookup"><span data-stu-id="89a6b-233">It should put in **PR_DISPLAY_NAME** the display name of the provider itself — an identifying string (for example, "Microsoft Personal Information Store") that is displayed to users so they can distinguish this message store from others they might have access to.</span></span> <span data-ttu-id="89a6b-234">**PR_DISPLAY_NAME** часто содержит имя сервера, имя учетной записи пользователя или путь.</span><span class="sxs-lookup"><span data-stu-id="89a6b-234">**PR_DISPLAY_NAME** commonly contains a server name, user account name, or path.</span></span> 
  
<span data-ttu-id="89a6b-235">Некоторые свойства раздела профиля отображаются в таблице хранилища сообщений; другие пользователи отображаются во время установки, установки и настройки подсистемы MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-235">Some profile section properties are visible in the message store table; others are visible during setup, installation, and configuration of the MAPI subsystem.</span></span> <span data-ttu-id="89a6b-236">Поставщик обычно предоставляет сведения об этих видимых свойствах для нового раздела профиля, который пока не включает сохраненные учетные данные или конфиденциальные сведения, и когда обнаруживает, что сведения о свойстве изменились.</span><span class="sxs-lookup"><span data-stu-id="89a6b-236">The provider typically provides information for these visible properties both for a new profile section, which does not yet include saved credentials or private information, and when it finds that property information has changed.</span></span> <span data-ttu-id="89a6b-237">Дополнительные сведения о разделах профилей можно найти в статье [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md).</span><span class="sxs-lookup"><span data-stu-id="89a6b-237">For more information about profile sections, see [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span></span>
  
<span data-ttu-id="89a6b-238">После успешного входа в систему пользователя и возврата в MAPI поставщик хранилища должен создать массив свойств для строки состояния ресурса и вызвать метод [имаписуппорт:: модифистатусров](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="89a6b-238">After successfully logging on a user, and before returning to MAPI, the store provider should create the array of properties for the status row for the resource and call the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> 
  
 <span data-ttu-id="89a6b-239">Вызовы для **входа** , которые открывают хранилища сообщений, которые уже открыты для текущего сеанса MAPI, пропускают описанную выше обработку.</span><span class="sxs-lookup"><span data-stu-id="89a6b-239">**Logon** calls that open message stores that are already open for the current MAPI session skip much of the processing previously described.</span></span> <span data-ttu-id="89a6b-240">Эти вызовы не создают строки состояния, возвращают объекты входа в хранилище сообщений, **AddRef** вызовов для объекта поддержки MAPI или возвращают данные для входа в систему буферизации MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-240">These calls do not create status rows, return message store logon objects, call **AddRef** for the MAPI support object, or return data for MAPI spooler logon.</span></span> <span data-ttu-id="89a6b-241">Эти вызовы возвращают S_OK и возвращают объект хранилища сообщений с запрашиваемым интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="89a6b-241">These calls do return S_OK and return a message store object with the requested interface.</span></span> 
  
<span data-ttu-id="89a6b-242">Для обнаружения таких вызовов поставщик должен поддерживать список в объекте поставщика хранилища сообщений, который уже открыт для этого объекта поставщика.</span><span class="sxs-lookup"><span data-stu-id="89a6b-242">To detect such calls, the provider should maintain a list in the message store provider object of stores already open for this provider object.</span></span> <span data-ttu-id="89a6b-243">При обработке вызова для **входа** поставщик должен проверить этот список открытых магазинов и определить, открыто ли это хранилище.</span><span class="sxs-lookup"><span data-stu-id="89a6b-243">When processing a **Logon** call, the provider should scan this list of open stores and determine whether the store to be logged on to is already open.</span></span> <span data-ttu-id="89a6b-244">Если это так, учетные данные пользователя не нуждаются в проверке, и если это возможно, следует избегать отображения диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="89a6b-244">If it is, user credentials do not need to be checked and the display of a dialog box should be avoided, if possible.</span></span> <span data-ttu-id="89a6b-245">Если должны отображаться диалоговые окна, поставщик должен проверить возвращенные сведения, чтобы узнать, было ли хранилище открыто еще раз.</span><span class="sxs-lookup"><span data-stu-id="89a6b-245">If dialog boxes must be displayed, the provider should check returned information to see whether a store has been opened a second time.</span></span> <span data-ttu-id="89a6b-246">Кроме того, поставщик должен проверить наличие дубликатов, используя _лпентрид_ в начале обработки вызовов **входа** .</span><span class="sxs-lookup"><span data-stu-id="89a6b-246">In addition, the provider should check for duplicate openings by using  _lpEntryID_ at the beginning of **Logon** call processing.</span></span> 
  
<span data-ttu-id="89a6b-247">Стандартная обработка вызова для **входа в систему** , обращающегося к открытому хранилищу, выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="89a6b-247">Standard processing for a **Logon** call that accesses an open store is as follows:</span></span> 
  
1. <span data-ttu-id="89a6b-248">Поставщик услуг хранения вызывает **AddRef** для существующего объекта Store, если новый интерфейс совпадает с интерфейсом существующего хранилища.</span><span class="sxs-lookup"><span data-stu-id="89a6b-248">The store provider calls **AddRef** for the existing store object if the new interface being requested is the same as the interface for the existing store.</span></span> <span data-ttu-id="89a6b-249">В противном случае вызывается метод **QueryInterface** для получения нового интерфейса.</span><span class="sxs-lookup"><span data-stu-id="89a6b-249">Otherwise, it calls **QueryInterface** to get the new interface.</span></span> <span data-ttu-id="89a6b-250">Если хранилище не поддерживает новый интерфейс, поставщик должен возвратить значение ошибки MAPI_E_INTERFACE_NOT_SUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="89a6b-250">If the store does not support the new interface, the provider should return the error value MAPI_E_INTERFACE_NOT_SUPPORTED.</span></span> 
    
2. <span data-ttu-id="89a6b-251">Поставщик возвращает указатель на необходимый интерфейс существующего объекта Store в _лппмдб_.</span><span class="sxs-lookup"><span data-stu-id="89a6b-251">The provider returns a pointer to the required interface of the existing store object in  _lppMDB_.</span></span>
    
3. <span data-ttu-id="89a6b-252">Поставщик возвращает **значение NULL** в _лппмслогон_.</span><span class="sxs-lookup"><span data-stu-id="89a6b-252">The provider returns **null** in  _lppMSLogon_.</span></span>
    
4. <span data-ttu-id="89a6b-253">Поставщик не должен открывать профиль для объекта поддержки, переданного в вызове.</span><span class="sxs-lookup"><span data-stu-id="89a6b-253">The provider should not open the profile for the support object passed in the call.</span></span> <span data-ttu-id="89a6b-254">Кроме того, он не должен регистрировать уникальный идентификатор поставщика, регистрировать строку состояния или возвращать данные для входа в систему диспетчера MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-254">In addition, it should not register a provider unique identifier, register a status row, or return MAPI spooler logon data.</span></span>
    
5. <span data-ttu-id="89a6b-255">Поставщик не должен вызывать **AddRef** для объекта support, так как ему не требуется указатель на объект.</span><span class="sxs-lookup"><span data-stu-id="89a6b-255">The provider should not call **AddRef** for the support object, because it does not require a pointer to the object.</span></span> 
    
<span data-ttu-id="89a6b-256">По возможности поставщики должны возвращать соответствующие строки ошибок и предупреждений для вызовов **входа в систему** , так как это значительно упрощает нагрузку пользователей, чтобы определить, почему что-то не работает.</span><span class="sxs-lookup"><span data-stu-id="89a6b-256">Whenever possible, providers should return appropriate error and warning strings for **Logon** calls, because doing so greatly eases the burden of users in determining why something did not work.</span></span> <span data-ttu-id="89a6b-257">Для возврата этих строк поставщик устанавливает элементы структуры **мапиеррор** .</span><span class="sxs-lookup"><span data-stu-id="89a6b-257">To return these strings, a provider sets the members in the **MAPIERROR** structure.</span></span> <span data-ttu-id="89a6b-258">MAPI ищет, использует и освобождает структуру **мапиеррор** , если она возвращается поставщиком.</span><span class="sxs-lookup"><span data-stu-id="89a6b-258">MAPI looks for, uses, and releases the **MAPIERROR** structure if it is returned by a provider.</span></span> 
  
<span data-ttu-id="89a6b-259">Память для этой структуры **мапиеррор** должна быть выделена с помощью буфера, переданного в _лпфаллокатебуффер_ в вызове **мспровидеринит** .</span><span class="sxs-lookup"><span data-stu-id="89a6b-259">Memory for this **MAPIERROR** structure should be allocated by using the buffer passed in  _lpfAllocateBuffer_ on the **MSProviderInit** call.</span></span> <span data-ttu-id="89a6b-260">Все строки ошибок, входящие в возвращаемую структуру, должны иметь формат Юникод, если MAPI_UNICODE задан в ulFlags **входа** _;_ в противном случае они должны быть в наборе символов ANSI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-260">Any error strings contained in the returned structure should be in Unicode format if MAPI_UNICODE is set in the **Logon** _ulFlags;_ otherwise, they should be in the ANSI character set.</span></span> 
  
<span data-ttu-id="89a6b-261">Для большинства значений ошибок, возвращаемых при **входе в систему**, MAPI отключает службы сообщений, к которым относится неисправность поставщика.</span><span class="sxs-lookup"><span data-stu-id="89a6b-261">For most error values returned from **Logon**, MAPI disables the message services to which the failing provider belongs.</span></span> <span data-ttu-id="89a6b-262">MAPI не будет вызывать поставщиков, принадлежащих этим службам, в течение времени жизни сеанса MAPI.</span><span class="sxs-lookup"><span data-stu-id="89a6b-262">MAPI will not call any providers that belong to those services for the life of the MAPI session.</span></span> <span data-ttu-id="89a6b-263">В отличие от того, что при **входе** возвращает MAPI_E_FAILONEPROVIDERое значение ошибки, MAPI не отключает службу сообщений, к которой относится поставщик.</span><span class="sxs-lookup"><span data-stu-id="89a6b-263">In contrast, when **Logon** returns the MAPI_E_FAILONEPROVIDER error value from its logon, MAPI does not disable the message service to which the provider belongs.</span></span> <span data-ttu-id="89a6b-264">**Вход** должен возвращать MAPI_E_FAILONEPROVIDER, если обнаружена ошибка, которая не гарантирует отключение всей службы в течение сеанса.</span><span class="sxs-lookup"><span data-stu-id="89a6b-264">**Logon** should return MAPI_E_FAILONEPROVIDER if it encounters an error that does not warrant disabling the entire service for the life of the session.</span></span> <span data-ttu-id="89a6b-265">Например, поставщик может возвращать эту ошибку, если она не разрешает отображение пользовательского интерфейса и требуемый пароль недоступен.</span><span class="sxs-lookup"><span data-stu-id="89a6b-265">For example, a provider might return this error when it does not allow the display of a user interface and a required password is unavailable.</span></span> 
  
<span data-ttu-id="89a6b-266">Если поставщик возвращает MAPI_E_UNCONFIGURED из входа в систему, MAPI вызывает функцию ввода службы сообщений поставщика и повторно пытается войти в систему.</span><span class="sxs-lookup"><span data-stu-id="89a6b-266">If a provider returns MAPI_E_UNCONFIGURED from its logon, MAPI will call the provider's message service entry function and then retry the logon.</span></span> <span data-ttu-id="89a6b-267">MAPI передает MSG_SERVICE_CONFIGURE в качестве контекста, чтобы предоставить службе возможность настройки.</span><span class="sxs-lookup"><span data-stu-id="89a6b-267">MAPI passes MSG_SERVICE_CONFIGURE as the context to give the service a chance to configure itself.</span></span> <span data-ttu-id="89a6b-268">Если клиент решил разрешить пользовательскому интерфейсу для входа в систему, эта служба может представить свой лист свойств конфигурации, чтобы пользователь мог вводить сведения о конфигурации.</span><span class="sxs-lookup"><span data-stu-id="89a6b-268">If the client has chosen to allow a user interface on the logon, the service can present its configuration property sheet so the user can enter configuration information.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="89a6b-269">См. также</span><span class="sxs-lookup"><span data-stu-id="89a6b-269">See also</span></span>



[<span data-ttu-id="89a6b-270">IMAPISession::GetMsgStoresTable</span><span class="sxs-lookup"><span data-stu-id="89a6b-270">IMAPISession::GetMsgStoresTable</span></span>](imapisession-getmsgstorestable.md)
  
[<span data-ttu-id="89a6b-271">IMAPISession::OpenMsgStore</span><span class="sxs-lookup"><span data-stu-id="89a6b-271">IMAPISession::OpenMsgStore</span></span>](imapisession-openmsgstore.md)
  
[<span data-ttu-id="89a6b-272">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="89a6b-272">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md)
  
[<span data-ttu-id="89a6b-273">IMAPISupport::ModifyProfile</span><span class="sxs-lookup"><span data-stu-id="89a6b-273">IMAPISupport::ModifyProfile</span></span>](imapisupport-modifyprofile.md)
  
[<span data-ttu-id="89a6b-274">IMAPISupport::ModifyStatusRow</span><span class="sxs-lookup"><span data-stu-id="89a6b-274">IMAPISupport::ModifyStatusRow</span></span>](imapisupport-modifystatusrow.md)
  
[<span data-ttu-id="89a6b-275">IMsgStore: IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="89a6b-275">IMsgStore : IMAPIProp</span></span>](imsgstoreimapiprop.md)
  
[<span data-ttu-id="89a6b-276">IMSProvider::SpoolerLogon</span><span class="sxs-lookup"><span data-stu-id="89a6b-276">IMSProvider::SpoolerLogon</span></span>](imsprovider-spoolerlogon.md)
  
[<span data-ttu-id="89a6b-277">IProfSect : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="89a6b-277">IProfSect : IMAPIProp</span></span>](iprofsectimapiprop.md)
  
[<span data-ttu-id="89a6b-278">MAPIERROR</span><span class="sxs-lookup"><span data-stu-id="89a6b-278">MAPIERROR</span></span>](mapierror.md)
  
[<span data-ttu-id="89a6b-279">MSProviderInit</span><span class="sxs-lookup"><span data-stu-id="89a6b-279">MSProviderInit</span></span>](msproviderinit.md)
  
[<span data-ttu-id="89a6b-280">IMSProvider : IUnknown</span><span class="sxs-lookup"><span data-stu-id="89a6b-280">IMSProvider : IUnknown</span></span>](imsprovideriunknown.md)

