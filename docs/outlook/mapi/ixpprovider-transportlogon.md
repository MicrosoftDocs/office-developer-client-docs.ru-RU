---
title: IXPProviderTransportLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IXPProvider.TransportLogon
api_type:
- COM
ms.assetid: 534929f2-36a2-463d-8c4c-d86060cde127
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 53b2733dbf38d680027dc00ecf5513f384e46660
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33417310"
---
# <a name="ixpprovidertransportlogon"></a>IXPProvider::TransportLogon

**Область применения**: Outlook 2013 | Outlook 2016 
  
Создает сеанс, в котором клиентская заявка входит в систему поставщика транспорта. 
  
```cpp
HRESULT TransportLogon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG FAR * lpulFlags,
  LPMAPIERROR FAR * lppMAPIError,
  LPXPLOGON FAR * lppXPLogon
);
```

## <a name="parameters"></a>Parameters

_lpMAPISup_: [in] Указатель на объект поддержки поставщика транспорта для функций вызова вызовов в MAPI для этого сеанса. Этот объект остается действительным до тех пор, пока поставщик транспорта не выпустит его.
    
_ulUIParam_: [in] Handle to the parent window of any dialog boxes or windows this method displays. Параметр _ulUIParam_ может быть ненульным, например, если флаг LOGON_SETUP задан в _параметре lpulFlags._ 
    
_lpszProfileName_: [in] Указатель на имя профиля пользователя. Параметр  _lpszProfileName_ используется в основном при необходимом диалоговом окне. 
    
_lpulFlags_: [in, out] Bitmask флагов, которые контролируют, как устанавливается сеанс logon. На входе шпалером MAPI можно установить следующие флаги:
    
  - LOGON_NO_CONNECT. Учетная запись пользователя войдя в этот поставщик транспорта для целей, помимо передачи и приема сообщений. Поставщик транспорта не должен пытаться сделать какие-либо подключения к другим системам обмена сообщениями.
        
  - LOGON_NO_DIALOG. Диалоговое окно не должно отображаться, даже если сохраненные в настоящее время учетные данные пользователей являются недействительными или недостаточными для logon.
        
  - LOGON_NO_INBOUND: поставщик транспорта не должен инициализировать прием сообщений и не должен принимать входящие сообщения. Позднее шпалер MAPI может использовать [метод IXPLogon::TransportNotify](ixplogon-transportnotify.md) для сигнала поставщика транспорта, чтобы включить обработку входящих сообщений. 
        
  - LOGON_NO_OUTBOUND: поставщик транспорта не должен инициализировать отправку сообщений, так как пульпер MAPI не предоставляет никаких. Если для клиентского приложения требуется подключение к удаленному поставщику во время композиции сообщения, чтобы можно было звонить [методу IXPLogon::AddressTypes,](ixplogon-addresstypes.md) поставщик транспорта должен сделать подключение. Шпалер MAPI может использовать **TransportNotify** для сигнала поставщика транспорта при начале исходяющих операций. 
      
  - MAPI_UNICODE. Строка для имени профиля находится в формате Unicode. Если флаг MAPI \_ UNICODE не установлен, строка находится в формате ANSI.
      
    Поставщик транспорта может установить следующие флаги на выходе:
      
  - LOGON_SP_IDLE. Запрашивает, чтобы шпалер MAPI часто вызывали метод [IXPLogon::Idle](ixplogon-idle.md) поставщика транспорта для обработки без дела. 
      
  - LOGON_SP_POLL. Запрашивает, чтобы шпалер MAPI часто вызывал метод [IXPLogon::P oll](ixplogon-poll.md) на возвращенном объекте логотипа для проверки новых сообщений. Если этот флаг не установлен, шпалер MAPI проверяет новые сообщения только в том случае, если поставщик транспорта использует метод [IMAPISupport::SpoolerNotify,](imapisupport-spoolernotify.md) чтобы уведомить шпалер о том, что существуют новые сообщения для обработки. Поставщик транспорта фактически становится только отправкой, не установив этот флаг и не уведомив шпалер MAPI о получении сообщения. 
      
  - LOGON_SP_RESOLVE. Запрашивает разрешение пулера MAPI на полный адрес всех адресов сообщений для получателей, не поддерживаемых этим поставщиком транспорта. Поэтому поставщик транспорта может создать путь ответа для всех получателей.
      
  - MAPI_UNICODE. Возвращенные строки в структуре [MAPIERROR,](mapierror.md) если таковые имеются, находятся в формате Unicode. Если флаг MAPI_UNICODE не установлен, строки находятся в формате ANSI. 
    
_lppMAPIError_: [out] Указатель на указатель на возвращенную структуру **MAPIERROR,** если таковые есть, которая содержит сведения о версии, компоненте и контексте для ошибки. Параметр  _lppMAPIError может_ быть задан в NULL, если нет структуры **MAPIERROR** для возврата. 
    
_lppXPLogon_: [out] Указатель на указатель на возвращенный объект логотипа поставщика транспорта.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK: вызов удался и возвращает ожидаемое значение или значения.
    
MAPI_E_FAILONEPROVIDER. Этот поставщик не может войти в систему, но эта ошибка не должна отключать службу. 
    
MAPI_E_UNCONFIGURED. Профиль не содержит достаточно информации для завершения логотипа. MAPI вызывает функцию точки входа службы сообщений поставщика.
    
MAPI_E_UNKNOWN_CPID: поставщик не может поддерживать страницу кода клиента.
    
MAPI_E_UNKNOWN_LCID: поставщик не может поддерживать сведения о локальном уровне клиента.
    
MAPI_E_USER_CANCEL. Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне. 
    
## <a name="remarks"></a>Примечания

Spooler MAPI вызывает **метод IXPProvider::TransportLogon** для создания сеанса логотипа для пользователя. 
  
Большинство поставщиков транспорта используют метод [IMAPISupport::OpenProfileSection,](imapisupport-openprofilesection.md) предоставленный объектом поддержки, на который указывает параметр  _lpMAPISup,_ для сохранения и получения сведений о удостоверениях пользователей, адресов серверов и учетных данных. С помощью **OpenProfileSection** поставщик транспорта может сохранять произвольные сведения и связывать их с логотипом определенного ресурса. Например, поставщик может использовать **OpenProfileSection** для сохранения имени и пароля учетной записи, связанных с определенным сеансом, а также любых имен серверов или других необходимых сведений, необходимых для доступа к ресурсам для этого сеанса. MAPI скрывает сведения, связанные с ресурсом, из внешнего доступа. Раздел профилей, доступный через  _lpMAPISup,_ управляется spooler MAPI, поэтому данные, связанные с этим пользовательским контекстом, отделены от данных для других контекстов. 
  
Поставщик транспорта должен вызвать метод **IUnknown::AddRef** на объекте поддержки и сохранить копию указателя на этот объект в составе объекта logon поставщика. 
  
Имя отображения профиля в  _lpszProfileName_ предоставляется таким образом, чтобы поставщик транспорта мог использовать его в сообщениях об ошибках или диалоговом окну с логотипом. Если поставщик сохраняет это имя, оно должно быть скопировано в хранилище, выделенное поставщиком. 
  
Поставщикам транспорта, тесно сопровождаемой с другими поставщиками услуг, может потребоваться провести дополнительную работу в logon, чтобы установить необходимые учетные данные для операций между поставщиками-компаньонами.
  
Обычно поставщики транспорта открываются при первом входе пользователя в профиль. Так как первый логотип для профиля, следовательно, обычно появляется перед логотипом в любом хранилище сообщений, шпалер MAPI обычно вызывает **TransportLogon** с флагами LOGON_NO_INBOUND и LOGON_NO_OUTBOUND, установленными в  _lpulFlags_. Позже, когда соответствующие хранилища сообщений доступны в сеансе профиля, пуллер MAPI вызывает **TransportNotify** для инициации входящих и исходяющих операций для поставщика транспорта. 
  
Передача флага LOGON_NO_CONNECT  _в lpulFlags сигналы_ автономной работы поставщика транспорта. Этот флаг указывает на отсутствие внешних подключений; если поставщик транспорта не может установить сеанс без внешнего подключения, он должен вернуть значение ошибки для логотипа. 
  
Поставщик транспорта должен установить флаг LOGON_SP_IDLE  _lpulFlags_ во время инициализации, если он предназначен для использования времени, которое система в противном случае проводит бездействующим. Такое время часто используется для обработки автоматических операций, таких как автоматическая загрузка сообщений, периодическое скачивание сообщений или отправка сообщений вовремя. Если этот флаг заданной, пульпер MAPI вызывает **Idle,** когда возникает время простоя системы для инициации таких операций. Spooler MAPI не вызывать **Idle** с заданные интервалы; скорее, он называется только во время настоящего простоя. Поэтому поставщикам не следует работать с предположениями о том, как часто будут вызваны их методы **ожидания.** Поставщики, которые поддерживают операции с простаивающим временем, должны предоставить пользовательский интерфейс конфигурации для него в листе свойств поставщика. 
  
Если логос поставщика транспорта будет успешно выбран, поставщик должен вернуть в  _параметре lppXPLogon_ указатель на объект logon. Шпалер MAPI будет использовать этот объект для дополнительного доступа к поставщику. Если **в TransportLogon** отображается диалоговое окно с логотипом, и пользователь  обычно отменяет логотип, нажав кнопку Отмена в диалоговом окне, поставщик должен MAPI_E_USER_CANCEL. 
  
Для большинства значений ошибок, возвращаемого из **TransportLogon,** MAPI отключает службы сообщений, к которым принадлежит поставщик. MAPI не будет вызывать поставщиков, которые относятся к этой службе до конца сеанса MAPI. В отличие от этого, когда **TransportLogon** возвращает значение MAPI_E_FAILONEPROVIDER ошибки из своего логотипа, MAPI не отключит службу сообщений, которой принадлежит поставщик. **TransportLogon** должен MAPI_E_FAILONEPROVIDER, если она столкнулась с ошибкой, которая не требует отключения службы до конца сеанса. 
  
Если поставщик возвращает MAPI_E_UNCONFIGURED из своего логотипа, MAPI будет вызывать функцию входа в службу сообщений поставщика, а затем повторить логон. MAPI передает MSG_SERVICE_CONFIGURE как контекст, чтобы предоставить службе возможность настроить себя. Если клиент решил разрешить пользовательский интерфейс на логотипе, служба может представить свой лист свойств конфигурации, чтобы пользователь может ввести сведения о конфигурации. 
  
Если поставщик обнаруживает, что все необходимые сведения не находятся в профиле, он должен MAPI_E_UNCONFIGURED, чтобы MAPI вызывает функцию точки входа службы сообщений поставщика. 
  
## <a name="see-also"></a>См. также

- [IXPProvider : IUnknown](ixpprovideriunknown.md)  
- [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)  
- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)  
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)  
- [IXPLogon::Idle](ixplogon-idle.md)  
- [IXPLogon::Poll](ixplogon-poll.md)  
- [IXPLogon::TransportNotify](ixplogon-transportnotify.md) 
- [MAPIERROR](mapierror.md)

