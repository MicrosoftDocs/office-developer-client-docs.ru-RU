---
title: IXPProviderTransportLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IXPProvider.TransportLogon
api_type:
- COM
ms.assetid: 534929f2-36a2-463d-8c4c-d86060cde127
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 53b2733dbf38d680027dc00ecf5513f384e46660
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33417310"
---
# <a name="ixpprovidertransportlogon"></a>IXPProvider::TransportLogon

**Относится к**: Outlook 2013 | Outlook 2016 
  
Устанавливает сеанс, в котором клиентская приложение входит в систему поставщика транспорта. 
  
```cpp
HRESULT TransportLogon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG FAR * lpulFlags,
  LPMAPIERROR FAR * lppMAPIError,
  LPXPLOGON FAR * lppXPLogon
);
```

## <a name="parameters"></a>Параметры

_lpMAPISup_: [in] Указатель на объект поддержки поставщика транспорта для функций callback в MAPI для этого сеанса. Этот объект остается действительным, пока поставщик транспорта не освободит его.
    
_ulUIParam_: [in] Handle to the parent window of any dialog boxes or windows this method displays. Параметр _ulUIParam_ может иметь ненулевую заданную LOGON_SETUP в параметре _lpulFlags._ 
    
_lpszProfileName_: [in] Указатель на имя профиля пользователя. Параметр  _lpszProfileName в_ основном используется, когда необходимо представить диалоговое окно. 
    
_lpulFlags_: [in, out] Битоваяmas флагов, которая управляет тем, как установлен сеанс для сеанса. При вводе пулом MAPI можно установить следующие флаги:
    
  - LOGON_NO_CONNECT: учетная запись пользователя войдя в систему этого поставщика транспорта для целей, кроме передачи и приема сообщений. Поставщик транспорта не должен пытаться подключения к другим системам обмена сообщениями.
        
  - LOGON_NO_DIALOG: диалоговое окно не должно отображаться, даже если сохраненные в данный момент учетные данные пользователя являются недопустимыми или недостаточными для входа.
        
  - LOGON_NO_INBOUND: поставщик транспорта не должен инициализировать прием сообщений и не должен принимать входящие сообщения. The MAPI spooler can use the [IXPLogon::TransportNotify](ixplogon-transportnotify.md) method later to signal the transport provider to enable incoming message processing. 
        
  - LOGON_NO_OUTBOUND: поставщику транспорта не нужно инициализировать отправку сообщений, так как пульщик MAPI не предоставляет никаких данных. Если клиентского приложения требуется подключение к удаленному поставщику во время композиции сообщения, чтобы оно может делать вызовы метода [IXPLogon::AddressTypes,](ixplogon-addresstypes.md) поставщик транспорта должен сделать подключение. Пулер MAPI может использовать **TransportNotify** для сигнала поставщика транспорта, когда могут начаться исходяющие операции. 
      
  - MAPI_UNICODE: переданная строка для имени профиля имеет формат Юникод. Если флаг MAPI UNICODE не \_ установлен, строка будет в формате ANSI.
      
    Поставщик транспорта может установить следующие флаги при выходе:
      
  - LOGON_SP_IDLE: запрашивает, чтобы пульщик MAPI часто вызывали метод [IXPLogon::Idle](ixplogon-idle.md) поставщика транспорта для обработки времени бездействия. 
      
  - LOGON_SP_POLL: запрашивает, чтобы пульер MAPI часто вызывал метод [IXPLogon::P oll](ixplogon-poll.md) для возвращенного объекта для регистрации, чтобы проверить на предмет новых сообщений. Если этот флаг не установлен, пулер MAPI проверяет наличие новых сообщений только в том случае, если поставщик транспорта использует метод [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) для уведомления пула о новых сообщениях, которые необходимо обработать. Поставщик транспорта фактически становится только отправим, не устанавливая этот флаг и не уведомляя пульер MAPI о получении сообщения. 
      
  - LOGON_SP_RESOLVE: запросы на разрешение пулом MAPI всех адресов сообщений для получателей, не поддерживаемых этим поставщиком транспорта. Таким образом, поставщик транспорта может создать путь ответа для всех получателей.
      
  - MAPI_UNICODE: возвращенные строки в структуре [MAPIERROR](mapierror.md) (если таковые имеются) имеют формат Юникод. Если флаг MAPI_UNICODE не установлен, строки будут в формате ANSI. 
    
_lppMAPIError_: [out] Указатель на указатель на возвращенную структуру **MAPIERROR,** если таковые есть, которая содержит сведения о версии, компоненте и контексте для ошибки. Для _параметра lppMAPIError_ можно установить NULL, если не существует возвращаемой структуры **MAPIERROR.** 
    
_lppXPLogon_: [out] Pointer to the pointer to the returned transport provider logon object.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK: вызов был успешным и возвращен ожидаемые значения.
    
MAPI_E_FAILONEPROVIDER: этот поставщик не может войти в систему, но эта ошибка не должна отключать службу. 
    
MAPI_E_UNCONFIGURED: профиль не содержит достаточно сведений для завершения работы с данными. MAPI вызывает функцию точки входа службы сообщений поставщика.
    
MAPI_E_UNKNOWN_CPID: поставщик не может поддерживать кодовую страницу клиента.
    
MAPI_E_UNKNOWN_LCID: поставщик не может поддерживать сведения о региональных данных клиента.
    
MAPI_E_USER_CANCEL: пользователь отменил операцию, обычно нажав кнопку  "Отмена" в диалоговом окне. 
    
## <a name="remarks"></a>Примечания

Пулер MAPI вызывает метод **IXPProvider::TransportLogon,** чтобы установить сеанс для пользователя. 
  
Большинство поставщиков транспорта используют метод [IMAPISupport::OpenProfileSection,](imapisupport-openprofilesection.md) предоставленный объектом поддержки, на который указывает параметр  _lpMAPISup,_ для сохранения и получения сведений об удостоверениях пользователей, адресах серверов и учетных данных. С помощью **OpenProfileSection** поставщик транспорта может сохранять произвольные сведения и связывать их с определенным ресурсом. Например, поставщик может использовать **OpenProfileSection** для сохранения имени и пароля учетной записи, связанной с определенным сеансом, а также любых имен серверов или других необходимых сведений, необходимых для доступа к ресурсам для этого сеанса. MAPI скрывает сведения, связанные с ресурсом, из-за пределов доступа. Раздел профиля, доступный через  _lpMAPISup,_ управляется пулером MAPI, поэтому данные, связанные с этим контекстом пользователя, отделены от данных для других контекстов. 
  
Поставщик транспорта должен вызвать метод **IUnknown::AddRef** в объекте поддержки и сохранить копию указателя на этот объект как часть объекта для эмблемы поставщика. 
  
Отображаемого имени профиля  _в lpszProfileName_ предоставляется таким образом, чтобы поставщик транспорта мог использовать его в сообщениях об ошибках или диалоговом окле для логотипа. Если поставщик сохраняет это имя, его необходимо скопировать в хранилище, выделенное поставщиком. 
  
Поставщикам транспорта, тесно соединенным с другими поставщиками услуг, может потребоваться дополнительная работа при входах, чтобы установить необходимые учетные данные для операций между поставщиками-компаньонами.
  
Обычно поставщики транспорта открываются при первом входе пользователя в профиль. Так как первый воеский вызов профиля обычно происходит до того, как он будет в любом хранилище сообщений, пулер MAPI обычно вызывает **TransportLogon** с флагами LOGON_NO_INBOUND и LOGON_NO_OUTBOUND, установленными в _lpulFlags._ Позже, когда соответствующие хранилища сообщений доступны в сеансе профиля, пулер MAPI вызывает **TransportNotify,** чтобы инициировать входящие и исходяющие операции для поставщика транспорта. 
  
Передача флага LOGON_NO_CONNECT в  _lpulFlags сигнализирует_ об автономной работе поставщика транспорта. Этот флаг указывает, что внешние подключения не должны быть подключены; Если поставщик транспорта не может установить сеанс без внешнего подключения, он должен вернуть значение ошибки для сеанса. 
  
Поставщик транспорта должен установить флаг LOGON_SP_IDLE в  _lpulFlags_ во время инициализации, если он предназначен для использования времени, которое система в противном случае тратит на бездействие. Такое время часто используется для обработки автоматических операций, таких как автоматическая загрузка сообщений, скачивание сообщений по времени или отправка сообщений по времени. Если этот флаг установлен, то пульщик MAPI вызывает idle, когда происходит время бездействия системы для инициации таких операций.  Пулер MAPI не будет вызывать **idle** через заданные интервалы; вместо этого он будет вызван только во время настоящего простоя. Поэтому поставщики не должны работать с предположениями о том, как часто будут вызваны их методы **Idle.** Поставщики, которые поддерживают операции простоя, должны предоставить пользовательский интерфейс конфигурации на листе свойств поставщика. 
  
В случае успешного логарбута поставщика транспорта поставщик должен вернуть в  _параметре lppXPLogon_ указатель на объект для логотипа. Пулер MAPI будет использовать этот объект для дополнительного доступа поставщика. Если **TransportLogon** отображает диалоговое окно для запуска и пользователь обычно отменяет его, нажав кнопку "Отмена" в диалоговом окне, поставщик должен вернуть MAPI_E_USER_CANCEL.  
  
Для большинства значений ошибок, возвращаемого **из TransportLogon,** MAPI отключает службы сообщений, к которым принадлежит поставщик. MAPI не будет вызывать поставщиков, принадлежащих этой службе, в течение остального сеанса MAPI. В отличие от этого, когда **TransportLogon** возвращает значение ошибки MAPI_E_FAILONEPROVIDER из своего логотипа, MAPI не отключать службу сообщений, к которой принадлежит поставщик. **TransportLogon** должен возвращать MAPI_E_FAILONEPROVIDER, если он сталкивается с ошибкой, которая не требует отключения службы для остального сеанса. 
  
Если поставщик возвращает MAPI_E_UNCONFIGURED из своего входа, MAPI будет вызывать функцию записи службы сообщений поставщика, а затем повторить попытку входа. MAPI передает MSG_SERVICE_CONFIGURE как контекст, чтобы предоставить службе возможность настроить себя. Если клиент разрешил пользовательский интерфейс для входа, служба может представить свою таблицу свойств конфигурации, чтобы пользователь введет сведения о конфигурации. 
  
Если поставщик обнаружит, что все необходимые сведения не находятся в профиле, он должен вернуть MAPI_E_UNCONFIGURED, чтобы MAPI вызывает функцию точки входа службы сообщений поставщика. 
  
## <a name="see-also"></a>См. также

- [IXPProvider : IUnknown](ixpprovideriunknown.md)  
- [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)  
- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)  
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)  
- [IXPLogon::Idle](ixplogon-idle.md)  
- [IXPLogon::Poll](ixplogon-poll.md)  
- [IXPLogon::TransportNotify](ixplogon-transportnotify.md) 
- [MAPIERROR](mapierror.md)

