---
title: иксппровидертранспортлогон
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IXPProvider.TransportLogon
api_type:
- COM
ms.assetid: 534929f2-36a2-463d-8c4c-d86060cde127
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 53b2733dbf38d680027dc00ecf5513f384e46660
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33417310"
---
# <a name="ixpprovidertransportlogon"></a>IXPProvider::TransportLogon

**Относится к**: Outlook 2013 | Outlook 2016 
  
Устанавливает сеанс, в котором клиентское приложение выполняет вход в поставщик транспорта. 
  
```cpp
HRESULT TransportLogon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG FAR * lpulFlags,
  LPMAPIERROR FAR * lppMAPIError,
  LPXPLOGON FAR * lppXPLogon
);
```

## <a name="parameters"></a>Параметры

_лпмаписуп_: [in] указатель на объект поддержки поставщика транспорта для функций обратного вызова в MAPI для этого сеанса. Этот объект остается действительным до тех пор, пока его не освободит поставщик транспорта.
    
_улуипарам_: [in] дескриптор родительского окна любых диалоговых окон или окон, которые отображает этот метод. Параметр _улуипарам_ может иметь значение, отличное от NULL, например, если в параметре _лпулфлагс_ задан флаг LOGON_SETUP. 
    
_лпсзпрофиленаме_: [вход] указатель на имя профиля пользователя. Параметр _лпсзпрофиленаме_ используется в основном при необходимости представления диалогового окна. 
    
_лпулфлагс_: [in, out] битовая маска флагов, определяющих, как установлен сеанс входа в систему. С помощью диспетчера очереди MAPI можно задать следующие флаги:
    
  - LOGON_NO_CONNECT: учетная запись пользователя регистрируется в этом поставщике транспорта в целях, отличных от передачи и приема сообщений. Поставщик транспорта не должен предпринимать попытки подключения к другим системам обмена сообщениями.
        
  - LOGON_NO_DIALOG: диалоговое окно не должно отображаться даже в том случае, если сохраненные учетные данные пользователя недопустимы или недостаточны для входа в систему.
        
  - LOGON_NO_INBOUND: поставщик транспорта не должен инициализировать прием сообщений и не должен принимать входящие сообщения. Диспетчер очереди MAPI может использовать метод [иксплогон:: транспортнотифи](ixplogon-transportnotify.md) позже, чтобы сообщить поставщику транспорта о включении обработки входящих сообщений. 
        
  - LOGON_NO_OUTBOUND: поставщик транспорта не должен инициализировать отправку сообщений, так как диспетчер очереди MAPI не предоставляет. Если клиентскому приложению требуется подключение к удаленному поставщику во время композиции сообщения, чтобы оно могло выполнить [иксплогон:: аддресстипес](ixplogon-addresstypes.md) вызовы метода, поставщик транспорта должен сделать это подключение. Диспетчер очереди MAPI может использовать **транспортнотифи** , чтобы сообщить поставщику транспорта о том, что исходящие операции могут начаться. 
      
  - MAPI_UNICODE: переданная строка для имени профиля имеет формат Юникод. Если флаг MAPI\_Unicode не задан, строка имеет формат ANSI.
      
    В выходных данных поставщика транспорта можно задать следующие флаги:
      
  - LOGON_SP_IDLE: запросы, которые почтовые очереди MAPI часто вызывают [иксплогон:: метод Idle](ixplogon-idle.md) для обработки в режиме простоя. 
      
  - LOGON_SP_POLL: запросы, которые почтовые очереди MAPI часто вызывают метод [иксплогон::P](ixplogon-poll.md) для возвращенного объекта logon для проверки наличия новых сообщений. Если этот флаг не установлен, то диспетчер очереди MAPI проверяет наличие новых сообщений, только когда поставщик транспорта использует метод [имаписуппорт:: спулернотифи](imapisupport-spoolernotify.md) , чтобы уведомить Диспетчер очереди о наличии новых сообщений для обработки. Поставщик транспорта фактически становится доступен только для отправки, не устанавливая этот флаг и не уведомляя Диспетчер очереди сообщений MAPI о получении сообщения. 
      
  - LOGON_SP_RESOLVE: запросы, которые почтовые очереди MAPI разрешают до полных адресов для получателей, не поддерживаемых этим поставщиком транспорта. Поэтому поставщик транспорта может создать путь ответа для всех получателей.
      
  - MAPI_UNICODE: возвращенные строки в структуре [мапиеррор](mapierror.md) , если они есть, представлены в формате Юникод. Если флаг MAPI_UNICODE не установлен, строки представлены в формате ANSI. 
    
_лппмапиеррор_: [выходной параметр] указатель на указатель на возвращенную структуру **мапиеррор** (при наличии), содержащую сведения о версии, компоненте и контексте ошибки. Параметр _лппмапиеррор_ может иметь значение null, если структура **мапиеррор** для возврата отсутствует. 
    
_лппксплогон_: [выходной параметр] указатель на указатель на возвращенный объект входа поставщика транспорта.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK: вызов выполнен успешно и возвращен ожидаемое значение или значения.
    
MAPI_E_FAILONEPROVIDER: Этот поставщик не может выполнить вход, но эта ошибка не должна отключать службу. 
    
MAPI_E_UNCONFIGURED: профиль не содержит достаточно сведений для выполнения входа. MAPI вызывает функцию точки входа службы сообщений поставщика.
    
MAPI_E_UNKNOWN_CPID: поставщик не может поддерживать кодовую страницу клиента.
    
MAPI_E_UNKNOWN_LCID: поставщик не может поддерживать сведения о языковом стандарте клиента.
    
MAPI_E_USER_CANCEL: пользователь отменил операцию, обычно нажав кнопку **Отмена** в диалоговом окне. 
    
## <a name="remarks"></a>Примечания

Диспетчер очереди MAPI вызывает метод **иксппровидер:: транспортлогон** для установки сеанса входа пользователя. 
  
Большинство поставщиков транспорта используют метод [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md) , предоставленный объектом support, на который указывает параметр _лпмаписуп_ для сохранения и получения сведений об удостоверении пользователя, адресах серверов и учетных данных. С помощью **опенпрофилесектион**поставщик транспорта может сохранять произвольную информацию и связывать ее с входом в конкретный ресурс. Например, поставщик может использовать **опенпрофилесектион** , чтобы сохранить имя и пароль учетной записи, связанные с определенным сеансом, а также все имена серверов или другие сведения, необходимые для доступа к ресурсам для этого сеанса. MAPI скрывает информацию, связанную с ресурсом, из внешнего доступа. Раздел профиля, доступный через _лпмаписуп_ , управляется диспетчером очереди MAPI, поэтому данные, связанные с этим контекстом пользователя, отделяются от данных для других контекстов. 
  
Поставщик транспорта должен вызвать метод **IUnknown:: AddRef** для объекта support и хранить копию указателя на этот объект в качестве части объекта входа поставщика. 
  
Отображаемое имя профиля в _лпсзпрофиленаме_ предоставляется таким образом, чтобы поставщик транспорта мог использовать его в сообщениях об ошибках или диалоговых окнах входа. Если поставщик сохраняет это имя, он должен быть скопирован в хранилище, выделенное поставщиком. 
  
Поставщикам транспорта, тесно связанным с другими поставщиками услуг, может потребоваться выполнить дополнительные действия при входе, чтобы установить правильные учетные данные, необходимые для операций между сопутствующими поставщиками.
  
Обычно поставщики транспорта открываются при первом входе пользователя в профиль. Так как первым входом в профиль, как правило, предшествует вход в любое хранилище сообщений, диспетчер очереди MAPI обычно вызывает **транспортлогон** с флагами LOGON_NO_INBOUND и LOGON_NO_OUTBOUND, заданными в _лпулфлагс_. Позже, когда в сеансе профиля будут доступны соответствующие хранилища сообщений, диспетчер очереди MAPI вызывает **транспортнотифи** для инициирования входящих и исходящих операций для поставщика транспорта. 
  
Передача флага LOGON_NO_CONNECT в _Многолпулфлагсных_ сигналах операция поставщика транспорта отключена. Этот флаг указывает, что никакие внешние подключения не будут выполняться; Если поставщик транспорта не может установить сеанс без внешнего подключения, он должен возвратить значение ошибки для входа в систему. 
  
Поставщик транспорта должен установить флаг LOGON_SP_IDLE в _лпулфлагс_ во время инициализации, если он предназначен для использования времени, в течение которого система тратится на бездействие. Это время часто используется для обработки автоматических операций, таких как автоматическая загрузка сообщений, время загрузки сообщений или отправка сообщений по времени. Если этот флаг установлен, диспетчер очереди MAPI вызывает **неактивность** при возникновении времени простоя системы для инициирования таких операций. Диспетчер очереди MAPI не вызывает **простой** через заданные промежутки времени; Вместо этого он вызывается только во время истинного периода бездействия. Таким образом, поставщики не должны работать с предположением о том, как часто будут вызываться методы **простоя** . Поставщики, поддерживающие операции простоя в режиме простоя, должны предоставить пользовательский интерфейс конфигурации на странице свойств поставщика. 
  
Если вход в систему поставщика транспорта выполнен успешно, поставщик должен возвратить указатель в параметре _лппксплогон_ на объект logon. Диспетчер очереди MAPI будет использовать этот объект для дополнительного доступа к поставщику. Если в **транспортлогон** отображается диалоговое окно входа в систему, а пользователь отменяет вход в систему, то при нажатии кнопки **Отмена** в диалоговом окне поставщик должен возвратить MAPI_E_USER_CANCEL. 
  
Для большинства значений ошибок, возвращаемых из **транспортлогон**, MAPI отключает службы сообщений, к которым относится поставщик. MAPI не будет вызывать поставщиков, принадлежащих этой службе, для оставшейся части сеанса MAPI. В отличие от того, когда **транспортлогон** возвращает значение ошибки MAPI_E_FAILONEPROVIDER из входа в систему, MAPI не отключает службу сообщений, к которой принадлежит поставщик. **Транспортлогон** должен возвращать MAPI_E_FAILONEPROVIDER, если обнаружена ошибка, которая не приводит к отключению службы для оставшейся части сеанса. 
  
Если поставщик возвращает MAPI_E_UNCONFIGURED из входа в систему, MAPI вызывает функцию ввода службы сообщений поставщика и повторно пытается войти в систему. MAPI передает MSG_SERVICE_CONFIGURE в качестве контекста, чтобы предоставить службе возможность настройки. Если клиент решил разрешить пользовательскому интерфейсу, эта служба может представлять его страницу свойств конфигурации, чтобы пользователь мог вводить сведения о конфигурации. 
  
Если поставщик обнаружит, что все необходимые сведения не находятся в профиле, возвращается MAPI_E_UNCONFIGURED, чтобы MAPI вызывал функцию точки входа службы сообщений поставщика. 
  
## <a name="see-also"></a>См. также

- [IXPProvider : IUnknown](ixpprovideriunknown.md)  
- [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)  
- [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)  
- [IXPLogon::AddressTypes](ixplogon-addresstypes.md)  
- [IXPLogon::Idle](ixplogon-idle.md)  
- [IXPLogon::Poll](ixplogon-poll.md)  
- [IXPLogon::TransportNotify](ixplogon-transportnotify.md) 
- [MAPIERROR](mapierror.md)

