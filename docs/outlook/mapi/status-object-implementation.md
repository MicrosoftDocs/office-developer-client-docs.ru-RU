---
title: Реализация объекта состояния
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 48fd3e28-c2d2-474d-9487-5e2f08ca7319
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: e97efb70716ffbd7fa98f980ce8520cfcb988532
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32336339"
---
# <a name="status-object-implementation"></a>Реализация объекта состояния

**Область применения**: Outlook 2013 | Outlook 2016 
  
Все поставщики служб должны реализовать объект status и почтовые свойства из него в таблицу состояния сеанса. Можно включить одну или несколько строк в таблицу состояния в зависимости от количества ресурсов, которыми вы управляете. Поставщик транспорта, например, должен создать строку в таблице состояний для каждой очереди сообщений, которая управляет ею. При возникновении изменений необходимо обновить соответствующую строку таблицы состояний. Объекты Status реализуются для предоставления доступа к информации, включенной в таблицу status, и к дополнительным сведениям, не включенным в таблицу.
  
### <a name="to-implement-a-status-object"></a>Реализация объекта Status

1. Реализуйте метод **опенстатусентри** для объекта logon. Когда клиенты хотят открыть ваш объект status, они вызывают [IMAPISession:: OpenEntry](imapisession-openentry.md). MAPI выполняет открытый запрос, вызывая метод **опенстатусентри** поставщика, в результате чего поставщик открывает свой объект состояния и возвращает клиенту указатель на его реализацию **имапистатус** . В реализации **опенстатусентри** выполните следующие действия: 
    
   1. Если объект logon еще не создал объект status, выполните следующие действия:
    
      1. ВыЗовите метод [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md) объекта support, чтобы получить доступ к разделу профиля поставщика. 
          
      2. Создание нового объекта Status.
          
      3. Сохраните ссылку на раздел Profile в объекте status поставщика и вызовите метод [IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) раздела profile, чтобы увеличить значение счетчика ссылок. 
          
      4. Сохраните ссылку на объект logon в объекте status поставщика и вызовите метод **IUnknown:: AddRef** объекта logon, чтобы увеличить значение счетчика ссылок. 
          
      5. Сохраните ссылку на объект Status в объекте logon поставщика.
    
   2. ВыЗовите метод **IUnknown:: AddRef** объекта status, чтобы увеличить значение счетчика ссылок в объекте logon. 
    
   3. ПриСвойте свойству **пр_обжект_типе** ([PidTagObjectType](pidtagobjecttype-canonical-property.md)) объекта status значение мапи_статус.
    
   4. Задайте выходной параметр _лппмапистатус_ , указывающий на объект status, и вернитесь. 
    
   5. Проверьте входной параметр _ulFlags_ . Если для этого параметра задано значение МАПИ_МОДИФИ, а поставщик поддерживает доступ к объекту Status для чтения и записи, возвращается доступный для записи объект. Тем не менее, если поставщик не поддерживает доступ для чтения и записи к объекту status, не удается выполнить. Возвращает объект status, который доступен только для чтения. Клиенты, которые ожидают получения объектов состояния чтения и записи, должны проверить, предоставлены ли разрешения на чтение и запись, прежде чем пытаться внести изменения. 
    
2. Задайте все необходимые свойства объекта status и таблицы состояния. Свойства, включаемые в строку таблицы состояния, должны быть доступны через объект status, за исключением свойств, рассчитанных MAPI. Ниже приведены необходимые свойства.
    
   - **Пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))
    
   - **Пр_провидер_длл_наме** ([PidTagProviderDllName](pidtagproviderdllname-canonical-property.md))
    
   - **Пр_провидер_дисплай** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))
    
   - **Пр_ресаурце_типе** ([PidTagResourceType](pidtagresourcetype-canonical-property.md))
    
   - **Пр_ресаурце_месодс** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md))
    
   - **Пр_ресаурце_флагс** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md))
    
   - **Пр_статус_коде** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md))
    
3. Реализуйте методы [имапистатус: IMAPIProp](imapistatusimapiprop.md) , соответствующие поставщику. В зависимости от поставщика не требуется реализовывать все четыре метода в **имапистатус**. Каждый поставщик должен реализовать доступную только для чтения версию методов интерфейса [IMAPIProp: IUnknown](imapipropiunknown.md) и метода [Имапистатус:: валидатестате](imapistatus-validatestate.md) . 

   Поставщики транспорта также должны реализовать [имапистатус:: FlushQueues](imapistatus-flushqueues.md), а все поставщики должны поддерживать [Имапистатус:: сеттингсдиалог](imapistatus-settingsdialog.md). Однако поддержка [имапистатус:: ChangePassword](imapistatus-changepassword.md) является необязательной. Только поставщики служб, которым требуются пароли и хотят разрешить пользователям изменять их программным способом, необходимо реализовать этот метод. Для каждого поддерживаемого метода задайте соответствующий бит в свойстве **пр_ресаурце_месодс** . Например, если поддерживается только **валидатестате** и **сеттингсдиалог** , присвойте параметру **пр_ресаурце_месодс** следующее: 
    
   `STATUS_VALIDATE_STATE | STATUS_SETTINGS_DIALOG`
    
   Клиенты должны проверить значение параметра **пр_ресаурце_месодс** , прежде чем пытаться вызвать объект Status. Обработка вызовов любого из неподдерживаемых методов путем возвращения МАПИ_Е_НО_СУППОРТ. 
    
4. Call [имаписуппорт:: модифистатусров](imapisupport-modifystatusrow.md) во время входа, чтобы добавить строку или строки в таблицу состояния. Передайте массив значений свойства, содержащий сведения о столбцах для строки, и значение 0 для параметра _ulFlags_ . Если в тот или иной момент времени в сеансе изменяется состояние поставщика, и необходимо обновить сведения о столбце, снова вызовите **модифистатусров** с установленным флагом статусров_упдате. 
    
Дополнительные сведения об объектах состояния приведены в разделе [объекты состояния MAPI](mapi-status-objects.md).
  
## <a name="see-also"></a>См. также

- [Поставщики службы MAPI](mapi-service-providers.md)

