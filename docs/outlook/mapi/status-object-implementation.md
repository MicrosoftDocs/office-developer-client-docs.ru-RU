---
title: Реализация объекта состояния
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 48fd3e28-c2d2-474d-9487-5e2f08ca7319
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: e97efb70716ffbd7fa98f980ce8520cfcb988532
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32336339"
---
# <a name="status-object-implementation"></a><span data-ttu-id="46fec-103">Реализация объекта состояния</span><span class="sxs-lookup"><span data-stu-id="46fec-103">Status object implementation</span></span>

<span data-ttu-id="46fec-104">**Область применения**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="46fec-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="46fec-105">Все поставщики служб должны реализовать объект status и почтовые свойства из него в таблицу состояния сеанса.</span><span class="sxs-lookup"><span data-stu-id="46fec-105">All service providers must implement a status object and furnish properties from it to the session status table.</span></span> <span data-ttu-id="46fec-106">Можно включить одну или несколько строк в таблицу состояния в зависимости от количества ресурсов, которыми вы управляете.</span><span class="sxs-lookup"><span data-stu-id="46fec-106">You can include one or more rows in the status table, depending on the number of resources that you control.</span></span> <span data-ttu-id="46fec-107">Поставщик транспорта, например, должен создать строку в таблице состояний для каждой очереди сообщений, которая управляет ею.</span><span class="sxs-lookup"><span data-stu-id="46fec-107">A transport provider, for example, should create a row in the status table for each message queue it manages.</span></span> <span data-ttu-id="46fec-108">При возникновении изменений необходимо обновить соответствующую строку таблицы состояний.</span><span class="sxs-lookup"><span data-stu-id="46fec-108">When changes occur, the appropriate status table row must be updated.</span></span> <span data-ttu-id="46fec-109">Объекты Status реализуются для предоставления доступа к информации, включенной в таблицу status, и к дополнительным сведениям, не включенным в таблицу.</span><span class="sxs-lookup"><span data-stu-id="46fec-109">Status objects are implemented to provide access both to the information included in the status table and to additional information not included in the table.</span></span>
  
### <a name="to-implement-a-status-object"></a><span data-ttu-id="46fec-110">Реализация объекта Status</span><span class="sxs-lookup"><span data-stu-id="46fec-110">To implement a status object</span></span>

1. <span data-ttu-id="46fec-111">Реализуйте метод **опенстатусентри** для объекта logon.</span><span class="sxs-lookup"><span data-stu-id="46fec-111">Implement the **OpenStatusEntry** method of your logon object.</span></span> <span data-ttu-id="46fec-112">Когда клиенты хотят открыть ваш объект status, они вызывают [IMAPISession:: OpenEntry](imapisession-openentry.md).</span><span class="sxs-lookup"><span data-stu-id="46fec-112">When clients want to open your status object, they call [IMAPISession::OpenEntry](imapisession-openentry.md).</span></span> <span data-ttu-id="46fec-113">MAPI выполняет открытый запрос, вызывая метод **опенстатусентри** поставщика, в результате чего поставщик открывает свой объект состояния и возвращает клиенту указатель на его реализацию **имапистатус** .</span><span class="sxs-lookup"><span data-stu-id="46fec-113">MAPI fulfills the open request by calling your provider's **OpenStatusEntry** method, causing your provider to open its status object and return to the client a pointer to its **IMAPIStatus** implementation.</span></span> <span data-ttu-id="46fec-114">В реализации **опенстатусентри** выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="46fec-114">In your **OpenStatusEntry** implementation, complete the following steps:</span></span> 
    
   1. <span data-ttu-id="46fec-115">Если объект logon еще не создал объект status, выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="46fec-115">Perform the following tasks if your logon object has not yet created a status object:</span></span>
    
      1. <span data-ttu-id="46fec-116">ВыЗовите метод [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md) объекта support, чтобы получить доступ к разделу профиля поставщика.</span><span class="sxs-lookup"><span data-stu-id="46fec-116">Call the support object's [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md) method to access your provider's profile section.</span></span> 
          
      2. <span data-ttu-id="46fec-117">Создание нового объекта Status.</span><span class="sxs-lookup"><span data-stu-id="46fec-117">Create a new status object.</span></span>
          
      3. <span data-ttu-id="46fec-118">Сохраните ссылку на раздел Profile в объекте status поставщика и вызовите метод [IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) раздела profile, чтобы увеличить значение счетчика ссылок.</span><span class="sxs-lookup"><span data-stu-id="46fec-118">Store a reference to the profile section in your provider's status object and call the profile section's [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) method to increment its reference count.</span></span> 
          
      4. <span data-ttu-id="46fec-119">Сохраните ссылку на объект logon в объекте status поставщика и вызовите метод **IUnknown:: AddRef** объекта logon, чтобы увеличить значение счетчика ссылок.</span><span class="sxs-lookup"><span data-stu-id="46fec-119">Store a reference to the logon object in your provider's status object and call the logon object's **IUnknown::AddRef** method to increment its reference count.</span></span> 
          
      5. <span data-ttu-id="46fec-120">Сохраните ссылку на объект Status в объекте logon поставщика.</span><span class="sxs-lookup"><span data-stu-id="46fec-120">Store a reference to the status object in your provider's logon object.</span></span>
    
   2. <span data-ttu-id="46fec-121">ВыЗовите метод **IUnknown:: AddRef** объекта status, чтобы увеличить значение счетчика ссылок в объекте logon.</span><span class="sxs-lookup"><span data-stu-id="46fec-121">Call the status object's **IUnknown::AddRef** method to increment its reference count in the logon object.</span></span> 
    
   3. <span data-ttu-id="46fec-122">ПриСвойте свойству **пр_обжект_типе** ([PidTagObjectType](pidtagobjecttype-canonical-property.md)) объекта status значение мапи_статус.</span><span class="sxs-lookup"><span data-stu-id="46fec-122">Set the status object's **PR_OBJECT_TYPE** ([PidTagObjectType](pidtagobjecttype-canonical-property.md)) property to MAPI_STATUS.</span></span>
    
   4. <span data-ttu-id="46fec-123">Задайте выходной параметр _лппмапистатус_ , указывающий на объект status, и вернитесь.</span><span class="sxs-lookup"><span data-stu-id="46fec-123">Set the  _lppMAPIStatus_ output parameter to point to the status object, and return.</span></span> 
    
   5. <span data-ttu-id="46fec-124">Проверьте входной параметр _ulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="46fec-124">Check the  _ulFlags_ input parameter.</span></span> <span data-ttu-id="46fec-125">Если для этого параметра задано значение МАПИ_МОДИФИ, а поставщик поддерживает доступ к объекту Status для чтения и записи, возвращается доступный для записи объект.</span><span class="sxs-lookup"><span data-stu-id="46fec-125">If it is set to MAPI_MODIFY and your provider supports read/write access to its status object, return a writeable object.</span></span> <span data-ttu-id="46fec-126">Тем не менее, если поставщик не поддерживает доступ для чтения и записи к объекту status, не удается выполнить.</span><span class="sxs-lookup"><span data-stu-id="46fec-126">However, if your provider does not support read/write access to its status object, do not fail.</span></span> <span data-ttu-id="46fec-127">Возвращает объект status, который доступен только для чтения.</span><span class="sxs-lookup"><span data-stu-id="46fec-127">Return a status object that is read-only.</span></span> <span data-ttu-id="46fec-128">Клиенты, которые ожидают получения объектов состояния чтения и записи, должны проверить, предоставлены ли разрешения на чтение и запись, прежде чем пытаться внести изменения.</span><span class="sxs-lookup"><span data-stu-id="46fec-128">Clients that expect to receive read/write status objects should verify that read/write permission has been granted before attempting to make any changes.</span></span> 
    
2. <span data-ttu-id="46fec-129">Задайте все необходимые свойства объекта status и таблицы состояния.</span><span class="sxs-lookup"><span data-stu-id="46fec-129">Set all of the required status object and status table properties.</span></span> <span data-ttu-id="46fec-130">Свойства, включаемые в строку таблицы состояния, должны быть доступны через объект status, за исключением свойств, рассчитанных MAPI.</span><span class="sxs-lookup"><span data-stu-id="46fec-130">The properties that you include in your status table row should be available through your status object, except for the properties calculated by MAPI.</span></span> <span data-ttu-id="46fec-131">Ниже приведены необходимые свойства.</span><span class="sxs-lookup"><span data-stu-id="46fec-131">The required properties are as follows:</span></span>
    
   - <span data-ttu-id="46fec-132">**Пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-132">**PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md))</span></span>
    
   - <span data-ttu-id="46fec-133">**Пр_провидер_длл_наме** ([PidTagProviderDllName](pidtagproviderdllname-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-133">**PR_PROVIDER_DLL_NAME** ([PidTagProviderDllName](pidtagproviderdllname-canonical-property.md))</span></span>
    
   - <span data-ttu-id="46fec-134">**Пр_провидер_дисплай** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-134">**PR_PROVIDER_DISPLAY** ([PidTagProviderDisplay](pidtagproviderdisplay-canonical-property.md))</span></span>
    
   - <span data-ttu-id="46fec-135">**Пр_ресаурце_типе** ([PidTagResourceType](pidtagresourcetype-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-135">**PR_RESOURCE_TYPE** ([PidTagResourceType](pidtagresourcetype-canonical-property.md))</span></span>
    
   - <span data-ttu-id="46fec-136">**Пр_ресаурце_месодс** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-136">**PR_RESOURCE_METHODS** ([PidTagResourceMethods](pidtagresourcemethods-canonical-property.md))</span></span>
    
   - <span data-ttu-id="46fec-137">**Пр_ресаурце_флагс** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-137">**PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md))</span></span>
    
   - <span data-ttu-id="46fec-138">**Пр_статус_коде** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="46fec-138">**PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md))</span></span>
    
3. <span data-ttu-id="46fec-139">Реализуйте методы [имапистатус: IMAPIProp](imapistatusimapiprop.md) , соответствующие поставщику.</span><span class="sxs-lookup"><span data-stu-id="46fec-139">Implement the [IMAPIStatus : IMAPIProp](imapistatusimapiprop.md) methods that are appropriate for your provider.</span></span> <span data-ttu-id="46fec-140">В зависимости от поставщика не требуется реализовывать все четыре метода в **имапистатус**.</span><span class="sxs-lookup"><span data-stu-id="46fec-140">Depending on your provider, you do not need to implement all of the four methods in **IMAPIStatus**.</span></span> <span data-ttu-id="46fec-141">Каждый поставщик должен реализовать доступную только для чтения версию методов интерфейса [IMAPIProp: IUnknown](imapipropiunknown.md) и метода [Имапистатус:: валидатестате](imapistatus-validatestate.md) .</span><span class="sxs-lookup"><span data-stu-id="46fec-141">Every provider should implement a read-only version of the methods of the [IMAPIProp : IUnknown](imapipropiunknown.md) interface and the [IMAPIStatus::ValidateState](imapistatus-validatestate.md) method.</span></span> 

   <span data-ttu-id="46fec-142">Поставщики транспорта также должны реализовать [имапистатус:: FlushQueues](imapistatus-flushqueues.md), а все поставщики должны поддерживать [Имапистатус:: сеттингсдиалог](imapistatus-settingsdialog.md).</span><span class="sxs-lookup"><span data-stu-id="46fec-142">Transport providers should also implement [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md), and all providers should support [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md).</span></span> <span data-ttu-id="46fec-143">Однако поддержка [имапистатус:: ChangePassword](imapistatus-changepassword.md) является необязательной.</span><span class="sxs-lookup"><span data-stu-id="46fec-143">However, support for [IMAPIStatus::ChangePassword](imapistatus-changepassword.md) is optional.</span></span> <span data-ttu-id="46fec-144">Только поставщики служб, которым требуются пароли и хотят разрешить пользователям изменять их программным способом, необходимо реализовать этот метод.</span><span class="sxs-lookup"><span data-stu-id="46fec-144">Only service providers that require passwords and want to allow users to change them programmatically need to implement this method.</span></span> <span data-ttu-id="46fec-145">Для каждого поддерживаемого метода задайте соответствующий бит в свойстве **пр_ресаурце_месодс** .</span><span class="sxs-lookup"><span data-stu-id="46fec-145">For every method that you support, set the corresponding bit in the **PR_RESOURCE_METHODS** property.</span></span> <span data-ttu-id="46fec-146">Например, если поддерживается только **валидатестате** и **сеттингсдиалог** , присвойте параметру **пр_ресаурце_месодс** следующее:</span><span class="sxs-lookup"><span data-stu-id="46fec-146">For example, if you support **ValidateState** and **SettingsDialog** only, set **PR_RESOURCE_METHODS** to the following:</span></span> 
    
   `STATUS_VALIDATE_STATE | STATUS_SETTINGS_DIALOG`
    
   <span data-ttu-id="46fec-147">Клиенты должны проверить значение параметра **пр_ресаурце_месодс** , прежде чем пытаться вызвать объект Status.</span><span class="sxs-lookup"><span data-stu-id="46fec-147">Clients should check the value of **PR_RESOURCE_METHODS** before attempting to call your status object.</span></span> <span data-ttu-id="46fec-148">Обработка вызовов любого из неподдерживаемых методов путем возвращения МАПИ_Е_НО_СУППОРТ.</span><span class="sxs-lookup"><span data-stu-id="46fec-148">Handle calls to any of your unsupported methods by returning MAPI_E_NO_SUPPORT.</span></span> 
    
4. <span data-ttu-id="46fec-149">Call [имаписуппорт:: модифистатусров](imapisupport-modifystatusrow.md) во время входа, чтобы добавить строку или строки в таблицу состояния.</span><span class="sxs-lookup"><span data-stu-id="46fec-149">Call [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) during logon to add your row or rows to the status table.</span></span> <span data-ttu-id="46fec-150">Передайте массив значений свойства, содержащий сведения о столбцах для строки, и значение 0 для параметра _ulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="46fec-150">Pass a property value array that contains the column information for the row and 0 for the  _ulFlags_ parameter.</span></span> <span data-ttu-id="46fec-151">Если в тот или иной момент времени в сеансе изменяется состояние поставщика, и необходимо обновить сведения о столбце, снова вызовите **модифистатусров** с установленным флагом статусров_упдате.</span><span class="sxs-lookup"><span data-stu-id="46fec-151">If at some point later in the session your provider's status changes and it becomes necessary to update the column information, call **ModifyStatusRow** again with the STATUSROW_UPDATE flag set.</span></span> 
    
<span data-ttu-id="46fec-152">Дополнительные сведения об объектах состояния приведены в разделе [объекты состояния MAPI](mapi-status-objects.md).</span><span class="sxs-lookup"><span data-stu-id="46fec-152">For more information about status objects, see [MAPI Status Objects](mapi-status-objects.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="46fec-153">См. также</span><span class="sxs-lookup"><span data-stu-id="46fec-153">See also</span></span>

- [<span data-ttu-id="46fec-154">Поставщики службы MAPI</span><span class="sxs-lookup"><span data-stu-id="46fec-154">MAPI Service Providers</span></span>](mapi-service-providers.md)

