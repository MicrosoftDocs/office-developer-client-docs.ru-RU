---
title: Потоки в MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 259297d2-acd7-4bc5-9a77-0df92cbfa33e
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 5d94aeaa75ede85983a678f448b05ad90c1e458a
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33405543"
---
# <a name="threading-in-mapi"></a>Потоки в MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Поток — это основной объект, в котором операционная система выделяет время ЦП. Поток имеет собственные регистры, стек, приоритет и хранилище, но использует адресное пространство и ресурсы для обработки, такие как маркеры доступа. Кроме того, потоки совместно используют память, и один поток читает то, что записал другой поток.
  
Клиенты MAPI используют следующие универсальные модели потоков.
  
|**Потоковая модель**|**Описание**|
|:-----|:-----|
|Модель с одним потоком  <br/> |Все объекты используются в отдельном потоке.  <br/> |
|Модель потоков подразделений  <br/> |Объект можно использовать только в создавшем его потоке.  <br/> |
|Бесплатная организация потоков или потоковая модель  <br/> |Объект можно использовать в любом потоке.  <br/> |
   
MAPI использует модель свободной потоковой модели, поддерживающую потокобезопасные объекты, которые можно использовать в любом потоке в любое время. OLE использует модель потоков подразделений. Модель потоков подразделений поддерживает объекты, которые должны быть явно переданы, если поток, отличный от того, который создал объект, должен использовать этот объект.
  
Механизм, который OLE использует для передачи объектов из одной цепочки в другую, называется маршалером. Маршалинг включает объект-заглушку и прокси-объект. Эти специальные объекты упаковывают параметры интерфейса в объект, который необходимо упаковать, перенесите эти параметры в другой поток и разработайте их при получении. Конфликт между двумя многопоточными моделями возникает при отправке объекта COM с произвольным потоком в другой процесс с помощью OLE "облегченного вызова процедур удаленного вызова" или ЛРПК. ЛРПК изменяет семантику объекта из свободных потоков в потоковые потоки, помещающий заглушки и прокси-интерфейсы с потоком подразделений между объектом и его вызывающим абонентом. Сведения о ситуациях, которые могут привести к этому конфликту в MAPI, могут помочь клиентам и поставщикам служб предотвратить возникновение проблем.
  
Доступ к объекту MAPI можно получить следующим образом:
  
- С помощью прямых вызовов к методам с помощью указателя интерфейса, возвращенного поставщиком услуг или MAPI, связанным с процессом клиента, например объектом Session, возвращенным из [мапилогонекс](mapilogonex.md).
    
- Через непрямые вызовы к методам с помощью указателя интерфейса, возвращенного любым поставщиком услуг, например, объект Folder, скопированный из другой папки в [IMAPIFolder:: CopyFolder](imapifolder-copyfolder.md).
    
- Через функцию обратного вызова, например метод [имапиадвисесинк:: OnNotify](imapiadvisesink-onnotify.md) , передаваемый поставщику услуг или в MAPI при вызове метода **advise** , или методы, которые могут показывать ход выполнения длительной операции. 
    

