---
title: Потоки в MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 259297d2-acd7-4bc5-9a77-0df92cbfa33e
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 5d94aeaa75ede85983a678f448b05ad90c1e458a
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33405543"
---
# <a name="threading-in-mapi"></a>Потоки в MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Поток — это базовая сущность, которой операционная система выделяет время ЦП. Поток имеет собственные регистры, стек, приоритет и хранилище, но он делится адресным пространством и ресурсами процесса, такими как маркеры доступа. Потоки также совместно использовать память, с одним потоком считывая, что другой поток написан.
  
Клиенты MAPI используют следующие универсальные модели потоков.
  
|**Потоковая модель**|**Описание**|
|:-----|:-----|
|Однопотоданная модель  <br/> |Все объекты используются в одном потоке.  <br/> |
|Модель потоков в многояговом оке  <br/> |Объект можно использовать только в созданном потоке.  <br/> |
|Бесплатная потоковая или потоковая сторона, модель  <br/> |Объект можно использовать в любом потоке.  <br/> |
   
MAPI использует бесплатную потоковую модель, поддерживая потокобезопасные объекты, которые можно использовать в любом потоке в любое время. OLE использует модель потоков в окнах. Потоковая модель apartment поддерживает объекты, которые должны быть явно перенесены, когда поток, не ский, который создал объект, должен использовать этот объект.
  
Механизм, который OLE использует для передачи объектов из одного потока в другой, называется маршалингом. Маршалинг включает объект загона и прокси-объект. Эти специальные объекты упаковывают параметры интерфейса в объекте для маршалации, передают эти параметры в другой поток и распаковка их по поступлению. Конфликт между двумя многопотоковыми моделями возникает, когда объект MAPI со свободной потоковой связью отправляется в другой процесс с помощью OLE "облегченного" удаленного вызова процедуры или LRPC. LRPC изменяет семантику объекта с бесплатной потоковой на потоковую связь в многоязыковом режиме, взаимодействуя с загонщиком и прокси-интерфейсами с поведением потоковой связи между объектом и его звонком. Понимание ситуаций в MAPI, которые приводят к этому конфликту, может помочь клиентам и поставщикам услуг предотвратить проблемы.
  
Можно получить доступ к объекту MAPI:
  
- Посредством прямых вызовов методов с помощью указателя интерфейса, возвращаемого поставщиком услуг или MAPI, связанного с процессом клиента, например объект сеанса, возвращенный [mapILogonEx.](mapilogonex.md)
    
- Посредством косвенных вызовов методов с помощью указателя интерфейса, возвращаемого любым поставщиком услуг, например объектом папки, скопированным из другой папки [в IMAPIFolder::CopyFolder.](imapifolder-copyfolder.md)
    
- С помощью функции вызова, такой как [метод IMAPIAdviseSink::OnNotify,](imapiadvisesink-onnotify.md) переданный поставщику услуг или MAPI в вызове advise или методы, которые могут показывать ход выполнения длительной операции.  
    

