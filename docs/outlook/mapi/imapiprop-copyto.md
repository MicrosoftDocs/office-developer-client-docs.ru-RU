---
title: имапипропкопито
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPIProp.CopyTo
api_type:
- COM
ms.assetid: e56042e9-5bb7-4a99-b6de-1546d4ca07f0
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: f76b0a5482647fe3e181a36d7dcd8cb60ffc8985
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32356394"
---
# <a name="imapipropcopyto"></a>IMAPIProp::CopyTo

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Копирует или перемещает все свойства, кроме специально исключенных свойств.
  
```cpp
HRESULT CopyTo(
 ULONG ciidExclude,
 LPCIID rgiidExclude,
 LPSPropTagArray lpExcludeProps,
 ULONG_PTR ulUIParam,
 LPMAPIPROGRESS lpProgress,
 LPCIID lpInterface,
 LPVOID lpDestObj,
 ULONG ulFlags,
 LPSPropProblemArray FAR * lppProblems
);
```

## <a name="parameters"></a>Параметры

 _Циидексклуде_
  
> возврата Количество интерфейсов, исключаемых при копировании или перемещении свойств.
    
 _ргиидексклуде_
  
> возврата Массив идентификаторов интерфейса (ИИДС), указывающих интерфейсы, которые не следует использовать при копировании или перемещении дополнительных данных в целевой объект.
    
 _лпексклудепропс_
  
> возврата Указатель на массив тегов свойств, определяющий теги свойств, которые следует исключить из операции копирования или перемещения. При передаче **значения NULL** в параметре _лпексклудепропс_ показывается, что все свойства объекта должны быть скопированы или перемещены. **CopyTo** возвращает MAPI_E_INVALID_PARAMETER, когда элемент **квалуес** структуры [Спроппроблемаррай](spropproblemarray.md) , на который указывает _лпексклудепропс_ , имеет значение 0. 
    
 _улуипарам_
  
> возврата Дескриптор родительского окна индикатора хода выполнения. 
    
 _лппрогресс_
  
> возврата Указатель на реализацию индикатора хода выполнения. Если в параметре _лппрогресс_ передается **значение NULL** , MAPI предоставляет реализацию хода выполнения. Параметр _лппрогресс_ игнорируется, если в параметре _ulFlags_ не задан флаг MAPI_DIALOG. 
    
 _лпинтерфаце_
  
> возврата Указатель на идентификатор интерфейса (IID), представляющий интерфейс, который будет использоваться для доступа к объекту, на который указывает параметр _лпдестобж_ . Параметр _лпинтерфаце_ не должен иметь **значение NULL**.
    
 _лпдестобж_
  
> возврата Указатель на объект, который будет получать скопированные или перемещенные свойства.
    
 _ulFlags_
  
> возврата Битовая маска флагов, управляющих операциями копирования или перемещения. Можно задать следующие флаги:
    
MAPI_DECLINE_OK 
  
> Если **CopyTo** вызывает метод [Имаписуппорт::D окопито](imapisupport-docopyto.md) для обработки операции копирования или перемещения, он должен вместо этого возвращаться сразу со значением ошибки MAPI_E_DECLINE_COPY. Флаг MAPI_DECLINE_OK задается MAPI для ограничения рекурсии. Клиенты не устанавливают этот флаг. 
    
MAPI_DIALOG 
  
> Отображает индикатор хода выполнения.
    
MAPI_MOVE 
  
> **CopyTo** должен выполнять операцию перемещения, а не операцию копирования. Если этот флаг не установлен, **CopyTo** выполняет операцию копирования. 
    
MAPI_NOREPLACE 
  
> Существующие свойства в целевом объекте не должны быть перезаписаны. Если этот флаг не установлен, **CopyTo** перезаписывает существующие свойства. 
    
 _лпппроблемс_
  
> [вход, выход] На входе указатель на указатель на структуру **спроппроблемаррай** ; в противном случае — **значение NULL**, которое указывает на отсутствие необходимости в сведениях об ошибке. Если _лпппроблемс_ является допустимым указателем на входе, **CopyTo** возвращает подробные сведения об ошибках при копировании одного или нескольких свойств. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Свойства успешно скопированы или перемещены.
    
MAPI_E_COLLISION 
  
> Не удается скопировать подобъект, так как в целевом объекте уже существует **доPR_DISPLAY_NAME** с таким же отображаемым именем, что и в свойстве ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)). 
    
MAPI_E_DECLINE_COPY 
  
> Поставщик услуг не реализует операцию копирования.
    
MAPI_E_FOLDER_CYCLE 
  
> Исходный объект, выполняющий операцию копирования или перемещения напрямую или косвенно, содержит целевой объект. Прежде чем было обнаружено это условие, можно выполнить значительную работу, чтобы исходный и конечный объекты могли быть изменены частично. 
    
MAPI_E_INTERFACE_NOT_SUPPORTED 
  
> Интерфейс, определенный параметром _лпинтерфаце_ , не поддерживается целевым объектом. 
    
MAPI_E_NO_ACCESS 
  
> Предпринята попытка получить доступ к объекту, для которого вызывающая сторона не имеет достаточных разрешений. Эта ошибка возвращается, если целевой объект совпадает с исходным объектом.
    
Следующие значения могут возвращаться в структуре **спроппроблемаррай** , но не в качестве возвращаемых значений для **CopyTo**. Следующие ошибки относятся к одному свойству:
  
MAPI_E_BAD_CHARWIDTH 
  
> Установлен установленный флаг MAPI_UNICODE, а **CopyTo** не поддерживает Юникод, или MAPI_UNICODE не задан, а **CopyTo** поддерживает только Юникод. 
    
MAPI_E_COMPUTED 
  
> Абонент не может изменить свойство, так как оно является свойством только для чтения, которое вычисляется владельцем целевого объекта. Эта ошибка не серьезна; вызывающая сторона должна разрешить продолжение операции копирования.
    
MAPI_E_INVALID_TYPE 
  
> Недопустимый тип свойства.
    
MAPI_E_UNEXPECTED_TYPE 
  
> Тип свойства не является типом, ожидаемым вызывающим абонентом.
    
## <a name="remarks"></a>Примечания

По умолчанию метод **IMAPIProp:: CopyTo** копирует или перемещает все свойства текущего объекта в целевой объект. **CopyTo** используется при точном копировании или перемещении объекта со всеми или большинством его свойств без изменения. 
  
Любые подобъекты в исходном объекте автоматически включаются в операцию, и они полностью копируются или перемещаются. По умолчанию **CopyTo** перезаписывает все свойства в целевом объекте, которые совпадают со свойствами исходного объекта. Если какие-либо из скопированных или перемещенных свойств уже существуют в целевом объекте, существующие свойства перезаписываются новыми свойствами, если не установлен флаг MAPI_NOREPLACE в параметре _ulFlags_ . Существующие сведения в целевом объекте, которые не перезаписываются, остаются нетронутыми. 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

Вы можете предоставить полную реализацию **CopyTo** или использовать реализацию MAPI в своем объекте поддержки. Если вы хотите использовать реализацию MAPI, вызовите **имаписуппорт::D окопито**. Тем не менее, если вы выполняете обработку делегата в **докопито** , а флаг MAPI_DECLINE_OK передается, избегайте вызова поддержки и возврата MAPI_E_DECLINE_COPY вместо этого. Интерфейс MAPI вызывает этот флаг, чтобы избежать возможной рекурсии при копировании папок. 
  
Так как операция копирования может быть длительной, необходимо отобразить индикатор хода выполнения. Используйте реализацию [IMAPIProgress](imapiprogressiunknown.md) , переданную в параметре _лппрогресс_ , если таковая имеется. Если _лппрогресс_ имеет **значение NULL**, вызовите метод [имаписуппорт::D ОПРОГРЕССДИАЛОГ](imapisupport-doprogressdialog.md) , чтобы использовать реализацию MAPI. 
  
Не пытайтесь задать в целевом объекте все известные свойства, предназначенные только для чтения; Вместо этого возвращается MAPI_E_NO_ACCESS.
  
Исходный и конечный объекты должны использовать одни и те же интерфейсы. Возвращает MAPI_E_INVALID_PARAMETER, если _лпинтерфаце_ не задан. 
  
Возвращает MAPI_E_INTERFACE_NOT_SUPPORTED, если все известные интерфейсы исключены.
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

Не задавайте флаг MAPI_DECLINE_OK; MAPI использует его в вызовах реализаций **CopyTo** для поставщика хранилища сообщений. 
  
Так как операции копирования и перемещения могут занимать некоторое время, вы должны запросить отображение индикатора хода выполнения, установив флаг MAPI_DIALOG. Вы можете задать для параметра _лппрогресс_ реализацию **IMAPIProgress**, если таковая имеется, или **значение NULL**. Если _лппрогресс_ имеет **значение NULL**, то **CopyTo** будет использовать индикатор хода выполнения по умолчанию, предоставляемый MAPI. 
  
Вы можете отключить отображение индикатора хода выполнения, не устанавливая флаг MAPI_DIALOG. **CopyTo** будет игнорировать параметры _улуипарам_ и _лппрогресс_ и не будет отображать индикатор. 
  
 **CopyTo** может сообщать о глобальных и отдельных ошибках, а также об ошибках, произошедших с одним или несколькими свойствами. Эти отдельные ошибки помещаются в структуру **спроппроблемаррай** . Вы можете отключить отчеты об ошибках на уровне свойств, передав **значение NULL**вместо допустимого указателя для параметра структуры массива проблем свойств. 
  
Если вы хотите получать сведения об ошибках, передайте допустимый указатель структуры **спроппроблемаррай** в параметр _лпппроблемс_ . Когда **CopyTo** возвращает S_OK, проверьте наличие ошибок с отдельными свойствами в структуре. Когда **CopyTo** возвращает ошибку, в структуре **спроппроблемаррай** никакие данные не возвращаются. Вместо этого вызовите [IMAPIProp:: GetLastError](imapiprop-getlasterror.md) , чтобы получить подробные сведения об ошибке. 
  
Если **CopyTo** возвращает S_OK, освободите возвращенную структуру **спроппроблемаррай** , вызвав функцию [мапифрибуффер](mapifreebuffer.md) . 
  
При копировании свойств, которые являются уникальными для типа исходного объекта, необходимо убедиться в том, что целевой объект относится к тому же типу. **CopyTo** не препятствует связыванию свойств, которые обычно принадлежат одному типу объекта с другим типом объекта. Вы можете скопировать свойства, которые имеют смысл для целевого объекта. Например, не следует копировать свойства сообщений в контейнер адресной книги. 
  
Чтобы гарантировать копирование между объектами одного типа, убедитесь, что исходный объект и целевой объект имеют один и тот же тип, сравнивая указатели объектов или вызывая [IUnknown:: QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx). Присвойте идентификатору интерфейса, на который указывает _лпинтерфаце_ , стандартный интерфейс для исходного объекта. Кроме того, убедитесь, что для двух объектов используется одинаковый тип объекта или свойство **PR_OBJECT_TYPE** ([PidTagObjectType](pidtagobjecttype-canonical-property.md)). Например, при копировании из сообщения задайте для параметра _лпинтерфаце_ значение IID_IMessage и **PR_OBJECT_TYPE** для обоих объектов MAPI_MESSAGE. 
  
Если в параметре _лпдестобж_ передан недопустимый указатель, результаты будут непредсказуемыми. 
  
Кроме того, можно использовать свойства, не включенные в вызов **CopyTo** . Например, у некоторых объектов есть свойства, характерные для одного экземпляра объекта, такие как Дата и время доставки сообщения. Чтобы избежать копирования времени доставки сообщения при копировании сообщения в другую папку, укажите **PR_MESSAGE_DELIVERY_TIME** ([PidTagMessageDeliveryTime](pidtagmessagedeliverytime-canonical-property.md)) в теге свойства Exclude Array. Чтобы исключить список получателей сообщения, добавьте свойство **PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) в массив Exclude. Чтобы исключить вложения сообщения, добавьте в массив свойство **PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)).
  
Аналогичным образом, не следует блокировать копирование или перемещение папки или таблицы иерархии контейнера или адресной книги, включив **PR_CONTAINER_HIERARCHY** ([PidTagContainerHierarchy](pidtagcontainerhierarchy-canonical-property.md)) или **PR_CONTAINER_CONTENTS** ([PidTagContainerContents](pidtagcontainercontents-canonical-property.md)) в тег свойства Exclude Array.
  
Чтобы исключить свойства из операции копирования или перемещения, добавьте их теги свойств в параметр _лпексклудепропс_ . Если вы передаете результаты макроса **PROP_TAG** для создания тега свойства из определенного идентификатора в массиве тегов свойств, все свойства с этим идентификатором будут исключены. Например, следующая запись в массиве тегов свойств вызывает исключение всех свойств с идентификатором 0x8002, независимо от типа. 
  
 `PROP_TAG(PT_LONG, 0x8002)`
  
Тег свойства **PR_NULL** ([PidTagNull](pidtagnull-canonical-property.md)) не может быть включен в массив _лпексклудепропс_ . 
  
Возможность использования функции **CopyTo** для исключения интерфейсов, вероятно, не очевидна для использования при исключении свойств. Вы можете исключить интерфейс при копировании в объект, не имеющий сведений о группе свойств. Например, если вы копируете свойства из папки во вложение, единственными свойствами, с которыми может работать вложение, являются универсальные свойства, доступные в любой реализации [IMAPIProp](imapipropiunknown.md) . При исключении [IMAPIFolder](imapifolderimapicontainer.md) из операции копирования вложение не будет получать какие – либо более конкретные свойства папки. 
  
При использовании параметра _ргиидексклуде_ для исключения интерфейса он также исключает все интерфейсы, полученные из этого интерфейса. Например, исключение [IMAPIContainer](imapicontainerimapiprop.md) вызывает исключение папок или контейнеров адресных книг, в зависимости от типа поставщика. Не следует исключать **IMAPIProp** или [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) , так как многие интерфейсы являются производными от них. 
  
Пропускать ошибки MAPI_E_COMPUTED, возвращаемые в структуре **спроппроблемаррай** в параметре _лпппроблемс_ . 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Файл. cpp  <br/> |лоадфроммсг  <br/> |MFCMAPI использует метод **IMAPIProp:: CopyTo** для копирования свойств из MSG – файла в объект [имапимессажесите](imapimessagesiteiunknown.md) .  <br/> |
|Фолдердлг. cpp  <br/> |Кфолдердлг:: Хандлепасте  <br/> |MFCMAPI использует метод **IMAPIProp:: CopyTo** для копирования свойств из исходного сообщения в целевое сообщение во время операции вставки.  <br/> |
   
## <a name="see-also"></a>См. также



[IMAPIFolder::CopyMessages](imapifolder-copymessages.md)
  
[IMAPIProp::GetLastError](imapiprop-getlasterror.md)
  
[IMAPIMessageSite : IUnknown](imapimessagesiteiunknown.md)
  
[IMAPIProgress : IUnknown](imapiprogressiunknown.md)
  
[IMAPISupport::DoProgressDialog](imapisupport-doprogressdialog.md)
  
[IMAPISupport::DoCopyTo](imapisupport-docopyto.md)
  
[MAPIFreeBuffer](mapifreebuffer.md)
  
[Каноническое свойство PidTagContainerContents](pidtagcontainercontents-canonical-property.md)
  
[Каноническое свойство PidTagContainerHierarchy](pidtagcontainerhierarchy-canonical-property.md)
  
[Каноническое свойство PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)
  
[Каноническое свойство PidTagMessageDeliveryTime](pidtagmessagedeliverytime-canonical-property.md)
  
[Каноническое свойство PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)
  
[Каноническое свойство PidTagObjectType](pidtagobjecttype-canonical-property.md)
  
[SPropProblemArray](spropproblemarray.md)
  
[SPropTagArray](sproptagarray.md)
  
[IMAPIProp : IUnknown](imapipropiunknown.md)


[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

