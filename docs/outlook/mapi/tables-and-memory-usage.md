---
title: Таблицы и использование памяти
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7ac11e60-6b2c-4241-96e2-20219f84d949
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: afd69f5a3fff69f670d6be78ba4957307cdb6995
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33436862"
---
# <a name="tables-and-memory-usage"></a>Таблицы и использование памяти

**Относится к**: Outlook 2013 | Outlook 2016 
  
Важной проблемой, связанной с искомой из таблицы данными, является использование памяти. Отсутствие доступной памяти может привести к сбойу [IMAPITable::QueryRows](imapitable-queryrows.md) и [HrQueryAllRows,](hrqueryallrows.md) возвращая меньше необходимого количества строк. Выбор метода или функции для извлечения данных таблицы зависит от того, можно ли ожидать, что таблица помещается в память, и, если это невозможно, если сбой допустим. 
  
Так как не всегда легко определить объем данных, который будет одновременно вместить в память, MAPI предоставляет некоторые основные рекомендации для клиентского приложения или поставщика услуг, которые необходимо соблюдать. Помните, что всегда существуют исключения в зависимости от конкретной реализации таблицы и того, как хранятся данные.
  
Для оценки использования памяти таблицы можно использовать следующие рекомендации:
  
- Клиенты, которые могут допускать время от времени использование памяти рабочих наборов в диапазоне мегабайт и могут предполагать, что у них не будет проблем с чтением всей таблицы в памяти. 
    
- Ограничения влияют на использование памяти в таблице. Таблица с строгим ограничением с большим количеством строк, например содержимого, может умещаться в памяти, в то время как неограниченной большой таблице обычно не удается. 
    
- Некоторые таблицы, которые принадлежат MAPI, например таблицы состояния, профиля, службы сообщений, поставщика и хранения сообщений, обычно умещаются в памяти. Как правило, это небольшие таблицы. Однако существуют исключения. Например, серверный поставщик профилей может создать таблицу профилей большего размера, которая не сможет вместить ее.
    
Чтобы извлечь все строки из таблицы, которые умещаются в памяти без проблем, вызовите [HrQueryAllRows,](hrqueryallrows.md)установив нулевое максимальное число строк.
  
Чтобы получить все строки из таблицы, которые могут или не умещаться в памяти, создавая ошибку, вызовите **HrQueryAllRows,** указав максимальное количество строк. Максимальное число строк должно быть установлено на число больше, чем минимальное количество строк, которые необходимы. Если клиенту необходимо получить доступ по крайней мере к 50 строкам из таблицы из 300 строк, максимальное число строк должно быть не менее 51. 
  
Чтобы получить все строки из таблицы, которая не помещается в память, вызовите [IMAPITable::QueryRows](imapitable-queryrows.md) в цикле с относительно небольшим количеством строк, как показано в следующем примере кода: 
  
```cpp
HRESULT     hr;
LPSRowSet   pRows = NULL;
LONG        irow;
LONG            cAsk = 50;                  // adjust this value
while ((hr = pTable->QueryRows(cAsk, 0, &pRows)) == hrSuccess
        && pRows->cRows != 0)
{
    for (irow = 0; irow < prows->cRows; ++irow)
    {
        // process the row...
    }
    FreeProws(pRows);
    pRows = NULL;
}
if (hr)
{
    // handle the error...
}
 
```

После завершения этого цикла и обработки всех строк в таблице и нулевого  _уровня cRows_ положение курсора обычно будет в нижней части таблицы. 
  
## <a name="see-also"></a>См. также

- [Таблицы MAPI](mapi-tables.md)

