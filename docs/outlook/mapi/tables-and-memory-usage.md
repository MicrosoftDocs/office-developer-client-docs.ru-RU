---
title: Таблицы и использование памяти
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7ac11e60-6b2c-4241-96e2-20219f84d949
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: afd69f5a3fff69f670d6be78ba4957307cdb6995
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33436862"
---
# <a name="tables-and-memory-usage"></a>Таблицы и использование памяти

**Относится к**: Outlook 2013 | Outlook 2016 
  
Важная ошибка, связанная с извлечением данных из таблицы, — использование памяти. Недостаток доступной памяти может вызвать сбой [IMAPITable:: QueryRows](imapitable-queryrows.md) и [хркуеряллровс](hrqueryallrows.md) , возвращая меньше требуемого количества строк. Решение о том, какой метод или функция использовать для получения табличных данных, зависит от того, может ли таблица быть вписана в память, и если это не так, то в случае неудачи. 
  
Так как вы не всегда можете определить объем данных, которые будут помещаться в память одновременно, MAPI предоставляет некоторые основные рекомендации по использованию клиентского приложения или поставщика услуг. Помните, что существуют всегда исключения, в зависимости от конкретной реализации таблицы и способа хранения базовых данных.
  
Следующие рекомендации могут использоваться для оценки использования памяти в таблицах:
  
- Клиенты, которые могут использовать периодическое использование памяти в диапазоне в мегабайтах и могут предполагать, что у них нет проблем при чтении всей таблицы в память. 
    
- Ограничения влияют на использование памяти в таблице. Строго ограниченная таблица с большим количеством строк, например таблицей содержимого, может быть вписана в память, в то время как неограниченная большая таблица обычно не может. 
    
- Некоторые таблицы, принадлежащие MAPI, такие как состояние, профиль, служба сообщений, поставщик и хранилище сообщений, обычно замещаются в памяти. Как правило, это небольшие таблицы. Однако существуют исключения. Например, поставщик профилей на основе сервера может создать более крупную таблицу профилей, которая не может быть вписана.
    
Чтобы получить все строки из таблицы, которые будут помещаться в память без проблем, вызовите [хркуеряллровс](hrqueryallrows.md), установив максимальное число строк равным нулю.
  
Чтобы получить все строки из таблицы, которые могут или не помещаться в памяти, создает ошибку, вызовите **хркуеряллровс** , указав максимальное количество строк. Максимальное число строк должно быть больше минимального требуемого количества строк. Если клиент должен получить доступ по крайней мере к 50 строк из таблицы строк 300, максимальное число строк должно быть равно по крайней мере 51. 
  
Чтобы получить все строки из таблицы, которые не соответствуют памяти, вызовите метод [IMAPITable:: QueryRows](imapitable-queryrows.md) в цикле со сравнительно небольшим количеством строк, как показано в следующем примере кода: 
  
```cpp
HRESULT     hr;
LPSRowSet   pRows = NULL;
LONG        irow;
LONG            cAsk = 50;                  // adjust this value
while ((hr = pTable->QueryRows(cAsk, 0, &pRows)) == hrSuccess
        && pRows->cRows != 0)
{
    for (irow = 0; irow < prows->cRows; ++irow)
    {
        // process the row...
    }
    FreeProws(pRows);
    pRows = NULL;
}
if (hr)
{
    // handle the error...
}
 
```

Когда этот цикл завершается, а все строки в таблице обработаны, а число _CRowset_ равно нулю, положение курсора обычно находится в нижней части таблицы. 
  
## <a name="see-also"></a>См. также

- [Таблицы MAPI](mapi-tables.md)

