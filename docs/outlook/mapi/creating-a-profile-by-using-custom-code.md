---
title: Создание профиля с помощью пользовательского кода
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5632cd25-58f5-4b9c-906c-cd377abc3daf
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: f3270528194b3cc3429d3afec153355349dabbff
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33413306"
---
# <a name="creating-a-profile-by-using-custom-code"></a>Создание профиля с помощью пользовательского кода

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Если вы напишете код для создания профиля, убедитесь, что вы знаете, как упорядочивать записи профиля, а также тип и количество сведений, необходимых для каждой записи. Влияние порядка записей в профиле объясняется в профилях [MAPI](mapi-profiles.md).
  
 **Создание профиля с кодом C или C++**
  
1. ПроЧтите файл заголовка для каждой службы сообщений. Сведения о свойствах, которые необходимо настроить, и значениях, которые будут использоваться.
    
2. ВыЗовите функцию [мапиадминпрофилес](mapiadminprofiles.md) , чтобы получить указатель интерфейса **ипрофадмин** . 
    
3. Call [ипрофадмин:: креатепрофиле](iprofadmin-createprofile.md) для создания профиля. Если вы хотите создать профиль с помощью служб сообщений, перечисленных в разделе **[службы по умолчанию]** элемента Mapisvc. INF-файл, установите флаг МАПИ_ДЕФАУЛТ_СЕРВИЦЕ. Если вы хотите разрешить пользователю вводить сведения о конфигурации, установите флаг МАПИ_ДИАЛОГ. Убедитесь, что установлен этот флаг, если не все необходимые сведения доступны через MAPISVC. INF-файл. **Креатепрофиле** вызывает функцию точки входа для каждой службы сообщений, которую необходимо добавить в профиль с мсг_сервице_креате, установленным в качестве параметра _улконтекст_ . 
    
4. Call [ипрофадмин:: админсервицес](iprofadmin-adminservices.md) для получения объекта администрирования службы сообщений. 
    
5. Добавьте службы сообщений в профиль с помощью объекта администрирования службы сообщений. Для каждой службы сообщений, которую необходимо добавить:
    
1. ВыЗовите метод [имсгсервицеадмин:: креатемсгсервице](imsgserviceadmin-createmsgservice.md) , чтобы создать новую службу сообщений. 
    
2. Call [имсгсервицеадмин:: конфигуремсгсервице](imsgserviceadmin-configuremsgservice.md), передача структуры **мапиуид** только что созданной службы и массива значений свойств с его свойствами конфигурации. 
    
6. Чтобы получить идентификатор недавно добавленной службы, которая является свойством **пр_сервице_уид** ([PidTagServiceUid](pidtagserviceuid-canonical-property.md)), вызовите [имсгсервицеадмин:: жетмсгсервицетабле](imsgserviceadmin-getmsgservicetable.md) для доступа к таблице службы сообщений и поиска строки, представляющей Служба сообщений. Последняя строка в таблице будет представлять недавно добавленную службу сообщений. 
    
Чтобы создать временный профиль, вызовите метод [ипрофадмин::D елетепрофиле](iprofadmin-deleteprofile.md) сразу после входа в систему. **Делетепрофиле** будет помечать новый профиль как удаленный, пока он будет использоваться в течение сеанса. Так как он не будет включен в таблицу профилей сеанса, другие клиенты не смогут ее использовать. 
  

