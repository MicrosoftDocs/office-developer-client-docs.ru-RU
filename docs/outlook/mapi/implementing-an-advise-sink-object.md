---
title: Реализация объекта -висящего объекта advise
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: ecaad65d28f74b843b86ca82dab9a833ade77363
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412109"
---
# <a name="implementing-an-advise-sink-object"></a><span data-ttu-id="c44a6-103">Реализация объекта-мяконсульта</span><span class="sxs-lookup"><span data-stu-id="c44a6-103">Implementing an Advise Sink Object</span></span>

  
  
<span data-ttu-id="c44a6-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="c44a6-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="c44a6-105">Клиент может либо реализовать собственные объекты-токонсультаторы, либо использовать с использованием функции [HrAllocAdviseSink.](hrallocadvisesink.md)</span><span class="sxs-lookup"><span data-stu-id="c44a6-105">A client can either implement its own advise sink objects or use a utility function, [HrAllocAdviseSink](hrallocadvisesink.md).</span></span> <span data-ttu-id="c44a6-106">**HrAllocAdviseSink** создает объект-конвемент с реализацией **OnNotify,** которая вызывает функцию вызова.</span><span class="sxs-lookup"><span data-stu-id="c44a6-106">**HrAllocAdviseSink** creates an advise sink object with an implementation of **OnNotify** that invokes a callback function.</span></span> 
  
<span data-ttu-id="c44a6-107">Использование **HrAllocAdviseSink** имеет свои преимущества и недостатки.</span><span class="sxs-lookup"><span data-stu-id="c44a6-107">There are advantages and disadvantages to using **HrAllocAdviseSink**.</span></span> <span data-ttu-id="c44a6-108">Он может сохранять работу, но не управляет подсчетом создаемого объекта-тонаконфера.</span><span class="sxs-lookup"><span data-stu-id="c44a6-108">It can save work, but it provides no control over reference counting the advise sink object that it creates.</span></span> <span data-ttu-id="c44a6-109">Таким образом, клиенты, которые должны тщательно контролировать выпуск своего мнимого химзаконфера или у них есть взаимозависимые отношения между их офертованной висякой и другим клиентом, должны создать собственную реализацию **IMAPIAdviseSink** и не использовать **HrAllocAdviseSink** вообще.</span><span class="sxs-lookup"><span data-stu-id="c44a6-109">Therefore, clients that need to carefully control their advise sink's release or that have interdependencies between their advise sink and another client object should construct their own **IMAPIAdviseSink** implementation and avoid using **HrAllocAdviseSink** altogether.</span></span> 
  
<span data-ttu-id="c44a6-110">Клиент, реализующий собственный обсчет, должен сделать его независимым объектом, не связанным с другими объектами или зависимым от других объектов, чтобы избежать потенциальных сложностей при подсчете ссылок и выпуске объектов.</span><span class="sxs-lookup"><span data-stu-id="c44a6-110">A client implementing its own advise sink should make it an independent object not related to or dependent upon any other objects so as to eliminate potential complications in reference counting and object release.</span></span> <span data-ttu-id="c44a6-111">Тем не менее, если вам необходимо реализовать обсвечивую точку как часть другого объекта или включить обратный указатель на другой объект в качестве члена данных, рекомендуется поддерживать два отдельных отсчета: один для объекта, на который ссылается обсферивщик, и второй для рекомендованного.</span><span class="sxs-lookup"><span data-stu-id="c44a6-111">However, if you must implement your advise sink as part of another object or include a back pointer to another object as a data member, it is recommended that two separate reference counts be maintained: one for the object referenced by the advise sink and one for the advise sink.</span></span> 
  
<span data-ttu-id="c44a6-112">Когда количество ссылок на объект, на который ссылается ссылка, становится нулем, все его методы могут не работать и его висячий объект может быть уничтожен, но память приемника рекомендации должна оставаться неизменной до тех пор, пока количество ссылок не станет равно нулю.</span><span class="sxs-lookup"><span data-stu-id="c44a6-112">When the reference count of the referenced object falls to zero, all of its methods can fail and its vtable can be destroyed, but the memory for the advise sink must remain intact until after its reference count also falls to zero.</span></span> <span data-ttu-id="c44a6-113">Это означает, что метод **release** приемника рекомендации должен демилитировать количество ссылок и завершить уничтожение объекта, когда это количество достигнет нуля.</span><span class="sxs-lookup"><span data-stu-id="c44a6-113">This means that the advise sink's **Release** method must decrement its reference count and finish destroying the object when that count reaches zero.</span></span> <span data-ttu-id="c44a6-114">Если два отдельных подсчета ссылок не поддерживаются, будет легко случайно уничтожать офертовку как часть процесса **выпуска** охватывающего объекта.</span><span class="sxs-lookup"><span data-stu-id="c44a6-114">If two separate reference counts are not maintained, it would be easy to inadvertently destroy the advise sink as part of the encompassing object's **Release** process.</span></span> 
  
<span data-ttu-id="c44a6-115">**Клиенты, использующие HrAllocAdviseSink** для реализации приемника рекомендации, должны быть одинаково осторожны, чтобы не включать функцию вызова в качестве метода в другой объект приемника рекомендации.</span><span class="sxs-lookup"><span data-stu-id="c44a6-115">Clients using **HrAllocAdviseSink** to implement an advise sink must be equally careful not to include their callback function as a method in another advise sink object.</span></span> <span data-ttu-id="c44a6-116">Для клиентов C++ возникает желание сделать это  и передать этот указатель в качестве параметра.</span><span class="sxs-lookup"><span data-stu-id="c44a6-116">For C++ clients, it is tempting to do this and pass the  _this_ pointer as a parameter.</span></span> <span data-ttu-id="c44a6-117">Это опасный стратегия, так как клиенты обычно освободить объект, когда его количество ссылок достигает нуля.</span><span class="sxs-lookup"><span data-stu-id="c44a6-117">This is a dangerous strategy because clients typically free an object when its reference count reaches zero.</span></span> <span data-ttu-id="c44a6-118">Если освободить память для объекта-токонвейера с консультацией, этот указатель станет недопустимым. </span><span class="sxs-lookup"><span data-stu-id="c44a6-118">Freeing the memory for the advise sink object would render the  _this_ pointer invalid.</span></span> 
  
<span data-ttu-id="c44a6-119">В зависимости от типа события и источника консультации метод **OnNotify** может обрабатывать события различными способами.</span><span class="sxs-lookup"><span data-stu-id="c44a6-119">Depending on the type of event and the advise source, your **OnNotify** method can handle events in various ways.</span></span> <span data-ttu-id="c44a6-120">В следующей таблице предлагаются рекомендации по обработке некоторых стандартных событий.</span><span class="sxs-lookup"><span data-stu-id="c44a6-120">The following table offers suggestions in how to handle some of the standard events.</span></span> 
  
|<span data-ttu-id="c44a6-121">**Тип события**</span><span class="sxs-lookup"><span data-stu-id="c44a6-121">**Type of event**</span></span>|<span data-ttu-id="c44a6-122">**Обработка в OnNotify**</span><span class="sxs-lookup"><span data-stu-id="c44a6-122">**Handling in OnNotify**</span></span>|
|:-----|:-----|
|<span data-ttu-id="c44a6-123">Объект перемещен</span><span class="sxs-lookup"><span data-stu-id="c44a6-123">Object moved</span></span>  <br/> |<span data-ttu-id="c44a6-124">Если исходный родительский объект перемещен с новым родительским объектом, обновите представление, начиная с папки или контейнера адресной книги, который находится на самом высоком уровне в иерархии.</span><span class="sxs-lookup"><span data-stu-id="c44a6-124">If the moved object's original parent is related to the new parent, update the view beginning with the folder or address book container highest in the hierarchy.</span></span> <span data-ttu-id="c44a6-125">Если два родительских контейнера не связаны друг с другом, обновите оба представления.</span><span class="sxs-lookup"><span data-stu-id="c44a6-125">If the two parent containers are unrelated, update both of their views.</span></span>  <br/> |
|<span data-ttu-id="c44a6-126">Новое сообщение</span><span class="sxs-lookup"><span data-stu-id="c44a6-126">New message</span></span>  <br/> |<span data-ttu-id="c44a6-127">Измените пользовательский интерфейс, чтобы сообщить пользователю о поступлении одного или более новых сообщений.</span><span class="sxs-lookup"><span data-stu-id="c44a6-127">Change the user interface to inform the user of the arrival of one or more new messages.</span></span> <span data-ttu-id="c44a6-128">Поместите папку получения в текущее представление.</span><span class="sxs-lookup"><span data-stu-id="c44a6-128">Place the receive folder in the current view.</span></span>  <br/> |
|<span data-ttu-id="c44a6-129">Error</span><span class="sxs-lookup"><span data-stu-id="c44a6-129">Error</span></span>  <br/> |<span data-ttu-id="c44a6-130">Для всех объектов, кроме сеанса, занося ошибку в журнал при необходимости и возвращая ее.</span><span class="sxs-lookup"><span data-stu-id="c44a6-130">For all objects except the session, log the error if necessary and return.</span></span> <span data-ttu-id="c44a6-131">Если это возможно, выйдите из объекта сеанса.</span><span class="sxs-lookup"><span data-stu-id="c44a6-131">For the session object, log off if possible.</span></span>  <br/> |
|<span data-ttu-id="c44a6-132">Поиск завершен</span><span class="sxs-lookup"><span data-stu-id="c44a6-132">Search complete</span></span>  <br/> |<span data-ttu-id="c44a6-133">Обработка не требуется.</span><span class="sxs-lookup"><span data-stu-id="c44a6-133">No processing necessary.</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="c44a6-134">Обработчики уведомлений должны быть повторно перенаправлены.</span><span class="sxs-lookup"><span data-stu-id="c44a6-134">Notification handlers should be reentrant.</span></span> 
  

