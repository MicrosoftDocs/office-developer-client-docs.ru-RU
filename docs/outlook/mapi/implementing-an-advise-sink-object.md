---
title: Реализация объекта -висящего объекта advise
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: ecaad65d28f74b843b86ca82dab9a833ade77363
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412109"
---
# <a name="implementing-an-advise-sink-object"></a>Реализация объекта-мяконсульта

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Клиент может либо реализовать собственные объекты-токонсультаторы, либо использовать с использованием функции [HrAllocAdviseSink.](hrallocadvisesink.md) **HrAllocAdviseSink** создает объект-конвемент с реализацией **OnNotify,** которая вызывает функцию вызова. 
  
Использование **HrAllocAdviseSink** имеет свои преимущества и недостатки. Он может сохранять работу, но не управляет подсчетом создаемого объекта-тонаконфера. Таким образом, клиенты, которые должны тщательно контролировать выпуск своего мнимого химзаконфера или у них есть взаимозависимые отношения между их офертованной висякой и другим клиентом, должны создать собственную реализацию **IMAPIAdviseSink** и не использовать **HrAllocAdviseSink** вообще. 
  
Клиент, реализующий собственный обсчет, должен сделать его независимым объектом, не связанным с другими объектами или зависимым от других объектов, чтобы избежать потенциальных сложностей при подсчете ссылок и выпуске объектов. Тем не менее, если вам необходимо реализовать обсвечивую точку как часть другого объекта или включить обратный указатель на другой объект в качестве члена данных, рекомендуется поддерживать два отдельных отсчета: один для объекта, на который ссылается обсферивщик, и второй для рекомендованного. 
  
Когда количество ссылок на объект, на который ссылается ссылка, становится нулем, все его методы могут не работать и его висячий объект может быть уничтожен, но память приемника рекомендации должна оставаться неизменной до тех пор, пока количество ссылок не станет равно нулю. Это означает, что метод **release** приемника рекомендации должен демилитировать количество ссылок и завершить уничтожение объекта, когда это количество достигнет нуля. Если два отдельных подсчета ссылок не поддерживаются, будет легко случайно уничтожать офертовку как часть процесса **выпуска** охватывающего объекта. 
  
**Клиенты, использующие HrAllocAdviseSink** для реализации приемника рекомендации, должны быть одинаково осторожны, чтобы не включать функцию вызова в качестве метода в другой объект приемника рекомендации. Для клиентов C++ возникает желание сделать это  и передать этот указатель в качестве параметра. Это опасный стратегия, так как клиенты обычно освободить объект, когда его количество ссылок достигает нуля. Если освободить память для объекта-токонвейера с консультацией, этот указатель станет недопустимым.  
  
В зависимости от типа события и источника консультации метод **OnNotify** может обрабатывать события различными способами. В следующей таблице предлагаются рекомендации по обработке некоторых стандартных событий. 
  
|**Тип события**|**Обработка в OnNotify**|
|:-----|:-----|
|Объект перемещен  <br/> |Если исходный родительский объект перемещен с новым родительским объектом, обновите представление, начиная с папки или контейнера адресной книги, который находится на самом высоком уровне в иерархии. Если два родительских контейнера не связаны друг с другом, обновите оба представления.  <br/> |
|Новое сообщение  <br/> |Измените пользовательский интерфейс, чтобы сообщить пользователю о поступлении одного или более новых сообщений. Поместите папку получения в текущее представление.  <br/> |
|Error  <br/> |Для всех объектов, кроме сеанса, занося ошибку в журнал при необходимости и возвращая ее. Если это возможно, выйдите из объекта сеанса.  <br/> |
|Поиск завершен  <br/> |Обработка не требуется.  <br/> |
   
> [!NOTE]
> Обработчики уведомлений должны быть повторно перенаправлены. 
  

