---
title: PreprocessMessage
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPI.PreprocessMessage
api_type:
- COM
ms.assetid: dda50325-74b3-445e-986e-115f6536561f
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: a3982520cb1c745874a938962ece075a294b6257
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33437247"
---
# <a name="preprocessmessage"></a>PreprocessMessage

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Определяет функцию, которая предварительно обрабатывает содержимое сообщения или формат сообщения.
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Маписпи. h  <br/> |
|Определенная функция реализована следующим образом:  <br/> |Поставщики транспорта  <br/> |
|Определенная функция, вызываемая:  <br/> |Диспетчер очереди MAPI  <br/> |
   
```cpp
HRESULT PreprocessMessage(
  LPVOID lpvSession,
  LPMESSAGE lpMessage,
  LPADRBOOK lpAdrBook,
  LPMAPIFOLDER lpFolder,
  LPALLOCATEBUFFER AllocateBuffer,
  LPALLOCATEMORE AllocateMore,
  LPFREEBUFFER FreeBuffer,
  ULONG FAR * lpcOutbound,
  LPMESSAGE FAR * FAR * lpppMessage,
  LPADRLIST FAR * lppRecipList
);
```

## <a name="parameters"></a>Параметры

 _лпвсессион_
  
> возврата Указатель на сеанс, который необходимо использовать. 
    
 _лпмессаже_
  
> возврата Указатель на сообщение, которое необходимо обработать. 
    
 _лпадрбук_
  
> возврата Указатель на адресную книгу, из которой пользователь должен выбрать получателей сообщения. 
    
 _лпфолдер_
  
> [вход, выход] Указатель на папку. Во входных данных параметр _лпфолдер_ указывает на папку, в которой содержатся сообщения, которые должны быть предварительно обработаны. В выходных данных _лпфолдер_ указывает папку, в которой были размещены предварительно обработанные сообщения. 
    
 _лпаллокатебуффер_
  
> возврата Указатель на функцию [мапиаллокатебуффер](mapiallocatebuffer.md) , которая будет использоваться для выделения памяти. 
    
 _лпаллокатеморе_
  
> возврата Указатель на функцию [мапиаллокатеморе](mapiallocatemore.md) , которая будет использоваться для выделения дополнительной памяти там, где это необходимо. 
    
 _лпфрибуффер_
  
> возврата Указатель на функцию [мапифрибуффер](mapifreebuffer.md) , который будет использоваться для освобождения памяти. 
    
 _лпкаутбаунд_
  
> вышли Указатель на число сообщений в массиве, на которое указывает параметр _лпппмессаже_ . 
    
 _лпппмессаже_
  
> вышли Указатель на указатель на массив указателей, которые должны быть предварительно обработаны или были созданы другими сообщениями. 
    
 _лппреЦиплист_
  
> вышли Указатель на необязательную возвращенную структуру [ADRLIST](adrlist.md) , в которой перечисляются необнаруженные получатели, для которых сообщение не может быть доставлено. Для получения дополнительных сведений о содержимом этого списка см метод [имаписуппорт:: статусреЦипс](imapisupport-statusrecips.md) . 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK
  
> Содержимое сообщения было успешно обработано.
    
## <a name="remarks"></a>Примечания

Предварительная обработка сообщений транспортного поставщика может показывать во время предварительной обработки сообщения индикатор хода выполнения. Тем не менее, не должно отображаться диалоговое окно, требующее взаимодействия с пользователем во время предварительной обработки сообщений. 
  
Когда препроцессор добавляет большие объемы данных в исходящее сообщение, необходимо выполнить определенные процедуры. Этот тип сообщения может храниться в хранилище сообщений на сервере, что привело к тому, что препроцессор получает доступ к удаленному хранилищу, длительное время. Чтобы избежать этого, у предварительной обработки должен быть параметр, позволяющий хранить данные, которые занимают большое количество места в локальном хранилище сообщений, и предоставлять ссылку на это локальное хранилище в сообщении. 
  
Предварительная обработка не должна освобождать объекты, изначально переданные в функцию на основе **препроцессмессаже** . 
  
Прежде чем диспетчер очереди MAPI сможет вызвать функцию **препроцессмессаже** , поставщик транспорта должен зарегистрировать функцию в вызове метода [Имаписуппорт:: регистерпрепроцессор](imapisupport-registerpreprocessor.md) . После вызова функции **препроцессмессаже** Диспетчер очереди не может продолжить отправку сообщения, пока функция не вернет значение. 
  
Диспетчер очереди MAPI владеет задачей отправки сообщений. Это означает, что исходное сообщение никогда не помещается в массив указателей сообщений и что вызов методов **субмитмессаже** не требуется. 
  
## <a name="see-also"></a>См. также



[IAddrBook : IMAPIProp](iaddrbookimapiprop.md)
  
[IMAPIFolder : IMAPIContainer](imapifolderimapicontainer.md)
  
[IMAPISupport: IUnknown](imapisupportiunknown.md)

