---
title: IABProviderLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IABProvider.Logon
api_type:
- COM
ms.assetid: f9468715-1674-4d14-81c8-2f24dbaa0453
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 59c6d4a05c91511ad8c481fd4ddbe42396442190
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32348785"
---
# <a name="iabproviderlogon"></a>IABProvider::Logon

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Устанавливает подключение к активному сеансу.
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG ulFlags,
  ULONG FAR * lpulcbSecurity,
  LPBYTE FAR * lppbSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPABLOGON FAR * lppABLogon
);
```

## <a name="parameters"></a>Параметры

 _lpMAPISup_
  
> [in] Указатель на объект поддержки поставщика адресной книги.
    
 _ulUIParam_
  
> [in] Handle to the parent window for the logon dialog box that the **Logon** method displays, if allowed. Параметр _ulUIParam_ содержит значение параметра с тем же именем, переданное MAPI в предыдущем вызове функции [MAPILogonEx.](mapilogonex.md) 
    
 _lpszProfileName_
  
> [in] Указатель на имя профиля сеанса.
    
 _ulFlags_
  
> [in] Битоваяmas флагов, которая управляет выполнением выполнения для этого. Можно установить следующие флаги:
    
AB_NO_DIALOG 
  
> Поставщик не должен отображать диалоговое окно во время логотипа. Если этот флаг не установлен, поставщик может отобразить диалоговое окно с запросом на отсутствие сведений о конфигурации.
    
MAPI_DEFERRED_ERRORS 
  
> Позволяет **успешно возвращаться** при возврате, возможно, до завершения процесса. 
    
MAPI_UNICODE 
  
> Все строки должны быть в формате Юникод. Если флаг MAPI_UNICODE не установлен, строки должны быть в формате ANSI.
    
 _lpulcbSecurity_
  
> [in, out] Указатель на размер структуры учетных данных безопасности (в bytes), на который указывает параметр _lppbSecurity._ При вводе значение должно быть неzero; в выходных данных значение должно быть нулем. В обоих случаях указатели должны быть действительными. 
    
 _lppbSecurity_
  
> [in, out] Указатель на указатель на учетные данные безопасности. При вводе значение должно быть неzero; в выходных данных значение должно быть нулем. В обоих случаях указатель должен быть действительным.
    
 _lppMAPIError_
  
> [out] Указатель на указатель на структуру [MAPIERROR.](mapierror.md) Для _параметра lppMAPIError_ можно установить NULL, если не существует возвращаемой структуры **MAPIERROR.** 
    
 _lppABLogon_
  
> [out] Указатель на указатель на объект для логотипа поставщика.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Подключение к активному сеансу успешно установлено.
    
MAPI_E_FAILONEPROVIDER 
  
> Поставщик не может войти в систему, но MAPI может продолжать входить в систему других поставщиков в службе сообщений, к которой принадлежит поставщик. 
    
MAPI_E_UNCONFIGURED 
  
> У поставщика недостаточно сведений для завершения работы с данными. MAPI вызывает функцию записи службы сообщений поставщика.
    
MAPI_E_UNKNOWN_CPID 
  
> Сервер не настроен для поддержки кодовой страницы клиента.
    
MAPI_E_UNKNOWN_LCID 
  
> Сервер не настроен для поддержки сведений о региональных настройках клиента.
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию, обычно нажав  кнопку "Отмена" в диалоговом окне для запуска. 
    
## <a name="remarks"></a>Примечания

Подключения устанавливаются с каждым поставщиком адресной книги в профиле сеанса, когда клиент вызывает метод [IMAPISession::OpenAddressBook.](imapisession-openaddressbook.md) **Затем OpenAddressBook** вызывает метод **logon** каждого поставщика. 
  
Имя профиля, на которое указывает параметр _lpszProfileName,_ отображается в наборе символов клиента пользователя, как указано присутствием или отсутствием флага MAPI_UNICODE в параметре _ulFlags._ 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

В реализации метода **Logon** вызовите метод [IMAPISupport::SetProviderUID](imapisupport-setprovideruid.md) для регистрации уникального идентификатора или [структуры MAPIUID.](mapiuid.md) Каждый из ваших объектов будет иметь идентификатор записи, который включает **этот MAPIUID.** MAPI использует **MAPIUID для** совпадения объекта с поставщиком. Например, когда клиент вызывает метод [IMAPISession::OpenEntry](imapisession-openentry.md) для открытия пользователя обмена сообщениями, **OpenEntry** проверяет **часть MAPIUID** переданного идентификатора записи и соотнося ее с **MAPIUID,** зарегистрированным поставщиком адресной книги. 
  
Если клиент входит в систему у поставщика несколько раз, может потребоваться зарегистрировать другой **MAPIUID** для каждого входа. Регистрация уникальных **структур MAPIUID** позволяет MAPI правильно маршрутировать запросы на соответствующий экземпляр поставщика. Однако может потребоваться, чтобы каждый объект для логотипа мог использовать один **MAPIUID.** В этом случае необходимо иметь возможность самостоятельно обрабатывать маршруты, а не полагаться на MAPI. Дополнительные сведения о создании **MAPIUID** см. в документе [Registering Service Provider Unique Identifiers.](registering-service-provider-unique-identifiers.md)
  
Объект поддержки, который MAPI передает методу **Logon** в _параметре lpMAPISup,_ предоставляет доступ ко многим методам, включенным в [интерфейс IMAPISupport : IUnknown.](imapisupportiunknown.md) MAPI создает объект поддержки, настроенный для вашего типа поставщика. Например, если при установлении подключения необходимо войти в систему обмена сообщениями или службу каталогов, можно вызвать метод [IMAPISupport::OpenProfileSection,](imapisupport-openprofilesection.md) чтобы получить учетные данные безопасности для этого конкретного сеанса входа. 
  
В **случае успешного** выполнения logon убедитесь, что вызовите метод [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28VS.85%29.aspx) объекта поддержки для инкрементного подсчета ссылок. Это позволяет поставщику удерживать указатель объекта поддержки в течение остального сеанса. Если не вызвать этот метод **AddRef,** MAPI выгрузит вашего поставщика. 
  
Имя профиля, переданное в  _параметре lpszProfileName,_ можно включить в диалоговые окна ошибок, экраны для логотипа или другие пользовательские интерфейсы. Чтобы использовать имя профиля, скопируйте его в выделенное хранилище. 
  
Создайте объект для логотипа и вернете на него указатель в _параметре lppABLogon._ MAPI использует этот объект для выполнения вызовов методов в реализации [IABLogon.](iablogoniunknown.md) 
  
Если вам требуется пароль во время логин, вы можете отобразить диалоговое окно для AB_NO_DIALOG, только если флаг AB_NO_DIALOG не установлен. Если пользователь отменяет процесс, как правило, нажав кнопку "Отмена" в диалоговом окне, MAPI_E_USER_CANCEL учетной **записи.** 
  
Как правило, если поставщику адресной книги не удается войти в систему, MAPI отключает службу сообщений, к которой принадлежит поставщик, к которому относится сбой, то есть MAPI не будет пытаться установить подключения для других поставщиков, которые принадлежат службе в течение остального времени существования сеанса. Однако если поставщику не удается установить подключение и вы не хотите отключать всю службу, MAPI_E_FAILONEPROVIDER или MAPI_E_UNCONFIGURED. MAPI не отключит службу сообщений, к которой принадлежит поставщик. 
  
Возвращает MAPI_E_FAILONEPROVIDER ошибки, недостаточно серьезной для предотвращения установления подключений другими поставщиками в службе сообщений. Возвращайте MAPI_E_UNCONFIGURED, если в профиле отсутствуют необходимые сведения о конфигурации и вы не можете отобразить диалоговое окно с запросом пользователя. MAPI в ответ вызывает функцию точки входа службы сообщений поставщика с параметром  _MSG_SERVICE_CONFIGURE ulContext,_ чтобы предоставить службе возможность программной настройки или использования листа свойств. После завершения работы функции точки входа службы сообщений MAPI повторно искомый вход. 
  
## <a name="see-also"></a>См. также



[IABLogon::Logoff](iablogon-logoff.md)
  
[IABLogon::OpenEntry](iablogon-openentry.md)
  
[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)
  
[IMAPISupport::SetProviderUID](imapisupport-setprovideruid.md)
  
[MSGSERVICEENTRY](msgserviceentry.md)
  
[IABProvider : IUnknown](iabprovideriunknown.md)

