---
title: Иабпровидерлогон
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IABProvider.Logon
api_type:
- COM
ms.assetid: f9468715-1674-4d14-81c8-2f24dbaa0453
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 59c6d4a05c91511ad8c481fd4ddbe42396442190
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32348785"
---
# <a name="iabproviderlogon"></a>IABProvider::Logon

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Устанавливает подключение к активному сеансу.
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG ulFlags,
  ULONG FAR * lpulcbSecurity,
  LPBYTE FAR * lppbSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPABLOGON FAR * lppABLogon
);
```

## <a name="parameters"></a>Параметры

 _Лпмаписуп_
  
> возврата Указатель на объект поддержки поставщика адресных книг.
    
 _Улуипарам_
  
> возврата Дескриптор родительского окна для диалогового окна входа, который отображается в методе **logon** , если это разрешено. Параметр _улуипарам_ содержит значение параметра с таким же именем, переДАННОЕ в MAPI при предыдущем вызове функции [мапилогонекс](mapilogonex.md) . 
    
 _Лпсзпрофиленаме_
  
> возврата Указатель на имя профиля сеанса.
    
 _ulFlags_
  
> возврата Битовая маска флагов, определяющая способ выполнения входа. Можно задать следующие флаги:
    
АБ_НО_ДИАЛОГ 
  
> Поставщик не должен отображать диалоговое окно во время входа. Если этот флаг не установлен, поставщик может отобразить диалоговое окно, предлагающее пользователю указать отсутствующие сведения о конфигурации.
    
МАПИ_ДЕФЕРРЕД_ЕРРОРС 
  
> Обеспечивает успешный **Вход в систему** , возможно, до завершения процесса входа. 
    
MAPI_UNICODE 
  
> Все строки должны быть в формате Юникод. Если флаг МАПИ_УНИКОДЕ не установлен, строки должны быть в формате ANSI.
    
 _Лпулкбсекурити_
  
> [вход, выход] Указатель на размер структуры учетных данных безопасности (в байтах), на которую указывает параметр _лппбсекурити_ . На входе значение должно быть ненулевым; в выходных данных значение должно быть равно нулю. В обоих случаях указатели должны быть допустимыми. 
    
 _Лппбсекурити_
  
> [вход, выход] Указатель на указатель учетных данных безопасности. На входе значение должно быть ненулевым; в выходных данных значение должно быть равно нулю. В обоих случаях указатель должен быть допустимым.
    
 _Лппмапиеррор_
  
> вышли Указатель на указатель на структуру [мапиеррор](mapierror.md) . Параметр _лппмапиеррор_ может иметь значение null, если структура **мапиеррор** для возврата отсутствует. 
    
 _Лппаблогон_
  
> вышли Указатель на указатель на объект входа поставщика.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Успешно установлено подключение к активному сеансу.
    
МАПИ_Е_ФАИЛОНЕПРОВИДЕР 
  
> Поставщик не может войти в систему, но MAPI может продолжать выполнять вход других поставщиков в службе сообщений, к которой принадлежит поставщик. 
    
МАПИ_Е_УНКОНФИГУРЕД 
  
> У поставщика недостаточно сведений для завершения входа. MAPI вызывает функцию ввода службы сообщений поставщика.
    
МАПИ_Е_УНКНОВН_КПИД 
  
> Сервер не настроен для поддержки кодовой страницы клиента.
    
МАПИ_Е_УНКНОВН_ЛЦИД 
  
> Сервер не настроен для поддержки информации о языковых стандартах клиента.
    
МАПИ_Е_УСЕР_КАНЦЕЛ 
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне входа в систему. 
    
## <a name="remarks"></a>Примечания

Подключения устанавливаются с каждым поставщиком адресных книг в профиле сеанса, когда клиент вызывает метод [IMAPISession:: опенаддрессбук](imapisession-openaddressbook.md) . Затем **опенаддрессбук** вызывает метод **входа** каждого поставщика. 
  
Имя профиля, на которое указывает параметр _лпсзпрофиленаме_ , отображается в наборе символов клиента пользователя, как указано в параметре присутствия или отсутствия флага мапи_уникоде в параметре _ulFlags_ . 
  
## <a name="notes-to-implementers"></a>Примечания для исполнителей

В реализации метода **logon** вызовите метод [Имаписуппорт:: сетпровидеруид](imapisupport-setprovideruid.md) для регистрации уникального идентификатора или структуры [мапиуид](mapiuid.md) . Каждый из объектов будет иметь идентификатор записи, включающий этот **мапиуид**. MAPI использует **мапиуид** для согласования объекта со своим поставщиком. Например, когда клиент вызывает метод [IMAPISession:: OpenEntry](imapisession-openentry.md) для открытия пользователя обмена сообщениями, **OpenEntry** проверяет часть **мапиуид** переданного идентификатора записи и сопоставляет ее с **мапиуид** , зарегистрированным Поставщик адресных книг. 
  
Если клиент входит в систему поставщика несколько раз, можно зарегистрировать другой **мапиуид** для каждого входа в систему. Регистрация уникальных структур **мапиуид** позволяет MAPI правильно маршрутизировать запросы к соответствующему экземпляру поставщика. Однако может потребоваться, чтобы каждый объект logon совместно использовать один **мапиуид**. В этом случае необходимо иметь возможность самостоятельно обрабатывать маршрутизацию, а не полагаться на MAPI. Дополнительные сведения о том, как создать **мапиуид**, приведены в статье [Регистрация уникальных идентификаторов поставщиков служб](registering-service-provider-unique-identifiers.md).
  
Объект поддержки, который MAPI передает методу **logon** , в параметре _лпмаписуп_ предоставляет доступ ко многим методам, включенным в интерфейс [имаписуппорт: IUnknown](imapisupportiunknown.md) . MAPI создает объект поддержки, настроенный на тип поставщика. Например, если необходимо выполнить вход в базовую систему обмена сообщениями или службу каталогов при установлении подключения, можно вызвать метод [имаписуппорт:: опенпрофилесектион](imapisupport-openprofilesection.md) для получения учетных данных безопасности для этого конкретного сеанса входа. 
  
Если **Вход** выполнен успешно, убедитесь, что вы вызовите метод [IUnknown:: AddRef](https://msdn.microsoft.com/library/ms691379%28VS.85%29.aspx) объекта support, чтобы увеличить значение счетчика ссылок. Это позволяет поставщику хранить указатель на объект поддержки для оставшейся части сеанса. Если не вызывать этот метод **AddRef** , то MAPI выгружает поставщика. 
  
Вы можете включить имя профиля, переданное в параметре _лпсзпрофиленаме_ в диалоговых окнах ошибок, диалоговых окнах входа или других пользовательских интерфейсах. Чтобы использовать имя профиля, скопируйте его в выделенное хранилище. 
  
Создайте объект logon и возвратите ему указатель на него в параметре _лппаблогон_ . MAPI использует этот объект для входа, чтобы вызывать методы в реализации [иаблогон](iablogoniunknown.md) . 
  
Если вы запрашиваете пароль при входе в систему, отображать диалоговое окно входа в систему, только если не установлен флаг АБ_НО_ДИАЛОГ. Если пользователь отменяет вход в систему, то, как правило, при нажатии кнопки **Отмена** в диалоговом окне возвращается значение мапи_е_усер_канцел из поля **Вход**.
  
Как правило, когда поставщик адресной книги не может войти в систему, MAPI отключает службу сообщений, к которой принадлежит неисправность поставщика, то есть MAPI не пытается установить подключения для других поставщиков, принадлежащих службе, для оставшейся части сеанса. время жизни. Тем не менее, если поставщик не может установить подключение и вы не хотите отключать всю службу, возвращается значение МАПИ_Е_ФАИЛОНЕПРОВИДЕР или МАПИ_Е_УНКОНФИГУРЕД. MAPI не отключит службу сообщений, к которой относится поставщик. 
  
Возвращает МАПИ_Е_ФАИЛОНЕПРОВИДЕР, если возникла ошибка, которая не является достаточно серьезной для предотвращения установки подключений другими поставщиками в службе сообщений. Возвращает МАПИ_Е_УНКОНФИГУРЕД, если в профиле отсутствуют необходимые сведения о конфигурации, и не удается отобразить диалоговое окно для приглашения пользователя. MAPI ответит, вызвав функцию точки входа службы сообщений поставщика с МСГ_СЕРВИЦЕ_КОНФИГУРЕ, установленным в качестве параметра _улконтекст_ , чтобы предоставить службе возможность настроить себя либо программно, либо с помощью таблицы свойств. После завершения функции точки входа службы сообщений MAPI повторяет попытку входа. 
  
## <a name="see-also"></a>См. также



[IABLogon::Logoff](iablogon-logoff.md)
  
[IABLogon::OpenEntry](iablogon-openentry.md)
  
[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)
  
[IMAPISupport::SetProviderUID](imapisupport-setprovideruid.md)
  
[MSGSERVICEENTRY](msgserviceentry.md)
  
[IABProvider : IUnknown](iabprovideriunknown.md)

