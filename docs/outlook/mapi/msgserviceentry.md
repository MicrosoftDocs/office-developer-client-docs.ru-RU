---
title: MSGSERVICEENTRY
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPI.MSGSERVICEENTRY
api_type:
- COM
ms.assetid: 655774a6-588c-44c7-903b-4497b7eccbc2
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 56a5f153dbd563397b9216af32a715692d0876d7
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32341610"
---
# <a name="msgserviceentry"></a>MSGSERVICEENTRY

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Определяет прототип функции точки входа службы сообщений для поддержки конфигурации службы сообщений. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Маписпи. h  <br/> |
|Определенная функция реализована следующим образом:  <br/> |Службы сообщений  <br/> |
|Определенная функция, вызываемая:  <br/> |MAPI  <br/> |
   
```cpp
HRESULT MSGSERVICEENTRY(
  HINSTANCE hInstance,
  LPMALLOC lpMalloc,
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  ULONG ulFlags,
  ULONG ulContext,
  ULONG cValues,
  LPSPropValue lpProps,
  LPPROVIDERADMIN lpProviderAdmin,
  LPMAPIERROR FAR * lppMapiError
);
```

## <a name="parameters"></a>Параметры

 _hInstance_
  
> возврата Дескриптор экземпляра службы Провидердлл. Дескриптор обычно используется для извлечения ресурсов. 
    
 _Лпмаллок_
  
> возврата Указатель на объект распределителя памяти, который предоставляет интерфейс для **выделения** OLE. При работе с определенными интерфейсами, такими как **IStream**, службе сообщений может потребоваться использовать этот метод распределения. 
    
 _Лпмаписуп_
  
> возврата Указатель на [имаписуппорт:](imapisupportiunknown.md) реализация интерфейса IUnknown. 
    
 _Улуипарам_
  
> возврата Зависящее от реализации значение, используемое для передачи сведений о пользовательском интерфейсе в функцию или ноль. Параметр _улуипарам_ является дескриптором родительского окна для диалогового окна Configuration и имеет тип HWND (приведение к улонг_птр). Нулевое значение указывает, что родительское окно отсутствует. 
    
 _ulFlags_
  
> возврата Битовая маска флагов, указывающих параметры функции записи службы. Можно задать следующие флаги:
    
MAPI_UNICODE 
  
> Переданные строки имеют формат Юникод. Если флаг МАПИ_УНИКОДЕ не установлен, строки представлены в формате ANSI. 
    
МСГ_СЕРВИЦЕ_УИ_РЕАД_ОНЛИ 
  
> Пользовательский интерфейс конфигурации службы должен отображать текущую конфигурацию, но не разрешать пользователю его изменять. 
    
СЕРВИЦЕ_УИ_АЛЛОВЕД 
  
> Разрешает отображение диалогового окна конфигурации при необходимости. Если установлен флаг СЕРВИЦЕ_УИ_АЛЛОВЕД, диалоговое окно должно отображаться только в том случае, если массив значений свойства _лппропс_ пуст или не содержит допустимой конфигурации. Если СЕРВИЦЕ_УИ_АЛЛОВЕД не задано, диалоговое окно по-прежнему может отображаться, если установлен флаг СЕРВИЦЕ_УИ_АЛВАЙС. 
    
УИ_КУРРЕНТ_ПРОВИДЕР_ФИРСТ 
  
> ЗаПрашивает отображение диалогового окна Конфигурация для активного поставщика поверх других диалоговых окон. 
    
СЕРВИЦЕ_УИ_АЛВАЙС 
  
> Служба сообщений должна отображать диалоговое окно конфигурации. Если флаг СЕРВИЦЕ_УИ_АЛВАЙС не установлен, диалоговое окно конфигурации по-прежнему может отображаться, если установлен флаг СЕРВИЦЕ_УИ_АЛЛОВЕД, а сведения о конфигурации недоступны в массиве значений свойства _лппропс_ . Для СЕРВИЦЕ_УИ_АЛЛОВЕД или СЕРВИЦЕ_УИ_АЛВАЙС необходимо задать разрешение отображения пользовательского интерфейса. 
    
 _Улконтекст_
  
> возврата Операция конфигурации, выполняемая в настоящее время MAPI. Параметр _улконтекст_ будет содержать одно из следующих значений: 
    
МСГ_СЕРВИЦЕ_КОНФИГУРЕ 
  
> В профиль необходимо внести изменения в конфигурацию службы. Если установлен флаг СЕРВИЦЕ_УИ_АЛВАЙС, служба должна отображать диалоговое окно настройки. Диалоговое окно также должно отображаться, если установлен флаг СЕРВИЦЕ_УИ_АЛЛОВЕД, а параметр _лппропс_ пуст или не содержит допустимых данных конфигурации. Если _лппропс_ содержит допустимые данные, диалоговое окно не должно отображаться, и служба должна использовать эти данные для внесения изменений в конфигурацию. 
    
МСГ_СЕРВИЦЕ_КРЕАТЕ 
  
> Служба добавляется в профиль. Если установлен флаг СЕРВИЦЕ_УИ_АЛВАЙС или СЕРВИЦЕ_УИ_АЛЛОВЕД, служба должна отображать диалоговое окно настройки. Если не задан ни один из этих флагов, произойдет ошибка службы. 
    
МСГ_СЕРВИЦЕ_ДЕЛЕТЕ 
  
> Служба удаляется из профиля. После получения этого события служба должна вернуть значение S_OK.
    
МСГ_СЕРВИЦЕ_ИНСТАЛЛ 
  
> Служба установлена на рабочую станцию пользователя с помощью сети, гибкого диска или другого внешнего носителя. После получения этого события служба, как правило, возвращает значение S_OK. 
    
МСГ_СЕРВИЦЕ_ПРОВИДЕР_КРЕАТЕ 
  
> Запрос создания службой дополнительного экземпляра поставщика. Если служба поддерживает эту операцию, она должна вызывать [ипровидерадмин:: креатепровидер](iprovideradmin-createprovider.md). Если служба не поддерживает эту операцию, она может вернуть МАПИ_Е_НО_СУППОРТ. 
    
МСГ_СЕРВИЦЕ_ПРОВИДЕР_ДЕЛЕТЕ 
  
> ЗаПрашивает удаление экземпляра поставщика службой. Если служба поддерживает эту операцию, она должна вызывать [ипровидерадмин::D елетепровидер](iprovideradmin-deleteprovider.md). Если служба не поддерживает эту операцию, она может вернуть МАПИ_Е_НО_СУППОРТ.
    
МСГ_СЕРВИЦЕ_УНИНСТАЛЛ 
  
> Служба удаляется. После получения этого события служба может выполнять какие – либо задачи очистки, которые необходимо выполнить, прежде чем служба завершится, а затем вернется со значением Success. Если пользователь отменяет удаление, служба должна возвратить МАПИ_Е_УСЕР_КАНЦЕЛ. 
    
 _Квалуес_
  
> возврата Количество значений свойств в массиве, на которое указывает параметр _лппропс_ . Если MAPI не передает значения свойств, значение параметра _квалуес_ равно нулю. 
    
 _Лппропс_
  
> возврата Указатель на необязательный массив структуры [спропвалуе](spropvalue.md) , указывающий значения для свойств, поддерживаемых поставщиком, которые функция будет использовать при настройке службы сообщений. Функция использует этот параметр только в том случае, если для параметра _улконтекст_ задано значение мсг_сервице_конфигуре. Этот параметр обычно используется для передачи пути к файлу для службы на основе файлов, например, службе личной адресной книги. Если в параметре _ulFlags_ не передается флаг мсг_сервице_конфигуре, параметр _лппропс_ должен равняться нулю. 
    
 _Лппровидерадмин_
  
> возврата Указатель на [ипровидерадмин: интерфейс IUnknown](iprovideradminiunknown.md) , который функция может использовать для определения местонахождения разделов профилей для определенного поставщика в текущей службе сообщений. 
    
 _Лппмапиеррор_
  
> вышли Указатель на структуру [мапиеррор](mapierror.md) . Структура выделяется с помощью функции [мапиаллокатебуффер](mapiallocatebuffer.md) . Все элементы являются необязательными, несмотря на то что большинство структур содержит допустимую строку сообщения об ошибке в элементе _лпсзеррор_ . Если присутствуют члены _лпсзкомпонент_ или _лпсзеррор_ структуры, их память, в конечном итоге, должна быть освобождена одним вызовом [мапифрибуффер](mapifreebuffer.md) в базовой структуре. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> ����� ������� � ������ ��������� ��������� ��� ��������. 
    
МАПИ_Е_УНКОНФИГУРЕД 
  
> Поставщик услуг не настроен. 
    
МАПИ_Е_УСЕР_КАНЦЕЛ 
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне. 
    
МАПИ_Е_НО_СУППОРТ 
  
> Поставщик либо не поддерживает изменения в его объектах, либо не поддерживает уведомления об изменениях. 
    
МАПИ_Е_БАД_ЧАРВИДС 
  
> Установлен либо флаг МАПИ_УНИКОДЕ, либо реализация не поддерживает Юникод, или МАПИ_УНИКОДЕ не задано, а реализация поддерживает только Юникод.
    
## <a name="remarks"></a>Комментарии

Функция, определенная с помощью прототипа функции **мсгсервицеентри** , позволяет службам сообщений настраивать себя или выполнять другие действия, зависящие от службы. Функция в основном предводит диалоговое окно, в котором пользователь может изменять параметры, характерные для службы сообщений. Кроме того, он может поддерживать программную конфигурацию с помощью массива значений свойства, переданного в параметре _лппропс_ . Программная конфигурация является необязательной, если служба не поддерживает мастер профилей, для которого он необходим. 
  
MAPI вызывает эту точку входа из приложения панели управления или в ответ на вызов клиентского приложения [имсгсервицеадмин:: креатемсгсервице](imsgserviceadmin-createmsgservice.md) или [Имсгсервицеадмин:: конфигуремсгсервице](imsgserviceadmin-configuremsgservice.md). 
  
MAPI не накладывает ограничений на имя функции, которую служба сообщений использует для прототипа **мсгсервицеентри** , но предпочитает имя **сервицеентри**. Для функции отсутствует ограничение по порядковому номеру, а одна библиотека DLL поставщика может содержать более одной функции. Однако только одна из этих функций может называться **сервицеентри**. 
  
Служба сообщений может использовать функцию [буилддисплайтабле](builddisplaytable.md) и метод [Имаписуппорт::D оконфигпропшит](imapisupport-doconfigpropsheet.md) для упрощения реализации диалогового окна настройки. 
  
Пользователь может отменить операцию МСГ_СЕРВИЦЕ_УНИНСТАЛЛ. В этом случае функция **сервицеентри** должна проверить, что служба не должна удаляться и возвращать мапи_е_усер_канцел, если служба остается установленной. 
  
Функция, основанная на прототипе **мсгсервицеентри** , возвращает одно из значений HRESULT, перечисленных в списке. MAPI пересылает это значение при ответе на вызов клиента в [имсгсервицеадмин:: конфигуремсгсервице](imsgserviceadmin-configuremsgservice.md). 
  
Службы сообщений, в которых экспортируется функция записи службы, должны включать свойства **пр_сервице_длл_наме** ([PidTagServiceDllName](pidtagservicedllname-canonical-property.md)) и **пр_сервице_ентри_наме** ([PidTagServiceEntryName](pidtagserviceentryname-canonical-property.md)) в разделе Служба сообщений в разделе MAPISVC. INF. 
  

