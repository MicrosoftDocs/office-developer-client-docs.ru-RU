---
title: MSGSERVICEENTRY
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPI.MSGSERVICEENTRY
api_type:
- COM
ms.assetid: 655774a6-588c-44c7-903b-4497b7eccbc2
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 56a5f153dbd563397b9216af32a715692d0876d7
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33427880"
---
# <a name="msgserviceentry"></a>MSGSERVICEENTRY

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Определяет прототип функции точки входа службы сообщений для поддержки конфигурации службы сообщений. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapispi.h  <br/> |
|Определяемая функция, реализованная в:  <br/> |Службы сообщений  <br/> |
|Определяемая функция, вызванная:  <br/> |MAPI  <br/> |
   
```cpp
HRESULT MSGSERVICEENTRY(
  HINSTANCE hInstance,
  LPMALLOC lpMalloc,
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  ULONG ulFlags,
  ULONG ulContext,
  ULONG cValues,
  LPSPropValue lpProps,
  LPPROVIDERADMIN lpProviderAdmin,
  LPMAPIERROR FAR * lppMapiError
);
```

## <a name="parameters"></a>Параметры

 _hInstance_
  
> [in] Обработка экземпляра поставщика службыDLL. Handle обычно используется для извлечения ресурсов. 
    
 _lpMalloc_
  
> [in] Указатель на объект-память для размещения интерфейса OLE **IMalloc.** Службе сообщений может потребоваться использовать этот метод выделения при работе с определенными интерфейсами, такими как **IStream.** 
    
 _lpMAPISup_
  
> [in] Указатель на [IMAPISupport : реализация интерфейса IUnknown.](imapisupportiunknown.md) 
    
 _ulUIParam_
  
> [in] Значение, специфичная для реализации, используемая для передачи сведений пользовательского интерфейса в функцию или ноль. Параметр  _ulUIParam_ является родительским окне для диалоговых окон конфигурации и имеет тип HWND (приведите к ULONG_PTR). Нулевое значение указывает на отсутствие родительского окна. 
    
 _ulFlags_
  
> [in] Битоваяmas флагов, указывающих параметры функции записи службы. Можно установить следующие флаги:
    
MAPI_UNICODE 
  
> Переданные строки имеют формат Юникод. Если флаг MAPI_UNICODE не установлен, строки будут в формате ANSI. 
    
MSG_SERVICE_UI_READ_ONLY 
  
> Пользовательский интерфейс конфигурации службы должен отображать текущую конфигурацию, но не разрешая пользователю изменять ее. 
    
SERVICE_UI_ALLOWED 
  
> Позволяет при необходимости отобразить диалоговое окно конфигурации. Если флаг SERVICE_UI_ALLOWED установлен, диалоговое окно должно отображаться только в том случае, если массив значений свойств  _lpProps_ пуст или не содержит допустимой конфигурации. Если SERVICE_UI_ALLOWED не установлен, диалоговое окно может по-прежнему отображаться, SERVICE_UI_ALWAYS флага. 
    
UI_CURRENT_PROVIDER_FIRST 
  
> Запрашивает отображение диалоговых окна конфигурации для активного поставщика поверх других диалоговых окнах. 
    
SERVICE_UI_ALWAYS 
  
> Требует, чтобы служба сообщений отображала диалоговое окно конфигурации. Если флаг SERVICE_UI_ALWAYS не установлен, диалоговое окно конфигурации может по-прежнему отображаться, если флаг SERVICE_UI_ALLOWED установлен и действительные сведения о конфигурации недоступны из массива значений свойств _lpProps._ Необходимо SERVICE_UI_ALLOWED или SERVICE_UI_ALWAYS, чтобы разрешить отображение пользовательского интерфейса. 
    
 _ulContext_
  
> [in] Операция настройки, которую в настоящее время выполняет MAPI. Параметр  _ulContext_ будет содержать одно из следующих значений: 
    
MSG_SERVICE_CONFIGURE 
  
> В профиль необходимо внести изменения в конфигурацию службы. Если флаг SERVICE_UI_ALWAYS установлен, служба должна отобразить диалоговое окно конфигурации. Диалоговое окно также должно отображаться, если флаг SERVICE_UI_ALLOWED установлен, а параметр  _lpProps_ пуст или не содержит допустимые данные конфигурации. Если  _lpProps_ содержит допустимые данные, диалоговое окно не должно отображаться, и служба должна использовать эти данные для изменения конфигурации. 
    
MSG_SERVICE_CREATE 
  
> Служба добавляется в профиль. Если установлен SERVICE_UI_ALWAYS или SERVICE_UI_ALLOWED, служба должна отобразить диалоговое окно конфигурации. Если ни один из флажков не установлен, служба должна не сбой. 
    
MSG_SERVICE_DELETE 
  
> Служба удаляется из профиля. После получения этого события служба должна вернуть S_OK.
    
MSG_SERVICE_INSTALL 
  
> Служба установлена на рабочей станции пользователя с сетевого, гибких дисков или другого внешнего носителя. После получения этого события служба обычно возвращает S_OK. 
    
MSG_SERVICE_PROVIDER_CREATE 
  
> Запрашивает у службы создание дополнительного экземпляра поставщика. Если служба поддерживает эту операцию, она должна вызвать [IProviderAdmin::CreateProvider](iprovideradmin-createprovider.md). Если служба не поддерживает эту операцию, она может вернуть MAPI_E_NO_SUPPORT. 
    
MSG_SERVICE_PROVIDER_DELETE 
  
> Запрашивает у службы удаление экземпляра поставщика. Если служба поддерживает эту операцию, она должна вызвать [IProviderAdmin::D eleteProvider](iprovideradmin-deleteprovider.md). Если служба не поддерживает эту операцию, она может вернуть MAPI_E_NO_SUPPORT.
    
MSG_SERVICE_UNINSTALL 
  
> Служба удаляется. После получения этого события служба может выполнить любые задачи очистки, которые должны быть выполнены до окончания работы службы, а затем возвращаться со значением успешности. Если пользователь отменяет удаление, служба должна вернуть MAPI_E_USER_CANCEL. 
    
 _cValues_
  
> [in] Количество значений свойств в массиве, на которые указывает параметр _lpProps._ Значение параметра  _cValues —_ ноль, если MAPI не передает значения свойств. 
    
 _lpProps_
  
> [in] Указатель на необязательный массив структур [SPropValue,](spropvalue.md) указывающий значения для свойств, поддерживаемых поставщиком, которые функция будет использовать при настройке службы сообщений. Функция использует этот параметр, только если для параметра  _ulContext_ установлено MSG_SERVICE_CONFIGURE. Этот параметр обычно используется для того, чтобы передать путь к файлу для файловой службы, такой как служба личной адресной книги. Если флаг MSG_SERVICE_CONFIGURE не передается в  _параметре ulFlags,_ параметр  _lpProps_ должен быть нулем. 
    
 _lpProviderAdmin_
  
> [in] Указатель на интерфейс [IProviderAdmin:IUnknown,](iprovideradminiunknown.md) который функция может использовать для поиска разделов профиля для определенного поставщика в текущей службе сообщений. 
    
 _lppMapiError_
  
> [out] Указатель на [структуру MAPIERROR.](mapierror.md) Структура выделяется функцией [MAPIAllocateBuffer.](mapiallocatebuffer.md) Все члены являются необязательными, хотя большинство структур содержат допустимую строку сообщения об ошибке в члене _lpszError._ Если присутствуют члены  _структуры lpszComponent_ или  _lpszError,_ их память должна быть освобождена одним вызовом [MAPIFreeBuffer](mapifreebuffer.md) в базовой структуре. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> ����� ������� � ������ ��������� ��������� ��� ��������. 
    
MAPI_E_UNCONFIGURED 
  
> Поставщик услуг не настроен. 
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию, обычно нажав  кнопку "Отмена" в диалоговом окне. 
    
MAPI_E_NO_SUPPORT 
  
> Поставщик либо не поддерживает изменения своих объектов, либо не поддерживает уведомление об изменениях. 
    
MAPI_E_BAD_CHARWIDTH 
  
> Либо флаг MAPI_UNICODE установлен, а реализация не поддерживает Юникод, либо MAPI_UNICODE не установлен, а реализация поддерживает только Юникод.
    
## <a name="remarks"></a>Примечания

Функция, определяемая с помощью прототипа функции **MSGSERVICEENTRY,** позволяет службам сообщений настраивать себя или выполнять другие действия, специфифиличные для служб. Функция в основном устанавливает диалоговое окно, в котором пользователь может изменить параметры, специфично для службы сообщений. Он также может поддерживать программную конфигурацию с помощью массива значений свойств, переданного в _параметре lpProps._ Программная конфигурация является необязательной, если служба не поддерживает мастер профилей, для которого она требуется. 
  
MAPI вызывает эту точку входа из приложения панели управления или в ответ на вызов клиентского приложения [IMsgServiceAdmin::CreateMsgService](imsgserviceadmin-createmsgservice.md) или [IMsgServiceAdmin::ConfigureMsgService.](imsgserviceadmin-configuremsgservice.md) 
  
MAPI не применяет ограничений к имени функции, которое служба сообщений использует для прототипа **MSGSERVICEENTRY,** но предпочитает имя **ServiceEntry.** Для функции не существует ограничений, и одна DLL поставщика может содержать несколько функций. Однако только одна из функций может иметь имя **ServiceEntry.** 
  
Служба сообщений может использовать функцию [BuildDisplayTable](builddisplaytable.md) и метод [IMAPISupport::D oConfigPropsheet](imapisupport-doconfigpropsheet.md) для упрощения реализации диалоговых окна конфигурации. 
  
Пользователь может отменить операцию MSG_SERVICE_UNINSTALL действий. В этом случае функция **ServiceEntry** должна проверить пользователя, чтобы убедиться, что служба не должна быть удалена, и возвращать MAPI_E_USER_CANCEL если служба остается установленной. 
  
Функция, основанная на **прототипе MSGSERVICEENTRY,** возвращает одно из перечисленных значений HRESULT. MAPI переадминирует это значение при ответе на вызов клиента [в службу IMsgServiceAdmin::ConfigureMsgService.](imsgserviceadmin-configuremsgservice.md) 
  
Службы сообщений, экспортируют функцию записи службы, должны включать свойства **PR_SERVICE_DLL_NAME** ([PidTagServiceDllName)](pidtagservicedllname-canonical-property.md)и **PR_SERVICE_ENTRY_NAME** ([PidTagServiceEntryName)](pidtagserviceentryname-canonical-property.md)в разделе службы сообщений MAPISVC.INF. 
  

