---
title: MSGSERVICEENTRY
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPI.MSGSERVICEENTRY
api_type:
- COM
ms.assetid: 655774a6-588c-44c7-903b-4497b7eccbc2
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 56a5f153dbd563397b9216af32a715692d0876d7
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33427880"
---
# <a name="msgserviceentry"></a>MSGSERVICEENTRY

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Определяет прототип функции точки входа службы сообщений для поддержки конфигурации службы сообщений. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapispi.h  <br/> |
|Определенные функции, реализованные в:  <br/> |Службы сообщений  <br/> |
|Определенная функция, вызванная:  <br/> |MAPI  <br/> |
   
```cpp
HRESULT MSGSERVICEENTRY(
  HINSTANCE hInstance,
  LPMALLOC lpMalloc,
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  ULONG ulFlags,
  ULONG ulContext,
  ULONG cValues,
  LPSPropValue lpProps,
  LPPROVIDERADMIN lpProviderAdmin,
  LPMAPIERROR FAR * lppMapiError
);
```

## <a name="parameters"></a>Parameters

 _hInstance_
  
> [in] Ручка экземпляра поставщика услугDLL. Ручка обычно используется для получения ресурсов. 
    
 _lpMalloc_
  
> [in] Указатель на объект-аллигатор памяти, подвергая обнажает интерфейс OLE **IMalloc.** Службе сообщений может потребоваться использовать этот метод выделения при работе с определенными интерфейсами, такими как **IStream.** 
    
 _lpMAPISup_
  
> [in] Указатель на [реализацию интерфейса IMAPISupport: IUnknown.](imapisupportiunknown.md) 
    
 _ulUIParam_
  
> [in] Значение, определенное для реализации, используемого для передачи сведений об интерфейсе пользователя в функцию или ноль. Параметр  _ulUIParam_ является родительской ручкой окна для диалогового окна конфигурации и имеет тип HWND (отлит в ULONG_PTR). Значение нуля указывает на отсутствие родительского окна. 
    
 _ulFlags_
  
> [in] Bitmask флагов с указанием параметров для функции входа в службу. Можно установить следующие флаги:
    
MAPI_UNICODE 
  
> Переданные строки находятся в формате Unicode. Если флаг MAPI_UNICODE не установлен, строки находятся в формате ANSI. 
    
MSG_SERVICE_UI_READ_ONLY 
  
> Пользовательский интерфейс конфигурации службы должен отображать текущую конфигурацию, но не позволять пользователю изменять ее. 
    
SERVICE_UI_ALLOWED 
  
> Позволяет отображать диалоговое окно конфигурации при необходимости. Когда заданная SERVICE_UI_ALLOWED, диалоговое окно должно отображаться только в том случае, если массив свойств  _lpProps_ пуст или не содержит допустимую конфигурацию. Если SERVICE_UI_ALLOWED не установлено, диалоговое окно может по-прежнему отображаться, если SERVICE_UI_ALWAYS установлен флаг. 
    
UI_CURRENT_PROVIDER_FIRST 
  
> Запросы, чтобы диалоговое окно конфигурации для активного поставщика отображалось поверх других диалоговых полей. 
    
SERVICE_UI_ALWAYS 
  
> Требуется, чтобы служба сообщений отображала диалоговое окно конфигурации. Если флаг SERVICE_UI_ALWAYS не установлен, диалоговое окно конфигурации может по-прежнему отображаться, если флаг SERVICE_UI_ALLOWED установлен и допустимые сведения о конфигурации недоступны из массива значений _свойства lpProps._ Необходимо SERVICE_UI_ALLOWED или SERVICE_UI_ALWAYS, чтобы разрешить отображение пользовательского интерфейса. 
    
 _ulContext_
  
> [in] Операция конфигурации, которую в настоящее время выполняет MAPI. Параметр  _ulContext будет_ содержать одно из следующих значений: 
    
MSG_SERVICE_CONFIGURE 
  
> Изменения в конфигурации службы должны быть внесены в профиле. Если флаг SERVICE_UI_ALWAYS установлен, служба должна отобразить диалоговое окно конфигурации. Диалоговое окно также должно отображаться, если флаг SERVICE_UI_ALLOWED установлен, а параметр  _lpProps_ пуст или не содержит допустимые данные конфигурации. Если  _lpProps содержит_ допустимые данные, диалоговое окно не должно отображаться, и служба должна использовать эти данные для изменения конфигурации. 
    
MSG_SERVICE_CREATE 
  
> Служба добавляется в профиль. Если заданная SERVICE_UI_ALWAYS или SERVICE_UI_ALLOWED, служба должна отображать диалоговое окно конфигурации. Если ни один флаг не установлен, служба должна сбой. 
    
MSG_SERVICE_DELETE 
  
> Служба удаляется из профиля. После получения этого события служба должна вернуться S_OK.
    
MSG_SERVICE_INSTALL 
  
> Служба установлена на рабочей станции пользователя с сетевого, дискетного диска или другого внешнего носителя. После получения этого события служба обычно возвращает S_OK. 
    
MSG_SERVICE_PROVIDER_CREATE 
  
> Запросы на создание службой дополнительного экземпляра поставщика. Если служба поддерживает эту операцию, она должна вызвать [IProviderAdmin::CreateProvider](iprovideradmin-createprovider.md). Если служба не поддерживает эту операцию, она может MAPI_E_NO_SUPPORT. 
    
MSG_SERVICE_PROVIDER_DELETE 
  
> Запрашивает, чтобы служба удалила экземпляр поставщика. Если служба поддерживает эту операцию, она должна вызвать [IProviderAdmin::D eleteProvider](iprovideradmin-deleteprovider.md). Если служба не поддерживает эту операцию, она может MAPI_E_NO_SUPPORT.
    
MSG_SERVICE_UNINSTALL 
  
> Служба удаляется. После получения этого события служба может выполнять любые задачи очистки, которые должны выполняться до окончания службы, а затем возвращаются со значением успешности. Если пользователь отменяет удаление, служба должна MAPI_E_USER_CANCEL. 
    
 _cValues_
  
> [in] Количество значений свойств в массиве, на который указывает _параметр lpProps._ Значение параметра  _cValues_ нулевое, если MAPI не передает значения свойств. 
    
 _lpProps_
  
> [in] Указатель на необязательный массив [структур SPropValue,](spropvalue.md) указывающий значения для свойств, поддерживаемых поставщиком, которые функция будет использовать при настройке службы сообщений. Функция использует этот параметр только в том случае, если параметр  _ulContext_ задан для MSG_SERVICE_CONFIGURE. Этот параметр обычно используется для того, чтобы передать путь к файлу для службы на основе файлов, например службы личной книги адресов. Если флаг MSG_SERVICE_CONFIGURE не передается в  _параметре ulFlags,_ параметр  _lpProps_ должен быть нулем. 
    
 _lpProviderAdmin_
  
> [in] Указатель на [интерфейс IProviderAdmin:IUnknown,](iprovideradminiunknown.md) который функция может использовать для поиска разделов профилей для конкретного поставщика в текущей службе сообщений. 
    
 _lppMapiError_
  
> [вышел] Указатель на [структуру MAPIERROR.](mapierror.md) Структура выделяется функцией [MAPIAllocateBuffer.](mapiallocatebuffer.md) Все члены являются необязательными, хотя большинство структур будет содержать допустимую строку сообщения об ошибке в _члене lpszError._ Если  _члены структуры lpszComponent_ или  _lpszError_ присутствуют, их память в конечном итоге должна быть освобождена одним вызовом [в MAPIFreeBuffer](mapifreebuffer.md) в базовой структуре. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> ����� ������� � ������ ��������� ��������� ��� ��������. 
    
MAPI_E_UNCONFIGURED 
  
> Поставщик услуг не настроен. 
    
MAPI_E_USER_CANCEL 
  
> Пользователь отменил операцию, как правило, нажав кнопку **Отмена** в диалоговом окне. 
    
MAPI_E_NO_SUPPORT 
  
> Поставщик либо не поддерживает изменения в своих объектах, либо не поддерживает уведомление об изменениях. 
    
MAPI_E_BAD_CHARWIDTH 
  
> Либо был MAPI_UNICODE флаг, а реализация не поддерживает Юникод, либо MAPI_UNICODE не установлена, а реализация поддерживает только Юникод.
    
## <a name="remarks"></a>Примечания

Функция, определяемая с помощью прототипа функции **MSGSERVICEENTRY,** позволяет службам сообщений настраивать себя или выполнять другие действия, определенные для служб. Функция в основном обставлена диалоговое окно, в котором пользователь может изменять параметры, определенные службе сообщений. Он также может поддерживать программную конфигурацию с помощью массива значений свойств, переданного в _параметре lpProps._ Программная конфигурация необязательна, если служба не поддерживает мастер профилей, для которого это необходимо. 
  
MAPI вызывает эту точку входа из приложения Панели управления или в ответ на клиентскую заявку, вызываемую [IMsgServiceAdmin::CreateMsgService](imsgserviceadmin-createmsgservice.md) или [IMsgServiceAdmin::ConfigureMsgService](imsgserviceadmin-configuremsgservice.md). 
  
MAPI не ставит никаких ограничений на имя функции, которое служба сообщений использует для прототипа **MSGSERVICEENTRY,** но предпочитает имя **ServiceEntry.** Существует никаких ограничений на ordinal для функции, и один поставщик DLL может содержать несколько функций. Однако только одна из функций может быть названа **ServiceEntry**. 
  
Служба сообщений может использовать функцию [BuildDisplayTable](builddisplaytable.md) и [метод IMAPISupport::D ConfigPropsheet](imapisupport-doconfigpropsheet.md) для упрощения реализации диалогового окна конфигурации. 
  
Пользователь может отменить операцию MSG_SERVICE_UNINSTALL. В этом случае функции **ServiceEntry** следует проверить у пользователя, чтобы убедиться, что служба не должна быть удалена и MAPI_E_USER_CANCEL, если служба остается установленной. 
  
Функция, основанная на прототипе **MSGSERVICEENTRY,** возвращает одно из перечисленных значений HRESULT. MAPI передает это значение при ответе на вызов клиента [в IMsgServiceAdmin::ConfigureMsgService](imsgserviceadmin-configuremsgservice.md). 
  
Службы сообщений, которые экспортируют функцию входа **в службу,** должны включать свойства PR_SERVICE_DLL_NAME [(PidTagServiceDllName)](pidtagservicedllname-canonical-property.md)и **PR_SERVICE_ENTRY_NAME** [(PidTagServiceEntryName)](pidtagserviceentryname-canonical-property.md)в разделе служба сообщений MAPISVC.INF. 
  

