---
title: Инициализация MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 22ee8157-d74e-4a94-9c76-b9ac736d5211
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 5fde3e7eda8d98eb5080fff360616649b1eb96a5
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2018
ms.locfileid: "25399041"
---
# <a name="initializing-mapi"></a>Инициализация MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Все клиентские приложения, использующие MAPI библиотеки необходимо вызвать функцию **MAPIInitialize** . Для получения дополнительных сведений см [MAPIInitialize](mapiinitialize.md). **MAPIInitialize** инициализирует глобальные данные для сеанса и подготавливает библиотек MAPI для приема звонков. Существует несколько флаги, необходимо задать в некоторых случаях. 
  
- MAPI_NT_SERVICE
    
    Установите для флага MAPI_NT_SERVICE вашего клиента реализуется как служба Windows. Если клиент — это служба Windows, этот флаг не задана MAPI не распознает его как службы. 
    
- MAPI_MULTITHREAD_NOTIFICATIONS
    
    Флаг MAPI_MULTITHREAD_NOTIFICATIONS относится как MAPI управляют уведомлений. MAPI создает скрытое окно, которая получает сообщения окна при внесении изменений в объект создания уведомлений. В некоторых случаях вызывает ошибку требуется отправлять уведомления и соответствующие методы [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) вызов обработки сообщений окна. 
    
- MAPI_NO_COINIT
    
    Задайте флаг MAPI_NO_COINT, чтобы **MAPIInitialize** не пытается инициализировать COM с помощью вызова [CoInitialize](https://msdn.microsoft.com/library/ms886303.aspx). Если структура **MAPIINIT_0** передается в **MAPIInitialize** с _ulFlags_ , задайте значение MAPI_NO_COINIT, MAPI будет Предположим, что COM уже инициализирована и отмены обработки вызова **CoInitialize**.
    
Если флаг MAPI_MULTITHREAD_NOTIFICATIONS не передается, MAPI создает окно уведомления в потоке, который использовался для вашего первого вызова **MAPIInitialize** . MAPI создает окно уведомления в отдельном потоке, если передается MAPI_MULTITHREAD_NOTIFICATIONS — поток предназначен для обработки уведомлений. MAPI ожидает поток, который используется для создания окно скрытых уведомления, чтобы: 
  
- Иметь цикл обработки сообщений.
    
- Остаются без блокировки в действующем сеанса.
    
- Иметь дольше любой другой поток, созданный с вашего клиента. 
    
Можно выбрать, какие потока используется путем установки флага в первом вызове **MAPIInitialize** . Опасность позволяя потоков обработки уведомлений является, если исчезает потока, уничтожается окно уведомления и больше не будут отправляться уведомления для любой из других потоков. Кроме того для управления отправки уведомлений, разнесенных по очереди сообщений скрытое окно может потребоваться специальная обработка. 
  
Если вы используете отдельное окно для обработки уведомлений, быть уверенным, что предупреждений в соответствующее время на соответствующем потоке. Код для проверки и обрабатывать сообщения Windows, которые учитываются в окне уведомления не потребуется. 
  
MAPI для создания скрытого окна для поддержки уведомлений рекомендует отдельном потоке следующие типы клиентских приложений:
  
- Все клиенты многопоточные.
    
- В одном потоке служб Windows и Win32 консольных приложений.
    
- В одном потоке клиентов, которые не нужно использовать их основной поток для уведомлений.
    
Чтобы использовать отдельный поток подход, вызовите **MAPIInitialize** на каждый поток, установка флага MAPI_MULTITHREAD_NOTIFICATIONS. 
  
> [!NOTE]
> Только это клиент первый вызов **MAPIInitialize** приводит скрытое окно будет создан для поддержки уведомлений. Последующие вызывает только причина счетчик ссылок увеличивается. 
  

