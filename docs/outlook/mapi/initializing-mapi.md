---
title: Инициализация MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 22ee8157-d74e-4a94-9c76-b9ac736d5211
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 5fde3e7eda8d98eb5080fff360616649b1eb96a5
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32309732"
---
# <a name="initializing-mapi"></a>Инициализация MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Все клиентские приложения, которые используют библиотеки MAPI, должны вызывать **функцию MAPIInitialize.** Дополнительные сведения см. в [mapIInitialize.](mapiinitialize.md) **MAPIInitialize** инициализирует глобальные данные для сеанса и подготавливает библиотеки MAPI к приему вызовов. В некоторых ситуациях важно установить несколько флагов: 
  
- MAPI_NT_SERVICE
    
    Установите флаг MAPI_NT_SERVICE, если клиент реализован в качестве службы Windows. Если ваш клиент является службой Windows и вы не установили этот флаг, MAPI не распознает его как службу. 
    
- MAPI_MULTITHREAD_NOTIFICATIONS
    
    Флаг MAPI_MULTITHREAD_NOTIFICATIONS связан с тем, как MAPI управляет уведомлениями. MAPI создает скрытое окно, которое получает сообщения о окне при внесении изменений в уведомления о создании объекта. Сообщения окон обрабатываются в определенный момент, в результате чего отправляются уведомления и вызываются соответствующие методы [IMAPIAdviseSink::OnNotify.](imapiadvisesink-onnotify.md) 
    
- MAPI_NO_COINIT
    
    Установите флаг MAPI_NO_COINT, чтобы **MAPIInitialize** не пытался инициализировать COM с помощью вызова [CoInitialize.](https://msdn.microsoft.com/library/ms886303.aspx) Если структура **MAPIINIT_0** передается в **MAPIInitialize** с _ulFlags,_ задав для него MAPI_NO_COINIT, MAPI будет предполагать, что COM уже инициализирован, и обходить вызов **CoInitialize.**
    
Если MAPI_MULTITHREAD_NOTIFICATIONS флаг не передается, MAPI создает окно уведомления в потоке, который использовался для первого вызова **MAPIInitialize.** MAPI создает окно уведомления в отдельном потоке, MAPI_MULTITHREAD_NOTIFICATIONS передается поток, выделенный для обработки уведомлений. MAPI ожидает, что поток, используемый для создания скрытого окна уведомлений, будет: 
  
- Зациклить сообщение.
    
- Не блокировка на протяжении всего сеанса.
    
- Иметь более длительный срок действия, чем любой другой поток, созданный вашим клиентом. 
    
Вы можете выбрать используемый поток, установив флаг в первом вызове **MAPIInitialize.** Опасность того, что один из потоков сможет обрабатывать уведомления, заключается в том, что если поток исчезнет, окно уведомлений будет уничтожено, а уведомления больше не будут отправлены другим потокам. Кроме того, для управления отправкой уведомлений, которые отправляются в очередь сообщений скрытого окна, может потребоваться специальная обработка. 
  
Если для обработки уведомлений используется отдельное окно, следует быть уверенным, что уведомления будут отображаться в соответствующее время в соответствующем потоке. Вам не потребуется специальный код для проверки и обработки сообщений Windows, которые опубликованы в окне уведомления. 
  
MAPI рекомендует следующим типам клиентских приложений использовать отдельный поток для создания скрытого окна для поддержки уведомлений:
  
- Все многопрочитанные клиенты.
    
- Однопотоковые службы Windows и консольные приложения Win32.
    
- Однопотоковые клиенты, которые не должны использовать основной поток для уведомления.
    
Чтобы использовать отдельный подход к потоку, вызовите **MAPIInitialize** для каждого потока, установив флаг MAPI_MULTITHREAD_NOTIFICATIONS потока. 
  
> [!NOTE]
> Только первый вызов **MAPIInitialize** клиента приводит к создания скрытого окна для поддержки уведомлений. Последующие вызовы приводят только к добавоению эталонного подсчета. 
  

