---
title: Инициализация MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 22ee8157-d74e-4a94-9c76-b9ac736d5211
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 5fde3e7eda8d98eb5080fff360616649b1eb96a5
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32309732"
---
# <a name="initializing-mapi"></a>Инициализация MAPI

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Все клиентские приложения, которые используют библиотеки MAPI, должны вызывать **функцию MAPIInitialize.** Дополнительные сведения см. в [mapIInitialize.](mapiinitialize.md) **MAPIInitialize** инициализирует глобальные данные для сеанса и готовит библиотеки MAPI к приему вызовов. В некоторых ситуациях важно установить несколько флагов: 
  
- MAPI_NT_SERVICE
    
    Установите флаг MAPI_NT_SERVICE, если клиент реализован в качестве Windows службы. Если клиент является Windows службой и вы не установите этот флаг, MAPI не распознает его как службу. 
    
- MAPI_MULTITHREAD_NOTIFICATIONS
    
    Флаг MAPI_MULTITHREAD_NOTIFICATIONS относится к управлению уведомлениями MAPI. MAPI создает скрытое окно, которое получает сообщения окна, когда происходят изменения в уведомлениях, генерирующих объект. Оконные сообщения обрабатываются в определенный момент, в результате чего отправляются уведомления и вызываются соответствующие [методы IMAPIAdviseSink::OnNotify.](imapiadvisesink-onnotify.md) 
    
- MAPI_NO_COINIT
    
    Установите флаг MAPI_NO_COINT, чтобы **MAPIInitialize** не пытался инициализировать COM с помощью вызова [coInitialize.](https://msdn.microsoft.com/library/ms886303.aspx) Если структура **MAPIINIT_0** **в MAPIInitialize** с набором  _ulFlags_ MAPI_NO_COINIT, MAPI предполагает, что com уже инициализирован, и обходить вызов **в CoInitialize**.
    
Если MAPI_MULTITHREAD_NOTIFICATIONS флаг не пройден, MAPI создает окно уведомлений в потоке, которое использовалось для первого вызова **MAPIInitialize.** MAPI создает окно уведомлений в отдельном потоке, если MAPI_MULTITHREAD_NOTIFICATIONS передается — поток, посвященный обработке уведомлений. MAPI ожидает, что поток, используемый для создания скрытого окна уведомлений, будет: 
  
- Есть цикл сообщений.
    
- Оставайся разблокирован в течение всего сеанса.
    
- У вас есть более длительный срок службы, чем любой другой поток, созданный клиентом. 
    
Вы можете выбрать, какой поток используется, установив флаг в первом **вызове MAPIInitialize.** Опасность, позволяющая одному из потоков обрабатывать уведомления, заключается в том, что если поток исчезнет, окно уведомлений будет уничтожено и уведомления больше не будут отправлены ни в один из других потоков. Кроме того, может потребоваться специальная обработка для управления отправкой сообщений уведомлений, которые размещены в очереди сообщений скрытого окна. 
  
Если для обработки уведомлений используется отдельное окно, будьте уверены, что уведомления будут отображаться в соответствующее время в соответствующем потоке. Вам не потребуется специальный код для проверки и обработки Windows сообщений, которые размещены в окне уведомлений. 
  
MAPI рекомендует следующим типам клиентских приложений использовать отдельный поток для создания скрытого окна для поддержки уведомлений:
  
- Все многоуровневые клиенты.
    
- Однопотоковые Windows и консольные приложения Win32.
    
- Клиенты с однопотокой резьбой, которые не должны использовать основной поток для уведомления.
    
Чтобы использовать отдельный подход к потоку, вызываем **MAPIInitialize** на каждом потоке, устанавливая MAPI_MULTITHREAD_NOTIFICATIONS флага. 
  
> [!NOTE]
> Только первый вызов клиента в **MAPIInitialize** создает скрытое окно для поддержки уведомлений. Последующие вызовы приводят только к приращению отсчета ссылок. 
  

