---
title: Сохранение сообщения
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 97bff16b-dc7c-4eed-8834-d0c076d83ca3
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: d5ceeb46bded101700aec696a17d690bde80ce6d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33420934"
---
# <a name="saving-a-message"></a>Сохранение сообщения

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Перед сохранением сообщения клиенты обычно вызывают метод сообщения [IMAPIProp:: SetProps](imapiprop-setprops.md) , чтобы задать несколько свойств в дополнение к свойствам текста сообщений, свойствам вложений, **пр_субжект** ([PidTagSubject](pidtagsubject-canonical-property.md)) и свойствам связан со списком получателей.
  
Задайте для свойства **пр_мессаже_класс** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) строку символов, например IPM. Обратите внимание, что описывает класс исходящего сообщения. Несмотря на то, что клиенты должны задать **пр_мессаже_класс** для всех исходящих сообщений, поставщик хранилища сообщений предоставляет значение по умолчанию, если оно не задано. Классом сообщений по умолчанию для исходящих сообщений является IPM. 
  
Установите флаг МСГФЛАГ_УНСЕНТ в свойстве **пр_мессаже_флагс** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)). При необходимости установите флаги МСГФЛАГ_РЕАД и МСГФЛАГ_УНМОДИФИЕД. Установка МСГФЛАГ_УНМОДИФИЕД позволяет имитировать доставленное сообщение в разделе композиция. МСГФЛАГ_УНМОДИФИЕД можно настроить только клиентами до первого сохранения сообщения. 
  
Когда вы будете готовы создать постоянную копию неотправленного сообщения, вызовите [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) для сообщения и всех его вложений. Если вы планируете отправить сообщение немедленно, вам не нужно вызывать **SaveChanges**. Вызов **субмитмессаже** внутренним образом сохраняет сообщение в ходе его обработки. 
  
При вызове метода **SaveChanges**рекомендуется указать флаг кип_опен_реадврите, который позволяет изменить сообщение в дальнейшем. Другие устанавливаемые флаги включают ФОРЦЕ_САВЕ, что указывает на то, что сообщение или вложение следует закрыть после фиксации изменений, КИП_ОПЕН_РЕАДОНЛИ, что означает, что дальнейшие изменения не будут выполнены, а флаг, позволяющий поставщику хранилища сообщений Пакетные запросы клиентов, МАПИ_ДЕФЕРРЕД_ЕРРОРС.
  
Необходимо вызвать метод **SaveChanges** для каждого вложения в сообщении, прежде чем вызывать метод **SaveChanges** для сообщения. Если не удается сохранить вложение, вложение не будет включено в сообщение при его отправке и не будет отображаться в таблице вложений сообщения. Если не удается сохранить сообщение после сохранения всех вложений, сообщение и вложения будут потеряны. 
  
При вызове **SaveChanges** поставщик хранилища сообщений обновляет следующие свойства: 
  
- **Пр_дисплай_то** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) — список всех основных получателей.
    
- **Пр_дисплай_то** — список всех получателей копии. 
    
- **Пр_дисплай_бкк** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) — список всех получателей скрытой копии.
    
- **Пр_ласт_модификатион_тиме** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))
    
- **Пр_мессаже_флагс** задает мсгфлаг_хасаттач, если одно или несколько вложений были сохранены, и очищает мсгфлаг_унмодифиед, чтобы показать сообщение изменилось. 
    
- **Пр_мессаже_сизе** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) содержит самый актуальный размер сообщения.
    
- **Пр_мессаже_аттачментс** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) предоставляет доступ к таблице вложений.
    
- **Пр_мессаже_реЦипиентс** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) предоставляет доступ к таблице получателей.
    
Некоторые свойства сообщений обычно предоставляются клиентами или поставщиками услуг при создании сообщения. Если клиент не задает их, он может обновляться поставщиком хранилища сообщений при вызове метода **SaveChanges** . Например, если во время создания сообщения были заданы свойства **пр_ентрид** ([PidTagEntryId](pidtagentryid-canonical-property.md)) и **пр_рекорд_кэй** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)), их не нужно изменять во время сохранения. Однако поставщики хранилищ сообщений, которые не задают их при создании сообщения, должны задавать их при первом вызове метода **SaveChanges** . 
  
Если **SaveChanges** возвращает мапи_е_коррупт_дата, предполагается, что сохраняемые данные теперь теряются. Поставщики хранилища сообщений, использующие модель клиент-сервер для реализации, могут возвращать это значение при разрыве сетевого подключения или если сервер не работает. Прежде чем вернуть пользователю сообщение об ошибке, попытайтесь записать и сохранить данные еще раз, выполнив вызов **SetProps** , а затем еще раз вызвать **SaveChanges**. Если данные кэшируются локально, это не проблема. Тем не менее, если локальный кэш отсутствует или не удается выполнить вызов **SaveChanges** , отобразится сообщение об ошибке, чтобы предупредить пользователя о проблеме. 
  

