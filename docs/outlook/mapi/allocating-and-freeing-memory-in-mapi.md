---
title: Выделение и освобождение памяти в MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 68250c5cbeaa366ed4555bb469c4e68d62302f28
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419669"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a>Выделение и освобождение памяти в MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
В дополнение к указанию способа выделения и освобождения памяти MAPI определяет модель, чтобы знать, когда память передается между методом открытого интерфейса и вызовами функций API, которые должны быть освобождены. Модель применяется только к выделенной памяти для параметров, которые не являются указателями на интерфейсы, например строки и указатели на структуры. Указатели интерфейса используют механизм подсчета ссылок, реализованный через **IUnknown**. При выделении и освобождении памяти, связанной без MAPI, внутри клиентского приложения или поставщика услуг используйте любой механизм. 
  
Модель определяет параметры как один из трех типов. Они могут быть входными параметрами, заданными вызывающим абонентом со сведениями, которые будут использоваться вызванной функцией или методом, выходными параметрами, заданными вызываемой функцией или методом и возвращенными вызывающим или входными параметрами, сочетанием двух типов. Выходные параметры часто представляют собой указатели на данные или указатели на данные. Несмотря на то, что вызываемая функция отвечает за выделение данных для выходных параметров, вызывающий абонент выделяет память для указателя. 
  
В приведенной ниже таблице описаны правила выделения и освобождения памяти для этих типов параметров.
  
|**Type**|**Выделение памяти**|**Освобождение памяти**|
|:-----|:-----|:-----|
|Input  <br/> |Вызывающий абонент является ответственным и может использовать любой механизм.  <br/> |Вызывающий абонент является ответственным и может использовать любой механизм.  <br/> |
|Output  <br/> |ВыЗываемая функция является ответственной и должна использовать **мапиаллокатебуффер**. Дополнительные сведения см. в разделе [мапиаллокатебуффер](mapiallocatebuffer.md).  <br/> |Вызывающий абонент несет ответственность и должен использовать **мапифрибуффер**. Дополнительные сведения см. в разделе [мапифрибуффер](mapifreebuffer.md).  <br/> |
|Входные данные  <br/> |Вызывающий абонент отвечает за первоначальное выделение и вызываемую функцию можно перераспределить, если это необходимо, с помощью **мапиаллокатебуффер**.  <br/> |ВыЗываемая функция отвечает за начальное освобождение, если необходимо перераспределение. Вызывающий абонент должен освободить Последнее возвращаемое значение.  <br/> |
   
Во время сбоев разработчикам методов интерфейса необходимо уделять внимание параметрам OUTPUT и Output-Output, так как вызывающий код обычно не может их очистить. Если возвращается ошибка, то каждый выходной параметр или параметр ввода вывода должен оставаться в значении, инициализированном вызывающим абонентом, или задать значение, которое можно очистить без каких-либо действий с частью вызывающего абонента. Например, параметр Output (выходной указатель) `void ** ppv` должен оставаться не так, как при вводе, или может иметь значение null ( `*ppv = NULL`).
  

