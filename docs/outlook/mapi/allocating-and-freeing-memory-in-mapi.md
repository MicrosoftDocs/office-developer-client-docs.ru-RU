---
title: В MAPI выполнив и освободив память
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 68250c5cbeaa366ed4555bb469c4e68d62302f28
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419669"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a>В MAPI выполнив и освободив память

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Помимо указания способа выделения и бесплатной памяти MAPI определяет модель для определения того, когда память передается между методом общего интерфейса и вызовами функции API. Модель применяется только к памяти, выделенной для параметров, которые не являются указателями на интерфейсы, например строки и указатели на структуры. Указатели интерфейса используют механизм отсчета ссылок, реализованный **через IUnknown.** При дележке и высвободе памяти, не связанной с MAPI, внутренне в клиентском приложении или поставщике услуг используйте любой механизм. 
  
Модель определяет параметры как один из трех типов. Это могут быть параметры ввода, заданные звонивщиком с информацией, используемой вызываемой функцией или методом, параметрами вывода, заданными вызываемой функцией или методом и возвращаемой вызываемой, или параметрами ввода-вывода, сочетанием двух типов. Параметры вывода часто указывают на данные или указатели на указатели на данные. Несмотря на то, что вызываемая функция отвечает за выделение данных для параметров вывода, звонящий выделяет память для указателя. 
  
Правила выделения и выпуска памяти для этих типов параметров объясняются в следующей таблице.
  
|**Тип**|**Выделение памяти**|**Выпуск памяти**|
|:-----|:-----|:-----|
|Input  <br/> |Вызываемая отвечает и может использовать любой механизм.  <br/> |Вызываемая отвечает и может использовать любой механизм.  <br/> |
|Выходные данные  <br/> |Вызванная функция несет ответственность и должна использовать **MAPIAllocateBuffer**. Дополнительные сведения см. в [mapIAllocateBuffer.](mapiallocatebuffer.md)  <br/> |Вызываемая отвечает и должна использовать **MAPIFreeBuffer**. Дополнительные сведения см. в [mapIFreeBuffer.](mapifreebuffer.md)  <br/> |
|Входные данные  <br/> |Вызываемая отвечает за первоначальное выделение и вызванная функция может переназначать при необходимости с помощью **MAPIAllocateBuffer**.  <br/> |Вызванная функция отвечает за начальное свободное время, если требуется перераспределение. Вызываемая должна освободить окончательное значение возврата.  <br/> |
   
В условиях сбоя для реализации методов интерфейса необходимо обращать внимание на параметры выходных данных и выходных данных, так как у вызываемого пользователя обычно нет способа их очистки. Если ошибка возвращается, то каждый выходной или выходной параметр должен быть оставлен в значении, инициализированном вызываемой стороной, или задано значение, которое можно очистить без каких-либо действий со стороны вызываемого. Например, указатель вывода должен быть оставлен так, как он был на входе или может быть задан  `void ** ppv` в NULL (  `*ppv = NULL` ).
  

