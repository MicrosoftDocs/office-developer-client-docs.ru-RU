---
title: Выделение и освобождение памяти в MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 68250c5cbeaa366ed4555bb469c4e68d62302f28
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419669"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a><span data-ttu-id="6c91c-103">Выделение и освобождение памяти в MAPI</span><span class="sxs-lookup"><span data-stu-id="6c91c-103">Allocating and Freeing Memory in MAPI</span></span>

  
  
<span data-ttu-id="6c91c-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="6c91c-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="6c91c-105">В дополнение к указанию способа выделения и освобождения памяти MAPI определяет модель, чтобы знать, когда память передается между методом открытого интерфейса и вызовами функций API, которые должны быть освобождены.</span><span class="sxs-lookup"><span data-stu-id="6c91c-105">In addition to specifying how to allocate and free memory, MAPI defines a model for knowing when memory passed between public interface method and API function calls should be freed.</span></span> <span data-ttu-id="6c91c-106">Модель применяется только к выделенной памяти для параметров, которые не являются указателями на интерфейсы, например строки и указатели на структуры.</span><span class="sxs-lookup"><span data-stu-id="6c91c-106">The model applies only to memory allocated for parameters that are not pointers to interfaces, such as strings and pointers to structures.</span></span> <span data-ttu-id="6c91c-107">Указатели интерфейса используют механизм подсчета ссылок, реализованный через **IUnknown**.</span><span class="sxs-lookup"><span data-stu-id="6c91c-107">Interface pointers use the reference counting mechanism implemented through **IUnknown**.</span></span> <span data-ttu-id="6c91c-108">При выделении и освобождении памяти, связанной без MAPI, внутри клиентского приложения или поставщика услуг используйте любой механизм.</span><span class="sxs-lookup"><span data-stu-id="6c91c-108">When allocating and freeing non-MAPI related memory internally within a client application or service provider, use whatever mechanism makes sense.</span></span> 
  
<span data-ttu-id="6c91c-109">Модель определяет параметры как один из трех типов.</span><span class="sxs-lookup"><span data-stu-id="6c91c-109">The model defines parameters as one of three types.</span></span> <span data-ttu-id="6c91c-110">Они могут быть входными параметрами, заданными вызывающим абонентом со сведениями, которые будут использоваться вызванной функцией или методом, выходными параметрами, заданными вызываемой функцией или методом и возвращенными вызывающим или входными параметрами, сочетанием двух типов.</span><span class="sxs-lookup"><span data-stu-id="6c91c-110">They can be input parameters, set by the caller with information to be used by the called function or method, output parameters, set by the called function or method and returned to the caller, or input-output parameters, a combination of the two types.</span></span> <span data-ttu-id="6c91c-111">Выходные параметры часто представляют собой указатели на данные или указатели на данные.</span><span class="sxs-lookup"><span data-stu-id="6c91c-111">Output parameters are frequently pointers to data or pointers to pointers to data.</span></span> <span data-ttu-id="6c91c-112">Несмотря на то, что вызываемая функция отвечает за выделение данных для выходных параметров, вызывающий абонент выделяет память для указателя.</span><span class="sxs-lookup"><span data-stu-id="6c91c-112">Although the called function is responsible for allocating the data for output parameters, the caller allocates the memory for the pointer.</span></span> 
  
<span data-ttu-id="6c91c-113">В приведенной ниже таблице описаны правила выделения и освобождения памяти для этих типов параметров.</span><span class="sxs-lookup"><span data-stu-id="6c91c-113">The rules for allocating and releasing memory for these types of parameters are explained in the following table.</span></span>
  
|<span data-ttu-id="6c91c-114">**Тип**</span><span class="sxs-lookup"><span data-stu-id="6c91c-114">**Type**</span></span>|<span data-ttu-id="6c91c-115">**Выделение памяти**</span><span class="sxs-lookup"><span data-stu-id="6c91c-115">**Memory allocation**</span></span>|<span data-ttu-id="6c91c-116">**Освобождение памяти**</span><span class="sxs-lookup"><span data-stu-id="6c91c-116">**Memory release**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="6c91c-117">Input</span><span class="sxs-lookup"><span data-stu-id="6c91c-117">Input</span></span>  <br/> |<span data-ttu-id="6c91c-118">Вызывающий абонент является ответственным и может использовать любой механизм.</span><span class="sxs-lookup"><span data-stu-id="6c91c-118">Caller is responsible and can use any mechanism.</span></span>  <br/> |<span data-ttu-id="6c91c-119">Вызывающий абонент является ответственным и может использовать любой механизм.</span><span class="sxs-lookup"><span data-stu-id="6c91c-119">Caller is responsible and can use any mechanism.</span></span>  <br/> |
|<span data-ttu-id="6c91c-120">Output</span><span class="sxs-lookup"><span data-stu-id="6c91c-120">Output</span></span>  <br/> |<span data-ttu-id="6c91c-121">Вызываемая функция является ответственной и должна использовать **мапиаллокатебуффер**.</span><span class="sxs-lookup"><span data-stu-id="6c91c-121">Called function is responsible and must use **MAPIAllocateBuffer**.</span></span> <span data-ttu-id="6c91c-122">Дополнительные сведения см. в разделе [мапиаллокатебуффер](mapiallocatebuffer.md).</span><span class="sxs-lookup"><span data-stu-id="6c91c-122">For more information, see [MAPIAllocateBuffer](mapiallocatebuffer.md).</span></span>  <br/> |<span data-ttu-id="6c91c-123">Вызывающий абонент несет ответственность и должен использовать **мапифрибуффер**.</span><span class="sxs-lookup"><span data-stu-id="6c91c-123">Caller is responsible and must use **MAPIFreeBuffer**.</span></span> <span data-ttu-id="6c91c-124">Дополнительные сведения см. в разделе [мапифрибуффер](mapifreebuffer.md).</span><span class="sxs-lookup"><span data-stu-id="6c91c-124">For more information, see [MAPIFreeBuffer](mapifreebuffer.md).</span></span>  <br/> |
|<span data-ttu-id="6c91c-125">Входные данные</span><span class="sxs-lookup"><span data-stu-id="6c91c-125">Input-output</span></span>  <br/> |<span data-ttu-id="6c91c-126">Вызывающий абонент отвечает за первоначальное выделение и вызываемую функцию можно перераспределить, если это необходимо, с помощью **мапиаллокатебуффер**.</span><span class="sxs-lookup"><span data-stu-id="6c91c-126">Caller is responsible for the initial allocation and called function can reallocate if necessary using **MAPIAllocateBuffer**.</span></span>  <br/> |<span data-ttu-id="6c91c-127">Вызываемая функция отвечает за начальное освобождение, если необходимо перераспределение.</span><span class="sxs-lookup"><span data-stu-id="6c91c-127">Called function is responsible for initial freeing if reallocation is necessary.</span></span> <span data-ttu-id="6c91c-128">Вызывающий абонент должен освободить Последнее возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="6c91c-128">Caller must free the final return value.</span></span>  <br/> |
   
<span data-ttu-id="6c91c-129">Во время сбоев разработчикам методов интерфейса необходимо уделять внимание параметрам OUTPUT и Output-Output, так как вызывающий код обычно не может их очистить.</span><span class="sxs-lookup"><span data-stu-id="6c91c-129">During failure conditions, implementers of interface methods need to pay attention to output and input-output parameters because the caller generally has no way to clean them up.</span></span> <span data-ttu-id="6c91c-130">Если возвращается ошибка, то каждый выходной параметр или параметр ввода вывода должен оставаться в значении, инициализированном вызывающим абонентом, или задать значение, которое можно очистить без каких-либо действий с частью вызывающего абонента.</span><span class="sxs-lookup"><span data-stu-id="6c91c-130">If an error is returned, then each output or input-output parameter must either be left at the value initialized by the caller or set to a value that can be cleaned up without any action on the part of the caller.</span></span> <span data-ttu-id="6c91c-131">Например, параметр Output (выходной указатель) `void ** ppv` должен оставаться не так, как при вводе, или может иметь значение null ( `*ppv = NULL`).</span><span class="sxs-lookup"><span data-stu-id="6c91c-131">For example, an output pointer-parameter of  `void ** ppv` must be left as it was on input or can be set to NULL (  `*ppv = NULL`).</span></span>
  

