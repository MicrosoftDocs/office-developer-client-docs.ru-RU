---
title: Выделение и освобождение памяти в MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: dc97abcb4b316b696032f2788f4e653717e1396b
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19808041"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a><span data-ttu-id="877cc-103">Выделение и освобождение памяти в MAPI</span><span class="sxs-lookup"><span data-stu-id="877cc-103">Allocating and Freeing Memory in MAPI</span></span>

  
  
<span data-ttu-id="877cc-104">**Относится к**: Outlook</span><span class="sxs-lookup"><span data-stu-id="877cc-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="877cc-105">Кроме возможности задания как выделить и освободить память, MAPI определяет модель знать при передаче памяти между открытый метод интерфейса и функции API, звонки нужно освободить.</span><span class="sxs-lookup"><span data-stu-id="877cc-105">In addition to specifying how to allocate and free memory, MAPI defines a model for knowing when memory passed between public interface method and API function calls should be freed.</span></span> <span data-ttu-id="877cc-106">Модель применяется только к памяти, выделенный для параметров, которые не являются указатели на интерфейсы, такие как строки и указатели на структуры.</span><span class="sxs-lookup"><span data-stu-id="877cc-106">The model applies only to memory allocated for parameters that are not pointers to interfaces, such as strings and pointers to structures.</span></span> <span data-ttu-id="877cc-107">Указатели интерфейса используйте механизмом реализации через **интерфейс IUnknown**подсчета ссылок.</span><span class="sxs-lookup"><span data-stu-id="877cc-107">Interface pointers use the reference counting mechanism implemented through **IUnknown**.</span></span> <span data-ttu-id="877cc-108">Если выделение и освобождение не MAPI связанные памяти в клиентском приложении или поставщик услуг, используйте любой механизм имеет смысл.</span><span class="sxs-lookup"><span data-stu-id="877cc-108">When allocating and freeing non-MAPI related memory internally within a client application or service provider, use whatever mechanism makes sense.</span></span> 
  
<span data-ttu-id="877cc-109">Модель определяет параметры как один из трех типов.</span><span class="sxs-lookup"><span data-stu-id="877cc-109">The model defines parameters as one of three types.</span></span> <span data-ttu-id="877cc-110">Они могут вводить установленные вызывающим абонентом со сведениями для использования с вызываемой функции или метода, параметры выходные параметры, функция или метод и возвращен вызывающего или параметры ввода вывода, комбинации двух типов.</span><span class="sxs-lookup"><span data-stu-id="877cc-110">They can be input parameters, set by the caller with information to be used by the called function or method, output parameters, set by the called function or method and returned to the caller, or input-output parameters, a combination of the two types.</span></span> <span data-ttu-id="877cc-111">Часто используются параметры вывода указатели на данные или указатели на указатели на данные.</span><span class="sxs-lookup"><span data-stu-id="877cc-111">Output parameters are frequently pointers to data or pointers to pointers to data.</span></span> <span data-ttu-id="877cc-112">Несмотря на то, что эта функция несет ответственность за распределения данных для выходных параметров, вызывающего выделения памяти для указателя мыши.</span><span class="sxs-lookup"><span data-stu-id="877cc-112">Although the called function is responsible for allocating the data for output parameters, the caller allocates the memory for the pointer.</span></span> 
  
<span data-ttu-id="877cc-113">В следующей таблице описываются правила для распределения и освобождения памяти для этих типов параметров.</span><span class="sxs-lookup"><span data-stu-id="877cc-113">The rules for allocating and releasing memory for these types of parameters are explained in the following table.</span></span>
  
|<span data-ttu-id="877cc-114">**Тип**</span><span class="sxs-lookup"><span data-stu-id="877cc-114">**Type**</span></span>|<span data-ttu-id="877cc-115">**Выделение памяти**</span><span class="sxs-lookup"><span data-stu-id="877cc-115">**Memory allocation**</span></span>|<span data-ttu-id="877cc-116">**Выпуск памяти**</span><span class="sxs-lookup"><span data-stu-id="877cc-116">**Memory release**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="877cc-117">Input</span><span class="sxs-lookup"><span data-stu-id="877cc-117">Input</span></span>  <br/> |<span data-ttu-id="877cc-118">Вызывающий объект отвечает и можно использовать любой механизм.</span><span class="sxs-lookup"><span data-stu-id="877cc-118">Caller is responsible and can use any mechanism.</span></span>  <br/> |<span data-ttu-id="877cc-119">Вызывающий объект отвечает и можно использовать любой механизм.</span><span class="sxs-lookup"><span data-stu-id="877cc-119">Caller is responsible and can use any mechanism.</span></span>  <br/> |
|<span data-ttu-id="877cc-120">Output</span><span class="sxs-lookup"><span data-stu-id="877cc-120">Output</span></span>  <br/> |<span data-ttu-id="877cc-121">Функция отвечает и необходимо использовать **MAPIAllocateBuffer**.</span><span class="sxs-lookup"><span data-stu-id="877cc-121">Called function is responsible and must use **MAPIAllocateBuffer**.</span></span> <span data-ttu-id="877cc-122">Для получения дополнительных сведений см [MAPIAllocateBuffer](mapiallocatebuffer.md).</span><span class="sxs-lookup"><span data-stu-id="877cc-122">For more information, see [MAPIAllocateBuffer](mapiallocatebuffer.md).</span></span>  <br/> |<span data-ttu-id="877cc-123">Вызывающий объект отвечает и необходимо использовать **MAPIFreeBuffer**.</span><span class="sxs-lookup"><span data-stu-id="877cc-123">Caller is responsible and must use **MAPIFreeBuffer**.</span></span> <span data-ttu-id="877cc-124">Для получения дополнительных сведений см [MAPIFreeBuffer](mapifreebuffer.md).</span><span class="sxs-lookup"><span data-stu-id="877cc-124">For more information, see [MAPIFreeBuffer](mapifreebuffer.md).</span></span>  <br/> |
|<span data-ttu-id="877cc-125">Ввода вывода</span><span class="sxs-lookup"><span data-stu-id="877cc-125">Input-output</span></span>  <br/> |<span data-ttu-id="877cc-126">Вызывающий объект отвечает за начального выделения и вызываемой функции можно перемещать при необходимости с помощью **MAPIAllocateBuffer**.</span><span class="sxs-lookup"><span data-stu-id="877cc-126">Caller is responsible for the initial allocation and called function can reallocate if necessary using **MAPIAllocateBuffer**.</span></span>  <br/> |<span data-ttu-id="877cc-127">Функция несет ответственность за начальной освобождение, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="877cc-127">Called function is responsible for initial freeing if reallocation is necessary.</span></span> <span data-ttu-id="877cc-128">Вызывающий объект должен освободить конечное возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="877cc-128">Caller must free the final return value.</span></span>  <br/> |
   
<span data-ttu-id="877cc-129">Во время сбоя условия реализации методов интерфейса нужно Обратите внимание на выходных данных и параметров ввода вывода, так как вызывающего абонента обычно не имеет возможности их очистки.</span><span class="sxs-lookup"><span data-stu-id="877cc-129">During failure conditions, implementers of interface methods need to pay attention to output and input-output parameters because the caller generally has no way to clean them up.</span></span> <span data-ttu-id="877cc-130">Если возвращается сообщение об ошибке, затем каждый параметр ввода вывода или выходных данных необходимо либо оставить значение инициализации вызывающим абонентом или задать значение, которое может очистить без каких-либо действий со стороны вызывающего абонента.</span><span class="sxs-lookup"><span data-stu-id="877cc-130">If an error is returned, then each output or input-output parameter must either be left at the value initialized by the caller or set to a value that can be cleaned up without any action on the part of the caller.</span></span> <span data-ttu-id="877cc-131">Например, выходной указатель аргумент `void ** ppv` должно остаться как его на входные данные или может быть задано значение NULL ( `*ppv = NULL`).</span><span class="sxs-lookup"><span data-stu-id="877cc-131">For example, an output pointer-parameter of  `void ** ppv` must be left as it was on input or can be set to NULL (  `*ppv = NULL`).</span></span>
  

