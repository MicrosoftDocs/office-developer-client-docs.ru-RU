---
title: Выбор и освободит память в MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 68250c5cbeaa366ed4555bb469c4e68d62302f28
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419669"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a>Выбор и освободит память в MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Помимо указания способа выделения и выделения памяти, MAPI определяет модель для определения того, когда память, передаемая между методом открытого интерфейса и вызовами функций API, должна быть освобождена. Модель применяется только к памяти, выделенной для параметров, которые не являются указателями на интерфейсы, например строки и указатели на структуры. Указатели интерфейса используют механизм подсчета ссылок, реализованный с помощью **IUnknown.** При предоставлении и освобождении памяти, не связанной с MAPI, внутри клиентского приложения или поставщика услуг используйте любой механизм. 
  
Модель определяет параметры как один из трех типов. Они могут быть входными параметрами, заданными вызываемой функцией или методом, выходными параметрами, заданными вызываемой функцией или методом и возвращаемой вызыванию, или входными выходными параметрами, сочетанием этих двух типов. Выходные параметры часто являются указателями на данные или указателями на данные. Хотя вызываемая функция отвечает за выделение данных для выходных параметров, звонящий выделяет память для указателя. 
  
Правила выделения и освобождения памяти для этих типов параметров поясняется в следующей таблице.
  
|**Тип**|**Выделение памяти**|**Выпуск памяти**|
|:-----|:-----|:-----|
|Input  <br/> |Вызываемая отвечает и может использовать любой механизм.  <br/> |Вызываемая отвечает и может использовать любой механизм.  <br/> |
|Выходные данные  <br/> |Функция Called отвечает и должна использовать **MAPIAllocateBuffer**. Дополнительные сведения см. в [mapIAllocateBuffer.](mapiallocatebuffer.md)  <br/> |Caller is responsible and must use **MAPIFreeBuffer**. Дополнительные сведения см. в [mapIFreeBuffer.](mapifreebuffer.md)  <br/> |
|Входные данные  <br/> |Caller is responsible for the initial allocation and called function can reallocate if necessary using **MAPIAllocateBuffer**.  <br/> |Функция Called отвечает за начальное освобождение при необходимости перераспределения. Caller must free the final return value.  <br/> |
   
В условиях сбоя, реализующих методы интерфейса необходимо обратить внимание на выходных и входных выходных параметров, так как вызываемая, как правило, не может очистить их. Если возвращается ошибка, каждый выходной или выходной параметр должен быть оставлен в значении, инициализированном вызываемой стороной, или установить значение, которое можно очистить без каких-либо действий со стороны вызываемого. Например, выходной параметр указателя должен быть оставлен так, как он входит, или может быть установлен в  `void ** ppv` NULL (  `*ppv = NULL` ).
  

