---
title: IMAPISessionAdvise
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMAPISession.Advise
api_type:
- COM
ms.assetid: a6a6b6b1-31e2-4899-a5fe-74d5d1c2ccfc
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d5d87d7be9cb3524445107e975a298d4afd5bf98
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419837"
---
# <a name="imapisessionadvise"></a>IMAPISession::Advise

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Регистрируется для получения уведомлений об указанных событиях, влияющих на сеанс.
  
```cpp
HRESULT Advise(
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulEventMask,
  LPMAPIADVISESINK lpAdviseSink,
  ULONG_PTR lpulConnection
);
```

## <a name="parameters"></a>Параметры

 _cbEntryID_
  
> [in] Количество byte в идентификаторе записи, на который указывает параметр _lpEntryID._ 
    
 _lpEntryID_
  
> [in] Указатель на идентификатор записи объекта адресной книги или хранения сообщений о том, какие уведомления должны быть созданы, или NULL, что указывает, что клиент регистрируется для получения уведомлений о событиях, влияющих только на сеанс. 
    
 _ulEventMask_
  
> [in] Маска значений, которые указывают типы событий уведомлений, которые интересуют клиента и должны быть включены в регистрацию. Если  _lpEntryID_ имеет значение NULL, MAPI автоматически регистрирует клиент для критических ошибок, влияющих только на сеанс. Если  _lpEntryID_ указывает на идентификатор записи, для параметра  _ulEventMask_ допустимы следующие значения: 
    
fnevCriticalError 
  
> Регистрирует уведомления о серьезных ошибках, например нехватке памяти.
    
fnevExtended 
  
> Регистрирует уведомления о событиях, характерных для конкретной адресной книги или поставщика store сообщений, а также о закрытии сеанса.
    
fnevNewMail 
  
> Регистрируется для уведомлений о поступлении новых сообщений. 
    
fnevObjectCreated 
  
> Регистрируется для уведомлений о создании нового объекта.
    
fnevObjectCopied
  
> Регистрируется для уведомлений об объекте, который копируется.
    
fnevObjectDeleted
  
> Регистрирует уведомления об удаляемом объекте.
    
fnevObjectModified
  
> Регистрирует уведомления об изменяемом объекте.
    
fnevObjectMoved
  
> Регистрирует уведомления о перемещаемом объекте.
    
fnevSearchComplete
  
> Регистрируется для уведомлений о завершении операции поиска.
    
 _lpAdviseSink_
  
> [in] Указатель на объект приемника рекомендации для получения последующих уведомлений. Этот рекомендуемый объект-тоник должен быть уже выделен.
    
 _lpulConnection_
  
> [out] Указатель на ненумерный номер, представляющий соединение между объектом-томером консультации вызываемого вызываемого объекта и сеансом.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Регистрация прошла успешно.
    
MAPI_E_INVALID_ENTRYID 
  
> Идентификатор записи, на который указывает  _lpEntryID,_ не представляет допустимый идентификатор записи. 
    
MAPI_E_NO_SUPPORT 
  
> Поставщик услуг, отвечающий за идентификатор записи, на который указывает  _lpEntryID,_ либо не поддерживает тип событий, указанный в параметре  _ulEventMask,_ либо не поддерживает уведомление. 
    
MAPI_E_UNKNOWN_ENTRYID 
  
> Идентификатор записи, на который указывает  _lpEntryID,_ не может быть обработан ни одним из поставщиков служб в профиле. 
    
## <a name="remarks"></a>Примечания

Метод **IMAPISession::Advise** устанавливает связь между объектом приемника консультации вызываемого, сеансом и, при желании, поставщиком услуг. Это подключение используется для отправки уведомлений в обемник консультации, когда одно или несколько событий, указанных в параметре _ulEventMask,_ происходят в объекте, на который указывает _lpEntryID._ Если  _lpEntryID_ имеет значение NULL, целевым объектом является сеанс, а уведомления отправляются только при критических ошибках и расширенных событиях. 
  
Когда  _lpEntryID_ указывает на допустимый идентификатор записи, MAPI вызывает метод **Advise** объекта входа, который принадлежит ответственному поставщику услуг. Например, если  _lpEntryID_ указывает на идентификатор записи списка рассылки, MAPI вызывает метод [IABLogon::Advise](iablogon-advise.md) соответствующего поставщика адресной книги. 
  
Чтобы отправить уведомление, поставщик услуг или MAPI вызывает зарегистрированный метод [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) зарегистрированного приемника уведомлений. Один из параметров **OnNotify**, структура уведомлений, содержит сведения, описывая конкретное событие.
  
## <a name="notes-to-callers"></a>Примечания для вызывающих методов

В системах, поддерживаюх несколько потоков выполнения, вызов **OnNotify** также может происходить в любом потоке в любое время. Если вам нужна уверенность в том, что уведомления будут происходить только в определенное время в определенном потоке, вызовите функцию [HrThisThreadAdviseSink,](hrthisthreadadvisesink.md) чтобы создать объект приемника рекомендации, который вы передаете методу **Advise.** 
  
Чтобы определить, когда клиент выошел из системы, зарегистрируйтесь для уведомлений у поставщика услуг, вызывая advise с _lpEntryID,_ заданным как NULL, а _cbEntryID_ имеет 0.  После этого вы получите уведомление fnevExtended. 
  
После успешного  вызова "Консультация" и до вызова [IMAPISession::Unadvise](imapisession-unadvise.md) для отмены регистрации отпустите объект-конюхн. 
  
Обзор процесса уведомления см. в уведомлении [о событии в MAPI.](event-notification-in-mapi.md) 
  
Дополнительные сведения об обработке уведомлений см. в [этой теме.](handling-notifications.md) 
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|BaseDialog.cpp  <br/> |CBaseDialog::OnNotificationsOn  <br/> |MFCMAPI использует метод **IMAPISession::Advise** для регистрации уведомлений о сеансе.  <br/> |
   
## <a name="see-also"></a>См. также



[IABLogon::Advise](iablogon-advise.md)
  
[HrThisThreadAdviseSink](hrthisthreadadvisesink.md)
  
[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)
  
[IMAPISession::Unadvise](imapisession-unadvise.md)
  
[IMAPISession: IUnknown](imapisessioniunknown.md)


[MFCMAPI как пример кода](mfcmapi-as-a-code-sample.md)
  
[Уведомление о событии в MAPI](event-notification-in-mapi.md)

