---
title: Профили MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 493c87a4-317d-47ec-850b-342cac59594b
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9db1f8e163e44a44df1e798cebccb3639325275e
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32340084"
---
# <a name="mapi-profiles"></a>Профили MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
В профиле хранятся сведения о поставщиках услуг и службах сообщений, установленных на компьютере. Для каждого сеанса клиент во время входа выбирает один профиль, описывающий поставщиков и службы, которые необходимо использовать. Клиент может выбрать из коллекции профилей и, при необходимости, установить его в качестве значения по умолчанию. Профиль по умолчанию — это профиль, который выбирается автоматически, когда клиент запускает сеанс и не указал явно профиль.
  
Кроме того, в этих статьях вы найдете обсуждение кэша псевдонимов, который хранится в двоичном потоке.
  
- [Кэш псевдонимов](nickname-cache.md)
    
- [Поток автозаполнения](autocomplete-stream.md)
    
- [Синтаксический анализ двоичных файлов](https://portalvhds6gyn3khqwmgzd.blob.core.windows.net/files/NK2/NK2WithBinaryExample.pdf)
    
## <a name="profile-sections"></a>Разделы профиля

Профили разделяются на разделы, доступные клиентам и поставщикам услуг для отображения свойств профиля пользователям или для внесения изменений в конфигурацию. Раздел профиля — это объект MAPI, который реализует интерфейс **ипрофсект** , интерфейс, производный от **IMAPIProp** и не имеющий дополнительных методов. Дополнительные сведения см. в статье [ипрофсект: IMAPIProp](iprofsectimapiprop.md). Единственной целью является Управление свойствами раздела профиля. Чтобы получить указатель **ипрофсект** на определенный раздел профиля, клиенты и поставщики услуг вызывают указанные ниже методы. 
  
|||
|:-----|:-----|
|Клиенты могут звонить:  <br/> |[IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) <br/> |
|Поставщики услуг могут звонить:  <br/> |[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md) <br/> |
|Клиенты или поставщики могут вызывать следующие действия:  <br/> |[IProviderAdmin::OpenProfileSection](iprovideradmin-openprofilesection.md) <br/> |
   
Профили организованы иерархически, как MAPISVC. INF-файл. В верхней части иерархии имеются разделы профиля, содержащие сведения, относящиеся к профилю. Средний уровень включает разделы, содержащие сведения о конкретной службе сообщений, а уровень ниже содержит разделы, содержащие сведения об одном из поставщиков услуг в службе сообщений. 
  
У каждого профиля есть несколько обязательных свойств, которые хранятся в одном или нескольких разделах профиля. Например, у каждого профиля есть свойства **PR_PROFILE_NAME** ([PidTagProfileName](pidtagprofilename-canonical-property.md)) и **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)). Для ключа поиска профиля задается значение, заданное в МАПИГУИД. H как MUID_PROFILE_INSTANCE и всегда гарантированно будет уникальным среди всех профилей. Хотя два профиля могут иметь одно и то же имя, они не могут иметь одинаковый ключ поиска. Ключи поиска должны рассматриваться как двоичные данные, а не как данные какого бы то ни было определенного типа.
  
Поставщики хранилища сообщений должны включать свойство **PR_DISPLAY_NAME** хранилища сообщений ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) в разделах профиля для профиля и поставщика хранилища сообщений, а также синхронизировать эти записи. При создании хранилища сообщений поставщик устанавливает **PR_DISPLAY_NAME** на основе значения, хранящегося в этих разделах профиля. 
  
Существует два основных различия между разделами профиля и другими объектами, наследуемыми от **IMAPIProp**: 
  
- Разделы профиля не поддерживают транзакции.
    
- Разделы профиля не поддерживают именованные свойства, возвращая MAPI_E_NO_SUPPORT из их **IMAPIProp:: жетидсфромнамес** и **IMAPIProp:: жетнамесфромидс** реализации. Дополнительные сведения см. в статье [IMAPIProp:: жетидсфромнамес](imapiprop-getidsfromnames.md) and [IMAPIProp:: жетнамесфромидс](imapiprop-getnamesfromids.md).
    
Так как разделы профилей не поддерживают транзакции, любые изменения, внесенные с помощью вызовов в **IMAPIProp:: копипропс**, **CopyTo**или **SetProps** , вступают в силу немедленно. Дополнительные сведения см. в статье [IMAPIProp:: копипропс](imapiprop-copyprops.md). Клиенты и поставщики услуг могут вызвать метод **IMAPIProp:: SaveChanges** раздела профиля, который будет успешным, но не влияет на данные раздела профиля. Дополнительные сведения см. в разделе [IMAPIProp:: SaveChanges](imapiprop-savechanges.md). Немедленное выполнение изменений может повлиять на то, как поставщики услуг реализуют страницы свойств, используемые клиентами для отображения свойств профиля пользователям. Поставщики услуг, которые хотят, чтобы пользователи могли откладывать или отменять изменения, должны реализовать свои страницы свойств с копиями разделов профилей вместо действительных разделов. С помощью копий пользователи могут вносить изменения, а затем прервать эти изменения, оставляя исходные разделы профиля без изменений. 
  
Порядок, в котором информация отображается в профиле, влияет на способ настройки ресурсов MAPI и назначения в сеансе назначений. Порядок профилей влияет на следующие назначения:
  
- Хранилище сообщений по умолчанию
    
- Личная адресная книга
    
- Путь поиска хранилища сообщений по умолчанию
    
- Путь поиска адресной книги по умолчанию
    
- Порядок поставщиков транспорта
    
MAPI устанавливает стандартное хранилище сообщений в профиле, в котором для свойства **PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) задано значение флага STATUS_DEFAULT_STORE, что указывает на то, что это может быть хранилищем по умолчанию. Клиенты могут переопределить этот параметр, вызвав **IMAPISession:: сетдефаултсторе**. Дополнительные сведения см. в статье [IMAPISession:: сетдефаултсторе](imapisession-setdefaultstore.md).
  
MAPI создает транспортный порядок для обработки исходящих и входящих сообщений. Если для сообщения определенного типа зарегистрировано несколько поставщиков транспорта, MAPI использует этот порядок для определения поставщика, который должен обрабатывать сообщение. MAPI задает порядок транспортировки в качестве порядка, в котором поставщики транспорта были добавлены в профиль с одним исключением: транспортам, которые задают флаг STATUS_XP_PREFER_LAST в своем свойстве **PR_RESOURCE_FLAGS** , располагаются в порядке следования. Клиенты могут задать транспортный заказ, вызвав **имсгсервицеадмин:: мсгсервицетранспортордер**. Дополнительные сведения см. в статье [имсгсервицеадмин:: мсгсервицетранспортордер](imsgserviceadmin-msgservicetransportorder.md).
  
Эти рекомендации по упорядочиванию поставщиков услуг и служб сообщений могут иногда конфликтовать. При возникновении конфликта код должен разрешить конфликт. Программу панели управления Mail можно использовать для проверки созданного профиля, чтобы определить, настроены ли поставщики должным образом.
  

