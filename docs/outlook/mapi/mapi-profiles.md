---
title: Профили MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 493c87a4-317d-47ec-850b-342cac59594b
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9db1f8e163e44a44df1e798cebccb3639325275e
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32340084"
---
# <a name="mapi-profiles"></a><span data-ttu-id="7b0b2-103">Профили MAPI</span><span class="sxs-lookup"><span data-stu-id="7b0b2-103">MAPI Profiles</span></span>

  
  
<span data-ttu-id="7b0b2-104">**Область применения**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="7b0b2-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="7b0b2-105">В профиле хранится информация о поставщиках услуг и службах сообщений, установленных на компьютере.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-105">A profile stores information about service providers and message services that are installed on a computer.</span></span> <span data-ttu-id="7b0b2-106">Для каждого сеанса клиент во время логоса выбирает один профиль, в который описываются используемые поставщики и службы.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-106">For every session, a client at logon time selects one profile that describes the providers and services to be used.</span></span> <span data-ttu-id="7b0b2-107">Клиент может выбрать из коллекции профилей и при желании установить его в качестве по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-107">A client can choose from a collection of profiles and, if desired, establish one as the default.</span></span> <span data-ttu-id="7b0b2-108">Профиль по умолчанию — это профиль, который выбирается автоматически, когда клиент начинает сеанс и явно не указывает профиль.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-108">The default profile is the profile that is selected automatically when a client starts a session and has not explicitly specified a profile.</span></span>
  
<span data-ttu-id="7b0b2-109">Кроме того, в этих темах вы найдете обсуждение кэша ником, который хранится в двоичном потоке.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-109">Also in these topics, you will find a discussion of the nickname cache, which is stored in a binary stream.</span></span>
  
- [<span data-ttu-id="7b0b2-110">Кэш псевдонимов</span><span class="sxs-lookup"><span data-stu-id="7b0b2-110">Nickname cache</span></span>](nickname-cache.md)
    
- [<span data-ttu-id="7b0b2-111">Поток автокомплетов</span><span class="sxs-lookup"><span data-stu-id="7b0b2-111">Autocomplete Stream</span></span>](autocomplete-stream.md)
    
- [<span data-ttu-id="7b0b2-112">Двоичный метод размыкания файлов</span><span class="sxs-lookup"><span data-stu-id="7b0b2-112">Binary File Parsing</span></span>](https://portalvhds6gyn3khqwmgzd.blob.core.windows.net/files/NK2/NK2WithBinaryExample.pdf)
    
## <a name="profile-sections"></a><span data-ttu-id="7b0b2-113">Разделы профилей</span><span class="sxs-lookup"><span data-stu-id="7b0b2-113">Profile Sections</span></span>

<span data-ttu-id="7b0b2-114">Профили делятся на разделы, к которые клиенты и поставщики услуг имеют доступ для отображения свойств профилей для пользователей или изменения конфигурации.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-114">Profiles are divided into sections that clients and service providers access to display profile properties to users or to make configuration changes.</span></span> <span data-ttu-id="7b0b2-115">Профильный раздел — это объект MAPI, который реализует **интерфейс IProfSect,** интерфейс, который происходит из **IMAPIProp** и не имеет дополнительных методов.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-115">A profile section is a MAPI object that implements the **IProfSect** interface, an interface that derives from **IMAPIProp** and has no additional methods.</span></span> <span data-ttu-id="7b0b2-116">Дополнительные сведения см. [в iProfSect : IMAPIProp](iprofsectimapiprop.md).</span><span class="sxs-lookup"><span data-stu-id="7b0b2-116">For more information, see [IProfSect : IMAPIProp](iprofsectimapiprop.md).</span></span> <span data-ttu-id="7b0b2-117">Его единственная цель — манипулировать свойствами раздела профилей.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-117">Its only purpose is to manipulate the properties of a profile section.</span></span> <span data-ttu-id="7b0b2-118">Чтобы получить **указатель IProfSect** в определенном разделе профиля, клиенты и поставщики услуг называют следующие методы.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-118">To retrieve an **IProfSect** pointer to a particular profile section, clients and service providers call the following methods.</span></span> 
  
|||
|:-----|:-----|
|<span data-ttu-id="7b0b2-119">Клиенты могут вызывать:</span><span class="sxs-lookup"><span data-stu-id="7b0b2-119">Clients can call:</span></span>  <br/> |[<span data-ttu-id="7b0b2-120">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="7b0b2-120">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md) <br/> |
|<span data-ttu-id="7b0b2-121">Поставщики услуг могут вызывать:</span><span class="sxs-lookup"><span data-stu-id="7b0b2-121">Service providers can call:</span></span>  <br/> |[<span data-ttu-id="7b0b2-122">IMAPISupport::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="7b0b2-122">IMAPISupport::OpenProfileSection</span></span>](imapisupport-openprofilesection.md) <br/> |
|<span data-ttu-id="7b0b2-123">Клиенты или поставщики могут вызвать:</span><span class="sxs-lookup"><span data-stu-id="7b0b2-123">Either clients or providers can call:</span></span>  <br/> |[<span data-ttu-id="7b0b2-124">IProviderAdmin::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="7b0b2-124">IProviderAdmin::OpenProfileSection</span></span>](iprovideradmin-openprofilesection.md) <br/> |
   
<span data-ttu-id="7b0b2-125">Профили организованы иерархически, как и MAPISVC. Файл INF.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-125">Profiles are organized hierarchically much like the MAPISVC.INF file.</span></span> <span data-ttu-id="7b0b2-126">В верхней части иерархии находятся разделы профилей, содержащие сведения, соответствующие профилю.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-126">At the top of the hierarchy, there are profile sections that contain information relevant to the profile.</span></span> <span data-ttu-id="7b0b2-127">Средний уровень включает разделы, содержащие сведения о конкретной службе сообщений, а нижний уровень включает разделы, содержащие сведения об одном из поставщиков услуг в службе сообщений.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-127">The middle level includes sections that contain information about a particular message service and the lower level includes sections that contain information about one of the service providers in a message service.</span></span> 
  
<span data-ttu-id="7b0b2-128">Каждый профиль имеет несколько необходимых свойств, которые хранятся в одном или нескольких разделах профиля.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-128">Every profile has several required properties that are stored in one or more of the sections of the profile.</span></span> <span data-ttu-id="7b0b2-129">Например, каждый профиль имеет **свойства PR_PROFILE_NAME** [(PidTagProfileName)](pidtagprofilename-canonical-property.md)и **PR_SEARCH_KEY** [(PidTagSearchKey).](pidtagsearchkey-canonical-property.md)</span><span class="sxs-lookup"><span data-stu-id="7b0b2-129">For example, every profile has the **PR_PROFILE_NAME** ([PidTagProfileName](pidtagprofilename-canonical-property.md)) and **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) properties.</span></span> <span data-ttu-id="7b0b2-130">Ключ поиска профиля задается значению, определенному в MAPIGUID. H как MUID_PROFILE_INSTANCE и всегда гарантируется быть уникальным среди всех профилей.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-130">A profile's search key is set to the value defined in MAPIGUID.H as MUID_PROFILE_INSTANCE and is always guaranteed to be unique among all profiles.</span></span> <span data-ttu-id="7b0b2-131">Хотя два профиля могут иметь одно и то же имя, они не могут иметь один и тот же ключ поиска.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-131">Although two profiles can have the same name, they cannot have the same search key.</span></span> <span data-ttu-id="7b0b2-132">Ключи поиска должны рассматриваться как двоичные данные, а не данные определенного типа.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-132">Search keys should be treated as binary data instead of data of any particular type.</span></span>
  
<span data-ttu-id="7b0b2-133">Поставщики магазинов сообщений должны включить свойство  PR_DISPLAY_NAME магазина сообщений[(PidTagDisplayName)](pidtagdisplayname-canonical-property.md)в разделах профилей для профиля и поставщика магазина сообщений, а также синхронизировать эти записи.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-133">Message store providers are required to include their message store's **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in the profile sections for the profile and for their message store provider and to keep these entries synchronized.</span></span> <span data-ttu-id="7b0b2-134">Когда создается хранилище сообщений, **поставщик** задает PR_DISPLAY_NAME на основе значения, хранимых в этих разделах профилей.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-134">When a message store is created, the provider sets **PR_DISPLAY_NAME** based on the value stored in these profile sections.</span></span> 
  
<span data-ttu-id="7b0b2-135">Существуют два основных различия между разделами профилей и другими объектами, которые **наследуются от IMAPIProp:**</span><span class="sxs-lookup"><span data-stu-id="7b0b2-135">There are two major differences between profile sections and other objects that inherit from **IMAPIProp**:</span></span> 
  
- <span data-ttu-id="7b0b2-136">Разделы профилей не поддерживают транзакции.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-136">Profile sections do not support transactions.</span></span>
    
- <span data-ttu-id="7b0b2-137">Разделы профилей не поддерживают именные свойства, возвращая MAPI_E_NO_SUPPORT из их **реализации IMAPIProp::GetIDsFromNames** и **IMAPIProp::GetNamesFromIDs.**</span><span class="sxs-lookup"><span data-stu-id="7b0b2-137">Profile sections do not support named properties, returning MAPI_E_NO_SUPPORT from their **IMAPIProp::GetIDsFromNames** and **IMAPIProp::GetNamesFromIDs** implementations.</span></span> <span data-ttu-id="7b0b2-138">Дополнительные сведения см. в [iMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md) и [IMAPIProp::GetNamesFromIDs](imapiprop-getnamesfromids.md).</span><span class="sxs-lookup"><span data-stu-id="7b0b2-138">For more information, see [IMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md) and [IMAPIProp::GetNamesFromIDs](imapiprop-getnamesfromids.md).</span></span>
    
<span data-ttu-id="7b0b2-139">Так как разделы профилей не поддерживают транзакции, любые изменения, внесенные с вызовами **на IMAPIProp::CopyProps,** **CopyTo** или **SetProps,** немедленно вступает в силу.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-139">Because profile sections do not support transactions, any changes made with calls to **IMAPIProp::CopyProps**, **CopyTo**, or **SetProps** immediately take effect.</span></span> <span data-ttu-id="7b0b2-140">Дополнительные сведения см. [в iMAPIProp::CopyProps](imapiprop-copyprops.md).</span><span class="sxs-lookup"><span data-stu-id="7b0b2-140">For more information, see [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span> <span data-ttu-id="7b0b2-141">Клиенты и поставщики услуг могут вызывать метод **IMAPIProp::SaveChanges** в разделе профилей, но это не влияет на данные раздела профилей.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-141">Clients and service providers can call a profile section's **IMAPIProp::SaveChanges** method and it will succeed, but it does not affect the profile section data.</span></span> <span data-ttu-id="7b0b2-142">Дополнительные сведения см. [в iMAPIProp::SaveChanges.](imapiprop-savechanges.md)</span><span class="sxs-lookup"><span data-stu-id="7b0b2-142">For more information, see [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span> <span data-ttu-id="7b0b2-143">Немедленное изменение может повлиять на реализацию поставщиками свойств листов свойств, которые клиенты используют для отображения свойств профилей пользователям.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-143">Having changes occur immediately can affect how service providers implement the property sheets that clients use to display profile properties to users.</span></span> <span data-ttu-id="7b0b2-144">Поставщики услуг, которые хотят, чтобы пользователи могли отложить или отменить изменения, должны реализовать свои листы свойств с копиями разделов профилей, а не реальными разделами.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-144">Service providers that want users to be able to postpone or undo changes must implement their property sheets with copies of profile sections instead of the real sections.</span></span> <span data-ttu-id="7b0b2-145">С помощью копий пользователи могут вносить изменения, а затем отменить эти изменения, оставив нетронутыми исходные разделы профилей.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-145">By using copies, users can make changes and then later cancel those changes, leaving the original profile sections untouched.</span></span> 
  
<span data-ttu-id="7b0b2-146">Порядок, в котором информация отображается в профиле, влияет на настройку ресурсов MAPI и выполнение назначений в сеансе.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-146">The order in which information appears in a profile affects how MAPI configures resources and makes assignments in a session.</span></span> <span data-ttu-id="7b0b2-147">На следующие назначения влияет порядок профиля:</span><span class="sxs-lookup"><span data-stu-id="7b0b2-147">The following assignments are affected by profile order:</span></span>
  
- <span data-ttu-id="7b0b2-148">Хранилище сообщений по умолчанию</span><span class="sxs-lookup"><span data-stu-id="7b0b2-148">Default message store</span></span>
    
- <span data-ttu-id="7b0b2-149">Личная адресная книга</span><span class="sxs-lookup"><span data-stu-id="7b0b2-149">Personal address book</span></span>
    
- <span data-ttu-id="7b0b2-150">Путь поиска в хранилище сообщений по умолчанию</span><span class="sxs-lookup"><span data-stu-id="7b0b2-150">Default message store search path</span></span>
    
- <span data-ttu-id="7b0b2-151">Путь поиска адресной книги по умолчанию</span><span class="sxs-lookup"><span data-stu-id="7b0b2-151">Default address book search path</span></span>
    
- <span data-ttu-id="7b0b2-152">Заказ поставщика транспорта</span><span class="sxs-lookup"><span data-stu-id="7b0b2-152">Transport provider order</span></span>
    
<span data-ttu-id="7b0b2-153">MAPI задает хранилище сообщений по умолчанию первым хранилищем сообщений в профиле с задаваемой STATUS_DEFAULT_STORE флагом в свойстве **PR_RESOURCE_FLAGS** [(PidTagResourceFlags),](pidtagresourceflags-canonical-property.md)что указывает на то, что он может быть хранилищем по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-153">MAPI sets the default message store to be the first message store in the profile that has the STATUS_DEFAULT_STORE flag set in its **PR_RESOURCE_FLAGS** ([PidTagResourceFlags](pidtagresourceflags-canonical-property.md)) property, which indicates that it can be the default store.</span></span> <span data-ttu-id="7b0b2-154">Клиенты могут переопределять этот параметр, позвонив **в IMAPISession::SetDefaultStore**.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-154">Clients can override this setting by calling **IMAPISession::SetDefaultStore**.</span></span> <span data-ttu-id="7b0b2-155">Дополнительные сведения см. [в книге IMAPISession::SetDefaultStore.](imapisession-setdefaultstore.md)</span><span class="sxs-lookup"><span data-stu-id="7b0b2-155">For more information, see [IMAPISession::SetDefaultStore](imapisession-setdefaultstore.md).</span></span>
  
<span data-ttu-id="7b0b2-156">MAPI создает транспортный порядок обработки исходяющих и входящих сообщений.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-156">MAPI creates a transport order for handling outgoing and incoming messages.</span></span> <span data-ttu-id="7b0b2-157">Когда несколько поставщиков транспорта зарегистрировались для сообщения определенного типа, MAPI использует этот порядок, чтобы определить, какой поставщик должен обрабатывать сообщение.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-157">When more than one transport provider has registered for a message of a particular type, MAPI uses this order to determine which provider should handle the message.</span></span> <span data-ttu-id="7b0b2-158">MAPI задает порядок транспорта, чтобы быть порядком, в котором поставщики транспорта были добавлены в профиль с  одним исключением — транспорты, заданная флагом STATUS_XP_PREFER_LAST в свойстве PR_RESOURCE_FLAGS, находятся последними в порядке.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-158">MAPI sets the transport order to be the order in which the transport providers were added to the profile with one exception--the transports that set the STATUS_XP_PREFER_LAST flag in their **PR_RESOURCE_FLAGS** property are positioned last in the order.</span></span> <span data-ttu-id="7b0b2-159">Клиенты могут установить порядок транспортировки, позвонив **в службу IMsgServiceAdmin::MsgServiceTransportOrder.**</span><span class="sxs-lookup"><span data-stu-id="7b0b2-159">Clients can set the transport order by calling **IMsgServiceAdmin::MsgServiceTransportOrder**.</span></span> <span data-ttu-id="7b0b2-160">Дополнительные сведения см. в [фоторепортаре IMsgServiceAdmin::MsgServiceTransportOrder.](imsgserviceadmin-msgservicetransportorder.md)</span><span class="sxs-lookup"><span data-stu-id="7b0b2-160">For more information, see [IMsgServiceAdmin::MsgServiceTransportOrder](imsgserviceadmin-msgservicetransportorder.md).</span></span>
  
<span data-ttu-id="7b0b2-161">Эти рекомендации по заказу поставщиков услуг и служб сообщений иногда могут противоречить.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-161">These guidelines for ordering service providers and message services might sometimes conflict.</span></span> <span data-ttu-id="7b0b2-162">Если существует конфликт, код должен разрешить конфликт.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-162">If there is a conflict, your code should resolve the conflict.</span></span> <span data-ttu-id="7b0b2-163">Вы можете использовать программу Панели управления почтой для проверки созданного профиля, чтобы определить, настроены ли поставщики так, как ожидалось.</span><span class="sxs-lookup"><span data-stu-id="7b0b2-163">You can use the Mail Control Panel program to inspect a profile that you have created to determine whether the providers have been configured as expected.</span></span>
  

