---
title: Профили MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 493c87a4-317d-47ec-850b-342cac59594b
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9db1f8e163e44a44df1e798cebccb3639325275e
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32340084"
---
# <a name="mapi-profiles"></a>Профили MAPI

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
В профиле хранится информация о поставщиках услуг и службах сообщений, установленных на компьютере. Для каждого сеанса клиент во время логоса выбирает один профиль, в который описываются используемые поставщики и службы. Клиент может выбрать из коллекции профилей и при желании установить его в качестве по умолчанию. Профиль по умолчанию — это профиль, который выбирается автоматически, когда клиент начинает сеанс и явно не указывает профиль.
  
Кроме того, в этих темах вы найдете обсуждение кэша ником, который хранится в двоичном потоке.
  
- [Кэш псевдонимов](nickname-cache.md)
    
- [Поток автокомплетов](autocomplete-stream.md)
    
- [Двоичный метод размыкания файлов](https://portalvhds6gyn3khqwmgzd.blob.core.windows.net/files/NK2/NK2WithBinaryExample.pdf)
    
## <a name="profile-sections"></a>Разделы профилей

Профили делятся на разделы, к которые клиенты и поставщики услуг имеют доступ для отображения свойств профилей для пользователей или изменения конфигурации. Профильный раздел — это объект MAPI, который реализует **интерфейс IProfSect,** интерфейс, который происходит из **IMAPIProp** и не имеет дополнительных методов. Дополнительные сведения см. [в iProfSect : IMAPIProp](iprofsectimapiprop.md). Его единственная цель — манипулировать свойствами раздела профилей. Чтобы получить **указатель IProfSect** в определенном разделе профиля, клиенты и поставщики услуг называют следующие методы. 
  
|||
|:-----|:-----|
|Клиенты могут вызывать:  <br/> |[IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) <br/> |
|Поставщики услуг могут вызывать:  <br/> |[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md) <br/> |
|Клиенты или поставщики могут вызвать:  <br/> |[IProviderAdmin::OpenProfileSection](iprovideradmin-openprofilesection.md) <br/> |
   
Профили организованы иерархически, как и MAPISVC. Файл INF. В верхней части иерархии находятся разделы профилей, содержащие сведения, соответствующие профилю. Средний уровень включает разделы, содержащие сведения о конкретной службе сообщений, а нижний уровень включает разделы, содержащие сведения об одном из поставщиков услуг в службе сообщений. 
  
Каждый профиль имеет несколько необходимых свойств, которые хранятся в одном или нескольких разделах профиля. Например, каждый профиль имеет **свойства PR_PROFILE_NAME** [(PidTagProfileName)](pidtagprofilename-canonical-property.md)и **PR_SEARCH_KEY** [(PidTagSearchKey).](pidtagsearchkey-canonical-property.md) Ключ поиска профиля задается значению, определенному в MAPIGUID. H как MUID_PROFILE_INSTANCE и всегда гарантируется быть уникальным среди всех профилей. Хотя два профиля могут иметь одно и то же имя, они не могут иметь один и тот же ключ поиска. Ключи поиска должны рассматриваться как двоичные данные, а не данные определенного типа.
  
Поставщики магазинов сообщений должны включить свойство  PR_DISPLAY_NAME магазина сообщений[(PidTagDisplayName)](pidtagdisplayname-canonical-property.md)в разделах профилей для профиля и поставщика магазина сообщений, а также синхронизировать эти записи. Когда создается хранилище сообщений, **поставщик** задает PR_DISPLAY_NAME на основе значения, хранимых в этих разделах профилей. 
  
Существуют два основных различия между разделами профилей и другими объектами, которые **наследуются от IMAPIProp:** 
  
- Разделы профилей не поддерживают транзакции.
    
- Разделы профилей не поддерживают именные свойства, возвращая MAPI_E_NO_SUPPORT из их **реализации IMAPIProp::GetIDsFromNames** и **IMAPIProp::GetNamesFromIDs.** Дополнительные сведения см. в [iMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md) и [IMAPIProp::GetNamesFromIDs](imapiprop-getnamesfromids.md).
    
Так как разделы профилей не поддерживают транзакции, любые изменения, внесенные с вызовами **на IMAPIProp::CopyProps,** **CopyTo** или **SetProps,** немедленно вступает в силу. Дополнительные сведения см. [в iMAPIProp::CopyProps](imapiprop-copyprops.md). Клиенты и поставщики услуг могут вызывать метод **IMAPIProp::SaveChanges** в разделе профилей, но это не влияет на данные раздела профилей. Дополнительные сведения см. [в iMAPIProp::SaveChanges.](imapiprop-savechanges.md) Немедленное изменение может повлиять на реализацию поставщиками свойств листов свойств, которые клиенты используют для отображения свойств профилей пользователям. Поставщики услуг, которые хотят, чтобы пользователи могли отложить или отменить изменения, должны реализовать свои листы свойств с копиями разделов профилей, а не реальными разделами. С помощью копий пользователи могут вносить изменения, а затем отменить эти изменения, оставив нетронутыми исходные разделы профилей. 
  
Порядок, в котором информация отображается в профиле, влияет на настройку ресурсов MAPI и выполнение назначений в сеансе. На следующие назначения влияет порядок профиля:
  
- Хранилище сообщений по умолчанию
    
- Личная адресная книга
    
- Путь поиска в хранилище сообщений по умолчанию
    
- Путь поиска адресной книги по умолчанию
    
- Заказ поставщика транспорта
    
MAPI задает хранилище сообщений по умолчанию первым хранилищем сообщений в профиле с задаваемой STATUS_DEFAULT_STORE флагом в свойстве **PR_RESOURCE_FLAGS** [(PidTagResourceFlags),](pidtagresourceflags-canonical-property.md)что указывает на то, что он может быть хранилищем по умолчанию. Клиенты могут переопределять этот параметр, позвонив **в IMAPISession::SetDefaultStore**. Дополнительные сведения см. [в книге IMAPISession::SetDefaultStore.](imapisession-setdefaultstore.md)
  
MAPI создает транспортный порядок обработки исходяющих и входящих сообщений. Когда несколько поставщиков транспорта зарегистрировались для сообщения определенного типа, MAPI использует этот порядок, чтобы определить, какой поставщик должен обрабатывать сообщение. MAPI задает порядок транспорта, чтобы быть порядком, в котором поставщики транспорта были добавлены в профиль с  одним исключением — транспорты, заданная флагом STATUS_XP_PREFER_LAST в свойстве PR_RESOURCE_FLAGS, находятся последними в порядке. Клиенты могут установить порядок транспортировки, позвонив **в службу IMsgServiceAdmin::MsgServiceTransportOrder.** Дополнительные сведения см. в [фоторепортаре IMsgServiceAdmin::MsgServiceTransportOrder.](imsgserviceadmin-msgservicetransportorder.md)
  
Эти рекомендации по заказу поставщиков услуг и служб сообщений иногда могут противоречить. Если существует конфликт, код должен разрешить конфликт. Вы можете использовать программу Панели управления почтой для проверки созданного профиля, чтобы определить, настроены ли поставщики так, как ожидалось.
  

