---
title: Профили MAPI
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 493c87a4-317d-47ec-850b-342cac59594b
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 9db1f8e163e44a44df1e798cebccb3639325275e
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32340084"
---
# <a name="mapi-profiles"></a>Профили MAPI

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
В профиле хранится информация о поставщиках служб и службах сообщений, установленных на компьютере. Для каждого сеанса клиент во время работы выбирает один профиль с описанием используемых поставщиков и служб. Клиент может выбрать один из наборов профилей и при желании установить его в качестве значения по умолчанию. Профиль по умолчанию — это профиль, который выбирается автоматически, когда клиент запускает сеанс и не указал профиль явным образом.
  
Кроме того, в этих темах вы найдете обсуждение кэша псевдонимов, который хранится в двоичном потоке.
  
- [Кэш псевдонимов](nickname-cache.md)
    
- [Autocomplete Stream](autocomplete-stream.md)
    
- [Разбиение двоичных файлов](https://portalvhds6gyn3khqwmgzd.blob.core.windows.net/files/NK2/NK2WithBinaryExample.pdf)
    
## <a name="profile-sections"></a>Разделы профиля

Профили разделены на разделы, к которые клиенты и поставщики услуг имеют доступ для отображения свойств профилей для пользователей или для внесения изменений в конфигурацию. Раздел профиля — это объект MAPI, который реализует интерфейс **IProfSect,** который является потомков **IMAPIProp** и не имеет дополнительных методов. Дополнительные сведения см. в [подразделе IProfSect : IMAPIProp](iprofsectimapiprop.md). Его единственная цель — управлять свойствами раздела профиля. Чтобы получить **указатель IProfSect** на определенный раздел профиля, клиенты и поставщики услуг вызовят следующие методы. 
  
|||
|:-----|:-----|
|Клиенты могут звонить:  <br/> |[IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) <br/> |
|Поставщики услуг могут вызывать:  <br/> |[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md) <br/> |
|Клиенты или поставщики могут звонить:  <br/> |[IProviderAdmin::OpenProfileSection](iprovideradmin-openprofilesection.md) <br/> |
   
Профили организованы по иерархии так же, как MAPISVC. INF-файл. В верхней части иерархии есть разделы профилей, содержащие сведения, релевантные для профиля. Средний уровень содержит разделы, содержащие сведения об определенной службе сообщений, а нижний уровень содержит разделы, содержащие сведения об одном из поставщиков услуг в службе сообщений. 
  
Каждый профиль имеет несколько необходимых свойств, которые хранятся в одном или нескольких разделах профиля. Например, каждый профиль имеет свойства **PR_PROFILE_NAME** ([PidTagProfileName)](pidtagprofilename-canonical-property.md)и **PR_SEARCH_KEY** ([PidTagSearchKey).](pidtagsearchkey-canonical-property.md) Для ключа поиска профиля устанавливается значение, определенное в MAPIGUID. H как MUID_PROFILE_INSTANCE и всегда гарантируется уникальность среди всех профилей. Хотя два профиля могут иметь одно и то же имя, они не могут иметь один и тот же ключ поиска. Ключи поиска должны рассматриваться как двоичные данные, а не как данные любого конкретного типа.
  
Поставщики хранимых сообщений должны включить свойство **PR_DISPLAY_NAME** [(PidTagDisplayName)](pidtagdisplayname-canonical-property.md)в разделы профиля для профиля и поставщика их хранения сообщений, а также синхронизировать эти записи. Когда хранилище сообщений создается,  поставщик PR_DISPLAY_NAME на основе значения, хранимых в этих разделах профиля. 
  
Существует два основных различия между разделами профилей и другими объектами, которые наследуются от **IMAPIProp:** 
  
- Разделы профилей не поддерживают транзакции.
    
- Разделы профилей не поддерживают именуемые свойства, MAPI_E_NO_SUPPORT из их реализаций **IMAPIProp::GetIDsFromNames** и **IMAPIProp::GetNamesFromIDs.** Дополнительные сведения см. в подразделах [IMAPIProp::GetIDsFromNames](imapiprop-getidsfromnames.md) и [IMAPIProp::GetNamesFromIDs.](imapiprop-getnamesfromids.md)
    
Поскольку разделы профилей не поддерживают транзакции, изменения, внесенные с вызовами **IMAPIProp::CopyProps,** **CopyTo** или **SetProps,** сразу же вступает в силу. Дополнительные сведения см. в [подразделе IMAPIProp::CopyProps.](imapiprop-copyprops.md) Клиенты и поставщики услуг могут вызывать метод **IMAPIProp::SaveChanges** раздела профиля, и он будет успешным, но не повлияет на данные раздела профиля. Дополнительные сведения см. в [подразделе IMAPIProp::SaveChanges.](imapiprop-savechanges.md) Немедленное внесение изменений может повлиять на реализацию поставщиками служб листов свойств, которые клиенты используют для отображения свойств профилей пользователям. Поставщики услуг, которые хотят, чтобы пользователи могли откладывать или отменять изменения, должны реализовывать свои листы свойств с копиями разделов профиля, а не реальными разделами. С помощью копий пользователи могут вносить изменения, а затем отменять их, оставив исходные разделы профиля без изменений. 
  
Порядок, в котором информация отображается в профиле, влияет на то, как MAPI настраивает ресурсы и делает назначения в сеансе. На следующие назначения влияет порядок профилей:
  
- Хранилище сообщений по умолчанию
    
- Личная адресная книга
    
- Путь поиска в хранилище сообщений по умолчанию
    
- Путь поиска в адресной книге по умолчанию
    
- Порядок поставщика транспорта
    
MAPI задает хранилище сообщений по умолчанию как первое хранилище сообщений в профиле, для которого в свойстве **PR_RESOURCE_FLAGS** [(PidTagResourceFlags)](pidtagresourceflags-canonical-property.md)установлен флаг STATUS_DEFAULT_STORE, что указывает на то, что это может быть хранилище по умолчанию. Клиенты могут переопределять этот параметр, вызывая **IMAPISession::SetDefaultStore.** Дополнительные сведения см. в [подразделе IMAPISession::SetDefaultStore.](imapisession-setdefaultstore.md)
  
MAPI создает порядок транспорта для обработки исходяющих и входящих сообщений. Если для сообщения определенного типа зарегистрировано несколько поставщиков транспорта, MAPI использует этот порядок, чтобы определить, какой поставщик должен обрабатывать сообщение. MAPI задает порядок транспорта в порядке, в котором поставщики транспорта были добавлены в профиль с одним исключением — транспорты, которые устанавливают флаг STATUS_XP_PREFER_LAST в свойстве **PR_RESOURCE_FLAGS,** находятся последними в порядке. Клиенты могут настроить порядок транспорта, вызывая **IMsgServiceAdmin::MsgServiceTransportOrder.** Дополнительные сведения см. в [подсети IMsgServiceAdmin::MsgServiceTransportOrder.](imsgserviceadmin-msgservicetransportorder.md)
  
Эти рекомендации по упорядочению поставщиков услуг и служб сообщений иногда могут конфликтовть. В случае конфликта код должен устранить его. Вы можете использовать программу панели управления почтой для проверки созданного профиля, чтобы определить, правильно ли настроены поставщики.
  

