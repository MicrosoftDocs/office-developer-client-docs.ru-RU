---
title: Отправка сообщений с помощью поставщиков хранилищ сообщений
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7632d784-00d8-48fd-a73b-73778efbef7f
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: b34714a230adb44417624d149d34ed6a14a2dfa5
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32339685"
---
# <a name="sending-messages-by-using-message-store-providers"></a><span data-ttu-id="c62ed-103">Отправка сообщений с помощью поставщиков хранилищ сообщений</span><span class="sxs-lookup"><span data-stu-id="c62ed-103">Sending messages by using message store providers</span></span>

<span data-ttu-id="c62ed-104">**Область применения**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="c62ed-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="c62ed-105">Поставщики хранилища сообщений не обязательно должны поддерживать отправку исходящих сообщений (то есть, могут ли клиентские приложения использовать поставщика хранилища сообщений для отправки сообщений).</span><span class="sxs-lookup"><span data-stu-id="c62ed-105">Message store providers are not required to support outgoing message submissions (that is, the ability for client applications to use the message store provider to send messages).</span></span> <span data-ttu-id="c62ed-106">Клиентским приложениям необходимо использовать хранилище сообщений при отправке сообщений, так как данные этого сообщения должны храниться в другом месте между моментом, когда пользователь завершит составление приложения, а диспетчер очереди MAPI передает сообщение поставщику транспорта для Отправка в базовую систему обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="c62ed-106">Client applications need to use a message store while sending messages, because the message's data must be stored somewhere between the time that the user is finished composing it and the time that the MAPI spooler gives the message to a transport provider for submission to the underlying messaging system.</span></span> <span data-ttu-id="c62ed-107">Если поставщик хранилища сообщений не поддерживает отправку исходящих сообщений, он не может использоваться в качестве хранилища сообщений по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="c62ed-107">If your message store provider does not support outgoing message submissions, it cannot be used as the default message store.</span></span>
  
<span data-ttu-id="c62ed-108">Для поддержки отправки сообщений поставщик хранилища сообщений должен выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="c62ed-108">To support sending messages, your message store provider must do the following:</span></span>
  
- <span data-ttu-id="c62ed-109">Реализация очереди исходящих сообщений.</span><span class="sxs-lookup"><span data-stu-id="c62ed-109">Implement an outgoing message queue.</span></span>
    
- <span data-ttu-id="c62ed-110">Поддерживает метод [iMessage:: субмитмессаже](imessage-submitmessage.md) для объектов сообщений, созданных в хранилище сообщений.</span><span class="sxs-lookup"><span data-stu-id="c62ed-110">Support the [IMessage::SubmitMessage](imessage-submitmessage.md) method on message objects created in the message store.</span></span> 
    
- <span data-ttu-id="c62ed-111">Поддержка методов **IMsgStore** , характерных для ДИСПЕТЧЕРА очереди MAPI: [IMsgStore:: финишедмсг](imsgstore-finishedmsg.md), [IMsgStore:: Жетаутгоингкуеуе](imsgstore-getoutgoingqueue.md), [IMsgStore:: нотифиневмаил](imsgstore-notifynewmail.md)и [IMsgStore:: сетлоккстате](imsgstore-setlockstate.md).</span><span class="sxs-lookup"><span data-stu-id="c62ed-111">Support the **IMsgStore** methods that are specific to the MAPI spooler: [IMsgStore::FinishedMsg](imsgstore-finishedmsg.md), [IMsgStore::GetOutgoingQueue](imsgstore-getoutgoingqueue.md), [IMsgStore::NotifyNewMail](imsgstore-notifynewmail.md), and [IMsgStore::SetLockState](imsgstore-setlockstate.md).</span></span>
    
<span data-ttu-id="c62ed-112">Метод **сетлоккстате** важен для правильной взаимодействия между диспетчером MAPI и клиентами.</span><span class="sxs-lookup"><span data-stu-id="c62ed-112">The **SetLockState** method is important for proper interoperation between the MAPI spooler and clients.</span></span> <span data-ttu-id="c62ed-113">Когда диспетчер очереди MAPI вызывает **сетлоккстате** в исходящих сообщениях, поставщик хранилища сообщений не должен позволить клиентам открыть сообщение.</span><span class="sxs-lookup"><span data-stu-id="c62ed-113">When the MAPI spooler calls **SetLockState** on an outgoing message, the message store provider must not let clients open the message.</span></span> <span data-ttu-id="c62ed-114">Если клиент пытается открыть сообщение, заблокированное диспетчером очереди MAPI, поставщик хранилища сообщений должен возвратить МАПИ_Е_НО_АКЦЕСС.</span><span class="sxs-lookup"><span data-stu-id="c62ed-114">If a client does try to open a message that is locked by the MAPI spooler, the message store provider should return MAPI_E_NO_ACCESS.</span></span> <span data-ttu-id="c62ed-115">Заблокированное состояние сообщения не обязательно должно быть постоянным в случае завершения работы хранилища, пока сообщение заблокировано с помощью диспетчера очереди MAPI.</span><span class="sxs-lookup"><span data-stu-id="c62ed-115">The locked state of a message does not have to be persistent in case the store is shut down while the message is locked by the MAPI spooler.</span></span> 
  
<span data-ttu-id="c62ed-116">Независимо от того, заблокирован ли диспетчер очереди MAPI исходящее сообщение, поставщик хранилища сообщений не должен разрешить открытие сообщения в очереди исходящих сообщений для записи.</span><span class="sxs-lookup"><span data-stu-id="c62ed-116">Regardless of whether the MAPI spooler has locked an outgoing message, the message store provider should not allow a message in the outgoing message queue to be opened for writing.</span></span> <span data-ttu-id="c62ed-117">Если клиент вызывает метод [IMSgStore:: OpenEntry](imsgstore-openentry.md) для исходящего сообщения с флагом мапи_модифи, произойдет ошибка вызова и возвращается мапи_е_субмиттед.</span><span class="sxs-lookup"><span data-stu-id="c62ed-117">If a client calls the [IMSgStore::OpenEntry](imsgstore-openentry.md) method on an outgoing message with the MAPI_MODIFY flag, the call should fail and return MAPI_E_SUBMITTED.</span></span> <span data-ttu-id="c62ed-118">Если клиентское приложение вызывает **OpenEntry** для исходящего сообщения с флагом мапи_бест_акцесс, то поставщик хранилища сообщений должен разрешить доступ только для чтения к сообщению.</span><span class="sxs-lookup"><span data-stu-id="c62ed-118">If a client application calls **OpenEntry** on an outgoing message with the MAPI_BEST_ACCESS flag, the message store provider should allow read-only access to the message.</span></span> 
  
<span data-ttu-id="c62ed-119">Когда сообщение должно быть обработано диспетчером MAPI, поставщик хранилища сообщений задает для свойства **пр_субмит_флагс** ([PidTagSubmitFlags](pidtagsubmitflags-canonical-property.md)) сообщения значение субмитфлаг_локкед.</span><span class="sxs-lookup"><span data-stu-id="c62ed-119">When a message is to be handled by the MAPI spooler, the message store provider sets the message's **PR_SUBMIT_FLAGS** ([PidTagSubmitFlags](pidtagsubmitflags-canonical-property.md)) property to SUBMITFLAG_LOCKED.</span></span> <span data-ttu-id="c62ed-120">Значение СУБМИТФЛАГ_ЛОККЕД указывает, что диспетчер очереди MAPI заблокировал сообщение для монопольного использования.</span><span class="sxs-lookup"><span data-stu-id="c62ed-120">The SUBMITFLAG_LOCKED value indicates that the MAPI spooler has locked the message for its exclusive use.</span></span> <span data-ttu-id="c62ed-121">Другое значение для **пр_субмит_флагс**, субмитфлаг_препроцесс задается, когда сообщение требует предварительной обработки с помощью одной или нескольких функций препроцессора, зарегистрированных поставщиком транспорта.</span><span class="sxs-lookup"><span data-stu-id="c62ed-121">The other value for **PR_SUBMIT_FLAGS**, SUBMITFLAG_PREPROCESS, is set when the message requires preprocessing by one or more preprocessor functions registered by a transport provider.</span></span>
  
<span data-ttu-id="c62ed-122">В следующих процедурах описывается, как служба хранилища сообщений, транспорта и диспетчер MAPI взаимодействуют для отправки сообщения от клиента одному или нескольким получателям.</span><span class="sxs-lookup"><span data-stu-id="c62ed-122">The following procedures describe how the message store, transport, and MAPI spooler interact to send a message from a client to one or more recipients.</span></span> 
  
<span data-ttu-id="c62ed-123">Клиентское приложение вызывает метод [iMessage:: субмитмессаже](imessage-submitmessage.md) .</span><span class="sxs-lookup"><span data-stu-id="c62ed-123">The client application calls the [IMessage::SubmitMessage](imessage-submitmessage.md) method.</span></span> <span data-ttu-id="c62ed-124">В **субмитмессаже**поставщик хранилища сообщений выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="c62ed-124">In **SubmitMessage**, the message store provider does the following:</span></span>
  
1. <span data-ttu-id="c62ed-125">Calls [имаписуппорт::P репаресубмит](imapisupport-preparesubmit.md).</span><span class="sxs-lookup"><span data-stu-id="c62ed-125">Calls [IMAPISupport::PrepareSubmit](imapisupport-preparesubmit.md).</span></span> <span data-ttu-id="c62ed-126">Если MAPI возвращает ошибку, поставщик хранилища сообщений возвращает эту ошибку клиенту.</span><span class="sxs-lookup"><span data-stu-id="c62ed-126">If MAPI returns an error, the message store provider returns that error to the client.</span></span>
    
2. <span data-ttu-id="c62ed-127">Задает бит МСГФЛАГ_СУБМИТ в свойстве сообщения \*\*пр_мессаже_флагс\*\* ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="c62ed-127">Sets the MSGFLAG_SUBMIT bit in the **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) property of the message.</span></span>
    
3. <span data-ttu-id="c62ed-128">Проверяет наличие столбца для свойства **пр_респонсибилити** ([PidTagResponsibility](pidtagresponsibility-canonical-property.md)) в таблице получателей и ЗАДАЕТ для него значение false, чтобы показать, что транспорт еще не предпринял ответственность за передачу сообщения.</span><span class="sxs-lookup"><span data-stu-id="c62ed-128">Ensures that there is a column for the **PR_RESPONSIBILITY** ([PidTagResponsibility](pidtagresponsibility-canonical-property.md)) property in the recipient table and sets it to FALSE to indicate that no transport has yet assumed responsibility for transmitting the message.</span></span>
    
4. <span data-ttu-id="c62ed-129">Задает дату и время происхождения в свойстве **пр_клиент_субмит_тиме** ([PidTagClientSubmitTime](pidtagclientsubmittime-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="c62ed-129">Sets the date and time of origination in the **PR_CLIENT_SUBMIT_TIME** ([PidTagClientSubmitTime](pidtagclientsubmittime-canonical-property.md)) property.</span></span>
    
5. <span data-ttu-id="c62ed-130">Вызывает [имаписуппорт:: експандреЦипс](imapisupport-expandrecips.md) для выполнения следующих действий:</span><span class="sxs-lookup"><span data-stu-id="c62ed-130">Calls [IMAPISupport::ExpandRecips](imapisupport-expandrecips.md) to do the following:</span></span> 
    
    1. <span data-ttu-id="c62ed-131">���������� ��� ������ �������� � ����������� � �������� ��� ���������� ������������ ����� � ��������� �������.</span><span class="sxs-lookup"><span data-stu-id="c62ed-131">Expand all personal distribution lists and custom recipients and replace all changed display names with their original names.</span></span>
        
    2. <span data-ttu-id="c62ed-132">�������� ������������� ����.</span><span class="sxs-lookup"><span data-stu-id="c62ed-132">Remove duplicate names.</span></span>
        
    3. <span data-ttu-id="c62ed-133">Проверьте наличие необходимой предварительной обработки и, если необходима предварительная обработка, установите флаг НИДС_ПРЕПРОЦЕССИНГ и свойство \*\*пр_препроцесс\*\* ([PidTagPreprocess](pidtagpreprocess-canonical-property.md)), зарезервированное для MAPI.</span><span class="sxs-lookup"><span data-stu-id="c62ed-133">Check for any required preprocessing and, if preprocessing is required, set the NEEDS_PREPROCESSING flag and the **PR_PREPROCESS** ([PidTagPreprocess](pidtagpreprocess-canonical-property.md)) property, which is reserved for MAPI.</span></span> 
        
    4. <span data-ttu-id="c62ed-134">���������� ����� NEEDS_SPOOLER ��������� ��������� ����� ������� � ���������� � �� ����� ���������� ���� �����������.</span><span class="sxs-lookup"><span data-stu-id="c62ed-134">Set the NEEDS_SPOOLER flag if the message store is tightly coupled with a transport and it cannot handle all of the recipients.</span></span> 
    
6. <span data-ttu-id="c62ed-135">���� ���������� ���� ��������� NEEDS_PREPROCESSING ��������� ��������� ������:</span><span class="sxs-lookup"><span data-stu-id="c62ed-135">Performs the following tasks if the NEEDS_PREPROCESSING message flag is set:</span></span>
    
    1. <span data-ttu-id="c62ed-136">ПоМещает сообщение в исходящую очередь с установленным битом СУБМИТФЛАГ_ПРЕПРОЦЕСС в свойстве \*\*пр_субмит_флагс\*\* .</span><span class="sxs-lookup"><span data-stu-id="c62ed-136">Puts the message in the outgoing queue with the SUBMITFLAG_PREPROCESS bit set in the **PR_SUBMIT_FLAGS** property.</span></span> 
        
    2. <span data-ttu-id="c62ed-137">���������� ��������� ������� MAPI, ������� ��� ������� �������.</span><span class="sxs-lookup"><span data-stu-id="c62ed-137">Notifies the MAPI spooler that the queue has changed.</span></span>
        
    3. <span data-ttu-id="c62ed-138">��������� ���������� ������� � ����� ��������� ��-�������� ������������ � ��������� ������� MAPI.</span><span class="sxs-lookup"><span data-stu-id="c62ed-138">Returns control to the client, and message flow continues in the MAPI spooler.</span></span> <span data-ttu-id="c62ed-139">��������� ������� MAPI ��������� ��������� ������:</span><span class="sxs-lookup"><span data-stu-id="c62ed-139">The MAPI spooler performs the following tasks:</span></span> 
    
       1. <span data-ttu-id="c62ed-140">Блокирует сообщение, вызывая [IMsgStore:: сетлоккстате](imsgstore-setlockstate.md).</span><span class="sxs-lookup"><span data-stu-id="c62ed-140">Locks the message by calling [IMsgStore::SetLockState](imsgstore-setlockstate.md).</span></span>
            
       2. <span data-ttu-id="c62ed-141">Выполняет необходимую предварительную обработку, вызывая все функции предварительной обработки в порядке регистрации.</span><span class="sxs-lookup"><span data-stu-id="c62ed-141">Performs the needed preprocessing by calling all of the preprocessing functions in the order of registration.</span></span> <span data-ttu-id="c62ed-142">Поставщики транспорта вызывают [имаписуппорт:: регистерпрепроцессор](imapisupport-registerpreprocessor.md) для регистрации функций предварительной обработки.</span><span class="sxs-lookup"><span data-stu-id="c62ed-142">Transport providers call [IMAPISupport::RegisterPreprocessor](imapisupport-registerpreprocessor.md) to register preprocessing functions.</span></span> 
            
       3. <span data-ttu-id="c62ed-143">Вызывает [iMessage:: субмитмессаже](imessage-submitmessage.md) в открытом сообщении, чтобы показать банк сообщений, что предварительная обработка завершена.</span><span class="sxs-lookup"><span data-stu-id="c62ed-143">Calls [IMessage::SubmitMessage](imessage-submitmessage.md) on the open message to indicate to the message store that preprocessing is complete.</span></span> 
    
<span data-ttu-id="c62ed-144">Если Предварительная обработка не выполнялась, или при предварительной обработке и диспетчере очереди MAPI с именем **субмитмессаже**, то поставщик хранилища сообщений выполняет следующие действия в клиентском процессе.</span><span class="sxs-lookup"><span data-stu-id="c62ed-144">If there was no preprocessing, or there was preprocessing and the MAPI spooler called **SubmitMessage**, the message store provider does the following in the client process:</span></span> 
  
- <span data-ttu-id="c62ed-145">Performs the following tasks if the message store is tightly coupled to a transport and the NEEDS_SPOOLER flag was returned from [IMAPISupport::ExpandRecips](imapisupport-expandrecips.md):</span><span class="sxs-lookup"><span data-stu-id="c62ed-145">Performs the following tasks if the message store is tightly coupled to a transport and the NEEDS_SPOOLER flag was returned from [IMAPISupport::ExpandRecips](imapisupport-expandrecips.md):</span></span>
    
   - <span data-ttu-id="c62ed-146">������������ �����������, ������� ����� ������������.</span><span class="sxs-lookup"><span data-stu-id="c62ed-146">Handles any recipients that it can handle.</span></span>
    
   - <span data-ttu-id="c62ed-147">������������� ��� �������� **PR_RESPONSIBILITY** �������� TRUE ��� �����������, ������� �� ������������.</span><span class="sxs-lookup"><span data-stu-id="c62ed-147">Sets the **PR_RESPONSIBILITY** property to TRUE for any recipients that it handles.</span></span> 
    
   - <span data-ttu-id="c62ed-148">���� ��� ���������� ��������, ��� ���� ����� ��������� ��������� � ����������, ��������� ��������� ������:</span><span class="sxs-lookup"><span data-stu-id="c62ed-148">Performs the following tasks if all recipients are known to this tightly coupled store and transport:</span></span> 
    
     - <span data-ttu-id="c62ed-149">Вызывает [имаписуппорт:: комплетемсг](imapisupport-completemsg.md) , если сообщение было предварительно обработано, или поставщик хранилища сообщений хочет, чтобы диспетчер очереди MAPI завершил обработку сообщения.</span><span class="sxs-lookup"><span data-stu-id="c62ed-149">Calls [IMAPISupport::CompleteMsg](imapisupport-completemsg.md) if the message was preprocessed or the message store provider wants the MAPI spooler to complete message processing.</span></span> <span data-ttu-id="c62ed-150">Процесс обработки сообщений продолжается с помощью диспетчера очереди MAPI.</span><span class="sxs-lookup"><span data-stu-id="c62ed-150">Message flow continues with the MAPI spooler.</span></span> 
    
     - <span data-ttu-id="c62ed-151">Выполняет следующие задачи, если сообщение не было предварительно обработано, или поставщик хранилища сообщений не хочет, чтобы диспетчер очереди MAPI завершил обработку сообщений:</span><span class="sxs-lookup"><span data-stu-id="c62ed-151">Performs the following tasks if the message was not preprocessed or the message store provider does not want the MAPI spooler to complete message processing:</span></span>
    
       1. <span data-ttu-id="c62ed-152">Копирует сообщение в папку, указанную идентификатором записи, в свойстве **пр_сентмаил_ентрид** ([PidTagSentMailEntryId](pidtagsentmailentryid-canonical-property.md)), если оно задано.</span><span class="sxs-lookup"><span data-stu-id="c62ed-152">Copies the message to the folder identified by the entry identifier in the **PR_SENTMAIL_ENTRYID** ([PidTagSentMailEntryId](pidtagsentmailentryid-canonical-property.md)) property, if set.</span></span>
            
       2. <span data-ttu-id="c62ed-153">Удаляет сообщение, если для свойства **пр_делете_афтер_субмит** ([PidTagDeleteAfterSubmit](pidtagdeleteaftersubmit-canonical-property.md)) задано значение true.</span><span class="sxs-lookup"><span data-stu-id="c62ed-153">Deletes the message if the **PR_DELETE_AFTER_SUBMIT** ([PidTagDeleteAfterSubmit](pidtagdeleteaftersubmit-canonical-property.md)) property has been set to TRUE.</span></span>
            
       3. <span data-ttu-id="c62ed-154">Разблокирует сообщение, если оно заблокировано.</span><span class="sxs-lookup"><span data-stu-id="c62ed-154">Unlocks the message if it is locked.</span></span>
            
       4. <span data-ttu-id="c62ed-155">Возвращает клиенту.</span><span class="sxs-lookup"><span data-stu-id="c62ed-155">Returns to the client.</span></span> <span data-ttu-id="c62ed-156">Процесс обработки сообщений завершен.</span><span class="sxs-lookup"><span data-stu-id="c62ed-156">Message flow is complete.</span></span>
    
  - <span data-ttu-id="c62ed-157">Выполняет следующие задачи, если сообщение было предварительно обработано, или поставщику требуется, чтобы диспетчер очереди MAPI завершил обработку сообщений:</span><span class="sxs-lookup"><span data-stu-id="c62ed-157">Performs the following tasks if the message was preprocessed or the provider wants the MAPI spooler to complete message processing:</span></span>
    
    1. <span data-ttu-id="c62ed-158">Calls [имаписуппорт:: комплетемсг](imapisupport-completemsg.md).</span><span class="sxs-lookup"><span data-stu-id="c62ed-158">Calls [IMAPISupport::CompleteMsg](imapisupport-completemsg.md).</span></span> 
          
    2. <span data-ttu-id="c62ed-159">Продолжает процесс обработки сообщений с помощью диспетчера очереди MAPI.</span><span class="sxs-lookup"><span data-stu-id="c62ed-159">Continues message flow with the MAPI spooler.</span></span> <span data-ttu-id="c62ed-160">Более подробную информацию можно узнать в статье [Отправка сообщений: задачи системы буферизации MAPI](sending-messages-mapi-spooler-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="c62ed-160">For more information, see [Sending Messages: MAPI Spooler Tasks](sending-messages-mapi-spooler-tasks.md).</span></span>
    
  - <span data-ttu-id="c62ed-161">Выполняет следующие задачи, если сообщение не было предварительно обработано, или поставщик не желает, чтобы диспетчер очереди завершил обработку сообщений:</span><span class="sxs-lookup"><span data-stu-id="c62ed-161">Performs the following tasks if the message was not preprocessed or the provider does not want the spooler to complete message processing:</span></span>
    
    1. <span data-ttu-id="c62ed-162">Копирует сообщение в папку, указанную идентификатором записи, в свойстве **пр_сентмаил_ентрид** , если оно задано.</span><span class="sxs-lookup"><span data-stu-id="c62ed-162">Copies the message to the folder identified by the entry identifier in the **PR_SENTMAIL_ENTRYID** property, if set.</span></span> 
        
    2. <span data-ttu-id="c62ed-163">Удаляет сообщение, если для свойства **пр_делете_афтер_субмит** ЗАДАНО значение true.</span><span class="sxs-lookup"><span data-stu-id="c62ed-163">Deletes the message if the **PR_DELETE_AFTER_SUBMIT** property has been set to TRUE.</span></span> 
        
    3. <span data-ttu-id="c62ed-164">Разблокирует сообщение, если оно заблокировано.</span><span class="sxs-lookup"><span data-stu-id="c62ed-164">Unlocks the message if it is locked.</span></span> 
        
    4. <span data-ttu-id="c62ed-165">Возвращает вызывающему абоненту.</span><span class="sxs-lookup"><span data-stu-id="c62ed-165">Returns to the caller.</span></span> <span data-ttu-id="c62ed-166">Процесс обработки сообщений завершен.</span><span class="sxs-lookup"><span data-stu-id="c62ed-166">Message flow is complete.</span></span>
    
- <span data-ttu-id="c62ed-167">���� ��������� ��������� �� ����� ���������� ��� ����������, �� ���� ����������� ��������, ��� ��������� ��������� ��� ���� NEEDS_SPOOLER ��������� ��������� ������:</span><span class="sxs-lookup"><span data-stu-id="c62ed-167">Performs the following tasks if the message store is not tightly coupled to a transport, not all of the recipients were known to the message store, or the NEEDS_SPOOLER flag is set:</span></span>
    
  1. <span data-ttu-id="c62ed-168">��������� ���������� � ������� ��������� ��� ��������� ���� SUBMITFLAG_PREPROCESS � �������� **PR_SUBMIT_FLAGS**.</span><span class="sxs-lookup"><span data-stu-id="c62ed-168">Puts the message in the outgoing queue without setting the SUBMITFLAG_PREPROCESS bit in the **PR_SUBMIT_FLAGS** property.</span></span> 
    
  2. <span data-ttu-id="c62ed-169">���������� ��������� ������� MAPI, ��������� ������� ��� �������, ������ ����������� � �������.</span><span class="sxs-lookup"><span data-stu-id="c62ed-169">Notifies the MAPI spooler that the outgoing queue has changed by generating a table notification.</span></span> 
    
  3. <span data-ttu-id="c62ed-170">���������� ������� � ����� ��������� ��-�������� ������������ � ������� ������, ����������� ����������� ������� MAPI.</span><span class="sxs-lookup"><span data-stu-id="c62ed-170">Returns to the client, and message flow continues with a set of tasks performed by the MAPI spooler.</span></span>
    
## <a name="see-also"></a><span data-ttu-id="c62ed-171">См. также</span><span class="sxs-lookup"><span data-stu-id="c62ed-171">See also</span></span>

- [<span data-ttu-id="c62ed-172">���������� ��������� ���������</span><span class="sxs-lookup"><span data-stu-id="c62ed-172">Message Store Features</span></span>](message-store-features.md)

