---
title: Написание кода на сервере формы
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: ff33badc-ceed-4364-b99c-8af3af83ceb6
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: a93e53261d56e452f38e38da427585cecccba405
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32325797"
---
# <a name="writing-form-server-code"></a>Написание кода на сервере формы

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Сервер формы можно представить следующим образом: 
  
- Программа Win32, которая отображает интерфейс и обрабатывает сообщения Windows с помощью стандартных механизмов приема сообщений Windows.
    
- Объект, который регистрирует фабрику классов с помощью OLE и активируется методами автоматизации OLE.
    
- Объект MAPI, который следует правилам MAPI для взаимодействия с другими компонентами MAPI.
    
 Код должен одновременно обрабатывать все три из этих общих требований. 
  
В разделе службы объектов COM и ActiveX в пакете Windows SDK вы найдете подробные сведения о регистрации фабрики классов на сервере форм. Обработка сообщений Windows и отображение интерфейса — это стандартные приемы программирования Windows, которые не имеют специальных требований в отношении форм MAPI. Опять же, пакет Windows SDK содержит подробные сведения о программировании для Windows. В этом документе содержатся сведения о том, как реализовать обязательные и необязательные интерфейсы форм MAPI, чтобы они применялись к правилам MAPI для взаимодействия с другими компонентами MAPI, в первую очередь Диспетчер форм MAPI и клиентские приложения для обмена сообщениями.
  
Все интерфейсы, которые можно использовать при реализации серверов форм, являются производными (напрямую или косвенно) от интерфейса [IUnknown](https://msdn.microsoft.com/library/33f1d79a-33fc-4ce5-a372-e08bda378332%28Office.15%29.aspx)базового класса OLE. Это означает, что все реализации этих интерфейсов должны иметь методы **QueryInterface**, **AddRef**и **Release** . Если вы используете несколько наследований для реализации всех необходимых интерфейсов в одном новом классе, вы можете сохранить множество работ, чтобы все используемые интерфейсы могли совместно использовать одну реализацию требуемых методов **IUnknown** . Дополнительные сведения см. в методах [IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx), [IUnknown:: QueryInterface](https://msdn.microsoft.com/library/54d5ff80-18db-43f2-b636-f93ac053146d%28Office.15%29.aspx)и [IUnknown:: Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) . Для этих методов не существует специальных рекомендаций по отношению к серверам форм MAPI. 
  
Хотя не все интерфейсы форм MAPI являются обязательными для всех серверов форм, методы в любом заданном интерфейсе являются обязательными. То есть, если вы решили реализовать определенный интерфейс, необходимо реализовать все методы в интерфейсе. Это отличается от ситуации с некоторыми другими компонентами MAPI, такими как транспортировка сообщений. К счастью, методы в интерфейсах форм MAPI являются относительно простыми, поэтому реализация всех этих интерфейсов не приводит к значительным затратам на разработчиков.
  
Интерфейсы форм MAPI не зависят от типа средства разработки, используемого для создания сервера форм. Это позволяет создавать формы с помощью различных средств разработки. Единственное требование состоит в том, что все серверы форм должны поддерживать необходимые интерфейсы форм MAPI.
  
Не все интерфейсы MAPI, которые относятся к формам, необходимы для всех серверов форм. Необязательные интерфейсы позволяют реализовать некоторые расширенные функции форм, которые не требуются большинству серверов форм. В следующей таблице приведены интерфейсы, их назначение и необходимость их реализации.
  
|**Интерфейс**|**Описание**|**Состояние**|
|:-----|:-----|:-----|
|[IMAPIForm : IUnknown](imapiformiunknown.md) <br/> |Основной интерфейс, используемый клиентами для загрузки серверов форм, выполнения команд форм и завершения работы серверов форм. Это также интерфейс, производный от интерфейса **IUnknown** OLE, который используется для информирования других компонентов OLE относительно того, какие интерфейсы реализуют объект формы.  <br/> |Обязательный  <br/> |
|[IPersistMessage : IUnknown](ipersistmessageiunknown.md) <br/> |Используется при загрузке сообщений в и сохранения сообщений из объектов формы.  <br/> |Обязательный  <br/> |
|[IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) <br/> |Используется объектами Form для отслеживания состояния клиентов системы обмена сообщениями и выяснения того, может ли объект формы отображать следующее или предыдущее сообщение в папке.  <br/> |Необязательный  <br/> |
|[IClassFactory](https://msdn.microsoft.com/library/f624f833-2b69-43bc-92cd-c4ecbe6051c5%28Office.15%29.aspx) <br/> |Интерфейс фабрики классов OLE, используемый объектами формы для обеспечения соответствия механизму производства классов OLE.  <br/> |Обязательный  <br/> |
|[IMAPIFormFactory : IUnknown](imapiformfactoryiunknown.md) <br/> |Используется, если сервер форм поддерживает более одного типа формы. В этом случае интерфейс **имапиформфактори** позволяет клиентским приложениям получать доступ к нескольким интерфейсам **IClassFactory** (по одному для каждого типа формы, поддерживаемой сервером форм), которые сервер формы также должен реализовать.  <br/> |Необязательный  <br/> |
   
## <a name="see-also"></a>См. также



[Разработка серверов форм MAPI](developing-mapi-form-servers.md)

