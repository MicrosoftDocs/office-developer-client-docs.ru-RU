---
title: Поддержка функциональных обязанностей для хранения форматированных текстовых сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435518"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a><span data-ttu-id="95570-103">Поддержка форматированного текста: обязанности хранилища сообщений</span><span class="sxs-lookup"><span data-stu-id="95570-103">Supporting Formatted Text: Message Store Responsibilities</span></span>

  
  
<span data-ttu-id="95570-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="95570-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="95570-105">Поставщики хранилищ сообщений используют свойство **пр_сторе_суппорт_маск** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)), чтобы опубликовать, могут ли они обрабатывать RTF-текст, HTML-текст и, если они имеют формат RTF, хранятся ли форматированные тексты в сжатый или несжатый формат.</span><span class="sxs-lookup"><span data-stu-id="95570-105">Message store providers use the **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property to publish whether or not they can handle Rich Text Format (RTF), HTML text and, if they are RTF-aware, whether they store the formatted text in a compressed or uncompressed format.</span></span> <span data-ttu-id="95570-106">Поставщики хранилищ сообщений указывают, что они поддерживают RTF, устанавливая бит СТОРЕ_РТФ_ОК и хранят форматированный текст в несжатом виде, устанавливая бит СТОРЕ_УНКОМПРЕССЕД_РТФ.</span><span class="sxs-lookup"><span data-stu-id="95570-106">Message store providers indicate that they are RTF-aware by setting the STORE_RTF_OK bit and that they store the formatted text in an uncompressed form by setting the STORE_UNCOMPRESSED_RTF bit.</span></span> <span data-ttu-id="95570-107">Поставщики хранилищ сообщений указывают, что они поддерживают HTML, устанавливая бит СТОРЕ_ХТМЛ_ОК.</span><span class="sxs-lookup"><span data-stu-id="95570-107">Message store providers indicate they are HTML-aware by setting the STORE_HTML_OK bit.</span></span>
  
<span data-ttu-id="95570-108">Несмотря на то, что для клиента, поддерживающего RTF, необходимо проверить, поддерживает ли хранилище сообщений СТОРЕ_РТФ_ОК, не нужно, чтобы клиент задумывать формат форматированного текста в формате RTF.</span><span class="sxs-lookup"><span data-stu-id="95570-108">While it is important for an RTF-aware client to check for the STORE_RTF_OK bit to determine whether or not a message store supports RTF, it is not necessary for a client to be concerned with the format of an RTF-aware store's formatted text.</span></span> 
  
<span data-ttu-id="95570-109">Все хранилища сообщений должны поддерживать клиентов, не поддерживающих RTF.</span><span class="sxs-lookup"><span data-stu-id="95570-109">All message stores must support non-RTF-aware clients.</span></span> <span data-ttu-id="95570-110">В хранилище сообщений, не поддерживающем RTF, необходимо удалить свойство **пр_ртф_ин_синк** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) во время вызова метода [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) , если клиент изменил **пр_боди** ([PidTagBody](pidtagbody-canonical-property.md)) без Обновление **пр_ртф_ин_синк** или **пр_ртф_компрессед** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="95570-110">A non-RTF-aware message store must delete the **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) property during a call to the message's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method if a client has changed **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) without updating either **PR_RTF_IN_SYNC** or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span></span> <span data-ttu-id="95570-111">При удалении **пр_ртф_ин_синк** свойство **пр_ртф_компрессед** будет пересчитано из свойства **пр_боди** при следующем вызове клиентом, поддерживающего RTF, [ртфсинк](rtfsync.md).</span><span class="sxs-lookup"><span data-stu-id="95570-111">Deleting **PR_RTF_IN_SYNC** causes the **PR_RTF_COMPRESSED** property to be recomputed from the **PR_BODY** property the next time an RTF-aware client calls [RTFSync](rtfsync.md).</span></span> 
  
<span data-ttu-id="95570-112">Большинству хранилищ сообщений, поддерживающих RTF, не назначается текст сообщения клиентами; Он должен вычисляться по запросу.</span><span class="sxs-lookup"><span data-stu-id="95570-112">Most RTF-aware message stores are not given the message text by clients; it must be computed on request.</span></span> <span data-ttu-id="95570-113">Так как это вычисление занимает много времени и требует затрат, клиенты должны использовать **пр_ртф_компрессед** везде, где это возможно.</span><span class="sxs-lookup"><span data-stu-id="95570-113">Because this computation is time consuming and expensive, clients should use **PR_RTF_COMPRESSED** whenever possible.</span></span> <span data-ttu-id="95570-114">Чтобы вычислить свойство **пр_боди** , поставщик хранилища сообщений должен распаковать содержимое свойства **пр_ртф_компрессед** и удалить форматированный текст.</span><span class="sxs-lookup"><span data-stu-id="95570-114">To compute the **PR_BODY** property, the message store provider must uncompress the contents of the **PR_RTF_COMPRESSED** property and remove the rich text formatting.</span></span> <span data-ttu-id="95570-115">Клиенты, не поддерживающие свойство **пр_ртф_компрессед** , должны выполнять это вычисление для каждого сообщения.</span><span class="sxs-lookup"><span data-stu-id="95570-115">Clients that do not support the **PR_RTF_COMPRESSED** property require this computation to take place for every message.</span></span> 
  
<span data-ttu-id="95570-116">При копировании сообщений, поставщики хранилищ сообщений, которые не используют метод **имаписуппорт::D окопипропс** или **Имаписуппорт::D окопито** , выполняют риск создания сообщения без содержимого, если их реализация исключает **пр_боди** и полагается на **пр_ртф_компрессед**.</span><span class="sxs-lookup"><span data-stu-id="95570-116">When copying messages, message store providers that do not use the **IMAPISupport::DoCopyProps** or **IMAPISupport::DoCopyTo** methods run the risk of creating a message with no content if their implementation excludes the **PR_BODY** property and relies on **PR_RTF_COMPRESSED**.</span></span> <span data-ttu-id="95570-117">Данные в свойстве **пр_ртф_компрессед** могут быть повреждены.</span><span class="sxs-lookup"><span data-stu-id="95570-117">It is possible for the data in the **PR_RTF_COMPRESSED** property to be corrupt.</span></span> <span data-ttu-id="95570-118">Прежде чем исключить одно из этих свойств содержимого сообщения в операции копирования, проверьте наличие повреждений следующим образом:</span><span class="sxs-lookup"><span data-stu-id="95570-118">Before excluding either of these message content properties in the copy operation, check for corruption as follows:</span></span> 
  
1. <span data-ttu-id="95570-119">Если значение **пр_ртф_компрессед** не ПРЕВЫШАЕТ сжатый формат RTF, свойство повреждено.</span><span class="sxs-lookup"><span data-stu-id="95570-119">If the value of **PR_RTF_COMPRESSED** is not larger than the compressed RTF, the property is corrupt.</span></span> 
    
2. <span data-ttu-id="95570-120">Если магическое значение в заголовке RTF не является _двмагиккомпресседртф_ или _двмагикункомпресседртф_, свойство повреждено.</span><span class="sxs-lookup"><span data-stu-id="95570-120">If the magic value in the RTF header is not  _dwMagicCompressedRTF_ or  _dwMagicUncompressedRTF_, the property is corrupt.</span></span>
    
<span data-ttu-id="95570-121">Поставщики хранилища сообщений, использующие методы поддержки, не должны быть связаны с реализацией проверки на наличие повреждений **пр_ртф_компрессед** ; MAPI гарантирует, что соответствующие свойства существуют и действительны.</span><span class="sxs-lookup"><span data-stu-id="95570-121">Message store providers using the support methods need not be concerned with implementing a check for **PR_RTF_COMPRESSED** corruption; MAPI ensures that the appropriate properties exist and are valid.</span></span> 
  
<span data-ttu-id="95570-122">Существует три разных уровня поддержки формата RTF, которые могут реализовывать поставщики хранилищ сообщений. MAPI рекомендует поставщикам хранилищ сообщений, поддерживающим RTF, реализовать их поддержку на среднем или высшем уровне.</span><span class="sxs-lookup"><span data-stu-id="95570-122">There are three different levels of RTF support that message store providers can implement; MAPI recommends that RTF-aware message store providers implement their support at the middle or highest level.</span></span> <span data-ttu-id="95570-123">Все поставщики хранилищ сообщений, поддерживающих RTF, выполняют создание **пр_боди** из данных, включенных в **пр_ртф_компрессед** , в исходящих сообщениях и выполняют вызов **ртфсинк** для синхронизации текста и форматирования в входящих сообщениях.</span><span class="sxs-lookup"><span data-stu-id="95570-123">All RTF-aware message store providers take care of generating **PR_BODY** from the data included in **PR_RTF_COMPRESSED** on outgoing messages and make a call to **RTFSync** to synchronize text and formatting on incoming messages.</span></span> 
  
<span data-ttu-id="95570-124">Различия между этими тремя уровнями описаны в следующей таблице.</span><span class="sxs-lookup"><span data-stu-id="95570-124">The differences between these three levels are described in the following table.</span></span> 
  
|<span data-ttu-id="95570-125">**Уровень поддержки**</span><span class="sxs-lookup"><span data-stu-id="95570-125">**Level of support**</span></span>|<span data-ttu-id="95570-126">**Описание**</span><span class="sxs-lookup"><span data-stu-id="95570-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="95570-127">Низкая</span><span class="sxs-lookup"><span data-stu-id="95570-127">Low</span></span>  <br/> |<span data-ttu-id="95570-128">Поставщик хранилища сообщений вызывает **ртфсинк** при каждом сохранении изменений в сообщении и извлечения данных для свойства **пр_боди** из **пр_ртф_компрессед** , не требуя от клиентов задавать его.</span><span class="sxs-lookup"><span data-stu-id="95570-128">Message store provider calls **RTFSync** whenever changes are saved to a message and extracts the data for the **PR_BODY** property from **PR_RTF_COMPRESSED** rather than requiring clients to set it.</span></span> <span data-ttu-id="95570-129">Хранятся как **пр_боди** , так и **пр_ртф_компрессед** .</span><span class="sxs-lookup"><span data-stu-id="95570-129">Both **PR_BODY** and **PR_RTF_COMPRESSED** are stored.</span></span>  <br/> |
|<span data-ttu-id="95570-130">Назван</span><span class="sxs-lookup"><span data-stu-id="95570-130">Middle</span></span>  <br/> |<span data-ttu-id="95570-131">Поставщик хранилища сообщений хранит только свойство **пр_ртф_компрессед** , вычисляя **пр_боди** при необходимости.</span><span class="sxs-lookup"><span data-stu-id="95570-131">Message store provider stores only the **PR_RTF_COMPRESSED** property, computing **PR_BODY** when necessary.</span></span>  <br/> |
|<span data-ttu-id="95570-132">Высокая</span><span class="sxs-lookup"><span data-stu-id="95570-132">High</span></span>  <br/> |<span data-ttu-id="95570-133">Поставщик хранилища сообщений хранит ни **пр_боди** , ни вспомогательные свойства RTF.</span><span class="sxs-lookup"><span data-stu-id="95570-133">Message store provider stores neither **PR_BODY** or the auxiliary RTF properties.</span></span> <span data-ttu-id="95570-134">**Ртфсинк** вызывается, когда текст сообщения изменяется, а форматирование остается без изменений или при загрузке нового сообщения поставщиком транспорта.</span><span class="sxs-lookup"><span data-stu-id="95570-134">**RTFSync** is called when the message text has changed and the formatting remains unchanged or when a new message is downloaded by a transport provider.</span></span>  <br/> |
   

