---
title: Поддержка функциональных обязанностей для хранения форматированных текстовых сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435518"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a>Поддержка форматированного текста: обязанности хранилища сообщений

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Поставщики хранилищ сообщений используют свойство **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)), чтобы опубликовать, могут ли они обрабатывать RTF-текст, HTML-текст и, если они имеют формат RTF, хранятся ли форматированный текст в сжатом или несжатом формате. Поставщики хранилищ сообщений указывают, что они поддерживают RTF, устанавливая STORE_RTF_OK бит и хранят форматированный текст в несжатом виде, устанавливая STORE_UNCOMPRESSED_RTF бит. Поставщики хранилищ сообщений указывают, что они поддерживают HTML, устанавливая STORE_HTML_OK бит.
  
Несмотря на то, что для клиента, поддерживающего RTF, необходимо проверить, поддерживает ли этот STORE_RTF_OK бит, чтобы определить, поддерживает ли хранилище сообщений формат RTF, не нужно, чтобы клиент задумывать формат форматированного текста в формате RTF. 
  
Все хранилища сообщений должны поддерживать клиентов, не поддерживающих RTF. В хранилище сообщений, не поддерживающем RTF, необходимо удалить свойство **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) во время вызова метода [IMAPIProp:: savechanges](imapiprop-savechanges.md) , если клиент изменил **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) без обновления **PR_RTF_IN_SYNC** или **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)). При удалении **PR_RTF_IN_SYNC** в следующий раз, когда клиент, ПОДДЕРЖИВАЮЩий RTF, вызывает [ртфсинк](rtfsync.md), свойство **PR_RTF_COMPRESSED** будет пересчитано из свойства **PR_BODY** . 
  
Большинству хранилищ сообщений, поддерживающих RTF, не назначается текст сообщения клиентами; Он должен вычисляться по запросу. Так как это вычисление занимает много времени и требует затрат, клиенты должны использовать **PR_RTF_COMPRESSED** везде, где это возможно. Чтобы вычислить свойство **PR_BODY** , поставщик хранилища сообщений должен распаковать содержимое свойства **PR_RTF_COMPRESSED** и удалить форматированный текст. Клиенты, не поддерживающие свойство **PR_RTF_COMPRESSED** , требуют, чтобы это вычисление выполнялось для каждого сообщения. 
  
При копировании сообщений, поставщики хранилищ сообщений, которые не используют метод **имаписуппорт::D окопипропс** или **Имаписуппорт::D окопито** , выполняют риск создания сообщения без содержимого, если их реализация исключает свойство **PR_BODY** и использует **PR_RTF_COMPRESSED**. Данные в свойстве **PR_RTF_COMPRESSED** могут быть повреждены. Прежде чем исключить одно из этих свойств содержимого сообщения в операции копирования, проверьте наличие повреждений следующим образом: 
  
1. Если значение **PR_RTF_COMPRESSED** не превышает сжатый формат RTF, свойство повреждено. 
    
2. Если магическое значение в заголовке RTF не является _двмагиккомпресседртф_ или _двмагикункомпресседртф_, свойство повреждено.
    
Поставщики хранилища сообщений, использующие методы поддержки, не должны быть связаны с реализацией проверки на **PR_RTF_COMPRESSED** повреждения; MAPI гарантирует, что соответствующие свойства существуют и действительны. 
  
Существует три разных уровня поддержки формата RTF, которые могут реализовывать поставщики хранилищ сообщений. MAPI рекомендует поставщикам хранилищ сообщений, поддерживающим RTF, реализовать их поддержку на среднем или высшем уровне. Все поставщики хранилищ сообщений, поддерживающих RTF, выполняют генерацию **PR_BODY** из данных, включенных в **PR_RTF_COMPRESSED** в исходящих сообщениях, и выполняют вызов **ртфсинк** для синхронизации текста и форматирования в входящих сообщениях. 
  
Различия между этими тремя уровнями описаны в следующей таблице. 
  
|**Уровень поддержки**|**Описание**|
|:-----|:-----|
|Низкий  <br/> |Поставщик хранилища сообщений вызывает **ртфсинк** при каждом сохранении изменений в сообщении и извлечении данных для свойства **PR_BODY** из **PR_RTF_COMPRESSED** вместо того, чтобы требовать от клиентов задавать его. Хранятся как **PR_BODY** , так и **PR_RTF_COMPRESSED** .  <br/> |
|Назван  <br/> |Поставщик хранилища сообщений хранит только свойство **PR_RTF_COMPRESSED** , вычисляя **PR_BODY** при необходимости.  <br/> |
|Высокий  <br/> |Поставщик хранилища сообщений не хранит ни **PR_BODY** , ни вспомогательные свойства RTF. **Ртфсинк** вызывается, когда текст сообщения изменяется, а форматирование остается без изменений или при загрузке нового сообщения поставщиком транспорта.  <br/> |
   

