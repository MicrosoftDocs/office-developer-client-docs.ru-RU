---
title: Поддержка функций магазина текстовых сообщений в формате
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435518"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a>Поддержка форматного текста: обязанности магазина сообщений

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Поставщики магазинов **сообщений** используют свойство PR_STORE_SUPPORT_MASK [(PidTagStoreSupportMask)](pidtagstoresupportmask-canonical-property.md)для публикации, могут ли они обрабатывать насыщенный текстовый формат (RTF), HTML-текст и, если они осведомлены о RTF, хранят ли они отформатированный текст в сжатом или некомпрессованном формате. Поставщики магазинов сообщений указывают, что они осведомлены о RTF, задав STORE_RTF_OK бит и храня отформатированный текст в некомпрессивной форме, задав STORE_UNCOMPRESSED_RTF бит. Поставщики магазинов сообщений указывают, что они знают HTML, задаем STORE_HTML_OK бит.
  
Несмотря на то, что для клиента, известного по RTF, важно проверить, поддерживает ли STORE_RTF_OK или нет RTF- хранилище сообщений, не обязательно, чтобы клиент был заинтересован в формате форматного текста магазина, известного для RTF. 
  
Все хранилища сообщений должны поддерживать клиентов, не осведомленных о RTF. Хранилище сообщений, не известное RTF, должно удалить свойство **PR_RTF_IN_SYNC** [(PidTagRtfInSync)](pidtagrtfinsync-canonical-property.md)во время вызова метода [IMAPIProp::SaveChanges,](imapiprop-savechanges.md) если клиент изменил PR_BODY [(PidTagBody)](pidtagbody-canonical-property.md)без обновления PR_RTF_IN_SYNC или **PR_RTF_COMPRESSED**  [(PidTagRtfCompressed).](pidtagrtfcompressed-canonical-property.md)  Удаление **PR_RTF_IN_SYNC** вызывает повторное PR_RTF_COMPRESSED свойства из **свойства** PR_BODY при следующем вызове [RTF-клиентом RTFSync.](rtfsync.md)  
  
Большинство RTF-магазинов сообщений не дают текст сообщения клиентами; он должен быть вычислен по запросу. Поскольку эти вычисления являются трудоемкими и дорогостоящими, клиенты должны использовать PR_RTF_COMPRESSED по **возможности.** Чтобы вычислить **свойство PR_BODY,** поставщик магазина сообщений должен удалить содержимое  свойства PR_RTF_COMPRESSED и удалить форматирование текста. Клиенты, которые не поддерживают **свойство PR_RTF_COMPRESSED,** требуют, чтобы эти вычисления состоялись для каждого сообщения. 
  
При копировании сообщений поставщики магазинов сообщений, которые не используют **IMAPISupport::D CopyProps** или **IMAPISupport::D oCopyTo,** рискуют создать сообщение без контента, если их реализация исключает свойство **PR_BODY** и зависит **от PR_RTF_COMPRESSED**. Данные в свойстве PR_RTF_COMPRESSED **могут** быть повреждены. Перед исключением любого из этих свойств контента сообщений в операции копирования убедитесь в коррупции следующим образом: 
  
1. Если значение **PR_RTF_COMPRESSED** не больше сжатого RTF, свойство повреждено. 
    
2. Если магическое значение в загоне RTF не  _dwMagicCompressedRTF_ или  _dwMagicUncompressedRTF,_ свойство повреждено.
    
Поставщики магазинов сообщений, использующие методы поддержки, не должны иметь отношения к реализации проверки на PR_RTF_COMPRESSED **повреждения;** MAPI гарантирует, что соответствующие свойства существуют и являются действительными. 
  
Существует три различных уровня поддержки RTF, которые могут реализовать поставщики хранения сообщений; MAPI рекомендует поставщикам магазинов сообщений, которые знают RTF, реализовать свою поддержку на среднем или самом высоком уровне. Все поставщики RTF-магазинов сообщений  заботятся о создании PR_BODY из данных, включенных в **PR_RTF_COMPRESSED,** исходящей информации, и звонят в **RTFSync** для синхронизации текста и форматирования входящих сообщений. 
  
Различия между этими тремя уровнями описаны в следующей таблице. 
  
|**Уровень поддержки**|**Описание**|
|:-----|:-----|
|Низкие  <br/> |Поставщик магазина сообщений вызывает **RTFSync** всякий **раз,** когда  изменения сохраняются в сообщении, и извлекает данные для свойства PR_BODY из PR_RTF_COMPRESSED, а не требует от клиентов его устанавливать. Хранятся **PR_BODY** **PR_RTF_COMPRESSED** и PR_RTF_COMPRESSED.  <br/> |
|Средний  <br/> |Поставщик хранилища сообщений сохраняет только **PR_RTF_COMPRESSED,** **вычисляя** PR_BODY при необходимости.  <br/> |
|Фишинговое сообщение с  <br/> |Поставщик хранилища сообщений не **хранит PR_BODY** или вспомогательные свойства RTF. **RTFSync** называется, когда текст сообщения изменен и форматирование остается неизменным или когда новое сообщение загружается поставщиком транспорта.  <br/> |
   

