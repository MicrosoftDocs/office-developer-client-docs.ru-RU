---
title: Поддержка функциональных обязанностей для хранения форматированных текстовых сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32350682"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a>Поддержка форматированного текста: обязанности хранилища сообщений

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Поставщики хранилищ сообщений используют свойство **пр_сторе_суппорт_маск** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)), чтобы опубликовать, могут ли они обрабатывать RTF-текст, HTML-текст и, если они имеют формат RTF, хранятся ли форматированные тексты в сжатый или несжатый формат. Поставщики хранилищ сообщений указывают, что они поддерживают RTF, устанавливая бит СТОРЕ_РТФ_ОК и хранят форматированный текст в несжатом виде, устанавливая бит СТОРЕ_УНКОМПРЕССЕД_РТФ. Поставщики хранилищ сообщений указывают, что они поддерживают HTML, устанавливая бит СТОРЕ_ХТМЛ_ОК.
  
Несмотря на то, что для клиента, поддерживающего RTF, необходимо проверить, поддерживает ли хранилище сообщений СТОРЕ_РТФ_ОК, не нужно, чтобы клиент задумывать формат форматированного текста в формате RTF. 
  
Все хранилища сообщений должны поддерживать клиентов, не поддерживающих RTF. В хранилище сообщений, не поддерживающем RTF, необходимо удалить свойство **пр_ртф_ин_синк** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) во время вызова метода [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) , если клиент изменил **пр_боди** ([PidTagBody](pidtagbody-canonical-property.md)) без Обновление **пр_ртф_ин_синк** или **пр_ртф_компрессед** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)). При удалении **пр_ртф_ин_синк** свойство **пр_ртф_компрессед** будет пересчитано из свойства **пр_боди** при следующем вызове клиентом, поддерживающего RTF, [ртфсинк](rtfsync.md). 
  
Большинству хранилищ сообщений, поддерживающих RTF, не назначается текст сообщения клиентами; Он должен вычисляться по запросу. Так как это вычисление занимает много времени и требует затрат, клиенты должны использовать **пр_ртф_компрессед** везде, где это возможно. Чтобы вычислить свойство **пр_боди** , поставщик хранилища сообщений должен распаковать содержимое свойства **пр_ртф_компрессед** и удалить форматированный текст. Клиенты, не поддерживающие свойство **пр_ртф_компрессед** , должны выполнять это вычисление для каждого сообщения. 
  
При копировании сообщений, поставщики хранилищ сообщений, которые не используют метод **имаписуппорт::D окопипропс** или **Имаписуппорт::D окопито** , выполняют риск создания сообщения без содержимого, если их реализация исключает **пр_боди** и полагается на **пр_ртф_компрессед**. Данные в свойстве **пр_ртф_компрессед** могут быть повреждены. Прежде чем исключить одно из этих свойств содержимого сообщения в операции копирования, проверьте наличие повреждений следующим образом: 
  
1. Если значение **пр_ртф_компрессед** не ПРЕВЫШАЕТ сжатый формат RTF, свойство повреждено. 
    
2. Если магическое значение в заголовке RTF не является _двмагиккомпресседртф_ или _двмагикункомпресседртф_, свойство повреждено.
    
Поставщики хранилища сообщений, использующие методы поддержки, не должны быть связаны с реализацией проверки на наличие повреждений **пр_ртф_компрессед** ; MAPI гарантирует, что соответствующие свойства существуют и действительны. 
  
Существует три разных уровня поддержки формата RTF, которые могут реализовывать поставщики хранилищ сообщений. MAPI рекомендует поставщикам хранилищ сообщений, поддерживающим RTF, реализовать их поддержку на среднем или высшем уровне. Все поставщики хранилищ сообщений, поддерживающих RTF, выполняют создание **пр_боди** из данных, включенных в **пр_ртф_компрессед** , в исходящих сообщениях и выполняют вызов **ртфсинк** для синхронизации текста и форматирования в входящих сообщениях. 
  
Различия между этими тремя уровнями описаны в следующей таблице. 
  
|**Уровень поддержки**|**Описание**|
|:-----|:-----|
|Низкий  <br/> |Поставщик хранилища сообщений вызывает **ртфсинк** при каждом сохранении изменений в сообщении и извлечения данных для свойства **пр_боди** из **пр_ртф_компрессед** , не требуя от клиентов задавать его. Хранятся как **пр_боди** , так и **пр_ртф_компрессед** .  <br/> |
|Назван  <br/> |Поставщик хранилища сообщений хранит только свойство **пр_ртф_компрессед** , вычисляя **пр_боди** при необходимости.  <br/> |
|Высокая  <br/> |Поставщик хранилища сообщений хранит ни **пр_боди** , ни вспомогательные свойства RTF. **Ртфсинк** вызывается, когда текст сообщения изменяется, а форматирование остается без изменений или при загрузке нового сообщения поставщиком транспорта.  <br/> |
   

