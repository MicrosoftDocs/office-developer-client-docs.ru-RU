---
title: Поддержка обязанности форматированный текст хранилища сообщений
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: d5f4be5a8593cfc483dfed1cffbb59f596e2e408
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22567652"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a>Поддержка форматированного текста: обязанности хранилища сообщений

  
  
**Применимо к**: Outlook 2013 | Outlook 2016 
  
Поставщики хранилища сообщений используйте свойство **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) для публикации ли они могут обрабатывать форматированный текст (RTF), HTML-текст, и, если они поддерживают RTF, ли они хранения форматированный текст в Формат сжатых или несжатых. Поставщики хранилища сообщений указывают, что они поддерживают RTF, установив бит STORE_RTF_OK, а их хранить форматированный текст в несжатую формы путем установки бита STORE_UNCOMPRESSED_RTF. Поставщики хранилища сообщений показывают, что они поддерживают HTML, установив бит STORE_HTML_OK.
  
Несмотря на то важные для принять во внимание RTF клиента на наличие STORE_RTF_OK, бит, чтобы определить, поддерживает ли хранилища сообщений RTF, не требуется для клиента заниматься формат RTF поддержкой хранилища форматированный текст. 
  
Все хранилища сообщений должен поддерживать поддерживающими RTF клиентов. Хранилище поддерживающими RTF сообщений необходимо удалить свойство **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) во время вызова метода [IMAPIProp::SaveChanges](imapiprop-savechanges.md) сообщение, если это клиент был изменен **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) без обновление **PR_RTF_IN_SYNC** или **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)). Удаление **PR_RTF_IN_SYNC** вызывает свойство **PR_RTF_COMPRESSED** пересчитывать из свойства **PR_BODY** в следующий раз, поддерживающую RTF клиент вызывает [RTFSync](rtfsync.md). 
  
Большинство принять во внимание RTF хранилищ сообщений не присваивается текста сообщения для клиентов; выполняется по запросу. Так как это вычисление много времени и затрат, клиенты должны использовать **PR_RTF_COMPRESSED** , когда это возможно. Для вычисления свойство **PR_BODY** поставщика хранилища сообщений распакуйте содержимое свойства **PR_RTF_COMPRESSED** и удалить форматирование текста. Клиенты, которые не поддерживают свойство **PR_RTF_COMPRESSED** требуется вычисления для каждого сообщения. 
  
Копирование сообщений, сообщение хранить поставщиков, которые следует использовать методы **IMAPISupport::DoCopyProps** или **IMAPISupport::DoCopyTo** риск создавать сообщения без содержимого, если их реализации исключает **PR_BODY** свойство и основывается на **PR_RTF_COMPRESSED**. Существует возможность для данных в свойстве **PR_RTF_COMPRESSED** поврежден. Прежде чем отключать любой из этих свойств в операцию копирования содержимого сообщения, проверьте наличие повреждений следующим образом: 
  
1. Если значение **PR_RTF_COMPRESSED** не больше, чем сжатый формат RTF, свойство поврежден. 
    
2. Если магическое значение в заголовке RTF не _dwMagicCompressedRTF_ или _dwMagicUncompressedRTF_, свойство поврежден.
    
Сообщение хранения поставщиков, с помощью поддержки необходимые методы не заниматься реализация наличие ошибок **PR_RTF_COMPRESSED** ; MAPI гарантирует, что соответствующие свойства существуют и являются допустимыми. 
  
Существует три разных уровня поддержки RTF, который можно реализовать поставщиков хранилища сообщений; MAPI рекомендации по реализации, что принять во внимание RTF поставщиков хранилища сообщений их поддержка на средней или высший уровень. Все принять во внимание RTF хранилища сообщений поставщиков взяла на себя создание **PR_BODY** на основе данных, включенных в **PR_RTF_COMPRESSED** на исходящие сообщения и позвоните **RTFSync** для синхронизации текста и форматирования для входящих сообщений. 
  
В следующей таблице описаны различия между этих трех уровней. 
  
|**Уровень поддержки**|**Описание**|
|:-----|:-----|
|Low  <br/> |Сообщение хранения звонки поставщика **RTFSync** каждый раз, когда изменения будут сохранены на сообщение и извлекает данные для свойства **PR_BODY** из **PR_RTF_COMPRESSED** , а не требующих клиентов будет задать. Хранятся **PR_BODY** и **PR_RTF_COMPRESSED** .  <br/> |
|Промежуточное  <br/> |Сообщение хранилища поставщика хранилища только **PR_RTF_COMPRESSED** свойство, вычислений **PR_BODY** при необходимости.  <br/> |
|High  <br/> |Сообщение хранилища поставщика хранилища, ни **PR_BODY** или дополнительные свойства формат RTF. **RTFSync** вызывается, когда был изменен текст сообщения и форматирование не изменяется или при загрузке нового сообщения с помощью поставщика транспорта.  <br/> |
   

