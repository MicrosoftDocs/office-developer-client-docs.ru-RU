---
title: Поддержка обязанностей в хранилище текстовых сообщений в формате
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435518"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a>Поддержка форматированный текст: обязанности хранения сообщений

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Поставщики хранилищ **сообщений** используют свойство PR_STORE_SUPPORT_MASK ([PidTagStoreSupportMask)](pidtagstoresupportmask-canonical-property.md)для публикации того, могут ли они обрабатывать формат RTF, HTML-текст и, если они RTF- и сохраняют форматированный текст в сжатом или несжатом формате. Поставщики rtF указывают, что они RTF-данные, задав бит STORE_RTF_OK и храня форматированный текст в несмещенной форме, задав STORE_UNCOMPRESSED_RTF бит. Поставщики параметров хранения сообщений указывают, что они в HTML-коде, STORE_HTML_OK бит.
  
Хотя клиенту с поддержкой RTF важно проверить бит STORE_RTF_OK, чтобы определить, поддерживает ли хранилище сообщений формат RTF, клиенту не нужно беспокоиться о формате формата формата RTF-текста в хранилище. 
  
Все хранилища сообщений должны поддерживать клиенты, не поддерживают RTF. Хранилище сообщений без RTF должно удалить свойство **PR_RTF_IN_SYNC** [(PidTagRtfInSync)](pidtagrtfinsync-canonical-property.md)во время вызова метода [IMAPIProp::SaveChanges](imapiprop-savechanges.md) сообщения, если клиент изменил **PR_BODY** ([PidTagBody)](pidtagbody-canonical-property.md)без обновления **PR_RTF_IN_SYNC** или **PR_RTF_COMPRESSED** ([PidTagRtfCompressed).](pidtagrtfcompressed-canonical-property.md) При **удалении PR_RTF_IN_SYNC** свойство **PR_RTF_COMPRESSED** из свойства PR_BODY при  следующем вызове [RTFSync](rtfsync.md)клиентом с RTF. 
  
В большинстве хранилищ сообщений, учитывая RTF, клиенты не выдают текст сообщения; его необходимо вычислить по запросу. Поскольку эти вычисления отнимает много времени и дорого обходится, клиенты **должны PR_RTF_COMPRESSED** по возможности. Чтобы вычислить **PR_BODY,** поставщик содержимого PR_RTF_COMPRESSED и удалить форматирование форматирования.  Клиенты, которые не **поддерживают** PR_RTF_COMPRESSED, требуют, чтобы эти вычисления велись для каждого сообщения. 
  
При копировании сообщений поставщики содержимого, которые не используют методы **IMAPISupport::D oCopyProps** или **IMAPISupport::D oCopyTo,** создают сообщение без содержимого, если их реализация исключает свойство **PR_BODY** и использует **PR_RTF_COMPRESSED**. Данные в свойстве PR_RTF_COMPRESSED **могут** быть повреждены. Перед исключением любого из этих свойств содержимого сообщения в операции копирования проверьте на повреждения следующим образом: 
  
1. Если значение  PR_RTF_COMPRESSED не превышает сжатого RTF, свойство повреждено. 
    
2. Если чудо-значение в загоне RTF не  _dwMagicCompressedRTF_ или  _dwMagicUncompressedRTF,_ свойство повреждено.
    
Поставщики store сообщений, использующие методы поддержки, не должны беспокоиться о реализации проверки на PR_RTF_COMPRESSED **повреждения;** MAPI гарантирует, что соответствующие свойства существуют и являются действительными. 
  
Существует три разных уровня поддержки RTF, которые могут реализовать поставщики rtF; MAPI рекомендует поставщикам RTF-хранения сообщений реализовать поддержку на среднем или высоком уровне. Все поставщики RTF-хранения сообщений принимают  на себя создание PR_BODY из данных, включенных в **PR_RTF_COMPRESSED,** исходящей почты и вызов **RTFSync** для синхронизации текста и форматирования входящих сообщений. 
  
Различия между этими тремя уровнями описаны в следующей таблице. 
  
|**Уровень поддержки**|**Описание**|
|:-----|:-----|
|Низкие  <br/> |Поставщик **RTFSync вызывает RTFSync** каждый раз,  когда изменения сохраняются  в сообщении, и извлекает данные свойства PR_BODY из PR_RTF_COMPRESSED, а не требует от клиентов их устанавливать. И **PR_BODY,** **и PR_RTF_COMPRESSED** хранятся.  <br/> |
|Средняя  <br/> |Поставщик хранилища сообщений сохраняет только **PR_RTF_COMPRESSED,** **вычисляя** PR_BODY при необходимости.  <br/> |
|Высокие  <br/> |Поставщик хранилища сообщений не **PR_BODY** и вспомогательные свойства RTF. **RTFSync** вызван, когда текст сообщения изменился и форматирование остается неизменным или когда поставщик транспорта скачивает новое сообщение.  <br/> |
   

