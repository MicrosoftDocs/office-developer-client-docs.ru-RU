---
title: Создание вложения к сообщению
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 711b6765-7763-41ae-9ff8-61ca6ddd459d
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 2bdba3574c962c825f45cd098efa1cba6e21a4ea
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32332944"
---
# <a name="creating-a-message-attachment"></a>Создание вложения к сообщению
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Вложение сообщения — это некоторые дополнительные данные, например файл, другое сообщение или объект OLE, которые можно отправлять и сохранять вместе с сообщением. Каждое вложение имеет коллекцию свойств, определяющих его и описывающую его тип и способ отображения. Как и получатели, доступ к вложениям сообщений возможен только через сообщение, к которому они относятся. Таким образом, чтобы вложение можно было использовать, его сообщение должно быть открыто.
  
## <a name="create-a-message-attachment"></a>Создание вложения сообщения
  
1. ВыЗовите метод сообщения [iMessage:: креатеаттач](imessage-createattach.md) и передайте значение NULL в качестве идентификатора интерфейса. **Креатеаттач** возвращает число, которое уникально идентифицирует новое вложение в сообщении. Номер вложения хранится в свойстве **пр_аттач_нум** ([PidTagAttachNumber](pidtagattachnumber-canonical-property.md)) и действителен только до тех пор, пока не будет открыто сообщение, содержащее вложение.
    
2. Call [IMAPIProp:: SetProps](imapiprop-setprops.md) to set **пр_аттач_месод** ([PidTagAttachMethod](pidtagattachmethod-canonical-property.md)), чтобы указать, как получить доступ к вложению. **Пр_аттач_месод** является обязательным. Задайте для него значение: 
    
   - АТТАЧ_БИ_ВАЛУЕ, если вложение является двоичными данными.
    
   - АТТАЧ_БИ_РЕФЕРЕНЦЕ, АТТАЧ_БИ_РЕФ_РЕСОЛВЕ или АТТАЧ_БИ_РЕФ_ОНЛИ, если вложение является файлом.
    
   - АТТАЧ_ЕМБЕДДЕД_МСГ, если вложение является сообщением.
    
   - АТТАЧ_ОЛЕ, если вложение является объектом OLE.
    
3. Задайте соответствующее свойство данных вложения:
    
   - **Пр_аттач_дата_бин** ([PidTagAttachDataBinary](pidtagattachdatabinary-canonical-property.md)) для двоичных данных и объектов OLE 1.
    
   - **Пр_аттач_паснаме** ([PidTagAttachPathname](pidtagattachpathname-canonical-property.md)) для файлов.
    
   - **Пр_аттач_дата_обж** ([PidTagAttachDataObject](pidtagattachdataobject-canonical-property.md)) для сообщений и объектов OLE 2.
    
4. Задайте **пр_аттач_рендеринг** ([PidTagAttachRendering](pidtagattachrendering-canonical-property.md)), чтобы сохранить графическое представление вложения для файла или двоичных вложений. Не задавайте его для объектов OLE, которые хранят данные отображения для внутреннего использования или для вложенных сообщений. 
    
5. Set **пр_рендеринг_поситион** ([PidTagRenderingPosition](pidtagrenderingposition-canonical-property.md)), чтобы указать, где должно отображаться вложение. **Пр_рендеринг_поситион** применяется только к клиентам, которые задают свойство **пр_боди** . Если поддерживается только **пр_ртф_компрессед**, поместите в сжатый поток следующие сведения о заполнителе:
    
   `\objattph`

   Чтобы задать **пр_рендеринг_поситион**, назначьте число, представляющее порядковое смещение в символах, с первым символом **пр_боди** 0, если вам нужно знать, где в сообщении отображается вложение, или 0xFFFFFFFF, если не Отображение вложений в **пр_боди**.
    
6. Set **пр_аттач_филенаме** ([PidTagAttachFilename](pidtagattachfilename-canonical-property.md)), указывающий краткое имя файла для вложенного файла и значение **PR\_аттач_лонг_филенаме** ([PidTagAttachLongFilename](pidtagattachlongfilename-canonical-property.md)), чтобы указать, что имя файла поддерживается на платформе, которая обрабатывает формат длинного имени файла. Оба свойства являются необязательными. Тем не менее, если вы настроили **пр_аттач_лонг_филенаме**, также задайте **пр_аттач_филенаме**. 
    
7. Set **пр_дисплай_наме** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)), чтобы указать имя вложения, которое может отображаться в диалоговом окне. ПР_ДИСПЛАЙ_НАМЕ является необязательным. 
    
## <a name="set-prattachdatabin"></a>Set ПР_АТТАЧ_ДАТА_БИН
  
1. Call [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) , чтобы открыть свойство с помощью интерфейса **IStream** . 
    
2. Если файл содержит данные, который открыт, или если требуется явный контроль над размером буфера, вызовите **IStream:: Write** в цикле, чтобы поместить данные в поток. 
    
3. Кроме того, можно вызвать **опенстреамонфиле** , чтобы создать поток для доступа к файлу данных, а затем вызвать метод **IStream:: CopyTo** для копирования данных в поток, возвращенный методом **опенпроперти**.
    
4. ВыЗовите метод **IStream:: Commit** нового потока. 
    
## <a name="set-prattachdataobj"></a>Set ПР_АТТАЧ_ДАТА_ОБЖ
  
1. Call **IMAPIProp:: опенпроперти** , чтобы открыть свойство с помощью интерфейса **помощью istreamdocfile** , чтобы создать поток, работающий с структурированным хранилищем. **Помощью istreamdocfile** реализуется поставщиками хранилищ сообщений для предоставления клиентам более производительного способа хранения и извлечения структурированного хранилища. Интерфейс **помощью istreamdocfile** аналогичен интерфейсу **IStream**, но содержимое потока гарантированно форматируется как структурированное хранилище. При успешном выполнении этого вызова создайте поток с теми же действиями, что и для параметра **пр_аттач_дата_бин**.
    
2. Если **опенпроперти** не удастся: 
    
   1. Снова выЗовите **опенпроперти** для запроса **IStorage**. 
      
   2. ВыЗовите **стгопенстораже** , чтобы открыть объект OLE и возвратить объект Storage. 
      
   3. ВыЗовите возвращенный объект **IStorage:: CopyTo** для копирования в объект хранилища, возвращенный из **опенпроперти**.
      
   4. ВыЗовите метод **IStorage: Commit нового объекта Storage:: Commit** . 
    
## <a name="set-prattachpathname"></a>Set ПР_АТТАЧ_ПАСНАМЕ
  
1. Выделите структуру [спропвалуе](spropvalue.md) , задав для члена **улпроптаг** значение **ПР_АТТАЧ_ПАСНАМЕ** и элемент **value. лпсз** , в строку символов, представляющую имя файла. 
    
2. ВыЗовите метод вложения [IMAPIProp:: SetProps](imapiprop-setprops.md) . 
    
> [!NOTE]
> Если ваша платформа поддерживает длинные имена файлов, задайте оба параметра: **пр_аттач_паснаме** и **пр_аттач_лонг_паснаме**. Может потребоваться вызов операционной системы для получения короткого имени файла. 
  
## <a name="see-also"></a>См. также

- [Вложения MAPI](mapi-attachments.md)

