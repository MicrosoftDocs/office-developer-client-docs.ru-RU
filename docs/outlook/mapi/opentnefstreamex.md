---
title: OpenTnefStreamEx
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPI.OpenTnefStreamEx
api_type:
- COM
ms.assetid: eb84c408-2d8b-453b-92f4-5fd8851b84ca
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 178ab67875d8fb442500dd412dbafe4403deee16
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32348575"
---
# <a name="opentnefstreamex"></a>OpenTnefStreamEx

**Область применения**: Outlook 2013 | Outlook 2016 
  
Создает объект формата TNEF, который можно использовать для кодирования или декодирования объекта сообщения в поток данных TNEF для использования транспортами или шлюзами и хранилищами сообщений. Это точка входа для доступа к TNEF. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |TNEF. h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Поставщики транспорта  <br/> |
   
```cpp
HRESULT OpenTnefStreamEx(
  LPVOID lpvSupport,
  LPSTREAM lpStream,
  LPSTR lpszStreamName,
  ULONG ulFlags,
  LPMESSAGE lpMessage,
  WORD wKeyVal,
  LPADDRESSBOOK lpAddressBook,
  LPITNEF FAR * lppTNEF
);
```

## <a name="parameters"></a>Параметры

_Лпвсуппорт_
  
> возврата Передает объект поддержки или передает значение NULL. Если значение равно NULL, параметр _лпаддрессбук_ должен иметь значение, отличное от NULL. 
    
_Лпстреам_
  
> возврата Указатель на объект потока хранилища, например интерфейс OLE **IStream** , предоставляющий источник или назначение для сообщения в формате TNEF. 
    
_Лпсзстреамнаме_
  
> возврата Указатель на имя потока данных, который использует объект TNEF. Если вызывающий абонент установил флаг ТНЕФ_ЕНКОДЕ (параметр _ulFlags_ ) в вызове **Опентнефстреам**, параметр _лпсзнаме_ должен указывать ненулевой указатель на строку со значением NULL, состоящую из символов, которые считаются допустимыми для имени файла. MAPI не поддерживает имена строк, включая символы "[", "]" или ":", даже если файловая система разрешает их использование. Размер строки, переданной для параметра _лпсзнаме_ , не должен превышать значение MAX_PATH, максимально допустимую длину строки, которая содержит имя пути. 
    
_ulFlags_
  
> возврата Битовая маска флагов, используемых для указания режима функции. Можно задать следующие флаги:
    
ТНЕФ_БЕСТ_ДАТА 
  
> Все возможные свойства сопоставляются с атрибутами нижнего уровня, но при наличии возможной потери данных из-за преобразования в атрибут нижнего уровня свойство также кодируется в инкапсуляции. Обратите внимание, что это приведет к дублированию данных в потоке TNEF. ТНЕФ_БЕСТ_ДАТА является значением по умолчанию, если не указаны другие режимы. 
    
ТНЕФ_КОМПАТИБИЛИТИ 
  
> Обеспечивает обратную совместимость с устаревшими клиентскими приложениями. Потоки TNEF, закодированные с помощью этого флага, будут сопоставлять все возможные свойства с соответствующим атрибутом нижнего уровня. В этом режиме также используются параметры по умолчанию для некоторых свойств, которые необходимы клиентам нижнего уровня. 
    
  > [!CAUTION]
  > Этот флаг устарел и не должен использоваться. 
  
ТНЕФ_ДЕКОДЕ 
  
> Объект TNEF в указанном потоке открыт с доступом только для чтения. Поставщик транспорта должен установить этот флаг, если функция инициализирует объект для последующего декодирования.
    
ТНЕФ_ЕНКОДЕ 
  
> Объект TNEF в указанном потоке открыт для разрешения на чтение и запись. Поставщик транспорта должен установить этот флаг, если функция инициализирует объект для последующей кодировки.
    
ТНЕФ_ПУРЕ 
  
> Кодирует все свойства в блоки инкапсуляции MAPI. Таким образом, "чистый" файл TNEF будет содержать только атрибуты Аттмапипропс, Аттаттачмент, Аттренддата и АттреЦиптабле. Этот режим идеально подходит для использования, если обратная совместимость не нужна.
    
_Лпмессаже_
  
> возврата Указатель на объект Message в качестве назначения раскодированного сообщения с вложениями или источником для закодированного сообщения с вложениями. Любые свойства конечного сообщения могут быть перезаписаны свойствами закодированного сообщения.
    
_Вкэйвал_
  
> возврата Ключ поиска, который объект TNEF использует для согласования вложений с тегами Text, вставленными в текст сообщения. Это значение должно быть относительно уникальным в сообщениях. 
    
_Лпаддрессбук_
  
> возврата Указатель на объект адресной книги, используемый для получения сведений об адресах для идентификаторов записей. 
    
_Лпптнеф_
  
> вышли Указатель на новый объект TNEF.
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> ����� ������� � ������ ��������� ��������� ��� ��������.
    
## <a name="remarks"></a>Примечания

Функция **опентнефстреамекс** является рекомендуемой заменой для [опентнефстреам](opentnefstream.md), исходной точки входа для доступа к TNEF. 
  
Объект TNEF, созданный функцией **опентнефстреамекс** , вызывает метод OLE **IUnknown:: AddRef** , чтобы добавить ссылки для объекта support, объекта Stream и объекта Message. Поставщик транспорта может освободить ссылки для всех трех объектов с одним вызовом метода OLE Method **IUnknown:: Release** для объекта TNEF. 
  
**Опентнефстреамекс** выделяет и инициализирует объект TNEF для поставщика, который будет использоваться для кодирования сообщения MAPI в поток сообщений формата TNEF. Кроме того, эта функция может настроить объект для поставщика, который будет использоваться при последующих вызовах метода [итнеф:: екстрактпропс](itnef-extractprops.md) для декодирования сообщения потока TNEF в сообщение MAPI. Чтобы освободить объект TNEF и закрыть сеанс, поставщик транспорта должен вызвать наследуемый метод **IUnknown:: Release** для объекта. 
  
Базовое значение для параметра _вкэйвал_ не должно быть нулевым и не должно быть одинаковым для каждого вызова **опентнефстреамекс**. Вместо этого используйте случайные числа на основе системного времени генератора случайных чисел библиотеки времени выполнения.
  
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Файл. cpp  <br/> |Лоадфромтнеф  <br/> |MFCMAPI использует метод **опентнефстреамекс** , чтобы открыть поток в файле TNEF, чтобы можно было извлечь свойства.  <br/> |
   
## <a name="see-also"></a>См. также

- [IMAPISupport: IUnknown](imapisupportiunknown.md)
- [IXPProvider::TransportLogon](ixpprovider-transportlogon.md)
- [Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

