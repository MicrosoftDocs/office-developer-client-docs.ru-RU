---
title: Работа в качестве внешнего поставщика адресной книги
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 300681bd585e9d534113404a82f43565f4e79bb4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435742"
---
# <a name="acting-as-a-foreign-address-book-provider"></a>Работа в качестве внешнего поставщика адресной книги

**Относится к**: Outlook 2013 | Outlook 2016 
  
Внешние поставщики — это поставщик адресной книги, который: 
  
- Назначает идентификаторы шаблонов получателям.
    
- Поддерживает метод [IABLogon::OpenTemplateID.](iablogon-opentemplateid.md) 
    
- Код для обслуживания получателей, которые существуют в контейнерах других поставщиков адресных книг, известных как поставщики услуг. Этот код включает объект свойства, как правило, реализацию интерфейса **IMAPIProp,** которая включает объект свойства от поставщика услуг. 
    
Выступая в качестве внешнего поставщика, это необязательная роль; Не все поставщики должны поддерживать идентификаторы шаблонов и соответствующий код. Реализуйте поставщика как внешнего поставщика, если вы хотите сохранить контроль над получателями, которые создают поставщики услуг, используя шаблоны, предоставленные поставщиком. 
  
Формат, используемый поставщиком для идентификаторов записей, также можно использовать для идентификаторов шаблонов. Идентификаторы шаблонов должны включать зарегистрированный **MAPIUID** поставщика, чтобы mapI успешно привязыл получателей к соответствующим поставщикам. 
  
MAPI вызывает метод **IABLogon::OpenTemplateID** поставщика, когда поставщик услуг услуг хоста вызывает [IMAPISupport::OpenTemplateID.](imapisupport-opentemplateid.md) Поставщик услуг host передает идентификатор шаблона получателя в _параметре lpTemplateID_ в вызове **IMAPISupport::OpenTemplateID.** MAPI определяет, что идентификатор шаблона принадлежит поставщику, путем совпадения [MAPIUID](mapiuid.md) в идентификаторе шаблона с **MAPIUID,** зарегистрированным поставщиком во время регистрации. Затем MAPI перенаадает вызов поставщика услуг хоста поставщику через метод **IABLogon::OpenTemplateID.** 
  
Поставщик ведущего приложения также передает указатель на реализацию объекта свойства получателя в параметре  _lpMAPIPropData,_ идентификатор интерфейса в параметре  _lpInterface,_ соответствующий типу реализации интерфейса, переданного  _в lpMAPIPropData,_ и необязательный флаг FILL_ENTRY. Ожидается, что поставщик вернет в _параметре lppMAPIPropNew_ указатель на реализацию объекта свойства типа, указанного в _lpInterface._ Возвращаемая указатель может быть либо объектом-оболочкой свойства, реализованным поставщиком, либо объектом, предоставленным поставщиком услуг хоста в _lpMAPIPropData._ Поставщик должен возвращать указатель объекта-оболочки свойства, когда:
  
- Таблица отображения получателя содержит элементы управления списком.
    
- Адрес электронной почты получателя должен быть собран из данных в нескольких отображаемой таблице элементов управления.
    
- Проблемы поставщика отображают уведомления о таблице.
    
Флаг FILL_ENTRY указывает поставщику, что поставщик услуг размещения требует обновления всех свойств получателя. Ваш поставщик должен выполнить этот запрос.
  
Когда поставщик услуг хоста вызывает метод **OpenTemplateID** поставщика, он может: 
  
- Периодически обновляйте данные для скопированной записи.
    
- Синхронизировать скопированную запись с ее исходным экземпляром, например при копировании записи адресной книги в личную адресную книгу.
    
- Реализуют функции, которые не могут быть реализованы поставщиком услуг хоста, например динамическое заполнение полей списков в таблице сведений скопированной записи из данных на сервере.
    
- Управление взаимодействием между свойствами в скопированном или экземпляре шаблона. Например, вычисление **PR_EMAIL_ADDRESS** из других свойств, отображающихся в таблице сведений. 
    
Первые два пункта — это примеры задач, которые не требуют от поставщика предоставить объект свойства-оболочку — реализацию **IMAPIProp,** основанную на реализации поставщика услуг. Поставщик может просто обновить свойства по мере необходимости и вернуть их, задав для параметра _lppMAPIPropNew_ указатель, переданный поставщиком услуг размещения в _параметре lpMAPIPropData._ 
  
Во второй двух задачах поставщик должен вернуть поставщику услугу доступа к объекту свойства, который обтекает объект поставщика услуг хоста дополнительными функциями, такими как возможность отображения таблицы свойств для записи. Этот объект свойства будет либо пользователем системы обмена сообщениями, либо списком рассылки в зависимости от типа объекта, переданного поставщиком услуг хоста в _параметре lpMAPIPropData_ и определяемого идентификатором интерфейса в параметре _lpInterface._ Если параметр _lpMAPIPropData_ указывает на пользователя обмена сообщениями, объектом свойства-оболочки поставщика должна быть **реализация IMailUser.** Если _lpMAPIPropData_ указывает на список рассылки, это должна быть реализация **IDistList.** 
  
Объект свойства-оболочки поставщика перехватывает вызовы метода **IMAPIProp** для выполнения обработки получателя поставщика услуг услуг хоста с учетом контекста — объекта, который он обтекает. MAPI предъявляет только одно требование к объектам-оболочкам свойств: все вызовы свойства [IMAPIProp::OpenProperty,](imapiprop-openproperty.md) запрашивающие свойство **PR_DETAILS_TABLE** ([PidTagDetailsTable),](pidtagdetailstable-canonical-property.md)должны передаваться поставщику услуг. Реализация поставщика может использовать возвращенную таблицу для перехвата уведомлений таблицы отображения или добавления собственных уведомлений при необходимости. 
  
Следующий список включает задачи, которые обычно реализуются в объекте свойства-оболочке, реализуемом внешними поставщиками:
  
- Значения свойств предварительной и postprocessing для получателя хоста [в IMAPIProp::GetProps](imapiprop-getprops.md).
    
- Обработка элементов управления таблицей отображения сведений, таких как кнопки и списки, **в IMAPIProp::OpenProperty**.
    
- Проверка значений свойств получателя хоста в [IMAPIProp::SetProps](imapiprop-setprops.md)или управление ими.
    
- Вычисление необходимых свойств, таких как **PR_EMAIL_ADDRESS,** и проверка того, что все необходимые свойства настроены перед сохранением получателя хоста в [IMAPIProp::SaveChanges.](imapiprop-savechanges.md)
    
### <a name="to-implement-iablogonopentemplateid"></a>Реализация IABLogon::OpenTemplateID
  
1. Проверьте, является ли идентификатор шаблона, переданный с помощью  _параметра lpTemplateID_ допустимым и форматом, который распознает поставщик. Если это не так, сбой и возврат MAPI_E_INVALID_ENTRYID. 
    
2. Создайте объект типа, указанный идентификатором шаблона, пользователем сообщений, списком рассылки или одноразовимным получателем. 
    
3. Вызовите метод **IUnknown::AddRef** в объекте свойства поставщика услуг хоста, который является объектом, на который указывает параметр _lpMAPIPropData._ 
    
4. Если для  _параметра ulTemplateFlags_ установлено FILL_ENTRY: 
    
   1. Если новый объект является пользователем системы обмена сообщениями или списком рассылки:
      
      1. Получите все свойства нового объекта, возможно, путем вызова метода **IMAPIProp::GetProps.** 
          
      2. Вызовите метод **IMAPIProp::SetProps** поставщика услуг размещения, чтобы скопировать все полученные свойства в объект свойства поставщика услуг размещения. 
      
   2. Если новый объект является одноразовым получателем, вызовите метод **IMAPIProp::SetProps** поставщика услуг размещения, чтобы установить следующие свойства: 
      
      - **PR_ADDRTYPE** ([PidTagAddressType)](pidtagaddresstype-canonical-property.md)для типа адреса, обрабатываемого поставщиком.
        
      - **PR \_ TEMPLATEID** [(PidTagTemplateid)](pidtagtemplateid-canonical-property.md)в идентификатор шаблона из _параметров lpTemplateID_ и _cbTemplateID._ 
        
      - **PR_DISPLAY_TYPE** [(PidTagDisplayType)](pidtagdisplaytype-canonical-property.md)для DT_MAILUSER или DT_DISTLIST, если это необходимо.
    
5. Задайте содержимое параметра  _lppMAPIPropNew_ так, чтобы оно определяло новый объект поставщика или объект свойства, переданный с помощью параметра  _lpMAPIPropData,_ в зависимости от того, определяет ли поставщик необходимость в объекте-оболочке. 
    
6. В случае критической ошибки, например сбоя сети или отказа памяти, возвращается соответствующее значение ошибки. Это значение должно распространяться на клиент с соответствующей структурой [MAPIERROR,](mapierror.md) задачей, выполняемой поставщиком услуг хоста. 
    

