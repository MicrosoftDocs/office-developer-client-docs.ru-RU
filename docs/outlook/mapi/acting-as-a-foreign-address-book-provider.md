---
title: Будет действовать как поставщик внешнего адресной книги
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 16c3518ab4efddbd68765d9de94db64b4fdc0b64
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19807998"
---
# <a name="acting-as-a-foreign-address-book-provider"></a>Будет действовать как поставщик внешнего адресной книги

**Относится к**: Outlook 
  
Внешний поставщик — поставщика адресных книг, который: 
  
- Устанавливает шаблон идентификаторы для его получателей.
    
- Поддерживает метод [IABLogon::OpenTemplateID](iablogon-opentemplateid.md) . 
    
- Предоставляет код по обслуживанию получателей, существующих в контейнерах другими поставщиками адресных книг, известных как поставщики узла. Этот код состоит из свойства объекта, обычно **IMAPIProp** реализация интерфейса, который имеет объект свойств от поставщика узла. 
    
Используется в качестве внешнего поставщика является дополнительной ролью; не все поставщики должны поддерживать шаблон идентификаторов и связанных с ними кода. Реализация поставщика в качестве внешнего поставщика, чтобы контролировать получателей, которые поставщики узла создавать с помощью шаблонов, предоставленная поставщиком. 
  
Формат, который использует ваш поставщик для его идентификаторы записей можно использовать также для его идентификаторов шаблонов. Идентификаторы шаблонов необходимо включить зарегистрированных вашего поставщика **MAPIUID** при включении протокола MAPI для успешного привязки получателей для соответствующих поставщиков. 
  
MAPI вызывает метод **IABLogon::OpenTemplateID** ваш поставщик, когда основное приложение вызывает поставщика [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md). Поставщик узла передает идентификатор шаблона получателя с помощью параметра _lpTemplateID_ в своем вызове **IMAPISupport::OpenTemplateID**. MAPI определяет, что идентификатор шаблона принадлежит к поставщику, сопоставляя [MAPIUID](mapiuid.md) в идентификатор шаблона с **MAPIUID** , ваш поставщик зарегистрированных во время входа. MAPI перенаправляет вызов поставщика узла к поставщику через метод **IABLogon::OpenTemplateID** . 
  
Поставщик узла также передается указатель реализация объекта его свойства для получателя с помощью параметра _lpMAPIPropData_ , идентификатор интерфейса с помощью параметра _lpInterface_ , соответствующее типу реализации интерфейса передается в _lpMAPIPropData_и необязательный флаг, FILL_ENTRY. Предполагается, что ваш поставщик вернуться в параметре _lppMAPIPropNew_ указатель на реализацию свойства объекта типа, указанного в _lpInterface_. Возвращенный указатель может быть реализованы поставщиком объект оболочку свойство или объект, предоставленного поставщиком услуг размещения в _lpMAPIPropData_. Поставщик должен возвращать указатель объекта оболочку свойство при:
  
- Таблица отображения получателя содержит список элементов управления.
    
- Адрес электронной почты получателя должен собираются из данных в нескольких элементов управления для отображения таблицы.
    
- Проблемы с вашего поставщика отображение уведомлений в таблице.
    
Флаг FILL_ENTRY указывает к поставщику, что поставщик узла требуется все свойства получателя, который требуется обновить. Для выполнения этого запроса требуется ваш поставщик.
  
Когда этот поставщик вызывает метод **OpenTemplateID** ваш поставщик, ваш поставщик может: 
  
- Периодически обновите данные в скопированной записи.
    
- Будьте скопированной записи синхронизированы с его исходного документа, например, когда запись книга копируется в адресной книге.
    
- Реализация функции, которая не может быть реализован поставщиком узла, такие как динамическое заполнение списка флажки в таблице скопированной запись сведений на основе данных на сервере.
    
- Взаимодействие между свойствами в скопированной записи или экземпляра шаблона элемента управления. Например вычислений **PR_EMAIL_ADDRESS** из других свойства, отображаемые в таблице сведений. 
    
Первые два приведены примеры задач, которые не требуют поставщика, чтобы задать объект оболочку свойство — реализация **IMAPIProp** , основанный на реализации поставщика узла. Ваш поставщик можно просто обновить свойства как необходимые и возврата, установка для параметра _lppMAPIPropNew_ для указания на указатель, переданный поставщиком узла с помощью параметра _lpMAPIPropData_ . 
  
Во-вторых две задачи требуется, что ваш поставщик возврата к поставщику узла свойство объекта, который имеет объект поставщика узла с дополнительными функциональными возможностями, например возможность открыть окно свойств для записи. Этот объект свойство будет либо обмена сообщениями пользователя или список рассылки, в зависимости от типа объекта, переданного поставщиком узла с помощью параметра _lpMAPIPropData_ и указывает идентификатор интерфейса с помощью параметра _lpInterface_ . Если параметр _lpMAPIPropData_ указывает обмена сообщениями пользователя, ваш поставщик оболочку свойство объект должен иметь реализацию **IMailUser** . Если _lpMAPIPropData_ Указывает список рассылки, он должен быть реализацию **IDistList** . 
  
Объект оболочку свойства ваш поставщик перехватывает вызовы методов **IMAPIProp** для выполнения определенного контекста обработки поставщика хост-получателя — объект, его переноса. MAPI имеет только одного требования для объектов с переносами свойства: все вызовы [IMAPIProp::OpenProperty](imapiprop-openproperty.md) разрешения на запрос свойства **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) должны быть переданы в поставщик узла. Реализация ваш поставщик может использовать возвращаемой таблицы для перехвата уведомления о таблице отображения или добавить свой собственный, если это необходимо. 
  
В следующем списке перечислены задачи, которые обычно реализуются в объекте оболочку свойство реализации внешнего поставщиками:
  
- Предварительная обработка и последующая обработка значения свойств для узла-получателя в [IMAPIProp::GetProps](imapiprop-getprops.md).
    
- Сведения обработки отображения элемента управления в таблице, например кнопки и списка, в **IMAPIProp::OpenProperty**.
    
- Проверка и управления данными значения свойств для узла-получателя в [IMAPIProp::SetProps](imapiprop-setprops.md).
    
- Вычислений необходимые свойства, такие как **PR_EMAIL_ADDRESS** и убедившись, что все необходимые свойства были установлены перед сохранением получателя узла в [IMAPIProp::SaveChanges](imapiprop-savechanges.md).
    
### <a name="to-implement-iablogonopentemplateid"></a>Для реализации IABLogon::OpenTemplateID
  
1. Проверьте идентификатор шаблона, передаваемый в с помощью параметра _lpTemplateID_ является допустимым и в формате, который распознает ваш поставщик. Если он не установлен, ошибкой и вернуть MAPI_E_INVALID_ENTRYID. 
    
2. Создайте объект типа, указанный в параметре идентификатор шаблона обмена сообщениями пользователя, список рассылки или одноразовых получателя. 
    
3. Вызовите метод **IUnknown::AddRef** в свойства объекта поставщика узла, которое — это объект, указанный в параметре _lpMAPIPropData_ . 
    
4. Если параметр _ulTemplateFlags_ имеет значение FILL_ENTRY: 
    
   1. Если новый объект обмена сообщениями пользователя или списка рассылки:
      
      1. Извлечение всех свойств новый объект возможно путем вызова метода **IMAPIProp::GetProps** . 
          
      2. Вызов метода **IMAPIProp::SetProps** поставщик узла Копировать все извлеченные свойства объект свойство поставщика узла. 
      
   2. Если новый объект является одноразовых получателя, вызовите метод **IMAPIProp::SetProps** поставщик узла для настройки следующих свойств: 
      
      - **PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) для типа адреса обрабатывается поставщиком.
        
      - **Цена\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) для идентификатора шаблона из параметров _lpTemplateID_ и _cbTemplateID_ . 
        
      - **PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) DT_MAILUSER или DT_DISTLIST ограничено.
    
5. Задайте содержимое параметра _lppMAPIPropNew_ для указания на новый объект ваш поставщик или свойство объекта, переданного с помощью параметра _lpMAPIPropData_ , в зависимости от того, является ли поставщик определяет, что перенесенного объекта не требуется. 
    
6. Если возникает критическая ошибка, например, сбой сети или нехватки памяти, возвращают соответствующего значения ошибки. Это значение необходимо получить распространяются с клиентом, соответствующие структуры [MAPIERROR](mapierror.md) , выполнения задачи для размещения поставщика. 
    

