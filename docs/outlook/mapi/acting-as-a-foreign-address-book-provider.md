---
title: Будет действовать как поставщик внешнего адресной книги
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: '���� ���������� ���������: 23 ���� 2011 �.'
ms.openlocfilehash: 16c3518ab4efddbd68765d9de94db64b4fdc0b64
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "19807998"
---
# <a name="acting-as-a-foreign-address-book-provider"></a><span data-ttu-id="797ff-103">Будет действовать как поставщик внешнего адресной книги</span><span class="sxs-lookup"><span data-stu-id="797ff-103">Acting as a foreign address book provider</span></span>

<span data-ttu-id="797ff-104">**Применимо к**: Outlook</span><span class="sxs-lookup"><span data-stu-id="797ff-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="797ff-105">Внешний поставщик — поставщика адресных книг, который:</span><span class="sxs-lookup"><span data-stu-id="797ff-105">A foreign provider is an address book provider that:</span></span> 
  
- <span data-ttu-id="797ff-106">Устанавливает шаблон идентификаторы для его получателей.</span><span class="sxs-lookup"><span data-stu-id="797ff-106">Assigns template identifiers for its recipients.</span></span>
    
- <span data-ttu-id="797ff-107">Поддерживает метод [IABLogon::OpenTemplateID](iablogon-opentemplateid.md) .</span><span class="sxs-lookup"><span data-stu-id="797ff-107">Supports the [IABLogon::OpenTemplateID](iablogon-opentemplateid.md) method.</span></span> 
    
- <span data-ttu-id="797ff-108">Предоставляет код по обслуживанию получателей, существующих в контейнерах другими поставщиками адресных книг, известных как поставщики узла.</span><span class="sxs-lookup"><span data-stu-id="797ff-108">Supplies code for maintaining recipients that exist in the containers of other address book providers known as host providers.</span></span> <span data-ttu-id="797ff-109">Этот код состоит из свойства объекта, обычно **IMAPIProp** реализация интерфейса, который имеет объект свойств от поставщика узла.</span><span class="sxs-lookup"><span data-stu-id="797ff-109">This code involves a property object, typically an **IMAPIProp** interface implementation, which wraps a property object from the host provider.</span></span> 
    
<span data-ttu-id="797ff-110">Используется в качестве внешнего поставщика является дополнительной ролью; не все поставщики должны поддерживать шаблон идентификаторов и связанных с ними кода.</span><span class="sxs-lookup"><span data-stu-id="797ff-110">Acting as a foreign provider is an optional role; not all providers need to support template identifiers and their related code.</span></span> <span data-ttu-id="797ff-111">Реализация поставщика в качестве внешнего поставщика, чтобы контролировать получателей, которые поставщики узла создавать с помощью шаблонов, предоставленная поставщиком.</span><span class="sxs-lookup"><span data-stu-id="797ff-111">Implement your provider as a foreign provider if you want to maintain control over recipients that host providers create using templates supplied by your provider.</span></span> 
  
<span data-ttu-id="797ff-112">Формат, который использует ваш поставщик для его идентификаторы записей можно использовать также для его идентификаторов шаблонов.</span><span class="sxs-lookup"><span data-stu-id="797ff-112">The format that your provider uses for its entry identifiers can also be used for its template identifiers.</span></span> <span data-ttu-id="797ff-113">Идентификаторы шаблонов необходимо включить зарегистрированных вашего поставщика **MAPIUID** при включении протокола MAPI для успешного привязки получателей для соответствующих поставщиков.</span><span class="sxs-lookup"><span data-stu-id="797ff-113">Template identifiers must include your provider's registered **MAPIUID** to enable MAPI to successfully bind recipients to the appropriate providers.</span></span> 
  
<span data-ttu-id="797ff-114">MAPI вызывает метод **IABLogon::OpenTemplateID** ваш поставщик, когда основное приложение вызывает поставщика [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md).</span><span class="sxs-lookup"><span data-stu-id="797ff-114">MAPI calls your provider's **IABLogon::OpenTemplateID** method when a host provider calls [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md).</span></span> <span data-ttu-id="797ff-115">Поставщик узла передает идентификатор шаблона получателя с помощью параметра _lpTemplateID_ в своем вызове **IMAPISupport::OpenTemplateID**.</span><span class="sxs-lookup"><span data-stu-id="797ff-115">The host provider passes the template identifier of the recipient in the  _lpTemplateID_ parameter in its call to **IMAPISupport::OpenTemplateID**.</span></span> <span data-ttu-id="797ff-116">MAPI определяет, что идентификатор шаблона принадлежит к поставщику, сопоставляя [MAPIUID](mapiuid.md) в идентификатор шаблона с **MAPIUID** , ваш поставщик зарегистрированных во время входа.</span><span class="sxs-lookup"><span data-stu-id="797ff-116">MAPI determines that the template identifier belongs to your provider by matching the [MAPIUID](mapiuid.md) in the template identifier with the **MAPIUID** that your provider registered at logon time.</span></span> <span data-ttu-id="797ff-117">MAPI перенаправляет вызов поставщика узла к поставщику через метод **IABLogon::OpenTemplateID** .</span><span class="sxs-lookup"><span data-stu-id="797ff-117">MAPI then forwards the host provider's call to your provider through the **IABLogon::OpenTemplateID** method.</span></span> 
  
<span data-ttu-id="797ff-118">Поставщик узла также передается указатель реализация объекта его свойства для получателя с помощью параметра _lpMAPIPropData_ , идентификатор интерфейса с помощью параметра _lpInterface_ , соответствующее типу реализации интерфейса передается в _lpMAPIPropData_и необязательный флаг, FILL_ENTRY.</span><span class="sxs-lookup"><span data-stu-id="797ff-118">The host provider also passes a pointer to its property object implementation for the recipient in the  _lpMAPIPropData_ parameter, an interface identifier in the  _lpInterface_ parameter that corresponds to the type of interface implementation passed in  _lpMAPIPropData_, and an optional flag, FILL_ENTRY.</span></span> <span data-ttu-id="797ff-119">Предполагается, что ваш поставщик вернуться в параметре _lppMAPIPropNew_ указатель на реализацию свойства объекта типа, указанного в _lpInterface_.</span><span class="sxs-lookup"><span data-stu-id="797ff-119">Your provider is expected to return in the  _lppMAPIPropNew_ parameter a pointer to a property object implementation of the type specified in  _lpInterface_.</span></span> <span data-ttu-id="797ff-120">Возвращенный указатель может быть реализованы поставщиком объект оболочку свойство или объект, предоставленного поставщиком услуг размещения в _lpMAPIPropData_.</span><span class="sxs-lookup"><span data-stu-id="797ff-120">The returned pointer can either be to the wrapped property object implemented by your provider or to the object supplied by the host provider in  _lpMAPIPropData_.</span></span> <span data-ttu-id="797ff-121">Поставщик должен возвращать указатель объекта оболочку свойство при:</span><span class="sxs-lookup"><span data-stu-id="797ff-121">Your provider should return a wrapped property object pointer when:</span></span>
  
- <span data-ttu-id="797ff-122">Таблица отображения получателя содержит список элементов управления.</span><span class="sxs-lookup"><span data-stu-id="797ff-122">The recipient's display table contains list box controls.</span></span>
    
- <span data-ttu-id="797ff-123">Адрес электронной почты получателя должен собираются из данных в нескольких элементов управления для отображения таблицы.</span><span class="sxs-lookup"><span data-stu-id="797ff-123">The email address for the recipient must be assembled from data in multiple display table controls.</span></span>
    
- <span data-ttu-id="797ff-124">Проблемы с вашего поставщика отображение уведомлений в таблице.</span><span class="sxs-lookup"><span data-stu-id="797ff-124">Your provider issues display table notifications.</span></span>
    
<span data-ttu-id="797ff-125">Флаг FILL_ENTRY указывает к поставщику, что поставщик узла требуется все свойства получателя, который требуется обновить.</span><span class="sxs-lookup"><span data-stu-id="797ff-125">The FILL_ENTRY flag indicates to your provider that the host provider requires all the properties of the recipient to be updated.</span></span> <span data-ttu-id="797ff-126">Для выполнения этого запроса требуется ваш поставщик.</span><span class="sxs-lookup"><span data-stu-id="797ff-126">Your provider is required to fulfill this request.</span></span>
  
<span data-ttu-id="797ff-127">Когда этот поставщик вызывает метод **OpenTemplateID** ваш поставщик, ваш поставщик может:</span><span class="sxs-lookup"><span data-stu-id="797ff-127">When a host provider calls your provider's **OpenTemplateID** method, your provider might:</span></span> 
  
- <span data-ttu-id="797ff-128">Периодически обновите данные в скопированной записи.</span><span class="sxs-lookup"><span data-stu-id="797ff-128">Periodically update the data for a copied entry.</span></span>
    
- <span data-ttu-id="797ff-129">Будьте скопированной записи синхронизированы с его исходного документа, например, когда запись книга копируется в адресной книге.</span><span class="sxs-lookup"><span data-stu-id="797ff-129">Keep a copied entry synchronized with its original, such as when an address book entry is copied to the personal address book.</span></span>
    
- <span data-ttu-id="797ff-130">Реализация функции, которая не может быть реализован поставщиком узла, такие как динамическое заполнение списка флажки в таблице скопированной запись сведений на основе данных на сервере.</span><span class="sxs-lookup"><span data-stu-id="797ff-130">Implement functionality that cannot be implemented by the host provider, such as dynamically populating list boxes in the copied entry's details table from data on a server.</span></span>
    
- <span data-ttu-id="797ff-131">Взаимодействие между свойствами в скопированной записи или экземпляра шаблона элемента управления.</span><span class="sxs-lookup"><span data-stu-id="797ff-131">Control the interaction among properties in a copied entry or instantiated template.</span></span> <span data-ttu-id="797ff-132">Например вычислений **PR_EMAIL_ADDRESS** из других свойства, отображаемые в таблице сведений.</span><span class="sxs-lookup"><span data-stu-id="797ff-132">For example, computing **PR_EMAIL_ADDRESS** from other properties displayed in the details table.</span></span> 
    
<span data-ttu-id="797ff-133">Первые два приведены примеры задач, которые не требуют поставщика, чтобы задать объект оболочку свойство — реализация **IMAPIProp** , основанный на реализации поставщика узла.</span><span class="sxs-lookup"><span data-stu-id="797ff-133">The first two items are examples of tasks that do not require your provider to supply a wrapped property object — an implementation of **IMAPIProp** that is based on the host provider's implementation.</span></span> <span data-ttu-id="797ff-134">Ваш поставщик можно просто обновить свойства как необходимые и возврата, установка для параметра _lppMAPIPropNew_ для указания на указатель, переданный поставщиком узла с помощью параметра _lpMAPIPropData_ .</span><span class="sxs-lookup"><span data-stu-id="797ff-134">Your provider can simply update the properties as necessary and return, setting the  _lppMAPIPropNew_ parameter to point to the pointer passed in by the host provider in the  _lpMAPIPropData_ parameter.</span></span> 
  
<span data-ttu-id="797ff-135">Во-вторых две задачи требуется, что ваш поставщик возврата к поставщику узла свойство объекта, который имеет объект поставщика узла с дополнительными функциональными возможностями, например возможность открыть окно свойств для записи.</span><span class="sxs-lookup"><span data-stu-id="797ff-135">The second two tasks require that your provider return to the host provider a property object that wraps the host provider's object with additional functionality, such as the ability to display a property sheet for the entry.</span></span> <span data-ttu-id="797ff-136">Этот объект свойство будет либо обмена сообщениями пользователя или список рассылки, в зависимости от типа объекта, переданного поставщиком узла с помощью параметра _lpMAPIPropData_ и указывает идентификатор интерфейса с помощью параметра _lpInterface_ .</span><span class="sxs-lookup"><span data-stu-id="797ff-136">This property object will either be a messaging user or distribution list, depending on the type of object passed in by the host provider in the  _lpMAPIPropData_ parameter and indicated by the interface identifier in the  _lpInterface_ parameter.</span></span> <span data-ttu-id="797ff-137">Если параметр _lpMAPIPropData_ указывает обмена сообщениями пользователя, ваш поставщик оболочку свойство объект должен иметь реализацию **IMailUser** .</span><span class="sxs-lookup"><span data-stu-id="797ff-137">If the  _lpMAPIPropData_ parameter points to a messaging user, your provider's wrapped property object must be an **IMailUser** implementation.</span></span> <span data-ttu-id="797ff-138">Если _lpMAPIPropData_ Указывает список рассылки, он должен быть реализацию **IDistList** .</span><span class="sxs-lookup"><span data-stu-id="797ff-138">If  _lpMAPIPropData_ points to a distribution list, it must be an **IDistList** implementation.</span></span> 
  
<span data-ttu-id="797ff-139">Объект оболочку свойства ваш поставщик перехватывает вызовы методов **IMAPIProp** для выполнения определенного контекста обработки поставщика хост-получателя — объект, его переноса.</span><span class="sxs-lookup"><span data-stu-id="797ff-139">Your provider's wrapped property object intercepts **IMAPIProp** method calls to perform context-specific manipulation of the host provider's recipient—the object it is wrapping.</span></span> <span data-ttu-id="797ff-140">MAPI имеет только одного требования для объектов с переносами свойства: все вызовы [IMAPIProp::OpenProperty](imapiprop-openproperty.md) разрешения на запрос свойства **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) должны быть переданы в поставщик узла.</span><span class="sxs-lookup"><span data-stu-id="797ff-140">MAPI only has one requirement for wrapped property objects: all calls to [IMAPIProp::OpenProperty](imapiprop-openproperty.md) requesting the **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) property should be passed to the host provider.</span></span> <span data-ttu-id="797ff-141">Реализация ваш поставщик может использовать возвращаемой таблицы для перехвата уведомления о таблице отображения или добавить свой собственный, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="797ff-141">Your provider's implementation can use the returned table to intercept display table notifications or to add its own if necessary.</span></span> 
  
<span data-ttu-id="797ff-142">В следующем списке перечислены задачи, которые обычно реализуются в объекте оболочку свойство реализации внешнего поставщиками:</span><span class="sxs-lookup"><span data-stu-id="797ff-142">The following list includes tasks that are typically implemented in the wrapped property object implemented by foreign providers:</span></span>
  
- <span data-ttu-id="797ff-143">Предварительная обработка и последующая обработка значения свойств для узла-получателя в [IMAPIProp::GetProps](imapiprop-getprops.md).</span><span class="sxs-lookup"><span data-stu-id="797ff-143">Preprocessing and postprocessing property values for the host recipient in [IMAPIProp::GetProps](imapiprop-getprops.md).</span></span>
    
- <span data-ttu-id="797ff-144">Сведения обработки отображения элемента управления в таблице, например кнопки и списка, в **IMAPIProp::OpenProperty**.</span><span class="sxs-lookup"><span data-stu-id="797ff-144">Handling details display table controls, such as buttons and list boxes, in **IMAPIProp::OpenProperty**.</span></span>
    
- <span data-ttu-id="797ff-145">Проверка и управления данными значения свойств для узла-получателя в [IMAPIProp::SetProps](imapiprop-setprops.md).</span><span class="sxs-lookup"><span data-stu-id="797ff-145">Validating or manipulating property values for the host recipient in [IMAPIProp::SetProps](imapiprop-setprops.md).</span></span>
    
- <span data-ttu-id="797ff-146">Вычислений необходимые свойства, такие как **PR_EMAIL_ADDRESS** и убедившись, что все необходимые свойства были установлены перед сохранением получателя узла в [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span><span class="sxs-lookup"><span data-stu-id="797ff-146">Computing required properties such as **PR_EMAIL_ADDRESS** and verifying that all of the necessary properties have been set before saving the host recipient in [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span>
    
### <a name="to-implement-iablogonopentemplateid"></a><span data-ttu-id="797ff-147">Для реализации IABLogon::OpenTemplateID</span><span class="sxs-lookup"><span data-stu-id="797ff-147">To implement IABLogon::OpenTemplateID</span></span>
  
1. <span data-ttu-id="797ff-148">Проверьте идентификатор шаблона, передаваемый в с помощью параметра _lpTemplateID_ является допустимым и в формате, который распознает ваш поставщик.</span><span class="sxs-lookup"><span data-stu-id="797ff-148">Check if the template identifier passed in with the  _lpTemplateID_ parameter is valid and is in a format that your provider recognizes.</span></span> <span data-ttu-id="797ff-149">Если он не установлен, ошибкой и вернуть MAPI_E_INVALID_ENTRYID.</span><span class="sxs-lookup"><span data-stu-id="797ff-149">If it is not, fail and return MAPI_E_INVALID_ENTRYID.</span></span> 
    
2. <span data-ttu-id="797ff-150">Создайте объект типа, указанный в параметре идентификатор шаблона обмена сообщениями пользователя, список рассылки или одноразовых получателя.</span><span class="sxs-lookup"><span data-stu-id="797ff-150">Create an object of the type indicated by the template identifier, either a messaging user, distribution list, or one-off recipient.</span></span> 
    
3. <span data-ttu-id="797ff-151">Вызовите метод **IUnknown::AddRef** в свойства объекта поставщика узла, которое — это объект, указанный в параметре _lpMAPIPropData_ .</span><span class="sxs-lookup"><span data-stu-id="797ff-151">Call the **IUnknown::AddRef** method in the host provider's property object, which is the object pointed to by the  _lpMAPIPropData_ parameter.</span></span> 
    
4. <span data-ttu-id="797ff-152">Если параметр _ulTemplateFlags_ имеет значение FILL_ENTRY:</span><span class="sxs-lookup"><span data-stu-id="797ff-152">If the  _ulTemplateFlags_ parameter is set to FILL_ENTRY:</span></span> 
    
   1. <span data-ttu-id="797ff-153">Если новый объект обмена сообщениями пользователя или списка рассылки:</span><span class="sxs-lookup"><span data-stu-id="797ff-153">If the new object is a messaging user or distribution list:</span></span>
      
      1. <span data-ttu-id="797ff-154">Извлечение всех свойств новый объект возможно путем вызова метода **IMAPIProp::GetProps** .</span><span class="sxs-lookup"><span data-stu-id="797ff-154">Retrieve all of the properties of the new object, possibly by calling its **IMAPIProp::GetProps** method.</span></span> 
          
      2. <span data-ttu-id="797ff-155">Вызов метода **IMAPIProp::SetProps** поставщик узла Копировать все извлеченные свойства объект свойство поставщика узла.</span><span class="sxs-lookup"><span data-stu-id="797ff-155">Call the host provider's **IMAPIProp::SetProps** method to copy all of the retrieved properties to the host provider's property object.</span></span> 
      
   2. <span data-ttu-id="797ff-156">Если новый объект является одноразовых получателя, вызовите метод **IMAPIProp::SetProps** поставщик узла для настройки следующих свойств:</span><span class="sxs-lookup"><span data-stu-id="797ff-156">If the new object is a one-off recipient, call the host provider's **IMAPIProp::SetProps** method to set the following properties:</span></span> 
      
      - <span data-ttu-id="797ff-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) для типа адреса обрабатывается поставщиком.</span><span class="sxs-lookup"><span data-stu-id="797ff-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) to the address type handled by your provider.</span></span>
        
      - <span data-ttu-id="797ff-158">**Цена\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) для идентификатора шаблона из параметров _lpTemplateID_ и _cbTemplateID_ .</span><span class="sxs-lookup"><span data-stu-id="797ff-158">**PR\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) to the template identifier from the  _lpTemplateID_ and  _cbTemplateID_ parameters.</span></span> 
        
      - <span data-ttu-id="797ff-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) DT_MAILUSER или DT_DISTLIST ограничено.</span><span class="sxs-lookup"><span data-stu-id="797ff-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) to DT_MAILUSER or DT_DISTLIST, as appropriate.</span></span>
    
5. <span data-ttu-id="797ff-160">Задайте содержимое параметра _lppMAPIPropNew_ для указания на новый объект ваш поставщик или свойство объекта, переданного с помощью параметра _lpMAPIPropData_ , в зависимости от того, является ли поставщик определяет, что перенесенного объекта не требуется.</span><span class="sxs-lookup"><span data-stu-id="797ff-160">Set the contents of the  _lppMAPIPropNew_ parameter to point to either your provider's new object or the property object passed in with the  _lpMAPIPropData_ parameter, depending on whether your provider determines a wrapped object is necessary.</span></span> 
    
6. <span data-ttu-id="797ff-161">Если возникает критическая ошибка, например, сбой сети или нехватки памяти, возвращают соответствующего значения ошибки.</span><span class="sxs-lookup"><span data-stu-id="797ff-161">If a critical error occurs, such as a network failure or an out of memory condition, return the appropriate error value.</span></span> <span data-ttu-id="797ff-162">Это значение необходимо получить распространяются с клиентом, соответствующие структуры [MAPIERROR](mapierror.md) , выполнения задачи для размещения поставщика.</span><span class="sxs-lookup"><span data-stu-id="797ff-162">This value should get propagated to the client with the appropriate [MAPIERROR](mapierror.md) structure, a task performed by the host provider.</span></span> 
    

