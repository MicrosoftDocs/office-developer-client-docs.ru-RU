---
title: Работа в качестве внешнего поставщика адресной книги
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 300681bd585e9d534113404a82f43565f4e79bb4
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32331213"
---
# <a name="acting-as-a-foreign-address-book-provider"></a>Работа в качестве внешнего поставщика адресной книги

**Область применения**: Outlook 2013 | Outlook 2016 
  
Внешний поставщик — это поставщик адресных книг, который: 
  
- Назначает идентификаторы шаблонов для получателей.
    
- Поддерживает метод [иаблогон:: опентемплатеид](iablogon-opentemplateid.md) . 
    
- Предоставляет код для обслуживания получателей, которые существуют в контейнерах других поставщиков адресных книг, известных как поставщики узла. В этом коде используется объект Property, как правило, реализация интерфейса **IMAPIProp** , который создает оболочку для объекта Property из поставщика узла. 
    
Роль "внешний поставщик" является необязательной. не все поставщики нуждаются в поддержке идентификаторов шаблонов и связанных с ними кодов. Реализуйте поставщика как внешний поставщик, если вы хотите поддерживать управление получателями, которые создают поставщики с помощью шаблонов, предоставленных поставщиком. 
  
Формат, используемый поставщиком для идентификаторов записей, также можно использовать для идентификаторов шаблонов. Идентификаторы шаблонов должны включать зарегистрированный **мапиуид** поставщика, чтобы включить поддержку MAPI для успешной привязывания получателей к соответствующим поставщикам. 
  
MAPI вызывает метод **иаблогон:: опентемплатеид** поставщика, когда поставщик узла вызывает [Имаписуппорт:: опентемплатеид](imapisupport-opentemplateid.md). Поставщик узла передает идентификатор шаблона получателя в параметре _лптемплатеид_ в вызове **Имаписуппорт:: опентемплатеид**. MAPI определяет, что идентификатор шаблона принадлежит поставщику, сопоставляя [мапиуид](mapiuid.md) в идентификаторе шаблона с **мапиуид** , зарегистрированным поставщиком во время входа. Затем MAPI перенаправляет вызов поставщика узла с помощью метода **иаблогон:: опентемплатеид** . 
  
Поставщик узла также передает указатель на его реализацию объекта Property для получателя в параметре _лпмапипропдата_ — идентификатор интерфейса в параметре _лпинтерфаце_ , соответствующий типу реализации интерфейса. передается в _лпмапипропдата_и необязательный флаг, филл_ентри. Поставщик должен возвратить в параметре _лппмапипропнев_ указатель на реализацию объекта Property типа, указанного в _лпинтерфаце_. Возвращаемый указатель может представлять собой упакованный объект Property, реализованный поставщиком, или объекту, предоставленному поставщиком узла в _лпмапипропдата_. Поставщик должен возвратить указатель на объект упакованного свойства в следующих случаях:
  
- В таблице отображения получателя содержатся элементы управления "список".
    
- Адрес электронной почты получателя должен быть собран на основе данных в нескольких элементах управления "таблица отображения".
    
- Проблемы поставщика отображают табличные уведомления.
    
Флаг ФИЛЛ_ЕНТРИ указывает поставщику, что поставщику услуг требуется, чтобы все свойства получателя были обновлены. Для выполнения этого запроса требуется поставщик.
  
Когда поставщик узла вызывает метод **опентемплатеид** поставщика, поставщик может: 
  
- Периодическое обновление данных для скопированной записи.
    
- Синхронизация скопированной записи с оригиналом (например, при копировании записи адресной книги в личную адресную книгу).
    
- Реализуйте функции, которые не могут быть реализованы поставщиком узла, например, динамическое заполнение списков в таблице сведений скопированной записи из данных на сервере.
    
- Управление взаимодействием между свойствами в скопированной записи или шаблоне. Например, вычисление **пр_емаил_аддресс** из других свойств, отображаемых в таблице Details. 
    
Первые два элемента — это примеры задач, которые не требуют от поставщика предоставления объекта упакованного свойства — реализации **IMAPIProp** , основанной на реализации поставщика узла. Поставщик может просто обновить свойства по мере необходимости и вернуться, установив параметр _лппмапипропнев_ для указания на указатель, переданный поставщиком узла, в параметре _лпмапипропдата_ . 
  
Вторая из двух задач требует, чтобы поставщик возвращался к поставщику узла объект Property, который создает оболочку для объекта поставщика узла с дополнительными функциональными возможностями, например возможность отображения страницы свойств для записи. Этот объект Property будет либо пользователем обмена сообщениями, либо списком рассылки, в зависимости от типа объекта, переданного поставщиком размещения в параметре _лпмапипропдата_ и указанного идентификатором интерфейса в параметре _лпинтерфаце_ . Если параметр _лпмапипропдата_ указывает на пользователя обмена сообщениями, то объект свойства, обтекаемого поставщиком, должен быть реализацией **имаилусер** . Если _лпмапипропдата_ указывает на список рассылки, он должен быть реализацией **идистлист** . 
  
Объект упакованного свойства поставщика перехватывает вызовы метода **IMAPIProp** для выполнения контекстной обработки получателя поставщика узла — объект, на который выполняется перенос. MAPI содержит только одно требование для объектов упакованных свойств: ALL Calls to [IMAPIProp:: опенпроперти](imapiprop-openproperty.md) , запрашивающий свойство **пр_детаилс_табле** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)), необходимо передать поставщику узла. Реализация поставщика может использовать возвращенную таблицу для перехвата уведомлений таблицы отображения или для добавления собственной, если это необходимо. 
  
В приведенном ниже списке перечислены задачи, которые обычно реализуются в объекте обернутого свойства, реализованном внешними поставщиками:
  
- Значения свойств предварительной обработки и обработки для получателя узла в [IMAPIProp::](imapiprop-getprops.md)/PROPS.
    
- Сведения об обработке отображают элементы управления таблицы, такие как кнопки и списки, в **IMAPIProp:: опенпроперти**.
    
- Проверка или управление значениями свойств для получателя узла в [IMAPIProp:: SetProps](imapiprop-setprops.md).
    
- Вычисление необходимых свойств, таких как **пр_емаил_аддресс** , и проверка того, что все необходимые свойства заданы до сохранения ведущего получателя в [IMAPIProp:: SaveChanges](imapiprop-savechanges.md).
    
### <a name="to-implement-iablogonopentemplateid"></a>Реализация Иаблогон:: Опентемплатеид
  
1. Убедитесь, что идентификатор шаблона, переданный с параметром _лптемплатеид_ , является допустимым и имеет формат, распознаваемый поставщиком. В противном случае — Fail и возвратите МАПИ_Е_ИНВАЛИД_ЕНТРИД. 
    
2. Создайте объект типа, указанного с помощью идентификатора шаблона, пользователя обмена сообщениями, списка рассылки или одноразового получателя. 
    
3. ВыЗовите метод **IUnknown:: AddRef** в объекте свойства поставщика узла, который указывает на объект, на который указывает параметр _лпмапипропдата_ . 
    
4. Если для параметра _ултемплатефлагс_ задано значение филл_ентри: 
    
   1. Если новый объект является пользователем или списком рассылки для обмена сообщениями:
      
      1. Получите все свойства нового объекта, возможно, с помощью вызова метода **IMAPIProp::** и. 
          
      2. ВыЗовите метод **IMAPIProp:: SetProps** поставщика узла, чтобы скопировать все извлеченные свойства в объект Property поставщика узла. 
      
   2. Если новый объект является одноразовым получателем, вызовите метод **IMAPIProp:: SetProps** поставщика узла, чтобы задать следующие свойства: 
      
      - **Пр_аддртипе** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) в тип адреса, обрабатываемый поставщиком.
        
      - **PR\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) в идентификатор шаблона из параметров _лптемплатеид_ и _кбтемплатеид_ . 
        
      - **Пр_дисплай_типе** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) в ДТ_МАИЛУСЕР или дт_дистлист, если это необходимо.
    
5. Задайте значение параметра _лппмапипропнев_ , чтобы оно ссылалось на новый объект поставщика или объект свойства, переданный с параметром _лпмапипропдата_ , в зависимости от того, определяет ли поставщик объект, перенесенный в оболочку. 
    
6. При возникновении критической ошибки, например ошибки сети или нехватки памяти, возвращается соответствующее значение ошибки. Это значение должно быть распространено на клиент с соответствующей структурой [мапиеррор](mapierror.md) , задачей, выполняемой поставщиком узла. 
    

