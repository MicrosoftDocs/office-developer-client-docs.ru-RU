---
title: Работа в качестве внешнего поставщика адресной книги
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 300681bd585e9d534113404a82f43565f4e79bb4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435742"
---
# <a name="acting-as-a-foreign-address-book-provider"></a>Работа в качестве внешнего поставщика адресной книги

**Область применения**: Outlook 2013 | Outlook 2016 
  
Иностранный поставщик — поставщик адресных книг, который: 
  
- Назначает идентификаторы шаблонов для получателей.
    
- Поддерживает метод [IABLogon::OpenTemplateID.](iablogon-opentemplateid.md) 
    
- Поставляет код для обслуживания получателей, которые существуют в контейнерах других поставщиков адресных книг, известных как поставщики хостов. Этот код включает объект свойства, как правило, реализацию **интерфейса IMAPIProp,** который заворачивает объект свойства от поставщика хостов. 
    
Роль иностранного поставщика необязательна; не всем поставщикам необходимо поддерживать идентификаторы шаблонов и связанный с ними код. Реализуйте поставщика как иностранного поставщика, если вы хотите сохранить контроль над получателями, которые создают поставщики хостов, используя шаблоны, предоставленные поставщиком. 
  
Формат, используемый поставщиком для идентификаторов записей, также может использоваться для идентификаторов шаблонов. Идентификаторы шаблонов должны включать зарегистрированный **MAPIUID** поставщика, чтобы mapI успешно связывал получателей с соответствующими поставщиками. 
  
MAPI вызывает метод **IABLogon::OpenTemplateID** поставщика, когда поставщик хостов вызывает [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md). Поставщик хост передает идентификатор шаблона получателя в  _параметре lpTemplateID_ в **вызове на IMAPISupport::OpenTemplateID**. MAPI определяет, что идентификатор шаблона принадлежит поставщику, соединая [MAPIUID](mapiuid.md) в идентификаторе шаблона с **MAPIUID,** зарегистрированным поставщиком во время регистрации логотипа. После этого MAPI передает вызов поставщика хост-провайдера поставщику с помощью **метода IABLogon::OpenTemplateID.** 
  
Поставщик хостов также передает указатель на реализацию объекта свойства для получателя в параметре  _lpMAPIPropData,_ идентификатор интерфейса в параметре  _lpInterface,_ соответствующий типу реализации интерфейса, переданного в  _lpMAPIPropData,_ и необязательный флаг FILL_ENTRY. Ожидается, что поставщик вернет в _параметре lppMAPIPropNew_ указатель на реализацию объекта свойства типа, указанного в _lpInterface._ Возвращенный указатель может быть как объектом свойства, реализованным вашим поставщиком, так и объектом, предоставленным поставщиком хостов _в lpMAPIPropData._ Поставщик должен вернуть завернутый указатель объекта свойства, когда:
  
- Таблица отображения получателя содержит элементы управления полем списка.
    
- Адрес электронной почты получателя должен быть собран из данных в нескольких элементов управления таблицой отображения.
    
- Поставщик выдает уведомления таблицы отображения.
    
Флаг FILL_ENTRY указывает поставщику, что поставщик хост требует обновления всех свойств получателя. Поставщик должен выполнить этот запрос.
  
Если поставщик хост вызывает метод **OpenTemplateID** поставщика, поставщик может: 
  
- Периодически обновляйте данные для скопированной записи.
    
- Скопированная запись синхронизирована с оригиналом, например при копировании записи адресной книги в личную адресную книгу.
    
- Реализуют функциональные возможности, которые не могут быть реализованы поставщиком хост-серверов, например динамическое заполнение полей списков в таблице сведений скопированные записи из данных на сервере.
    
- Управление взаимодействием между свойствами в скопированном записи или мгновенном шаблоне. Например, **вычисление** PR_EMAIL_ADDRESS из других свойств, отображающихся в таблице сведений. 
    
Первые два пункта — это примеры задач, которые не требуют от поставщика поставлять завернутый объект свойства — реализацию **IMAPIProp,** основанную на реализации поставщика хостов. Поставщик может просто обновить свойства по мере необходимости и вернуться, задав _параметру lppMAPIPropNew_ указатель, переданный поставщиком-хостом в _параметре lpMAPIPropData._ 
  
Вторые две задачи требуют, чтобы поставщик возвращал поставщику свойств объект свойства, который заворачивал объект поставщика хостов с дополнительными функциями, такими как возможность отображения листа свойств для записи. Этот объект свойства будет либо пользователем обмена сообщениями, либо списком рассылки в зависимости от типа объекта, переданного поставщиком хостов в _параметре lpMAPIPropData_ и указанным идентификатором интерфейса в параметре _lpInterface._ Если _параметр lpMAPIPropData_ указывает пользователю обмена сообщениями, объектом завернутой свойства поставщика должна быть **реализация IMailUser.** Если _lpMAPIPropData_ указывает на список рассылки, это должна быть **реализация IDistList.** 
  
Завернутый объект свойства поставщика перехватывает вызовы метода **IMAPIProp** для выполнения определенных контекстом манипуляций получателя поставщика- объекта, который он завершает. MAPI имеет только одно требование для завернутых объектов свойств: все вызовы в [IMAPIProp::OpenProperty](imapiprop-openproperty.md) с запросом **свойства PR_DETAILS_TABLE** [(PidTagDetailsTable)](pidtagdetailstable-canonical-property.md)должны передаваться поставщику хостов. Реализация поставщика может использовать возвращаемую таблицу для перехвата уведомлений таблицы отображения или добавления собственных, если это необходимо. 
  
В следующий список входят задачи, которые обычно реализуются в объекте завернутого свойства, реализуемом иностранными поставщиками:
  
- Preprocessing and postprocessing property values for the host recipient in [IMAPIProp::GetProps](imapiprop-getprops.md).
    
- Управление деталями отображения элементов управления таблицами, например кнопок и полей списков, в **IMAPIProp::OpenProperty**.
    
- Проверка или управление значениями свойств для получателя-хоста [в IMAPIProp::SetProps](imapiprop-setprops.md).
    
- Вычисление необходимых свойств, таких как **PR_EMAIL_ADDRESS** и проверка того, что все необходимые свойства были установлены перед сохранением получателя-хоста в [IMAPIProp::SaveChanges](imapiprop-savechanges.md).
    
### <a name="to-implement-iablogonopentemplateid"></a>Реализация IABLogon::OpenTemplateID
  
1. Проверьте, допустим ли идентификатор шаблона, переданный с параметром  _lpTemplateID,_ в формате, который распознает поставщик. Если это не так, сбой и возвращение MAPI_E_INVALID_ENTRYID. 
    
2. Создайте объект типа, указанный идентификатором шаблона, пользователем сообщений, списком рассылки или разово получателем. 
    
3. Вызов **метода IUnknown::AddRef** в объекте свойства поставщика хостов, на который указывает параметр _lpMAPIPropData._ 
    
4. Если  _параметр ulTemplateFlags_ задан для FILL_ENTRY: 
    
   1. Если новый объект является пользователем обмена сообщениями или списком рассылки:
      
      1. Извлечение всех свойств нового объекта, возможно, путем вызова метода **IMAPIProp::GetProps.** 
          
      2. Позвоните по методу **IMAPIProp::SetProps** поставщика размещения, чтобы скопировать все полученные свойства в объект свойства поставщика размещения. 
      
   2. Если новый объект является разовым получателем, позвоните по методу **IMAPIProp::SetProps,** чтобы установить следующие свойства: 
      
      - **PR_ADDRTYPE** [(PidTagAddressType)](pidtagaddresstype-canonical-property.md)для типа адресов, обрабатываемого поставщиком.
        
      - **PR \_ TEMPLATEID** [(PidTagTemplateid)](pidtagtemplateid-canonical-property.md)для идентификатора шаблона из _lpTemplateID_ и _cbTemplateID._ 
        
      - **PR_DISPLAY_TYPE** [(PidTagDisplayType)](pidtagdisplaytype-canonical-property.md)для DT_MAILUSER или DT_DISTLIST, по мере необходимости.
    
5. Установите содержимое параметра  _lppMAPIPropNew,_ чтобы указать на новый объект поставщика или объект свойства, переданный с параметром  _lpMAPIPropData,_ в зависимости от того, определяет ли поставщик завернутый объект. 
    
6. Если возникает критическая ошибка, например сбой сети или невыполнение условий памяти, верни соответствующее значение ошибки. Это значение должно распространяться на клиента с соответствующей структурой [MAPIERROR,](mapierror.md) задачей, выполняемой поставщиком хостов. 
    

