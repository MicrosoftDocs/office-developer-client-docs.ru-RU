---
title: Работа в качестве внешнего поставщика адресной книги
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Дата последнего изменения: 23 июля 2011 г.'
ms.openlocfilehash: 300681bd585e9d534113404a82f43565f4e79bb4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435742"
---
# <a name="acting-as-a-foreign-address-book-provider"></a><span data-ttu-id="b497d-103">Работа в качестве внешнего поставщика адресной книги</span><span class="sxs-lookup"><span data-stu-id="b497d-103">Acting as a foreign address book provider</span></span>

<span data-ttu-id="b497d-104">**Относится к**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="b497d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="b497d-105">Внешние поставщики — это поставщик адресной книги, который:</span><span class="sxs-lookup"><span data-stu-id="b497d-105">A foreign provider is an address book provider that:</span></span> 
  
- <span data-ttu-id="b497d-106">Назначает идентификаторы шаблонов получателям.</span><span class="sxs-lookup"><span data-stu-id="b497d-106">Assigns template identifiers for its recipients.</span></span>
    
- <span data-ttu-id="b497d-107">Поддерживает метод [IABLogon::OpenTemplateID.](iablogon-opentemplateid.md)</span><span class="sxs-lookup"><span data-stu-id="b497d-107">Supports the [IABLogon::OpenTemplateID](iablogon-opentemplateid.md) method.</span></span> 
    
- <span data-ttu-id="b497d-108">Код для обслуживания получателей, которые существуют в контейнерах других поставщиков адресных книг, известных как поставщики услуг.</span><span class="sxs-lookup"><span data-stu-id="b497d-108">Supplies code for maintaining recipients that exist in the containers of other address book providers known as host providers.</span></span> <span data-ttu-id="b497d-109">Этот код включает объект свойства, как правило, реализацию интерфейса **IMAPIProp,** которая включает объект свойства от поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="b497d-109">This code involves a property object, typically an **IMAPIProp** interface implementation, which wraps a property object from the host provider.</span></span> 
    
<span data-ttu-id="b497d-110">Выступая в качестве внешнего поставщика, это необязательная роль; Не все поставщики должны поддерживать идентификаторы шаблонов и соответствующий код.</span><span class="sxs-lookup"><span data-stu-id="b497d-110">Acting as a foreign provider is an optional role; not all providers need to support template identifiers and their related code.</span></span> <span data-ttu-id="b497d-111">Реализуйте поставщика как внешнего поставщика, если вы хотите сохранить контроль над получателями, которые создают поставщики услуг, используя шаблоны, предоставленные поставщиком.</span><span class="sxs-lookup"><span data-stu-id="b497d-111">Implement your provider as a foreign provider if you want to maintain control over recipients that host providers create using templates supplied by your provider.</span></span> 
  
<span data-ttu-id="b497d-112">Формат, используемый поставщиком для идентификаторов записей, также можно использовать для идентификаторов шаблонов.</span><span class="sxs-lookup"><span data-stu-id="b497d-112">The format that your provider uses for its entry identifiers can also be used for its template identifiers.</span></span> <span data-ttu-id="b497d-113">Идентификаторы шаблонов должны включать зарегистрированный **MAPIUID** поставщика, чтобы mapI успешно привязыл получателей к соответствующим поставщикам.</span><span class="sxs-lookup"><span data-stu-id="b497d-113">Template identifiers must include your provider's registered **MAPIUID** to enable MAPI to successfully bind recipients to the appropriate providers.</span></span> 
  
<span data-ttu-id="b497d-114">MAPI вызывает метод **IABLogon::OpenTemplateID** поставщика, когда поставщик услуг услуг хоста вызывает [IMAPISupport::OpenTemplateID.](imapisupport-opentemplateid.md)</span><span class="sxs-lookup"><span data-stu-id="b497d-114">MAPI calls your provider's **IABLogon::OpenTemplateID** method when a host provider calls [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md).</span></span> <span data-ttu-id="b497d-115">Поставщик услуг host передает идентификатор шаблона получателя в _параметре lpTemplateID_ в вызове **IMAPISupport::OpenTemplateID.**</span><span class="sxs-lookup"><span data-stu-id="b497d-115">The host provider passes the template identifier of the recipient in the  _lpTemplateID_ parameter in its call to **IMAPISupport::OpenTemplateID**.</span></span> <span data-ttu-id="b497d-116">MAPI определяет, что идентификатор шаблона принадлежит поставщику, путем совпадения [MAPIUID](mapiuid.md) в идентификаторе шаблона с **MAPIUID,** зарегистрированным поставщиком во время регистрации.</span><span class="sxs-lookup"><span data-stu-id="b497d-116">MAPI determines that the template identifier belongs to your provider by matching the [MAPIUID](mapiuid.md) in the template identifier with the **MAPIUID** that your provider registered at logon time.</span></span> <span data-ttu-id="b497d-117">Затем MAPI перенаадает вызов поставщика услуг хоста поставщику через метод **IABLogon::OpenTemplateID.**</span><span class="sxs-lookup"><span data-stu-id="b497d-117">MAPI then forwards the host provider's call to your provider through the **IABLogon::OpenTemplateID** method.</span></span> 
  
<span data-ttu-id="b497d-118">Поставщик ведущего приложения также передает указатель на реализацию объекта свойства получателя в параметре  _lpMAPIPropData,_ идентификатор интерфейса в параметре  _lpInterface,_ соответствующий типу реализации интерфейса, переданного  _в lpMAPIPropData,_ и необязательный флаг FILL_ENTRY.</span><span class="sxs-lookup"><span data-stu-id="b497d-118">The host provider also passes a pointer to its property object implementation for the recipient in the  _lpMAPIPropData_ parameter, an interface identifier in the  _lpInterface_ parameter that corresponds to the type of interface implementation passed in  _lpMAPIPropData_, and an optional flag, FILL_ENTRY.</span></span> <span data-ttu-id="b497d-119">Ожидается, что поставщик вернет в _параметре lppMAPIPropNew_ указатель на реализацию объекта свойства типа, указанного в _lpInterface._</span><span class="sxs-lookup"><span data-stu-id="b497d-119">Your provider is expected to return in the  _lppMAPIPropNew_ parameter a pointer to a property object implementation of the type specified in  _lpInterface_.</span></span> <span data-ttu-id="b497d-120">Возвращаемая указатель может быть либо объектом-оболочкой свойства, реализованным поставщиком, либо объектом, предоставленным поставщиком услуг хоста в _lpMAPIPropData._</span><span class="sxs-lookup"><span data-stu-id="b497d-120">The returned pointer can either be to the wrapped property object implemented by your provider or to the object supplied by the host provider in  _lpMAPIPropData_.</span></span> <span data-ttu-id="b497d-121">Поставщик должен возвращать указатель объекта-оболочки свойства, когда:</span><span class="sxs-lookup"><span data-stu-id="b497d-121">Your provider should return a wrapped property object pointer when:</span></span>
  
- <span data-ttu-id="b497d-122">Таблица отображения получателя содержит элементы управления списком.</span><span class="sxs-lookup"><span data-stu-id="b497d-122">The recipient's display table contains list box controls.</span></span>
    
- <span data-ttu-id="b497d-123">Адрес электронной почты получателя должен быть собран из данных в нескольких отображаемой таблице элементов управления.</span><span class="sxs-lookup"><span data-stu-id="b497d-123">The email address for the recipient must be assembled from data in multiple display table controls.</span></span>
    
- <span data-ttu-id="b497d-124">Проблемы поставщика отображают уведомления о таблице.</span><span class="sxs-lookup"><span data-stu-id="b497d-124">Your provider issues display table notifications.</span></span>
    
<span data-ttu-id="b497d-125">Флаг FILL_ENTRY указывает поставщику, что поставщик услуг размещения требует обновления всех свойств получателя.</span><span class="sxs-lookup"><span data-stu-id="b497d-125">The FILL_ENTRY flag indicates to your provider that the host provider requires all the properties of the recipient to be updated.</span></span> <span data-ttu-id="b497d-126">Ваш поставщик должен выполнить этот запрос.</span><span class="sxs-lookup"><span data-stu-id="b497d-126">Your provider is required to fulfill this request.</span></span>
  
<span data-ttu-id="b497d-127">Когда поставщик услуг хоста вызывает метод **OpenTemplateID** поставщика, он может:</span><span class="sxs-lookup"><span data-stu-id="b497d-127">When a host provider calls your provider's **OpenTemplateID** method, your provider might:</span></span> 
  
- <span data-ttu-id="b497d-128">Периодически обновляйте данные для скопированной записи.</span><span class="sxs-lookup"><span data-stu-id="b497d-128">Periodically update the data for a copied entry.</span></span>
    
- <span data-ttu-id="b497d-129">Синхронизировать скопированную запись с ее исходным экземпляром, например при копировании записи адресной книги в личную адресную книгу.</span><span class="sxs-lookup"><span data-stu-id="b497d-129">Keep a copied entry synchronized with its original, such as when an address book entry is copied to the personal address book.</span></span>
    
- <span data-ttu-id="b497d-130">Реализуют функции, которые не могут быть реализованы поставщиком услуг хоста, например динамическое заполнение полей списков в таблице сведений скопированной записи из данных на сервере.</span><span class="sxs-lookup"><span data-stu-id="b497d-130">Implement functionality that cannot be implemented by the host provider, such as dynamically populating list boxes in the copied entry's details table from data on a server.</span></span>
    
- <span data-ttu-id="b497d-131">Управление взаимодействием между свойствами в скопированном или экземпляре шаблона.</span><span class="sxs-lookup"><span data-stu-id="b497d-131">Control the interaction among properties in a copied entry or instantiated template.</span></span> <span data-ttu-id="b497d-132">Например, вычисление **PR_EMAIL_ADDRESS** из других свойств, отображающихся в таблице сведений.</span><span class="sxs-lookup"><span data-stu-id="b497d-132">For example, computing **PR_EMAIL_ADDRESS** from other properties displayed in the details table.</span></span> 
    
<span data-ttu-id="b497d-133">Первые два пункта — это примеры задач, которые не требуют от поставщика предоставить объект свойства-оболочку — реализацию **IMAPIProp,** основанную на реализации поставщика услуг.</span><span class="sxs-lookup"><span data-stu-id="b497d-133">The first two items are examples of tasks that do not require your provider to supply a wrapped property object — an implementation of **IMAPIProp** that is based on the host provider's implementation.</span></span> <span data-ttu-id="b497d-134">Поставщик может просто обновить свойства по мере необходимости и вернуть их, задав для параметра _lppMAPIPropNew_ указатель, переданный поставщиком услуг размещения в _параметре lpMAPIPropData._</span><span class="sxs-lookup"><span data-stu-id="b497d-134">Your provider can simply update the properties as necessary and return, setting the  _lppMAPIPropNew_ parameter to point to the pointer passed in by the host provider in the  _lpMAPIPropData_ parameter.</span></span> 
  
<span data-ttu-id="b497d-135">Во второй двух задачах поставщик должен вернуть поставщику услугу доступа к объекту свойства, который обтекает объект поставщика услуг хоста дополнительными функциями, такими как возможность отображения таблицы свойств для записи.</span><span class="sxs-lookup"><span data-stu-id="b497d-135">The second two tasks require that your provider return to the host provider a property object that wraps the host provider's object with additional functionality, such as the ability to display a property sheet for the entry.</span></span> <span data-ttu-id="b497d-136">Этот объект свойства будет либо пользователем системы обмена сообщениями, либо списком рассылки в зависимости от типа объекта, переданного поставщиком услуг хоста в _параметре lpMAPIPropData_ и определяемого идентификатором интерфейса в параметре _lpInterface._</span><span class="sxs-lookup"><span data-stu-id="b497d-136">This property object will either be a messaging user or distribution list, depending on the type of object passed in by the host provider in the  _lpMAPIPropData_ parameter and indicated by the interface identifier in the  _lpInterface_ parameter.</span></span> <span data-ttu-id="b497d-137">Если параметр _lpMAPIPropData_ указывает на пользователя обмена сообщениями, объектом свойства-оболочки поставщика должна быть **реализация IMailUser.**</span><span class="sxs-lookup"><span data-stu-id="b497d-137">If the  _lpMAPIPropData_ parameter points to a messaging user, your provider's wrapped property object must be an **IMailUser** implementation.</span></span> <span data-ttu-id="b497d-138">Если _lpMAPIPropData_ указывает на список рассылки, это должна быть реализация **IDistList.**</span><span class="sxs-lookup"><span data-stu-id="b497d-138">If  _lpMAPIPropData_ points to a distribution list, it must be an **IDistList** implementation.</span></span> 
  
<span data-ttu-id="b497d-139">Объект свойства-оболочки поставщика перехватывает вызовы метода **IMAPIProp** для выполнения обработки получателя поставщика услуг услуг хоста с учетом контекста — объекта, который он обтекает.</span><span class="sxs-lookup"><span data-stu-id="b497d-139">Your provider's wrapped property object intercepts **IMAPIProp** method calls to perform context-specific manipulation of the host provider's recipient—the object it is wrapping.</span></span> <span data-ttu-id="b497d-140">MAPI предъявляет только одно требование к объектам-оболочкам свойств: все вызовы свойства [IMAPIProp::OpenProperty,](imapiprop-openproperty.md) запрашивающие свойство **PR_DETAILS_TABLE** ([PidTagDetailsTable),](pidtagdetailstable-canonical-property.md)должны передаваться поставщику услуг.</span><span class="sxs-lookup"><span data-stu-id="b497d-140">MAPI only has one requirement for wrapped property objects: all calls to [IMAPIProp::OpenProperty](imapiprop-openproperty.md) requesting the **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) property should be passed to the host provider.</span></span> <span data-ttu-id="b497d-141">Реализация поставщика может использовать возвращенную таблицу для перехвата уведомлений таблицы отображения или добавления собственных уведомлений при необходимости.</span><span class="sxs-lookup"><span data-stu-id="b497d-141">Your provider's implementation can use the returned table to intercept display table notifications or to add its own if necessary.</span></span> 
  
<span data-ttu-id="b497d-142">Следующий список включает задачи, которые обычно реализуются в объекте свойства-оболочке, реализуемом внешними поставщиками:</span><span class="sxs-lookup"><span data-stu-id="b497d-142">The following list includes tasks that are typically implemented in the wrapped property object implemented by foreign providers:</span></span>
  
- <span data-ttu-id="b497d-143">Значения свойств предварительной и postprocessing для получателя хоста [в IMAPIProp::GetProps](imapiprop-getprops.md).</span><span class="sxs-lookup"><span data-stu-id="b497d-143">Preprocessing and postprocessing property values for the host recipient in [IMAPIProp::GetProps](imapiprop-getprops.md).</span></span>
    
- <span data-ttu-id="b497d-144">Обработка элементов управления таблицей отображения сведений, таких как кнопки и списки, **в IMAPIProp::OpenProperty**.</span><span class="sxs-lookup"><span data-stu-id="b497d-144">Handling details display table controls, such as buttons and list boxes, in **IMAPIProp::OpenProperty**.</span></span>
    
- <span data-ttu-id="b497d-145">Проверка значений свойств получателя хоста в [IMAPIProp::SetProps](imapiprop-setprops.md)или управление ими.</span><span class="sxs-lookup"><span data-stu-id="b497d-145">Validating or manipulating property values for the host recipient in [IMAPIProp::SetProps](imapiprop-setprops.md).</span></span>
    
- <span data-ttu-id="b497d-146">Вычисление необходимых свойств, таких как **PR_EMAIL_ADDRESS,** и проверка того, что все необходимые свойства настроены перед сохранением получателя хоста в [IMAPIProp::SaveChanges.](imapiprop-savechanges.md)</span><span class="sxs-lookup"><span data-stu-id="b497d-146">Computing required properties such as **PR_EMAIL_ADDRESS** and verifying that all of the necessary properties have been set before saving the host recipient in [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span>
    
### <a name="to-implement-iablogonopentemplateid"></a><span data-ttu-id="b497d-147">Реализация IABLogon::OpenTemplateID</span><span class="sxs-lookup"><span data-stu-id="b497d-147">To implement IABLogon::OpenTemplateID</span></span>
  
1. <span data-ttu-id="b497d-148">Проверьте, является ли идентификатор шаблона, переданный с помощью  _параметра lpTemplateID_ допустимым и форматом, который распознает поставщик.</span><span class="sxs-lookup"><span data-stu-id="b497d-148">Check if the template identifier passed in with the  _lpTemplateID_ parameter is valid and is in a format that your provider recognizes.</span></span> <span data-ttu-id="b497d-149">Если это не так, сбой и возврат MAPI_E_INVALID_ENTRYID.</span><span class="sxs-lookup"><span data-stu-id="b497d-149">If it is not, fail and return MAPI_E_INVALID_ENTRYID.</span></span> 
    
2. <span data-ttu-id="b497d-150">Создайте объект типа, указанный идентификатором шаблона, пользователем сообщений, списком рассылки или одноразовимным получателем.</span><span class="sxs-lookup"><span data-stu-id="b497d-150">Create an object of the type indicated by the template identifier, either a messaging user, distribution list, or one-off recipient.</span></span> 
    
3. <span data-ttu-id="b497d-151">Вызовите метод **IUnknown::AddRef** в объекте свойства поставщика услуг хоста, который является объектом, на который указывает параметр _lpMAPIPropData._</span><span class="sxs-lookup"><span data-stu-id="b497d-151">Call the **IUnknown::AddRef** method in the host provider's property object, which is the object pointed to by the  _lpMAPIPropData_ parameter.</span></span> 
    
4. <span data-ttu-id="b497d-152">Если для  _параметра ulTemplateFlags_ установлено FILL_ENTRY:</span><span class="sxs-lookup"><span data-stu-id="b497d-152">If the  _ulTemplateFlags_ parameter is set to FILL_ENTRY:</span></span> 
    
   1. <span data-ttu-id="b497d-153">Если новый объект является пользователем системы обмена сообщениями или списком рассылки:</span><span class="sxs-lookup"><span data-stu-id="b497d-153">If the new object is a messaging user or distribution list:</span></span>
      
      1. <span data-ttu-id="b497d-154">Получите все свойства нового объекта, возможно, путем вызова метода **IMAPIProp::GetProps.**</span><span class="sxs-lookup"><span data-stu-id="b497d-154">Retrieve all of the properties of the new object, possibly by calling its **IMAPIProp::GetProps** method.</span></span> 
          
      2. <span data-ttu-id="b497d-155">Вызовите метод **IMAPIProp::SetProps** поставщика услуг размещения, чтобы скопировать все полученные свойства в объект свойства поставщика услуг размещения.</span><span class="sxs-lookup"><span data-stu-id="b497d-155">Call the host provider's **IMAPIProp::SetProps** method to copy all of the retrieved properties to the host provider's property object.</span></span> 
      
   2. <span data-ttu-id="b497d-156">Если новый объект является одноразовым получателем, вызовите метод **IMAPIProp::SetProps** поставщика услуг размещения, чтобы установить следующие свойства:</span><span class="sxs-lookup"><span data-stu-id="b497d-156">If the new object is a one-off recipient, call the host provider's **IMAPIProp::SetProps** method to set the following properties:</span></span> 
      
      - <span data-ttu-id="b497d-157">**PR_ADDRTYPE** ([PidTagAddressType)](pidtagaddresstype-canonical-property.md)для типа адреса, обрабатываемого поставщиком.</span><span class="sxs-lookup"><span data-stu-id="b497d-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) to the address type handled by your provider.</span></span>
        
      - <span data-ttu-id="b497d-158">**PR \_ TEMPLATEID** [(PidTagTemplateid)](pidtagtemplateid-canonical-property.md)в идентификатор шаблона из _параметров lpTemplateID_ и _cbTemplateID._</span><span class="sxs-lookup"><span data-stu-id="b497d-158">**PR\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) to the template identifier from the  _lpTemplateID_ and  _cbTemplateID_ parameters.</span></span> 
        
      - <span data-ttu-id="b497d-159">**PR_DISPLAY_TYPE** [(PidTagDisplayType)](pidtagdisplaytype-canonical-property.md)для DT_MAILUSER или DT_DISTLIST, если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="b497d-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) to DT_MAILUSER or DT_DISTLIST, as appropriate.</span></span>
    
5. <span data-ttu-id="b497d-160">Задайте содержимое параметра  _lppMAPIPropNew_ так, чтобы оно определяло новый объект поставщика или объект свойства, переданный с помощью параметра  _lpMAPIPropData,_ в зависимости от того, определяет ли поставщик необходимость в объекте-оболочке.</span><span class="sxs-lookup"><span data-stu-id="b497d-160">Set the contents of the  _lppMAPIPropNew_ parameter to point to either your provider's new object or the property object passed in with the  _lpMAPIPropData_ parameter, depending on whether your provider determines a wrapped object is necessary.</span></span> 
    
6. <span data-ttu-id="b497d-161">В случае критической ошибки, например сбоя сети или отказа памяти, возвращается соответствующее значение ошибки.</span><span class="sxs-lookup"><span data-stu-id="b497d-161">If a critical error occurs, such as a network failure or an out of memory condition, return the appropriate error value.</span></span> <span data-ttu-id="b497d-162">Это значение должно распространяться на клиент с соответствующей структурой [MAPIERROR,](mapierror.md) задачей, выполняемой поставщиком услуг хоста.</span><span class="sxs-lookup"><span data-stu-id="b497d-162">This value should get propagated to the client with the appropriate [MAPIERROR](mapierror.md) structure, a task performed by the host provider.</span></span> 
    

