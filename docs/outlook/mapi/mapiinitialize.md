---
title: MAPIInitialize
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPIInitialize
api_type:
- HeaderDef
ms.assetid: b9584226-79d2-4d83-8f31-dbfbc50f16c5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 6464f16d9ad73b332ff20dc007ef162b9525c6d5
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33411178"
---
# <a name="mapiinitialize"></a>MAPIInitialize

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Добавит количество ссылок подсистем MAPI и инициализирует глобальные данные для DLL MAPI. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapix.h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPIInitialize(
  LPVOID lpMapiInit
);
```

## <a name="parameters"></a>Параметры

 _lpMapiInit_
  
> [in] Указатель на [MAPIINIT_0](mapiinit_0.md) структуру. Для  _параметра lpMapiInit_ можно установить NULL. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Подсистема MAPI успешно инициализирована.
    
## <a name="remarks"></a>Примечания

Функция **MAPIInitialize** добавит количество ссылок MAPI для подсистемы MAPI, а функция [MAPIUninitialize](mapiuninitialize.md) понижит внутреннее количество ссылок. Таким образом, число вызовов одной функции должно быть равно числу вызовов другой. **MAPIInitialize** возвращает S_OK, если MAPI не был ранее инициализирован. 
  
Клиент или поставщик услуг должен вызвать **MAPIInitialize** перед любым другим вызовом MAPI. Если этого не сделать, вызовы клиента или поставщика услуг возвращают MAPI_E_NOT_INITIALIZED значение. 
  
При вызове **MAPIInitialize** из многоуровневого приложения установите для параметра [](mapiinit_0.md) _lpMapiInit_ MAPIINIT_0 структуру, которая объявлена следующим образом: 
  
 **MAPIINIT_0** MAPIINIT= { 0, MAPI_MULTITHREAD_NOTIFICATIONS} 
  
и вызовите: 
  
 **MAPIInitialize** ( &amp; MAPIINIT); 
  
Когда эта структура объявлена, MAPI создает отдельный поток для обработки окна уведомлений, который продолжается до тех пор, пока количество ссылок инициализации не упадет до нуля. Служба Windows должна установить для члена **ulflags** MAPIINIT_0, на который указывает _lpMapiInit,_ MAPI_NT_SERVICE.  
  
> [!NOTE]
> Невозможно вызвать **MAPIInitialize** или **MAPIUninitialize** из функции **Win32 DllMain** или любой другой функции, которая создает или завершает потоки. Дополнительные сведения см. в [Thread-Safe".](using-thread-safe-objects.md) 
  
 **MAPIInitialize** не возвращает расширенные сведения об ошибке. В отличие от большинства других вызовов MAPI значения возвращаемого значения строго определяются в соответствии с конкретным этапом инициализации, который не удалось инициализации: 
  
1. Проверяет параметры и флаги.
    
    MAPI_E_INVALID_PARAMETER или MAPI_E_UNKNOWN_FLAGS. Звоняке передан недопустимый параметр или флаг.
    
2. Инициализирует ключи реестра, необходимые mapI, и подтверждает тип операционной системы. Этот шаг происходит только в том случае, если клиентский процесс работает как служба в Windows и устанавливает флаг MAPI_NT service в **MAPIINIT_0** структуре. 
    
    MAPI_E_TOO_COMPLEX. Процесс вызова — это служба Windows, и не удалось инициализировать ключи реестра, необходимые MAPI. 
    
    Дополнительные сведения могут быть доступны в журнале событий приложения.
    
3. Проверьте совместимость MAPI с OLE, а затем инициализируют OLE.
    
1. Проверяет совместимость между текущими версиями OLE и MAPI. 
    
    MAPI_E_VERSION. Версия OLE, установленная на рабочей станции, несовместима с этой версией MAPI.
    
2. Инициализирует OLE. 
    
    Только на этом этапе эта функция может возвращать код ошибки, не указанный здесь. Любая _ошибка, не_ указанная в этом списке, должна происходить из функции OLE **CoInitialize.**
    
4. Инициализирует глобальные переменные для каждого процесса.
    
    MAPI_E_SESSION_LIMIT. MAPI настраивает контекст, специфический для текущего процесса. Сбои могут возникать в Win16, если число процессов превышает определенное число, или в любой системе, если объем доступной памяти исчерпан.
    
5. Инициализирует общие глобальные переменные всех процессов.
    
    MAPI_E_NOT_ENOUGH_RESOURCES. Недостаточно системных ресурсов для выполнения операции.
    
6. Инициализирует обдвижку уведомлений, создает его окно и его поток, если его запрашивает флаг MAPI_MULTITHREAD_NOTIFICATIONS уведомления. 
    
    MAPI_E_INVALID_OBJECT. Может привести к сбойу, если системные ресурсы исчерпаны. 
    
7. Загружает и инициализирует поставщика профилей. Проверяет, может **ли MAPIInitialize** получить доступ к ключу реестра, в котором хранятся данные профиля. 
    
    MAPI_E_NOT_INITIALIZED. Поставщик профилей столкнулся с ошибкой. 
    
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|ContentsTableListCtrl.cpp  <br/> ||MFCMAPI использует метод **MAPIInitialize** для инициализации MAPI в фоновом потоке для обработки таблиц.  <br/> |
   
## <a name="see-also"></a>См. также



[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

