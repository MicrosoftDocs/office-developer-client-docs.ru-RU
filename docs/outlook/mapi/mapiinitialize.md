---
title: MAPIInitialize
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPIInitialize
api_type:
- HeaderDef
ms.assetid: b9584226-79d2-4d83-8f31-dbfbc50f16c5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 5fcebd1fefa0d077acbe62a45a19a622e13b35fc
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "22587371"
---
# <a name="mapiinitialize"></a>MAPIInitialize

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Увеличивает счетчик ссылок подсистемы MAPI и инициализирует глобальных данных для библиотеки DLL MAPI. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapix.h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPIInitialize(
  LPVOID lpMapiInit
);
```

## <a name="parameters"></a>Параметры

 _lpMapiInit_
  
> [in] Указатель на структуру [MAPIINIT_0](mapiinit_0.md) . Параметр _lpMapiInit_ может иметь значение NULL. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Подсистема MAPI инициализирован успешно.
    
## <a name="remarks"></a>Замечания

Увеличивает функции **MAPIInitialize** , счетчик ссылок MAPI для подсистемы MAPI и уменьшает функция [MAPIUninitialize](mapiuninitialize.md) счетчик внутренних ссылок. Таким образом количество вызовов на одной функции должно совпадать с количеством вызовов в другой. **MAPIInitialize** возвращает значение S_OK, если ранее не был инициализирован MAPI. 
  
Клиент или служба поставщика необходимо вызвать **MAPIInitialize** перед внесением другой вызов MAPI. В противном случае вызывает клиента или поставщика вызовы для возврата значения MAPI_E_NOT_INITIALIZED. 
  
При вызове **MAPIInitialize** из многопоточного приложения, установите для параметра _lpMapiInit_ значение структура [MAPIINIT_0](mapiinit_0.md) , объявляется следующим образом: 
  
 **MAPIINIT_0** MAPIINIT = {0, MAPI_MULTITHREAD_NOTIFICATIONS} 
  
и звонка: 
  
 **MAPIInitialize** (&amp;MAPIINIT); 
  
При объявлении эту структуру MAPI создает отдельный поток обработки окно уведомления, которое продолжается, пока число ссылок initialize становится равным нулю. Службы Windows необходимо задать член **ulflags** структуры **MAPIINIT_0** , на который указывает _lpMapiInit_ для MAPI_NT_SERVICE. 
  
> [!NOTE]
> В функции Win32 **DllMain** или любых других функций, который создает или завершение работы потоков не может вызывать **MAPIInitialize** или **MAPIUninitialize** из. Дополнительные сведения можно [С помощью объектов являющихся потокобезопасными](using-thread-safe-objects.md). 
  
 **MAPIInitialize** не возвращает все расширенные сведения об ошибке. В отличие от большинства вызовов MAPI значения его возвращаемые значения строго определяются в соответствии с конкретной шаг инициализации, завершившихся сбоем. 
  
1. Проверяет, параметры и флаги.
    
    MAPI_E_INVALID_PARAMETER или MAPI_E_UNKNOWN_FLAGS. Вызывающий объект передан недопустимый параметр или флаг.
    
2. Инициализирует разделы реестра, необходимые для MAPI и подтверждает типа операционной системы. Это действие происходит только в том случае, если процесс клиента выполняется как служба под управлением Windows и устанавливает для флага службы MAPI_NT в структуре **MAPIINIT_0** . 
    
    MAPI_E_TOO_COMPLEX. Процесс вызова — это служба Windows и разделы реестра, необходимые для MAPI не удалось инициализировать. 
    
    Дополнительные сведения можно получить в журнале событий приложений.
    
3. Проверка совместимости MAPI с OLE, а затем инициализировать OLE.
    
1. Проверяет совместимость текущей версии OLE и MAPI. 
    
    MAPI_E_VERSION. Версия OLE, установленная на рабочей станции несовместима с этой версией MAPI.
    
2. Инициализирует OLE. 
    
    Во время только этот шаг эта функция может возвращать код ошибки, не перечисленных здесь. Любая ошибка _отсутствует_ в списке здесь должно быть предполагается, что поступают из функции OLE **CoInitialize**.
    
4. Инициализирует каждого процесса глобальных переменных.
    
    MAPI_E_SESSION_LIMIT. MAPI устанавливает контекст для текущего процесса. Ошибки Win16 превышения определенного числа процессов, либо на любой системе если исчерпано доступной памяти.
    
5. Инициализирует общих глобальных переменных всеми процессами.
    
    MAPI_E_NOT_ENOUGH_RESOURCES. Не хватает системных ресурсов, не были доступны для завершения операции.
    
6. Инициализирует обработчик уведомлений, создает его окно и его потока по запросу флаг MAPI_MULTITHREAD_NOTIFICATIONS. 
    
    MAPI_E_INVALID_OBJECT. Может отсутствовать, если исчерпано системных ресурсов. 
    
7. Загружает и инициализирует поставщика профиля. Проверяет, что **MAPIInitialize** можно получить доступ к разделу реестра, где хранятся данные профиля. 
    
    MAPI_E_NOT_INITIALIZED. Поставщик профиля произошла ошибка. 
    
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|ContentsTableListCtrl.cpp  <br/> ||Mfcmapi (en) использует метод **MAPIInitialize** для инициализации MAPI в фоновом потоке обработки некоторые таблицы.  <br/> |
   
## <a name="see-also"></a>См. также



[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

