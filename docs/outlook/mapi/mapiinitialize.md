---
title: MAPIInitialize
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPIInitialize
api_type:
- HeaderDef
ms.assetid: b9584226-79d2-4d83-8f31-dbfbc50f16c5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 6464f16d9ad73b332ff20dc007ef162b9525c6d5
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32346643"
---
# <a name="mapiinitialize"></a>MAPIInitialize

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Увеличивает значение счетчика ссылок подсистемы MAPI и инициализирует глобальные данные для библиотеки MAPI. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Мапикс. h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPIInitialize(
  LPVOID lpMapiInit
);
```

## <a name="parameters"></a>Параметры

 _Лпмапиинит_
  
> возврата Указатель на структуру [MAPIINIT_0](mapiinit_0.md) . Параметру _лпмапиинит_ можно приСВОИТЬ значение null. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Подсистема MAPI инициализирована успешно.
    
## <a name="remarks"></a>Примечания

Функция **мапиинитиализе** увеличивает счетчик ссылок MAPI для подсистемы MAPI, а функция [мапиунинитиализе](mapiuninitialize.md) уменьшает внутренний счетчик ссылок. Таким образом, число вызовов одной функции должно равняться числу вызовов другой. **Мапиинитиализе** ВОЗВРАЩАЕТ значение S_OK, если перед инициализацией MAPI еще не выполнялась инициализация. 
  
Клиент или поставщик услуг должен вызвать **мапиинитиализе** перед выполнением любого другого вызова MAPI. В противном случае вызовы клиента или поставщика услуг приводят к возврату значения МАПИ_Е_НОТ_ИНИТИАЛИЗЕД. 
  
При вызове **мапиинитиализе** из многопоточного приложения задайте для параметра _лпмапиинит_ структуру [MAPIINIT_0](mapiinit_0.md) , которая объявляется следующим образом: 
  
 **MAPIINIT_0** МАПИИНИТ = {0, МАПИ_МУЛТИСРЕАД_НОТИФИКАТИОНС} 
  
и звоните: 
  
 **Мапиинитиализе** (&amp;Мапиинит); 
  
Если эта структура объявлена, MAPI создает отдельный поток для обработки окна уведомления, который продолжается до тех пор, пока значение счетчика ссылок инициализации не станет равно нулю. Служба Windows должна задать элемент **ulflags** структуры **MAPIINIT_0** , на который указывает _лпмапиинит_ , мапи_нт_сервице. 
  
> [!NOTE]
> Вы не можете вызывать **мапиинитиализе** или **Мапиунинитиализе** из функции Win32 **DllMain** или любой другой функции, создающей или завершающей потоки. Более подробную информацию можно узнать [в статье Использование потокобезопасных объектов](using-thread-safe-objects.md). 
  
 **Мапиинитиализе** не возвращает расширенные сведения об ошибке. В отличие от большинства других вызовов MAPI, значения возвращаемых значений строго определяются в соответствии с определенным шагом инициализации, для которого произошел сбой: 
  
1. Проверяет параметры и флаги.
    
    МАПИ_Е_ИНВАЛИД_ПАРАМЕТЕР или МАПИ_Е_УНКНОВН_ФЛАГС. Вызывающий объект передал недопустимый параметр или флаг.
    
2. Инициализирует ключи реестра, необходимые для MAPI, и подтверждает тип операционной системы. Это действие происходит только в том случае, если клиентский процесс выполняется как служба в Windows и устанавливает флаг службы МАПИ_НТ в структуре **MAPIINIT_0** . 
    
    МАПИ_Е_ТУ_КОМПЛЕКС. Процесс вызова — это служба Windows и разделы реестра, необходимые для MAPI, которые не удалось инициализировать. 
    
    Дополнительные сведения можно найти в журнале событий приложений.
    
3. Проверьте совместимость MAPI с OLE, а затем инициализируйте OLE.
    
1. Проверяет совместимость текущих версий OLE и MAPI. 
    
    МАПИ_Е_ВЕРСИОН. Версия OLE, установленная на рабочей станции, несовместима с этой версией MAPI.
    
2. Инициализирует OLE. 
    
    На этом этапе эта функция может возвращать код ошибки, не указанный здесь. Любая ошибка, _не_ указанная в этом разделе, предполагается поступать из функции **CoInitialize**функции OLE.
    
4. Инициализирует глобальные переменные для каждого процесса.
    
    МАПИ_Е_СЕССИОН_ЛИМИТ. MAPI настраивает контекст, характерный для текущего процесса. Ошибки могут возникать на платформе Win16, если количество процессов превышает определенное число или в любой системе, если объем доступной памяти исчерпан.
    
5. Инициализирует общие глобальные переменные для всех процессов.
    
    МАПИ_Е_НОТ_ЕНАУГХ_РЕСАУРЦЕС. Недостаточно системных ресурсов для завершения операции.
    
6. Инициализирует обработчик уведомлений, создает окно и его поток, если это запрошено флагом МАПИ_МУЛТИСРЕАД_НОТИФИКАТИОНС. 
    
    МАПИ_Е_ИНВАЛИД_ОБЖЕКТ. Может привести к сбою, если ресурсы системы исчерпаны. 
    
7. ЗаГружает и Инициализирует поставщика профилей. Проверяет, имеет ли **мапиинитиализе** доступ к разделу реестра, в котором хранятся данные профиля. 
    
    МАПИ_Е_НОТ_ИНИТИАЛИЗЕД. Поставщик профилей обнаружил ошибку. 
    
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Контентстаблелистктрл. cpp  <br/> ||MFCMAPI использует метод **мапиинитиализе** для инициализации MAPI в фоновом потоке для выполнения некоторой обработки таблицы.  <br/> |
   
## <a name="see-also"></a>См. также



[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

