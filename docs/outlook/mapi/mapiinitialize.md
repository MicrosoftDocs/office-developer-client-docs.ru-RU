---
title: MAPIInitialize
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPIInitialize
api_type:
- HeaderDef
ms.assetid: b9584226-79d2-4d83-8f31-dbfbc50f16c5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 6464f16d9ad73b332ff20dc007ef162b9525c6d5
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33411178"
---
# <a name="mapiinitialize"></a>MAPIInitialize

  
  
**Область применения**: Outlook 2013 | Outlook 2016 
  
Прибавка к эталону подсистемы MAPI и инициализация глобальных данных для DLL MAPI. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Mapix.h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPIInitialize(
  LPVOID lpMapiInit
);
```

## <a name="parameters"></a>Parameters

 _lpMapiInit_
  
> [in] Указатель на [MAPIINIT_0](mapiinit_0.md) структуру. Параметр  _lpMapiInit_ можно установить в NULL. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Подсистема MAPI была успешно инициализирована.
    
## <a name="remarks"></a>Примечания

Функция **MAPIInitialize** приумножит количество ссылок MAPI для подсистемы MAPI, а функция [MAPIUninitialize](mapiuninitialize.md) отнимет внутреннее количество ссылок. Таким образом, количество вызовов одной функции должно равняться количеству вызовов другой. **MAPIInitialize** возвращает S_OK, если MAPI не была ранее инициализирована. 
  
Перед другим вызовом MAPI клиент или поставщик услуг должен вызвать **MAPIInitialize.** Если этого не сделать, клиент или поставщик услуг вызовы возвращают MAPI_E_NOT_INITIALIZED значение. 
  
При вызове **MAPIInitialize** из многоуровневого приложения установите параметр _lpMapiInit_ в структуру MAPIINIT_0, которая объявляется следующим образом: [](mapiinit_0.md) 
  
 **MAPIINIT_0** MAPIINIT= { 0, MAPI_MULTITHREAD_NOTIFICATIONS} 
  
и вызов: 
  
 **MAPIInitialize** &amp; (MAPIINIT); 
  
Когда эта структура объявляется, MAPI создает отдельный поток для обработки окна уведомлений, который продолжается до тех пор, пока инициализация отсчета ссылок не опускается до нуля. Служба Windows должна задать **члену ulflags** структуры MAPIINIT_0, на который указывает _lpMapiInit,_ MAPI_NT_SERVICE.  
  
> [!NOTE]
> Вы не можете вызвать **MAPIInitialize** или **MAPIUninitialize** из функции **Win32 DllMain** или любой другой функции, которая создает или прекращает потоки. Дополнительные сведения см. в [Thread-Safe".](using-thread-safe-objects.md) 
  
 **MAPIInitialize** не возвращает расширенные сведения об ошибках. В отличие от большинства других вызовов MAPI значения возвращаемого значения строго определяются в соответствии с определенным этапом неудачной инициализации: 
  
1. Проверяет параметры и флаги.
    
    MAPI_E_INVALID_PARAMETER или MAPI_E_UNKNOWN_FLAGS. Вызываемая передала недействительный параметр или флаг.
    
2. Инициализирует ключи реестра, необходимые MAPI, и подтверждает тип операционной системы. Этот шаг происходит только в том случае, если клиентский процесс запущен в качестве службы Windows и задает флаг службы MAPI_NT службы в **структуре** MAPIINIT_0. 
    
    MAPI_E_TOO_COMPLEX. Процесс вызова — это Windows и не может быть инициализирована служба и ключи реестра, необходимые MAPI. 
    
    Дополнительные сведения могут быть доступны в журнале событий приложения.
    
3. Проверьте совместимость MAPI с OLE, а затем инициализировать OLE.
    
1. Проверка совместимости между текущими версиями OLE и MAPI. 
    
    MAPI_E_VERSION. Версия OLE, установленная на рабочей станции, не совместима с этой версией MAPI.
    
2. Инициализирует OLE. 
    
    Только на этом этапе эта функция может возвращать код ошибки, не указанный здесь. Любая  _ошибка,_ не указанная здесь, должна быть допущена из функции **CoInitialize** OLE.
    
4. Инициализирует глобальные переменные для каждого процесса.
    
    MAPI_E_SESSION_LIMIT. MAPI настраивает контекст, специфический для текущего процесса. В Win16 могут возникать сбои, если количество процессов превышает определенное число, или в любой системе, если доступная память исчерпана.
    
5. Инициализирует общие глобальные переменные всех процессов.
    
    MAPI_E_NOT_ENOUGH_RESOURCES. Для завершения операции было недостаточно ресурсов системы.
    
6. Инициализирует движок уведомлений, создает его окно и его поток по запросу MAPI_MULTITHREAD_NOTIFICATIONS флага. 
    
    MAPI_E_INVALID_OBJECT. Может привести к сбой, если ресурсы системы исчерпаны. 
    
7. Загружает и инициализирует поставщика профилей. Проверяет, что **MAPIInitialize** может получить доступ к ключу реестра, в котором хранятся данные профиля. 
    
    MAPI_E_NOT_INITIALIZED. Поставщик профилей столкнулся с ошибкой. 
    
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|ContentsTableListCtrl.cpp  <br/> ||MFCMAPI использует **метод MAPIInitialize** для инициализации MAPI на фоновом потоке для обработки таблиц.  <br/> |
   
## <a name="see-also"></a>См. также



[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

