---
title: MAPIInitialize
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- MAPIInitialize
api_type:
- HeaderDef
ms.assetid: b9584226-79d2-4d83-8f31-dbfbc50f16c5
description: 'Дата последнего изменения: 9 марта 2015 г.'
ms.openlocfilehash: 6464f16d9ad73b332ff20dc007ef162b9525c6d5
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "33411178"
---
# <a name="mapiinitialize"></a>MAPIInitialize

  
  
**Относится к**: Outlook 2013 | Outlook 2016 
  
Увеличивает значение счетчика ссылок подсистемы MAPI и инициализирует глобальные данные для библиотеки MAPI. 
  
|||
|:-----|:-----|
|Файл заголовка:  <br/> |Мапикс. h  <br/> |
|Реализовано в:  <br/> |MAPI  <br/> |
|Вызывающая сторона:  <br/> |Клиентские приложения  <br/> |
   
```cpp
HRESULT MAPIInitialize(
  LPVOID lpMapiInit
);
```

## <a name="parameters"></a>Параметры

 _лпмапиинит_
  
> возврата Указатель на структуру [MAPIINIT_0](mapiinit_0.md) . Параметру _лпмапиинит_ можно присвоить значение null. 
    
## <a name="return-value"></a>Возвращаемое значение

S_OK 
  
> Подсистема MAPI инициализирована успешно.
    
## <a name="remarks"></a>Примечания

Функция **мапиинитиализе** увеличивает счетчик ссылок MAPI для подсистемы MAPI, а функция [мапиунинитиализе](mapiuninitialize.md) уменьшает внутренний счетчик ссылок. Таким образом, число вызовов одной функции должно равняться числу вызовов другой. **Мапиинитиализе** возвращает S_OK, если перед инициализацией MAPI еще не выполнялась инициализация. 
  
Клиент или поставщик услуг должен вызвать **мапиинитиализе** перед выполнением любого другого вызова MAPI. В противном случае вызовы клиента или поставщика услуг приводят к возврату значения MAPI_E_NOT_INITIALIZED. 
  
При вызове **мапиинитиализе** из многопоточного приложения задайте для параметра _лпмапиинит_ структуру [MAPIINIT_0](mapiinit_0.md) , которая объявляется следующим образом: 
  
 **MAPIINIT_0** МАПИИНИТ = {0, MAPI_MULTITHREAD_NOTIFICATIONS} 
  
и звоните: 
  
 **Мапиинитиализе** (&amp;мапиинит); 
  
Если эта структура объявлена, MAPI создает отдельный поток для обработки окна уведомления, который продолжается до тех пор, пока значение счетчика ссылок инициализации не станет равно нулю. Служба Windows должна задать элемент **ulflags** структуры **MAPIINIT_0** , на которую указывает _лпмапиинит_ , чтобы MAPI_NT_SERVICE. 
  
> [!NOTE]
> Вы не можете вызывать **мапиинитиализе** или **Мапиунинитиализе** из функции Win32 **DllMain** или любой другой функции, создающей или завершающей потоки. Более подробную информацию можно узнать [в статье Использование потокобезопасных объектов](using-thread-safe-objects.md). 
  
 **Мапиинитиализе** не возвращает расширенные сведения об ошибке. В отличие от большинства других вызовов MAPI, значения возвращаемых значений строго определяются в соответствии с определенным шагом инициализации, для которого произошел сбой: 
  
1. Проверяет параметры и флаги.
    
    MAPI_E_INVALID_PARAMETER или MAPI_E_UNKNOWN_FLAGS. Вызывающий объект передал недопустимый параметр или флаг.
    
2. Инициализирует ключи реестра, необходимые для MAPI, и подтверждает тип операционной системы. Это действие происходит только в том случае, если клиентский процесс выполняется как служба в Windows и устанавливает флаг службы MAPI_NT в структуре **MAPIINIT_0** . 
    
    MAPI_E_TOO_COMPLEX. Процесс вызова — это служба Windows и разделы реестра, необходимые для MAPI, которые не удалось инициализировать. 
    
    Дополнительные сведения можно найти в журнале событий приложений.
    
3. Проверьте совместимость MAPI с OLE, а затем инициализируйте OLE.
    
1. Проверяет совместимость текущих версий OLE и MAPI. 
    
    MAPI_E_VERSION. Версия OLE, установленная на рабочей станции, несовместима с этой версией MAPI.
    
2. Инициализирует OLE. 
    
    На этом этапе эта функция может возвращать код ошибки, не указанный здесь. Любая ошибка, _не_ указанная в этом разделе, предполагается поступать из функции **CoInitialize**функции OLE.
    
4. Инициализирует глобальные переменные для каждого процесса.
    
    MAPI_E_SESSION_LIMIT. MAPI настраивает контекст, характерный для текущего процесса. Ошибки могут возникать на платформе Win16, если количество процессов превышает определенное число или в любой системе, если объем доступной памяти исчерпан.
    
5. Инициализирует общие глобальные переменные для всех процессов.
    
    MAPI_E_NOT_ENOUGH_RESOURCES. Недостаточно системных ресурсов для завершения операции.
    
6. Инициализирует обработчик уведомлений, создает окно и его поток, если это запрошено флагом MAPI_MULTITHREAD_NOTIFICATIONS. 
    
    MAPI_E_INVALID_OBJECT. Может привести к сбою, если ресурсы системы исчерпаны. 
    
7. Загружает и Инициализирует поставщика профилей. Проверяет, имеет ли **мапиинитиализе** доступ к разделу реестра, в котором хранятся данные профиля. 
    
    MAPI_E_NOT_INITIALIZED. Поставщик профилей обнаружил ошибку. 
    
## <a name="mfcmapi-reference"></a>Справочные материалы по MFCMAPI

Пример кода MFCMAPI указан в приведенной ниже таблице.
  
|**Файл**|**Функция**|**Примечание**|
|:-----|:-----|:-----|
|Контентстаблелистктрл. cpp  <br/> ||MFCMAPI использует метод **мапиинитиализе** для инициализации MAPI в фоновом потоке для выполнения некоторой обработки таблицы.  <br/> |
   
## <a name="see-also"></a>См. также



[Mfcmapi (en) � �������� ������� ����](mfcmapi-as-a-code-sample.md)

