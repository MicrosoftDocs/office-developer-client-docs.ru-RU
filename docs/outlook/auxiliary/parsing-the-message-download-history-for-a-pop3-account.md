---
title: Анализ журнала скачивания сообщений для учетной записи POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 394e1430-04d6-4d61-be13-eb695309fa73
description: В этом разделе описывается структура BLOB-приложения POP3, который представляет историю скачивания сообщений учетной записи POP3, чтобы определить сообщения, которые были загружены или удалены из этой учетной записи.
ms.openlocfilehash: 44a799f6b6fbe2a2841522c18405149a470b0236
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327769"
---
# <a name="parsing-the-message-download-history-for-a-pop3-account"></a>Анализ журнала скачивания сообщений для учетной записи POP3

В этом разделе описывается структура BLOB-приложения POP3, который представляет историю загрузки сообщений учетной записи POP3, чтобы определить сообщения, которые были загружены или удалены из этой учетной записи.

<a name="OL15Con_AuxRef_ParsingMsgsHistory_WhyParseHistory"> </a>

## <a name="why-parse-the-message-download-history"></a>Зачем проавнозить историю скачивания сообщения?

Поставщик протокола POP для Outlook позволяет пользователям получать и загружать новые сообщения электронной почты на локальном устройстве, а затем оставлять или удалять эти сообщения на почтовом сервере. Когда почтовый клиент проверяет наличие новых сообщений для скачивания, он должен иметь возможность идентифицировать и загружать только новые сообщения для этого почтового ящика. Почтовый клиент сначала использует команду UIDL (Unique ID Listing), чтобы получить карту каждого сообщения, которое когда-либо было доставлено в этот почтовый ящик, с уникальным идентификатором (UID). Клиент также получает историю скачивания сообщений, загруженных или удаленных для почтового ящика на этом клиенте. Используя карту UID сообщения и историю скачивания, клиент может идентифицировать сообщения, отсутствующих в истории, как новые и, следовательно, их следует скачать.
  
Чтобы получить историю скачивания сообщений для почтового ящика:
  
- Выполните действия по поиску истории скачивания сообщений для учетной записи [POP3,](locating-the-message-download-history-for-a-pop3-account.md) чтобы найти свойство [PidTagAttachDataBinary,](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) которое содержит большой двоичный объект (BLOB), представляюящий историю сообщений для учетной записи POP3. 
    
- Прочитайте этот раздел, в котором описывается структура BLOB- и показан пример BLOB-приложения для определения сообщений, загруженных или удаленных для почтового ящика учетной записи POP3.

<a name="OL15Con_AuxRef_ParsingMsgsHistory_BLOBStructure"> </a>

## <a name="pop-blob-structure"></a>Структура BLOB POP

Структура BLOB POP, как описано в таблице 1, начинается с двух  полей, **Version** и **Count,** за которыми следует число тегов ресурсов, каждое из которых о конце null. 
  
**Таблица 1. Структура BLOB-приложения, который представляет историю скачивания сообщений учетной записи POP3**

|**Поле в BLOB**|**Размер**|**Описание**|
|:-----|:-----|:-----|
|**Версия** <br/> |2 байта  <br/> |Должно быть 3 (**PBLOB_VERSION_NUM).**  <br/> |
|**Count** <br/> |2 байта  <br/> |Количество тегов ресурсов в этом BLOB-ресурсе.  <br/> |
|Тег ресурса  <br/> |Переменная  <br/> |0 или более строк UTF-8 с нулью, кодируемых тегами ресурсов. Количество строк, о завершаемом нулом, должно соответствовать **числу.**  <br/> |
   
Каждый тег ресурса указывает операцию, применяемую к сообщению, некоторые метаданные даты и времени, а также кодирует UID сообщения. Формат строки тега ресурса разбит по следующим строкам и более подробно объясняется в таблице 2. 
  
`Ocyyyymmddhhmmssuuu...`
  
**Таблица 2. Структура тега ресурса**

|**Поле в теге ресурса**|**Размер**|**Описание**|
|:-----|:-----|:-----|
| `O` <br/> |1 символ  <br/> |Операция, выполненная с сообщением электронной почты. Значение должно быть "+", "-" или ", которое указывает на успешную операцию получения, удаления или получения &amp; и удаления соответственно.  <br/> |
| `c` <br/> |1 символ  <br/> |Часть содержимого сообщения, задействованного в операции. Значение должно быть ", h" или "b", которое указывает содержимое none, header или body соответственно.  <br/> |
| `yyyy` <br/> |4 символа  <br/> |Год операции из четырех цифр.  <br/> |
| `MM` <br/> |2 символа  <br/> |Месяц операции из двух цифр.  <br/> |
| `dd` <br/> |2 символа  <br/> |Двухзначный день операции.  <br/> |
| `hh` <br/> |2 символа  <br/> |Двухзначный час операции.  <br/> |
| `mm` <br/> |2 символа  <br/> |Двухзначная минута операции.  <br/> |
| `ss` <br/> |2 символа  <br/> |Двухзначная секунда операции.  <br/> |
| `uuu…` <br/> |Переменная длина  <br/> |Закодированный UID сообщения.  <br/> |

<a name="OL15Con_AuxRef_ParsingMsgsHistory_Example"> </a>

## <a name="example"></a>Пример

На рисунке 1 показан пример BLOB-приложения, который представляет историю скачивания сообщений учетной записи POP. 
  
**Рисунок 1. Пример структуры BLOB для истории скачивания сообщений учетной записи POP3**

![Большой двоичный объект для истории загрузки сообщений учетной записи POP3](media/OL15Con_AuxRef_ParsingMsgsHistory_Blob.gif)
  
На основе структуры, описанной в таблицах 1 и 2, этот BLOB-файл представляет историю скачивания 23 сообщений электронной почты.
  
Чтобы проанализировать необработанные UID в каждом теге ресурса, следует помнить, что код UID следует за этой кодикой: символы в UID в основном буквы и цифры, а перед каждым не букво-цифрой стоит символ ASCII "$" (0x24). Поэтому символы ASCII $2d представляют не буквы и цифры "-". На рисунке 2 показан пример первого преобразования необработанных UID в теге ресурсов 1 в представление ASCII, а затем преобразования любых не букв и цифр, предшествующих "$", для получения фактического UID:
  
`0BC535DB-EA63-11E1-A75C-00215AD7BB74`
  
**Рисунок 2. Преобразование необработанных UID в теге ресурса в фактический UID сообщения**

![Преобразование необработанного ИД пользователя в большом двоичном объекте в фактический ИД пользователя сообщения](media/OL15Con_AuxRef_ParsingMsgsHistory_BlobRscTag.gif)
  
Чтобы интерпретировать тег ресурса 1 в этом BLOB-ресурсе, сообщение с UID было успешно извлечено 6 сентября 2012 г. в  `0BC535DB-EA63-11E1-A75C-00215AD7BB74` 13:11:38. 
  
Для этого BLOB-ресурса можно аналогичным образом проаицировать оставшиеся 22 тега ресурсов.
  
## <a name="see-also"></a>См. также
<a name="OL15Con_AuxRef_ParsingMsgsHistory_AdditionalRsc"> </a>

- [Управление скачиванием сообщений для учетных записей POP3](managing-message-downloads-for-pop3-accounts.md)    
- [Поиск журнала скачивания сообщений для учетной записи POP3](locating-the-message-download-history-for-a-pop3-account.md)    
- [Parsing the POP3 UIDL History](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/04/parsing-the-pop3-uidl-history.aspx)
    

