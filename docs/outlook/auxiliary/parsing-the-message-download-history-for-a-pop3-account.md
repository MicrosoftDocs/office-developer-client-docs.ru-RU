---
title: Анализ журнала скачивания сообщений для учетной записи POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 394e1430-04d6-4d61-be13-eb695309fa73
description: В этом разделе описывается структура большого двоичного объекта POP3, представляющего журнал загрузки сообщений учетной записи POP3, для определения сообщений, которые были скачаны или удалены в этой учетной записи.
ms.openlocfilehash: 44a799f6b6fbe2a2841522c18405149a470b0236
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327769"
---
# <a name="parsing-the-message-download-history-for-a-pop3-account"></a>Анализ журнала скачивания сообщений для учетной записи POP3

В этом разделе описывается структура большого двоичного объекта POP3, представляющего журнал загрузки сообщений учетной записи POP3, для определения сообщений, которые были скачаны или удалены в этой учетной записи.

<a name="OL15Con_AuxRef_ParsingMsgsHistory_WhyParseHistory"> </a>

## <a name="why-parse-the-message-download-history"></a>Зачем анализировать журнал загрузки сообщений?

Поставщик услуг POP (Post Office Protocol) для Outlook позволяет пользователям получать и загружать новые сообщения электронной почты на их локальных устройствах, а затем оставлять и удалять эти сообщения на почтовом сервере. Когда почтовый клиент проверяет, нужно ли загружать новые сообщения, он должен иметь возможность определять и загружать только новые сообщения для папки "Входящие". Почтовый клиент выполняет это сначала с помощью команды UIDL (уникальный идентификатор), чтобы получить карту каждого сообщения, которое когда-либо было доставлено в папку "Входящие", в уникальный идентификатор (UID). Кроме того, клиент получает журнал загрузки сообщений для сообщений, которые были скачаны или удалены из папки "Входящие" этого клиента. После этого клиент может определить, что эти сообщения отсутствуют в журнале как новые и, следовательно, будут скачаны с помощью журнала UID и журнала.
  
Чтобы получить журнал загрузки сообщений для папки "Входящие", выполните следующие действия.
  
- Выполните действия, описанные в статье [Поиск журнала загрузки сообщений для учетной записи POP3](locating-the-message-download-history-for-a-pop3-account.md) , чтобы найти свойство [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) , которое содержит большой ДВОИЧный объект (BLOB-объект), представляющий журнал сообщений для учетной записи POP3. 
    
- Прочтите этот раздел, в котором описывается структура большого двоичного объекта, и показан пример большого двоичного объекта для идентификации сообщений, которые были скачаны или удалены из папки "Входящие" учетной записи POP3.

<a name="OL15Con_AuxRef_ParsingMsgsHistory_BLOBStructure"> </a>

## <a name="pop-blob-structure"></a>Структура большого двоичного объекта POP

Структура большого двоичного объекта POP, как описано в таблице 1, начинается с двух полей, **версий** и **счетчиков**, за которыми **следует количество тегов** ресурсов, каждое из которых завершается нулем. 
  
**Таблица 1. Структура большого двоичного объекта, представляющего журнал загрузки сообщений учетной записи POP3**

|**Поле в большом двоичном объекте**|**Размер**|**Описание**|
|:-----|:-----|:-----|
|**Версия** <br/> |2 байта  <br/> |Должно быть 3 (**PBLOB_VERSION_NUM**).  <br/> |
|**Count** <br/> |2 байта  <br/> |Количество тегов ресурсов в этом большом двоичном объекте.  <br/> |
|Тег ресурса  <br/> |Переменная  <br/> |0 или несколько строк UTF 8, заканчивающихся нулем, которые закодируются Теги ресурса. Количество строк, заканчивающихся нулем, должно быть равно **Count**.  <br/> |
   
Каждый тег ресурса указывает операцию, которая применяется к сообщению, некоторые метаданные даты и времени, связанные с операцией, и кодирует идентификатор сообщения. Формат строки тега ресурса разбит на приведенный ниже код и более подробно описывается в таблице 2. 
  
`Ocyyyymmddhhmmssuuu...`
  
**Таблица 2. Структура тега ресурса**

|**Поле в теге ресурса**|**Размер**|**Описание**|
|:-----|:-----|:-----|
| `O` <br/> |1 символ  <br/> |Операция, выполняемая над сообщением электронной почты. Значение должно быть "+", "–" или "&amp;", которое указывает на успешную операцию получения, удаления или получения и удаления соответственно.  <br/> |
| `c` <br/> |1 символ  <br/> |Часть содержимого сообщения, участвующего в операции. Значение должно быть "", "h" или "b", которое указывает на содержимое None, Header или Body соответственно.  <br/> |
| `yyyy` <br/> |4 символа  <br/> |Год операции из четырех цифр.  <br/> |
| `MM` <br/> |2 символа  <br/> |Месяц операции, состоящих из двух цифр.  <br/> |
| `dd` <br/> |2 символа  <br/> |День операции, состоящих из двух цифр.  <br/> |
| `hh` <br/> |2 символа  <br/> |Двузначное значение часа операции.  <br/> |
| `mm` <br/> |2 символа  <br/> |Двузначное число минут операции.  <br/> |
| `ss` <br/> |2 символа  <br/> |Двузначное значение секунды операции.  <br/> |
| `uuu…` <br/> |Переменная длина  <br/> |Закодированный UID сообщения.  <br/> |

<a name="OL15Con_AuxRef_ParsingMsgsHistory_Example"> </a>

## <a name="example"></a>Пример

На рисунке 1 показан пример большого двоичного объекта, представляющего журнал загрузки сообщений учетной записи POP. 
  
**Рис. 1. Пример структуры больших двоичных объектов для журнала загрузки сообщений учетной записи POP3**

![Большой двоичный объект для истории загрузки сообщений учетной записи POP3](media/OL15Con_AuxRef_ParsingMsgsHistory_Blob.gif)
  
В зависимости от структуры, описанной в таблице 1 и таблице 2, этот большой двоичный объект представляет историю скачивания 23 сообщений электронной почты.
  
Чтобы проанализировать необработанный идентификатор UID в каждом теге ресурса, следует учитывать, что идентификатор UID соответствует этой кодировке: символы в идентификаторе UID — это буквы, отличные от буквенно-цифровых символов, и каждому символу, не являющемуся буквенно-цифровым, предшествует символ "$" (0x24). Таким образом, символы ASCII $2D представляют символ "-", отличный от буквенно-цифрового. На рисунке 2 показано, как сначала преобразовать необработанный идентификатор UID в тег ресурса 1 в представление ASCII, а затем преобразовать любой символ, отличный от буквенно-цифрового, на "$", чтобы создать фактическое значение UID:
  
`0BC535DB-EA63-11E1-A75C-00215AD7BB74`
  
**Рис. 2. Преобразование необработанного UID в теге ресурса в фактический идентификатор UID сообщения**

![Преобразование необработанного ИД пользователя в большом двоичном объекте в фактический ИД пользователя сообщения](media/OL15Con_AuxRef_ParsingMsgsHistory_BlobRscTag.gif)
  
Чтобы интерпретировать тег ресурса 1 в этом большом двоичном объекте: сообщение с идентификатором UID `0BC535DB-EA63-11E1-A75C-00215AD7BB74` было успешно получено 6 сентября 2012 по адресу 13:11:38. 
  
Подобным образом можно проанализировать оставшиеся 22-Теги ресурсов для этого большого двоичного объекта.
  
## <a name="see-also"></a>См. также
<a name="OL15Con_AuxRef_ParsingMsgsHistory_AdditionalRsc"> </a>

- [Управление скачиванием сообщений для учетных записей POP3](managing-message-downloads-for-pop3-accounts.md)    
- [Поиск журнала скачивания сообщений для учетной записи POP3](locating-the-message-download-history-for-a-pop3-account.md)    
- [Анализ журнала протокола POP3 UIDL](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/04/parsing-the-pop3-uidl-history.aspx)
    

