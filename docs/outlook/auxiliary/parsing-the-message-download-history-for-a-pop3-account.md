---
title: Анализ журнала скачивания сообщений для учетной записи POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 394e1430-04d6-4d61-be13-eb695309fa73
description: В этом разделе описывается структура BLOB POP3, представляют историю скачивания сообщений учетной записи POP3, чтобы определить сообщения, которые были загружены или удалены в этой учетной записи.
ms.openlocfilehash: 44a799f6b6fbe2a2841522c18405149a470b0236
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327769"
---
# <a name="parsing-the-message-download-history-for-a-pop3-account"></a>Анализ журнала скачивания сообщений для учетной записи POP3

В этом разделе описывается структура BLOB POP3, представляют историю скачивания сообщений учетной записи POP3, чтобы определить сообщения, которые были загружены или удалены в этой учетной записи.

<a name="OL15Con_AuxRef_ParsingMsgsHistory_WhyParseHistory"> </a>

## <a name="why-parse-the-message-download-history"></a>Зачем обсмеивать историю скачивания сообщений?

Поставщик протокола Office (POP) для Outlook позволяет пользователям извлекать и загружать новые сообщения электронной почты на локальном устройстве, а затем оставлять или удалять эти сообщения электронной почты на почтовом сервере. Когда почтовый клиент проверяет загрузку новых сообщений, он должен иметь возможность идентифицировать и скачивать только новые сообщения для этого почтового ящика. Почтовый клиент сначала использует команду UIDL (Unique ID Listing) для получения карты каждого сообщения, которое когда-либо доставлялось в этот почтовый ящик уникальному идентификатору (UID). Клиент также получает историю скачивания сообщений для сообщений, которые были загружены или удалены для почтового ящика на этом клиенте. Используя карту UID сообщения и историю скачивания, клиент может идентифицировать те сообщения, которые отсутствуют в истории, как новые и, следовательно, должны быть загружены.
  
Чтобы получить историю скачивания сообщений для почтового ящика:
  
- Выполните действия по поиску истории скачивания сообщений для учетной записи [POP3,](locating-the-message-download-history-for-a-pop3-account.md) чтобы найти свойство [PidTagAttachDataBinary,](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) содержающее двоичный большой объект (BLOB), представляюющий историю сообщений для учетной записи POP3. 
    
- Ознакомьтесь с этой статьей, описываемой структурой BLOB, и показано в примере BLOB для определения сообщений, которые были загружены или удалены для почтового ящика учетной записи POP3.

<a name="OL15Con_AuxRef_ParsingMsgsHistory_BLOBStructure"> </a>

## <a name="pop-blob-structure"></a>Структура BLOB POP

Структура BLOB POP, как описано в таблице 1, начинается с двух  полей **, Версии** и Графа, а затем количество тегов ресурсов Count, каждое из которых является null-terminated.  
  
**Таблица 1. Структура BLOB, представляют историю скачивания сообщений учетной записи POP3**

|**Поле в BLOB**|**Размер**|**Описание**|
|:-----|:-----|:-----|
|**Версия** <br/> |2 байта  <br/> |Должно быть 3 **(PBLOB_VERSION_NUM).**  <br/> |
|**Count** <br/> |2 байта  <br/> |Количество тегов ресурсов в этом BLOB.  <br/> |
|Тег ресурса  <br/> |Переменная  <br/> |0 или более null-terminated строк UTF-8, кодируемых тегами ресурсов. Количество строк с null-terminated должно соответствовать **графу**.  <br/> |
   
Каждый тег ресурса указывает операцию, которая применяется к сообщению, некоторые метаданные времени даты об операции, и кодирует UID сообщения. Формат строки тегов ресурсов разбит следующим образом и далее объясняется в таблице 2. 
  
`Ocyyyymmddhhmmssuuu...`
  
**Таблица 2. Структура тега ресурса**

|**Поле в теге ресурса**|**Размер**|**Описание**|
|:-----|:-----|:-----|
| `O` <br/> |1 символ  <br/> |Операция, выполненная в сообщении электронной почты. Значение должно быть "+", "-" или ", что указывает на успешную операцию получения, удаления или &amp; удаления, соответственно.  <br/> |
| `c` <br/> |1 символ  <br/> |Часть контента сообщения, задействованного в операции. Значение должно быть ", "h" или "b", что указывает содержимое нет, заголовка или тела, соответственно.  <br/> |
| `yyyy` <br/> |4 символа  <br/> |Четырехзначный год операции.  <br/> |
| `MM` <br/> |2 символа  <br/> |Двухзначный месяц операции.  <br/> |
| `dd` <br/> |2 символа  <br/> |Двухзначный день операции.  <br/> |
| `hh` <br/> |2 символа  <br/> |Двухзначный час операции.  <br/> |
| `mm` <br/> |2 символа  <br/> |Двухзначная минута операции.  <br/> |
| `ss` <br/> |2 символа  <br/> |Двухзначная секунда операции.  <br/> |
| `uuu…` <br/> |Переменная длина  <br/> |Закодированный UID сообщения.  <br/> |

<a name="OL15Con_AuxRef_ParsingMsgsHistory_Example"> </a>

## <a name="example"></a>Пример

На рисунке 1 показан пример BLOB, представляют историю скачивания сообщений учетной записи POP. 
  
**Рис. 1. Пример структуры BLOB для истории скачивания сообщений учетной записи POP3**

![Большой двоичный объект для истории загрузки сообщений учетной записи POP3](media/OL15Con_AuxRef_ParsingMsgsHistory_Blob.gif)
  
На основе структуры, описанной в таблице 1 и таблице 2, эта BLOB представляет историю скачивания 23 сообщений электронной почты.
  
Чтобы разузнать необработанные UID в каждом теге ресурсов, следует помнить, что код UID следует за этим кодом: символы в UID в основном являются альфа-числительными символами, а каждому неальфа числовому символу предшествует символ ASCII "$" (0x24). Таким образом, символы ASCII $ 2d представляют не-альфанумерный символ "-". На рисунке 2 показан пример первого преобразования необработанных UID в теге ресурсов 1 в представление ASCII, а затем преобразования любого символа, не относяющегося к альфа-числуме, предшествующего "$", для создания фактического UID:
  
`0BC535DB-EA63-11E1-A75C-00215AD7BB74`
  
**Рис. 2. Преобразование необработанных UID в тег ресурса в фактический UID сообщений**

![Преобразование необработанного ИД пользователя в большом двоичном объекте в фактический ИД пользователя сообщения](media/OL15Con_AuxRef_ParsingMsgsHistory_BlobRscTag.gif)
  
Чтобы интерпретировать тег ресурса 1 в этом BLOB: сообщение с UID было успешно извлечено 6 сентября 2012 г. в  `0BC535DB-EA63-11E1-A75C-00215AD7BB74` 13:11:38. 
  
Аналогичным образом можно размыть оставшиеся 22 тега ресурсов для этого BLOB.
  
## <a name="see-also"></a>См. также
<a name="OL15Con_AuxRef_ParsingMsgsHistory_AdditionalRsc"> </a>

- [Управление скачиванием сообщений для учетных записей POP3](managing-message-downloads-for-pop3-accounts.md)    
- [Поиск журнала скачивания сообщений для учетной записи POP3](locating-the-message-download-history-for-a-pop3-account.md)    
- [Размыв истории UIDL POP3](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/04/parsing-the-pop3-uidl-history.aspx)
    

