---
title: Анализ журнала скачивания сообщений для учетной записи POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 394e1430-04d6-4d61-be13-eb695309fa73
description: В этом разделе описывается структура большого двоичного объекта POP3, представляющего журнал загрузки сообщений учетной записи POP3, для определения сообщений, которые были скачаны или удалены в этой учетной записи.
ms.openlocfilehash: 44a799f6b6fbe2a2841522c18405149a470b0236
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327769"
---
# <a name="parsing-the-message-download-history-for-a-pop3-account"></a><span data-ttu-id="dd61b-103">Анализ журнала скачивания сообщений для учетной записи POP3</span><span class="sxs-lookup"><span data-stu-id="dd61b-103">Parsing the message download history for a POP3 account</span></span>

<span data-ttu-id="dd61b-104">В этом разделе описывается структура большого двоичного объекта POP3, представляющего журнал загрузки сообщений учетной записи POP3, для определения сообщений, которые были скачаны или удалены в этой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="dd61b-104">This topic describes the structure of the POP3 BLOB that represents the message download history of a POP3 account, to identify the messages that have been downloaded or deleted on that account.</span></span>

<span data-ttu-id="dd61b-105"><a name="OL15Con_AuxRef_ParsingMsgsHistory_WhyParseHistory"> </a></span><span class="sxs-lookup"><span data-stu-id="dd61b-105"><a name="OL15Con_AuxRef_ParsingMsgsHistory_WhyParseHistory"> </a></span></span>

## <a name="why-parse-the-message-download-history"></a><span data-ttu-id="dd61b-106">Зачем анализировать журнал загрузки сообщений?</span><span class="sxs-lookup"><span data-stu-id="dd61b-106">Why parse the message download history?</span></span>

<span data-ttu-id="dd61b-107">Поставщик услуг POP (Post Office Protocol) для Outlook позволяет пользователям получать и загружать новые сообщения электронной почты на их локальных устройствах, а затем оставлять и удалять эти сообщения на почтовом сервере.</span><span class="sxs-lookup"><span data-stu-id="dd61b-107">The Post Office Protocol (POP) provider for Outlook allows users to retrieve and download new email messages on their local device, and subsequently to leave or delete these email messages on the mail server.</span></span> <span data-ttu-id="dd61b-108">Когда почтовый клиент проверяет, нужно ли загружать новые сообщения, он должен иметь возможность определять и загружать только новые сообщения для папки "Входящие".</span><span class="sxs-lookup"><span data-stu-id="dd61b-108">When the mail client checks for new messages to download, it has to be able to identify and download only the new messages for that Inbox.</span></span> <span data-ttu-id="dd61b-109">Почтовый клиент выполняет это сначала с помощью команды UIDL (уникальный идентификатор), чтобы получить карту каждого сообщения, которое когда-либо было доставлено в папку "Входящие", в уникальный идентификатор (UID).</span><span class="sxs-lookup"><span data-stu-id="dd61b-109">The mail client does this by first using the UIDL (Unique ID Listing) command to obtain a map of each message that has ever been delivered to that Inbox to a unique identifier (UID).</span></span> <span data-ttu-id="dd61b-110">Кроме того, клиент получает журнал загрузки сообщений для сообщений, которые были скачаны или удалены из папки "Входящие" этого клиента.</span><span class="sxs-lookup"><span data-stu-id="dd61b-110">The client also gets the message download history for messages that have been downloaded or deleted for the Inbox on that client.</span></span> <span data-ttu-id="dd61b-111">После этого клиент может определить, что эти сообщения отсутствуют в журнале как новые и, следовательно, будут скачаны с помощью журнала UID и журнала.</span><span class="sxs-lookup"><span data-stu-id="dd61b-111">Using the message UID map and download history, the client can then identify those messages that are absent from the history as new and, hence, should be downloaded.</span></span>
  
<span data-ttu-id="dd61b-112">Чтобы получить журнал загрузки сообщений для папки "Входящие", выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="dd61b-112">To get the messages download history for an Inbox:</span></span>
  
- <span data-ttu-id="dd61b-113">Выполните действия, описанные в статье [Поиск журнала загрузки сообщений для учетной записи POP3](locating-the-message-download-history-for-a-pop3-account.md) , чтобы найти свойство [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) , которое содержит большой ДВОИЧный объект (BLOB-объект), представляющий журнал сообщений для учетной записи POP3.</span><span class="sxs-lookup"><span data-stu-id="dd61b-113">Follow the steps in [Locating the message download history for a POP3 account](locating-the-message-download-history-for-a-pop3-account.md) to find the [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) property, which contains a binary large object (BLOB) that represents the message history for a POP3 account.</span></span> 
    
- <span data-ttu-id="dd61b-114">Прочтите этот раздел, в котором описывается структура большого двоичного объекта, и показан пример большого двоичного объекта для идентификации сообщений, которые были скачаны или удалены из папки "Входящие" учетной записи POP3.</span><span class="sxs-lookup"><span data-stu-id="dd61b-114">Read this topic, which describes the structure of the BLOB, and shows an example BLOB to identify messages that have been downloaded or deleted for the Inbox of the POP3 account.</span></span>

<span data-ttu-id="dd61b-115"><a name="OL15Con_AuxRef_ParsingMsgsHistory_BLOBStructure"> </a></span><span class="sxs-lookup"><span data-stu-id="dd61b-115"><a name="OL15Con_AuxRef_ParsingMsgsHistory_BLOBStructure"> </a></span></span>

## <a name="pop-blob-structure"></a><span data-ttu-id="dd61b-116">Структура большого двоичного объекта POP</span><span class="sxs-lookup"><span data-stu-id="dd61b-116">POP BLOB structure</span></span>

<span data-ttu-id="dd61b-117">Структура большого двоичного объекта POP, как описано в таблице 1, начинается с двух полей, **версий** и **счетчиков**, за которыми **следует количество тегов** ресурсов, каждое из которых завершается нулем.</span><span class="sxs-lookup"><span data-stu-id="dd61b-117">The POP BLOB structure, as described in Table 1, begins with two fields, **Version** and **Count**, followed by a **Count** number of resource tags, each of which is null-terminated.</span></span> 
  
<span data-ttu-id="dd61b-118">**Таблица 1. Структура большого двоичного объекта, представляющего журнал загрузки сообщений учетной записи POP3**</span><span class="sxs-lookup"><span data-stu-id="dd61b-118">**Table 1. Structure of the BLOB that represents the message download history of a POP3 account**</span></span>

|<span data-ttu-id="dd61b-119">**Поле в большом двоичном объекте**</span><span class="sxs-lookup"><span data-stu-id="dd61b-119">**Field in BLOB**</span></span>|<span data-ttu-id="dd61b-120">**Размер**</span><span class="sxs-lookup"><span data-stu-id="dd61b-120">**Size**</span></span>|<span data-ttu-id="dd61b-121">**Описание**</span><span class="sxs-lookup"><span data-stu-id="dd61b-121">**Description**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="dd61b-122">**Версия**</span><span class="sxs-lookup"><span data-stu-id="dd61b-122">**Version**</span></span> <br/> |<span data-ttu-id="dd61b-123">2 байта</span><span class="sxs-lookup"><span data-stu-id="dd61b-123">2 bytes</span></span>  <br/> |<span data-ttu-id="dd61b-124">Должно быть 3 (**PBLOB_VERSION_NUM**).</span><span class="sxs-lookup"><span data-stu-id="dd61b-124">Must be 3 (**PBLOB_VERSION_NUM**).</span></span>  <br/> |
|<span data-ttu-id="dd61b-125">**Count**</span><span class="sxs-lookup"><span data-stu-id="dd61b-125">**Count**</span></span> <br/> |<span data-ttu-id="dd61b-126">2 байта</span><span class="sxs-lookup"><span data-stu-id="dd61b-126">2 bytes</span></span>  <br/> |<span data-ttu-id="dd61b-127">Количество тегов ресурсов в этом большом двоичном объекте.</span><span class="sxs-lookup"><span data-stu-id="dd61b-127">The number of resource tags in this BLOB.</span></span>  <br/> |
|<span data-ttu-id="dd61b-128">Тег ресурса</span><span class="sxs-lookup"><span data-stu-id="dd61b-128">Resource tag</span></span>  <br/> |<span data-ttu-id="dd61b-129">Переменная</span><span class="sxs-lookup"><span data-stu-id="dd61b-129">Variable</span></span>  <br/> |<span data-ttu-id="dd61b-130">0 или несколько строк UTF 8, заканчивающихся нулем, которые закодируются Теги ресурса.</span><span class="sxs-lookup"><span data-stu-id="dd61b-130">0 or more null-terminated UTF-8 strings that encode the resource tags.</span></span> <span data-ttu-id="dd61b-131">Количество строк, заканчивающихся нулем, должно быть равно **Count**.</span><span class="sxs-lookup"><span data-stu-id="dd61b-131">The number of null-terminated strings must match **Count**.</span></span>  <br/> |
   
<span data-ttu-id="dd61b-132">Каждый тег ресурса указывает операцию, которая применяется к сообщению, некоторые метаданные даты и времени, связанные с операцией, и кодирует идентификатор сообщения.</span><span class="sxs-lookup"><span data-stu-id="dd61b-132">Each resource tag specifies the operation that is applied to a message, some date-time metadata about the operation, and encodes the UID of the message.</span></span> <span data-ttu-id="dd61b-133">Формат строки тега ресурса разбит на приведенный ниже код и более подробно описывается в таблице 2.</span><span class="sxs-lookup"><span data-stu-id="dd61b-133">The format of a resource tag string is broken down as follows, and is further explained in Table 2.</span></span> 
  
`Ocyyyymmddhhmmssuuu...`
  
<span data-ttu-id="dd61b-134">**Таблица 2. Структура тега ресурса**</span><span class="sxs-lookup"><span data-stu-id="dd61b-134">**Table 2. Structure of a resource tag**</span></span>

|<span data-ttu-id="dd61b-135">**Поле в теге ресурса**</span><span class="sxs-lookup"><span data-stu-id="dd61b-135">**Field in a resource tag**</span></span>|<span data-ttu-id="dd61b-136">**Размер**</span><span class="sxs-lookup"><span data-stu-id="dd61b-136">**Size**</span></span>|<span data-ttu-id="dd61b-137">**Описание**</span><span class="sxs-lookup"><span data-stu-id="dd61b-137">**Description**</span></span>|
|:-----|:-----|:-----|
| `O` <br/> |<span data-ttu-id="dd61b-138">1 символ</span><span class="sxs-lookup"><span data-stu-id="dd61b-138">1 character</span></span>  <br/> |<span data-ttu-id="dd61b-139">Операция, выполняемая над сообщением электронной почты.</span><span class="sxs-lookup"><span data-stu-id="dd61b-139">The operation performed on the email message.</span></span> <span data-ttu-id="dd61b-140">Значение должно быть "+", "–" или "&amp;", которое указывает на успешную операцию получения, удаления или получения и удаления соответственно.</span><span class="sxs-lookup"><span data-stu-id="dd61b-140">The value must be "+", "-", or "&amp;", which indicates a successful get, delete, or get-and-delete operation, respectively.</span></span>  <br/> |
| `c` <br/> |<span data-ttu-id="dd61b-141">1 символ</span><span class="sxs-lookup"><span data-stu-id="dd61b-141">1 character</span></span>  <br/> |<span data-ttu-id="dd61b-142">Часть содержимого сообщения, участвующего в операции.</span><span class="sxs-lookup"><span data-stu-id="dd61b-142">The part of the message content involved in the operation.</span></span> <span data-ttu-id="dd61b-143">Значение должно быть "", "h" или "b", которое указывает на содержимое None, Header или Body соответственно.</span><span class="sxs-lookup"><span data-stu-id="dd61b-143">The value must be " ", "h", or "b", which indicates the content of none, header, or body, respectively.</span></span>  <br/> |
| `yyyy` <br/> |<span data-ttu-id="dd61b-144">4 символа</span><span class="sxs-lookup"><span data-stu-id="dd61b-144">4 characters</span></span>  <br/> |<span data-ttu-id="dd61b-145">Год операции из четырех цифр.</span><span class="sxs-lookup"><span data-stu-id="dd61b-145">The four-digit year of the operation.</span></span>  <br/> |
| `MM` <br/> |<span data-ttu-id="dd61b-146">2 символа</span><span class="sxs-lookup"><span data-stu-id="dd61b-146">2 characters</span></span>  <br/> |<span data-ttu-id="dd61b-147">Месяц операции, состоящих из двух цифр.</span><span class="sxs-lookup"><span data-stu-id="dd61b-147">The two-digit month of the operation.</span></span>  <br/> |
| `dd` <br/> |<span data-ttu-id="dd61b-148">2 символа</span><span class="sxs-lookup"><span data-stu-id="dd61b-148">2 characters</span></span>  <br/> |<span data-ttu-id="dd61b-149">День операции, состоящих из двух цифр.</span><span class="sxs-lookup"><span data-stu-id="dd61b-149">The two-digit day of the operation.</span></span>  <br/> |
| `hh` <br/> |<span data-ttu-id="dd61b-150">2 символа</span><span class="sxs-lookup"><span data-stu-id="dd61b-150">2 characters</span></span>  <br/> |<span data-ttu-id="dd61b-151">Двузначное значение часа операции.</span><span class="sxs-lookup"><span data-stu-id="dd61b-151">The two-digit hour of the operation.</span></span>  <br/> |
| `mm` <br/> |<span data-ttu-id="dd61b-152">2 символа</span><span class="sxs-lookup"><span data-stu-id="dd61b-152">2 characters</span></span>  <br/> |<span data-ttu-id="dd61b-153">Двузначное число минут операции.</span><span class="sxs-lookup"><span data-stu-id="dd61b-153">The two-digit minute of the operation.</span></span>  <br/> |
| `ss` <br/> |<span data-ttu-id="dd61b-154">2 символа</span><span class="sxs-lookup"><span data-stu-id="dd61b-154">2 characters</span></span>  <br/> |<span data-ttu-id="dd61b-155">Двузначное значение секунды операции.</span><span class="sxs-lookup"><span data-stu-id="dd61b-155">The two-digit second of the operation.</span></span>  <br/> |
| `uuu…` <br/> |<span data-ttu-id="dd61b-156">Переменная длина</span><span class="sxs-lookup"><span data-stu-id="dd61b-156">Variable length</span></span>  <br/> |<span data-ttu-id="dd61b-157">Закодированный UID сообщения.</span><span class="sxs-lookup"><span data-stu-id="dd61b-157">The encoded UID of a message.</span></span>  <br/> |

<span data-ttu-id="dd61b-158"><a name="OL15Con_AuxRef_ParsingMsgsHistory_Example"> </a></span><span class="sxs-lookup"><span data-stu-id="dd61b-158"><a name="OL15Con_AuxRef_ParsingMsgsHistory_Example"> </a></span></span>

## <a name="example"></a><span data-ttu-id="dd61b-159">Пример</span><span class="sxs-lookup"><span data-stu-id="dd61b-159">Example</span></span>

<span data-ttu-id="dd61b-160">На рисунке 1 показан пример большого двоичного объекта, представляющего журнал загрузки сообщений учетной записи POP.</span><span class="sxs-lookup"><span data-stu-id="dd61b-160">Figure 1 shows an example of a BLOB that represents the message download history of a POP account.</span></span> 
  
<span data-ttu-id="dd61b-161">**Рис. 1. Пример структуры больших двоичных объектов для журнала загрузки сообщений учетной записи POP3**</span><span class="sxs-lookup"><span data-stu-id="dd61b-161">**Figure 1. Example BLOB structure for the message download history of a POP3 account**</span></span>

![Большой двоичный объект для истории загрузки сообщений учетной записи POP3](media/OL15Con_AuxRef_ParsingMsgsHistory_Blob.gif)
  
<span data-ttu-id="dd61b-163">В зависимости от структуры, описанной в таблице 1 и таблице 2, этот большой двоичный объект представляет историю скачивания 23 сообщений электронной почты.</span><span class="sxs-lookup"><span data-stu-id="dd61b-163">Based on the structure described in Table 1 and Table 2, this BLOB represents the download history of 23 email messages.</span></span>
  
<span data-ttu-id="dd61b-164">Чтобы проанализировать необработанный идентификатор UID в каждом теге ресурса, следует учитывать, что идентификатор UID соответствует этой кодировке: символы в идентификаторе UID — это буквы, отличные от буквенно-цифровых символов, и каждому символу, не являющемуся буквенно-цифровым, предшествует символ "$" (0x24).</span><span class="sxs-lookup"><span data-stu-id="dd61b-164">To parse the raw UID in each resource tag, be aware that the UID follows this encoding: characters in a UID are mostly alphanumeric characters, and each non-alphanumeric character is preceded by the ASCII character "$" (0x24).</span></span> <span data-ttu-id="dd61b-165">Таким образом, символы ASCII $2D представляют символ "-", отличный от буквенно-цифрового.</span><span class="sxs-lookup"><span data-stu-id="dd61b-165">So the ASCII characters $2d represent the non-alphanumeric character "-".</span></span> <span data-ttu-id="dd61b-166">На рисунке 2 показано, как сначала преобразовать необработанный идентификатор UID в тег ресурса 1 в представление ASCII, а затем преобразовать любой символ, отличный от буквенно-цифрового, на "$", чтобы создать фактическое значение UID:</span><span class="sxs-lookup"><span data-stu-id="dd61b-166">Figure 2 shows an example of first converting the raw UID in resource tag 1 to the ASCII representation, then converting any non-alphanumeric character preceded by "$" to produce the actual UID:</span></span>
  
`0BC535DB-EA63-11E1-A75C-00215AD7BB74`
  
<span data-ttu-id="dd61b-167">**Рис. 2. Преобразование необработанного UID в теге ресурса в фактический идентификатор UID сообщения**</span><span class="sxs-lookup"><span data-stu-id="dd61b-167">**Figure 2. Converting the raw UID in a resource tag to the actual message UID**</span></span>

![Преобразование необработанного ИД пользователя в большом двоичном объекте в фактический ИД пользователя сообщения](media/OL15Con_AuxRef_ParsingMsgsHistory_BlobRscTag.gif)
  
<span data-ttu-id="dd61b-169">Чтобы интерпретировать тег ресурса 1 в этом большом двоичном объекте: сообщение с идентификатором UID `0BC535DB-EA63-11E1-A75C-00215AD7BB74` было успешно получено 6 сентября 2012 по адресу 13:11:38.</span><span class="sxs-lookup"><span data-stu-id="dd61b-169">To interpret resource tag 1 in this BLOB: the message with the UID  `0BC535DB-EA63-11E1-A75C-00215AD7BB74` was successfully retrieved on September 6, 2012, at 13:11:38.</span></span> 
  
<span data-ttu-id="dd61b-170">Подобным образом можно проанализировать оставшиеся 22-Теги ресурсов для этого большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="dd61b-170">You can similarly parse the remaining 22 resource tags for that BLOB.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="dd61b-171">См. также</span><span class="sxs-lookup"><span data-stu-id="dd61b-171">See also</span></span>
<span data-ttu-id="dd61b-172"><a name="OL15Con_AuxRef_ParsingMsgsHistory_AdditionalRsc"> </a></span><span class="sxs-lookup"><span data-stu-id="dd61b-172"><a name="OL15Con_AuxRef_ParsingMsgsHistory_AdditionalRsc"> </a></span></span>

- [<span data-ttu-id="dd61b-173">Управление скачиванием сообщений для учетных записей POP3</span><span class="sxs-lookup"><span data-stu-id="dd61b-173">Managing message downloads for POP3 accounts</span></span>](managing-message-downloads-for-pop3-accounts.md)    
- [<span data-ttu-id="dd61b-174">Поиск журнала скачивания сообщений для учетной записи POP3</span><span class="sxs-lookup"><span data-stu-id="dd61b-174">Locating the message download history for a POP3 account</span></span>](locating-the-message-download-history-for-a-pop3-account.md)    
- [<span data-ttu-id="dd61b-175">Анализ журнала протокола POP3 UIDL</span><span class="sxs-lookup"><span data-stu-id="dd61b-175">Parsing the POP3 UIDL History</span></span>](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/04/parsing-the-pop3-uidl-history.aspx)
    

