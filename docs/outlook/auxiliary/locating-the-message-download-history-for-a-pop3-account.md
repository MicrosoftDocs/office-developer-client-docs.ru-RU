---
title: Поиск журнала скачивания сообщений для учетной записи POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 90a51150-5c2c-4d5b-8717-5dacc8532744
description: В этом разделе описывается, как почтовый клиент может получить доступ к свойству PidTagAttachDataBinary для получения истории скачивания сообщений для учетной записи POP3.
ms.openlocfilehash: ae12a044098aa4f42e1c2e5936e82da3d7a128dd
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321877"
---
# <a name="locating-the-message-download-history-for-a-pop3-account"></a><span data-ttu-id="0ef6d-103">Поиск журнала скачивания сообщений для учетной записи POP3</span><span class="sxs-lookup"><span data-stu-id="0ef6d-103">Locating the message download history for a POP3 account</span></span>

<span data-ttu-id="0ef6d-104">В этом разделе описывается, как почтовый клиент может получить доступ к свойству [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) для получения истории скачивания сообщений для учетной записи POP3.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-104">This topic describes how a mail client can access the [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) property to get the message download history for a POP3 account.</span></span> 

<span data-ttu-id="0ef6d-105"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_WhyGetUIDLHistory"> </a></span><span class="sxs-lookup"><span data-stu-id="0ef6d-105"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_WhyGetUIDLHistory"> </a></span></span>

## <a name="why-get-the-message-download-history"></a><span data-ttu-id="0ef6d-106">Зачем получать историю скачивания сообщений?</span><span class="sxs-lookup"><span data-stu-id="0ef6d-106">Why get the message download history?</span></span>

<span data-ttu-id="0ef6d-107">Поставщик протокола Office (POP) для Outlook позволяет пользователям извлекать и загружать новые сообщения электронной почты на локальном устройстве, а затем оставлять или удалять эти сообщения электронной почты на почтовом сервере.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-107">The Post Office Protocol (POP) provider for Outlook allows users to retrieve and download new email messages on their local device, and subsequently to leave or delete these email messages on the mail server.</span></span> <span data-ttu-id="0ef6d-108">Когда почтовый клиент проверяет загрузку новых сообщений, он должен иметь возможность идентифицировать и скачивать только новые сообщения для этого почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-108">When the mail client checks for new messages to download, it has to be able to identify and download only the new messages for that Inbox.</span></span> <span data-ttu-id="0ef6d-109">Почтовый клиент сначала использует команду UIDL (Unique ID Listing), которая получает карту каждого сообщения, которое когда-либо доставлялось в этот почтовый ящик уникальному идентификатору (UID).</span><span class="sxs-lookup"><span data-stu-id="0ef6d-109">The mail client does this by first using the UIDL (Unique ID Listing) command, which obtains a map of each message that has ever been delivered to that Inbox to a unique identifier (UID).</span></span> <span data-ttu-id="0ef6d-110">Клиент также получает историю скачивания сообщений для сообщений, которые были загружены или удалены для почтового ящика на этом клиенте.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-110">The client also gets the message download history for messages that have been downloaded or deleted for the Inbox on that client.</span></span> <span data-ttu-id="0ef6d-111">Используя карту UID сообщения и историю скачивания, клиент может идентифицировать те сообщения, которые отсутствуют в истории, как новые и, следовательно, должны быть загружены.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-111">Using the message UID map and download history, the client can then identify those messages that are absent in the history as new and, hence, should be downloaded.</span></span>
  
<span data-ttu-id="0ef6d-112">Чтобы получить историю скачивания сообщения для почтового ящика:</span><span class="sxs-lookup"><span data-stu-id="0ef6d-112">To get the message download history for an Inbox:</span></span>
  
- <span data-ttu-id="0ef6d-113">Выполните действия в этом разделе, чтобы найти свойство **PidTagAttachDataBinary,** которое содержит историю в двоичном большом объекте (BLOB), который следует определенному формату.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-113">Follow the steps in this topic to find the **PidTagAttachDataBinary** property, which contains the history in a binary large object (BLOB) that follows a specific format.</span></span> 
    
- <span data-ttu-id="0ef6d-114">Продолжить с помощью размыкания истории скачивания сообщений для учетной записи [POP3,](parsing-the-message-download-history-for-a-pop3-account.md)которая описывает, как размыть этот BLOB для определения сообщений, которые были загружены или удалены для этого почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-114">Continue with [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md), which describes how to parse this BLOB to identify messages that have been downloaded or deleted for that Inbox.</span></span>
    
## <a name="core-concepts-to-know-for-locating-the-message-download-history"></a><span data-ttu-id="0ef6d-115">Основные понятия, которые необходимо знать для размещения истории скачивания сообщений</span><span class="sxs-lookup"><span data-stu-id="0ef6d-115">Core concepts to know for locating the message download history</span></span>

<span data-ttu-id="0ef6d-116">История скачивания сообщений для почтового ящика хранится в двоичном свойстве MAPI **PidTagAttachDataBinary** на вложении скрытого сообщения в почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-116">The message download history for an Inbox is stored in a binary MAPI property, **PidTagAttachDataBinary**, on an attachment of a hidden message in the Inbox.</span></span> <span data-ttu-id="0ef6d-117">В таблице 1 показаны ресурсы для понятий, которые помогают понять, как найти историю скачивания сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-117">Table 1 shows resources for concepts that help you understand how to locate the message download history.</span></span>
  
<span data-ttu-id="0ef6d-118">**Таблица 1. Основные понятия**</span><span class="sxs-lookup"><span data-stu-id="0ef6d-118">**Table 1. Core concepts**</span></span>

|<span data-ttu-id="0ef6d-119">**Название статьи**</span><span class="sxs-lookup"><span data-stu-id="0ef6d-119">**Article title**</span></span>|<span data-ttu-id="0ef6d-120">**Описание**</span><span class="sxs-lookup"><span data-stu-id="0ef6d-120">**Description**</span></span>|
|:-----|:-----|
|[<span data-ttu-id="0ef6d-121">Скрытые папки MAPI</span><span class="sxs-lookup"><span data-stu-id="0ef6d-121">MAPI Hidden Folders</span></span>](https://msdn.microsoft.com/library/8b3b9c80-f7f4-4f37-bd6b-323469d020f1%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-122">MAPI позволяет почтовым клиентам хранить сведения в скрытых папках и скрытых сообщениях.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-122">MAPI allows mail clients to store information in hidden folders and hidden messages.</span></span> <span data-ttu-id="0ef6d-123">Скрытые папки находятся в связанной части папок MAPI и обычно содержат сведения, которые не видны пользователям и которыми не управляют пользователи.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-123">Hidden folders are in the associated part of MAPI folders and typically contain information that is not visible to and not to be manipulated by users.</span></span> <span data-ttu-id="0ef6d-124">Клиенты решают формат и содержимое для хранения скрытых сообщений в скрытых папках.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-124">Clients decide the format and contents to store in hidden messages in hidden folders.</span></span>  <br/> |
|[<span data-ttu-id="0ef6d-125">Сообщения MAPI</span><span class="sxs-lookup"><span data-stu-id="0ef6d-125">MAPI Messages</span></span>](https://msdn.microsoft.com/library/417c113f-bd98-4515-85d1-09db7fc3a227%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-126">MAPI хранит сообщения в папках, как в стандартной подтрите IPM, которая видна пользователям клиента, так и за пределами подтрия и невидимой для пользователей.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-126">MAPI stores messages in folders, either in the standard IPM subtree that is visible to users of a client, or outside of the subtree and invisible to users.</span></span> <span data-ttu-id="0ef6d-127">Сообщения могут иметь дополнительные данные, хранимые в вложении, которые могут быть в виде файла, другого сообщения или объекта OLE.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-127">Messages can have additional data stored in an attachment, which can be in the form of a file, another message, or an OLE object.</span></span> <span data-ttu-id="0ef6d-128">В случае истории скачивания сообщений история хранится в свойстве сообщения, прикрепленного к другому скрытому сообщению.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-128">In the case of the message download history, the history is stored in a property of a message that is attached to another hidden message.</span></span>  <br/> |
|[<span data-ttu-id="0ef6d-129">Обзор свойств сообщений</span><span class="sxs-lookup"><span data-stu-id="0ef6d-129">Message Properties Overview</span></span>](https://msdn.microsoft.com/library/447f54de-9f0d-4f73-89b6-bed9cfea9c15%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-130">Когда клиент хранит сведения в сообщении, он фактически сохраняет сведения в свойстве сообщения.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-130">When a client stores information in a message, it actually stores the information in a property of the message.</span></span> <span data-ttu-id="0ef6d-131">MAPI поддерживает многие свойства: некоторые всегда существуют и могут быть установлены клиентами, другие необязательны, и клиенты не могут ожидать, что они будут доступны или заданная для допустимых значений.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-131">MAPI supports many properties—some always exist and can be set by clients, others are optional—and clients cannot expect them to be available or set to valid values.</span></span> <span data-ttu-id="0ef6d-132">История скачивания сообщений хранится в **свойстве PidTagAttachDataBinary** вложения к скрытому сообщению.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-132">The message download history is stored in the **PidTagAttachDataBinary** property of an attachment to a hidden message.</span></span>  <br/> |
|[<span data-ttu-id="0ef6d-133">Профили MAPI</span><span class="sxs-lookup"><span data-stu-id="0ef6d-133">MAPI Profiles</span></span>](https://msdn.microsoft.com/library/493c87a4-317d-47ec-850b-342cac59594b%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-134">Во время логотипа в сеансе почтовый клиент выбирает профиль, в который описываются используемые поставщики и службы.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-134">At logon time in a session, the mail client selects a profile that describes the providers and services to be used.</span></span> <span data-ttu-id="0ef6d-135">Профиль делится на разделы, содержащие свойства.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-135">A profile is divided into sections that contain properties.</span></span> <span data-ttu-id="0ef6d-136">В частности, свойства [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) **(PR_SEARCH_KEY)** и [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) **(PR_PROFILE_NAME)** всегда существуют.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-136">In particular, the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) and [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) properties always exist.</span></span> <span data-ttu-id="0ef6d-137">Ключ поиска профиля уникален среди всех профилей и хранится в разделе **профилей,** который определяется MUID_PROFILE_INSTANCE (который определяется в MAPIGUID. H).</span><span class="sxs-lookup"><span data-stu-id="0ef6d-137">A profile's search key is unique among all profiles, and is stored in the profile section that is identified by **MUID_PROFILE_INSTANCE** (which is defined in MAPIGUID.H).</span></span> <span data-ttu-id="0ef6d-138">Чтобы открыть раздел, используйте [IMAPISession::OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) и используйте [IMAPIProp::GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) для получения значений свойств.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-138">Use [IMAPISession::OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) to open the section, and use [IMAPIProp::GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) to get the property values.</span></span>  <br/> |
|[<span data-ttu-id="0ef6d-139">Таблицы контента</span><span class="sxs-lookup"><span data-stu-id="0ef6d-139">Contents Tables</span></span>](https://msdn.microsoft.com/library/7b8efb4e-b5be-41b8-81bb-9aa1da421433%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-140">Поставщики магазинов сообщений реализуют таблицы контента для своих папок.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-140">Message store providers implement contents tables for their folders.</span></span> <span data-ttu-id="0ef6d-141">Для скрытых сообщений в связанной части папки поставщики магазинов сообщений поддерживают связанные таблицы содержимого, а клиенты могут использовать метод [IMAPIContainer::GetContentsTable,](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) чтобы вернуть указатель в связанную таблицу содержимого.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-141">For hidden messages in the associated part of a folder, message store providers support associated contents tables, and clients can use the [IMAPIContainer::GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) method to return a pointer to the associated contents table.</span></span>  <br/> |
|[<span data-ttu-id="0ef6d-142">Об ограничениях</span><span class="sxs-lookup"><span data-stu-id="0ef6d-142">About Restrictions</span></span>](https://msdn.microsoft.com/library/e119fa20-08b8-4c8d-93fc-56037220890d%28Office.15%29.aspx) <br/> [<span data-ttu-id="0ef6d-143">Типы ограничений</span><span class="sxs-lookup"><span data-stu-id="0ef6d-143">Types of Restrictions</span></span>](https://msdn.microsoft.com/library/0d3bd58b-7100-4117-91ac-27139715c85b%28Office.15%29.aspx) <br/> [<span data-ttu-id="0ef6d-144">Создание ограничения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-144">Building a Restriction</span></span>](https://msdn.microsoft.com/library/12abbd8c-f825-493e-af42-344371d9658e%28Office.15%29.aspx) <br/> [<span data-ttu-id="0ef6d-145">Пример кода ограничений</span><span class="sxs-lookup"><span data-stu-id="0ef6d-145">Sample Restriction Code</span></span>](https://msdn.microsoft.com/library/9b82097c-dbd6-4ba0-a6cb-292301f9402b%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-146">В MAPI клиенты могут использовать ограничения для фильтрации таблиц контента, для поиска строк, которые представляют сообщения, которые имеют определенное свойство, заданная определенному значению.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-146">In MAPI, clients can use restrictions to filter contents tables, to search for rows that represent messages that have a certain property set to a specific value.</span></span> <span data-ttu-id="0ef6d-147">Ограничения определяются с помощью [структуры данных SRestriction,](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) которая может содержать объединение более специализированных структур ограничений.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-147">Restrictions are defined by using the [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) data structure, which can contain a union of more specialized restriction structures.</span></span> <span data-ttu-id="0ef6d-148">Метод [IMAPITable::FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) применяет ограничение и извлекает первую строку в таблице, которая соответствует критериям ограничения.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-148">The [IMAPITable::FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) method applies a restriction and retrieves the first row in a table that matches the restriction criteria.</span></span>  <br/> |
|[<span data-ttu-id="0ef6d-149">О регистрации магазинов для индексации</span><span class="sxs-lookup"><span data-stu-id="0ef6d-149">About Registering Stores for Indexing</span></span>](https://msdn.microsoft.com/library/dd2aa06a-96e8-1291-18b5-fc3c40b74e4d%28Office.15%29.aspx) <br/> |<span data-ttu-id="0ef6d-150">Используйте [свойство PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) **(PR_MDB_PROVIDER)** для проверки типа поставщика магазина.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-150">Use the [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) property to verify the type of store provider.</span></span> <span data-ttu-id="0ef6d-151">Например, чтобы проверить, является ли магазин Exchange магазином, свойство **PidTagStoreProvider** должно возвращать значение, представленное постоянным **pbExchangeProviderPrimaryUserGuid,** которое определяется в файле общедоступных заголовок edkmdb.h.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-151">For example, to verify whether a store is an Exchange store, the **PidTagStoreProvider** property should return a value represented by the constant **pbExchangeProviderPrimaryUserGuid**, which is defined in the public header file edkmdb.h.</span></span>  <br/> |
   
## <a name="locating-the-appropriate-hidden-message-and-attachment"></a><span data-ttu-id="0ef6d-152">Поиск соответствующего скрытого сообщения и вложения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-152">Locating the appropriate hidden message and attachment</span></span>

<span data-ttu-id="0ef6d-153">Теперь, когда мы знаем, что история скачивания сообщений для почтового ящика находится в свойстве **PidTagAttachDataBinary** вложения к скрытому сообщению, процедура поиска соответствующего вложения соответствующего скрытого сообщения включает следующие процедуры:</span><span class="sxs-lookup"><span data-stu-id="0ef6d-153">Now that we know the message download history for an Inbox is in the **PidTagAttachDataBinary** property of an attachment to a hidden message, the procedure to locate the appropriate attachment of the appropriate hidden message involves the following procedures:</span></span> 
  
1. [<span data-ttu-id="0ef6d-154">Поиск соответствующего скрытого сообщения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-154">Find the appropriate hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg)
    
2. [<span data-ttu-id="0ef6d-155">Поиск соответствующего вложения скрытого сообщения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-155">Find the appropriate attachment of the hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment)
    
3. [<span data-ttu-id="0ef6d-156">Доступ к свойству PidTagAttachDataBinary вложения сообщения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-156">Access the PidTagAttachDataBinary property of the message attachment</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp)

<span data-ttu-id="0ef6d-157"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg"> </a></span><span class="sxs-lookup"><span data-stu-id="0ef6d-157"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg"> </a></span></span>

### <a name="find-the-appropriate-hidden-message"></a><span data-ttu-id="0ef6d-158">Поиск соответствующего скрытого сообщения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-158">Find the appropriate hidden message</span></span>

1. <span data-ttu-id="0ef6d-159">Получите свойство [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) **(PR_SEARCH_KEY)** из профиля в разделе профиль, **заданном** MUID_PROFILE_INSTANCE .</span><span class="sxs-lookup"><span data-stu-id="0ef6d-159">Get the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) property from the profile, in the profile section specified by **MUID_PROFILE_INSTANCE**.</span></span>
    
2. <span data-ttu-id="0ef6d-160">Откройте связанное содержимое папки "Входящие", позвонив **в IMAPIContainer::GetContentsTable**.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-160">Open the Associated Contents for the Inbox folder by calling **IMAPIContainer::GetContentsTable**.</span></span>
    
3. <span data-ttu-id="0ef6d-161">Создайте ограничение на основе свойств [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) **(PR_CONVERSATION_KEY),** **PidTagSearchKey** **(PR_SEARCH_KEY)** и [Свойств PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) **(PR_MESSAGE_CLASS),** чтобы получить таблицу, содержаную все скрытые сообщения в связанном содержимом почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-161">Create a restriction based on the [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**), **PidTagSearchKey** (**PR_SEARCH_KEY**), and [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) properties to get a table that contains all the hidden messages in the Associated Contents of the Inbox.</span></span> <span data-ttu-id="0ef6d-162">Ниже приводится пример ограничения, извлеченного из [Locating the POP3 UIDL History](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span><span class="sxs-lookup"><span data-stu-id="0ef6d-162">The following is an example of a restriction extracted from [Locating the POP3 UIDL History](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span></span>
    
   ```cpp
      SRestriction rgRes[3]; 
      SPropValue rgProps[3]; 
      rgRes[0].rt = RES_AND; 
      rgRes[0].res.resAnd.cRes = 2; 
      rgRes[0].res.resAnd.lpRes = &amp;rgRes[1]; 
      rgRes[1].rt = RES_PROPERTY; 
      rgRes[1].res.resProperty.relop = RELOP_EQ; 
      rgRes[1].res.resProperty.ulPropTag = PR_CONVERSATION_KEY; 
      rgRes[1].res.resProperty.lpProp = &amp;rgProps[0]; 
      rgRes[2].rt = RES_PROPERTY; 
      rgRes[2].res.resProperty.relop = RELOP_EQ; 
      rgRes[2].res.resProperty.ulPropTag = PR_MESSAGE_CLASS; 
      rgRes[2].res.resProperty.lpProp = &amp;rgProps[1]; 
      rgProps[0].ulPropTag = PR_CONVERSATION_KEY; 
      rgProps[0].Value.bin = pVals[iSearchKey].Value.bin; // PR_SEARCH_KEY from the profile 
      rgProps[1].ulPropTag = PR_MESSAGE_CLASS; 
      rgProps[1].Value.LPSZ = (LPTSTR)"IPM.MessageManager";
   ```

4. <span data-ttu-id="0ef6d-163">Из таблицы найдите скрытое сообщение с помощью **IMAPITable::FindRow**.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-163">From the table, find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
5. <span data-ttu-id="0ef6d-164">Если на шаге 4 не удается найти скрытое сообщение, измените ограничение на использование **PidTagSearchKey** **(PR_SEARCH_KEY)** вместо **PidTagConversationKey,** как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="0ef6d-164">If step 4 fails to find a hidden message, change the restriction to use **PidTagSearchKey** (**PR_SEARCH_KEY**) instead of **PidTagConversationKey**, as shown below:</span></span>
    
   ```cpp
    rgRes[1].res.resProperty.ulPropTag = rgProps[0].ulPropTag = PR_SEARCH_KEY;
   ```

6. <span data-ttu-id="0ef6d-165">Найдите скрытое сообщение **с помощью IMAPITable::FindRow**.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-165">Find the hidden message using **IMAPITable::FindRow**.</span></span> 
    
7. <span data-ttu-id="0ef6d-166">Если шаг 6 не удается, измените ограничение на использование [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) **(PR_SUBJECT),** равное следующему значению (показано ниже с помощью замены стиля для  `printf` краткости).</span><span class="sxs-lookup"><span data-stu-id="0ef6d-166">If Step 6 fails, change the restriction to use [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) being equal to the following value (shown below using  `printf` style substitution for brevity).</span></span> 
    
   ```cpp
    "Outlook Message Manager (%s) (KEY: %s)", PR_PROFILE_NAME, HexFromBin(PR_SEARCH_KEY)
   ```

8. <span data-ttu-id="0ef6d-167">Найдите скрытое сообщение с помощью **IMAPITable::FindRow**.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-167">Find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
9. <span data-ttu-id="0ef6d-168">Если вы работаете Outlook 2010 или более поздней версии, используйте следующие значения **для PidTagProfileName** **(PR_PROFILE_NAME)** и **PidTagSearchKey** **(PR_SEARCH_KEY),** соответственно.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-168">If you are running Outlook 2010 or a later version, use the following values for **PidTagProfileName** (**PR_PROFILE_NAME**) and **PidTagSearchKey** (**PR_SEARCH_KEY**), respectively.</span></span>
    
   ```cpp
    CHAR g_szGeneralKey[] = "General Key"; 
    const SBinary g_binGeneralKey = {sizeof(g_szGeneralKey), (LPBYTE)g_szGeneralKey};
   ```

   <span data-ttu-id="0ef6d-169">Выполнить действия с 3 по 8.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-169">Run through Steps 3 through 8.</span></span> <span data-ttu-id="0ef6d-170">Если при этом не удается найти сообщение, возвращайся к исходным шагам 3-8.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-170">If this fails to find a message, fall back to the original steps 3 through 8.</span></span>
    
10. <span data-ttu-id="0ef6d-171">Откройте скрытое сообщение, найденное в шаге 4, 6 или 8.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-171">Open the hidden message found in Step 4, 6, or 8.</span></span>

<span data-ttu-id="0ef6d-172"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment"> </a></span><span class="sxs-lookup"><span data-stu-id="0ef6d-172"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment"> </a></span></span>

### <a name="find-the-appropriate-attachment-of-the-hidden-message"></a><span data-ttu-id="0ef6d-173">Поиск соответствующего вложения скрытого сообщения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-173">Find the appropriate attachment of the hidden message</span></span>

<span data-ttu-id="0ef6d-174">Поскольку скрытое сообщение может иметь несколько вложений, найми соответствующее вложение в следующем порядке.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-174">Because the hidden message may have more than one attachment, look for the appropriate attachment in the following order.</span></span>
  
> [!NOTE]
> <span data-ttu-id="0ef6d-175">Эта процедура снова использует  `printf` замену стиля для краткости.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-175">This procedure again uses the  `printf` style substitution for brevity.</span></span> 

1. <span data-ttu-id="0ef6d-176">Найди вложение, в котором [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) **(PR_ATTACH_LONG_FILENAME)** соответствует следующей строке, где находится SMTP-адрес пользователя, как указано в профиле  `szEmailAddress` пользователя.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-176">Look for an attachment whose [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) matches the following string, where  `szEmailAddress` is the user's SMTP address, as specified in the user's profile.</span></span> <span data-ttu-id="0ef6d-177">.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-177">.</span></span> 
    
   ```cpp
    "BlobPOP%s", szEmailAddress
   ```

2. <span data-ttu-id="0ef6d-178">Найди вложение, у которого [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) **(PR_ATTACH_FILENAME)** совпадает с "BlobPOP%s",  `szEmailAddress` .</span><span class="sxs-lookup"><span data-stu-id="0ef6d-178">Look for an attachment whose [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
3. <span data-ttu-id="0ef6d-179">Найди вложение, имя [которого в PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) **(PR_DISPLAY_NAME)** совпадает с "BlobPOP%s",  `szEmailAddress` .</span><span class="sxs-lookup"><span data-stu-id="0ef6d-179">Look for an attachment whose [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
4. <span data-ttu-id="0ef6d-180">Иском вложение, в котором **PidTagAttachFilename** **(PR_ATTACH_FILENAME)** совпадает с "Blob%.8x", откуда исходит  `dwAcctUID`  `dwAcctUID` [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span><span class="sxs-lookup"><span data-stu-id="0ef6d-180">Look for an attachment whose **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) matches "Blob%.8x",  `dwAcctUID`, where  `dwAcctUID` comes from [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span></span> <span data-ttu-id="0ef6d-181">Вы можете использовать [метод IOlkAccount::GetProp](iolkaccount-getprop.md) для доступа к **свойству PROP_ACCT_MINI_UID.**</span><span class="sxs-lookup"><span data-stu-id="0ef6d-181">You can use the [IOlkAccount::GetProp](iolkaccount-getprop.md) method to access the **PROP_ACCT_MINI_UID** property.</span></span> 

<span data-ttu-id="0ef6d-182"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp"> </a></span><span class="sxs-lookup"><span data-stu-id="0ef6d-182"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp"> </a></span></span>

### <a name="access-the-pidtagattachdatabinary-property-of-the-message-attachment"></a><span data-ttu-id="0ef6d-183">Доступ к свойству PidTagAttachDataBinary вложения сообщения</span><span class="sxs-lookup"><span data-stu-id="0ef6d-183">Access the PidTagAttachDataBinary property of the message attachment</span></span>

<span data-ttu-id="0ef6d-184">После размещения соответствующего вложения скрытого сообщения используйте **IMAPIProp::GetProps** для чтения свойства **PidTagAttachDataBinary** вложения.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-184">After locating the appropriate message attachment of the hidden message, use **IMAPIProp::GetProps** to read the **PidTagAttachDataBinary** property of the attachment.</span></span> 

<span data-ttu-id="0ef6d-185"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_NextSteps"> </a></span><span class="sxs-lookup"><span data-stu-id="0ef6d-185"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_NextSteps"> </a></span></span>

## <a name="next-steps"></a><span data-ttu-id="0ef6d-186">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="0ef6d-186">Next steps</span></span>

<span data-ttu-id="0ef6d-187">В этом разделе вы узнали, как найти историю скачивания сообщений для почтового клиента POP3.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-187">You have learned from this topic how to locate the message download history for the Inbox of a POP3 mail client.</span></span> <span data-ttu-id="0ef6d-188">Чтобы [](parsing-the-message-download-history-for-a-pop3-account.md) узнать, как размыть эту историю, чтобы определить сообщения, которые были загружены или удалены для почтового ящика, см. в этой записи.</span><span class="sxs-lookup"><span data-stu-id="0ef6d-188">See [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md) to learn how to parse this history to identify messages that have been downloaded or deleted for the Inbox.</span></span> 

<span data-ttu-id="0ef6d-189"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AdditionalRsc"> </a></span><span class="sxs-lookup"><span data-stu-id="0ef6d-189"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AdditionalRsc"> </a></span></span>

## <a name="see-also"></a><span data-ttu-id="0ef6d-190">См. также</span><span class="sxs-lookup"><span data-stu-id="0ef6d-190">See also</span></span>

- [<span data-ttu-id="0ef6d-191">Управление скачиванием сообщений для учетных записей POP3</span><span class="sxs-lookup"><span data-stu-id="0ef6d-191">Managing message downloads for POP3 accounts</span></span>](managing-message-downloads-for-pop3-accounts.md)   
- [<span data-ttu-id="0ef6d-192">Анализ журнала скачивания сообщений для учетной записи POP3</span><span class="sxs-lookup"><span data-stu-id="0ef6d-192">Parsing the message download history for a POP3 account</span></span>](parsing-the-message-download-history-for-a-pop3-account.md)
- [<span data-ttu-id="0ef6d-193">Поиск истории UIDL POP3</span><span class="sxs-lookup"><span data-stu-id="0ef6d-193">Locating the POP3 UIDL History</span></span>](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx)
    

