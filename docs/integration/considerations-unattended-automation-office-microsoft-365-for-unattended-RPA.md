---
title: Вопросы, которые следует учитывать при автоматизации Office в Microsoft 365 для неавтоматной среды RPA
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: Соображения по автоматизированной автоматизации Office в Microsoft 365 для неавтоматной среды RPA.
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103052"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a>Вопросы, которые следует учитывать при автоматизации Office в Microsoft 365 для неавтоматной среды RPA

Хотя Microsoft 365 для независимой службы RPA предоставляет лицензию, которая позволяет автоматизировать Office без пользователя, все текущие версии Office были разработаны и протестированы для запуска в качестве продуктов конечных пользователей на клиентской рабочей станции с пользователем, присутствующим для взаимодействия с интерфейсом приложения. Непредвиденные действия, которые могут быть результатом использования приложений без пользователя, не являются дефектами. Если вы хотите запустить Office в этой конфигурации, необходимо быть готовым учитывать эти непредвиденные действия в логике приложения.

В этой статье рассматриваются некоторые аспекты автоматизации Office, которые помогут вам при использовании этого подхода. Однако обратите внимание, что использование Office в этой конфигурации строго "AS IS" и должно учитывать такое неожиданное поведение. Представленная здесь информация не является исчерпывающим и не гарантируется для устранения всех проблем для всех клиентов. Рекомендуем тщательно протестировать решение перед развертыванием.

## <a name="common-problems-in-unattended-automation"></a>Распространенные проблемы в автоматизированной автоматизации

Если вы хотите использовать Office без пользователя, следует помнить о следующих областях, в которых Office может вести себя иначе, чем ожидалось. Для успешного запуска решения оно должно как можно больше решить эти проблемы и свести к минимуму их последствия. При создании приложения тщательно продумайте эти проблемы.

### <a name="interactive-ui-elements"></a>Интерактивные элементы пользовательского интерфейса

Приложения Office предполагают, что они запускаются в интерактивном режиме. Если возникает непредвиденное сообщение об ошибке или для выполнения функции требуется неустановленный параметр, Office будет предложено пользователю в диалоговом окне с вопросом о том, как он хочет продолжить. В автоматизированной автоматизации это может привести к "зависаю" приложения, когда приложение останавливается, пока не получит этот ввод. Если вы автоматизируете Office с помощью общедоступных API, вы можете подавить многие из этих оповещений, настроив свойства, такие как [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) и [Application.AutomationSecurity.](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) Код должен быть разработан для определения и обработки блокирующих оповещений в любое время.

### <a name="user-identity"></a>Удостоверение пользователя

Приложениям Office требуется удостоверение пользователя при их запуске, даже если приложение запущено с помощью автоматизации. Это удостоверение пользователя может привести к любому из следующих причин:

- Наличие дополнительного пользовательского интерфейса для входов, которые необходимо обработать.
- Файлы, которые не могут быть открыты и /или изменены на основе разрешений на доступ для каждого пользователя.
- Непредвиденные изменения метаданных файла (например, некоторые свойства файла будут обновлены на основе удостоверения пользователя в автоматическом экземпляре приложения).

Для решения этих проблем можно использовать различные подходы; например, запуск [инспектора документов для](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) удаления метаданных. Подумайте, подходят ли эти подходы в зависимости от вашего сценария.

### <a name="server-side-security"></a>Безопасность на стороне сервера

При запуске office с произвольным содержимым файлов и обработке произвольного содержимого файлов никакие дополнительные средства защиты, определенные в этой среде, не предотвращают загрузку и запуск макроса, хранимые в этих файлах. Office не защищает вас от непреднамеренно запуска макроса из кода или от запуска другого сервера, на который могут запускаться макросы. Для снижения этого риска можно использовать такие свойства, как [Application.AutomationSecurity,](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) но следует убедиться, что загружается только доверенного содержимого.

Кроме того, Office использует множество компонентов (например, Simple MAPI, WinInet и MSDAIPP), которые могут кэширование данных проверки подлинности клиента для ускорения обработки. Когда Office автоматизируется на стороне сервера и обрабатывает несколько файлов, если сведения для проверки подлинности кэшировали для этого сеанса, один клиент может использовать кэшизированные учетные данные другого клиента. Таким образом, клиент может получить не предоставленные разрешения на доступ, выдав себя за других пользователей.

### <a name="ui-changes"></a>Изменения пользовательского интерфейса

Элементы пользовательского интерфейса в Office в значительной степени стабильны, но определенное расположение любого элемента пользовательского интерфейса не гарантируется и может измениться по мере развития разработки продукта для включения отзывов пользователей и удовлетворения потребностей клиентов. Для этого должна учитываться логика любой автоматизации. Эти изменения могут привести к ряду изменений именования кнопки или вкладки группы, перемещения команд между вкладками, добавления новых вкладок или удаления команд в соответствии с нашими политиками удаления функций. Эти изменения могут происходить в пользовательском интерфейсе, а также в сведениях о доступности, предоставляемых приложением, так как эти сведения меняются для повышения эффективности использования и учета текущих отзывов клиентов и могут быть в разное время доступны для разных пользователей.

Даже без изменений продукта различия между системными средами (такими как размер экрана, разрешение и DPI) могут привести к изменениям расположения элементов на экране. Любой подход, который использует координаты экрана для имитации пользовательского ввода, должен учитывать эти изменения и адаптироваться соответствующим образом.

### <a name="single-threading"></a>Однопотоковая

Приложения Office — это приложения на основе STA, которые не являются реляционными, предназначенные для предоставления разнообразных, но ресурсоемких функций для одного клиента. Приложения используют глобальные ресурсы, такие как файлы с картой памяти, глобальные надстройки или шаблоны, а также общие серверы автоматизации. Это может ограничить число экземпляров, которые могут работать одновременно, и привести к состояниям гонки, если приложения настроены в многоклиентской среде. Если вы планируете запустить несколько экземпляров любого приложения Office, следует запланировать их изоляцию на уровне виртуальной машины, чтобы обеспечить стабильность итогов решения.

### <a name="resiliency-and-stability"></a>Устойчивость и стабильность

Даже с учетом вышеперечисленных соображений, если приложения автоматизированы способом имитации ввода пользователем или продолжительности сеанса, значительно превышающим интерактивное использование, они могут столкнуться с проблемой, которая не присутствует при интерактивном запуске. Решения, в которых используется Office в этом контексте, должны заблаговременно создавать механизмы для отслеживания состояния приложения и их перезапуска (и/или виртуальной машины, на которой они работают) при необходимости.

## <a name="suggested-alternatives"></a>Рекомендуемые альтернативы

Корпорация Майкрософт настоятельно рекомендует использовать несколько альтернатив, которые не требуют установки и запуска Office на стороне сервера и могут выполнять общие задачи более эффективно и быстрее, чем автоматизация в этой конфигурации. Прежде чем включать Office в проект как серверный компонент, рассмотрите альтернативные варианты.

### <a name="microsoft-graph"></a>Microsoft Graph

API Microsoft Graph предоставляет доступ к службам, данным и аналитике, которые доступны пользователям и решениям в составе облака Майкрософт, включая множество служб, поддерживающих потребности автоматизации: доступ к почте, календарю, контактам/ файлам пользователей, преобразованию документов, вычислению книги Excel и т. д. Эти службы предназначены для неавтоматального использования и крупномасштабных доступов, а также используют стандартный синтаксис API с использованием RESTful. Дополнительные сведения о Microsoft Graph и о том, как использовать его для работы с данными пользователей, можно найти на следующих веб-сайтах:

- [Обзор Microsoft Graph](https://docs.microsoft.com/graph/overview) 
- [Начало работы с Microsoft Graph](https://developer.microsoft.com/graph/get-started)
- [Скачивание файла в другом формате](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (преобразование файла)
- [Работа с Excel в Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (сведения о книге)

### <a name="open-xml-file-formats"></a>Форматы файлов Open XML

Многие задачи автоматизации включают создание или редактирование документов. Office поддерживает форматы файлов Open XML, которые позволяют разработчикам создавать, редактировать, читать и преобразовывать содержимое файлов с помощью стандартных технологий XML и ZIP, определенных в стандарте ISO 29500 International Standard. Этими форматами файлов можно управлять с помощью любых средств ZIP/XML, включая пространство имен System.IO.Package.IO в Microsoft .NET 3.x Framework. Прямое редактирование форматов файлов — это рекомендуемый и поддерживаемый метод обработки изменений файлов Office из службы.

Корпорация Майкрософт предоставляет SDK для работы с форматами файлов Open XML из .NET 3.x Framework. Дополнительные сведения о SDK и использовании SDK для создания или редактирования файлов Open XML можно найти в следующих материалах:

- [Общие сведения о форматах файлов Open XML](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [Добро пожаловать на страницу пакета SDK 2.5 Open XML для Office](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
