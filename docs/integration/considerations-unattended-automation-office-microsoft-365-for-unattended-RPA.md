---
title: Вопросы, которые следует учитывать при автоматизации Office в Microsoft 365 для неавтоматной среды RPA
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: Соображения по автоматизированной автоматизации Office в Microsoft 365 для неавтоматной среды RPA.
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103052"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a><span data-ttu-id="e5086-103">Вопросы, которые следует учитывать при автоматизации Office в Microsoft 365 для неавтоматной среды RPA</span><span class="sxs-lookup"><span data-stu-id="e5086-103">Considerations for unattended automation of Office in the Microsoft 365 for unattended RPA environment</span></span>

<span data-ttu-id="e5086-104">Хотя Microsoft 365 для независимой службы RPA предоставляет лицензию, которая позволяет автоматизировать Office без пользователя, все текущие версии Office были разработаны и протестированы для запуска в качестве продуктов конечных пользователей на клиентской рабочей станции с пользователем, присутствующим для взаимодействия с интерфейсом приложения.</span><span class="sxs-lookup"><span data-stu-id="e5086-104">Although Microsoft 365 for unattended RPA provides a license that enables the automation of Office with no user present, all current versions of Office were designed and tested to run as end-user products on a client workstation with a user present to interact with the application’s interface.</span></span> <span data-ttu-id="e5086-105">Непредвиденные действия, которые могут быть результатом использования приложений без пользователя, не являются дефектами.</span><span class="sxs-lookup"><span data-stu-id="e5086-105">Unexpected behaviors resulting from the use of applications without a user present are not defects.</span></span> <span data-ttu-id="e5086-106">Если вы хотите запустить Office в этой конфигурации, необходимо быть готовым учитывать эти непредвиденные действия в логике приложения.</span><span class="sxs-lookup"><span data-stu-id="e5086-106">If you want to run Office in this configuration, you must be prepared to account for these unexpected behaviors in your application logic.</span></span>

<span data-ttu-id="e5086-107">В этой статье рассматриваются некоторые аспекты автоматизации Office, которые помогут вам при использовании этого подхода.</span><span class="sxs-lookup"><span data-stu-id="e5086-107">This article outlines some of the considerations for unattended automation of Office to help you if you use this approach.</span></span> <span data-ttu-id="e5086-108">Однако обратите внимание, что использование Office в этой конфигурации строго "AS IS" и должно учитывать такое неожиданное поведение.</span><span class="sxs-lookup"><span data-stu-id="e5086-108">However, note that usage of Office in this configuration is strictly “AS IS” and must account for these unexpected behaviors.</span></span> <span data-ttu-id="e5086-109">Представленная здесь информация не является исчерпывающим и не гарантируется для устранения всех проблем для всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="e5086-109">The information provided here is not exhaustive and is not guaranteed to resolve all issues for all clients.</span></span> <span data-ttu-id="e5086-110">Рекомендуем тщательно протестировать решение перед развертыванием.</span><span class="sxs-lookup"><span data-stu-id="e5086-110">We encourage you to test your solution thoroughly before you deploy.</span></span>

## <a name="common-problems-in-unattended-automation"></a><span data-ttu-id="e5086-111">Распространенные проблемы в автоматизированной автоматизации</span><span class="sxs-lookup"><span data-stu-id="e5086-111">Common problems in unattended automation</span></span>

<span data-ttu-id="e5086-112">Если вы хотите использовать Office без пользователя, следует помнить о следующих областях, в которых Office может вести себя иначе, чем ожидалось.</span><span class="sxs-lookup"><span data-stu-id="e5086-112">If you want to use Office without a user present, be aware of the following areas in which Office can behave differently than expected.</span></span> <span data-ttu-id="e5086-113">Для успешного запуска решения оно должно как можно больше решить эти проблемы и свести к минимуму их последствия.</span><span class="sxs-lookup"><span data-stu-id="e5086-113">For your solution to run successfully, it must address these issues and minimize their effects as much as possible.</span></span> <span data-ttu-id="e5086-114">При создании приложения тщательно продумайте эти проблемы.</span><span class="sxs-lookup"><span data-stu-id="e5086-114">Consider these issues carefully when you build your application.</span></span>

### <a name="interactive-ui-elements"></a><span data-ttu-id="e5086-115">Интерактивные элементы пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="e5086-115">Interactive UI elements</span></span>

<span data-ttu-id="e5086-116">Приложения Office предполагают, что они запускаются в интерактивном режиме.</span><span class="sxs-lookup"><span data-stu-id="e5086-116">Office applications assume that they are being run interactively.</span></span> <span data-ttu-id="e5086-117">Если возникает непредвиденное сообщение об ошибке или для выполнения функции требуется неустановленный параметр, Office будет предложено пользователю в диалоговом окне с вопросом о том, как он хочет продолжить.</span><span class="sxs-lookup"><span data-stu-id="e5086-117">If an unexpected error occurs, or if an unspecified parameter is needed to complete a function, Office is designed to prompt the user with a dialog box that asks the user how they want to proceed.</span></span> <span data-ttu-id="e5086-118">В автоматизированной автоматизации это может привести к "зависаю" приложения, когда приложение останавливается, пока не получит этот ввод.</span><span class="sxs-lookup"><span data-stu-id="e5086-118">In unattended automation, this might result in the application appearing to “hang” as the application stops until it receives this input.</span></span> <span data-ttu-id="e5086-119">Если вы автоматизируете Office с помощью общедоступных API, вы можете подавить многие из этих оповещений, настроив свойства, такие как [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) и [Application.AutomationSecurity.](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)</span><span class="sxs-lookup"><span data-stu-id="e5086-119">If you’re automating Office via its public APIs, you can suppress many of these alerts by configuring properties like [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) and [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) appropriately.</span></span> <span data-ttu-id="e5086-120">Код должен быть разработан для определения и обработки блокирующих оповещений в любое время.</span><span class="sxs-lookup"><span data-stu-id="e5086-120">Your code should be designed to identify and process blocking alerts at any time.</span></span>

### <a name="user-identity"></a><span data-ttu-id="e5086-121">Удостоверение пользователя</span><span class="sxs-lookup"><span data-stu-id="e5086-121">User identity</span></span>

<span data-ttu-id="e5086-122">Приложениям Office требуется удостоверение пользователя при их запуске, даже если приложение запущено с помощью автоматизации.</span><span class="sxs-lookup"><span data-stu-id="e5086-122">Office applications require a user identity when the applications are run, even when the application is started via automation.</span></span> <span data-ttu-id="e5086-123">Это удостоверение пользователя может привести к любому из следующих причин:</span><span class="sxs-lookup"><span data-stu-id="e5086-123">This user identity can cause any or all of the following:</span></span>

- <span data-ttu-id="e5086-124">Наличие дополнительного пользовательского интерфейса для входов, которые необходимо обработать.</span><span class="sxs-lookup"><span data-stu-id="e5086-124">The presence of additional sign-in UI that must be handled.</span></span>
- <span data-ttu-id="e5086-125">Файлы, которые не могут быть открыты и /или изменены на основе разрешений на доступ для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="e5086-125">Files that cannot be opened and/or edited based on per-user access permissions.</span></span>
- <span data-ttu-id="e5086-126">Непредвиденные изменения метаданных файла (например, некоторые свойства файла будут обновлены на основе удостоверения пользователя в автоматическом экземпляре приложения).</span><span class="sxs-lookup"><span data-stu-id="e5086-126">Unexpected changes to the metadata of the file (for example, certain file properties will be updated based on the identity of the user identity of the automated application instance).</span></span>

<span data-ttu-id="e5086-127">Для решения этих проблем можно использовать различные подходы; например, запуск [инспектора документов для](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) удаления метаданных.</span><span class="sxs-lookup"><span data-stu-id="e5086-127">Various approaches can help to mitigate these issues; for example, running the [Document Inspector](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) to remove metadata.</span></span> <span data-ttu-id="e5086-128">Подумайте, подходят ли эти подходы в зависимости от вашего сценария.</span><span class="sxs-lookup"><span data-stu-id="e5086-128">Consider whether these approaches are appropriate based on your scenario.</span></span>

### <a name="server-side-security"></a><span data-ttu-id="e5086-129">Безопасность на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="e5086-129">Server-side security</span></span>

<span data-ttu-id="e5086-130">При запуске office с произвольным содержимым файлов и обработке произвольного содержимого файлов никакие дополнительные средства защиты, определенные в этой среде, не предотвращают загрузку и запуск макроса, хранимые в этих файлах.</span><span class="sxs-lookup"><span data-stu-id="e5086-130">When running Office unattended and processing arbitrary file content, no additional protections specific in that environment are available to prevent macros stored in those files from loading and running.</span></span> <span data-ttu-id="e5086-131">Office не защищает вас от непреднамеренно запуска макроса из кода или от запуска другого сервера, на который могут запускаться макросы.</span><span class="sxs-lookup"><span data-stu-id="e5086-131">Office does not protect you from unintentionally running macros from your code, or from starting another server that might run macros.</span></span> <span data-ttu-id="e5086-132">Для снижения этого риска можно использовать такие свойства, как [Application.AutomationSecurity,](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) но следует убедиться, что загружается только доверенного содержимого.</span><span class="sxs-lookup"><span data-stu-id="e5086-132">You can use properties like [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) to mitigate this risk, but you should ensure that you are only loading trusted content.</span></span>

<span data-ttu-id="e5086-133">Кроме того, Office использует множество компонентов (например, Simple MAPI, WinInet и MSDAIPP), которые могут кэширование данных проверки подлинности клиента для ускорения обработки.</span><span class="sxs-lookup"><span data-stu-id="e5086-133">Additionally, Office uses many components (such as Simple MAPI, WinInet, and MSDAIPP) that can cache client authentication information to speed processing.</span></span> <span data-ttu-id="e5086-134">Когда Office автоматизируется на стороне сервера и обрабатывает несколько файлов, если сведения для проверки подлинности кэшировали для этого сеанса, один клиент может использовать кэшизированные учетные данные другого клиента.</span><span class="sxs-lookup"><span data-stu-id="e5086-134">When Office is being automated server-side and processing multiple files, if authentication information has been cached for that session, one client can use the cached credentials of another client.</span></span> <span data-ttu-id="e5086-135">Таким образом, клиент может получить не предоставленные разрешения на доступ, выдав себя за других пользователей.</span><span class="sxs-lookup"><span data-stu-id="e5086-135">Therefore, the client can gain non-granted access permissions by impersonating other users.</span></span>

### <a name="ui-changes"></a><span data-ttu-id="e5086-136">Изменения пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="e5086-136">UI changes</span></span>

<span data-ttu-id="e5086-137">Элементы пользовательского интерфейса в Office в значительной степени стабильны, но определенное расположение любого элемента пользовательского интерфейса не гарантируется и может измениться по мере развития разработки продукта для включения отзывов пользователей и удовлетворения потребностей клиентов.</span><span class="sxs-lookup"><span data-stu-id="e5086-137">The UI elements in Office are largely stable, but the specific location of any UI element is not guaranteed and might change as the product design evolves to incorporate user feedback and meet customer needs.</span></span> <span data-ttu-id="e5086-138">Для этого должна учитываться логика любой автоматизации.</span><span class="sxs-lookup"><span data-stu-id="e5086-138">The logic of any automation must account for this.</span></span> <span data-ttu-id="e5086-139">Эти изменения могут привести к ряду изменений именования кнопки или вкладки группы, перемещения команд между вкладками, добавления новых вкладок или удаления команд в соответствии с нашими политиками удаления функций.</span><span class="sxs-lookup"><span data-stu-id="e5086-139">These changes might result in button or group tab naming changes, movement of commands between tabs, the addition of new tabs, or the removal of commands in alignment with our feature deprecation policies.</span></span> <span data-ttu-id="e5086-140">Эти изменения могут происходить в пользовательском интерфейсе, а также в сведениях о доступности, предоставляемых приложением, так как эти сведения меняются для повышения эффективности использования и учета текущих отзывов клиентов и могут быть в разное время доступны для разных пользователей.</span><span class="sxs-lookup"><span data-stu-id="e5086-140">These changes can take place in the UI as well as within the accessibility information provided by the application, as that information is modified to improve usability and account for ongoing customer feedback, and might be rolled out for different users at different times.</span></span>

<span data-ttu-id="e5086-141">Даже без изменений продукта различия между системными средами (такими как размер экрана, разрешение и DPI) могут привести к изменениям расположения элементов на экране.</span><span class="sxs-lookup"><span data-stu-id="e5086-141">Even without product changes, differences between system environments (such as screen size/resolution/DPI) can result in changes in the location of items on screen.</span></span> <span data-ttu-id="e5086-142">Любой подход, который использует координаты экрана для имитации пользовательского ввода, должен учитывать эти изменения и адаптироваться соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="e5086-142">Any approach that relies on screen coordinates to simulate user input must consider these changes and adapt accordingly.</span></span>

### <a name="single-threading"></a><span data-ttu-id="e5086-143">Однопотоковая</span><span class="sxs-lookup"><span data-stu-id="e5086-143">Single-threading</span></span>

<span data-ttu-id="e5086-144">Приложения Office — это приложения на основе STA, которые не являются реляционными, предназначенные для предоставления разнообразных, но ресурсоемких функций для одного клиента.</span><span class="sxs-lookup"><span data-stu-id="e5086-144">Office applications are non-reentrant, STA-based applications that are designed to provide diverse but resource-intensive functionality for a single client.</span></span> <span data-ttu-id="e5086-145">Приложения используют глобальные ресурсы, такие как файлы с картой памяти, глобальные надстройки или шаблоны, а также общие серверы автоматизации.</span><span class="sxs-lookup"><span data-stu-id="e5086-145">The applications use global resources such as memory mapped files, global add-ins or templates, and shared automation servers.</span></span> <span data-ttu-id="e5086-146">Это может ограничить число экземпляров, которые могут работать одновременно, и привести к состояниям гонки, если приложения настроены в многоклиентской среде.</span><span class="sxs-lookup"><span data-stu-id="e5086-146">This can limit the number of instances that can run concurrently and can lead to race conditions if the applications are configured in a multiclient environment.</span></span> <span data-ttu-id="e5086-147">Если вы планируете запустить несколько экземпляров любого приложения Office, следует запланировать их изоляцию на уровне виртуальной машины, чтобы обеспечить стабильность итогов решения.</span><span class="sxs-lookup"><span data-stu-id="e5086-147">If you plan to run more than one instance of any Office application, you should plan to isolate them at the virtual machine level to ensure the stability of the resulting solution.</span></span>

### <a name="resiliency-and-stability"></a><span data-ttu-id="e5086-148">Устойчивость и стабильность</span><span class="sxs-lookup"><span data-stu-id="e5086-148">Resiliency and stability</span></span>

<span data-ttu-id="e5086-149">Даже с учетом вышеперечисленных соображений, если приложения автоматизированы способом имитации ввода пользователем или продолжительности сеанса, значительно превышающим интерактивное использование, они могут столкнуться с проблемой, которая не присутствует при интерактивном запуске.</span><span class="sxs-lookup"><span data-stu-id="e5086-149">Even with the considerations above, if the applications are automated in ways that simulate user input or for session lengths that dramatically exceed interactive usage, they might encounter issues that are not present when run interactively.</span></span> <span data-ttu-id="e5086-150">Решения, в которых используется Office в этом контексте, должны заблаговременно создавать механизмы для отслеживания состояния приложения и их перезапуска (и/или виртуальной машины, на которой они работают) при необходимости.</span><span class="sxs-lookup"><span data-stu-id="e5086-150">Solutions that utilize Office in this context should proactively build mechanisms to monitor the state of the application and restart them (and/or the virtual machine on which they are running) if/as needed.</span></span>

## <a name="suggested-alternatives"></a><span data-ttu-id="e5086-151">Рекомендуемые альтернативы</span><span class="sxs-lookup"><span data-stu-id="e5086-151">Suggested Alternatives</span></span>

<span data-ttu-id="e5086-152">Корпорация Майкрософт настоятельно рекомендует использовать несколько альтернатив, которые не требуют установки и запуска Office на стороне сервера и могут выполнять общие задачи более эффективно и быстрее, чем автоматизация в этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="e5086-152">Microsoft strongly recommends a few alternatives that do not require Office to be installed and run server-side, and that can perform common tasks more efficiently and more quickly than automation in this configuration.</span></span> <span data-ttu-id="e5086-153">Прежде чем включать Office в проект как серверный компонент, рассмотрите альтернативные варианты.</span><span class="sxs-lookup"><span data-stu-id="e5086-153">Before you involve Office as a server-side component in your project, consider alternatives.</span></span>

### <a name="microsoft-graph"></a><span data-ttu-id="e5086-154">Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e5086-154">Microsoft Graph</span></span>

<span data-ttu-id="e5086-155">API Microsoft Graph предоставляет доступ к службам, данным и аналитике, которые доступны пользователям и решениям в составе облака Майкрософт, включая множество служб, поддерживающих потребности автоматизации: доступ к почте, календарю, контактам/ файлам пользователей, преобразованию документов, вычислению книги Excel и т. д.</span><span class="sxs-lookup"><span data-stu-id="e5086-155">The Microsoft Graph API provides access to the services, data, and intelligence that are available to users and solutions as part of the Microsoft cloud, including many services supporting the needs of unattended automation: access to users’ mail / calendar / contacts / files, document conversion, Excel workbook calculation, and more.</span></span> <span data-ttu-id="e5086-156">Эти службы предназначены для неавтоматального использования и крупномасштабных доступов, а также используют стандартный синтаксис API с использованием RESTful.</span><span class="sxs-lookup"><span data-stu-id="e5086-156">These services are designed for unattended use and high-scale access, and utilize a standard RESTful API syntax.</span></span> <span data-ttu-id="e5086-157">Дополнительные сведения о Microsoft Graph и о том, как использовать его для работы с данными пользователей, можно найти на следующих веб-сайтах:</span><span class="sxs-lookup"><span data-stu-id="e5086-157">For more information on Microsoft Graph and how to use it to work with users’ data, visit the following:</span></span>

- [<span data-ttu-id="e5086-158">Обзор Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e5086-158">Overview of Microsoft Graph</span></span>](https://docs.microsoft.com/graph/overview) 
- [<span data-ttu-id="e5086-159">Начало работы с Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e5086-159">Get started with Microsoft Graph</span></span>](https://developer.microsoft.com/graph/get-started)
- <span data-ttu-id="e5086-160">[Скачивание файла в другом формате](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (преобразование файла)</span><span class="sxs-lookup"><span data-stu-id="e5086-160">[Download a file in another format](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (file conversion)</span></span>
- <span data-ttu-id="e5086-161">[Работа с Excel в Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (сведения о книге)</span><span class="sxs-lookup"><span data-stu-id="e5086-161">[Working with Excel in Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (workbook details)</span></span>

### <a name="open-xml-file-formats"></a><span data-ttu-id="e5086-162">Форматы файлов Open XML</span><span class="sxs-lookup"><span data-stu-id="e5086-162">Open XML file formats</span></span>

<span data-ttu-id="e5086-163">Многие задачи автоматизации включают создание или редактирование документов.</span><span class="sxs-lookup"><span data-stu-id="e5086-163">Many automation tasks involve document creation or editing.</span></span> <span data-ttu-id="e5086-164">Office поддерживает форматы файлов Open XML, которые позволяют разработчикам создавать, редактировать, читать и преобразовывать содержимое файлов с помощью стандартных технологий XML и ZIP, определенных в стандарте ISO 29500 International Standard.</span><span class="sxs-lookup"><span data-stu-id="e5086-164">Office supports Open XML file formats that let developers create, edit, read, and transform file content using standard XML and ZIP technologies, defined in the ISO 29500 International Standard.</span></span> <span data-ttu-id="e5086-165">Этими форматами файлов можно управлять с помощью любых средств ZIP/XML, включая пространство имен System.IO.Package.IO в Microsoft .NET 3.x Framework.</span><span class="sxs-lookup"><span data-stu-id="e5086-165">These file formats can be manipulated via any ZIP/XML tools, including the System.IO.Package.IO namespace in the Microsoft .NET 3.x Framework.</span></span> <span data-ttu-id="e5086-166">Прямое редактирование форматов файлов — это рекомендуемый и поддерживаемый метод обработки изменений файлов Office из службы.</span><span class="sxs-lookup"><span data-stu-id="e5086-166">Direct editing of the file formats is the recommended and supported method for handling changes to Office files from a service.</span></span>

<span data-ttu-id="e5086-167">Корпорация Майкрософт предоставляет SDK для работы с форматами файлов Open XML из .NET 3.x Framework.</span><span class="sxs-lookup"><span data-stu-id="e5086-167">Microsoft provides an SDK for manipulating Open XML file formats from the .NET 3.x Framework.</span></span> <span data-ttu-id="e5086-168">Дополнительные сведения о SDK и использовании SDK для создания или редактирования файлов Open XML можно найти в следующих материалах:</span><span class="sxs-lookup"><span data-stu-id="e5086-168">For more information about the SDK and how to use the SDK to create or edit Open XML files, visit the following:</span></span>

- [<span data-ttu-id="e5086-169">Общие сведения о форматах файлов Open XML</span><span class="sxs-lookup"><span data-stu-id="e5086-169">Understanding the Open XML file formats</span></span>](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [<span data-ttu-id="e5086-170">Добро пожаловать на страницу пакета SDK 2.5 Open XML для Office</span><span class="sxs-lookup"><span data-stu-id="e5086-170">Welcome to the Open XML SDK 2.5 for Office</span></span>](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
