---
title: Рекомендации по автоматической автоматизации Office в Microsoft 365 для автоматической среды РПА
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: Рекомендации по автоматической автоматизации Office в Microsoft 365 для автоматической среды РПА.
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103052"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a>Рекомендации по автоматической автоматизации Office в Microsoft 365 для автоматической среды РПА

Несмотря на то что Microsoft 365 для автоматической РПА предоставляет лицензию, которая включает автоматизацию Office без пользователя, все текущие версии Office были разработаны и протестированы для работы в качестве конечных пользователей на клиентской рабочей станции с пользовательским интерфейсом для взаимодействия с интерфейсом приложения. Неожиданные поведения, вызванные применением приложений без наличия пользователя, не являются дефектами. Если вы хотите запустить Office в этой конфигурации, необходимо подготовиться к учету этих непредвиденных поведений в логике приложения.

В этой статье рассматриваются некоторые вопросы, касающиеся автоматической автоматизации Office, которые помогут вам при использовании такого подхода. Однако обратите внимание, что использование Office в этой конфигурации строго "как есть" и должно учитывать эти непредвиденные характеристики. Приведенные здесь сведения не являются исчерпывающими и не гарантированно разрешают все проблемы для всех клиентов. Мы рекомендуем тщательно протестировать свое решение перед развертыванием.

## <a name="common-problems-in-unattended-automation"></a>Распространенные проблемы при автоматической автоматизации

Если вы хотите использовать Office без пользователя, учитывайте следующие аспекты, в которых Office может работать не так, как ожидалось. Для успешного выполнения решения необходимо решить эти проблемы и свести к минимуму их влияние на максимально возможный объем. При создании приложения следует учитывать эти проблемы.

### <a name="interactive-ui-elements"></a>Интерактивные элементы пользовательского интерфейса

Приложения Office предполагают, что они работают в интерактивном режиме. Если возникает непредвиденная ошибка или если для завершения функции требуется неопределенный параметр, Office предлагает пользователю диалоговое окно, в котором пользователю предлагается задать способ продолжения. В автоматической автоматизации это может привести к тому, что приложение получит "зависнуть", так как приложение будет остановлено, пока не получит эти входные данные. При автоматизации Office с помощью общедоступных API-интерфейсов вы можете отключить многие из этих оповещений, настроив свойства, такие как [Application. дисплайалертс](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) и [Application. аутоматионсекурити](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) , соответствующим образом. Код должен быть разработан для идентификации и обработки блокирующих оповещений в любое время.

### <a name="user-identity"></a>Удостоверение пользователя

Приложения Office требуют удостоверения пользователя при запуске приложений, даже если приложение запускается с помощью автоматизации. Этот идентификатор пользователя может выполнять любые из следующих действий:

- Присутствие дополнительного пользовательского интерфейса входа, который необходимо обработать.
- Файлы, которые не удается открыть и редактировать в зависимости от разрешений на доступ для отдельных пользователей.
- Непредвиденные изменения метаданных файла (например, определенные свойства файла будут обновлены в соответствии с удостоверением удостоверения пользователя для автоматически создаваемого экземпляра приложения).

С помощью различных подходов можно устранить эти проблемы; Например, запуск [инспектора документов](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) для удаления метаданных. Определите, подходят ли эти подходы в зависимости от вашего сценария.

### <a name="server-side-security"></a>Безопасность на стороне сервера

При автоматическом запуске Office и обработке произвольного содержимого файла не будут доступны дополнительные средства защиты, заданные в этой среде, для предотвращения загрузки и запуска макросов, хранящихся в этих файлах. Office не защищает от непреднамеренного запуска макросов из кода или от запуска другого сервера, который может запускать макросы. Для устранения этого риска можно использовать свойства, такие как [Application. аутоматионсекурити](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) , но необходимо убедиться, что вы загружаете только надежное содержимое.

Кроме того, Office использует множество компонентов (таких как Simple MAPI, WinInet и МСДАИПП), которые могут кэшировать сведения о проверке подлинности клиента для ускорения обработки. Когда Office выполняется автоматически на стороне сервера и обрабатывает несколько файлов, если данные проверки подлинности кэшированы для этого сеанса, один клиент может использовать кэшированные учетные данные другого клиента. Таким образом, клиент может получить доступ к непредоставленным разрешениям, олицетворяя других пользователей.

### <a name="ui-changes"></a>Изменения пользовательского интерфейса

Элементы пользовательского интерфейса в Office в значительной степени стабильны, но конкретное расположение любого элемента пользовательского интерфейса не гарантируется и может измениться, так как проект продукта способствует обратной связи с пользователями и удовлетворения потребностей пользователей. В этом случае необходимо учитывать логику любой автоматизации. Эти изменения могут привести к изменению имен вкладок кнопок или групп, перемещению команд между вкладками, добавлению новых вкладок или удалению команд в выравнивании с нашими политиками устаревших компонентов. Эти изменения могут выполняться в пользовательском интерфейсе, а также в сведениях о доступности, предоставляемых приложением, так как эти сведения изменяются для улучшения удобства использования и учетной записи для выполнения текущих отзывов клиентов и могут быть сведены для разных пользователей в разное время.

Даже без изменений продукта различия между системными средами (например, размером экрана/разрешением/DPI) могут привести к изменениям расположения элементов на экране. Любой подход, который использует экранные координаты для имитации вводимых пользователем данных, должен учитывать эти изменения и соответствующим образом адаптироваться.

### <a name="single-threading"></a>Односторонняя Организация

Приложения Office — это неповторяющиеся приложения на основе потоков, предназначенные для обеспечения разнообразных, но функциональных возможностей для одного клиента. В приложениях используются глобальные ресурсы, такие как файлы, сопоставленные с памятью, глобальные надстройки, шаблоны и общие серверы автоматизации. Это может привести к ограничению числа экземпляров, которые могут выполняться одновременно и могут привести к конкуренции, если приложения настроены в среде с несколькими клиентами. Если планируется запускать несколько экземпляров любого приложения Office, следует запланировать их на уровне виртуальной машины, чтобы обеспечить стабильность полученного решения.

### <a name="resiliency-and-stability"></a>Устойчивость и стабильность

Даже с помощью описанных выше рекомендаций, если приложения автоматизированы так, чтобы имитировать входные данные пользователя или для тех периодов, которые значительно превышают интерактивное использование, они могут столкнуться с проблемами, не присутствующими в интерактивном режиме. Решения, использующие Office в этом контексте, должны заблаговременно создавать механизмы для отслеживания состояния приложения и перезапускать их (и/или виртуальную машину, на которой они выполняются), если это необходимо.

## <a name="suggested-alternatives"></a>Предлагаемые альтернативные варианты

Корпорация Майкрософт настоятельно рекомендует использовать несколько вариантов, которые не требуют установки Office и запуска серверной стороны, и могут выполнять стандартные задачи более эффективно и быстрее, чем Автоматизация в этой конфигурации. Прежде чем приступить к работе с Office в качестве серверного компонента в проекте, рекомендуется рассмотреть альтернативные варианты.

### <a name="microsoft-graph"></a>Microsoft Graph

API Microsoft Graph предоставляет доступ к службам, данным и аналитикам, доступным для пользователей и решений в составе Microsoft Cloud, включая множество служб, поддерживающих требования автоматической автоматизации: доступ к почте, календарю, контактам и файлам, преобразованию документов, вычислениям книги Excel и т. д. Эти службы предназначены для автоматического использования и доступа с высоким уровнем доступа и используют стандартный синтаксис API REST. Для получения дополнительных сведений о Microsoft Graph и способах его использования для работы с данными пользователей посетите следующий сайт:

- [Обзор Microsoft Graph](https://docs.microsoft.com/graph/overview) 
- [Начало работы с Microsoft Graph](https://developer.microsoft.com/graph/get-started)
- [Загрузка файла в другом формате](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (преобразование файлов)
- [Работа с Excel в Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (сведения о книге)

### <a name="open-xml-file-formats"></a>Форматы файлов Open XML

Многие задачи автоматизации предполагают создание и редактирование документов. Office поддерживает форматы файлов Open XML, которые позволяют разработчикам создавать, редактировать, читать и преобразовывать содержимое файлов с помощью стандартных технологий XML и ZIP, определенных в стандарте ISO 29500 International. Эти форматы файлов можно обрабатывать с помощью любого средства ZIP/XML, включая пространство имен System.IO.Package.IO в платформе Microsoft .NET 3. x. Непосредственное редактирование форматов файлов это рекомендуемый и поддерживаемый метод обработки изменений файлов Office из службы.

Корпорация Майкрософт предоставляет пакет SDK для управления форматами файлов Open XML из платформы .NET 3. x. Для получения дополнительных сведений о пакете SDK и о том, как использовать пакет SDK для создания и редактирования файлов Open XML, перейдите по следующему адресу:

- [Общие сведения о форматах файлов Open XML](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [Добро пожаловать на страницу пакета SDK 2.5 Open XML для Office](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
