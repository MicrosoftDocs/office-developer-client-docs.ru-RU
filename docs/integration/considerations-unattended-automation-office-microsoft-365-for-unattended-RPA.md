---
title: Рекомендации по автоматической автоматизации Office в Microsoft 365 для автоматической среды РПА
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: Рекомендации по автоматической автоматизации Office в Microsoft 365 для автоматической среды РПА.
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103052"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a><span data-ttu-id="e17e9-103">Рекомендации по автоматической автоматизации Office в Microsoft 365 для автоматической среды РПА</span><span class="sxs-lookup"><span data-stu-id="e17e9-103">Considerations for unattended automation of Office in the Microsoft 365 for unattended RPA environment</span></span>

<span data-ttu-id="e17e9-104">Несмотря на то что Microsoft 365 для автоматической РПА предоставляет лицензию, которая включает автоматизацию Office без пользователя, все текущие версии Office были разработаны и протестированы для работы в качестве конечных пользователей на клиентской рабочей станции с пользовательским интерфейсом для взаимодействия с интерфейсом приложения.</span><span class="sxs-lookup"><span data-stu-id="e17e9-104">Although Microsoft 365 for unattended RPA provides a license that enables the automation of Office with no user present, all current versions of Office were designed and tested to run as end-user products on a client workstation with a user present to interact with the application’s interface.</span></span> <span data-ttu-id="e17e9-105">Неожиданные поведения, вызванные применением приложений без наличия пользователя, не являются дефектами.</span><span class="sxs-lookup"><span data-stu-id="e17e9-105">Unexpected behaviors resulting from the use of applications without a user present are not defects.</span></span> <span data-ttu-id="e17e9-106">Если вы хотите запустить Office в этой конфигурации, необходимо подготовиться к учету этих непредвиденных поведений в логике приложения.</span><span class="sxs-lookup"><span data-stu-id="e17e9-106">If you want to run Office in this configuration, you must be prepared to account for these unexpected behaviors in your application logic.</span></span>

<span data-ttu-id="e17e9-107">В этой статье рассматриваются некоторые вопросы, касающиеся автоматической автоматизации Office, которые помогут вам при использовании такого подхода.</span><span class="sxs-lookup"><span data-stu-id="e17e9-107">This article outlines some of the considerations for unattended automation of Office to help you if you use this approach.</span></span> <span data-ttu-id="e17e9-108">Однако обратите внимание, что использование Office в этой конфигурации строго "как есть" и должно учитывать эти непредвиденные характеристики.</span><span class="sxs-lookup"><span data-stu-id="e17e9-108">However, note that usage of Office in this configuration is strictly “AS IS” and must account for these unexpected behaviors.</span></span> <span data-ttu-id="e17e9-109">Приведенные здесь сведения не являются исчерпывающими и не гарантированно разрешают все проблемы для всех клиентов.</span><span class="sxs-lookup"><span data-stu-id="e17e9-109">The information provided here is not exhaustive and is not guaranteed to resolve all issues for all clients.</span></span> <span data-ttu-id="e17e9-110">Мы рекомендуем тщательно протестировать свое решение перед развертыванием.</span><span class="sxs-lookup"><span data-stu-id="e17e9-110">We encourage you to test your solution thoroughly before you deploy.</span></span>

## <a name="common-problems-in-unattended-automation"></a><span data-ttu-id="e17e9-111">Распространенные проблемы при автоматической автоматизации</span><span class="sxs-lookup"><span data-stu-id="e17e9-111">Common problems in unattended automation</span></span>

<span data-ttu-id="e17e9-112">Если вы хотите использовать Office без пользователя, учитывайте следующие аспекты, в которых Office может работать не так, как ожидалось.</span><span class="sxs-lookup"><span data-stu-id="e17e9-112">If you want to use Office without a user present, be aware of the following areas in which Office can behave differently than expected.</span></span> <span data-ttu-id="e17e9-113">Для успешного выполнения решения необходимо решить эти проблемы и свести к минимуму их влияние на максимально возможный объем.</span><span class="sxs-lookup"><span data-stu-id="e17e9-113">For your solution to run successfully, it must address these issues and minimize their effects as much as possible.</span></span> <span data-ttu-id="e17e9-114">При создании приложения следует учитывать эти проблемы.</span><span class="sxs-lookup"><span data-stu-id="e17e9-114">Consider these issues carefully when you build your application.</span></span>

### <a name="interactive-ui-elements"></a><span data-ttu-id="e17e9-115">Интерактивные элементы пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="e17e9-115">Interactive UI elements</span></span>

<span data-ttu-id="e17e9-116">Приложения Office предполагают, что они работают в интерактивном режиме.</span><span class="sxs-lookup"><span data-stu-id="e17e9-116">Office applications assume that they are being run interactively.</span></span> <span data-ttu-id="e17e9-117">Если возникает непредвиденная ошибка или если для завершения функции требуется неопределенный параметр, Office предлагает пользователю диалоговое окно, в котором пользователю предлагается задать способ продолжения.</span><span class="sxs-lookup"><span data-stu-id="e17e9-117">If an unexpected error occurs, or if an unspecified parameter is needed to complete a function, Office is designed to prompt the user with a dialog box that asks the user how they want to proceed.</span></span> <span data-ttu-id="e17e9-118">В автоматической автоматизации это может привести к тому, что приложение получит "зависнуть", так как приложение будет остановлено, пока не получит эти входные данные.</span><span class="sxs-lookup"><span data-stu-id="e17e9-118">In unattended automation, this might result in the application appearing to “hang” as the application stops until it receives this input.</span></span> <span data-ttu-id="e17e9-119">При автоматизации Office с помощью общедоступных API-интерфейсов вы можете отключить многие из этих оповещений, настроив свойства, такие как [Application. дисплайалертс](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) и [Application. аутоматионсекурити](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) , соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="e17e9-119">If you’re automating Office via its public APIs, you can suppress many of these alerts by configuring properties like [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) and [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) appropriately.</span></span> <span data-ttu-id="e17e9-120">Код должен быть разработан для идентификации и обработки блокирующих оповещений в любое время.</span><span class="sxs-lookup"><span data-stu-id="e17e9-120">Your code should be designed to identify and process blocking alerts at any time.</span></span>

### <a name="user-identity"></a><span data-ttu-id="e17e9-121">Удостоверение пользователя</span><span class="sxs-lookup"><span data-stu-id="e17e9-121">User identity</span></span>

<span data-ttu-id="e17e9-122">Приложения Office требуют удостоверения пользователя при запуске приложений, даже если приложение запускается с помощью автоматизации.</span><span class="sxs-lookup"><span data-stu-id="e17e9-122">Office applications require a user identity when the applications are run, even when the application is started via automation.</span></span> <span data-ttu-id="e17e9-123">Этот идентификатор пользователя может выполнять любые из следующих действий:</span><span class="sxs-lookup"><span data-stu-id="e17e9-123">This user identity can cause any or all of the following:</span></span>

- <span data-ttu-id="e17e9-124">Присутствие дополнительного пользовательского интерфейса входа, который необходимо обработать.</span><span class="sxs-lookup"><span data-stu-id="e17e9-124">The presence of additional sign-in UI that must be handled.</span></span>
- <span data-ttu-id="e17e9-125">Файлы, которые не удается открыть и редактировать в зависимости от разрешений на доступ для отдельных пользователей.</span><span class="sxs-lookup"><span data-stu-id="e17e9-125">Files that cannot be opened and/or edited based on per-user access permissions.</span></span>
- <span data-ttu-id="e17e9-126">Непредвиденные изменения метаданных файла (например, определенные свойства файла будут обновлены в соответствии с удостоверением удостоверения пользователя для автоматически создаваемого экземпляра приложения).</span><span class="sxs-lookup"><span data-stu-id="e17e9-126">Unexpected changes to the metadata of the file (for example, certain file properties will be updated based on the identity of the user identity of the automated application instance).</span></span>

<span data-ttu-id="e17e9-127">С помощью различных подходов можно устранить эти проблемы; Например, запуск [инспектора документов](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) для удаления метаданных.</span><span class="sxs-lookup"><span data-stu-id="e17e9-127">Various approaches can help to mitigate these issues; for example, running the [Document Inspector](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) to remove metadata.</span></span> <span data-ttu-id="e17e9-128">Определите, подходят ли эти подходы в зависимости от вашего сценария.</span><span class="sxs-lookup"><span data-stu-id="e17e9-128">Consider whether these approaches are appropriate based on your scenario.</span></span>

### <a name="server-side-security"></a><span data-ttu-id="e17e9-129">Безопасность на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="e17e9-129">Server-side security</span></span>

<span data-ttu-id="e17e9-130">При автоматическом запуске Office и обработке произвольного содержимого файла не будут доступны дополнительные средства защиты, заданные в этой среде, для предотвращения загрузки и запуска макросов, хранящихся в этих файлах.</span><span class="sxs-lookup"><span data-stu-id="e17e9-130">When running Office unattended and processing arbitrary file content, no additional protections specific in that environment are available to prevent macros stored in those files from loading and running.</span></span> <span data-ttu-id="e17e9-131">Office не защищает от непреднамеренного запуска макросов из кода или от запуска другого сервера, который может запускать макросы.</span><span class="sxs-lookup"><span data-stu-id="e17e9-131">Office does not protect you from unintentionally running macros from your code, or from starting another server that might run macros.</span></span> <span data-ttu-id="e17e9-132">Для устранения этого риска можно использовать свойства, такие как [Application. аутоматионсекурити](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) , но необходимо убедиться, что вы загружаете только надежное содержимое.</span><span class="sxs-lookup"><span data-stu-id="e17e9-132">You can use properties like [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) to mitigate this risk, but you should ensure that you are only loading trusted content.</span></span>

<span data-ttu-id="e17e9-133">Кроме того, Office использует множество компонентов (таких как Simple MAPI, WinInet и МСДАИПП), которые могут кэшировать сведения о проверке подлинности клиента для ускорения обработки.</span><span class="sxs-lookup"><span data-stu-id="e17e9-133">Additionally, Office uses many components (such as Simple MAPI, WinInet, and MSDAIPP) that can cache client authentication information to speed processing.</span></span> <span data-ttu-id="e17e9-134">Когда Office выполняется автоматически на стороне сервера и обрабатывает несколько файлов, если данные проверки подлинности кэшированы для этого сеанса, один клиент может использовать кэшированные учетные данные другого клиента.</span><span class="sxs-lookup"><span data-stu-id="e17e9-134">When Office is being automated server-side and processing multiple files, if authentication information has been cached for that session, one client can use the cached credentials of another client.</span></span> <span data-ttu-id="e17e9-135">Таким образом, клиент может получить доступ к непредоставленным разрешениям, олицетворяя других пользователей.</span><span class="sxs-lookup"><span data-stu-id="e17e9-135">Therefore, the client can gain non-granted access permissions by impersonating other users.</span></span>

### <a name="ui-changes"></a><span data-ttu-id="e17e9-136">Изменения пользовательского интерфейса</span><span class="sxs-lookup"><span data-stu-id="e17e9-136">UI changes</span></span>

<span data-ttu-id="e17e9-137">Элементы пользовательского интерфейса в Office в значительной степени стабильны, но конкретное расположение любого элемента пользовательского интерфейса не гарантируется и может измениться, так как проект продукта способствует обратной связи с пользователями и удовлетворения потребностей пользователей.</span><span class="sxs-lookup"><span data-stu-id="e17e9-137">The UI elements in Office are largely stable, but the specific location of any UI element is not guaranteed and might change as the product design evolves to incorporate user feedback and meet customer needs.</span></span> <span data-ttu-id="e17e9-138">В этом случае необходимо учитывать логику любой автоматизации.</span><span class="sxs-lookup"><span data-stu-id="e17e9-138">The logic of any automation must account for this.</span></span> <span data-ttu-id="e17e9-139">Эти изменения могут привести к изменению имен вкладок кнопок или групп, перемещению команд между вкладками, добавлению новых вкладок или удалению команд в выравнивании с нашими политиками устаревших компонентов.</span><span class="sxs-lookup"><span data-stu-id="e17e9-139">These changes might result in button or group tab naming changes, movement of commands between tabs, the addition of new tabs, or the removal of commands in alignment with our feature deprecation policies.</span></span> <span data-ttu-id="e17e9-140">Эти изменения могут выполняться в пользовательском интерфейсе, а также в сведениях о доступности, предоставляемых приложением, так как эти сведения изменяются для улучшения удобства использования и учетной записи для выполнения текущих отзывов клиентов и могут быть сведены для разных пользователей в разное время.</span><span class="sxs-lookup"><span data-stu-id="e17e9-140">These changes can take place in the UI as well as within the accessibility information provided by the application, as that information is modified to improve usability and account for ongoing customer feedback, and might be rolled out for different users at different times.</span></span>

<span data-ttu-id="e17e9-141">Даже без изменений продукта различия между системными средами (например, размером экрана/разрешением/DPI) могут привести к изменениям расположения элементов на экране.</span><span class="sxs-lookup"><span data-stu-id="e17e9-141">Even without product changes, differences between system environments (such as screen size/resolution/DPI) can result in changes in the location of items on screen.</span></span> <span data-ttu-id="e17e9-142">Любой подход, который использует экранные координаты для имитации вводимых пользователем данных, должен учитывать эти изменения и соответствующим образом адаптироваться.</span><span class="sxs-lookup"><span data-stu-id="e17e9-142">Any approach that relies on screen coordinates to simulate user input must consider these changes and adapt accordingly.</span></span>

### <a name="single-threading"></a><span data-ttu-id="e17e9-143">Односторонняя Организация</span><span class="sxs-lookup"><span data-stu-id="e17e9-143">Single-threading</span></span>

<span data-ttu-id="e17e9-144">Приложения Office — это неповторяющиеся приложения на основе потоков, предназначенные для обеспечения разнообразных, но функциональных возможностей для одного клиента.</span><span class="sxs-lookup"><span data-stu-id="e17e9-144">Office applications are non-reentrant, STA-based applications that are designed to provide diverse but resource-intensive functionality for a single client.</span></span> <span data-ttu-id="e17e9-145">В приложениях используются глобальные ресурсы, такие как файлы, сопоставленные с памятью, глобальные надстройки, шаблоны и общие серверы автоматизации.</span><span class="sxs-lookup"><span data-stu-id="e17e9-145">The applications use global resources such as memory mapped files, global add-ins or templates, and shared automation servers.</span></span> <span data-ttu-id="e17e9-146">Это может привести к ограничению числа экземпляров, которые могут выполняться одновременно и могут привести к конкуренции, если приложения настроены в среде с несколькими клиентами.</span><span class="sxs-lookup"><span data-stu-id="e17e9-146">This can limit the number of instances that can run concurrently and can lead to race conditions if the applications are configured in a multiclient environment.</span></span> <span data-ttu-id="e17e9-147">Если планируется запускать несколько экземпляров любого приложения Office, следует запланировать их на уровне виртуальной машины, чтобы обеспечить стабильность полученного решения.</span><span class="sxs-lookup"><span data-stu-id="e17e9-147">If you plan to run more than one instance of any Office application, you should plan to isolate them at the virtual machine level to ensure the stability of the resulting solution.</span></span>

### <a name="resiliency-and-stability"></a><span data-ttu-id="e17e9-148">Устойчивость и стабильность</span><span class="sxs-lookup"><span data-stu-id="e17e9-148">Resiliency and stability</span></span>

<span data-ttu-id="e17e9-149">Даже с помощью описанных выше рекомендаций, если приложения автоматизированы так, чтобы имитировать входные данные пользователя или для тех периодов, которые значительно превышают интерактивное использование, они могут столкнуться с проблемами, не присутствующими в интерактивном режиме.</span><span class="sxs-lookup"><span data-stu-id="e17e9-149">Even with the considerations above, if the applications are automated in ways that simulate user input or for session lengths that dramatically exceed interactive usage, they might encounter issues that are not present when run interactively.</span></span> <span data-ttu-id="e17e9-150">Решения, использующие Office в этом контексте, должны заблаговременно создавать механизмы для отслеживания состояния приложения и перезапускать их (и/или виртуальную машину, на которой они выполняются), если это необходимо.</span><span class="sxs-lookup"><span data-stu-id="e17e9-150">Solutions that utilize Office in this context should proactively build mechanisms to monitor the state of the application and restart them (and/or the virtual machine on which they are running) if/as needed.</span></span>

## <a name="suggested-alternatives"></a><span data-ttu-id="e17e9-151">Предлагаемые альтернативные варианты</span><span class="sxs-lookup"><span data-stu-id="e17e9-151">Suggested Alternatives</span></span>

<span data-ttu-id="e17e9-152">Корпорация Майкрософт настоятельно рекомендует использовать несколько вариантов, которые не требуют установки Office и запуска серверной стороны, и могут выполнять стандартные задачи более эффективно и быстрее, чем Автоматизация в этой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="e17e9-152">Microsoft strongly recommends a few alternatives that do not require Office to be installed and run server-side, and that can perform common tasks more efficiently and more quickly than automation in this configuration.</span></span> <span data-ttu-id="e17e9-153">Прежде чем приступить к работе с Office в качестве серверного компонента в проекте, рекомендуется рассмотреть альтернативные варианты.</span><span class="sxs-lookup"><span data-stu-id="e17e9-153">Before you involve Office as a server-side component in your project, consider alternatives.</span></span>

### <a name="microsoft-graph"></a><span data-ttu-id="e17e9-154">Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e17e9-154">Microsoft Graph</span></span>

<span data-ttu-id="e17e9-155">API Microsoft Graph предоставляет доступ к службам, данным и аналитикам, доступным для пользователей и решений в составе Microsoft Cloud, включая множество служб, поддерживающих требования автоматической автоматизации: доступ к почте, календарю, контактам и файлам, преобразованию документов, вычислениям книги Excel и т. д.</span><span class="sxs-lookup"><span data-stu-id="e17e9-155">The Microsoft Graph API provides access to the services, data, and intelligence that are available to users and solutions as part of the Microsoft cloud, including many services supporting the needs of unattended automation: access to users’ mail / calendar / contacts / files, document conversion, Excel workbook calculation, and more.</span></span> <span data-ttu-id="e17e9-156">Эти службы предназначены для автоматического использования и доступа с высоким уровнем доступа и используют стандартный синтаксис API REST.</span><span class="sxs-lookup"><span data-stu-id="e17e9-156">These services are designed for unattended use and high-scale access, and utilize a standard RESTful API syntax.</span></span> <span data-ttu-id="e17e9-157">Для получения дополнительных сведений о Microsoft Graph и способах его использования для работы с данными пользователей посетите следующий сайт:</span><span class="sxs-lookup"><span data-stu-id="e17e9-157">For more information on Microsoft Graph and how to use it to work with users’ data, visit the following:</span></span>

- [<span data-ttu-id="e17e9-158">Обзор Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e17e9-158">Overview of Microsoft Graph</span></span>](https://docs.microsoft.com/graph/overview) 
- [<span data-ttu-id="e17e9-159">Начало работы с Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e17e9-159">Get started with Microsoft Graph</span></span>](https://developer.microsoft.com/graph/get-started)
- <span data-ttu-id="e17e9-160">[Загрузка файла в другом формате](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (преобразование файлов)</span><span class="sxs-lookup"><span data-stu-id="e17e9-160">[Download a file in another format](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (file conversion)</span></span>
- <span data-ttu-id="e17e9-161">[Работа с Excel в Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (сведения о книге)</span><span class="sxs-lookup"><span data-stu-id="e17e9-161">[Working with Excel in Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (workbook details)</span></span>

### <a name="open-xml-file-formats"></a><span data-ttu-id="e17e9-162">Форматы файлов Open XML</span><span class="sxs-lookup"><span data-stu-id="e17e9-162">Open XML file formats</span></span>

<span data-ttu-id="e17e9-163">Многие задачи автоматизации предполагают создание и редактирование документов.</span><span class="sxs-lookup"><span data-stu-id="e17e9-163">Many automation tasks involve document creation or editing.</span></span> <span data-ttu-id="e17e9-164">Office поддерживает форматы файлов Open XML, которые позволяют разработчикам создавать, редактировать, читать и преобразовывать содержимое файлов с помощью стандартных технологий XML и ZIP, определенных в стандарте ISO 29500 International.</span><span class="sxs-lookup"><span data-stu-id="e17e9-164">Office supports Open XML file formats that let developers create, edit, read, and transform file content using standard XML and ZIP technologies, defined in the ISO 29500 International Standard.</span></span> <span data-ttu-id="e17e9-165">Эти форматы файлов можно обрабатывать с помощью любого средства ZIP/XML, включая пространство имен System.IO.Package.IO в платформе Microsoft .NET 3. x.</span><span class="sxs-lookup"><span data-stu-id="e17e9-165">These file formats can be manipulated via any ZIP/XML tools, including the System.IO.Package.IO namespace in the Microsoft .NET 3.x Framework.</span></span> <span data-ttu-id="e17e9-166">Непосредственное редактирование форматов файлов это рекомендуемый и поддерживаемый метод обработки изменений файлов Office из службы.</span><span class="sxs-lookup"><span data-stu-id="e17e9-166">Direct editing of the file formats is the recommended and supported method for handling changes to Office files from a service.</span></span>

<span data-ttu-id="e17e9-167">Корпорация Майкрософт предоставляет пакет SDK для управления форматами файлов Open XML из платформы .NET 3. x.</span><span class="sxs-lookup"><span data-stu-id="e17e9-167">Microsoft provides an SDK for manipulating Open XML file formats from the .NET 3.x Framework.</span></span> <span data-ttu-id="e17e9-168">Для получения дополнительных сведений о пакете SDK и о том, как использовать пакет SDK для создания и редактирования файлов Open XML, перейдите по следующему адресу:</span><span class="sxs-lookup"><span data-stu-id="e17e9-168">For more information about the SDK and how to use the SDK to create or edit Open XML files, visit the following:</span></span>

- [<span data-ttu-id="e17e9-169">Общие сведения о форматах файлов Open XML</span><span class="sxs-lookup"><span data-stu-id="e17e9-169">Understanding the Open XML file formats</span></span>](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [<span data-ttu-id="e17e9-170">Добро пожаловать на страницу пакета SDK 2.5 Open XML для Office</span><span class="sxs-lookup"><span data-stu-id="e17e9-170">Welcome to the Open XML SDK 2.5 for Office</span></span>](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
