---
title: Интеграция универсальных приложений для Windows с приложениями Office
manager: soliver
ms.date: 02/06/2017
ms.audience: Developer
localization_priority: Normal
ms.assetid: 60b4fa23-0075-4f6a-8bd0-9e53e99432d5
description: Вы можете интегрировать сторонние приложения на универсальной платформе приложений Windows с Excel Mobile, русская версия, PowerPoint Mobile и Word Mobile. Универсальные приложения интегрируются с приложениями Office с помощью контрактов выбора файлов Windows, свойств Expando и контрактов обновления кэшированных файлов.
ms.openlocfilehash: ad04ccc3ceb6e0f1d53e4aebc12cf9724ab8ab66
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "32299772"
---
# <a name="integrate-with-office-from-windows-universal-apps"></a><span data-ttu-id="4b121-104">Интеграция универсальных приложений Windows с Office</span><span class="sxs-lookup"><span data-stu-id="4b121-104">Integrate with Office from Windows universal apps</span></span>

<span data-ttu-id="4b121-p102">Вы можете интегрировать сторонние приложения на универсальной платформе приложений Windows с Excel Mobile, русская версия, PowerPoint Mobile и Word Mobile. Универсальные приложения интегрируются с приложениями Office с помощью [контрактов выбора файлов Windows](https://msdn.microsoft.com/library/windows/apps/hh465174.aspx), [свойств Expando](https://msdn.microsoft.com/library/windows/apps/xaml/hh770655.aspx) и [контрактов обновления кэшированных файлов](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.cachedfileupdater.aspx).</span><span class="sxs-lookup"><span data-stu-id="4b121-p102">You can integrate your Windows universal app platform third-party apps with Excel Mobile, PowerPoint Mobile, and Word Mobile. Universal apps integrate with Office apps via Windows [file picker contracts](https://msdn.microsoft.com/library/windows/apps/hh465174.aspx), [expando properties](https://msdn.microsoft.com/library/windows/apps/xaml/hh770655.aspx), and [Cached File Updater contracts](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.cachedfileupdater.aspx).</span></span>
  
<span data-ttu-id="4b121-p103">Когда вы интегрируете универсальное приложение с Excel, PowerPoint или Word Mobile, пользователи могут открывать предоставленные вашим приложением документы Office либо непосредственно в Office, либо используя Windows в вашем приложении. Кроме того, пользователи могут сохранять файлы в вашем универсальном приложении, которое отправляет их обратно в вашу службу.</span><span class="sxs-lookup"><span data-stu-id="4b121-p103">When you integrate your universal app with Excel, PowerPoint, or Word Mobile, your users can open Office documents that your app provides, either when they browse from within Office or when they use Windows to open files from within your app. Users can also save the file back to your universal app, which uploads the file back to your service.</span></span>
  
<span data-ttu-id="4b121-109">Открытые таким образом файлы оказываются в списке последних использованных документов в Office, поэтому пользователи могут легко найти и открыть их.</span><span class="sxs-lookup"><span data-stu-id="4b121-109">Files opened this way appear in the Recent list in Office, so your users can easily find and reopen them.</span></span>
  
<span data-ttu-id="4b121-110">Для интеграции ваше универсальное приложение должно:</span><span class="sxs-lookup"><span data-stu-id="4b121-110">This integration requires that your universal app:</span></span>
    
- <span data-ttu-id="4b121-111">использовать [контракты выбора файлов](https://msdn.microsoft.com/library/windows/apps/hh465174.aspx) в Windows;</span><span class="sxs-lookup"><span data-stu-id="4b121-111">Implements the Windows [file picker contracts](https://msdn.microsoft.com/library/windows/apps/hh465174.aspx).</span></span>
    
- <span data-ttu-id="4b121-112">иметь возможность хранения файлов (например, приложение с доступом к облачному хранилищу).</span><span class="sxs-lookup"><span data-stu-id="4b121-112">Represents a file store (for example, an app that allows access to cloud storage).</span></span>
    
## <a name="expando-properties"></a><span data-ttu-id="4b121-113">Свойства Expando</span><span class="sxs-lookup"><span data-stu-id="4b121-113">Expando properties</span></span>

<span data-ttu-id="4b121-p104">Универсальные приложения Windows могут использовать свойства Expando для передачи дополнительной информации, связанной с файлами. Сведения об использовании этих свойств в Windows см. в разделе "System.ExpandoProperties" статьи [StorageItemContentProperties.SavePropertiesAsync](https://msdn.microsoft.com/library/windows/apps/xaml/hh770655.aspx).</span><span class="sxs-lookup"><span data-stu-id="4b121-p104">Windows universal apps can use Expando properties to communicate additional information that is associated with files. For information about how this works in Windows, see "System.ExpandoProperties" in [StorageItemContentProperties.SavePropertiesAsync](https://msdn.microsoft.com/library/windows/apps/xaml/hh770655.aspx).</span></span>
  
<span data-ttu-id="4b121-p105">В таблице ниже описаны свойства, которые ваше приложение должно предоставить приложениям Office для применения сценариев открытия файлов. Если эти данные не предоставляются, все файлы в вашем приложении открываются как доступные только для чтения. То, смогут ли пользователи редактировать файлы, зависит от типа их лицензии Office, а также от типа документа, который они пытаются открыть.</span><span class="sxs-lookup"><span data-stu-id="4b121-p105">The following table describes the properties that your app has to provide to Office to enable file open scenarios. If this information is not provided, all files from your app are opened as read only. Whether users can open files for editing depends on the type of Office license they have and the type of document they're trying to open.</span></span>
  
<span data-ttu-id="4b121-119">Задайте эти свойства в наборе свойств **System.ExpandoProperties**.</span><span class="sxs-lookup"><span data-stu-id="4b121-119">Set these properties in the **System.ExpandoProperties** property set.</span></span> 
  
|<span data-ttu-id="4b121-120">**Свойство**</span><span class="sxs-lookup"><span data-stu-id="4b121-120">**Property**</span></span>|<span data-ttu-id="4b121-121">**Описание**</span><span class="sxs-lookup"><span data-stu-id="4b121-121">**Description**</span></span>|<span data-ttu-id="4b121-122">**Тип**</span><span class="sxs-lookup"><span data-stu-id="4b121-122">**Type**</span></span>|<span data-ttu-id="4b121-123">**Пример**</span><span class="sxs-lookup"><span data-stu-id="4b121-123">**Example**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="4b121-124">**AppDisplayName**</span><span class="sxs-lookup"><span data-stu-id="4b121-124">**AppDisplayName**</span></span> <br/> |<span data-ttu-id="4b121-p106">Имя поставщика, которое видно пользователю. Отображается в различных местах в Office, например в списке последних использованных документов.</span><span class="sxs-lookup"><span data-stu-id="4b121-p106">Provider name to display to the user. Appears in multiple places in Office, such as the recent document list.</span></span>  <br/> |<span data-ttu-id="4b121-127">Строка</span><span class="sxs-lookup"><span data-stu-id="4b121-127">String</span></span>  <br/> |<span data-ttu-id="4b121-128">Contoso</span><span class="sxs-lookup"><span data-stu-id="4b121-128">Contoso</span></span>  <br/> |
|<span data-ttu-id="4b121-129">**MicrosoftOfficeOwnershipType**</span><span class="sxs-lookup"><span data-stu-id="4b121-129">**MicrosoftOfficeOwnershipType**</span></span> <br/> |<span data-ttu-id="4b121-p107">Для лицензирования укажите тип владения/расположение документа: личный (принадлежит отдельному пользователю) или рабочий (принадлежит компании). Допустимые значения: 1 (личный) и 2 (рабочий). Например, если файл пользователя находится в хранилище компании Contoso, используйте значение "2" (рабочий).</span><span class="sxs-lookup"><span data-stu-id="4b121-p107">For licensing, indicate whether the document/location is Personal/Consumer or Work/Business. Allowed values are 1 (personal) and 2 (business). For example, if your user's file is stored in Contoso Business, use the value "2" for business.</span></span>  <br/> |<span data-ttu-id="4b121-133">Unit32</span><span class="sxs-lookup"><span data-stu-id="4b121-133">Unit32</span></span>  <br/> | <span data-ttu-id="4b121-134">1 или 2</span><span class="sxs-lookup"><span data-stu-id="4b121-134">1 or 2</span></span>  <br/> <span data-ttu-id="4b121-135">Например, если файл пользователя находится в хранилище компании Contoso, для него устанавливается значение 2 (рабочий).</span><span class="sxs-lookup"><span data-stu-id="4b121-135">For example, if your user's file is stored in Contoso Business, this file should be marked 2 for business.</span></span>  <br/> |
|<span data-ttu-id="4b121-136">**MicrosoftOfficeTermsOfUse**</span><span class="sxs-lookup"><span data-stu-id="4b121-136">**MicrosoftOfficeTermsOfUse**</span></span> <br/> |<span data-ttu-id="4b121-p108">Юридическая часть, в которой вы заявляете, что предоставляемая вами информация соответствует нашим условиям использования. Эта часть не видна пользователю. Это соглашение между вами, поставщиком приложения и корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="4b121-p108">Legal text to declare that the information you provide is accurate per our terms of use. This text is not displayed to the user. It is an agreement between you, the application provider, and Microsoft.</span></span>  <br/> <span data-ttu-id="4b121-140">Ниже приведен пример.</span><span class="sxs-lookup"><span data-stu-id="4b121-140">See the following for an example.</span></span>  <br/> | <span data-ttu-id="4b121-141">String</span><span class="sxs-lookup"><span data-stu-id="4b121-141">String</span></span>  <br/> | <span data-ttu-id="4b121-142">Я соглашаюсь с условиями, размещенными на странице [https://go.microsoft.com/fwlink/p/?LinkId=528381](third-party-applications-integrating-with-office-mobile-products.md)</span><span class="sxs-lookup"><span data-stu-id="4b121-142">I agree to the terms located in [https://go.microsoft.com/fwlink/p/?LinkId=528381](third-party-applications-integrating-with-office-mobile-products.md)</span></span> <br/> |
   
<span data-ttu-id="4b121-143">В приведенном ниже примере кода показано, как задать эти свойства.</span><span class="sxs-lookup"><span data-stu-id="4b121-143">The following code example shows how to set these properties.</span></span>
  
```cs
public static async Task SetExpandoProperties(StorageFile file,... other params ...) 
  { 
     var expandoProperties = new PropertySet(); 
     expandoProperties.Add("AppDisplayName", "Contoso",);  
     // String value. 
     expandoProperties.Add("MicrosoftOfficeOwnershipType", 1);  
     // Unit32 value - 1 (for personal), 2 (for business).  
     expandoProperties.Add("MicrosoftOfficeTermsOfUse", "I agree to the terms located at https://go.microsoft.com/fwlink/p/?LinkId=528381");   
    // String value. 
          
       var fileProperties = new PropertySet(); 
       fileProperties.Add("System.ExpandoProperties", expandoProperties); 
       await file.Properties.SavePropertiesAsync(fileProperties); 
  } 

```

## <a name="cached-file-updater-contracts"></a><span data-ttu-id="4b121-144">Контракты обновления кэшированных файлов</span><span class="sxs-lookup"><span data-stu-id="4b121-144">Cached File Updater contracts</span></span>

<span data-ttu-id="4b121-p109">Если ваше приложение участвует в контрактах обновления кэшированных файлов, оно оповещается об изменениях, вносимых в файл другим универсальным приложением (например, Office). О том, как это работает в Windows, см. статью [Класс CachedFileUpdater](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.cachedfileupdater.aspx).</span><span class="sxs-lookup"><span data-stu-id="4b121-p109">If your universal app participates in Cached File Updater contracts, it will be notified of changes another universal app (such as Office) makes to the file. For information about how this works in Windows, see [CachedFileUpdater class](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.cachedfileupdater.aspx).</span></span>
  
<span data-ttu-id="4b121-p110">Office использует параметр **AllowOnlyReaders** для открытия файлов для чтения и записи, предоставляемых вашим универсальным приложением с помощью контрактов выбора файлов. Это означает, что при открытии файла в Office он не может быть перемещен, удален, переименован или изменен другим приложением, включая ваше собственное. Office выполняет автоматическое сохранение файла, но задает свойство CachedFileManager.DeferUpdates, чтобы предотвратить активацию вашего приложения до закрытия документа приложением Office или до приостановки Office операционной системой Windows (при переключении пользователя на другое приложение). Ваше приложение может вносить записи в файл только после его закрытия приложением Office.</span><span class="sxs-lookup"><span data-stu-id="4b121-p110">Office uses the **AllowOnlyReaders** option to open the read-write files your universal app provides via the file picker contracts. This means the file cannot be moved, deleted, renamed, or written to by another app, including your own, while it is open in Office. Office will autosave the file, but sets CachedFileManager.DeferUpdates to prevent activating your app until Office closes the document, or Office is suspended by Windows (when the user switches to another app). When Office closes the file, your app can write to it.</span></span> 
  
<span data-ttu-id="4b121-151">Ваше приложение должно управлять всеми операциями передачи данных в службе, включая скачивание, обновление или отправку файлов.</span><span class="sxs-lookup"><span data-stu-id="4b121-151">Your app must handle all communication with your service, including download, refresh, and upload.</span></span>
  
<span data-ttu-id="4b121-152">В таблицах ниже перечислены параметры, задаваемые для управления взаимодействием между вашим приложением и Office.</span><span class="sxs-lookup"><span data-stu-id="4b121-152">The following tables lists the parameters to set to handle interactions between your app and Office.</span></span>
  
|<span data-ttu-id="4b121-153">**Параметр**</span><span class="sxs-lookup"><span data-stu-id="4b121-153">**Parameter**</span></span>|<span data-ttu-id="4b121-154">**Описание**</span><span class="sxs-lookup"><span data-stu-id="4b121-154">**Description**</span></span>|
|:-----|:-----|
|[<span data-ttu-id="4b121-155">ReadActivationMode</span><span class="sxs-lookup"><span data-stu-id="4b121-155">ReadActivationMode</span></span>](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.readactivationmode.aspx) <br/> |<span data-ttu-id="4b121-156">Задайте параметр **BeforeAccess**, чтобы позволить приложению обновлять файл перед его отправкой в Office.</span><span class="sxs-lookup"><span data-stu-id="4b121-156">Set **BeforeAccess** to allow your app to update the file before it sends it to Office.</span></span>  <br/> |
|[<span data-ttu-id="4b121-157">WriteActivationMode</span><span class="sxs-lookup"><span data-stu-id="4b121-157">WriteActivationMode</span></span>](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.writeactivationmode.aspx) <br/> |<span data-ttu-id="4b121-p111">Задайте параметр **ReadOnly**, чтобы файл был доступен только для чтения. Задайте параметр **AfterWrite**, чтобы класс CacheFileUpdater всегда запускал ваше приложение после того, как приложение Office завершит работу с файлом.  </span><span class="sxs-lookup"><span data-stu-id="4b121-p111">Set **ReadOnly** to make the file read only. Set **AfterWrite** to ensure that your app will be triggered by the CacheFileUpdater when Office is finished with the file.</span></span><br/><br/><span data-ttu-id="4b121-160">**ПРИМЕЧАНИЕ**. Если вы не зададите параметр **AfterWrite**, ваше приложение не будет передавать сведения об изменениях. Это значит, что изменения, вносимые пользователем, будут иметь только локальный характер.</span><span class="sxs-lookup"><span data-stu-id="4b121-160">**NOTE**: If you do not set **AfterWrite**, your app will not be notified to upload the changes, which means that the user's changes will only be local.</span></span>           |
|[<span data-ttu-id="4b121-161">CachedFileOptions.RequireUpdateOnAccess</span><span class="sxs-lookup"><span data-stu-id="4b121-161">CachedFileOptions.RequireUpdateOnAccess</span></span>](https://msdn.microsoft.com/library/windows/apps/windows.storage.provider.cachedfileoptions.aspx) <br/> |<span data-ttu-id="4b121-162">Задайте это свойство, чтобы ваше приложение всегда обновляло файл после получения к нему доступа пользователем в списке последних использованных файлов.</span><span class="sxs-lookup"><span data-stu-id="4b121-162">Set this property to ensure that your app can update the file when a user accesses it from the Recent list.</span></span>  <br/> |
   
## <a name="invoking-office-from-your-app"></a><span data-ttu-id="4b121-163">Вызов Office из вашего приложения</span><span class="sxs-lookup"><span data-stu-id="4b121-163">Invoking Office from your app</span></span>

<span data-ttu-id="4b121-p112">When a user opens an Office document from your app, the document can open in Excel Mobile, PowerPoint Mobile, and Word Mobile. For example, when a user selects a \*.docx file in your app, Word Mobile launches with the \*.docx file opened. The Office app that opens is based on which app the user associated with the file type.</span><span class="sxs-lookup"><span data-stu-id="4b121-p112">When a user opens an Office document from your app, the document can open in Excel Mobile, PowerPoint Mobile, and Word Mobile. For example, when a user selects a \*.docx file in your app, Word Mobile launches with the \*.docx file opened. The Office app that opens is based on which app the user associated with the file type.</span></span>
  
<span data-ttu-id="4b121-p113">Для открытия файлов из вашего приложения в Office рекомендуется использовать метод **LaunchFileAsync()**. Мы не рекомендуем использовать метод **LaunchUriAsync()** для запуска файла, так как вместо приложения Office он будет запускать приложение, зарегистрированное для схемы URI (браузер). Хотя метод **LaunchUriAsync()** с параметром **LauncherOptions.ContentType()** может вызвать приложение Office, в этом случае открываемый файл помечается в Office как временный и доступный только для чтения.</span><span class="sxs-lookup"><span data-stu-id="4b121-p113">To open a file from your app in Office, we recommend that you use **LaunchFileAsync()** to launch the file. We don't recommend that you use **LaunchUriAsync()** to launch the file because that will cause the application registered for the URI scheme to launch (the browser) instead of Office. Although **LaunchUriAsync()** with the **LauncherOptions.ContentType()** option can invoke Office, in this case the file opened is marked as temporary and is read-only in Office.</span></span> 
  
<span data-ttu-id="4b121-170">Дополнительные сведения см. в статье [Класс Launcher](https://msdn.microsoft.com/library/windows/apps/windows.system.launcher.aspx).</span><span class="sxs-lookup"><span data-stu-id="4b121-170">For more information, see [Launcher class](https://msdn.microsoft.com/library/windows/apps/windows.system.launcher.aspx).</span></span>
  
## <a name="temporary-and-read-only-files"></a><span data-ttu-id="4b121-171">Временные файлы и файлы доступные только для чтения</span><span class="sxs-lookup"><span data-stu-id="4b121-171">Temporary and read-only files</span></span>

<span data-ttu-id="4b121-172">В своем приложении задайте атрибут **FILE_ATTRIBUTE_TEMPORARY** для временных файлов и атрибут **FILE_ATTRIBUTE_READONLY** для файлов, доступных только для чтения.</span><span class="sxs-lookup"><span data-stu-id="4b121-172">Set the **FILE_ATTRIBUTE_TEMPORARY** attribute on temporary files and the **FILE_ATTRIBUTE_READONLY** attribute on read-only files in your app.</span></span> 
  
<span data-ttu-id="4b121-p114">Файлы с заданным атрибутом **FILE_ATTRIBUTE_TEMPORARY** или **FILE_ATTRIBUTE_READONLY** открываются в Office как доступные только для чтения. Кроме того, при заданном атрибуте **FILE_ATTRIBUTE_TEMPORARY** файл не отображается в списке последних использованных документов.</span><span class="sxs-lookup"><span data-stu-id="4b121-p114">Files that have the **FILE_ATTRIBUTE_TEMPORARY** or **FILE_ATTRIBUTE_READONLY** attributes set open as read-only in Office. The **FILE_ATTRIBUTE_TEMPORARY** also prevents the file from appearing in the Recent list.</span></span> 
  
<span data-ttu-id="4b121-175">Дополнительные сведения об атрибутах см. в статье [Функция SetFileAttributes](https://msdn.microsoft.com/library/windows/desktop/aa365535%28v=vs.85%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="4b121-175">For more information about file attributes, see [SetFileAttributes function](https://msdn.microsoft.com/library/windows/desktop/aa365535%28v=vs.85%29.aspx).</span></span>
  
## <a name="other-best-practices"></a><span data-ttu-id="4b121-176">Наши рекомендации</span><span class="sxs-lookup"><span data-stu-id="4b121-176">Other best practices</span></span>

<span data-ttu-id="4b121-177">Чтобы добиться оптимальной целостности файлов, например при конфликтующих изменениях или ошибках, используйте указанные ниже рекомендации.</span><span class="sxs-lookup"><span data-stu-id="4b121-177">To optimize for file consistency, for example when conflicting edits or errors occur, apply the following best practices:</span></span>
  
- <span data-ttu-id="4b121-178">Предотвращение конфликтов сохранения</span><span class="sxs-lookup"><span data-stu-id="4b121-178">Prevent save conflicts.</span></span>
    
  - <span data-ttu-id="4b121-p115">Приостановите отправку данных при возникновении конфликтов с сервером, чтобы избежать разветвления (оно допускается, только если в приложении Office больше нет открытых файлов, доступных для записи). Обычно если файл из вашего приложения открывается в Office, ваше приложение активируется только после закрытия Office или после его приостановки операционной системой Windows.</span><span class="sxs-lookup"><span data-stu-id="4b121-p115">Pause uploads when server conflicts occur to avoid forking (only fork when Office no longer has a write file open). Typically, if a file from your app is open in Office, your app is activated only when Office closes or is suspended by Windows.</span></span>
    
  - <span data-ttu-id="4b121-181">Если для устранения конфликтов вам нужен пользовательский интерфейс, используйте всплывающие уведомления.</span><span class="sxs-lookup"><span data-stu-id="4b121-181">If you need UI to handle conflicts, implement toast notifications.</span></span> <span data-ttu-id="4b121-182">Полный пользовательский интерфейс не будет доступен, когда набор Office заблокирован.</span><span class="sxs-lookup"><span data-stu-id="4b121-182">Full UI is not available when Office is suspended.</span></span>
    
- <span data-ttu-id="4b121-183">Устранение ошибок</span><span class="sxs-lookup"><span data-stu-id="4b121-183">Handle errors.</span></span>
    
  - <span data-ttu-id="4b121-184">При снятии блокировки следует уведомить пользователей о возникшем конфликте и сообщить им о способах решения проблемы в своем приложении.</span><span class="sxs-lookup"><span data-stu-id="4b121-184">When a lock is released, notify users of the conflict and provide a path to resolve it within your app.</span></span>
    
## <a name="see-also"></a><span data-ttu-id="4b121-185">См. также</span><span class="sxs-lookup"><span data-stu-id="4b121-185">See also</span></span>

- [<span data-ttu-id="4b121-186">Интеграция с Office</span><span class="sxs-lookup"><span data-stu-id="4b121-186">Integrate with Office</span></span>](integrate-with-office.md)   
- [<span data-ttu-id="4b121-187">Интеграция клиентов синхронизации Win32 с приложениями Office</span><span class="sxs-lookup"><span data-stu-id="4b121-187">Integrate with Office from Win32 sync clients</span></span>](integrate-with-office-from-win32-sync-clients.md)
    

